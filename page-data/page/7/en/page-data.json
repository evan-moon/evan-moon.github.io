{"componentChunkName":"component---src-templates-posts-page-template-index-tsx","path":"/page/7/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"b57586e0-3eed-597d-b57d-4f15d61c8773","tableOfContents":"<ul>\n<li><a href=\"#what-is-artificial-neural-network\">What is Artificial Neural Network?</a></li>\n<li><a href=\"#the-arrival-of-the-dark-age\">The Arrival of the Dark Age</a></li>\n<li><a href=\"#time-to-rise-again\">Time to Rise Again</a></li>\n</ul>","excerpt":"In this post, I want to write about what Deep Learning is and how it differs from traditional Neural Networks.","html":"<p>In this post, I want to write about what Deep Learning is and how it differs from traditional Neural Networks.</p>\n<!-- more -->\n<h2 id=\"what-is-artificial-neural-network\" style=\"position:relative;\">What is Artificial Neural Network?<a href=\"#what-is-artificial-neural-network\" aria-label=\"what is artificial neural network permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Humanity has been trying to create thinking machines since the past. Various attempts were made in this process, and the method eventually devised was to <strong>program the human brain</strong>. This idea was possible because we came to understand the structure of the human brain to some extent in modern times, and also because this structure was simpler than expected.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3823b410149889c0e9aefb86b3f6e80e/21b4d/neural.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVR42n2SW2/TQBCF/eOREEK8AT8AISgiQlVb0pCGXqI2KcVNHDuxY2/ttRPFleMrm8SOL2sz8UYCqYLzsPvg+c4czyxX1fJ8bzKZmKaZ53n1D5VlCWeWZXEcb7fboii4shYhK8dxgKSU/h/2/UDTNOgUhiEHgG0/fmteDgajNE2xbsFZ7ipLMGIAk6roo6E8EuQHZDAvDi5JlFsn3cZBq9Pufv7Y1FQdY2wYBkII4mW1iiJ3nOjksNs+7UJPZreDAz+660tnX/ne9b0oTAn5lSQxJALvIAhUVZtOFVlRVbF/1GidtXqq8gCN97A8RpBQGhrCHZIEraxoVf79qzTJq0dLMG+egZeJ56Ig/4l9ey31b4R2k3/z+ujw0xD9bHjah3W0oNkKRkpp7ls/JlevVuEcimlBN+uYzWIHG/pswI/bx/zzl++uzkUL3S/xd1M4sPi3xvA97r3A4pfIw/G2iOPNuhaY7uGpgk6PLy86vbGALjq3S9efL9wwIrutppsViVhImJnv+/AWdF2HVe9h1/UMA0sjOUkSe+GkaUaLHErh09J1Yeae5wL2dPMcjGo2m7EYT0UIsW07qsX6MzH4N1O3XWVgB46dAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"neural\" title=\"\" src=\"/static/3823b410149889c0e9aefb86b3f6e80e/6af66/neural.png\" srcset=\"/static/3823b410149889c0e9aefb86b3f6e80e/69538/neural.png 160w,\n/static/3823b410149889c0e9aefb86b3f6e80e/72799/neural.png 320w,\n/static/3823b410149889c0e9aefb86b3f6e80e/6af66/neural.png 640w,\n/static/3823b410149889c0e9aefb86b3f6e80e/d9199/neural.png 960w,\n/static/3823b410149889c0e9aefb86b3f6e80e/21b4d/neural.png 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>The human brain is an aggregate of cells called neurons. These neurons are simply cells that receive a signal, modulate it, and then transmit it again, and the brain is ultimately a structure where these neurons are connected like a network.</p>\n<p>In conclusion, while the structure of the human brain is connected in an extremely complex way, the neurons themselves that form these connections had a surprisingly simple structure.</p>\n<p>These neurons receive input signals at dendrites and transmit output signals through axons. At this time, for a signal to be transmitted to the next neuron, it must send a signal above a certain strength. Looking in more detail, it roughly follows this sequence:</p>\n<hr>\n<ol>\n<li>It receives signals from multiple synapses connected to the neuron. At this time, the signal can be represented as the product of the amount of chemical substance secreted (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span>) and the time it is secreted (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span>).</li>\n<li>It combines multiple signals received from multiple synapses.</li>\n<li>A specific value (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>) is added before transmitting to the next synapse.</li>\n<li>If this value exceeds a specific threshold, the signal is transmitted to the next synapse.</li>\n</ol>\n<hr>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6d395b79311597e65462e2af18844938/36dd4/hoe.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHvZXoaoCwQD//EABkQAQEBAAMAAAAAAAAAAAAAAAEAQREhMf/aAAgBAQABBQJhSO7cDg2PP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABwQAAEDBQAAAAAAAAAAAAAAAAEAEDERICFBUf/aAAgBAQAGPwJCvMvEHdv/xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhMUFhcYGRwf/aAAgBAQABPyFUdYFYIZazECxsY3rv5DbKvQmIu/EQTZxHU0dp/9oADAMBAAIAAwAAABAzwAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEAAgIDAAMAAAAAAAAAAAABABEhMUFxoYHB4f/aAAgBAQABPxAELpGOWD6qURYNh+QWYFiQWOiqFoeX35LVUpMD5AbMxrAyxQAIbA0qvsm3qedP/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hoe\" title=\"\" src=\"/static/6d395b79311597e65462e2af18844938/36dd4/hoe.jpg\" srcset=\"/static/6d395b79311597e65462e2af18844938/0913d/hoe.jpg 160w,\n/static/6d395b79311597e65462e2af18844938/cb69c/hoe.jpg 320w,\n/static/6d395b79311597e65462e2af18844938/36dd4/hoe.jpg 512w\" sizes=\"(max-width: 512px) 100vw, 512px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Wait...? It's simpler than expected...?</small>\n</center>\n<p>The human brain works on such simple principles… Then couldn’t we make this with machines? That’s where ANN (Artificial Neural Network) started from. This operation method of neurons can be diagrammed as follows.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/500df46f498950f6283ef37cc89af689/aeb8d/artificial-neural-network.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd5FCKD/xAAWEAEBAQAAAAAAAAAAAAAAAAAQATH/2gAIAQEAAQUCbh//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAACAwEAAAAAAAAAAAAAAAAAIRARMVH/2gAIAQEAAT8hG6Hw3n//2gAMAwEAAgADAAAAEPMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAITFRkRD/2gAIAQEAAT8QZOxyEui1ROI9XZUoorMGB5//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"artificial neural network\" title=\"\" src=\"/static/500df46f498950f6283ef37cc89af689/c08c5/artificial-neural-network.jpg\" srcset=\"/static/500df46f498950f6283ef37cc89af689/0913d/artificial-neural-network.jpg 160w,\n/static/500df46f498950f6283ef37cc89af689/cb69c/artificial-neural-network.jpg 320w,\n/static/500df46f498950f6283ef37cc89af689/c08c5/artificial-neural-network.jpg 640w,\n/static/500df46f498950f6283ef37cc89af689/aeb8d/artificial-neural-network.jpg 651w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>This diagram can be expressed again as a formula like this:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>x</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">  f(\\sum\\limits_{i=1}^n x_i w_i + b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.9291em;vertical-align:-1.2777em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span></span></div>\n<p>At this time, this function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> is called the <strong>Activation Function</strong>, and this function returns <code class=\"language-text\">1</code> if the value inside the function exceeds a certain standard, otherwise it returns <code class=\"language-text\">0</code>.</p>\n<p>Thinking of this as one neuron, if we gather several of these neurons, it would roughly have a structure like below.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 520px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8c5079be24758bf721e5270eaa520a7b/ddb38/single-layer-network.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuZ3oaggFwf//EABkQAAMAAwAAAAAAAAAAAAAAAAACMQEQIf/aAAgBAQABBQIaabmBI8P/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAZEAACAwEAAAAAAAAAAAAAAAAQMQARIEH/2gAIAQEABj8CHQ6jx//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExURBhwf/aAAgBAQABPyFaXmO9WnRMzIdXb+TsPYlkq1ffhOCf/9oADAMBAAIAAwAAABBwAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAdEAACAgIDAQAAAAAAAAAAAAABEQAhMVFBgZGh/9oACAEBAAE/EGILdgmuoBdpeQzDQHJlUDQ9QAExXga8lAtgauFYErkXDRkb3Pmn/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"single layer network\" title=\"\" src=\"/static/8c5079be24758bf721e5270eaa520a7b/ddb38/single-layer-network.jpg\" srcset=\"/static/8c5079be24758bf721e5270eaa520a7b/0913d/single-layer-network.jpg 160w,\n/static/8c5079be24758bf721e5270eaa520a7b/cb69c/single-layer-network.jpg 320w,\n/static/8c5079be24758bf721e5270eaa520a7b/ddb38/single-layer-network.jpg 520w\" sizes=\"(max-width: 520px) 100vw, 520px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>And machines in this form were already developed in the 1950s and could solve linear equations like <code class=\"language-text\">AND</code> or <code class=\"language-text\">OR</code> problems.</p>\n<h2 id=\"the-arrival-of-the-dark-age\" style=\"position:relative;\">The Arrival of the Dark Age<a href=\"#the-arrival-of-the-dark-age\" aria-label=\"the arrival of the dark age permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now one question arises here.</p>\n<blockquote>\n<p><em>Wait, it’s 2018, 18 years into the 21st century, and if it was already developed to that point in the 1950s, shouldn’t robots be doing work for me now? And laundry too? Huh?</em></p>\n</blockquote>\n<p>You might think this. First, let’s look again at <code class=\"language-text\">AND</code> and <code class=\"language-text\">OR</code> mentioned earlier.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 301px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f87f23e2080e37f8112b3b9c36b731fe/fb933/or.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 111.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABUklEQVR42q2UzU7CQBDHZwkUUZGmBfEDFQxqJHwkcOPoyYN3D76KiRevPoqv49mLD+HF9T90tpUNK2zLJL+03c7+d2Znd4jWmwJt0Ae75GHK8V0Fj+AVXDl8vcXrYA9UfCafyKTCVgJz0AUB2AeH1mLKitq8h6C5KqsbEVHicLlmr8z4Mbhw+UZSgO0Ydj3uZ4Ilj+ItR6Zl4A3n7JNowO8vmwv+a40PoqFOqp0uVMQiThlCtzq5GYVF06JAaAoaRUVTwS/c2W+isZa7m1d06dhApA4moLyNlJU8W4h0lDdKO8KFwA9RR2ddxlswkEMdWJH2jKgVKRcudl29prSnyqquA6FrcGSJ8veZS7AtKwaS+o6hQ1S7xxgO/vQdW8CL8pj4ctFqQmoc9pO0o1iILMIHZPGcpB4eZOPse/qn6ywM/2mWs71zZHeuucoTkj0/Nwq/gg4uC2jd4OgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"or\" title=\"\" src=\"/static/f87f23e2080e37f8112b3b9c36b731fe/fb933/or.png\" srcset=\"/static/f87f23e2080e37f8112b3b9c36b731fe/69538/or.png 160w,\n/static/f87f23e2080e37f8112b3b9c36b731fe/fb933/or.png 301w\" sizes=\"(max-width: 301px) 100vw, 301px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 314px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8f39aacbb882bcd4bc1eb9e0b43e1935/5b158/and.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 105.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLUlEQVR42qWUS27CMBCGxwkUIShUBfMQVSmPLnivgB234BRwA67Moqu2rMyfxhGWlWlix9KnsWLn98x4PET8CEAfSDAAVXIYImX+Ck7gDC7gM2Wv0yjDtTpsDTRAyTqUFQ7BB7dBeXh0AC0tXD3Glq7w6otoYuTTDPcFvHEpGOh8CR1emCz8EI2/id5TPG3o/9icSm7hRrRU8bpT+JygiER+ieawbUtU+AgmF1MCa6VrMY+nMutEiNQR/ga2XCRkW/QZoitlXFwRD4W2XeR0lhV6Xg//9qCUhupRo/6CpihqdIT5kPNUujz6RCAKXcXvnQoJGsIhd0Ed443mKYsKaP5X4F3dAAKjNWURcGJTsNcNQjoQdageGNme7sDCoxs/gS3X/gOPjh518JX99Q7bxDBuFb9FLwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"and\" title=\"\" src=\"/static/8f39aacbb882bcd4bc1eb9e0b43e1935/5b158/and.png\" srcset=\"/static/8f39aacbb882bcd4bc1eb9e0b43e1935/69538/and.png 160w,\n/static/8f39aacbb882bcd4bc1eb9e0b43e1935/5b158/and.png 314w\" sizes=\"(max-width: 314px) 100vw, 314px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<p>Since <code class=\"language-text\">AND</code> and <code class=\"language-text\">OR</code> are linear equations, solving such problems wasn’t very difficult even with machines using Single Layer Networks developed in the 1950s.</p>\n<p>People who succeeded up to here thought “Awesome. Soon machines will be able to walk, run, and talk!” but the problem was the non-linear equation <code class=\"language-text\">XOR</code>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 281px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c0b2a78291b2791a491b0e6ccd63d2d3/6b1e2/xor.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 104.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA9klEQVR42mNgIAxYgZgTiLmBmAuImRnIBExQWg+Iy4E4A4gbgFgMKs6ISyMjDkmYmCAQqwOxNhArQ11KlGu4CVhANBAAYjkg1sBhICMaJgjUgNgRGuCwMFMkFE5IQAQacXAAijUeqAQDNEbZSfAhGzaLQYKiDFQEBA38D4y4/yRE1oC40PknA4MOlM1IkYEg7/5jYIgG4iVANgtFLvwPzYJA2g2Igyl2IZKBEf+p4WWYZiAt9R+SrykPQ5rEMj0NZMKW9diRCk4BaN7GVtIgY1gBbAXEQuiFCbILmUgsD1mxqRcGYi2oKyWAWBxKE4PFoI4BleYSALBSH0JnOftvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"xor\" title=\"\" src=\"/static/c0b2a78291b2791a491b0e6ccd63d2d3/6b1e2/xor.png\" srcset=\"/static/c0b2a78291b2791a491b0e6ccd63d2d3/69538/xor.png 160w,\n/static/c0b2a78291b2791a491b0e6ccd63d2d3/6b1e2/xor.png 281w\" sizes=\"(max-width: 281px) 100vw, 281px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>No matter how you draw a line, there’s just no answer. <code class=\"language-text\">XOR</code> is a logical expression that is true when two inputs are not the same. It seemed very simple, but since <code class=\"language-text\">XOR</code> is not a linear equation, only 50% accuracy could be achieved with straight lines. People who reached this point became frustrated.</p>\n<blockquote>\n<p>We need to use MLP, Multi Layer Perceptrons.\nNo one on earth had found a viable way to train MLPs good enough to learn such simple functions.</p>\n<p><strong>Perceptrons(1969)</strong> <em>Marvin Minsky</em></p>\n</blockquote>\n<p>Eventually in 1969, <strong>Marvin Minsky</strong> mathematically proved that the <code class=\"language-text\">XOR</code> problem cannot be solved with a Single Layer Network. He said it’s possible with a Multi Layer Network but nobody can train it.</p>\n<p>I wanted to know more about this reason, so I looked up passages from Perceptrons and found:</p>\n<blockquote>\n<p>it ought to be possible to devise a training alhorithm to optimize the weights in thie using, say, the magnitude of a reinforcement signal to communicate to the net the cost of an error. We have not investigated this.</p>\n<p><strong>Perceptrons(1969)</strong> <em>Marvin Minsky</em></p>\n</blockquote>\n<p>Googling around, I found opinions that the book Perceptrons focused on explaining why <code class=\"language-text\">XOR</code> doesn’t train with a Single Layer Network and then wrote something like:</p>\n<blockquote>\n<p>Well… we know training with a Multi Layer Network should work, but we don’t quite know how to do it yet.</p>\n</blockquote>\n<p>Anyway, this book disappointed many people, and because of this, the entire field of Neural Networks entered a dark age.</p>\n<h2 id=\"time-to-rise-again\" style=\"position:relative;\">Time to Rise Again<a href=\"#time-to-rise-again\" aria-label=\"time to rise again permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In 1974, Paul Werbos published an algorithm called “Backpropagation” in his doctoral dissertation.</p>\n<p>But sadly, nobody paid attention, and even Marvin Minsky, the author of Perceptrons, didn’t show interest. He even republished the paper in 1982, but it was just buried again…</p>\n<p>Then in 1986, Geoffrey Hinton independently rediscovered this algorithm and presented it, gaining attention. Anyway, because of this algorithm, the fact that training Multi Layer Networks is possible became known, and the field of Neural Networks became vibrant again.</p>\n<p>The structure of the Backpropagation algorithm is simple. It’s literally propagating errors back (Back) from the side closest to the output (Propagation). That’s why it’s also called the “Backpropagation algorithm.”</p>\n<p>I’ll cover this Backpropagation in <a href=\"/2018/07/19/deep-learning-backpropagation\">the next post</a>.</p>\n<p>That’s all for this first Deep Learning post.</p>","fields":{"slug":"20180717-deep-learning-intro-en","path":"/2018/07/17/deep-learning-intro/en/","lang":"en"},"frontmatter":{"title":"[Deep Learning Series] What is Deep Learning?","subTitle":"History of Neural Networks and the Starting Point of Modern Deep Learning","date":"Jul 17, 2018","categories":["Programming","Machine Learning"],"tags":["Machine Learning","Deep Learning","Machine Learning Basics","Deep Learning Basics","Tutorial","Backpropagation","Neural Network"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/26718e1f085d210bba3e45681f40c1fa/3a812/thumbnail.jpg","srcSet":"/static/26718e1f085d210bba3e45681f40c1fa/3a812/thumbnail.jpg 320w,\n/static/26718e1f085d210bba3e45681f40c1fa/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/26718e1f085d210bba3e45681f40c1fa/fc5c5/thumbnail.webp 320w,\n/static/26718e1f085d210bba3e45681f40c1fa/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/26718e1f085d210bba3e45681f40c1fa/2d839/thumbnail.jpg","srcSet":"/static/26718e1f085d210bba3e45681f40c1fa/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/26718e1f085d210bba3e45681f40c1fa/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"9d118311-1c61-5849-81c3-7b30acf5f20c","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-express-checkout\">What is Express Checkout?</a></p>\n<ul>\n<li><a href=\"#paypal-standard\">Paypal Standard</a></li>\n<li><a href=\"#express-checkout\">Express Checkout</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#express-checkout-flow\">Express Checkout Flow</a></p>\n</li>\n<li>\n<p><a href=\"#proceeding-with-client-only\">Proceeding with Client Only</a></p>\n</li>\n<li>\n<p><a href=\"#proceeding-with-client-and-server-communication\">Proceeding with Client and Server Communication</a></p>\n</li>\n<li>\n<p><a href=\"#execution-results\">Execution Results</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to write about how to use Express Checkout, PayPal’s RESTful API. Before proceeding, first you need to access the PayPal Sandbox website and create a sandbox account.","html":"<p>In this post, I want to write about how to use Express Checkout, PayPal’s RESTful API. Before proceeding, first you need to access the <a href=\"https://www.sandbox.paypal.com/\" target=\"_blank\" rel=\"nofollow\">PayPal Sandbox website</a> and create a sandbox account.</p>\n<!-- more -->\n<p>You can test with this account, and for actual production accounts, just sign up on the <a href=\"https://www.paypal.com/kr/home\" target=\"_blank\" rel=\"nofollow\">PayPal website</a>.</p>\n<h2 id=\"what-is-express-checkout\" style=\"position:relative;\">What is Express Checkout?<a href=\"#what-is-express-checkout\" aria-label=\"what is express checkout permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>It’s one of the payment flow methods PayPal provides. When users click the “Buy with PayPal” button, a PayPal login modal window is rendered, and payment proceeds through this flow.\nIt supports all countries, and browser support is as follows:</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Internet Explorer</th>\n<th align=\"center\">Chrome</th>\n<th align=\"center\">Mozila Firefox</th>\n<th align=\"center\">Safari</th>\n<th align=\"center\">Opera</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">v9~</td>\n<td align=\"center\">v27~</td>\n<td align=\"center\">v30~</td>\n<td align=\"center\">v5.1~</td>\n<td align=\"center\">v23~</td>\n</tr>\n</tbody>\n</table>\n<p>PayPal provides a total of 3 payment flows, and in Korea, you can choose between these 2 methods provided for All countries.</p>\n<h3 id=\"paypal-standard\" style=\"position:relative;\">Paypal Standard<a href=\"#paypal-standard\" aria-label=\"paypal standard permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This method directly inserts buttons generated based on HTML code provided by PayPal into web client source code.\nYou directly enter product name, product ID, price, etc. on the PayPal site, and it automatically generates button code accordingly. Then you insert that code into client source.</p>\n<h3 id=\"express-checkout\" style=\"position:relative;\">Express Checkout<a href=\"#express-checkout\" aria-label=\"express checkout permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This method dynamically renders buttons using checkout.js, PayPal’s JavaScript SDK.\nIt proceeds by transmitting product data to your service’s server, then authenticating with PayPal servers in a Server to Server method. I chose this method.</p>\n<h2 id=\"express-checkout-flow\" style=\"position:relative;\">Express Checkout Flow<a href=\"#express-checkout-flow\" aria-label=\"express checkout flow permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>This section was written referencing the <a href=\"https://developer.paypal.com/docs/orders-integration-guide/?mark=express%20checkout#\" target=\"_blank\" rel=\"nofollow\">Express Checkout</a> section of the PayPal Developer page.</p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/01dae/flow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 19.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVR42lWNTU+DQBiE+f8/xysn9aAXJWlso5QIhV0KpYHly93l6xEajfFJ5jAzed9xwuDIKfCRUqCqipcg4f49wU/OtKpkH0kejim7T0FTK4QQhGFIkiSUZcklz0mzC7FI177GefZj7nYR8pzdgii/8nZKycuaRlXIa8XrR0iUFXRdx+FwwHVdPM+jUuo2sk9bRKEwusdp9UDRGewwskwjstY8yYZGW1j91j3GFWmjWeYJbQxFUdC2LdM0Ya2l73uM0YzjhDPPM+OwHv+wLAtfWv/5VduTLf9lGIZ/3lrDvI5tfAP9sC7SOWTQKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"express-checkout-flow\" title=\"\" src=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/6af66/flow.png\" srcset=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/69538/flow.png 160w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/72799/flow.png 320w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/6af66/flow.png 640w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/01dae/flow.png 721w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Overall Express Checkout flow</small>\n</center>\n<p>Simply put, the UX is similar to the flow of logging in with Facebook or Instagram accounts.</p>\n<p>When users click the purchase button, the PayPal login window opens as a popup on desktop and as a new tab on mobile, and users proceed with authentication and payment sequentially in that window.</p>\n<p>After all flows are completed, users move to the URL sent as the <code class=\"language-text\">redirect_url</code> parameter to PayPal according to payment progress results, and finally see the page and payment information results according to success, failure, or cancellation.\nThere are 2 methods for communicating with PayPal servers: <code class=\"language-text\">RESTful API</code> and <code class=\"language-text\">NVP/SOAP API</code>, but this document will only describe the <code class=\"language-text\">RESTful API</code>.</p>\n<p>The PayPal Express Checkout flow is as follows:</p>\n<hr>\n<ol>\n<li>User clicks the purchase button</li>\n</ol>\n<ul>\n<li>Express Checkout’s client SDK <code class=\"language-text\">checkout.js</code> opens a login modal, or the API server calls the PayPal API to initialize the <code class=\"language-text\">payment</code> event.</li>\n<li>After <code class=\"language-text\">payment</code> event initialization, Express Checkout flow starts inside the modal.</li>\n</ul>\n<ol start=\"2\">\n<li>User proceeds with PayPal login</li>\n<li>User confirms payment information and clicks the <code class=\"language-text\">Continue</code> button</li>\n<li>When user clicks the <code class=\"language-text\">Continue</code> button, they move back to the service’s redirect page and final payment information is displayed.</li>\n</ol>\n<p>Product information parameters sent when creating payment information should be exposed at this stage.\n5. Finally, the <code class=\"language-text\">execute</code> API is called and payment is completed. And the user is redirected to the service’s payment completion page.</p>\n<hr>\n<h2 id=\"proceeding-with-client-only\" style=\"position:relative;\">Proceeding with Client Only<a href=\"#proceeding-with-client-only\" aria-label=\"proceeding with client only permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>PayPal official documentation recommends dynamic loading using CDN to maximize version compatibility with Express Checkout. Downloading the <code class=\"language-text\">checkout.js</code> file directly and putting it in client source is not recommended.</p>\n</blockquote>\n<blockquote>\n<p>The version of <code class=\"language-text\">checkout.js</code> in this document proceeds with <code class=\"language-text\">4.0</code>.</p>\n</blockquote>\n<p>The flow I’m writing now is a method that uses <code class=\"language-text\">checkout.js</code> to complete authentication and payment all at once directly from the PayPal server without going through my service’s API server.</p>\n<p>On the client, define data and render the PayPal payment button using <code class=\"language-text\">checkout.js</code>. Clicking this button calls <code class=\"language-text\">checkout.js</code>’s built-in methods to automatically proceed with authentication, payment token creation, and payment completion all in one go.</p>\n<p>First, for dynamic loading of the <code class=\"language-text\">checkout.js</code> SDK, I opened a <code class=\"language-text\">script</code> tag in the <code class=\"language-text\">index.html</code> file and wrote the following script.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> _DOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  _DOM<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'https://www.paypalobjects.com/api/checkout.js'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>_DOM<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then write the PayPal button DOM and render the button using <code class=\"language-text\">checkout.js</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pay-test-btn<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test to payment<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">paypal<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">env</span><span class=\"token operator\">:</span> <span class=\"token string\">'sandbox'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Enter 'sandbox' for testing, 'production' for production</span>\n  <span class=\"token literal-property property\">client</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">sandbox</span><span class=\"token operator\">:</span> <span class=\"token string\">'paypal-sandbox-key'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Enter client_key issued by PayPal</span>\n    <span class=\"token literal-property property\">production</span><span class=\"token operator\">:</span> <span class=\"token string\">'paypal-production-key'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">payment</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> env <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> paypal<span class=\"token punctuation\">.</span>rest<span class=\"token punctuation\">.</span>payment<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> client<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">transactions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token string\">'10.00'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">commit</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// When false, the last button text in the modal changes to Continue and doesn't proceed with payment right away but moves to redirect page.</span>\n  <span class=\"token comment\">// When true, it changes to Pay Now and payment proceeds right away</span>\n  <span class=\"token function-variable function\">onAuthorize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> actions</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> actions<span class=\"token punctuation\">.</span>payment<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// On payment success, data comes in callback parameter res</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#pay-test-btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then the PayPal button is automatically rendered on the <code class=\"language-text\">#pay-test-btn</code> DOM element we wrote earlier as shown below.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 234px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 71.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHaVppYBf/EABoQAQEAAgMAAAAAAAAAAAAAAAECAAMQERL/2gAIAQEAAQUCXoKHhPROuZc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQEABj8COzGalP/EABkQAQACAwAAAAAAAAAAAAAAAAEAEBEhMf/aAAgBAQABPyEMjyL4NqNeDNMTX//aAAwDAQACAAMAAAAQ1A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEBAAMBAAAAAAAAAAAAAAABEQAQMSH/2gAIAQEAAT8QZPB1w6ZXAdFHfJLMBsES3X//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"paypal-button\" title=\"\" src=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg\" srcset=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/0913d/paypal-button.jpg 160w,\n/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg 234w\" sizes=\"(max-width: 234px) 100vw, 234px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The button shape became a bit strange but let's not worry about it...</small>\n</center>\n<p>If the button rendered normally, let’s proceed with test payment now. Clicking that button will open a window like below. This window can open as a popup, iframe, or new tab depending on whether the user’s environment is desktop or mobile.</p>\n<p>PayPal calls this window the Light window, but for convenience in this post I’ll just call it “login modal”. After this, users proceed with payment following the login modal’s guidance, and when final payment is completed, they receive result values in the <code class=\"language-text\">res</code> parameter of the Promise Callback function in the <code class=\"language-text\">onAuthorize</code> method.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 252px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFNcDkmMF//xAAaEAACAgMAAAAAAAAAAAAAAAACAxAUAAES/9oACAEBAAEFAlL73WGAMgyw2P/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAAGAwAAAAAAAAAAAAAAAAABAhARMiIxkv/aAAgBAQAGPwLcC6uWxOBc2//EABkQAQEBAAMAAAAAAAAAAAAAAAERABAh8f/aAAgBAQABPyEmFQXou9jkjlKieAXf/9oADAMBAAIAAwAAABDPz//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/EKf/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QEX//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhUTFB0fH/2gAIAQEAAT8QH9ZDvnRLUDIwNTTUVnSlKyT5R5FVXuf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"light-window\" title=\"\" src=\"/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg\" srcset=\"/static/6ec0fda48bf17da3be915e442d513bee/0913d/light-window.jpg 160w,\n/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg 252w\" sizes=\"(max-width: 252px) 100vw, 252px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<h2 id=\"proceeding-with-client-and-server-communication\" style=\"position:relative;\">Proceeding with Client and Server Communication<a href=\"#proceeding-with-client-and-server-communication\" aria-label=\"proceeding with client and server communication permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This flow is a method of proceeding in order from PayPal authentication using the <code class=\"language-text\">client_key</code> and <code class=\"language-text\">secret</code> issued by PayPal.</p>\n<p>The advantage of this method is that you can proceed with payment while maintaining your service’s UX flow as much as possible, the flow is more flexible than the first method, and button design is also freely customizable with CSS.</p>\n<p>For that reason, PayPal also recommends this method. The payment flow is divided into 3 main stages.</p>\n<hr>\n<ol>\n<li>Authentication process to receive access token from PayPal server using <code class=\"language-text\">client_key</code> and <code class=\"language-text\">secret</code></li>\n<li>Process to <code class=\"language-text\">create</code> payment</li>\n<li>Process to <code class=\"language-text\">execute</code> payment</li>\n</ol>\n<hr>\n<p>First, the client must render a button and send a <code class=\"language-text\">create</code> request through this service’s API. At this time, the difference from the previous flow is that there’s no particular need to use <code class=\"language-text\">checkout.js</code>. First, render the button. For reference, I used <code class=\"language-text\">AngularJS</code> and <code class=\"language-text\">md-material</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">layout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">layout-align</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">layout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>column<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>md-button</span> <span class=\"token attr-name\">md-color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{background: 'blue-grey'}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ng-click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vm.postData()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      TEST\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>md-button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After that, since duplicate logic will need to be written when PayPal payment is used on other pages, I defined a separate factory. It’s fine to implement it inside the controller without defining a separate factory. This factory communicates with my API server and then passes values back to the controller using <code class=\"language-text\">Promise</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n    <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'services'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Restangular'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SNS_KEYS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$q'</span><span class=\"token punctuation\">,</span>\n      PaypalService\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalService</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$rootScope<span class=\"token punctuation\">,</span> Restangular<span class=\"token punctuation\">,</span> <span class=\"token constant\">SNS_KEYS</span><span class=\"token punctuation\">,</span> $q</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Pre-stored in app.constants to use the key issued by PayPal globally.</span>\n      <span class=\"token keyword\">var</span> clientKey <span class=\"token operator\">=</span> <span class=\"token constant\">SNS_KEYS</span><span class=\"token punctuation\">.</span>paypal<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">/**\n        * @public\n        * @name create\n        * @description create paypal payment request\n        * @param { Object } data\n        * @return { Promise }\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        data<span class=\"token punctuation\">.</span>clientKey <span class=\"token operator\">=</span> clientKey<span class=\"token punctuation\">;</span>\n        data<span class=\"token punctuation\">.</span>redirect_urls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">return_url</span><span class=\"token operator\">:</span> location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> <span class=\"token string\">'/paypal/result'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Page to redirect to when payment completes</span>\n          <span class=\"token literal-property property\">cancel_url</span><span class=\"token operator\">:</span> location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> <span class=\"token string\">'/paypal/result'</span> <span class=\"token comment\">// Page to redirect to when payment is canceled, can be same as return_url</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API server's API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'paypal/payments/create'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">customPOST</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> defer<span class=\"token punctuation\">.</span>promise<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">/**\n        * @name execute\n        * @description execute paypal payment\n        * @param { Object } data\n        * @return { Promise}\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API server's API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/paypal/payments/execute'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">customPOST</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> defer<span class=\"token punctuation\">.</span>promise<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">/**\n        * @name getPaymentInfo\n        * @description getting created paypal payment information\n        * @param { Object } data\n        * @return { Promise }\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API server's API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/paypal/payments/detail'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">customGET</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">create</span><span class=\"token operator\">:</span> create<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">execute</span><span class=\"token operator\">:</span> execute<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">getPaymentInfo</span><span class=\"token operator\">:</span> getPaymentInfo\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then in the Controller connected to the html file where the button was rendered, call the Paypal service defined above.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n    <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalCreateController'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$scope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span>\n      PaypalCreateController\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalCreateController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> vm <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Define dummy data for testing. In actual service, this data will be bound to forms.</span>\n      vm<span class=\"token punctuation\">.</span>paymentData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">transactions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'This is the description'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">item_list</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n              <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'This is test product'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">quantity</span><span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">sku</span><span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n      vm<span class=\"token punctuation\">.</span>postData <span class=\"token operator\">=</span> postData<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">postData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>paymentData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// The reason for Deep Copy is because there may be cases where data needs to be modified before transmission,</span>\n        <span class=\"token comment\">// and since Object types are basically Call by reference, modifying here would modify original data too.</span>\n        PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// PayPal returns a total of 3 URLs</span>\n          <span class=\"token comment\">// links[0] = GET method request URL to receive detailed values of just-created payment information</span>\n          <span class=\"token comment\">// links[1] = Redirect URL of created payment page</span>\n          <span class=\"token comment\">// links[2] = Payment execution URL</span>\n          <span class=\"token comment\">// Listed in this order.</span>\n          window<span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">.</span>links<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>At this time, the API server must have logic to communicate with PayPal servers using values sent from the client to proceed with authentication. My API server is built with <code class=\"language-text\">Laravel 5.x</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Log</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Requests</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">GuzzleHttp<span class=\"token punctuation\">\\</span>Client</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">PaypalPaymentController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$client</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$paymentUrl</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$accessToken</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Get access token value issued by PayPal from env</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span> <span class=\"token operator\">=</span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'PAYPAL_ACCESS_TOKEN_SANDBOX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Since we're testing now, we're sending requests to sandbox url. For actual service, remove sandbox and send to api.paypal.com.</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"https://api.sandbox.paypal.com/v1/payments/payment\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">detail</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$query</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'paymentId'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">payment</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'POST'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application.json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'json'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// Request Body to send to PayPal server, must be identical to parameters written on PayPal official site.</span>\n                <span class=\"token string double-quoted-string\">\"intent\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"sale\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"redirect_urls\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">redirect_urls</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"payer\"</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string double-quoted-string\">\"payment_method\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"paypal\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Korea only supports paypal method</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"transactions\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">transactions</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Payment information sent from client</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'POST'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">paymentId</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/execute'</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'json'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"payer_id\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">PayerID</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now when clicking the test button on the client, payment data is transmitted to my API server through the API I predefined called <code class=\"language-text\">/paypal/payment/create</code>, and the API server communicates with PayPal servers again with that data and returns results to the client. Then the client just opens the redirect page contained in <code class=\"language-text\">link[1]</code> of the returned data and payment starts!</p>\n<p>I’ll explain why it’s <code class=\"language-text\">link[1]</code> again below.</p>\n<p>After this, users move to either the login page or payment confirmation page depending on PayPal login status, and when clicking the Continue button in PayPal’s payment confirmation window, they land on the <code class=\"language-text\">redirect_url</code> page we sent through the <code class=\"language-text\">create</code> API earlier.</p>\n<p>At this time, PayPal sends data that the user has completed final payment confirmation and payment can now start, attached as a query string after the <code class=\"language-text\">redirect_url</code>.</p>\n<p>Now all basic client and server logic is ready! Explaining the overall flow again, it’s as follows:</p>\n<hr>\n<ol>\n<li>Client sends payment creation request to API server.</li>\n<li>API server sends payment creation request to PayPal server again with received data, then returns values to client.</li>\n<li>Client redirects user to <code class=\"language-text\">redirect_url</code> in returned data.</li>\n<li>Then user completes login and brief payment information confirmation on the moved PayPal page and clicks the <code class=\"language-text\">Continue</code> button.</li>\n<li>When <code class=\"language-text\">Continue</code> button is clicked, PayPal redirects user to the <code class=\"language-text\">redirect_url</code> contained in the payment creation request.</li>\n<li>Then user confirms detailed payment information before final payment on the redirected page.</li>\n<li>When user clicks the “final payment” button, client sends payment execution request to API server.</li>\n<li>API server passes this request to PayPal server again and returns values to client.</li>\n<li>User is redirected again to the corresponding page according to payment execution result.</li>\n</ol>\n<hr>\n<p>It looks very complicated, but looking closely, the API server is basically just a communication shuttle.</p>\n<p>Then you might think “Can’t we just communicate directly with PayPal servers?” but this is a problem directly connected to security. To communicate with PayPal servers, you need <code class=\"language-text\">client_key</code> and <code class=\"language-text\">secret</code>, and communicating directly with PayPal servers without mediating through the API server means the client must have both these values.</p>\n<p>But as you know, client source on the web is easily exposed, and even with obfuscation, <code class=\"language-text\">String</code> variables like Object <code class=\"language-text\">keys</code> are not obfuscated, so malicious users can easily steal <code class=\"language-text\">client_key</code> and <code class=\"language-text\">secret</code>. So you store <code class=\"language-text\">secret</code> on the relatively safe server and store only <code class=\"language-text\">client_key</code> on the client, splitting the two values so they can’t be seen at once.</p>\n<h2 id=\"execution-results\" style=\"position:relative;\">Execution Results<a href=\"#execution-results\" aria-label=\"execution results permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, as a result of proceeding with the create request through the API server, I was able to receive the following response.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ee391623f4d89ab9517f34c1a64c178c/5bb8b/result1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGUlEQVR42lWQ6U7DMBCE8zKotEmatInvM0ebFIQqJBAS7/8ew9oRVPz4tJ61tZ7ZgtsF7Unj3Dt0zIEJn+mYRc8fOpG0NBGKECpAyIDmZFDWCnWjUVYShVg+8HJfEccAJi2U9YQDV3Q2Dpq0tluVpOMU4YcI6wNsCCiPEk87ht2eY3/gKHh4zQ/OTNMvEsd2o/6tzaNWjUB1FKSJ09Zn0tBHlhIY7EuBQq2f2eHX94rxMoCTS6lddsuVyzq5TQjqC+op43OSnm994zy9SwPJobq8Y327YrlNdBFgfMxI7bN2YaB4cashYl5mzNeZoo+0ppF6yYTH80EQKfJ0zwPjtO2jPSu0nf6LnknxKHKZ4/5fSSKtIQ1LA38AHnLHaTWOUI4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result1\" title=\"\" src=\"/static/ee391623f4d89ab9517f34c1a64c178c/6af66/result1.png\" srcset=\"/static/ee391623f4d89ab9517f34c1a64c178c/69538/result1.png 160w,\n/static/ee391623f4d89ab9517f34c1a64c178c/72799/result1.png 320w,\n/static/ee391623f4d89ab9517f34c1a64c178c/6af66/result1.png 640w,\n/static/ee391623f4d89ab9517f34c1a64c178c/5bb8b/result1.png 749w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>I received an array called links, and the meaning of each index is:</p>\n<hr>\n<p><code class=\"language-text\">0</code> - URI of API where payment’s detailed information can be checked with GET method</p>\n<p><code class=\"language-text\">1</code> - URL that redirects to PayPal’s payment page</p>\n<p><code class=\"language-text\">2</code> - URL that can execute payment</p>\n<hr>\n<p>Now you can understand the meaning of <code class=\"language-text\">links[1]</code> explained above. And looking at the host of the sent URLs, they all start with <code class=\"language-text\">sandbox.*</code>, meaning we’re currently testing using a sandbox account. In actual production API, that sandbox part is removed.</p>\n<p>And now if we redirect to the URL of <code class=\"language-text\">links[1]</code>, naturally(…) those values will disappear into dust. You could store them in cookies or use them somehow, but since they’ll be sent again anyway, let’s throw them away without regret.</p>\n<p>I tried opening that page as a popup without redirecting, and could see the payment information gloriously perish while spitting out <code class=\"language-text\">401 Unauthorized</code>…</p>\n<p>But anyway, at the point when the <code class=\"language-text\">create</code> request was sent to PayPal, the <code class=\"language-text\">redirect_url</code> value I initially sent is stored on the PayPal server, so when the user completes payment confirmation on the PayPal page, control returns to my service again.</p>\n<p>Now let’s try redirecting.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 455px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHvTNpoX//EABoQAAICAwAAAAAAAAAAAAAAAAARAQIQEiH/2gAIAQEAAQUCLNGvYhY//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAABABESExMv/aAAgBAQAGPwIwupN2v//EABsQAAIDAAMAAAAAAAAAAAAAAAABESFBMWFx/9oACAEBAAE/IVpopPsXFjZtXOUQIbeiT//aAAwDAQACAAMAAAAQL8//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAwEBPxCn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAQEAAgMBAAAAAAAAAAAAAREAIVExQaFh/9oACAEBAAE/ECDHfOgzuAWZqGL+ZcDKwwfM3nHbN+G4et//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"redirect1\" title=\"\" src=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg\" srcset=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/0913d/redirect1.jpg 160w,\n/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/cb69c/redirect1.jpg 320w,\n/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg 455w\" sizes=\"(max-width: 455px) 100vw, 455px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Then this screen appears. If you’re not logged into PayPal, you’ll first move to the login page, and after login completes, you’ll move to this page.</p>\n<p>On this page, users can check the amount they’ll pay, and clicking the cart icon in the upper right shows more detailed information, though it’s written so briefly it’s hard to read, so there’s not much meaning.</p>\n<p>And the currency unit I sent in the request was a product registered in euros, but PayPal automatically converts to the user’s country’s exchange rate. Now when the user checks all items and clicks the <code class=\"language-text\">Continue</code> button, movement to the <code class=\"language-text\">redirect_url</code> I sent during initial <code class=\"language-text\">create</code> starts.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVR42q2SywrCMBBF+///pOKuUv0AKdq6KNjaPBsSbRbXJOBCUBOjiwMhMxxyJ1PM84wYk1JQjnd1a22oc85RUMaQAkvsSxbSfwkJpRgJCfjzT0IvkFLCaB2QUoDkCr1MCIH9ocF6U2FVVqiPbbj79NK40EmW5Q6Lcou6OeULH9LJRb4ajZsxIX5sjkWs4etP4S4Ccwv5iqy16boO575HPwxPXMYxS3gHfvlCUe7xvscAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"redirect2\" title=\"\" src=\"/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png\" srcset=\"/static/b34365fda4b25226be0676994e510290/69538/redirect2.png 160w,\n/static/b34365fda4b25226be0676994e510290/72799/redirect2.png 320w,\n/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png 448w\" sizes=\"(max-width: 448px) 100vw, 448px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>This page is one I temporarily made for testing, and if it were an actual production server, this page would be the last page where information can be confirmed before final payment.\nWhat should be noted at this time is this page’s URL.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b7ad2e818105d647d8e8498a1af1e86b/9f82e/url.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 2.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42mN4/vz5fxB++fIlGIPY796+/X/95q3/Nd1T/tf1Tf1f1wvCUyB0HwQ39E37X9bW93/fkeP/v3/98n/d9t3/O6bN/Q8AULA+Y3mH7csAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"url\" title=\"\" src=\"/static/b7ad2e818105d647d8e8498a1af1e86b/6af66/url.png\" srcset=\"/static/b7ad2e818105d647d8e8498a1af1e86b/69538/url.png 160w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/72799/url.png 320w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/6af66/url.png 640w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/9f82e/url.png 820w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>As query strings, PayPal sent <code class=\"language-text\">paymentId</code>, <code class=\"language-text\">token</code>, and <code class=\"language-text\">PayerID</code>. Now using those values, proceed with the next flow.</p>\n<p>This page’s Controller consists of methods with logic to receive detailed payment information and execute payment using those values. If you don’t remember the Paypal service logic defined above, go back and look at it again.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n  <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app.pages.product'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalRedirectController'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Restangular'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$location'</span><span class=\"token punctuation\">,</span>\n    PaypalRedirectController\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/** @ngInject */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalRedirectController</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">$rootScope<span class=\"token punctuation\">,</span> Restangular<span class=\"token punctuation\">,</span> PaypalService<span class=\"token punctuation\">,</span> $location</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> vm <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> queryString <span class=\"token operator\">=</span> $location<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Get query string sent by PayPal</span>\n\n    vm<span class=\"token punctuation\">.</span>init <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>init<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @public\n     * @method executePaypal\n     */</span>\n    vm<span class=\"token punctuation\">.</span>executePaypal <span class=\"token operator\">=</span> executePaypal<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">executePaypal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Actual payment execution method</span>\n      PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'EXECUTE RESULT -> '</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @private\n     * @method getPaymentInfo\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Method to receive payment information</span>\n      PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET PAYMENT INFO -> '</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I hooked the <code class=\"language-text\">excutePaypal</code> method as a click event on the button on that page.\nNow when the user clicks that button, final payment is executed and results can be received as <code class=\"language-text\">response</code>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 381px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 198.12500000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAoABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB8+dyyAdIoQ0Vocwf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAECEDH/2gAIAQEAAQUCXHkldFzJHklLP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BX//EABcQAAMBAAAAAAAAAAAAAAAAAAAwMVH/2gAIAQEABj8C0jv/xAAfEAACAgEEAwAAAAAAAAAAAAAAAREhQRAxcZFRYYH/2gAIAQEAAT8halBpwT5PptGay70eKIfJXkk6Eh4J9C7syOOyD//aAAwDAQACAAMAAAAQczmzgD//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPxAr/8QAFxEAAwEAAAAAAAAAAAAAAAAAARAxIP/aAAgBAgEBPxA3Bq//xAAfEAEAAgICAgMAAAAAAAAAAAABABEhMUGRUWFxgaH/2gAIAQEAAT8QqYKrqVk9waSnkdx5FaYg1PIqYtt5+4W0eY7cj4NSoVEYN3FWih5S5bw6iUBfERKg6xb8lvfU/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"\" src=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg\" srcset=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/0913d/result.jpg 160w,\n/static/0a41c8ee9d6bbef09c3fee2378861cec/cb69c/result.jpg 320w,\n/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg 381w\" sizes=\"(max-width: 381px) 100vw, 381px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Payment proceeded normally and this is the result sent by PayPal server. If <code class=\"language-text\">payer.status</code> is <code class=\"language-text\">approved</code>, payment was approved normally. Now it’s time to check whether payment was actually approved and money came in properly.</p>\n<p>Accessing PayPal’s <a href=\"https://www.sandbox.paypal.com/\" target=\"_blank\" rel=\"nofollow\">sandbox page</a> and checking with the buyer account, you can see that 12 euros was withdrawn normally in the purchase history. The seller account also shows that 12 euros came in normally.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 607px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42o3OTW8SURSH8flCzlBe09agqWnVFu2LKahtYtRSbSkWxW7cunHp3sSVG6VAtUCBDgMYFyaamLhuU4jWBBppOiAzBeHxQt0YXXiSX87Jvbn/e6TBRzk8L95x9omGM6jiCqmiZ3EEstiX0lj9KawLKQZuCTeTKPOvkWcjKHNvsFyLo/jiyN44A7MxTs1EkS480/B/rOJNfGI4lOT8mspIKMPIahrHYlIECgtJEbYpJLD4IlgnniOLMNf1KDbfOoo3insuijITQXI/fo/n5WfOPf2Aa6XIcLDAUEBj8K6KdTGHfbmA7U4em18TW+Zwiu5eymO9sc1pf54hcWafz3LmtobtahrJ4llFvhhAHl/BcknME0HsUw9wXVnDOR3uc00/xDkVxnH5Ps5JcTcZxjp+D3lsGXn0hDIawDIWQEpsbZHKZvp682YqRWY7Sy6voQr5YpH1jQ1exWIU3hbFWQ61oJHJqSTSaZKZ37InpHa7zdGRTrNp0KtuF1qd/ohpmvTu/6e64mGPpOt1yuUy1YMDmobRD+h0OtSNFjtfvlEq7bFXKvF1f7/ve632h9rhIZVqlZ3dXfR6A8k0W1Qq1b82MVs/0X8Y6LpOvdHAENv2Pmwa5j/1wgzzmF+1GNs2Kr/V5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"customer\" title=\"\" src=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png\" srcset=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/69538/customer.png 160w,\n/static/96ceab0902c02bc5b934f2ff0b0154d5/72799/customer.png 320w,\n/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png 607w\" sizes=\"(max-width: 607px) 100vw, 607px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Sandbox's purchase test account. 12 euros were withdrawn.</small>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACTElEQVR42l1Ta2/TQBD0//9FCEEpjSiUqmkFaQlOHZ/fbyf22Y6fGeZO6YdiabR7q9vx7OOMRtZwLROR5+BhY+Fm/Rc3D1tc37/g25OJz3fPWPG8Wm9xdf+M9cseTdejbk4asn0PI4wTmLsdItov3x9xdfuIj6s1ru9+4+rHL9oNPqwe8On2CV9/bnBzv4EpAuwIZbd7/x2MXpY4RhZk5qHNHPSFg2U8QX3LMuNMKDvPM8bpzZ/Q9yOGYcL/n3E69QiCEGEUIY5TeJ4Px3V5jiGbFrVstD3WDbJSskwVa5EfJMqqxTQv72CM04S8PKI4VDopzUvEac7kA8YFGtOZoJ3Pl/PFn5YzTuN8wYKeFRh1XcN2PbhU5gYJexPDtCM4QYo/OxfbV58/O6K5NL3p3tBTYYO9m0D4GfMiROmBhCxpszWZLGDuPXhRCjeMaRP49IMk18iZXNQtClrtEyXPyk8PNZKyRiU7GF0/4FV4iApJtDg0vYYcFo286pggkR1bJikrNUletZrECnKIpMJrUCLMjjAG9rDgpYB9S1Ufm06r86JMK1DqLMfXaoXP4WUlLC+FaQm2KsCRqiq2QuUkWQFjImHXtnCEQMxJj8OAKAzhOAJFkSOKQqRpQhTYCx8lyxMkrCr2VUrMzJd8HMK2kaUpDBWoakkCB3GScLcGhGqNSNp2HRLGfN9HEFKhG6IoWR4Hp/ZyUrs5jlCDFRSUZRkJGaw4GBWI+VrUBUUmhK0vqksu99IPE+5noBVaTsLdDbSqvme/qdS2FWGKf8URhCdIghH3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"provider\" title=\"\" src=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png\" srcset=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/69538/provider.png 160w,\n/static/24e9af9f9c7012c52f8780e1280f8c5c/72799/provider.png 320w,\n/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Sandbox's sales test account. 12 euros came in with my name at the top.</small>\n</center>\n<p>But since complete processing hasn’t been done yet, Payment status is <code class=\"language-text\">Unclaimed</code>. It’s not cashed yet, just a piece of data sitting on the PayPal server.\nNow when clicking the Accept button to proceed with deposit to the seller’s account, the status changes to <code class=\"language-text\">Completed</code> and <code class=\"language-text\">12EUR</code> is deposited converted to <code class=\"language-text\">USD</code> into the account.</p>\n<p>That’s all for this post on Express Checkout.</p>","fields":{"slug":"20170514-paypal-express-checkout-en","path":"/2017/05/14/paypal-express-checkout/en/","lang":"en"},"frontmatter":{"title":"Using PayPal's Express Checkout RESTful API","subTitle":"How to Implement PayPal Payment Integration?","date":"May 14, 2017","categories":["Programming","Tutorial"],"tags":["JavaScript","Paypal","Angular","AngularJS","Laravel","PHP","Tutorial","Payment Integration"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/617e08b28c22d787f8450e2ec114cc93/3a812/thumbnail.jpg","srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/3a812/thumbnail.jpg 320w,\n/static/617e08b28c22d787f8450e2ec114cc93/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/fc5c5/thumbnail.webp 320w,\n/static/617e08b28c22d787f8450e2ec114cc93/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/617e08b28c22d787f8450e2ec114cc93/2d839/thumbnail.jpg","srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"947de425-1f56-5ddf-92ad-085b106c0fef","tableOfContents":"<ul>\n<li><a href=\"#declaring-necessary-constants\">Declaring Necessary Constants</a></li>\n<li><a href=\"#declaring-the-mover-class\">Declaring the Mover Class</a></li>\n<li><a href=\"#rendering-mover-objects\">Rendering Mover Objects</a></li>\n<li><a href=\"#moving-mover-objects\">Moving Mover Objects</a></li>\n</ul>","excerpt":"In this post, following the previous post, I’m going to directly implement gravity with JS. The development environment uses JavaScript ES7, babel, Webpack, and Three.js.","html":"<p>In this post, following <a href=\"/2017/05/06/gravity-via-js-1\">the previous post</a>, I’m going to directly implement gravity with JS. The development environment uses JavaScript ES7, babel, Webpack, and Three.js.</p>\n<!-- more -->\n<h2 id=\"declaring-necessary-constants\" style=\"position:relative;\">Declaring Necessary Constants<a href=\"#declaring-necessary-constants\" aria-label=\"declaring necessary constants permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, I’ll declare the constant values to use in the program.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">framerate</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">G</span><span class=\"token operator\">:</span> <span class=\"token number\">250</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Gravitational constant as I please</span>\n  <span class=\"token constant\">START_SPEED</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Objects' speed during initialization</span>\n  <span class=\"token constant\">OBJECT_COUNT</span><span class=\"token operator\">:</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Number of objects to render after initialization</span>\n  <span class=\"token constant\">TRACE_LENGTH</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Length of objects' movement trajectory</span>\n  <span class=\"token constant\">MIN_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Minimum mass of objects</span>\n  <span class=\"token constant\">MAX_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Maximum mass of objects</span>\n  <span class=\"token constant\">DENSITY</span><span class=\"token operator\">:</span> <span class=\"token number\">0.15</span> <span class=\"token comment\">// Density at which objects are rendered</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">SPHERE_SIDES</span> <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, I set the gravitational constant <code class=\"language-text\">G</code>, which originally has a small value of <code class=\"language-text\">6.6742e-11</code>, to <code class=\"language-text\">250</code>, because the masses of objects appearing in the simulation I’m making are too small.</p>\n<p>To apply the actual gravitational constant while still having gravitational influence visible to the eye, the mass would also need to be planet-sized, but that would make calculations too difficult, so I adjusted by reducing object mass and increasing the gravitational constant.</p>\n<p><code class=\"language-text\">MASS_FACTOR</code> is a constant I declared to compensate because when rendering later, I’m trying to set sphere size proportional to object mass, but since mass values are <code class=\"language-text\">400-3000</code>, the sphere volume would become too large.</p>\n<p>It’s a feeling similar to a compression ratio. When defining sphere size later, I’ll multiply the object’s mass by <code class=\"language-text\">MASS_FACTOR</code> to reduce size at a constant ratio.</p>\n<p>Since this post is not for explaining ThreeJS, I’ll skip over <code class=\"language-text\">Scene</code> and <code class=\"language-text\">Renderer</code> declaration and initialization.</p>\n<h2 id=\"declaring-the-mover-class\" style=\"position:relative;\">Declaring the Mover Class<a href=\"#declaring-the-mover-class\" aria-label=\"declaring the mover class permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now let’s implement the things that will actually move. I wanted to name it Object, but as you know, the name Object is already taken by a Built-in Object in JS. So after agonizing over another name, I just called it <code class=\"language-text\">Mover</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/constants'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n Vector3<span class=\"token punctuation\">,</span> SphereGeometry<span class=\"token punctuation\">,</span> Line<span class=\"token punctuation\">,</span>\n MeshPhongMaterial<span class=\"token punctuation\">,</span> PointLight<span class=\"token punctuation\">,</span> Mesh<span class=\"token punctuation\">,</span> Geometry\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'three'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>uid <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mover-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> velocity<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> mass<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>alive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SphereGeometry</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>vertices <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Line</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MeshPhongMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">specular</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">shininess</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mesh</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>castShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>receiveShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentScene <span class=\"token operator\">=</span> scene<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Objects created with the <code class=\"language-text\">Mover</code> class have random mass, speed, and position values received when <code class=\"language-text\">constructor</code> executes. And it initializes the <code class=\"language-text\">acceleration</code> value representing acceleration. Since acceleration is a speed moving in some direction, I declared it as a vector with 3 elements.</p>\n<p>And when collision detection occurs between <code class=\"language-text\">Movers</code>, I plan to merge two <code class=\"language-text\">Movers</code> into one to make a <code class=\"language-text\">Mover</code> with larger mass, so I declared an <code class=\"language-text\">alive</code> member variable to determine whether that Mover is dead or alive.</p>\n<h2 id=\"rendering-mover-objects\" style=\"position:relative;\">Rendering Mover Objects<a href=\"#rendering-mover-objects\" aria-label=\"rendering mover objects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Then I wrote logic in <code class=\"language-text\">Scene</code> to draw <code class=\"language-text\">Movers</code> during initialization.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>movers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Initialize movers list</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>selectionLight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    movers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MOVER_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> mass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MIN_MASS</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_MASS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxDistance <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">DENSITY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxSpeed <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">START_SPEED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> velocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Create Mover with random speed, position, mass</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Mover</span><span class=\"token punctuation\">(</span>mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Put Mesh, Line, Light objects created when Mover initialized into Scene</span>\n    movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span><span class=\"token function\">addMover</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers <span class=\"token operator\">=</span> movers<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span> max</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now <code class=\"language-text\">Scene</code> has <code class=\"language-text\">movers</code>, which is a list containing multiple <code class=\"language-text\">Movers</code>. Now we just calculate during rendering and we’re done! But…\nAs I said in the previous post, n-body problems for finding gravity for multiple objects have no solution.</p>\n<p>So we need to make logic that traverses <code class=\"language-text\">movers</code> and calculates gravity with other <code class=\"language-text\">Movers</code> as two-body problems each time we traverse.</p>\n<h2 id=\"moving-mover-objects\" style=\"position:relative;\">Moving Mover Objects<a href=\"#moving-mover-objects\" aria-label=\"moving mover objects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\nmovers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o1<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>o1<span class=\"token punctuation\">.</span>alive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o2<span class=\"token punctuation\">,</span> j</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> o2<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> i <span class=\"token operator\">!==</span> j<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Distance from o1 -> o2</span>\n      <span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> o1<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">distanceTo</span><span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// o1, o2's radii r1, r2</span>\n      <span class=\"token keyword\">const</span> r1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> r2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">&lt;=</span> r1 <span class=\"token operator\">+</span> r2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If their distance is less than or equal to the sum of their radii, judge as collision and merge the two objects</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If not collision, just make them move</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">attract</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>First, I made collision detection while traversing all <code class=\"language-text\">Movers</code> like this. The <code class=\"language-text\">Mover</code> class’s <code class=\"language-text\">eat</code> method has logic to merge two <code class=\"language-text\">Movers</code> that had collision detection into one, and the <code class=\"language-text\">attract</code> method measures gravity at the current distance of the two objects and adds it to the <code class=\"language-text\">Mover</code>’s acceleration.</p>\n<p>After all calculations finish, I updated the <code class=\"language-text\">Mover</code>’s position, size, speed, direction, etc. The <code class=\"language-text\">Gravity</code> class’s <code class=\"language-text\">calcGravity</code> method is exactly the same logic I wrote in <a href=\"/2017/05/06/gravity-via-js-1\">the previous post</a>.</p>\n<p>Methods related to <code class=\"language-text\">Mover</code>’s motion are as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newMass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> newLocation <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> newVelocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> newLocation<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> newVelocity<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> newMass<span class=\"token punctuation\">;</span>\n\n    otherMover<span class=\"token punctuation\">.</span><span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">attract</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> force <span class=\"token operator\">=</span> Gravity<span class=\"token punctuation\">.</span><span class=\"token function\">calcGravity</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> otherMover<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span><span class=\"token constant\">G</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span>force<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">force</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> f <span class=\"token operator\">=</span> force<span class=\"token punctuation\">.</span><span class=\"token function\">divideScalar</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Apply force to mover's acceleration</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Add acceleration to velocity</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Add velocity to position to move</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">multiplyScalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Reset acceleration</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Apply position to mover's mesh object</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>To summarize, every frame we traverse the <code class=\"language-text\">movers</code> list, calculate gravity between each <code class=\"language-text\">Movers</code>, apply acceleration, and actually move the <code class=\"language-text\">Mover</code>. The full source can be checked in the <a href=\"https://github.com/evan-moon/3d-gravity-test\" target=\"_blank\" rel=\"nofollow\">gravity test project GitHub repository</a>.</p>\n<p>That’s all for this post on implementing gravity with JavaScript.</p>","fields":{"slug":"20170506-gravity-via-js-2-en","path":"/2017/05/06/gravity-via-js-2/en/","lang":"en"},"frontmatter":{"title":"[Implementing Gravity with JavaScript] 2. Coding","subTitle":"Gravity Simulation Applying the Law of Universal Gravitation","date":"May 06, 2017","categories":["Programming","Graphics"],"tags":["Implementing Gravity","Gravity","JavaScript","WebGL","Math","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/fc5c5/thumbnail.webp 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"29465098-3c06-5f9d-8576-0b50982f304c","tableOfContents":"<ul>\n<li><a href=\"#what-is-gravity\">What is Gravity?</a></li>\n<li><a href=\"#so-how-to-implement\">So How to Implement?</a></li>\n</ul>","excerpt":"In this post, I’m going to implement gravity using the law of universal gravitation. Not gravity acting in one direction on the ground surface, but I plan to make a simulation where I scatter multiple objects with random masses at random coordinates and observe how they interfere with each other’s motion.","html":"<p>In this post, I’m going to implement gravity using the law of universal gravitation. Not gravity acting in one direction on the ground surface, but I plan to make a simulation where I scatter multiple objects with random masses at random coordinates and observe how they interfere with each other’s motion.</p>\n<!-- more -->\n<h2 id=\"what-is-gravity\" style=\"position:relative;\">What is Gravity?<a href=\"#what-is-gravity\" aria-label=\"what is gravity permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, since this post is aimed at people like me who are <strong>not familiar with mathematics</strong> rather than physics majors, I want to properly establish the concept of gravity before moving on.</p>\n<p>Newton said that gravity is the force by which two objects with mass attract each other.</p>\n<p>In fact, while Newton figured out how gravity works by creating the formula for the law of universal gravitation, he didn’t know why gravity occurs. He probably passed it off as “only God would know…”\nAnd Newton said that objects with mass have gravity, which means that light has no mass and is therefore not affected by gravity at all.</p>\n<p>However, according to facts revealed in modern times, light is also affected by gravity. Didn’t we see this in the movie Interstellar? <small>(While it may not be a 100% accurate visual depiction, theoretical physicist Kip Thorne calculated general relativity and visualized it in 3D.)</small></p>\n<p>In places with tremendous gravity like black holes, this phenomenon is noticeably observed, and this is called gravitational lensing.</p>\n<center>\n  <img src=\"/59d205c9bdb4c3be36f94bb8b25cddf1/gravity-lens.gif\" alt=\"gravity lens\" width=\"100%\">\n  <br>\n  <small>Bending of light passing behind a black hole</small>\n  <br>\n  <br>\n</center>\n<p>Gravity came to be defined in Einstein’s general relativity in 1915 as the bending of spacetime by energy. So when the mass of an object in spacetime rapidly increases or decreases, waves are created in spacetime, and this is gravitational waves, which were discovered early last year.</p>\n<p>Gravitational waves generated like this are said to move at the same speed as light. So if the sun suddenly disappeared from the solar system with a poof!, the planets orbiting around the sun wouldn’t immediately escape their orbits and fly away.</p>\n<p>For example, in Earth’s case, since light from the sun takes about 8 minutes and 20 seconds to reach Earth, even if the sun suddenly disappeared, for about 8 minutes we would continue orbiting the position where the vanished sun was.\nThen 8 minutes later, the moment the last light that left the sun reaches Earth, Earth would break orbit.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/434fed24de68a2e16a016af2e5c94459/29d31/gravity.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeHeFkA//8QAGBABAAMBAAAAAAAAAAAAAAAAAQACEBH/2gAIAQEAAQUCqTho5//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAABEDERQVH/2gAIAQEAAT8hRbHg0O4Z2P/aAAwDAQACAAMAAAAQQw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAxEKH/2gAIAQEAAT8QY05wyqSrJPuipy4zWKTz/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"gravity\" title=\"\" src=\"/static/434fed24de68a2e16a016af2e5c94459/c08c5/gravity.jpg\" srcset=\"/static/434fed24de68a2e16a016af2e5c94459/0913d/gravity.jpg 160w,\n/static/434fed24de68a2e16a016af2e5c94459/cb69c/gravity.jpg 320w,\n/static/434fed24de68a2e16a016af2e5c94459/c08c5/gravity.jpg 640w,\n/static/434fed24de68a2e16a016af2e5c94459/29d31/gravity.jpg 700w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Objects with larger mass bend spacetime more</small>\n</center>\n<p>This doesn’t mean the law of universal gravitation was wrong; rather, the theory of relativity is closer to complementing what the law of universal gravitation missed. In fact, if it’s not a space with very large gravity <small>(a very bent space)</small>, the law of universal gravitation can explain it sufficiently.</p>\n<p>For example, Earth is a large sphere overall, but when we who live on Earth look around, we can’t tell whether it’s a sphere or a plane. Similarly, a space where the degree of bending is so small that it’s almost similar to Euclidean space is called pseudo-Euclidean space. And in such pseudo-Euclidean space, applying only the law of universal gravitation is sufficient. They say that even when sending the Apollo spacecraft to the moon, the law of universal gravitation alone was enough.</p>\n<p>In conclusion, finding gravity can be seen as finding the curvature of spacetime, but the simple simulation I’m trying to make is simulating situations within a very small pseudo-Euclidean space, and since it’s not a program applied to reality but literally a simulation, it can be sufficiently implemented with just the law of universal gravitation.</p>\n<h2 id=\"so-how-to-implement\" style=\"position:relative;\">So How to Implement?<a href=\"#so-how-to-implement\" aria-label=\"so how to implement permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, to explain easily, let’s assume we scatter 2 objects with random masses at random coordinates with random directions and speeds into space.\nCalculating the gravitational influence of these 2 objects is not very difficult. This is where the law of universal gravitation appears.</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>F</mi><mn>12</mn></msub><mo>=</mo><mo>−</mo><mi>G</mi><mfrac><mrow><msub><mi>m</mi><mn>1</mn></msub><msub><mi>m</mi><mn>2</mn></msub></mrow><mrow><mi mathvariant=\"normal\">∣</mi><msup><mrow><msub><mi>r</mi><mn>12</mn></msub><mi mathvariant=\"normal\">∣</mi></mrow><mn>2</mn></msup></mrow></mfrac><mover accent=\"true\"><msub><mi>r</mi><mn>12</mn></msub><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">F_{12} = -G{\\frac{m_1 m_2}{\\vert{r_{12}\\vert}^2}}\\hat{r_{12}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.2016em;vertical-align:-1.094em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">G</span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.156em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.954em;\"><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.094em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>This formula calculates the gravitational force <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> that object 1 exerts on object 2. Here <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span></span> means the <a href=\"https://ko.wikipedia.org/wiki/%EC%A4%91%EB%A0%A5_%EC%83%81%EC%88%98\" target=\"_blank\" rel=\"nofollow\">gravitational constant</a>, and this gravitational constant is fixed at <code class=\"language-text\">6.67384 * 10^-11</code>.</p>\n<p>And <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">m_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">m_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> in the numerator are the masses of each object, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>r</mi><mn>12</mn></msub></mrow><annotation encoding=\"application/x-tex\">r_{12}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> in the denominator means the <a href=\"https://ko.wikipedia.org/wiki/%EC%9C%A0%ED%81%B4%EB%A6%AC%EB%93%9C_%EA%B1%B0%EB%A6%AC\" target=\"_blank\" rel=\"nofollow\">Euclidean distance</a> between these objects. And the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span> multiplied at the end means the unit vector from object 1 looking toward object 2.</p>\n<p>The point of this formula is that the distance between objects is in the denominator and the masses of the two objects are in the numerator.</p>\n<p>This means that as the distance between two objects increases, the denominator gets larger so the result value becomes smaller, and as the masses of the two objects increase, the numerator gets larger so the result value becomes larger. Simply put, gravity is <strong>inversely proportional to the distance between two objects and directly proportional to the product of the masses of the two objects</strong>.</p>\n<p>For those who haven’t studied linear algebra, simply understanding that a vector means a direction in space should be sufficient. Since the space we’re trying to calculate is 3-dimensional space, vectors have 3 coordinate values: <code class=\"language-text\">(x, y, z)</code>.</p>\n<p>The law of universal gravitation we learned when we were young has the form:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>F</mi><mo>=</mo><mi>G</mi><mfrac><mrow><msub><mi>m</mi><mn>1</mn></msub><msub><mi>m</mi><mn>2</mn></msub></mrow><msup><mi>r</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding=\"application/x-tex\">F = G\\frac{m_1 m_2}{r^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.7936em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>The result of this formula has scalar values like <code class=\"language-text\">1</code>, <code class=\"language-text\">5.2</code>, or <code class=\"language-text\">1204</code>. Since scalars only represent physical quantities, you can know how strong gravity is but can’t know the direction of gravity.</p>\n<p>So we need to express the direction of force to properly use this formula, which is why we multiply by a vector at the end.</p>\n<p>And the reason <code class=\"language-text\">-1</code> is attached at the very front of the formula is because of the vector’s direction. The vector we multiplied at the end is the direction from object 1 toward object 2. But gravity is a force that pulls toward me, not a pushing force, so the direction of force should be from object 2 toward object 1. That’s why we multiply by <code class=\"language-text\">-1</code> again in the above formula.</p>\n<p>It looks a bit complicated, but when actually implemented in code, it’s simple. I proceeded with vector calculations using <a href=\"https://threejs.org/\" target=\"_blank\" rel=\"nofollow\">ThreeJS</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Vector3 <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'three'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">calcGravity</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o1<span class=\"token punctuation\">,</span> o2<span class=\"token punctuation\">,</span> <span class=\"token constant\">G</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Find the difference between o1's position vector and o2's position vector to get the vector looking from o1 -> o2.</span>\n  <span class=\"token keyword\">let</span> force <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subVectors</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">,</span> o2<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Find the length of the direction vector obtained above and convert to absolute value.</span>\n  <span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>force<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Convert the direction vector obtained above to a unit vector.</span>\n  force <span class=\"token operator\">=</span> force<span class=\"token punctuation\">.</span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Get gravity scalar</span>\n  <span class=\"token keyword\">const</span> strength <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token constant\">G</span> <span class=\"token operator\">*</span> o1<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">*</span> o2<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>distance <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Multiply the direction vector by the gravity scalar obtained above</span>\n  force <span class=\"token operator\">=</span> force<span class=\"token punctuation\">.</span><span class=\"token function\">multiplyScalar</span><span class=\"token punctuation\">(</span>strength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> force<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now if we keep adding the value from here to the position value of the current object being calculated, the object will move in that direction. But the problem is that in reality we’re not just going to scatter 2 objects.</p>\n<p>That law of universal gravitation is considering and calculating only the gravity between 2 objects. Then can we also calculate multiple objects’ gravity influencing and receiving influence from each other?</p>\n<p>Unfortunately, such <a href=\"https://ko.wikipedia.org/wiki/%EB%8B%A4%EC%B2%B4_%EB%AC%B8%EC%A0%9C\" target=\"_blank\" rel=\"nofollow\">n-body problems</a> are one of the most difficult problems in mathematical physics, and in 1887, Henri Poincaré said it was impossible to find a general solution to three-body or greater problems. So we have no choice but to approximately calculate gravity using the two-body problem’s law of universal gravitation above.</p>\n<p>In <a href=\"/2017/05/06/gravity-via-js-2\">the next post</a>, I plan to implement a simple gravity model sample in code. That’s all for the first post on implementing gravity with JavaScript.</p>","fields":{"slug":"20170506-gravity-via-js-1-en","path":"/2017/05/06/gravity-via-js-1/en/","lang":"en"},"frontmatter":{"title":"[Implementing Gravity with JavaScript] 1. What is Gravity?","subTitle":"How Does Gravity Bend Space?","date":"May 06, 2017","categories":["Programming","Graphics"],"tags":["Implementing Gravity","Gravity","JavaScript","WebGL","Math","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/fc5c5/thumbnail.webp 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"242399b1-5837-5746-abe2-dcfa60792881","tableOfContents":"<ul>\n<li>\n<p><a href=\"#checking-the-keplerian-element-data\">Checking the Keplerian Element Data</a></p>\n<ul>\n<li><a href=\"#examining-the-orbital-element-data\">Examining the Orbital Element Data</a></li>\n<li><a href=\"#orbital-elements-measured-at-the-j2000-epoch\">Orbital Elements Measured at the J2000 Epoch</a></li>\n<li><a href=\"#rate-of-change-per-century\">Rate of Change Per Century</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#finding-earths-current-orbit-and-position\">Finding Earth’s Current Orbit and Position</a></p>\n<ul>\n<li><a href=\"#calculating-earths-current-orbital-elements\">Calculating Earth’s Current Orbital Elements</a></li>\n<li><a href=\"#where-is-earth-in-its-orbit\">Where Is Earth in Its Orbit?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, continuing from the previous post, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it.","html":"<p>In this post, continuing from the <a href=\"/2017/05/03/calculate-orbit-1/en\">previous post</a>, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it.</p>\n<!-- more -->\n<h2 id=\"checking-the-keplerian-element-data\" style=\"position:relative;\">Checking the Keplerian Element Data<a href=\"#checking-the-keplerian-element-data\" aria-label=\"checking the keplerian element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The method for calculating an orbit using Keplerian elements is the same regardless of the celestial body, so in this post let’s calculate the orbit of the planet most familiar to us — Earth.</p>\n<p>NASA’s <a href=\"https://ssd.jpl.nasa.gov/planets/approx_pos.html\" target=\"_blank\" rel=\"nofollow\">Jet Propulsion Laboratory (JPL)</a> provides Keplerian element data for planets in the solar system, and I’ll use this data directly to calculate Earth’s orbit.</p>\n<p>JPL provides three sets of orbital data, each serving different purposes depending on the calculation goal and required precision:</p>\n<hr>\n<ul>\n<li>Table 1: Keplerian elements and their rates of change, referenced to the mean ecliptic and equinox. Valid for predictions between 1800 AD and 2050 AD. Ignores long-term orbital element variations but is simple and fast to compute.</li>\n<li>Table 2a: Measured using the same reference as Table 1, but valid for predictions between 3000 BC and 3000 AD. Because it covers a wider time range, additional correction terms from Table 2b must be applied for orbital calculations from Jupiter through Neptune.</li>\n<li>Table 2b: Correction terms for the mean anomaly calculations of Jupiter, Saturn, Uranus, and Neptune in Table 2a. These terms account for gravitational perturbations, interplanetary interactions, and general relativistic effects.</li>\n</ul>\n<hr>\n<p>Tables 2a and 2b are for high-precision calculations needed for things like space exploration. Massive planets like Jupiter have significant gravitational effects on other bodies, requiring separate correction values for better precision.</p>\n<p>Since my goal is just a simple simulation rather than high-precision calculation, the elements from Table 1 are more than sufficient.</p>\n<h3 id=\"examining-the-orbital-element-data\" style=\"position:relative;\">Examining the Orbital Element Data<a href=\"#examining-the-orbital-element-data\" aria-label=\"examining the orbital element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Table 1 provides Keplerian element values measured at the epoch J2000 — January 1, 2000, at noon (Julian calendar) — along with the rate of change per century. The orbital element data given in this table is as follows:</p>\n<hr>\n<ol>\n<li>Semi-major axis (<code class=\"language-text\">a</code>): In AU.</li>\n<li>Eccentricity (<code class=\"language-text\">e</code>): In radians.</li>\n<li>Inclination (<code class=\"language-text\">I</code>): In degrees.</li>\n<li>Mean longitude (<code class=\"language-text\">L</code>): In degrees.</li>\n<li>Longitude of perihelion (<code class=\"language-text\">long.peri.</code>): In degrees.</li>\n<li>Longitude of the ascending node (<code class=\"language-text\">long.node</code>): In degrees.</li>\n</ol>\n<hr>\n<p>JPL provides data for all solar system planets, but since this post aims to explain the orbital calculation process simply, we only need to look at the row labeled EM Bary, which is Earth’s orbital element. <small>(EM Bary stands for Earth/Moon Barycenter — the center of mass between Earth and the Moon.)</small></p>\n<p>Let’s look at Earth’s orbital elements from Table 1. The data is divided into values measured at the J2000 epoch and the rate of change per century.</p>\n<h3 id=\"orbital-elements-measured-at-the-j2000-epoch\" style=\"position:relative;\">Orbital Elements Measured at the J2000 Epoch<a href=\"#orbital-elements-measured-at-the-j2000-epoch\" aria-label=\"orbital elements measured at the j2000 epoch permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>J2000 refers to noon on January 1, 2000, in the Julian calendar. The time at which the reference observation for planetary orbital elements was made is called the epoch.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.00000261</td>\n<td>0.01671123</td>\n<td>-0.00001531</td>\n<td>100.46457166</td>\n<td>102.93768193</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"rate-of-change-per-century\" style=\"position:relative;\">Rate of Change Per Century<a href=\"#rate-of-change-per-century\" aria-label=\"rate of change per century permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>These values represent how much the orbital elements have changed over one century. Using these, we can calculate what Earth’s orbital elements look like at the time of writing this post — May 3, 2017, at 10:27 PM.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0.00000562</td>\n<td>-0.00004392</td>\n<td>-0.01294668</td>\n<td>35999.37244981</td>\n<td>0.32327364</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<p>Now let’s use these values to calculate where Earth is currently positioned in its orbit.</p>\n<h2 id=\"finding-earths-current-orbit-and-position\" style=\"position:relative;\">Finding Earth’s Current Orbit and Position<a href=\"#finding-earths-current-orbit-and-position\" aria-label=\"finding earths current orbit and position permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Looking at the data above, you’ll notice that two of the Keplerian elements explained in the previous post are missing: the argument of periapsis and the time of periapsis passage. But this isn’t a problem.</p>\n<p>For the argument of periapsis — since it simply means how far the perihelion is from the ascending node — it can be calculated from the longitude of perihelion and longitude of the ascending node that we already have. However, in this post we’ll only be finding the planet’s position on the 2D orbital plane, so we don’t actually need to calculate the argument of periapsis (which is used for determining the orbit’s orientation in 3D space).</p>\n<p>As for the time of periapsis passage, it’s essentially a time reference for finding where a planet is located at a given moment. Since the JPL data provides both values measured at J2000 and the rate of change per century, the evolution of orbital elements over time is already accounted for.</p>\n<p>The key to calculating a planet’s position in its orbit around the Sun is: compute the <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>)</a> and the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>)</a> from the orbital elements, then derive the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates on the orbital plane.</p>\n<p>We don’t need the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span></span> coordinate at this stage because once we find the planet’s position on the orbital plane, applying the inclination (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span></span>), longitude of the ascending node (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Ω</mi></mrow><annotation encoding=\"application/x-tex\">\\Omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Ω</span></span></span></span></span>), and argument of periapsis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) to place the orbit in 3D space will naturally yield the planet’s 3D position.</p>\n<p>The important question is whether we can derive the mean anomaly and eccentric anomaly from the given data — and as mentioned, the values we have are more than sufficient.</p>\n<p>Let’s get started with the calculations.</p>\n<h3 id=\"calculating-earths-current-orbital-elements\" style=\"position:relative;\">Calculating Earth’s Current Orbital Elements<a href=\"#calculating-earths-current-orbital-elements\" aria-label=\"calculating earths current orbital elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the JPL data consists of orbital element values measured at J2000 and the rate of change per century.</p>\n<p>So to find the current orbital element values, we need to determine how many centuries have passed since J2000, then multiply the rate of change per century by that value to adjust the final orbital elements.</p>\n<p>To make calculations easier, let’s first declare some functions for converting between time units:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">DAY</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">YEAR</span> <span class=\"token operator\">=</span> <span class=\"token number\">365.25</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The Julian calendar defines 1 year as 365.25 days</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertMillisecondsToSeconds</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>milliseconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> milliseconds <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertSecondsToDays</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>seconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> seconds <span class=\"token operator\">/</span> <span class=\"token constant\">DAY</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDaysToYears</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>days<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> days <span class=\"token operator\">/</span> <span class=\"token constant\">YEAR</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertYearsToCenturies</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>years<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> years <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now let’s figure out how many centuries have passed since the J2000 epoch:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">J2000</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2000-01-01T12:00:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2017-05-03T22:27:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> epochTime <span class=\"token operator\">=</span> <span class=\"token function\">convertMillisecondsToSeconds</span><span class=\"token punctuation\">(</span>\n    now<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token constant\">J2000</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Date arithmetic returns milliseconds, so divide by 1000 to get seconds</span>\n<span class=\"token comment\">// Result: 547,122,420 seconds</span>\n\n<span class=\"token keyword\">const</span> centuries <span class=\"token operator\">=</span>\n  <span class=\"token function\">convertYearsToCenturies</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">convertDaysToYears</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">convertSecondsToDays</span><span class=\"token punctuation\">(</span>epochTime<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Result: 0.17337263289984028 centuries</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>So approximately <code class=\"language-text\">6,332.43</code> days have passed since J2000, which converts to about <code class=\"language-text\">0.1734</code> centuries. Now that we know how many centuries have elapsed since the epoch, let’s declare the JPL orbital elements and calculate Earth’s current orbital elements.</p>\n<p>For easier downstream calculations, I’ll convert all AU units to kilometers. 1 AU is the mean distance between the Sun and Earth, approximately 149,597,870 km.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">KeplerOrbitElement</span> <span class=\"token punctuation\">{</span>\n  semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  inclination<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  meanLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">JPLOrbitElementData</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n  ratePerCentury<span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AU</span> <span class=\"token operator\">=</span> <span class=\"token number\">149597870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertAUtoKM</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>au<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> au <span class=\"token operator\">*</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> earthOrbitElements<span class=\"token operator\">:</span> JPLOrbitElementData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.00000261</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 149598260.45044068 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token number\">0.01671123</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00001531</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">100.46457166</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">102.93768193</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  ratePerCentury<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.00000562</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 840.7400294 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00004392</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.01294668</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">35999.37244981</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.32327364</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With the orbital elements declared, it’s time to calculate. Using an abstracted <a href=\"https://es-toolkit.slash.page/reference/object/mapValues.html\" target=\"_blank\" rel=\"nofollow\">mapValues</a> function to easily map over object properties, we can express this concisely:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> currentElements <span class=\"token operator\">=</span> <span class=\"token function\">mapValues</span><span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span><span class=\"token constant\">J2000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> element <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span>ratePerCentury<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> centuries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/**\n  {\n    semiMajorAxis: 149598406.21175316,\n    eccentricity: 0.01670361547396304,\n    inclination: -0.0022599099989117043,\n    ascendingNodeLongitude: 0,\n    meanLongitude: 6341.770556025533,\n    perihelionLongitude: 102.99372873211391\n  }\n */</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this simple process, we’ve calculated the state of Earth’s orbital elements at May 3, 2017, 10:27 PM. Now let’s use these values to find where Earth is actually positioned in its orbit.</p>\n<h3 id=\"where-is-earth-in-its-orbit\" style=\"position:relative;\">Where Is Earth in Its Orbit?<a href=\"#where-is-earth-in-its-orbit\" aria-label=\"where is earth in its orbit permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the key to orbital calculation using Keplerian elements is computing the mean anomaly and eccentric anomaly, then expressing the planet’s position on the orbital plane as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. Let’s calculate these values and see why they’re necessary for orbital computation.</p>\n<h4 id=\"calculating-the-mean-anomaly\" style=\"position:relative;\">Calculating the Mean Anomaly<a href=\"#calculating-the-mean-anomaly\" aria-label=\"calculating the mean anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly</a> is an angle used to calculate the position of a body on an elliptical orbit in the classical two-body problem.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMCAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAfdjaLVnCbyJoH//xAAaEAEAAgMBAAAAAAAAAAAAAAABAAISICEx/9oACAEBAAEFAlmXTyNYVNP/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPwEj/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAACEw/9oACAEBAAY/AhQ//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARECEx/9oACAEBAAE/IRJouo2l9jdajKKqsAYWsf/aAAwDAQACAAMAAAAQ88g8/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QwOp//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGhAAAwEBAQEAAAAAAAAAAAAAAAERITFREP/aAAgBAQABPxBCn2uYOerv3q+KpPir0wEA8sIpWDSY6Jmi4j//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mean anomaly ko\" title=\"\" src=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg\" srcset=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/0913d/mean-anomaly-ko.jpg 160w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/cb69c/mean-anomaly-ko.jpg 320w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg 640w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/6a068/mean-anomaly-ko.jpg 960w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/eea4a/mean-anomaly-ko.jpg 1280w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg 2128w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small></small>\n</center>\n<p>The diagram above shows the areas swept by a planet as it moves along its orbit over equal time intervals. Notice that the gray orbital areas are slightly different from each other, while the pink orbital areas are all equal.</p>\n<p>A planet in an elliptical orbit exhibits nonlinear motion according to Kepler’s second law — the <a href=\"https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion\" target=\"_blank\" rel=\"nofollow\">law of equal areas</a>. That is, the planet moves faster near perihelion and slower near aphelion.</p>\n<p>The mean anomaly represents the angular distance between a body and the perihelion, assuming the body were transferred to a perfect circular orbit while maintaining its orbital speed and period. By simplifying the orbit to a near-circular shape, the angle representing the planet’s position increases linearly with time, making calculations simpler.</p>\n<p>Of course, if a planet’s orbital eccentricity were 0 (a perfect circle), the planet would actually move this way. But since most orbits are elliptical, the mean anomaly and eccentricity are used to correct the calculation and determine the planet’s actual motion.</p>\n<p>The mean anomaly serves as the most fundamental ingredient for calculating a planet’s position in its orbit. There are several ways to compute it, but since I already have the mean longitude and longitude of perihelion, I’ll use those.</p>\n<p>The formula for calculating the mean anomaly from mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) and longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>M</mi><mo>=</mo><mi>l</mi><mo>−</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">M = l - \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 6238.776827293419 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>To understand the principle behind this, we need a bit more context on what mean longitude is. The mean longitude used in this calculation represents, on average, how far a planet has progressed in its orbit, measured from the vernal equinox. Mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) can be expressed as:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>l</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>ϖ</mi></mrow><annotation encoding=\"application/x-tex\">l = \\frac{2\\pi}{P}(t - T_0) + \\varpi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">ϖ</span></span></span></span></span></div>\n<hr>\n<ul>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>: Mean motion (the time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> for a planet to complete one orbit). This is the total angle of 360°, or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span> radians, divided by the planet’s orbital period.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>: Time elapsed since the reference time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>. Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the J2000 epoch.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>: Longitude of perihelion.</li>\n</ul>\n<hr>\n<p>Looking at this formula, when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">t - T_0 = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, we get <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo>=</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">l = \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span> — mean longitude equals longitude of perihelion. This tells us that <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> represents the average angle the planet has traveled from the perihelion.</p>\n<p>The final addition of the longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) shifts the reference point of the mean longitude to an angle measured from the vernal equinox.</p>\n<p>But what we need is the mean anomaly, which — as its name suggests — uses the perihelion as its reference, not the vernal equinox. So by subtracting the longitude of perihelion from the mean longitude, we shift the reference back to the perihelion.</p>\n<h4 id=\"calculating-the-eccentric-anomaly\" style=\"position:relative;\">Calculating the Eccentric Anomaly<a href=\"#calculating-the-eccentric-anomaly\" aria-label=\"calculating the eccentric anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now that we’ve used the mean anomaly to find how far the planet has traveled from perihelion, it’s time to calculate the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly</a>.</p>\n<p>The mean anomaly we calculated is like a clock ticking at a constant rate — it simply assumes that since time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span></span> has passed, the planet must have moved through angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>.</p>\n<p>But in reality, a planet in an elliptical orbit moves at nonlinear speeds depending on its distance from the central body. So we need to use the mean anomaly and eccentricity to compute the eccentric anomaly, which accounts for the planet’s nonlinear motion — speeding up and slowing down — to find the actual position.</p>\n<p>The eccentric anomaly is an angle defined to simplify the actual position of a planet on an elliptical orbit. It represents the central angle when the planet’s position is projected onto an imaginary circular orbit whose radius equals the semi-major axis of the actual elliptical orbit. A diagram makes this more intuitive:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>In the diagram, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> represents the planet’s position on the orbit, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> represents the planet’s position projected onto an imaginary circular orbit with radius <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> (the semi-major axis of the actual orbit).</p>\n<p>The center of the actual elliptical orbit is <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> is one of the ellipse’s foci. The focus represents the gravitational center of the orbit — in the solar system, this would be the Sun. The eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the angle from the ellipse’s center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span> to the projected position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> on the imaginary circular orbit.</p>\n<p>Like the mean anomaly, the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit. However, because the eccentricity is factored into the calculation, the eccentric anomaly — unlike the mean anomaly — reflects the geometric characteristics of the elliptical orbit and exhibits a nonlinear rate of increase.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB7CAAAewgFu0HU+AAABcElEQVR42qVTi3KDIBDk//+yVVujAV+IqMj2ltQ0yaSxM70ZBzyX9Y7bVZDYwoq4BazrirquUVUVjDE4n89omgZd10FrjbZtU4575vkYo7EsC2kQY4SaZy8gDaNb5HkmT46iKDDP8xX0GCl3k49xlZ9ZKSgRztCmgXU+/bHve4zjiBACjiNiXkYUVYemveCV9z618pdIhX3vtyCdyVW8lQ7t8FOtItkwDIdEe2zbgla6yE8WVbNJm/dYVZZlavOQKEQMvUNVW5gu3BHd4hSn9ljhDuA6+SiTnNA3E5xbpcLnRFdCSoSyeCTqbcRHPaHWPaiEu6m+uB7lnEuEO9464P3k8Xnu4L09OP6EkGLep1ybIFMT2ThWHH5t6yXhJpcy2kGqFJcYEi34TyiqvpMpG92IhSYZkAW1yclba7FfCQ3Ald+4Ms/vxE3TlLokRl20RT0tyVLOjemdB3iYjqF3qYYsyxKGTqJ/SUAcMVQKvfwFtwj7PCL7F18AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"m vs e\" title=\"\" src=\"/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png\" srcset=\"/static/54cc99e748edcd1fc096e8849a6441d0/69538/m_vs_e.png 160w,\n/static/54cc99e748edcd1fc096e8849a6441d0/72799/m_vs_e.png 320w,\n/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png 640w,\n/static/54cc99e748edcd1fc096e8849a6441d0/d9199/m_vs_e.png 960w,\n/static/54cc99e748edcd1fc096e8849a6441d0/21b4d/m_vs_e.png 1280w,\n/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png 1707w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    Mean anomaly vs. eccentric anomaly calculated after changing Earth's eccentricity to 0.6 in JPL's orbital elements.<br>\n    At day 0 (perihelion) the difference is small, but it grows as we approach day 180 (aphelion).\n  </small>\n</center>\n<p>Once we have the eccentric anomaly, we can finally determine the distance from the gravitational center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> to the actual planet position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, as well as the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> — the true anomaly.</p>\n<p>Like the mean anomaly, the eccentric anomaly can be derived from multiple definitions. Since I’ve already calculated the mean anomaly, I’ll use the formula derived from it:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mo>+</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E = \\frac{M+e \\sin M}{1-e \\cos M}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>This formula calculates the eccentric anomaly using the mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>) and the ellipse’s eccentricity (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span>). The nonlinear characteristics of planetary motion grow stronger with higher eccentricity, which is reflected through the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> terms.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> adjusts the mean anomaly to account for the nonlinear motion of the ellipse, while <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> acts as a normalization factor indicating whether the planet is closer to perihelion or aphelion.</p>\n<p>If <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, the orbit would be a perfect circle and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">E = M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>. But when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e > 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span> (an elliptical orbit), near perihelion both <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> are small so the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> is small, while near aphelion both values increase and the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> grows.</p>\n<p>Unfortunately, the formula for the eccentric anomaly is a nonlinear equation that yields an approximation rather than an exact solution, so we need to reduce the error using the <a href=\"https://en.wikipedia.org/wiki/Newton%27s_method\" target=\"_blank\" rel=\"nofollow\">Newton-Raphson method</a>:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>E</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mfrac><mrow><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E_{n+1} = E_n - \\frac{E_n - e \\sin E_n - M}{1 - e \\cos E_n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1963em;vertical-align:-0.836em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>Now that we know how to calculate the eccentric anomaly, let’s proceed with the actual computation. Since JavaScript’s trigonometric methods like <code class=\"language-text\">Math.sin</code> and <code class=\"language-text\">Math.cos</code> accept radians rather than degrees, we need to convert the mean anomaly to radians:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDegreeToRadian</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>degree<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> degree <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">convertDegreeToRadian</span><span class=\"token punctuation\">(</span>\n  currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then we declare a Newton-Raphson helper function and an eccentric anomaly function, and iterate 6 times:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">newtonRaphson</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> initialValue<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> x1 <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> iterations<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    x <span class=\"token operator\">=</span> x1<span class=\"token punctuation\">;</span>\n    x1 <span class=\"token operator\">=</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> x1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> eccentricAnomaly <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>meanAnomaly <span class=\"token operator\">+</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> eccentricAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">newtonRaphson</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  meanAnomaly<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">6</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 108.9017193604219 radians</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Higher eccentricity means larger errors in the <code class=\"language-text\">getEccentricAnomaly</code> function’s output, requiring more iterations. But since Earth’s orbital eccentricity is about <code class=\"language-text\">0.02</code> — nearly circular — 6 iterations is sufficient.</p>\n<p>With the eccentric anomaly calculated, it’s time to use everything we’ve gathered to find the planet’s actual position on the orbital plane.</p>\n<h4 id=\"finding-the-planets-x-y-coordinates-on-the-orbital-plane\" style=\"position:relative;\">Finding the Planet’s x, y Coordinates on the Orbital Plane<a href=\"#finding-the-planets-x-y-coordinates-on-the-orbital-plane\" aria-label=\"finding the planets x y coordinates on the orbital plane permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now we need to find where the planet is on the orbital plane and express it as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. The coordinates we’re calculating are relative to the center of the ellipse, but ultimately we’ll use them to determine how far Earth is from the Sun and how many degrees it has traveled from perihelion.</p>\n<p>First, the formula for the planet’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the ellipse’s center:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x = a \\cdot (\\cos E - e)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span></span></span></span></span></div>\n<p>Since the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit (because the ellipse’s complex proportions are hard to work with directly), when using the eccentric anomaly to find the planet’s actual position on the elliptical orbit, we need to correct for the difference between the imaginary circular orbit and the actual elliptical orbit.</p>\n<p>The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E - e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> term in the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> formula performs this correction. <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> calculates how far the planet is horizontally from the center on the imaginary circular orbit (based on the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>). Then subtracting the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> shifts the result by the distance between the ellipse’s center and its focus.</p>\n<p>Up to this point, the calculated value is dimensionless — merely a ratio relative to the semi-major axis — so we multiply by the semi-major axis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span>) to set the orbit’s scale.</p>\n<p>The formula for the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate follows a similar principle:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">y = a \\cdot \\sqrt{1 - e^2} \\cdot \\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.1777em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0623em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.0223em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span></div>\n<p>For the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> first calculates how far the planet is vertically on the imaginary circular orbit, then corrects for the difference between the imaginary circle and the actual ellipse.</p>\n<p>The difference here is that we need vertical correction, so we must use the semi-minor axis instead of the semi-major axis. The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">a \\cdot \\sqrt{1 - e^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span> in the formula is precisely the formula for deriving the semi-minor axis from the semi-major axis and eccentricity.</p>\n<p>Now that we understand the general principle, let’s write the code and extract Earth’s coordinates:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> positionX <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>eccentricity\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> positionY <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>From this, I was able to determine that Earth is located approximately -76,411,956 km along the X-axis and approximately 130,045,428 km along the Y-axis from the center of the ellipse.</p>\n<h4 id=\"finding-the-distance-from-the-sun-and-the-true-anomaly\" style=\"position:relative;\">Finding the Distance from the Sun and the True Anomaly<a href=\"#finding-the-distance-from-the-sun-and-the-true-anomaly\" aria-label=\"finding the distance from the sun and the true anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>We’ve found Earth’s coordinates on the orbital plane, but these coordinates represent the distance from the center of the orbit itself — not from the Sun, which is the gravitational center.</p>\n<p>What I actually want to know is Earth’s position relative to the Sun, not the orbital center, so additional calculation is needed. Let’s bring back the diagram from earlier:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Earlier, I calculated the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> shown in the diagram, and used it to find the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> — the planet’s position on the actual red orbit. But a planet in an elliptical orbit doesn’t orbit the center of the ellipse <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>; it orbits the gravitational center located at one of the ellipse’s foci.</p>\n<p>Since a planet orbiting a gravitational center experiences different gravitational forces depending on its distance, and its orbital speed varies accordingly, what truly matters in orbital calculations is the distance and angle from the gravitational center — not the ellipse’s center.</p>\n<p>In other words, I now need to find the distance from <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> (not <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>) to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, and the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span>. This angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> is called the <a href=\"https://en.wikipedia.org/wiki/True_anomaly\" target=\"_blank\" rel=\"nofollow\">true anomaly</a> — literally the “true” angle from periapsis.</p>\n<p>Let’s first calculate the distance from the Sun to Earth. Since we already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, the Euclidean distance (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span>) from the Sun to Earth can be simply calculated using the Pythagorean theorem:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>r</mi><mo>=</mo><msqrt><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>⋅</mo><mi>e</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">r = \\sqrt{(x - (a \\cdot e))^2 + y^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.2561em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9839em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9439em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2561em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> is the distance from the center of the elliptical orbit to the Sun. Since we calculated Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the orbital center, we subtract the distance between the orbital center and the Sun to shift the reference to the Sun’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate. Beyond this adjustment, the formula is just the familiar Pythagorean theorem <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">c = \\sqrt{a^2 + b^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span>, so I’ll skip the detailed explanation.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertKMtoAU</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>km<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> km <span class=\"token operator\">/</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionY<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">convertKMtoAU</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1.0168205539250386 AU</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Running this calculation tells us that on May 3, 2017, at 10:27 PM, Earth is located approximately 1.02 AU from the Sun.</p>\n<p>Now that we have the Sun-Earth distance, let’s calculate the true anomaly to find how many degrees Earth has traveled from perihelion.</p>\n<p>While the standard approach derives the true anomaly from the eccentric anomaly, since I already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, I can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2\" target=\"_blank\" rel=\"nofollow\">Math.atan2</a> function to find the true anomaly directly.</p>\n<p>The <code class=\"language-text\">Math.atan2</code> function uses the relative positions of <code class=\"language-text\">y</code> and <code class=\"language-text\">x</code> to calculate the angle a point forms from a reference point. The result is a radian value between -180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">-\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>) and 180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>).</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAB7CAAAewgFu0HU+AAABYUlEQVR42s1U27KDIAz0///S8cHxUu+CopCytLFQa4+epzKTEZI1LAlLZIwhHlVVURzHlKYpdV1H/vBxRVFQkiSUZRm1bRvgonmet4XWmtZ1pWVZ3JwHfEqpYA3MO84lnKZpx4RBUhoCMT+hEGaHO5VQyomaRu0Y1rVyMT7RYUIkYuv7noZh3NY42qs0xsYGh8FG/n+wSEq5scJX2Q2GpiHjmGnnBztsjDh8iI22aWoc3RwYtq81PGrK5RoiwV8JmdHppvyb4WjrgILDUE8UHMY+9gshgvWjcSEOm0bcDIyyLJ1S8jx3quGY3zQYFAKlAFfXdRALlML14+twdGQfd0kpP9plAE8k/IRzCT8ppUVDnr53pbCvs2qazyjl8aIIGuy14Mb4DFnrTORUDY3R9l4put0UoUxavxIWhbLzxT0Sl5XCBMCQrxfnOOwyjofnCQxg+BGb8JrrhyOC2Tcc8twBC4Eq2UyW6lYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"atan2 2\" title=\"\" src=\"/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png\" srcset=\"/static/aba07d7dd119d6c7cf99ca046209025f/69538/atan2_2.png 160w,\n/static/aba07d7dd119d6c7cf99ca046209025f/72799/atan2_2.png 320w,\n/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png 640w,\n/static/aba07d7dd119d6c7cf99ca046209025f/d9199/atan2_2.png 960w,\n/static/aba07d7dd119d6c7cf99ca046209025f/21b4d/atan2_2.png 1280w,\n/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png 1979w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The atan2 function measures angles from the origin relative to the positive x-axis</small>\n</center>\n<p>Note that this function is designed to receive the <code class=\"language-text\">y</code> coordinate first, as in <code class=\"language-text\">Math.atan2(y, x)</code>. This is because tangent is expressed as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>tan</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mi>y</mi><mi>x</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\tan(\\theta) = \\frac{y}{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">tan</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0925em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>, following the form <code class=\"language-text\">Math.tan(y / x)</code>.</p>\n<p>The coordinates that <code class=\"language-text\">Math.atan2</code> receives aren’t necessarily calculated from the origin — they represent relative coordinates from any arbitrary origin. Since the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates I calculated for Earth are relative to the Sun’s position, plugging them into <code class=\"language-text\">Math.atan2</code> directly gives us the angle of Earth’s position relative to the Sun.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertRadianToDegree</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>radian<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> radian <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">180</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> trueAnomaly <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">atan2</span><span class=\"token punctuation\">(</span>\n  positionY<span class=\"token punctuation\">,</span>\n  positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'True anomaly:'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">convertRadianToDegree</span><span class=\"token punctuation\">(</span>trueAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 120.4375985828049 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this, I was able to determine that as of May 3, 2017, at 10:27 PM, Earth is located approximately 120° from perihelion at a distance of 1.02 AU.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This post only covered finding a planet’s position on the 2D orbital plane. However, once you place the orbit in 3D space by applying the orbital inclination and argument of periapsis, the planet will naturally exhibit three-dimensional motion.</p>\n<p>You can check out the simulator I built using these formulas <a href=\"https://evan-moon.github.io/solarsystemts/\" target=\"_blank\" rel=\"nofollow\">here</a>, and the full source code is available on the <a href=\"https://github.com/evan-moon/solarsystemts\" target=\"_blank\" rel=\"nofollow\">Solarsystem project GitHub repository</a>.</p>\n<p>That wraps up this post on calculating planetary positions.</p>","fields":{"slug":"20170503-calculate-orbit-2-en","path":"/2017/05/03/calculate-orbit-2/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Implementing Planetary Motion","subTitle":"Implementing a celestial simulation using Kepler's equation","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Equation","Keplerian Elements","JavaScript","WebGL","ThreeJS","Mathematics","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"59c15557-97c3-50f1-afde-ef327112b002","tableOfContents":"<ul>\n<li>\n<p><a href=\"#coordinates-and-reference-planes\">Coordinates and Reference Planes</a></p>\n<ul>\n<li><a href=\"#the-celestial-sphere-and-the-ecliptic\">The Celestial Sphere and the Ecliptic</a></li>\n<li><a href=\"#right-ascension-and-declination\">Right Ascension and Declination</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#orbital-terminology\">Orbital Terminology</a></p>\n<ul>\n<li><a href=\"#ascending-node--descending-node\">Ascending Node / Descending Node</a></li>\n<li><a href=\"#aphelion--perihelion\">Aphelion / Perihelion</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#keplerian-elements\">Keplerian Elements</a></p>\n<ul>\n<li><a href=\"#semi-major-axis\">Semi-major Axis</a></li>\n<li><a href=\"#eccentricity\">Eccentricity</a></li>\n<li><a href=\"#inclination\">Inclination</a></li>\n<li><a href=\"#longitude-of-the-ascending-node\">Longitude of the Ascending Node</a></li>\n<li><a href=\"#argument-of-periapsis\">Argument of Periapsis</a></li>\n<li><a href=\"#time-of-periapsis-passage\">Time of Periapsis Passage</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar experience.","html":"<p>In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar experience.</p>\n<!-- more -->\n<p>There are plenty of resources online about plotting orbits and estimating planetary positions, but understanding them requires familiarity with basic astronomical terminology. Apparently these are terms you learn in a high school earth science class, but since I spent most of high school sleeping, I had to look everything up from scratch.</p>\n<p>I’m not an astrophysics graduate — just a developer — so there may be inaccuracies in my explanations.</p>\n<p>Before diving into the Keplerian elements themselves, let’s cover the most fundamental terms needed to understand the explanations that follow.</p>\n<h2 id=\"coordinates-and-reference-planes\" style=\"position:relative;\">Coordinates and Reference Planes<a href=\"#coordinates-and-reference-planes\" aria-label=\"coordinates and reference planes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Celestial bodies move through an infinitely extending three-dimensional space, so a coordinate reference system is essential to describe their motion. This means deciding where to place the center of the coordinates and what to consider 0° when measuring angles.</p>\n<h3 id=\"the-celestial-sphere-and-the-ecliptic\" style=\"position:relative;\">The Celestial Sphere and the Ecliptic<a href=\"#the-celestial-sphere-and-the-ecliptic\" aria-label=\"the celestial sphere and the ecliptic permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is an imaginary sphere of infinite radius centered on the observer.</p>\n<p>Here, “the observer” doesn’t mean an actual person but the celestial body where the observer is located. Since humans haven’t yet had occasion to use these concepts from any planet other than Earth, the observer is conventionally Earth. The projection of Earth’s equator onto the celestial sphere is called <strong>the celestial equator</strong>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 638px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADBUlEQVR42kWT21LaUBSGN2CLLaJykJNAiJwEAgkhEXIgEQinJAOEgwgosWpVbC/aaa86velMH6DP0Ufq9GG6ou10Jhd71vq/7H/v9W80WH+MV7QMb6S5UYobZfgRLDBGKyuL/vnGuPpANucJVodimhtaXX50LI6jVO/i8SuCHtrL20NlFKBQsIz8pC1Q9uebOdFgh5va4CFdHeCsnmBVe6hiaQKUI0Sjnaw0ukFs/xKYbazmxKqO6MluSmK6l7z+piBNCopZ6pgFaVpTzeb4Lkgo9kN2G+Ne4Tzyl5SzDQIpOqBexmuOQxaq1b5JNs4DhOJO1ffTkidz6joSg8U2Ic+q/bULF1CQfhE9Qd5ia/rwH7aFmYI0o9tLX64JIie4SAotY12UjB2cCxLNSmdJNaYxuhul+8hDtGbPcKC8FT3ZSdY51cQZdS8puhPc7lHNkxaiRH0/Kbhxbv+IdyWUzacrtqN6c8rTzvd/YXuEiZAdUTNDhLKfFjwZ4WWMzdR1VlvBOR2RE2+m/vjZ/PjlJlRogXPkKz3BPQu2RZgCP5CGt7685Iwzuxk5QTXnl5uHbz9duLyNieb96PevH/rqPs1o8Lsn2LJ9ATAKVw6L7dnypjsxk9WBOyWhEBMuT1KNDdHQe4txazrWzx+M+Vu83LFF2L87s5ZtyonxMVoZLK8ZadzoL9TJtazOZc2YrGbqxCiLWorql/iBqK1309LW823PAAbbvlK8ohbloTy8kI3r5njN6/Nqb7y6BZM9W4BxYbw3KxGNOUzREWGcWO0JfrYNo4pVUajiSgji4Lq3eOfPNeCSfDnFl2u9xnl/vlWQzwT9jftIsP+DFYCr6hqFaMgNlCAnnuxppbPitKtcfQphztenWXEMCeO1K+/xKQicGLedgISRbUgY2TxHewV7mLaCDTPwk1thJkJ1S40zTrOY4unskOxuha2Wle0D0gEyV7Y+vEH95ftwqYOxepzR4MMYPVbRgsVOXpooszt18XgsGIFiG4oxWgVTsnErjW7hOd19/v4HfhW6L3NhaLIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"1\" title=\"\" src=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" srcset=\"/static/7ae3e4bed5b1240285335fdd519f6924/69538/1.png 160w,\n/static/7ae3e4bed5b1240285335fdd519f6924/72799/1.png 320w,\n/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png 638w\" sizes=\"(max-width: 638px) 100vw, 638px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The yellow line labeled <strong>ecliptic</strong> in the diagram above represents the apparent path the Sun traces across the sky as observed from Earth.</p>\n<p>In other words, the concepts of the celestial sphere and ecliptic originate from the geocentric model. They define the positions of celestial objects in the sky relative to Earth as the observer.</p>\n<p>Because Earth’s rotational axis is tilted 23.5°, the celestial equator and the ecliptic meet at an angle of 23.5°. Due to this tilt, from Earth’s perspective the Sun appears to orbit Earth while drifting south and then north. The point where the Sun moves from south to north is called the <strong>vernal equinox</strong>, and the point where it moves from north to south is called the <strong>autumnal equinox</strong>.</p>\n<p>But living in the 21st century, we know that it’s actually Earth orbiting the Sun, not the other way around. So while the diagram above shows Earth standing upright with the Sun orbiting at a tilt, in reality the ecliptic is the reference plane and the celestial equator is the one tilted at 23.5°.</p>\n<h3 id=\"right-ascension-and-declination\" style=\"position:relative;\">Right Ascension and Declination<a href=\"#right-ascension-and-declination\" aria-label=\"right ascension and declination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is ultimately a concept for expressing the positions of objects in the sky relative to Earth. The positions of celestial bodies are expressed using right ascension and declination.</p>\n<p>This is the same idea as using the geographic coordinate system with longitude and latitude to express a specific location on Earth. In the geographic coordinate system, latitude takes the equator as 0° and the poles as 90° to mark vertical position, while longitude takes the Greenwich Observatory as 0° and divides 180° east and 180° west for horizontal position.</p>\n<p>By the same principle, when looking up at the sky from Earth, any object on the celestial sphere can be located with just two values — right ascension and declination.</p>\n<p>Right ascension and declination are the longitude and latitude in the equatorial coordinate system, which uses the celestial equator as its baseline. Right ascension measures the counterclockwise angle from the vernal equinox to the target object along the celestial equator. Declination measures the angular distance from the celestial equator to the target object. In short, knowing the celestial equator, the vernal equinox, the right ascension, and the declination is enough to pinpoint any object on the celestial sphere. <small>(Of course, the equatorial coordinate system assumes objects exist on the two-dimensional surface of the celestial sphere, so it doesn’t define the distance to the object.)</small></p>\n<p>An interesting fact is that most celestial bodies — except for solar system objects and comets — barely move on the celestial sphere, so they have essentially fixed right ascension and declination values that make them easy to locate.</p>\n<p>Unlike geographic longitude, right ascension in the equatorial coordinate system is expressed in time units like hours and minutes. Since Earth rotates 360° in 24 hours, 1 hour of right ascension corresponds to 15°. Declination takes the celestial equator as 0° and defines the celestial north pole as +90° and south pole as -90°, so it always falls between -90° and +90°.</p>\n<p>For reference, the coordinate system centered on a ground-level observer on Earth (rather than the equator), using the observer’s horizon as the reference plane, is called the horizontal coordinate system.</p>\n<h2 id=\"orbital-terminology\" style=\"position:relative;\">Orbital Terminology<a href=\"#orbital-terminology\" aria-label=\"orbital terminology permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"ascending-node--descending-node\" style=\"position:relative;\">Ascending Node / Descending Node<a href=\"#ascending-node--descending-node\" aria-label=\"ascending node  descending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A celestial body’s orbital plane is generally tilted relative to a reference plane. The reference plane can vary by definition, but for the solar system it refers to the ecliptic.</p>\n<p>Earlier, I explained that in the equatorial coordinate system, the point where the Sun moves from south to north is the vernal equinox, and where it moves from north to south is the autumnal equinox.</p>\n<p>Similarly, for any body orbiting a central object, the point where it crosses from south to north of the reference plane is called the ascending node, and the point where it crosses from north to south is the descending node. While “vernal equinox” and “autumnal equinox” are terms specific to us living on Earth, “ascending node” and “descending node” are universal terms applicable to any body orbiting along a specific trajectory.</p>\n<p>In the solar system, since the central body is the Sun, the ecliptic is used as the reference.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVR42rVSy2rDQAzUW/uy13Ycm1IKhRZyyKH//3dVHj0k0GN01M5opJkFeHUxkKIm8kJ5SlO3rij/os1tHMfsxYIgLXMxdkEhoON63I/bkhcEeuAgM2hoWMpDzdNh2VJtoIwuoHJ7QlE27T4h4B8NCd1R1Tk1b+5ODG68r8tYizOaEimhXYCD9ZSGy7g7WU01ZXCP9cqleyh1H+e3df85n9dxzpfLQVxHHxQkVCmVOzlz7m21UkmkTSM5l6GoUlwZwqfTV87u6jU1ZgER8oRyVa5ULA4yrW0ADl+U1AIBJrEuIG3b++fHd2szu0cfg4/Xg3O4XzoLI+KDeRjmauJcpDJKACICokeHQ3bu07ZvkU0YSHiLNMXQCJae8niq2LJxm1Jf8lyoZEpOxsgv/3m/zscMNxDZT98AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pluto orbit\" title=\"\" src=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" srcset=\"/static/4693485f3e9d15673833669486a0c618/69538/pluto_orbit.png 160w,\n/static/4693485f3e9d15673833669486a0c618/72799/pluto_orbit.png 320w,\n/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Looking at Pluto's orbit, it's easy to see what it means to rise north or descend south of the ecliptic relative to the Sun.</small>\n</center>\n<h3 id=\"aphelion--perihelion\" style=\"position:relative;\">Aphelion / Perihelion<a href=\"#aphelion--perihelion\" aria-label=\"aphelion  perihelion permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they have two foci. Typically the star occupies one of these foci. The aphelion is the point farthest from the star, and the perihelion is the closest. Parabolic orbits have an aphelion at infinity, so they only have a perihelion.</p>\n<h2 id=\"keplerian-elements\" style=\"position:relative;\">Keplerian Elements<a href=\"#keplerian-elements\" aria-label=\"keplerian elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now that we’ve covered the basic terms, let’s look at the Keplerian elements that define the shape, size, and orientation of an orbit.</p>\n<p>The Keplerian elements consist of: the semi-major axis and eccentricity (which define the orbit’s shape and size), the inclination and longitude of the ascending node (which define the orbital plane), and finally the argument of periapsis (which defines the orbit’s orientation) along with the time of periapsis passage (which pins down the body’s position at a specific time).</p>\n<h3 id=\"semi-major-axis\" style=\"position:relative;\">Semi-major Axis<a href=\"#semi-major-axis\" aria-label=\"semi major axis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they’re defined not by a radius but by a semi-major axis and semi-minor axis. The semi-major axis is the point on the orbit farthest from the orbital center, while the semi-minor axis is the closest point.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35QB/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFhABAQEAAAAAAAAAAAAAAAAAAIEg/9oACAEBAAE/IUTH/9oADAMBAAIAAwAAABBgz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQADAAMAAAAAAAAAAAAAAAEAESEQMUH/2gAIAQEAAT8QG7xNqWnp2Cp2Iw4//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"semi major axis\" title=\"\" src=\"/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg\" srcset=\"/static/18c739abac106732c5daf91effd1103d/0913d/semi-major-axis.jpg 160w,\n/static/18c739abac106732c5daf91effd1103d/cb69c/semi-major-axis.jpg 320w,\n/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg 640w,\n/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg 678w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The difference from aphelion/perihelion is that the reference point is the center of the orbit, not the star. Parabolic and hyperbolic orbits have an infinite semi-major axis, so they only have a semi-minor axis.</p>\n<p>The Keplerian elements only deal with the semi-major axis (not the semi-minor axis) because what matters for orbital energy calculations is the average distance of the orbiting body, not the orbit’s shape. The semi-major axis represents the overall size of the orbit, while the semi-minor axis merely indicates how squashed it is — not a suitable metric for energy calculations.</p>\n<p>For this reason, celestial mechanics generally uses the semi-major axis, and Kepler’s equation does the same.</p>\n<h3 id=\"eccentricity\" style=\"position:relative;\">Eccentricity<a href=\"#eccentricity\" aria-label=\"eccentricity permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 440px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 121.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVR42qWVvYvTYBzHv2l7aZOnbZo06fW8qCDccJXqKs4OgiLcUHR0cBIcfENu6iQK4iCCi8LtB7eJuIrQyb9CEHETzz1+f3mes8nlUhN84JuXPs2H3/sDAF1qzahNdYxs4C739gZ672zH7JfJ1qyLGOAtAryAwhwNFFYSUi6qLaUvAnoCD7uI+DygWhmgBRyuL6HyXrrcvxezLMJcPCX4GfwlWCCfzwBf/mVpDmgZ6XUfDoGj1OJ0Xe4BXzcJb9WxMA9OUou7jO8IN0DgwuGP4n6jDtCwYCUGPGeM3UcYq1sQmECHtYBJ1vXlamAHG96ehECA39y6FtpUjwqNvHd891kN3QfXQ11O1S30qYhSVHOf4r1zAMS/0I0mL1m3WwtJUDsT9zzwyE3eAwGWxKj1nnuHF5ik2zdP89/esdrMW5hoS6KyWM6R1uWpBbA5vTY9h/DTRhpbTOxVwDCb5Wy2L4G1Sbc/OIi3r2xvITiIdZ/HjnHbOcllf4XLst/+McEYd3YIS/orXT6WFMmsk1HnZxrf3jCWpJz/KDG0S5NSUjYDKReRhtG9fXbOvatRSXHXKmzgue/hjYQjCYDvqlZhI5OM2QxN9VCNglfo6zFWr/XyU0eGA/uYd07sZM0MB+v/xlc6yZMm8HusoavHlyoM2N3CgG2Yqe1UGbAOs9Dgx/3ipD6qsWREqQpnCoFTAqSuHnOAFg6pFBZVhBlvfR5Ocdoytmkd14jPMzb/66E+JtdVZu8kybf9P8qYk5p9WHxjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentricity\" title=\"\" src=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" srcset=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/69538/eccentricity.png 160w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/72799/eccentricity.png 320w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png 440w\" sizes=\"(max-width: 440px) 100vw, 440px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Eccentricity is simply a measure of how squashed an ellipse is. In the geometric definition, the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of an ellipse is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>−</mo><mfrac><msup><mi>b</mi><mn>2</mn></msup><msup><mi>a</mi><mn>2</mn></msup></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1-\\frac{b^2}{a^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.44em;vertical-align:-0.7406em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6994em;\"><span class=\"svg-align\" style=\"top:-4.4em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.6594em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:2.48em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"2.48em\" viewBox=\"0 0 400000 2592\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M424,2478\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl0 -0c4,-6.7,10,-10,18,-10 H400000\nv40H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M1001 80\nh400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7406em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> is the semi-major axis and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> is the semi-minor axis. However, the eccentricity used in Keplerian orbits has a slightly different formula.</p>\n<p>The standard formula for an ellipse’s eccentricity only describes the geometric squashing without considering factors like gravity or energy, so it’s not suitable for Keplerian orbits, which are based on the interaction between a body’s kinetic energy and gravitational forces.</p>\n<p>To calculate the eccentricity of a Keplerian orbit, you need to account for physical dynamics like kinetic energy and angular momentum:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>2</mn><mi>E</mi><msup><mi>L</mi><mn>2</mn></msup></mrow><mrow><msub><mi>m</mi><mtext>red</mtext></msub><msup><mi>α</mi><mn>2</mn></msup></mrow></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1+\\frac{2EL^2}{m_\\text{red}\\alpha^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.04em;vertical-align:-1.1156em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9244em;\"><span class=\"svg-align\" style=\"top:-5em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">red</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.8844em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:3.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"3.08em\" viewBox=\"0 0 400000 3240\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M473,2793\nc339.3,-1799.3,509.3,-2700,510,-2702 l0 -0\nc3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM1001 80h400000v40H1017.7z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1156em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>The solution <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of this equation is called the orbital eccentricity.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the total energy of the body in orbit, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span></span> is the angular momentum, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>m</mi><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">m_{red}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">re</span><span class=\"mord mathnormal mtight\">d</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the reduced mass, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span> is the coefficient for the inverse-square law central force. The inverse-square law means a force’s magnitude is inversely proportional to the square of the distance — in this case, that force is gravity.</p>\n<p>Since I’ll be using data where the eccentricity is already provided, I don’t actually need to calculate all this. Just knowing that it differs from the standard eccentricity formula is enough.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 212px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 112.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAUEAQP/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtOZTNLxEPSG0H/8QAGhAAAwEBAQEAAAAAAAAAAAAAAQIDBBETMf/aAAgBAQABBQLTUmk+rEfKpzWjPRYEtOwf3WjShjBEP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAIDAAEFAAAAAAAAAAAAAAECABEhMRBBUWGh/9oACAEBAAY/AmQFgRxUWrOd+hN+4rYBLJu4552Uusfk3zP/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMUFRYXH/2gAIAQEAAT8hXQJuz3MFK2VW3L7bl0HJV6h1uFp3M5tL88mNEeoRL0cIAHbaf//aAAwDAQACAAMAAAAQEwc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAwEBAAAAAAAAAAAAAQARITFhcYFBsf/aAAgBAQABPxAlDhY4mu8dQ1zxRYM3be4kE0th8ajEBzDwN9ahBU4WqyVwQA+xErb8RpGUFjBxmO1cgLHs56I+BEy64n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme\" title=\"\" src=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" srcset=\"/static/68ee7ca2b63f32445afe5c63a2526b87/0913d/skip.jpg 160w,\n/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg 212w\" sizes=\"(max-width: 212px) 100vw, 212px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Keplerian orbital eccentricity takes four forms:</p>\n<hr>\n<ul>\n<li>Circular orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span></li>\n<li>Elliptical orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>&#x3C;</mo><mi>e</mi><mo>&#x3C;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0 &#x3C; e &#x3C; 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6835em;vertical-align:-0.0391em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Parabolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Hyperbolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e > 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n</ul>\n<hr>\n<p>Earth’s orbital eccentricity is currently about <code class=\"language-text\">0.0167</code>, making it nearly circular. Mercury, the planet with the highest eccentricity in the solar system at <code class=\"language-text\">0.2056</code>, receives roughly twice as much solar radiation at perihelion compared to aphelion.</p>\n<p>Pluto used to be the champion in this category with <code class=\"language-text\">0.248</code>, but as we all know, it’s been demoted… <small>(Adiós…)</small></p>\n<p>Comets have quite varied eccentricities. Periodic comets typically range from <code class=\"language-text\">0.2</code> to <code class=\"language-text\">0.7</code>, while some with extremely elongated orbits approach nearly <code class=\"language-text\">1</code>.</p>\n<p>For example, the well-known Halley’s Comet has an eccentricity of <code class=\"language-text\">0.967</code> and takes 76 years to complete one orbit due to its extremely elongated path. Its next approach is in 2061, by the way.</p>\n<h3 id=\"inclination\" style=\"position:relative;\">Inclination<a href=\"#inclination\" aria-label=\"inclination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This is the angle between the star’s ecliptic plane and the orbit. If the inclination exceeds 90°, the body is orbiting in the opposite direction compared to bodies with inclinations between 0° and 90°.</p>\n<h3 id=\"longitude-of-the-ascending-node\" style=\"position:relative;\">Longitude of the Ascending Node<a href=\"#longitude-of-the-ascending-node\" aria-label=\"longitude of the ascending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the ascending node is the point where a body crosses the reference plane from south to north while following its orbit. The ascending node is expressed as a longitude — the angle measured counterclockwise from the vernal equinox along the ecliptic to the ascending node.</p>\n<p>This allows us to define the position of the ascending node in a 3D coordinate system.</p>\n<h3 id=\"argument-of-periapsis\" style=\"position:relative;\">Argument of Periapsis<a href=\"#argument-of-periapsis\" aria-label=\"argument of periapsis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The argument of periapsis is the angle from the ascending node to the periapsis, measured within the orbital plane. As the term “periapsis” suggests, this angle is measured from the gravitational focus of the orbit, not the center of the ellipse.</p>\n<p>This value indicates how much the orbital ellipse is rotated relative to the reference plane (like the ecliptic). If the argument of periapsis is 0°, the ascending node and periapsis coincide, meaning the body is closest to its star at the moment it crosses the ascending node. If it’s 90°, the body is at its closest approach when it’s at the point farthest north of the reference plane.</p>\n<h3 id=\"time-of-periapsis-passage\" style=\"position:relative;\">Time of Periapsis Passage<a href=\"#time-of-periapsis-passage\" aria-label=\"time of periapsis passage permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This marks the time when the body passes through periapsis.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In the <a href=\"/2017/05/03/calculate-orbit-2\">next post</a>, we’ll implement orbital calculations in code. That wraps up this glossary of astronomical terms and introduction to the Keplerian elements.</p>","fields":{"slug":"20170503-calculate-orbit-1-en","path":"/2017/05/03/calculate-orbit-1/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Understanding the Keplerian Elements","subTitle":"A guide to Keplerian orbital elements — no astronomy or math expertise required","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Laws","Keplerian Elements","JavaScript","WebGL","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}],"pageInfo":{"currentPage":7,"pageCount":7}}},"pageContext":{"limit":15,"skip":90,"lang":"en","totalCount":96}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}