{"componentChunkName":"component---src-templates-posts-page-template-tsx","path":"/page/2/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"95587b9b-cc10-52fe-96cb-ded607a4b676","tableOfContents":"<ul>\n<li>\n<p><a href=\"#the-beginning-of-yak-shaving\">The Beginning of Yak Shaving</a></p>\n</li>\n<li>\n<p><a href=\"#intoroducing-gatsby\">Intoroducing Gatsby</a></p>\n<ul>\n<li><a href=\"#graphql\">GraphQL</a></li>\n<li><a href=\"#lets-use-the-graphql\">Let’s use the GraphQL</a></li>\n<li><a href=\"#create-pages-with-dynamic-parameter\">Create pages with dynamic parameter</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#the-annoying-parts\">The annoying parts</a></p>\n<ul>\n<li><a href=\"#care-about-the-connection-with-the-existing-link\">Care about the connection with the existing link</a></li>\n<li><a href=\"#make-it-all-by-myself\">Make it all by myself.</a></li>\n<li><a href=\"#there-is-no-posting-creation-function-in-cli\">There is no posting creation function in CLI.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#epilogue\">Epilogue</a></p>\n</li>\n</ul>","excerpt":"During the last golden week, I migrated my blog that I had previously made using Hexo to Gatsby. In this post, I would like to share what I learned from this migration work and issues I didn’t expect. The Beginning of Yak Shaving In fact, I tried to continue using Hexo at first. Of course, it’s tru…","html":"<p>During the last golden week, I migrated my blog that I had previously made using Hexo to Gatsby. In this post, I would like to share what I learned from this migration work and issues I didn’t expect.</p>\n<h2 id=\"the-beginning-of-yak-shaving\" style=\"position:relative;\">The Beginning of Yak Shaving<a href=\"#the-beginning-of-yak-shaving\" aria-label=\"the beginning of yak shaving permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In fact, I tried to continue using Hexo at first. Of course, it’s true that React-based Gatsby is more comfortable than ejs-based Hexo, but I thought doing this would be a waste of resources, given that I couldn’t write posts during the migration.</p>\n<p>Also, I think the main content of the blog is the post itself, so I don’t have to add various features to the blog. When I need to add some features to my blog, I just need to find and use Hexo plugins created by others.</p>\n<center>\n  <div style=\"max-width: 400px\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/541b7115291302457477eabd84aa37bc/4b190/why.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQT/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGvsze/N3oGsCRRtiT/xAAdEAACAQQDAAAAAAAAAAAAAAABAwACBCIxERIT/9oACAEBAAEFAuzHNHoucmWbaaQxuI1Achr/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAXEQADAQAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AWZEf//EAB8QAAIABgMBAAAAAAAAAAAAAAECABAREjFBAyEiUf/aAAgBAQAGPwIrxm1V3Hprx9kyncUJXvFJjEv/xAAcEAEAAgMAAwAAAAAAAAAAAAABABEhMWFRcZH/2gAIAQEAAT8hpvxGQAEmCtI9nqjIgq7XcC1oiq7FhLp0Z8kooPia5//aAAwDAQACAAMAAAAQK8C+/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQIRExgf/aAAgBAgEBPxClY6JGo0R//8QAHxABAAIBBQADAAAAAAAAAAAAAQARITFBUWFxgbHw/9oACAEBAAE/ELMBwrV/bR01+AANx2eYKCYPUFO8UtFVfMW9DWLoynxLE6jnD0zQ/cekFTISZ+M//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"why\" title=\"\" src=\"/static/541b7115291302457477eabd84aa37bc/c08c5/why.jpg\" srcset=\"/static/541b7115291302457477eabd84aa37bc/0913d/why.jpg 160w,\n/static/541b7115291302457477eabd84aa37bc/cb69c/why.jpg 320w,\n/static/541b7115291302457477eabd84aa37bc/c08c5/why.jpg 640w,\n/static/541b7115291302457477eabd84aa37bc/4b190/why.jpg 800w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>Of course I know that Gatsby is easier to use than Hexo... But no need to migrate that.</small>\n  <br>\n  <br>\n</center>\n<p>However the problem occurred in an unexpected place. I had a plan to translate blog posts which I wrote to english, and I was going to setup i18n on my blog before the golden week began, and then translate some posts.</p>\n<p>I thought I could easily add i18n functionality to my blog. This is because Hexo supports i18n configuration by itself, and the Icarus theme I was using also supports this configuration.</p>\n<p>In addition, I had expected this would not be a big deal, as Hexo’s <a href=\"https://hexo.io/docs/internationalization.html\" target=\"_blank\" rel=\"nofollow\">i18n Setup Guide document</a> says. it says that I just add language types to the config file, I could simply build an environment in which multiple languages can be used within the application.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token comment\"># _config.yml</span>\n\n<span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ko\n  <span class=\"token punctuation\">-</span> en <span class=\"token comment\"># This is new language!</span>\n\n<span class=\"token comment\"># ...</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>According to Hexo’s guide document, adding the i18n setting looks a very simple task that could be done in a several minutes. But…</p>\n<center>\n  <br />\n  .<br />\n  .<br />\n  .<br />\n  .<br />\n  <br />\n</center>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\">ERROR Render HTML failed: index.html\nTypeError: /Users/evan/dev/evan-blog/themes/icarus/layout/layout.ejs:2\n    1| <span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n >> 2| <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">&lt;%-</span> <span class=\"token attr-name\">has_config('language')</span> <span class=\"token attr-name\">?</span> <span class=\"token attr-name\">'</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span> + get_config('language').substring(0, 2) + '<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">'</span> <span class=\"token attr-name\">:</span> <span class=\"token attr-name\">''</span> <span class=\"token attr-name\">%</span><span class=\"token punctuation\">></span></span>>\n    3| <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    4|     &lt;%- partial('common/head') %>\n    5| <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 378px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/89b1b7daecdf28c4fe33dbe44dd39388/f0991/chit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 91.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEVUlEQVR42gFKBLX7AKbE1M7FxtHHyNLIy9HIy9bNzcS8u1JcQYyLdK+ijKqghb+yn4a7xHCtonq0v2m50JiqgqSNY6N9gat6iwC9urzNxMXPxsfSycrRxsjSytHPxbeDejyFdD1rWzReUSp1YzWZnXCYwrSWiXd/pKmItKSqnVaBsLB7qMEAz8TEzsTFz8XG0cfG0MbP4c+1m4RLMykZBQMGAAAAAQEAAAABDQUBYVUtxZVWjqSnZa/CnqaCdba/YrfIAMzCw87Exc/ExM7FzODQtYRwOgYDBQAAACYiKGlnbIOBhnJvdDs6QQAAAkM7HpKghGWvw2G0vGisvWGsvwDNwsPPxMXKxcvc0Mech1EFAwcNDBKBfoTl4+7////+/v7////6+f2fnaMHBA1WTiueubKFrsqcus+gudAAzMLEzMDB3bmq5tB6KiQXAAAFko6V//7/8e336ufy6uj06efz6ejy////oZ6nAgAAsqBi2sGxu6Opy7SzAMzIyMWWme2jXbekRgAAAUA+Qu3p8+fk7Ojl7enk6uvn8ujj6+bi6uTi6/Tx+zs6Sk5GF/G+cMSThcinnADIw8XEnZrjs0dXSiAAAACLiI369v/X0tzCv8jw7Pfl3uHq4+jd2eK8ucL39Pyjn6kWEQvCmkHNl4LOq6IAxbu+0ca+n4ZLDwoHAAABqqWr9vH65OHo49/e9O3X++pn+/Cb7efe4dza7enzy8XMGBYee2IwtpJ5rIyGAMK4uNXJy1hSVwAAAAIABKKepPDg7evZ6+vcj9W+OHxsH4h4J+LOUencwevS6szDyhgXHkIwLLeTgLubjQDBtbfLwMNDPkIAAAMAAAFoZWrr2OHZxdDb0sXItGechTeplEXZzJva09ro1+Cfl50AAAJCNzTBooq7nIYAvrO1wLa4OTQ5AgAFBwUJFRMYpZ+k4NfX3NLV3tbY49nK5NrT39jd4dvcwby/MC0yAQAFKiQkt5uDv6KLALywrbusqCklJwAAAAYFCgIABA4PFGdhZqWcm7yxscG4usW8vbSsq4F7fiQhJgMCBggGDBMQEq+Uf8KljQCfhl2QhFtQSUgrJy8bFRsUEBUQBAkEAQMMCg4jHyMpJikqJioeGyAFBAcFBAkNCxAaFx1FQEiulYTCo4kAWFhARko+aGBlSUlRayAkdmRoaygrnDQ2TlRYenh7f3+AhYSGtLS0h4eIdnV4iYeKOTM6W1Zho46DwaGHACktJzk7NGFWXkZHUJUTFZtrbU09QZM5OmZqb5yYmqqqq4uJi729vYmHiqenqJSTlTYxOFRPW4h4dMChhAA0OxtLSTpXUFk4MThfJSlqRUtFMzlgP0Q/QEdoZWqEhIdOS1F8e35kYmZubXBUU1dFQEpDQEpxZ2y8noQAXV0/Y1tdTUZPPzpBOz9HQUFLVlJcUE9ZdHB5qamxsbC3trW8gH6HRUJLKygwR0JMV1RdXFhiVE5YmoR2qNstTgis+m0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"chit\" title=\"\" src=\"/static/89b1b7daecdf28c4fe33dbe44dd39388/f0991/chit.png\" srcset=\"/static/89b1b7daecdf28c4fe33dbe44dd39388/69538/chit.png 160w,\n/static/89b1b7daecdf28c4fe33dbe44dd39388/72799/chit.png 320w,\n/static/89b1b7daecdf28c4fe33dbe44dd39388/f0991/chit.png 378w\" sizes=\"(max-width: 378px) 100vw, 378px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>What the...?</small>\n</center>\n<p>Unlike Hexo’s document, which explained that adding some code lines to the <code class=\"language-text\">config.yml</code> would be a happy ending, the reality was tough.</p>\n<p>Why I got a this error? It’s simple. When multiple values are set in one props in configuration, the Hexo’s configuration parser parses these values to an array. However the Icarus theme uses the <code class=\"language-text\">substring</code> method because it assumes that the <code class=\"language-text\">language</code> property is a String type.</p>\n<p>In this situation, There were 4 ways that I could choose.</p>\n<hr>\n<ol>\n<li>Fixing the Icarus theme.</li>\n<li>Using other Hexo theme that supports i18n well.</li>\n<li>Making my own Hexo theme.</li>\n<li>Migrating to Gatsby.</li>\n</ol>\n<hr>\n<p>Themes of Hexo are not installed by package managers like npm or yarn, it is cloned from github repository and included to your application source. So you can freely fix Hexo themes by yourself without Pull Request to contributor’s repository.</p>\n<p>But as my sight, it is not simple situation like that. Because if I change <code class=\"language-text\">language</code> property to an array, side effects will occur not only in the <code class=\"language-text\">layout.ejs</code> but also elsewhere.</p>\n<p>So how about option 2? That is not a good choice either.</p>\n<p>The fundamental problem with this situation is not just that the theme does not support the i18n, my blog is too dependent on the limited functions of theme which made by other people. In other words, even though if I change my blog to other theme that supports this feature, this situation will be occurred again.</p>\n<p>How about option 3 to create my own Hexo theme?</p>\n<p>If you make Hexo theme, you must use old techniques such as ejs and jQuery. Moreover, the amount of resources consumed by creating themes or migrating them is not much different. Rather it is better to draw UI with Gatsby which is React-based than with ejs.</p>\n<p>These are why I decided to move from Hexo to Gatsby.</p>\n<p>Actually, it is quite easy that migrating from Hexo to Gatsby. Official blog also provides a guide document titled <a href=\"https://www.gatsbyjs.org/blog/2017-10-01-migrating-my-blog-from-hexo-to-gatsby/\" target=\"_blank\" rel=\"nofollow\">Migrating My Blog From Hexo To Gatsby</a>, and that process is not complicated.</p>\n<p>However my blog is service that many people are using, I have to do extra tasks that recreate all of original features on my blog, not just change static page generator. It is not a simple task because if Gatsby doesn’t support the features that I have been using easily with the Hexo plugin, I should create them all.</p>\n<p>But now, I got the 6 days golden holiday on April 30 on Buddha’s Birthday. and This long holiday season will not come again in this year, so it was a last chance to proceed with such a grand project. So, I had made branch, and started working on moving from Hexo to Gatsby.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0081bd73b6f38b83ddb98effd99285d2/4b190/yak.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBAv/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAZ15zKyYX//EABgQAAMBAQAAAAAAAAAAAAAAAAABAwIR/9oACAEBAAEFAp00K3R2M8HhDSP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGq/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERMRAhMoH/2gAIAQEABj8CsmfMUh6OUf/EABsQAQACAwEBAAAAAAAAAAAAAAEAESExcVGh/9oACAEBAAE/IQO3IuSnqijr7KpPcFrfJZh//9oADAMBAAIAAwAAABBY/wD/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EMVD/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qtb//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhYYExkf/aAAgBAQABPxBEiXnaHCgKem+RKWO4GC7kTKKRztiJt8Ln/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"yak\" title=\"\" src=\"/static/0081bd73b6f38b83ddb98effd99285d2/c08c5/yak.jpg\" srcset=\"/static/0081bd73b6f38b83ddb98effd99285d2/0913d/yak.jpg 160w,\n/static/0081bd73b6f38b83ddb98effd99285d2/cb69c/yak.jpg 320w,\n/static/0081bd73b6f38b83ddb98effd99285d2/c08c5/yak.jpg 640w,\n/static/0081bd73b6f38b83ddb98effd99285d2/4b190/yak.jpg 800w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The beginning of yak shaving...</small>\n</center>\n<h2 id=\"intoroducing-gatsby\" style=\"position:relative;\">Intoroducing Gatsby<a href=\"#intoroducing-gatsby\" aria-label=\"intoroducing gatsby permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/2bab627a79337d768c8221c571d2c81a/29114/gatsby.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMklEQVR42mNgoBX4z/Cf8f///4xg9n8Em1LAxMCgzgukmVHFwJh4l4HocOVq2RkVazas6Nv1cm7Dhp0VAZPVQOL19fUwwxhxOwJJDua1GVXrlm+cdOx/beiMn/Mqtv2v9JuyA6rEE4jDgJgTiNmAWAlqiBsQK0DVsKJbyLqgcevVtVP2/c936fo1sXD5/0WNO+6zMYioArVWAPXHAdXUghwMxB1AXArErUDcBMRZUAsZYS4Ee2ly0cqFt449/79x+sGfu+ed+7+0Y+dGsH9YmcKhmmKAuBiIvaEGFAAxzKIguPdhYRgqXyIxuXj5spk1ax9NLl65Ply+HOwdewZ7FmgkMUK9hhxRIDE9IObBFUeM4gyu3GixzAjFTGjhxIiGMeKbkQEao+B0yEB0OmRkoCUAAFcqZS1w+C9uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"gatsby\" title=\"\" src=\"/static/2bab627a79337d768c8221c571d2c81a/6af66/gatsby.png\" srcset=\"/static/2bab627a79337d768c8221c571d2c81a/69538/gatsby.png 160w,\n/static/2bab627a79337d768c8221c571d2c81a/72799/gatsby.png 320w,\n/static/2bab627a79337d768c8221c571d2c81a/6af66/gatsby.png 640w,\n/static/2bab627a79337d768c8221c571d2c81a/d9199/gatsby.png 960w,\n/static/2bab627a79337d768c8221c571d2c81a/21b4d/gatsby.png 1280w,\n/static/2bab627a79337d768c8221c571d2c81a/29114/gatsby.png 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<blockquote>\n<p><strong>Gatsby</strong> is a free and open source framework based on React that helps developers build blazing fast websites and apps</p>\n<p><em><a href=\"https://www.gatsbyjs.org/\" target=\"_blank\" rel=\"nofollow\">Gatsby Offical Site</a></em></p>\n</blockquote>\n<p>Gatsby is the React-based static page generator.</p>\n<p>Personally, Gatsby’s biggest advantage is probably reaction-based. Already, this is a UI library loved by front-end developers around the world, so learning costs are relatively lower than <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"nofollow\">Hexo</a> based on ejs or <a href=\"http://jekyllrb-ko.github.io/\" target=\"_blank\" rel=\"nofollow\">Jekyll</a> based on Ruby.</p>\n<p>Also if you use project starters made by other people, you can quickly set up your project because you don’t have to make your own boilerplate code. And I used gatsby-starter-blog project starter.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gatsby new evan-blog https://github.com/gatsbyjs/gatsby-starter-blog</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>In addition to the starter I used, there are also many starters created by other developers, so you can browse github and choose a starter.</p>\n<p>Another unique thing is that Gatsby uses <a href=\"https://graphql.org/\" target=\"_blank\" rel=\"nofollow\">GraphQL</a> to fetch data within React component. Many developers are familiar with REST APIs, so it may be a bit awkward at first, but the concept itself is not that difficult. I think I can adapt quickly.</p>\n<h3 id=\"graphql\" style=\"position:relative;\">GraphQL<a href=\"#graphql\" aria-label=\"graphql permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>GraphQL(Graph Query Language) is literally a new concept of query language. This means that it is used as a means of questioning to import data from certain systems, such as SQL(Structured Query Language), which we often use.</p>\n<p>SQL is used to query the database to get the data stored in the database system, but GraphQL is used by clients to query the server to send data.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> frontmatters<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> thumbnail <span class=\"token keyword\">FROM</span> post <span class=\"token keyword\">WHERE</span> post_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">post</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">frontmatters</span>\n    <span class=\"token property\">title</span>\n    <span class=\"token property\">thumbnail</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>When using the REST API, the client simply sent a request to the endpoint provided by the server and received a predetermined structured response to use the data, but the client using GraphQL actively selects the data that they need and queries the server. It has the advantage of being able to.</p>\n<p>However, the advantage of the client’s ability to send a query for the desired schema can be disadvantageous in terms of security due to the nature of the client program giving control to the user. In addition, client developers may be writing slow queries because they are often less experienced with databases than back-end developers.</p>\n<p>For this reason, GraphQL’s backend system must take appropriate measures for this situation, and these shortcomings of GraphQL can be judged to be less stable than REST API, so it is rarely used in large-scale projects. <small>(In fact, developers’ opinions on GraphQL are also quite different)</small></p>\n<p>However, because Gatsby is a static site generator, the situation using GraphQL to blow queries is limited to compile time, not runtime, and slow queries aren’t really hurting the user, but the build is a bit slower. Therefore, it can be seen that these disadvantages are relatively offset environments.</p>\n<h3 id=\"lets-use-the-graphql\" style=\"position:relative;\">Let’s use the GraphQL<a href=\"#lets-use-the-graphql\" aria-label=\"lets use the graphql permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Gatsby provides a separate page to freely run queries in the local environment. This page serves as a kind of API document like Swagger. If you run the local server using the <code class=\"language-text\">gatsby develop</code> command and connect to<code class=\"language-text\"> localhost: 8000 / __ graphql</code>, you can see the query test page provided by Gatsby.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/42203ec8bbd0d883d511c96198e0d7c9/ddb69/query-test-page.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvUlEQVR42pWUiW6kMBBE+f/PzGQn4fbZNja40o2BHKvdmVgqeUayilfVhmaLEdETKATIcs7j9XZD3/YYhhHTOGEQTRPatsXMu9Ya86z+llJo7p3CoAjnyjnDaIOu04hLxpY3LLkgrhuscXhrZz5v4UMEMQyF72qsCiCXkLcNhQ2XZUFKCcov8HZBYcOyrChsKAaT8bixqR4NvHLw2ldZqoZGE5QO8DFhY9MoFbBKKShbFWTn/4FrsVyPth6OKekwIQpVYihGs4tXZKET/VxiKD0bR7gPGmbm2NpVGfqMnPOK18EipPXqcF3XfxoKoeLYbnY15kl39NnIwb4TfKbintKS/msohG8XYe3O8wNE5AMaOawnQnCZi1/3uI8I553w6JDpvFw7J7+ZUAbRMn7i/ZnIMpB3nrCRCZuD0IXPDhMbTDZ8u4cPCXkQQnjG3PV1KC+dgQv5d4TaHXRVl6Hj3O1MyGt5mnBiMzseQ+G4u+E5ZenPUHo6shC2QnjGPa7NTipTvg8Ggwn8MjwmPN+UUQmhATEhuTqUSkto/vQGIxsWVEN5l+VrIiKiS977/Usk97DngViJeQ7EHx3GiA9XrpC2+k2iPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"query test page\" title=\"\" src=\"/static/42203ec8bbd0d883d511c96198e0d7c9/6af66/query-test-page.png\" srcset=\"/static/42203ec8bbd0d883d511c96198e0d7c9/69538/query-test-page.png 160w,\n/static/42203ec8bbd0d883d511c96198e0d7c9/72799/query-test-page.png 320w,\n/static/42203ec8bbd0d883d511c96198e0d7c9/6af66/query-test-page.png 640w,\n/static/42203ec8bbd0d883d511c96198e0d7c9/d9199/query-test-page.png 960w,\n/static/42203ec8bbd0d883d511c96198e0d7c9/21b4d/query-test-page.png 1280w,\n/static/42203ec8bbd0d883d511c96198e0d7c9/ddb69/query-test-page.png 2684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>I also had very little experience with GraphQL, so I wasn’t very good at first, but after looking at this page for about 30 minutes, I was able to figure out how to query.</p>\n<p>My chosen starter gatsby-starter-blog basically contains Gatsby plugins for blogging using markdown, so<code class=\"language-text\"> markdownRemark</code>(to parse markdown files) or <code class=\"language-text\">imageSharp</code>(to parse image resources) Are added, but if you don’t see these query types, you need to install and add a plugin like gatsby-transformer-remark.</p>\n<p>If you roughly grasped Gatsby’s GraphQL interface by touching this and that on the <code class=\"language-text\">__graphql</code> page, it is now time to run the query directly using the<code class=\"language-text\"> useStaticQuery</code> hook within the React component.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useStaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query MyQuery {\n    markdownRemark(frontmatter: {title: {eq: \"Test Post\"}}) {\n      frontmatter {\n        title\n        date\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">markdownRemark</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">frontmatter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Test Post\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2020-05-09T12:57:08.000Z\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Since the example <code class=\"language-text\">useStaticQuery</code> hook only provides a static query, as the name suggests, the above query only retrieves data whose<code class=\"language-text\"> frontmatter.title</code> is exactly <code class=\"language-text\">Test Post</code>. If you try to pass a template string containing a variable as an argument to the <code class=\"language-text\">graphql</code> function, you get the following error.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Error: It appears like Gatsby is misconfigured.\nGatsby related `graphql` calls are supposed to only be evaluated at compile time, and then compiled away.\nUnfortunately, something went wrong and the query was left in the compiled code.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In other words, even if you include a variable in the template string you use as a query, this variable is only evaluated at “runtime,” so Gatsby doesn’t know what value this variable will contain when compiling the code.</p>\n<p>However, in order to create a blog post page, you must receive dynamic parameters through a URL such as <code class=\"language-text\">/posts/2</code>, and use this parameter to execute a query such as “Get the second post!“. In this case, the <code class=\"language-text\">pageQuery</code> is used.</p>\n<h3 id=\"create-pages-with-dynamic-parameter\" style=\"position:relative;\">Create pages with dynamic parameter<a href=\"#create-pages-with-dynamic-parameter\" aria-label=\"create pages with dynamic parameter permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The most basic function of a blog is that different contents must be expressed in the same UI template.</p>\n<p>In general, if these functions need to be implemented, the client receives and renders the data using the server’s HTTP API at runtime, or if the page requires SEO optimization, the server side rendering (SSR) server receives the data and then renders the rendered HTML. It is implemented by sending a response to the client.</p>\n<p>But, as you know, Gatsby is a static site generator. Therefore, it is not a method to dynamically receive and process data at runtime when the application is running, but to generate the actual page file after receiving data from Gatsby using GraphQL at compile time.</p>\n<p>If you don’t understand what this means, let’s take a look at the files in the <code class=\"language-text\">public</code> directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> evan-blog/public/page-data <span class=\"token operator\">&amp;&amp;</span> ll\n\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">2017</span>\ndrwxr-xr-x   <span class=\"token number\">5</span> evan  <span class=\"token number\">1525943656</span>   160B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">2018</span>\ndrwxr-xr-x  <span class=\"token number\">10</span> evan  <span class=\"token number\">1525943656</span>   320B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">2019</span>\ndrwxr-xr-x   <span class=\"token number\">7</span> evan  <span class=\"token number\">1525943656</span>   224B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">2020</span>\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">404</span>\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 <span class=\"token number\">404</span>.html\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 about\ndrwxr-xr-x  <span class=\"token number\">19</span> evan  <span class=\"token number\">1525943656</span>   608B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 categories\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 dev-404-page\ndrwxr-xr-x   <span class=\"token number\">3</span> evan  <span class=\"token number\">1525943656</span>    96B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 index\ndrwxr-xr-x   <span class=\"token number\">6</span> evan  <span class=\"token number\">1525943656</span>   192B  <span class=\"token number\">5</span> <span class=\"token number\">10</span> <span class=\"token number\">14</span>:34 page</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Since my blog post path is in the format <code class=\"language-text\">/2020/05/09/blog-title/</code>, So Gatsby created directories named <code class=\"language-text\">2020</code>, <code class=\"language-text\">05</code>, <code class=\"language-text\">09</code> and <code class=\"language-text\">blog-title</code> in the <code class=\"language-text\">public/page-data</code> directory at compile time. After that, create a file called <code class=\"language-text\">page-data.json</code> that contains HTML to render as a string in it again.</p>\n<p>Rather than fetching data dynamically at runtime and rendering the contents of the page, it means that when compiling, one page file per post should actually be created. If you understand this difference, you can handle static site generators a little more comfortably.</p>\n<p>This means that you do not have to fetch the data dynamically at runtime and render the contents of the page, but you must actually create one page file per post when compiling. If you understand this difference, you can handle static site generators a little more comfortably.</p>\n<h4 id=\"createpages-api\" style=\"position:relative;\">createPages API<a href=\"#createpages-api\" aria-label=\"createpages api permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Gatsby provides an API called <code class=\"language-text\">createPages</code> that allows users to freely create pages they want at compile time.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The first argument, <code class=\"language-text\">graphql</code>, is the same one that is called when using GraphQL inside a React component, and the second argument,<code class=\"language-text\"> actions</code>, is the same action we are talking about in <a href=\"https://haruair.github.io/flux/docs/overview.html\" target=\"_blank\" rel=\"nofollow\">Flux Architecture</a>.</p>\n<p>Gatsby manages state using <a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"nofollow\">Redux</a> internally, and since all of Gatsby’s APIs take this action list as an argument, we are free to use these actions to give commands to Gatsby. Among them, the action called <code class=\"language-text\">createPage</code> is an action that can issue a command to create a page.</p>\n<p>Now, we can think about this flow roughly.</p>\n<blockquote>\n<ol>\n<li>Using GraphQL, I get all the posts I’ve written.</li>\n<li>Create a page one by one by dispatching the <code class=\"language-text\">createPage</code> action while traversing the post data.</li>\n<li>Profit!</li>\n</ol>\n</blockquote>\n<p>Actually, it’s simpler so you don’t have to worry much about it. Then let’s create a post page.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> template <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/templates/Post.tsx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 1. Get all the posts</span>\n  <span class=\"token keyword\">const</span> allPostsQuery <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    allMarkdownRemark {\n        edges {\n          fields {\n            path\n          }\n          node {\n            id\n          }\n        }\n      }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 2. Create a page file by traversing the post data.</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">edges</span><span class=\"token operator\">:</span> posts <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> allPostsQuery<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">;</span>\n  posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> template<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">postId</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you write the page file creation logic using the <code class=\"language-text\">createPages</code> API like this, Gatsby does the rest of the troublesome work, which is very convenient.</p>\n<p>However, the <code class=\"language-text\">createPage</code> function simply creates a page file, and does not pass the post data to the <code class=\"language-text\">Page.tsx</code> component. Therefore, we can pass the customized data to the template component using the <code class=\"language-text\">context</code> option of the<code class=\"language-text\"> createPage</code> function, and we need to use this context data in the template component to get the post data again.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-tsx line-numbers\"><code class=\"language-tsx\"><span class=\"token comment\">// Post.tsx</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query PostQuery($postId: String!) {\n    markdownRemark(id: {eq: $postId}) {\n      fields {\n        path\n      }\n      frontmatter {\n        title\n        date\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Props</span> <span class=\"token punctuation\">{</span>\n  data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n  pageContext<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    postId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">PostTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> pageContext <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> frontmatter <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The variables passed to the component through the <code class=\"language-text\">context</code> option of <code class=\"language-text\">createPage</code> are injected into the <code class=\"language-text\">pageQuery</code> module inside the React component file.</p>\n<p>If you look at my query, you can see that the variable <code class=\"language-text\">postId</code> is used in the query type<code class=\"language-text\"> markdownRemark</code> as a parameter of the query, such as <code class=\"language-text\">query PostQuery ($ postId: String!) {}</code>. Through this process, we can create a page that can fetch data using dynamic values.</p>\n<p>In addition, Gatsby supports various actions such as <code class=\"language-text\">createRedirect</code> and<code class=\"language-text\"> createNode</code>, and you can also create interesting features by combining these APIs and actions. However, in fact, simple features such as pagenation, category, and tag page required for applications such as blogs can be implemented with just the <code class=\"language-text\">createPage</code> action.</p>\n<h2 id=\"the-annoying-parts\" style=\"position:relative;\">The annoying parts<a href=\"#the-annoying-parts\" aria-label=\"the annoying parts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>After learning the basics of Gatsby, I had to work on implementing all the features that were implemented with Hexo and the CSS styles provided by the Icarus theme. And it wasn’t a lie to spend my time here during this migration, so it was a tedious series of tasks.</p>\n<p>Of course, implementing all the features now can take too long, so I tried to implement features first that people often use or existing features that affect SEO, but the fact that I still have a lot of code to write hasn’t changed. So I aimed to work a little steadily with patience.</p>\n<h3 id=\"care-about-the-connection-with-the-existing-link\" style=\"position:relative;\">Care about the connection with the existing link<a href=\"#care-about-the-connection-with-the-existing-link\" aria-label=\"care about the connection with the existing link permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>One of the things to watch out for when migrating web services is that links to old pages shouldn’t die. For example, if the URL <code class=\"language-text\">/posts/1</code> before migration was a link to a page where you can see post 1, this rule must be the same after migration also.</p>\n<p>If this rule is broken, the user accessing the link will encounter <code class=\"language-text\">404</code> status. Since my blog post has already been shared through various channels, and is often linked as a reference post on another blog, I had no choice but to care about this part.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b8cf4a7419783c7dc8a53d556099190c/eea4a/whoami.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAP/2gAMAwEAAhADEAAAAYiE51kzRP/EABoQAAICAwAAAAAAAAAAAAAAAAECABIDESH/2gAIAQEAAQUC0IAsbIqksaWMbrf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQIBAT8BjL//xAAZEAABBQAAAAAAAAAAAAAAAAAAARARIdH/2gAIAQEABj8CNIEt/wD/xAAbEAEAAgIDAAAAAAAAAAAAAAABACERMUFhsf/aAAgBAQABPyF7B8mAWsUpC4uU03Gorc//2gAMAwEAAgADAAAAEFMf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERMf/aAAgBAwEBPxCMU//EABYRAQEBAAAAAAAAAAAAAAAAAAEAMf/aAAgBAgEBPxASbAv/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFRkf/aAAgBAQABPxBwhkQbajPZdFe+n2X/AGQ6I6oKrnUrhwHscUp1n//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"whoami\" title=\"\" src=\"/static/b8cf4a7419783c7dc8a53d556099190c/c08c5/whoami.jpg\" srcset=\"/static/b8cf4a7419783c7dc8a53d556099190c/0913d/whoami.jpg 160w,\n/static/b8cf4a7419783c7dc8a53d556099190c/cb69c/whoami.jpg 320w,\n/static/b8cf4a7419783c7dc8a53d556099190c/c08c5/whoami.jpg 640w,\n/static/b8cf4a7419783c7dc8a53d556099190c/6a068/whoami.jpg 960w,\n/static/b8cf4a7419783c7dc8a53d556099190c/eea4a/whoami.jpg 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If the existing link is not processed properly, the user will see the 404 page.</small>\n</center>\n<p>Also, problems may arise in the SEO aspect. If <code class=\"language-text\">404</code> status is returned from the old post link, the search engine bot will recognize the page as deleted, and the it can be disappear from the search results. If inevitably it is a situation where you need to change an existing link to another link, you must explicitly return the ‘301’ status code as a response to tell the search engine bot which link the <code class=\"language-text\">/posts/1</code> has changed to.</p>\n<p>Hexo provided a feature that automatically maps posts with the title <code class=\"language-text\">yyyymmdd-{postTitle}</code> to URLs in the form <code class=\"language-text\">/yyyy/mm/dd/{postTitle}/</code>, unfortunately Gatsby does not.</p>\n<p>The gatsby-starter-blog starter basically gets the path of each post markdown file and uses it as a URL as a boilerplate, but this method is different from Hexo’s URL generation method. So I had to do extra work so that the posts had the same URL as before.</p>\n<p>To do this, I wrote a simple code that creates a URL from the file path of each post and inserts it into the post node field with the key <code class=\"language-text\">path</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateNode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> actions<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNodeField <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">MarkdownRemark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> <span class=\"token function\">createFilePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n      <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(?&lt;=\\/)(\\d{4})(\\d{2})(\\d{2})(-)(?=.+)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'$1/$2/$3/'</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">slug</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      node<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> filePath<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">path</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      node<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The field of the node created through the <code class=\"language-text\">createNodeField</code> action is inserted into a <code class=\"language-text\"> field</code> property, and it can be accessed like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query PostQuery {\n    markdownRemark {\n      fields {\n        path\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Mapping the posts of these new blogs to have the same links as existing blogs wasn’t very difficult or complicated, but it was quite annoying because I had to work with care not to break even a single link.</p>\n<h3 id=\"make-it-all-by-myself\" style=\"position:relative;\">Make it all by myself.<a href=\"#make-it-all-by-myself\" aria-label=\"make it all by myself permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>When I using Hexo, I rarely had to develop it myself because I used the functions provided by the theme or actively used plugins. However, the reason for this migration was my blog was too dependent on themes or plugins, so I choose to implement the necessary functions directly.</p>\n<p>For example, I was rendering related posts using the <a href=\"https://github.com/tea3/hexo-related-popular-posts\" target=\"_blank\" rel=\"nofollow\">hexo-related-popular-posts</a> plugin before, but in the Gatsby ecosystem, I couldn’t find a useful one, so I implemented it myself like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-tsx line-numbers\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useMemo <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> intersection <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/intersection'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useAllPosts <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/hooks/useAllPosts'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">RelatedPosts</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tags<span class=\"token punctuation\">,</span> currentPost <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token function\">useAllPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> relatedPosts <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> posts\n      <span class=\"token comment\">// Filter out current post.</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>post <span class=\"token operator\">=></span> post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title <span class=\"token operator\">!==</span> currentPost<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// Finds duplicates between the tag of the current post and the tag of another post.</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>post <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        post<span class=\"token punctuation\">,</span>\n        tags<span class=\"token operator\">:</span> <span class=\"token function\">intersection</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags <span class=\"token operator\">??</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tags<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// Filter out posts without duplicated tags.</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tags <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> tags<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// Sorts in descending order of the number of duplicated tags.</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> b<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> a<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// Only the top 5 posts with the most duplicated tags are filtered out.</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MAX_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>currentPost<span class=\"token punctuation\">,</span> posts<span class=\"token punctuation\">,</span> tags<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In fact, it is quite simple logic because it is just simply finding the posts that have the most tags that overlap with the current posts.</p>\n<p>It’s annoying to have to implement all of this, but on the other hand, it it means that the freedom to implement the desired features has also increased. So it is Ok.</p>\n<h3 id=\"there-is-no-posting-creation-function-in-cli\" style=\"position:relative;\">There is no posting creation function in CLI.<a href=\"#there-is-no-posting-creation-function-in-cli\" aria-label=\"there is no posting creation function in cli permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Essentially, Gatsby isn’t dedicated to markdown blogs, it’s just a static site generator, so it doesn’t offer anything like post creation with CLI.</p>\n<p>However, it is too bored work to manually create a directory every time, rename a directory, and create a posting file. So I decided to write a very simple script and use it.</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-md line-numbers\"><code class=\"language-md\"><span class=\"token comment\">&lt;!-- example.md --></span>\n\n<span class=\"token hr punctuation\">---</span>\n\ntitle: $title\ndate: $date\ntags:\ncategories:\nthumbnail:\n\n<span class=\"token hr punctuation\">---</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You can create a new posting file by simply creating an example file and loading it when creating a new posting file, and changing only <code class=\"language-text\">$title</code> and<code class=\"language-text\"> $ date</code> to strings that you want.</p>\n<p>After that, you can use NodeJS <code class=\"language-text\">readline</code> API to receive the title of the post through system input during runtime, and record the post creation time in this markdown file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> new-post\n\n<span class=\"token function\">yarn</span> run v1.22.0\n$ <span class=\"token function\">node</span> ./scripts/newPost.js\n\nPlease enter the title of the posting.\nSince this title becomes the URL of the posting, it should be written <span class=\"token keyword\">in</span> English without spaces. <span class=\"token operator\">></span>\n <span class=\"token operator\">=</span><span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Of course, you can also input category or tag data in the same way, but I didn’t add any related features because I felt it wasn’t very useful because I often changed categories or tags while writing a post.</p>\n<p>Not only me, but other many developers are writing their own scripts to do this. Unlike my simple script, their scripts are nice and feature-rich, so let’s find them out.</p>\n<h2 id=\"epilogue\" style=\"position:relative;\">Epilogue<a href=\"#epilogue\" aria-label=\"epilogue permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When I first started migrating my blog, I thought it would take a month or so, but thanks to the Golden Holiday, the work ended faster than I thought.</p>\n<p>Although the design feels a bit clunky and buggy compared to the previous version, it has evolved into the first goal, “Application that can be add any feature that I want”, so I am satisfied.</p>\n<p>And during this migration, I removed Google AdSense from my blog.</p>\n<p>This is because there was a small amount of revenue coming from advertisements, and I thought that advertisements could cause fatigue to users who visit my blog. <small><strike>(You can make money with stocks and real esta…MMF..MMPH)</strike></small></p>\n<p>Anyway, the start was to attach the i18n function to the blog, but suddenly I migrated, so it seems to be a Yak shaving. But as a result, I’m happy to get away from Hexo so I can make this and that blog easier.</p>","fields":{"slug":"20200509-gatsby-migration-retrospectiveen","path":"/2020/05/09/gatsby-migration-retrospective/en/","lang":"en"},"frontmatter":{"title":"Migrating from Hexo to Gatsby","subTitle":"A Small Feature Turned into a Full Blog Migration… An Unexpected Journey of Migration","date":"May 15, 2020","categories":["Programming","Tutorials"],"tags":["Gatsby","Hexo","Migration","Developer","Developer Blog","Yak Shaving"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/8e1cc1a52ffd263af7247d9f38008f4c/d803c/thumbnail.png","srcSet":"/static/8e1cc1a52ffd263af7247d9f38008f4c/d803c/thumbnail.png 320w,\n/static/8e1cc1a52ffd263af7247d9f38008f4c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/8e1cc1a52ffd263af7247d9f38008f4c/fc5c5/thumbnail.webp 320w,\n/static/8e1cc1a52ffd263af7247d9f38008f4c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/8e1cc1a52ffd263af7247d9f38008f4c/01fb2/thumbnail.png","srcSet":"/static/8e1cc1a52ffd263af7247d9f38008f4c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/8e1cc1a52ffd263af7247d9f38008f4c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"595df78d-0005-5204-ba0c-50755781c626","tableOfContents":"<ul>\n<li>\n<p><a href=\"#everything-is-built-from-function-composition\">Everything Is Built from Function Composition</a></p>\n<ul>\n<li><a href=\"#domains-and-ranges-must-match-for-composition\">Domains and Ranges Must Match for Composition</a></li>\n<li><a href=\"#side-effects-exist-even-in-pure-functions\">Side Effects Exist Even in Pure Functions</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-should-we-manage-side-effects\">How Should We Manage Side Effects?</a></p>\n</li>\n<li>\n<p><a href=\"#what-is-a-functor\">What Is a Functor?</a></p>\n<ul>\n<li><a href=\"#categories\">Categories</a></li>\n<li><a href=\"#functors\">Functors</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lets-build-a-functor\">Let’s Build a Functor!</a></p>\n<ul>\n<li><a href=\"#just\">Just</a></li>\n<li><a href=\"#nothing\">Nothing</a></li>\n<li><a href=\"#maybe\">Maybe</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"Writing code in functional programming means expressing the various tasks a program needs to perform as functions, then skillfully composing those functions to build a large program. Function composition is the very foundation of this paradigm, which makes it enormously important. The problem is th…","html":"<p>Writing code in functional programming means expressing the various tasks a program needs to perform as functions, then skillfully composing those functions to build a large program.</p>\n<p>Function composition is the very foundation of this paradigm, which makes it enormously important. The problem is that all sorts of practical issues pop up during the process of composing functions.</p>\n<p>The biggest reason these issues arise is simple. No matter how much we use pure functions, they can never be perfectly identical to mathematical functions. Programming and mathematics are similar but fundamentally different disciplines.</p>\n<p>So brilliant minds around the world started bringing in mathematical concepts like functors and monads to solve these problems. The catch? These concepts are far too abstract and arcane to understand intuitively.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ef8b4abd3bbf9916883c3115a00bab71/eb645/functor-example.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR42n1SPUsDQRB9+TAfl9xdssnlvBhP0YgWIRZBSRfwi4C2dqksLAQLK8vr7AIWgljY5BfYCoKtf8JSwcbOOs5cZuMi0YHH7u2+nXlvboCfmDOQwP+RFF56Fp8vHYJrrK4QZwWfl4RrIhnf0k6dAcUpPRon0bvhb0VI/UqW3gEWIiCjD4LTNwudS1eKAGVS8wXUnwCfH3jHz83i+btH+zzB1olkdUZA7RVoP9KK/r1XGrxsBtHYEm4+tvABzF8jF7Iie+92DScPtvSlQlgkbIiCKqv7BMJ1EgErDDLM70VcMAdxquUr6Z2lK1F4ExPxXQBxQVgGJ5y0xBd1GZ0wttWZNDtVOFxp1a+2Kmpb6WbD+IucPEdSljiRvVuvlAftVmN4oBC6ZRET28pOm3x3VHUuugqFQm3GT2EVVV2gMewqf7RfU/2mI3ni8A27WalS+mNs2O6qPLZkVDQ/Zc5hQshFUfHXYCcMfl5akjUZ31tXJv6WZZGyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"functor example\" title=\"\" src=\"/static/ef8b4abd3bbf9916883c3115a00bab71/6af66/functor-example.png\" srcset=\"/static/ef8b4abd3bbf9916883c3115a00bab71/69538/functor-example.png 160w,\n/static/ef8b4abd3bbf9916883c3115a00bab71/72799/functor-example.png 320w,\n/static/ef8b4abd3bbf9916883c3115a00bab71/6af66/functor-example.png 640w,\n/static/ef8b4abd3bbf9916883c3115a00bab71/d9199/functor-example.png 960w,\n/static/ef8b4abd3bbf9916883c3115a00bab71/21b4d/functor-example.png 1280w,\n/static/ef8b4abd3bbf9916883c3115a00bab71/eb645/functor-example.png 2500w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A functor explanation diagram that makes you want to cry just looking at it...</small>\n</center>\n<p>When I was studying functors and monads, the resources I found through Google fell into roughly two categories: “terrifyingly difficult mathematical explanations” and “code examples.”</p>\n<p>The problem was that there were very few resources bridging the gap between the two. In other words, I couldn’t find many resources that clearly explained exactly which programming problems functors and monads were introduced to solve. <em>(Or maybe everyone else understood and I was just too dense to get it.)</em></p>\n<p>But I didn’t want to use functors and monads without properly understanding why, so I decided to investigate and figure it out myself.</p>\n<p>In this post, I want to talk about what problems arise when you carelessly combine functions in functional programming, and how those problems can be solved.</p>\n<h2 id=\"everything-is-built-from-function-composition\" style=\"position:relative;\">Everything Is Built from Function Composition<a href=\"#everything-is-built-from-function-composition\" aria-label=\"everything is built from function composition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Let me say it again: functional programming is a paradigm where you express a program’s tasks as functions, then compose those functions to build a large program.</p>\n<p>The most important keyword in this definition is “function composition.” The reason functional programming is so vigilant about side effects is ultimately because you need to be able to predict a function’s inputs and outputs in order to compose functions safely.</p>\n<p>In the world of functional programming, every action inside a program is expressed as a function — even assigning a value to a variable or performing simple arithmetic.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token comment\">// Imperative programming</span>\n<span class=\"token keyword\">const</span> foo<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nfoo <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Functional programming</span>\n<span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> add2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">add2</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This program simply declares a <code class=\"language-text\">number</code> variable and adds 2 to it.</p>\n<p>In the imperative version, variable assignment could be expressed as simply as <code class=\"language-text\">foo = 1</code>, and the operation as <code class=\"language-text\">foo + 2</code>. In the functional version, the assignment becomes a function that returns <code class=\"language-text\">1</code>, and the operation becomes <code class=\"language-text\">add2(foo)</code>.</p>\n<p>The part we should focus on is the very last line: <code class=\"language-text\">add2(foo)</code>.</p>\n<p><code class=\"language-text\">add2(foo)</code> means using the output of the anonymous function assigned to <code class=\"language-text\">foo</code> — the value <code class=\"language-text\">1</code> — as the input to <code class=\"language-text\">add2</code>. This act is function composition.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token comment\">// A more simplified version looks like this</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">add2</span> <span class=\"token operator\">=</span> x <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">add2</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In a world where even simple operations like assigning values and adding numbers must be expressed as functions, building a robust large-scale program hinges on how well you can compose various complex functions.</p>\n<p>This might seem like a simple concept, but you can’t just compose any functions willy-nilly. There’s one critically important rule for function composition: the <strong>domain and range of the functions being composed must match</strong>.</p>\n<h3 id=\"domains-and-ranges-must-match-for-composition\" style=\"position:relative;\">Domains and Ranges Must Match for Composition<a href=\"#domains-and-ranges-must-match-for-composition\" aria-label=\"domains and ranges must match for composition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As I discussed in <a href=\"/2019/12/29/about-pure-functions/\">Pure Functions – A Programming Paradigm Rooted in Mathematics</a>, functional programming uses pure functions to minimize side effects.</p>\n<p>The two key characteristics of pure functions are:</p>\n<blockquote>\n<ol>\n<li>Don’t modify or reference state outside the function!</li>\n<li>Given the same input, always return the same output!</li>\n</ol>\n</blockquote>\n<p>Using pure functions makes it easier for developers to predict function behavior, which helps with debugging. But more fundamentally, if these rules aren’t followed, functions can’t be composed at all — making it impossible to build programs by expressing everything as functions and combining them.</p>\n<p>Why do these rules need to be followed for composition to work? Since pure functions are a programming implementation of mathematical functions, let’s first look at how mathematical functions behave.</p>\n<p>Mathematical functions have a domain — the set of possible input values — and a range — the set of possible output values.</p>\n<p>Each element in the domain must map to exactly one element in the range. In other words, the same input must always produce the same output. If this rule breaks, it’s no longer a function — it becomes something else entirely.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/33c48b0d809a227af542dee05cf064b5/80cfc/functions.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVR42m2T207DMAyG3axt0tM6YBsgJC6QuNlASLvhqXggXoEX4zGK034GD7D0K4kPvx07ERE5Kk6KR0Uhi7SKF8U9OtNfK14Vz4pRfuQBXZMPSdFDYrLi3DqyLAHfTlE6fUIXBYdKscaQCTbok2VFGnQt/gUkl6ydsedsA4YctFdcucwmPdVnny22C8UNLcj+38xrKsv7HYSBcwAtyRtg5NFVPx8yagIqSBIBRmh9DfjYviE22jUi1fkK91wp/ENYYr8jZuTKAz5nldhgrJcFfQtuv6LCLf2ztbIBtrBvMNRk3PnJIR1Bg3tmeb1F19jkLLBw78omXDvC2pEm9zZtML38aeyb4mO+VvKNdhKx1QfFtPS0dEOiqnG+8kne9Qt9zk0Xmc5+yW95UsLDtHxZdV18vwAdIhBsPqNo7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"functions\" title=\"\" src=\"/static/33c48b0d809a227af542dee05cf064b5/6af66/functions.png\" srcset=\"/static/33c48b0d809a227af542dee05cf064b5/69538/functions.png 160w,\n/static/33c48b0d809a227af542dee05cf064b5/72799/functions.png 320w,\n/static/33c48b0d809a227af542dee05cf064b5/6af66/functions.png 640w,\n/static/33c48b0d809a227af542dee05cf064b5/d9199/functions.png 960w,\n/static/33c48b0d809a227af542dee05cf064b5/21b4d/functions.png 1280w,\n/static/33c48b0d809a227af542dee05cf064b5/80cfc/functions.png 1844w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Simply put: pick one value from the designated set of possible inputs and throw it into the function, and exactly one value from the designated set of possible outputs will come out.</p>\n<p>If that’s true of mathematical functions, then pure functions — their programming counterparts — must also have something equivalent to a domain and range. What would those be in the programming world?</p>\n<center>\n.<br />\n.<br />\n.<br />\n<br />\n</center>\n<blockquote>\n<p>They’re <strong>types</strong>.</p>\n</blockquote>\n<p>If you think about it, types in programming are really a kind of set. The <code class=\"language-text\">number</code> set contains elements like <code class=\"language-text\">{-1, 0, 0.1, 1, 2, NaN, Infinity...}</code>, the <code class=\"language-text\">boolean</code> set contains <code class=\"language-text\">{true, false}</code>, and the <code class=\"language-text\">string</code> set contains every string that can be created programmatically.</p>\n<p>Looking at the <code class=\"language-text\">add2</code> function from earlier, we can see it takes a <code class=\"language-text\">number</code> type value and returns a <code class=\"language-text\">number</code> type value.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> add2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>We can say that <code class=\"language-text\">add2</code> has <code class=\"language-text\">number</code> as both its domain and range. We can define the domain and range of other function types using the same rules.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">f</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Domain: number, Range: string</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">g</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Domain: Array&lt;string>, Range: boolean</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">h</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Domain: string, Range: boolean</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The commonalities between mathematical functions and programming pure functions are starting to become clearer.</p>\n<p>Now let’s get to the main topic: function composition. In mathematics, composing functions is extremely common — there’s even a dedicated symbol for it.</p>\n<p>The composite function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span></span> of functions <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span> can be expressed with this simple formula:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>h</mi><mo>=</mo><mi>g</mi><mo>∘</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">h = g\\circ f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∘</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span></div>\n<p>If the sudden math gives you a headache, just think of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> as “eating a meal,” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span> as “clearing the dishes,” and the composite function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span></span> as “eating a meal and clearing the dishes.” Functions are inherently that abstract.</p>\n<p>In this formula, functions execute from right to left. Using the composite function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span></span> as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></span> is actually identical to composing functions as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g(f(x))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">))</span></span></span></span></span>.</p>\n<p>But if we keep nesting functions to represent composition, any formula with many composed functions would be nothing but parentheses. That’s why we use the circle operator to lay out the composed functions in a readable way. <em>(Think of the difference between callbacks and async/await.)</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Without a composition operator, it would look something like this...</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token function\">g</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>When composing functions, there’s an important principle: the range of the first function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> must match the domain of the next function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span>.</p>\n<p>Since we said that a pure function’s domain and range are types, we can also say that the first function’s output type must match the next function’s input type.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token comment\">// Composition is possible!</span>\n<span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">number</span>\n<span class=\"token function-variable function\">g</span><span class=\"token operator\">:</span>           <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">number</span>\n\n<span class=\"token comment\">// This can't be composed...</span>\n<span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n<span class=\"token function-variable function\">g</span><span class=\"token operator\">:</span>           <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">number</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The domain-and-range talk might have sounded complicated, but translating it to types makes it blindingly obvious. So if we use pure functions and follow this rule, are we free from problems?</p>\n<p>Well, in most cases yes — but sadly, not all. The programming world has cases that don’t exist in mathematics, like errors and uncertainty.</p>\n<p>Even pure functions — programming implementations of mathematical functions — can’t escape these cases as long as they exist in the programming world.</p>\n<p>Because these problems persist even with pure functions, brilliant minds around the world started wondering “how can we safely compose functions?” — and the concepts they introduced to answer that question were mathematical ideas like functors and monads.</p>\n<h3 id=\"side-effects-exist-even-in-pure-functions\" style=\"position:relative;\">Side Effects Exist Even in Pure Functions<a href=\"#side-effects-exist-even-in-pure-functions\" aria-label=\"side effects exist even in pure functions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>“Side effect” literally means “secondary effect.”</p>\n<p>Any secondary effect that occurs beyond what we expect from a function is a side effect. A function being affected by external state is just one representative example.</p>\n<p>Compared to mathematical functions, pure functions are actually quite flimsy beyond the guarantee that “the same input always produces the same output.” Consider a function that takes a string and returns its first character:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getFirstLetter</span> <span class=\"token punctuation\">(</span>s<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>This is a pure function. Its output depends only on its argument, it always returns the same output for the same input, and it’s not affected by any external state.</p>\n<p><code class=\"language-text\">getFirstLetter</code> is a pure function that returns the first character of a given string — but if an empty string is passed as an argument, it will return <code class=\"language-text\">undefined</code> instead of a <code class=\"language-text\">string</code>.</p>\n<p>Can we really guarantee that this function will always return a <code class=\"language-text\">string</code> type?</p>\n<p>If we assumed <code class=\"language-text\">getFirstLetter</code> would definitely return a <code class=\"language-text\">string</code> and composed functions accordingly, we’d run into a type error like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getStringLength</span> <span class=\"token punctuation\">(</span>s<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">getStringLength</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Uncaught TypeError<span class=\"token operator\">:</span> Cannot read property <span class=\"token string\">'length'</span> <span class=\"token keyword\">of</span> <span class=\"token keyword\">undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Even this error is a side effect. It’s a secondary effect occurring beyond what we expected from our pure function.</p>\n<p>When multiple functions are composed and even a single one throws an error, the entire composed operation falls apart. That’s why we must manage these side effects.</p>\n<p>In truth, <code class=\"language-text\">getFirstLetter</code>’s range isn’t just <code class=\"language-text\">string</code> — it’s a <code class=\"language-text\">string|undefined</code> union. So we could solve this by redefining both functions’ domains and ranges and adding error handling:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getFirstLetter</span> <span class=\"token punctuation\">(</span>s<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token operator\">|</span><span class=\"token keyword\">undefined</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getStringLength</span> <span class=\"token punctuation\">(</span>s<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token operator\">|</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>But once a function starts having a range that’s a union of multiple types, every function that composes with it also needs a domain that’s a union — resulting in cancerous types like <code class=\"language-text\">type|undefined</code> spreading across every function.</p>\n<p>On top of that, checking for value existence inside every function with conditional logic is tedious, and duplicating the same code everywhere means this isn’t a fundamental solution.</p>\n<p>This uncertainty about what type a function might return ultimately hinders clear type usage during composition — where domains and ranges must match — making it a side effect we absolutely must address.</p>\n<h2 id=\"how-should-we-manage-side-effects\" style=\"position:relative;\">How Should We Manage Side Effects?<a href=\"#how-should-we-manage-side-effects\" aria-label=\"how should we manage side effects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The reason this happens is simply that “computers aren’t math.” Every function running in a program has these issues. Even pure functions.</p>\n<p>Fundamentally, the question is: how can we manage the unavoidable side effects that arise during function composition?</p>\n<p>Can we safely complete a composed operation even if a function in the middle throws an error? Can we make uncertain function outputs clear before passing them to the next function?</p>\n<p>What if we wrap the function in another function that safely handles exceptions, or skip the next function if a weird value comes out?</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">StringFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">safety</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token operator\">|</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> fn<span class=\"token operator\">:</span> StringFunction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">?</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">safety</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">safety</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">1</span>\n<span class=\"token keyword\">undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>But this approach seems hard to apply to functions with all sorts of input/output types, so let’s make it more flexible with generics.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">safety</span> <span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token operator\">|</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">?</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token generic-function\"><span class=\"token function\">safety</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token generic-function\"><span class=\"token function\">safety</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">1</span>\n<span class=\"token keyword\">undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Now we’re getting somewhere. Essentially, the <code class=\"language-text\">safety</code> function takes a value of <code class=\"language-text\">T</code> or <code class=\"language-text\">undefined</code>. If the value is <code class=\"language-text\">undefined</code>, it returns <code class=\"language-text\">undefined</code> as-is. Otherwise, it passes the value to a function that takes <code class=\"language-text\">T</code> and returns <code class=\"language-text\">U</code>, and returns that function’s result.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">Has value<span class=\"token operator\">:</span>    <span class=\"token constant\">T</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> fn<span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span>\nNo value<span class=\"token operator\">:</span>     <span class=\"token constant\">T</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token keyword\">undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Instead of directly connecting <code class=\"language-text\">getFirstLetter</code>’s range to <code class=\"language-text\">getStringLength</code>’s domain, we’ve safely composed the functions by wrapping the side effect with <code class=\"language-text\">x ? fn(x) : x</code> logic.</p>\n<p>What if we extended this concept — what if some kind of safety wrapper always surrounded a function’s output value? If we could create something that wraps both a function’s normal result and its side effects, couldn’t we solve this problem?</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4ff50b03adf61a44030b6872ee2fdcce/f793b/set.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADyElEQVR42m2UW08bRxTH3TxFbb9bHppW9KtUavvSN3ipqpZGitJcheglCQQQpFWt0AawZ/bi9QXstbnULgaMvFdj452Zf8/smsSorHR07J3Z37mfXG7qAXAr1af5jxEVZzAqLZC4uLAHGFgxRraLsbMA35jRd7Jvvr6Vu+m5OoDH7iJgLuQuzjqbyi0twbVfoNvcQLO8hMP6uoKsQQbFJkLjk2lHpmC5D1LtF2YhasClo+iyzK/+KB7Mf6We3f8GfPMJHnz/pbr37RcCPpMYlxVEFfCLc9MMTc9gkTELNEA6EYEpETJgYEJFBmTISXOM+ztI/CLd4YDHJZ0JwAVCPnctfPj8M21NRqZoeueKewJH/ilUwPTl90JwLck+x6VNBhpMqZCgUnvKP81g//IPMXQqSEo48Lrybw8oeApaHwdtAhWgNCwgiTnEPxwjRmJmetyk8EUZuCiV0d34KEcVnNEWRr4tmZcQDKnskFjeCCI0kYY/gY4cjqHBMDRZpi0GeU5QRbmPzM9zcuA8A6o49fbFFkGKfYWClgnUDxqpl9o7ecIwti1yqATh2KRtJJaFpM0ol3uUc+tRTsZmnUzh0D+RbwnAfEmwTPT/Y1+HvQNFQNU20fn9D5RfPEd95RWqyy/RWl3TOaWwHTJqOjkZGREihv3IV6vNPh7+WcDCdhlP3nC8PhqgE51RqBlQHppoE3D93jzW5n+A9evPqC+/ouJwhcsSGTa6OaKmQDfw1JtTge+eb+D+6y0sFqrY7CkcBRqYhTxuMYhSCbsry/jr8SO01teoOCYu95iiidLAE8qhRSGbaHk9uR0A641jrNQ6yLc9bPlA2z9OPcTAwHifobmyBvu3X1BdeonNxz/BWFzE2KWQk/Ik5GHpKVBB2+sInTMzUjBjgAcKukhnwUGaQ8QGRJsjLhQQswIGJBe8iGh7RxuiotRB7fcwJy7KM1BVeP6e3NYtc1XltNISg6BCwGw61Dk1tGVck5FJhrrUNrrK1IJTjV2F3Y9TKJtUuOYH73swnRTK4y71IiexJtohWEJGR04ZNjW2foQePVmBFzbFdh9KT0mRoHFQS717NykElL0MNiyScKZEl/KHXbpn3r22tmSYLYcgcpMj6sk4rGUNPT3LYTZ+qpdWXIkzvRxaurqz19bY1caR/eKczicSW1GrSBVwQRD1DhZwlb6LKExZVVB7U+srY0xv62yNhewOhelCUdXQoJ1X0fsxE/1bv9Nn6YJld26E/W97H+Rv63VE6+spbe8aLdRz8q6nf6fv6AzI377p4/8ApEvjlY5UrW0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"set\" title=\"\" src=\"/static/4ff50b03adf61a44030b6872ee2fdcce/6af66/set.png\" srcset=\"/static/4ff50b03adf61a44030b6872ee2fdcce/69538/set.png 160w,\n/static/4ff50b03adf61a44030b6872ee2fdcce/72799/set.png 320w,\n/static/4ff50b03adf61a44030b6872ee2fdcce/6af66/set.png 640w,\n/static/4ff50b03adf61a44030b6872ee2fdcce/d9199/set.png 960w,\n/static/4ff50b03adf61a44030b6872ee2fdcce/21b4d/set.png 1280w,\n/static/4ff50b03adf61a44030b6872ee2fdcce/f793b/set.png 1404w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>If that abstract something could manage function side effects while enabling composition with other functions, we could compose freely without handling exceptions at every step — maintaining type safety for function inputs and outputs.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token comment\">// Something like this!</span>\nf<span class=\"token operator\">:</span> Something<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> Something<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span>\ng<span class=\"token operator\">:</span>                      Something<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> Something<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>A function might return a proper value from its range, or it might return a value like <code class=\"language-text\">null</code> or <code class=\"language-text\">undefined</code> that could cause side effects. But as long as that <code class=\"language-text\">Something</code> can handle exceptions on its own, we can compose functions without worrying about those details.</p>\n<p>And with this approach, beyond just managing <code class=\"language-text\">null</code> or <code class=\"language-text\">undefined</code>, we could wrap various kinds of logic around values — making it a reasonably extensible concept. Something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">Maybe<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> The value may or may not exist\n<span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> No value right now<span class=\"token punctuation\">,</span> but you<span class=\"token string\">'ll get one when it'</span>s ready\nList<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> May contain multiple values <span class=\"token keyword\">of</span> the same kind</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>And to use this value-wrapping something effectively, we’d need to freely transform the internal value — so we’d also need something capable of operations like <code class=\"language-text\">Maybe&lt;T> -> Maybe&lt;U></code>.</p>\n<p>After this kind of deliberation, developers borrowed a mathematical concept that serves a similar role. That concept is the <strong>functor</strong>.</p>\n<h2 id=\"what-is-a-functor\" style=\"position:relative;\">What Is a Functor?<a href=\"#what-is-a-functor\" aria-label=\"what is a functor permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Functors are commonly explained as some kind of box that holds a value. As I described above, a box is an apt metaphor for something that can wrap and handle both a function’s normal results and its side effects.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/340a17df74756ac7c3e06a5a4eaa74fb/78597/fmap_just.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVR42mVQTUvEMBDtr9ejB8+uiseCCMJ6dNnjgqigtFnWfmT7kSZtYpsE048kZld2EX0wwzAzj3lvPGutMcYe4Gqtdcd5EkdScNeBECgl9yNr9GT2+Fn29KSPRCokSDNGG1SRxeI+266zHK1W87bF6ksFGXoN1r0UbjVO4wJjb3brE1oLKbv2M4DFbPkM8ooQEiURY9Sp6IdhnDQl+B2iywcfJGveydPri3P/xju5Onv7AASTsiy5lI9B/LKteNc2lAkhD152mcn+bjnfwI1T8RSGII08WCHnUClVYYwQitNEDYP9B8fXeirzAkIYAsAo3Xl24S6Q2iklTdOQuh6n8c8Xf7/TWHPEN7KLTgVWzdmZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"fmap just\" title=\"\" src=\"/static/340a17df74756ac7c3e06a5a4eaa74fb/6af66/fmap_just.png\" srcset=\"/static/340a17df74756ac7c3e06a5a4eaa74fb/69538/fmap_just.png 160w,\n/static/340a17df74756ac7c3e06a5a4eaa74fb/72799/fmap_just.png 320w,\n/static/340a17df74756ac7c3e06a5a4eaa74fb/6af66/fmap_just.png 640w,\n/static/340a17df74756ac7c3e06a5a4eaa74fb/78597/fmap_just.png 947w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>[Source] http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html</small>\n</center>\n<p>This box might contain logic that helps you use values safely, logic that can process multiple values, logic that makes values available once they’re determined in the future — it’s a magical box containing various kinds of logic that assist in using values.</p>\n<p>Since this box isn’t limited to a fixed role and can have various capabilities like <code class=\"language-text\">Maybe</code> or <code class=\"language-text\">Promise</code>, it’s also called a “context.”</p>\n<p>The <code class=\"language-text\">safety</code> function we created earlier can be thought of as a kind of box wrapping values.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">safety</span> <span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token operator\">|</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">?</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<center>\n  <div style=\"width: 200px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/2a4ed3a1c967bb8474d5ef04b59bb091/27b7a/box.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 110.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLUlEQVR42pVVW1NSURTG0uk31G91GpvqoR7qoZesqV50SisrdZTwAU1L4JwDnAscQJT7XS4HEBTPOV9rby6Bxowy87HX3mt9315r783C4aAPsHqXjTEb9zw1SIdV9Lx1GFILLamNltgkkO0/Q0sg29eAQXE9TxV+EZjra+COY2DM0NcM3O7ZCioPiFgOdIA/pxf2WiAOhlffXPjkCWFpP4DNcBr7hbYd7AJi0y6VUb4PcXFuTEucozwW0BROLo1ASaj1TF8T2M2d4dnSdzx5v4J3Lg+ek/3GeYCnH1bhjFcgtAAWyzi24UvAEB4xLQcM32MgAVzIltWRoTY6EOo2xLoJX+2SbBMBIkuGRWs9HOQNSA3yUYza6IJx0FNMrtESFhz2eTCNswAsQ7AoS5hNPy6bwT5ach9jc7OtjOYslnFsQzRxTsJdJeqgcumYJeawyQG7Id0OBuOKFhdsSRkHTZpo006GaJdPEsjoOWQjk8joWY7r6zmUjxOM2xdsiiRo0PG2JVgNyc6E80ioRSS1f0ioBWT1CgmccnvSV+SixLXoDtixZScFyZnUCkiF+khqeRIqQ9yTIewGuc3W/vkLPPMbCya0HErxOtZXtrC2vIFivHY7wfR/Su6jMCr/asnp8JSS2aWU4kkwUZbpOLJ6nuPqOostEmd4KWOC/D3ZdEv0DPy3A3FGz2ZCkDJkTuuW4ILGFMFkRUG4qEEnhIsqIuUQQgWFzyOlEMIFlY/6ICZU0JAoK6MMecnW4AxNEmRBKkFjwUQMZoOI1WIIV8KQczKO6jG+FqKNtEEs45jGFMFoSYVKWcSqEezKbrx8+wLrez+w7dmC07uNHdEFl+8nfql7iJ7qPJZxJgSHPz0mGCGnRmVEKjp8cS8+u1bxdecLljeXsPl7A4sfX8PpIWHBxTe9Ktj/6bHmMCyZZThWMoNO4kpOgZc2iFSjOIx5uNCo5HFB3hzO5RQ6vH3ZaboUlmX0GjQcVUKIFBU+Dtd1urgUccBa3wWNXZm1L9ZpT6jBKrQLLU5DV54cR5Bh91TeYOkJPaS/APcsPep5qv+YkKa0U3y8GYaxx3Rs80zrL1W5GIz1y+BDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"box\" title=\"\" src=\"/static/2a4ed3a1c967bb8474d5ef04b59bb091/6af66/box.png\" srcset=\"/static/2a4ed3a1c967bb8474d5ef04b59bb091/69538/box.png 160w,\n/static/2a4ed3a1c967bb8474d5ef04b59bb091/72799/box.png 320w,\n/static/2a4ed3a1c967bb8474d5ef04b59bb091/6af66/box.png 640w,\n/static/2a4ed3a1c967bb8474d5ef04b59bb091/27b7a/box.png 804w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>A box that executes `fn(x)` if `x` has a value, or returns `x` as-is if it doesn't</small>\n  <br>\n  <br>\n</center>\n<p>The point is that instead of using the value <code class=\"language-text\">x</code> directly, we’re putting <code class=\"language-text\">x</code> into the <code class=\"language-text\">safety</code> function — so we can think of the <code class=\"language-text\">safety</code> function as a kind of box.</p>\n<p>Conceptually, that’s really all there is to functors. From here, you just need to learn how to implement them and you’re good to go. But since this post aims to dig deeper into what functors really are, I want to talk about the more fundamental concept behind them.</p>\n<h3 id=\"categories\" style=\"position:relative;\">Categories<a href=\"#categories\" aria-label=\"categories permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A functor is a concept from Category Theory in mathematics, defined as a structure that can define relationships between categories that share the same structure.</p>\n<p>To understand what a functor fundamentally is — and why we need functors for safe function composition through <code class=\"language-text\">Something&lt;type></code> — you need to know what a category is.</p>\n<p>The mathematical concept of a category isn’t actually that different from how we use the word “category” in everyday life. It’s roughly… a grouping of similar things.</p>\n<p>With that relaxed mindset, if you search for Category Theory on Wikipedia, you’ll find something like this:</p>\n<blockquote>\n<p>A category <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal {C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.05834em;\">C</span></span></span></span></span> consists of the following data:</p>\n<ul>\n<li>A collection <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span> of <strong>objects</strong>. Elements of this collection are called “objects” of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>.</li>\n<li>For any two objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>∈</mo><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a,b \\in ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span>, a collection of <strong>morphisms</strong> <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon a\\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> from <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>. The collection of all morphisms in <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span> is denoted <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\hom(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span>.</li>\n<li>For any three objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi><mo>∈</mo><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a,b,c\\in ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span>, a binary operation <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>×</mo><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo>→</mo><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\hom(a,b)\\times \\hom(b,c)\\to \\hom(a,c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></span>, called <strong>composition</strong> of morphisms. The composition of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon a\\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>b</mi><mo>→</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">g\\colon b\\to c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></span> is denoted <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>∘</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">g\\circ f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∘</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">gf</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span>.</li>\n</ul>\n<p>…</p>\n<p><strong>Wikipedia</strong> <em><a href=\"https://en.wikipedia.org/wiki/Category_(mathematics)\" target=\"_blank\" rel=\"nofollow\">Category (mathematics)</a></em></p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 420px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7d059800d070c80898d9648585a46696/65f94/what.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAHSEoDQlKv/xAAbEAAABwEAAAAAAAAAAAAAAAAAAQIDEiEyEf/aAAgBAQABBQKfQ5IJXTWnMpOv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/AVxsv//EABYRAAMAAAAAAAAAAAAAAAAAABARIf/aAAgBAgEBPwFQf//EABcQAAMBAAAAAAAAAAAAAAAAAAABEiD/2gAIAQEABj8CFGf/xAAZEAEBAAMBAAAAAAAAAAAAAAABABEhMUH/2gAIAQEAAT8hEsEwL10kSvYa7xDYO+ST/9oADAMBAAIAAwAAABBLD//EABYRAQEBAAAAAAAAAAAAAAAAAAARMf/aAAgBAwEBPxDAS//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxAJgn//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMWFBUf/aAAgBAQABPxAiOLp5M9dWd87GZ42v2Xs2A1X2AUBRU7TBGsJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"what\" title=\"\" src=\"/static/7d059800d070c80898d9648585a46696/65f94/what.jpg\" srcset=\"/static/7d059800d070c80898d9648585a46696/0913d/what.jpg 160w,\n/static/7d059800d070c80898d9648585a46696/cb69c/what.jpg 320w,\n/static/7d059800d070c80898d9648585a46696/65f94/what.jpg 420w\" sizes=\"(max-width: 420px) 100vw, 420px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Huh...?</small>\n</center>\n<p>The general idea of category theory is actually something anyone can understand. It’s just that mathematics is inherently abstract, and explaining things in everyday language would be too long and complex, so mathematicians use condensed words and symbols. <em>(This is honestly one of the reasons people give up on math.)</em></p>\n<p>As I mentioned, a category in math is basically the same concept as categories on a shopping site. The difference is that mathematical categories are more abstract — they could be categories of objects, of natural numbers, or even of functions.</p>\n<p>According to the definition above, a category consists of “objects” and “morphisms.”</p>\n<p>An object is simply an item within a category. In a fashion shopping site’s product category, the objects would be shirts, sweatshirts, outerwear, and coats. In a category of natural numbers, the objects would be 1, 2, 3, and so on. So far, this feels similar to how we use “category” in everyday life.</p>\n<p>But a mathematical category also has morphisms.</p>\n<p>Looking at the definition again, a morphism is something with a domain <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> and a codomain <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> for any two objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>∈</mo><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a,b \\in ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span>. The notation <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>∈</mo><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a,b \\in ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span> just means objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> are in category <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>, so we can skip that. The keywords we should focus on are “domain” and “codomain.”</p>\n<p>What’s the first thing that comes to mind when you hear “domain” and “codomain”? That’s right — <strong>functions</strong>. Saying that <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> is the domain and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> is the codomain means that applying some morphism (function) to object <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> produces <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> objectA <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">morphismAdd1</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Applying the morphism add1 to object A...</span>\n<span class=\"token function\">morphismAdd1</span><span class=\"token punctuation\">(</span>objectA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">2</span> <span class=\"token comment\">// Produces object B</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>In other words, a morphism is essentially a function that represents the relationship between objects. That’s why we can express it mathematically as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>:</mo><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f: a \\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> and programmatically as the lambda <code class=\"language-text\">(a) => b</code>. <em>(There are cases where morphisms aren’t functions depending on the type of objects, but let’s not go there.)</em></p>\n<p>Now that we understand this much, let’s grab a simple category and play with it.</p>\n<center>\n  <div style=\"max-width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d24e3d04ef5aa42d4f6de9c7fef7744b/7a18f/category.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVR42pVTPW/TUBS1U7eQSgGqColOYciAkFCmiIWqEks3tszZspcPic1kgFIKPwCpCwMDIBVRpQLKYNQG7KQOCUogAdqCSh0Fx7Hz4aSQ2r3cW7nIFNo0Rzp6912/d+557z4zkm4rqRq0F9aqzbn8uhkvKOZiqV3LtAGkqnWNQXh9vkvDIyNnKF5Y0/h3JsBS+Wf9We6bGf+4YdJeSYdO0oAiU7DtzRUAeKs24MlyEZ5/KsGyUd/SMJeu1ydJxO/3nz4bCp3CkJ3P52dU/JbvWNbT7Bd4mMjCq1VlexVzRYAyI1bgulixb2Y2IbZUak0l1K3bcgN4SYO7og4XSBDXeogUJ1QYFTWYRjcx5K3XSvNOpgUxSbMnk1W4zPwHfa6Y3Ye76Ef6/tqNlftc9ITDYW8gEDhJc57nPXurOW531kYikaPBYPAExqwgCBzlmX0wiDzGdMe/Dl0gN0eckSoNO8LdBKkw5/DPPRGGkOPUVOR5ZMhZPHCAIIkcR44iz+39yLoqcY5LznHq6XJk1u2wG7yO+57v8CD4djfy2F0BYKej4YkJb3BsjLrsuS/L/YIAXC+iQ07T3BhwvQa2J4vRaJSON/hypXIxWYPpdAtuCN/Ne49ThRnZBF7U7SnRgCuHFqTHS2M8nX7QwMmHZsualXPwSHwPYknd3sDcV/qXDwu6NxrfVDpXkzr8kqq28uKz+mMut64uKu2yqFlGyoDsb0n0PW01RzOAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"category\" title=\"\" src=\"/static/d24e3d04ef5aa42d4f6de9c7fef7744b/6af66/category.png\" srcset=\"/static/d24e3d04ef5aa42d4f6de9c7fef7744b/69538/category.png 160w,\n/static/d24e3d04ef5aa42d4f6de9c7fef7744b/72799/category.png 320w,\n/static/d24e3d04ef5aa42d4f6de9c7fef7744b/6af66/category.png 640w,\n/static/d24e3d04ef5aa42d4f6de9c7fef7744b/d9199/category.png 960w,\n/static/d24e3d04ef5aa42d4f6de9c7fef7744b/21b4d/category.png 1280w,\n/static/d24e3d04ef5aa42d4f6de9c7fef7744b/7a18f/category.png 1284w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>Imagine a category <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal {C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.05834em;\">C</span></span></span></span></span> with this structure. The objects are bicycle, car, and airplane, and the morphisms are the <code class=\"language-text\">faster</code> arrows between them.</p>\n<p>In this category, applying the <code class=\"language-text\">faster</code> morphism to bicycle produces car, and applying <code class=\"language-text\">faster</code> to car produces airplane. When we say morphisms express relationships between objects, this is what we mean. A bicycle made faster becomes a car, and a car made faster becomes an airplane.</p>\n<p>And since applying a morphism is the same as applying a function, we can express this category’s structure in simple code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> category <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'bicycle'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'car'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'airplane'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">faster</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">category<span class=\"token punctuation\">,</span> object</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> category<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v <span class=\"token operator\">===</span> object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> category<span class=\"token punctuation\">[</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">faster</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">,</span> <span class=\"token string\">'bicycle'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">faster</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">,</span> <span class=\"token string\">'car'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token string\">'car'</span>\n<span class=\"token string\">'airplane'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>And the faster <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∘</mo></mrow><annotation encoding=\"application/x-tex\">\\circ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord\">∘</span></span></span></span></span> faster morphism drawn directly from bicycle to airplane represents the composition of two faster morphisms. In code, that’s <code class=\"language-text\">faster(faster('bicycle')) === 'airplane'</code> — two composed function calls.</p>\n<p>Expressing morphism composition in programming is nothing more and nothing less than composing functions. This simple idea looks like this when stated in mathematical terms:</p>\n<blockquote>\n<p>For any three objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi><mo>∈</mo><mi>o</mi><mi>b</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a,b,c\\in ob(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span>, a binary operation <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>×</mo><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo>→</mo><mi>hom</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\hom(a,b)\\times \\hom(b,c)\\to \\hom(a,c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">hom</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></span>, called composition of morphisms. The composition of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon a\\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>b</mi><mo>→</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">g\\colon b\\to c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></span> is denoted <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>∘</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">g\\circ f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∘</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">gf</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span>.</p>\n</blockquote>\n<p>The three objects in this definition correspond to bicycle, car, and airplane from our category. And the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>o</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">hom</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span></span></span></span></span> in <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>o</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">hom(a,b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span></span> refers to a collection of morphisms — a set of morphisms.</p>\n<p>The reason there can be multiple morphisms is straightforward. Even in our category, the relationship between bicycle and car isn’t limited to just <code class=\"language-text\">faster</code>:</p>\n<blockquote>\n<ol>\n<li>bicycle -<strong>faster</strong>-> car</li>\n<li>bicycle -<strong>more expensive</strong>-> car</li>\n<li>bicycle -<strong>larger</strong>-> car</li>\n<li>bicycle -<strong>has an engine</strong>-> car</li>\n</ol>\n</blockquote>\n<p>Multiple morphisms can exist between any two objects, so mathematicians lump their collection together and call it <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>o</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">hom</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span></span></span></span></span>.</p>\n<p>You might wonder why we need to care about all these details, but mathematics is a discipline where answers must be definitive and exceptions are never allowed, so definitions must account for every possible case.</p>\n<p>And <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"></mspace><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"></mspace><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon a\\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> refers to applying just one morphism from the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>o</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">hom</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span></span></span></span></span> collection to objects <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span>. We don’t know which morphism will be applied, but only one can be applied at a time. <em>(Applying multiple simultaneously would require a quantum computer.)</em></p>\n<p>Finally, just as we applied the faster morphism twice to bicycle, composing morphisms <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>:</mo><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">f: a\\to b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>:</mo><mi>b</mi><mo>→</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">g: b\\to c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></span> is denoted <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>∘</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">g\\circ f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∘</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> — morphism composition.</p>\n<p>In other words, applying morphism <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> to the object “bicycle,” then applying morphism <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span>, produces the object “airplane.” In code: <code class=\"language-text\">g(f('bicycle')) === 'airplane'</code>.</p>\n<p>Category theory is such an abstract theory that everything happening inside a program can be expressed as category models. Likewise, the process of applying functions to values and composing them in functional programming can also be represented as a category model.</p>\n<center>\n  <div style=\"max-width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/31c57f106ec9d6857471d2fcdbfe5da7/bf286/category-example.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC6ElEQVR42oVTyXLTQBAVVz4A+AjgxBdw5cid/+KYKi4UBRRQIZA9xIkXyfISEztRkC05lu1402ixrMQzj55xEiBUQFWv2prpfu73uqUBuKPd/lzd3SPc1f7zXHMhqj1AWHyM0Hj0F3D40HNWn9x6ryDvsvcXZEx/gcBIMDWBuCgwKwOzCpCU5DtEVMRsmBXpJE9nZXWm7lLKmZUXNbI20CMExecaTw9OcV5Bz3d4dTARRccRedsWZa8nTpgv+u6u0LeWhFV6Kya9vKiPx6LidUWhaYui64iD4USc+c058B3ivFbReGQmYDk0gxFWTxMsbZt4+WUfH+tdFHyBSd9A0s8gPdvDaWsPmeEc76qOynm1d4CN7gUc1udITPCo1CLJxox8QMoqiIMGkugI40GVftcxDQ5JMskh2RIiLiFmhypnMjrANGyompSVubIgMBzpYUrapQcE8iko4HyUQdjZAkL98txQEEwnFOi8gKi7DT7JLmqYToRVujNcjSaUIiF2+ndMS4tI7+m4gGSwT8WmTLwmVQiLRLgLThFTGkxkcvCaHKCrsc526h2vYNDcwMjZoLiGM3sdp0crcOvLSIZZRQp21eWCMCTCkbMJz/oq6zjr7CDwvrnasLWRysIzew0dIrHK79Guf0ar9gljdxMy8cInmcoWIvytw97JqsodtNZ51/qCdmOZJMdmKvUrubL95AoLG+ZEJknFJRmXxNRx2M1gHlLNjGpjGgpXA3Q17hfSX4bfhKGKabGVRNmZYHk1iJCGMh+Rx36O7Chw+TFwprtybRKZ+IfpN0GrE9MuRv19BOwI8dSG3TLAmIUw+oHEr6i1EYFOexiZMXUzV6O/BdynGOrctnb49oDzN5U2f11y+FKmxj+cBNwJhxeIdFpss6mRfxZQpy5KQnl4K0q4mNbQjsZo9NqwBh3U2hbq/Q782OFAg77val5KfkZd2BQ96rQj47+R8xAbC0xNjzojxlyXrDmmL+7pTz/gOdXQ1uU9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"category example\" title=\"\" src=\"/static/31c57f106ec9d6857471d2fcdbfe5da7/6af66/category-example.png\" srcset=\"/static/31c57f106ec9d6857471d2fcdbfe5da7/69538/category-example.png 160w,\n/static/31c57f106ec9d6857471d2fcdbfe5da7/72799/category-example.png 320w,\n/static/31c57f106ec9d6857471d2fcdbfe5da7/6af66/category-example.png 640w,\n/static/31c57f106ec9d6857471d2fcdbfe5da7/d9199/category-example.png 960w,\n/static/31c57f106ec9d6857471d2fcdbfe5da7/21b4d/category-example.png 1280w,\n/static/31c57f106ec9d6857471d2fcdbfe5da7/bf286/category-example.png 1688w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>Everything that happens inside a program can be expressed as a category</small>\n  <br>\n  <br>\n</center>\n<p>Personally, I believe this is all you need to know about category theory to understand functors more easily. Once you accept that things happening in a program can be defined as categories, understanding functors becomes straightforward.</p>\n<h3 id=\"functors\" style=\"position:relative;\">Functors<a href=\"#functors\" aria-label=\"functors permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Now let’s transform our simple category into a more abstract model. Replace the names bicycle, car, and airplane with variables <code class=\"language-text\">x, y, z</code>, and replace the morphism <code class=\"language-text\">faster</code> with variables <code class=\"language-text\">f</code> and <code class=\"language-text\">g</code>.</p>\n<center>\n  <div style=\"max-width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8580182cd5537b8b1808d4e97c3c27a4/93582/absolute-category.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnElEQVR42o1Uy27aQBSlm1aq1G1XXfYP8g39gHxe/6GrqE0iRS0USDBgxzRN1AQ15IFxeNmeGRtjDJ7TOxPaQBKsIh3NZebccx8z1wUALxQK+b93hDd5hDUdZUjZfvUc6Ozl9vaHtzs7H18rO4e3FGPWe/D6J3DjBLxhg9da9H8FzRYmx5bkTVvba2eKa9j3vqRBWgVMrBLgIkm72WzexXzRg1oTQppeUeBfCAZVpLFN9jnS+bU+19xsyU2dBXAH0vpWQGxOukFXljxkhwHkXofL0iCVZR+yPppI1itLt70nmVOUt+f78qgvZIV4pcFc7nYCeUi8Ivm63AFpsQJEPfHEFVr+FGc8hnHbR8vj+MmmaAc+FkETUpiQ3EQyNnDhj+ksQWvENVf52H4sWXQDhHVeoL7MEJqAaNBGE3O/htAtapt6SvvmA0KLVtoPG5gHBsJBecmrS+qz4oiloPXgFFmI+hWE/bK2wc110aXw3K9DuOX7ILxJgvYGQYVpC+FdBTPP0A50w88KhhRYC7FNgrQugjoCpwjW+w63vY/ssdg/XgP+bRHT0ZHae1qyziI6RkSZ3Zx9xvj6K6JBBZyEpXhatuJ3z3cx7Bwov5weKlD6UvWPAkyHR/e9iqynPaTgiPNKXomuM15mrQRjEla23leCVHJID/7/LuWRuDpnTgkp9ReRqZ9KMqpi8HtfTQcyZqyULMwkT/AvMnp//csDXAx7uBARTsceTOcObSFw6gspoiv1lnlBTuxYp5yDTPUotCRzq7LiMlnlNG6Dmfxy6ctDRra/OnrpKaXQUReRIW5hM6hHyQ+I+AbepAd/4sCLunodh06mPw6zk4b6fG3RONWoVx5lM6TJGG1CxhojMIPsNQwhDI/KraXM2PoDpJ3XiwGEc1UAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"absolute category\" title=\"\" src=\"/static/8580182cd5537b8b1808d4e97c3c27a4/6af66/absolute-category.png\" srcset=\"/static/8580182cd5537b8b1808d4e97c3c27a4/69538/absolute-category.png 160w,\n/static/8580182cd5537b8b1808d4e97c3c27a4/72799/absolute-category.png 320w,\n/static/8580182cd5537b8b1808d4e97c3c27a4/6af66/absolute-category.png 640w,\n/static/8580182cd5537b8b1808d4e97c3c27a4/d9199/absolute-category.png 960w,\n/static/8580182cd5537b8b1808d4e97c3c27a4/21b4d/absolute-category.png 1280w,\n/static/8580182cd5537b8b1808d4e97c3c27a4/93582/absolute-category.png 1524w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>After abstracting our category this way, it feels like there should be other categories with the same structure — not just category <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>.</p>\n<p>And that makes sense, because categories with this structure of objects and morphisms are extremely common — frankly, it’s a universal pattern that can be fitted to almost any definition.</p>\n<p>So if we can apply morphisms to objects to transform them into other objects, couldn’t we apply something to a category to transform it into another category?</p>\n<p>That’s exactly where the <strong>functor</strong> comes in. A functor is a morphism (function) that can transform one category into another.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/091da7127032da1c6ee53eb819d6af9d/b8f37/functor-category.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9UlEQVR42jWSS2/TQBSFg5DYUMESqWVHECAhWPDT+BEIwQ9g2RWLSJUqgZAKEn0lcbDdkAbapk3TPJymjp/zsF0/4jmMnWDp6s7VfHPmnJErCD+vl+XUNur1zScIvy/nsLaBeW2tIj+gcqfscka49RhQHu19ef/047u3bxBurwPbyzOo3avc+KPM8I3QJRdRah+G1P8bTYkRTP1JztmZDvHtQSnm1R5yetoe24N84o1C1+6EZPyDu6QfDe0BnzMDCT/+VJkwGz1nDptPIdw6fL+HvmeLK+qCx1cB0Hi+dHlUDeJh2rOucWJOBWMXSK19mNRA1xjmZkKRZX2lAq5i4TWQuU0gaANcR+o1hKAtOetscrrzshAc/vn6AkxNCj616yKnv1a8hsRr5ojlmmlSkOkIzDrY7AALokqgjVtbEbKKA/y8vfVa6t1VDjZf5URNPWMPZLovIqsBQfWSj51WzmaHyLxWqxTMqSY3NcRSpOip2xSCtIobOaj6rIxMjqqSTQoeVBPF5bGjlIkST8mRdFYOo98o67ZT2ne9Hs48V/SpD56MAsT/37BfRdxNSy5si6IXsWfEgD4e5dcxx2JxWURWiXRh50xzQFQn8LuO6Y8skwx5SE9+4mbn/vKX2V2TEXeXrjULK97zzx3DvrQsfxBl7PjDP7mvCVMvxyTZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"functor category\" title=\"\" src=\"/static/091da7127032da1c6ee53eb819d6af9d/6af66/functor-category.png\" srcset=\"/static/091da7127032da1c6ee53eb819d6af9d/69538/functor-category.png 160w,\n/static/091da7127032da1c6ee53eb819d6af9d/72799/functor-category.png 320w,\n/static/091da7127032da1c6ee53eb819d6af9d/6af66/functor-category.png 640w,\n/static/091da7127032da1c6ee53eb819d6af9d/d9199/functor-category.png 960w,\n/static/091da7127032da1c6ee53eb819d6af9d/21b4d/functor-category.png 1280w,\n/static/091da7127032da1c6ee53eb819d6af9d/b8f37/functor-category.png 3524w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>No matter how complex category <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span> is, we can simply wrap the category with a functor like <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">F(C)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mclose\">)</span></span></span></span></span> and use it. Then all objects and morphisms inside the functor-applied category are wrapped in the function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span>.</p>\n<p>The most important point is that wrapping with a functor <strong>never changes the category’s structure itself</strong>. In the diagram above, you can see that while <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> has been applied to the objects and morphisms, the shape of the arrows hasn’t changed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> objectX <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> objectY <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">morphismF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">morphismF</span><span class=\"token punctuation\">(</span>objectX<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> objectY<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> objectX <span class=\"token operator\">=</span> <span class=\"token function\">functor</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> objectY <span class=\"token operator\">=</span> <span class=\"token function\">functor</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> morphismF <span class=\"token operator\">=</span> <span class=\"token function\">functor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">morphismF</span><span class=\"token punctuation\">(</span>objectX<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> objectY<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Even when using a functor, the rules the category has are never changed. Put simply, it safely wraps objects and morphisms without causing any other side effects.</p>\n<p>Remember when I said everything in programming can be expressed as a category?</p>\n<p>No matter how complex a category is, simply wrapping it with a functor transforms it into another category without touching the original category’s structure. This fits perfectly with the need we identified: “wrap values to use them safely.”</p>\n<h2 id=\"lets-build-a-functor\" style=\"position:relative;\">Let’s Build a Functor!<a href=\"#lets-build-a-functor\" aria-label=\"lets build a functor permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>A functor isn’t a grand concept. Simply put, if something can transform one category into another, it’s a functor.</p>\n<p>The act of a functor transforming a category is called “mapping” — more precisely, applying a function to a category to transform it into another category.</p>\n<p>Because functors are such an abstract concept, everyone describes them differently — “I use functors for this,” “I use functors for that.” A functor is merely something capable of mapping, so the possibilities are endless depending on how you apply it.</p>\n<p>Since the concept of a functor just needs to allow transforming the internal value through a specific method, expressing it in code isn’t that hard.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Functor<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token generic-function\"><span class=\"token function\">map</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Functor<span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<ul>\n<li><code class=\"language-text\">Functor&lt;T></code>: This functor holds a value of type <code class=\"language-text\">T</code>.</li>\n<li><code class=\"language-text\">map&lt;U></code>: Applying this functor’s morphism yields a new functor holding a value of type <code class=\"language-text\">U</code>.</li>\n<li><code class=\"language-text\">f: (x: T) => U</code>: The morphism works by taking a value of type <code class=\"language-text\">T</code> and outputting a value of type <code class=\"language-text\">U</code>.</li>\n</ul>\n</blockquote>\n<p>The <code class=\"language-text\">map</code> method applies the <code class=\"language-text\">(x: T) => U</code> function passed as an argument to the functor’s internal value, and returns a new functor wrapping the transformed value.</p>\n<p>The function passed to <code class=\"language-text\">map</code> is what actually transforms the functor’s internal value. This function is called a “transform” function.</p>\n<p>The reason mapping returns a functor wrapping the transformed value — rather than the raw value itself — is that a functor is fundamentally a structure that transforms one category into another. It doesn’t destroy the category and extract the objects inside.</p>\n<p>And since a functor merely represents a new category, it must not modify the original category’s objects. That’s why instead of updating the existing functor’s value, it creates and returns a new functor containing the transformed value.</p>\n<p>If this feels confusing, think about <code class=\"language-text\">Array.prototype.map</code>. When you think about it, an array is a kind of functor too — a box holding values.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token comment\">// Functor&lt;number></span>\n<span class=\"token keyword\">const</span> array<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Transform function: (x: number) => string</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> v <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Mapping!</span>\narray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>toString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// New functor Functor&lt;string></span>\n<span class=\"token punctuation\">[</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>We can use the transform function <code class=\"language-text\">toString</code> to change the values inside the array functor, but we don’t destroy the box (the array) itself.</p>\n<p>Because the <code class=\"language-text\">map</code> method we commonly use is attached to <code class=\"language-text\">Array</code>, it’s easy to associate mapping with iteration. But mapping isn’t that specific an operation.</p>\n<p>Whether <code class=\"language-text\">map</code> internally iterates, bangs a drum, or does a breakdance — as long as it ultimately performs the transformation <code class=\"language-text\">Functor&lt;T> -> Functor&lt;U></code>, it qualifies. You should now have a sense of how functors work.</p>\n<p>Time to implement a functor ourselves. Since functors are such an abstract concept, the possibilities are endless depending on how you apply them. But this post is already quite long, so I can’t showcase many. Other developers have written great posts with functor implementations, so check those out if you’re curious.</p>\n<p>In this post, I’ll build the simplest functors — <code class=\"language-text\">Just</code> and <code class=\"language-text\">Nothing</code> — then combine them into a <code class=\"language-text\">Maybe</code> functor that manages side effects caused by the presence or absence of values.</p>\n<h3 id=\"just\" style=\"position:relative;\">Just<a href=\"#just\" aria-label=\"just permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The <code class=\"language-text\">Just</code> functor simply wraps a value with no additional functionality, and allows that value to be transformed through its <code class=\"language-text\">map</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Just<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Functor<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token generic-function\"><span class=\"token function\">map</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span> <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Just<span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">Just</code> is a simple functor that holds a value internally. Using its <code class=\"language-text\">map</code> method means transforming the functor’s <code class=\"language-text\">T</code> type value into a <code class=\"language-text\">U</code> type value and wrapping it in a new <code class=\"language-text\">Just</code> functor.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Just</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v <span class=\"token operator\">+</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span>toString<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Just <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"nothing\" style=\"position:relative;\">Nothing<a href=\"#nothing\" aria-label=\"nothing permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The <code class=\"language-text\">Nothing</code> functor, as the name suggests, holds no value internally. Since there’s no value to apply a transform function to, its <code class=\"language-text\">map</code> method does nothing and simply returns a <code class=\"language-text\">Nothing</code> functor.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Nothing</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Functor<span class=\"token operator\">&lt;</span><span class=\"token keyword\">null</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">map</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Nothing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Nothing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Nothing <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Why do we need a functor that explicitly represents the absence of a value?</p>\n<p>Because once you start composing functions with functors, all values in the operation must also be wrapped in functors. If you try to apply a plain function to a functor-wrapped value, you’ll naturally get an error.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Just</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfoo <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Operator '+' cannot be applied to types 'Just&lt;number>' and 'number'.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>So once you start composing functions with functors, you must keep using functors until the composition is complete. The whole point of using functors is to maintain type safety and manage side effects during composition — if even one non-functor sneaks in, the entire composed operation’s safety can’t be guaranteed. <em>(One bad apple spoils the bunch.)</em></p>\n<p>This might sound inconvenient, but think about how we use <code class=\"language-text\">Array</code> — which I described as a representative functor. It’s not such a strange concept.</p>\n<p>If you have <code class=\"language-text\">new Array(3)</code> and want to add 2 to the value it holds, how would you do it? Remember, in functional programming, state mutation isn’t allowed, so you can’t use an approach like <code class=\"language-text\">new Array(3)[0] += 2</code>.</p>\n<p>In functional programming, where immutability is paramount, if you want to change a value inside an array, the only way is to create “a new array with the changed value.”</p>\n<p>That’s why we must use the <code class=\"language-text\">map</code> method to change array values while preserving immutability. Now you can probably see why a functor’s <code class=\"language-text\">map</code> method creates and returns a new functor after transforming the value.</p>\n<h3 id=\"maybe\" style=\"position:relative;\">Maybe<a href=\"#maybe\" aria-label=\"maybe permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>If you’ve followed along this far, let’s build a more complex functor. The <code class=\"language-text\">Maybe</code> functor’s <code class=\"language-text\">map</code> method applies the given function to the internal value if it exists, and returns a <code class=\"language-text\">Nothing</code> functor if it doesn’t.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Maybe<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Functor<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> Just<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token operator\">|</span> Nothing<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span>value<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Just<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Nothing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token generic-function\"><span class=\"token function\">map</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span> <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token operator\">|</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Just</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">map</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Nothing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFirstLetter</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">s</span> <span class=\"token operator\">=></span> s<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getStringLength</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">s</span> <span class=\"token operator\">=></span> s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Maybe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getFirstLetter<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> bar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Maybe</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getFirstLetter<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Just { value: 1 }</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Nothing {}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With the <code class=\"language-text\">Maybe</code> functor, we can compose functions with confidence, without worrying about <code class=\"language-text\">null</code> or <code class=\"language-text\">undefined</code> breaking the composition chain.</p>\n<p>Of course, you’ll eventually need an <code class=\"language-text\">if</code> statement to distinguish whether the final result is <code class=\"language-text\">Just</code> or <code class=\"language-text\">Nothing</code>. But at least you don’t need to check at every step during composition. In other words, when composing functions, you can focus solely on the composition.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Without functors, you can't freely compose functions</span>\n<span class=\"token keyword\">const</span> firstLetter <span class=\"token operator\">=</span> <span class=\"token function\">getFirstLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>firstLetter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">getStringLength</span><span class=\"token punctuation\">(</span>firstLetter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Composition failed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// With the Maybe functor, you can compose with peace of mind</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Maybe</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getFirstLetter<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getStringLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Just</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Composition failed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With just the simple concept of wrapping a value and being able to transform its contents, we’ve achieved safe function composition.</p>\n<p>In this post, I only used the <code class=\"language-text\">Maybe</code> functor as an example for managing side effects from value presence/absence. But as I’ve said multiple times, a functor is just a box wrapping a value — depending on what logic you implement, you can create wildly different functors.</p>\n<p>For instance, <code class=\"language-text\">Promise</code> — which guarantees a future value even though there’s no value right now — can be seen as a kind of functor. And <code class=\"language-text\">Array</code> — which can store multiple values sequentially — is also a kind of functor.</p>\n<p>A functor is an abstract concept, not a concrete implementation performing specific logic. It’s so versatile that with just the concept of wrapping a value and transforming it, you can let your imagination run wild and create all sorts of functor implementations.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Some readers may have thought while reading about functors: “Wait, isn’t this a monad?”</p>\n<p>To be precise, that’s half right and half wrong. A monad is ultimately a type of functor designed for safe function composition. Simply put, a monad is a morphism between two functors that satisfies certain special mathematical conditions.</p>\n<p>I didn’t cover applicative functors or monads in this post, but setting aside the theoretical details, the reason these additional concepts exist boils down to exactly one thing:</p>\n<blockquote>\n<p>Huh…? Functors alone can’t solve this either…?</p>\n</blockquote>\n<p>We used functors to achieve safe function composition, but in practice, there are plenty of cases where functors fall short. Like when you need to map over a value wrapped in multiple layers of functors. In such cases, functor mapping alone can’t compose functions.</p>\n<p>Think of applicative functors and monads as more abstract and powerful versions of functors, designed to cover even the edge cases that basic functors can’t handle.</p>\n<p>I actually wanted to explain monads in this post too, but explaining monads the same way I explained functors here would require diving deeper into category theory beyond the overview level, so I gave up. <em>(I’ll tackle monads in the next post.)</em></p>\n<p>Understanding the relationship between function composition and functors is admittedly quite abstract and not easy to grasp. Some developers just learn how to use functors and monads and move on with their programming. But personally, I think knowing why these concepts are used and where the ideas came from makes programming a lot more fun.</p>\n<p>This concludes my post: How Can We Safely Compose Functions?</p>","fields":{"slug":"20200127-safety-function-compositionen","path":"/2020/01/27/safety-function-composition/en/","lang":"en"},"frontmatter":{"title":"How Can We Safely Compose Functions?","subTitle":"Functors and monads: the magic that solves the problems ruining function composition","date":"Jan 27, 2020","categories":["Programming","Architecture"],"tags":["Functor","Monad","Functional Programming","Composition","Category Theory","Mathematics"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/d803c/thumbnail1.png","srcSet":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/d803c/thumbnail1.png 320w,\n/static/fe86b5bd480c2654850ae7a9ec8c4aa2/2a1fd/thumbnail1.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/fc5c5/thumbnail1.webp 320w,\n/static/fe86b5bd480c2654850ae7a9ec8c4aa2/e9225/thumbnail1.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/01fb2/thumbnail1.png","srcSet":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/01fb2/thumbnail1.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/fe86b5bd480c2654850ae7a9ec8c4aa2/b384d/thumbnail1.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"f0743c97-5a39-5437-a54a-e69e9c6aee0b","tableOfContents":"<ul>\n<li>\n<p><a href=\"#whats-the-relationship-between-pure-functions-and-immutability\">What’s the Relationship Between Pure Functions and Immutability?</a></p>\n</li>\n<li>\n<p><a href=\"#what-is-immutability\">What Is Immutability?</a></p>\n<ul>\n<li><a href=\"#we-access-memory-through-variables\">We Access Memory Through Variables</a></li>\n<li><a href=\"#call-by-value-and-call-by-reference\">Call by Value and Call by Reference</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#what-are-the-benefits-of-preserving-immutability\">What Are the Benefits of Preserving Immutability?</a></p>\n<ul>\n<li><a href=\"#preventing-indiscriminate-state-changes\">Preventing Indiscriminate State Changes</a></li>\n<li><a href=\"#tracking-state-changes-becomes-easy\">Tracking State Changes Becomes Easy</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#immutability-in-practice\">Immutability in Practice</a></p>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about immutability — a concept that functional programming values highly, following up on pure functions. Whenever you explain pure functions, immutability inevitably comes up at least once. Most explanations either define it briefly as “not changing state,” or list beh…","html":"<p>In this post, I want to talk about immutability — a concept that functional programming values highly, following up on pure functions.</p>\n<p>Whenever you explain pure functions, immutability inevitably comes up at least once. Most explanations either define it briefly as “not changing state,” or list behaviors that violate immutability and frame them as forbidden practices.</p>\n<p>But personally, I think this style of explanation may not resonate with people who don’t have a solid understanding of state and memory. So in this post, I want to talk about what “immutable” actually means.</p>\n<h2 id=\"whats-the-relationship-between-pure-functions-and-immutability\" style=\"position:relative;\">What’s the Relationship Between Pure Functions and Immutability?<a href=\"#whats-the-relationship-between-pure-functions-and-immutability\" aria-label=\"whats the relationship between pure functions and immutability permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>As I discussed in my previous post, <a href=\"/2019/12/29/about-pure-functions/\">Pure Functions – A Programming Paradigm Rooted in Mathematics</a>, pure functions are a model that brings mathematical functions into the programming world.</p>\n<p>The programming world has the concept of state — values that can be stored, modified, and retrieved — but in mathematics, no such concept exists. Every function exists independently, completely unaffected by anything outside itself.</p>\n<p>Because pure functions are a programming implementation of mathematical functions — which have no concept of state — they naturally carry the rule that they must not be affected by external state.</p>\n<p>And since mathematics has no concept of state, there obviously can’t be a concept of changing state either. We call this “immutability.”</p>\n<p>But in the programming world, not changing state requires quite a bit of care. So we establish rules like “don’t reassign values to variables” and program while maintaining immutability.</p>\n<p>However, if you understand the fundamental causes of mutation in programs and can uphold immutability on your own, you’ll be able to handle even edge cases that rules alone can’t cover. That’s why we need to understand what immutability actually means.</p>\n<h2 id=\"what-is-immutability\" style=\"position:relative;\">What Is Immutability?<a href=\"#what-is-immutability\" aria-label=\"what is immutability permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Immutability is usually defined simply as “not changing state.”</p>\n<p>But most explanations only go as far as listing prohibited behaviors — “don’t access or reassign external variables,” “don’t modify function arguments” — without explaining in detail what “changing state” actually means.</p>\n<p>So this kind of explanation may not land well for someone who doesn’t know precisely what it means to change state.</p>\n<p>What exactly does the “state change” that immutability refers to mean? Is it simply not modifying or reassigning program variables?</p>\n<p>In fact, the “state change” that immutability talks about isn’t just about reassigning variables. More precisely, it means any act of modifying a value already stored in memory — and variable reassignment is just one example of that.</p>\n<p>In other words, to properly understand state change, you need some basic knowledge of how computers store values in memory and access them.</p>\n<h3 id=\"we-access-memory-through-variables\" style=\"position:relative;\">We Access Memory Through Variables<a href=\"#we-access-memory-through-variables\" aria-label=\"we access memory through variables permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Most programming languages provide variables — a feature that makes it easier to access values stored at specific locations in memory.</p>\n<p>Since variables are the very first thing you learn when studying programming, every developer knows this concept. Let’s declare a simple variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> a<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>I “declared” a variable called <code class=\"language-text\">a</code>, and on the next line, “assigned” the value <code class=\"language-text\">1</code> to it.</p>\n<p>Normally we’d write <code class=\"language-text\">let a = 1;</code> to declare and assign simultaneously, but since declaration and assignment are technically different operations, I split them for clarity.</p>\n<p>When you declare a variable with <code class=\"language-text\">let a;</code>, JavaScript allocates a memory space accessible through the variable <code class=\"language-text\">a</code>. Since I only declared the variable without assigning a value, accessing <code class=\"language-text\">a</code> at this point would return <code class=\"language-text\">undefined</code> — meaning “nothing has been defined.”</p>\n<p>Then I used <code class=\"language-text\">a = 1</code> to store the value <code class=\"language-text\">1</code> in that allocated memory space. From that point on, whenever I access that memory space through the variable <code class=\"language-text\">a</code>, I get back the stored value <code class=\"language-text\">1</code>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/758e65bb220cb568f802edf2c320b13f/fe720/memory-value.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVR42mNgIAwYoTQXECsCsQwQcyLJ8wCxMhBLATEzg4mJia+usUGouq5WiK6BQYieoV6wsbFxpIGBgT5Mh5aWFpucnFyIlJRUkrS0dJyMjEyKioqKjJqamqKmpmayqqpSvLq6ehKQ7c9gbGLy097c+r+Prct/R3v7//Zmdn8sLa3/6+vrL6yvrxfasmWLAdBMAy8vr/8xMTH/w8PDf0VFRf3X1dVN1dHRKbawtPhvY27/y8Lc4j/Qca8ZjIyN7lmZmr92NLd5aWVh9dLCxOKZqYnpd6CB3f///2d59OiRNMg7VlZWz52dnT85OTm9BuL/QMPCQK4DeuS/saH5GwMDw69APTcBnf5M6tKki8EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"memory value\" title=\"\" src=\"/static/758e65bb220cb568f802edf2c320b13f/6af66/memory-value.png\" srcset=\"/static/758e65bb220cb568f802edf2c320b13f/69538/memory-value.png 160w,\n/static/758e65bb220cb568f802edf2c320b13f/72799/memory-value.png 320w,\n/static/758e65bb220cb568f802edf2c320b13f/6af66/memory-value.png 640w,\n/static/758e65bb220cb568f802edf2c320b13f/d9199/memory-value.png 960w,\n/static/758e65bb220cb568f802edf2c320b13f/21b4d/memory-value.png 1280w,\n/static/758e65bb220cb568f802edf2c320b13f/fe720/memory-value.png 1448w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>In other words, a variable is essentially a shortcut for accessing a value stored in memory. Without variables, we’d have to use raw memory addresses like <code class=\"language-text\">0x0018fa</code> to allocate space, store values, and access them.</p>\n<p>If I reassign the variable with <code class=\"language-text\">a = 2</code>, I’m changing the value stored at memory address <code class=\"language-text\">0x0018fa</code> — and that constitutes a state change.</p>\n<p>JavaScript provides the <code class=\"language-text\">let</code> keyword for declaring reassignable variables and the <code class=\"language-text\">const</code> keyword for non-reassignable ones, giving developers a way to guard against accidentally changing values stored in memory.</p>\n<p>So can we maintain immutability simply by never reassigning variables?</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f4617a9e1f692a7df11953b0a4b86f44/d7854/nope.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABs2lpGpALaQbsY1//xAAbEAEBAAIDAQAAAAAAAAAAAAABAgASAwQFEf/aAAgBAQABBQImqLTWLKPO+vWpTNqwkOMrZz//xAAYEQACAwAAAAAAAAAAAAAAAAAAARARMf/aAAgBAwEBPwHShR//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AWpr/8QAHxAAAgEDBQEAAAAAAAAAAAAAAAERAiFBEBIyYXFy/9oACAEBAAY/AppQqFup7RI/oTmHmDky1vBzi2n/xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMRBBcZGh/9oACAEBAAE/IcpB03LYaGiUNZ5gCV2r5ChuKDSLb9sJVqBjAcRmA6K4/9oADAMBAAIAAwAAABBQ/wAD/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QbYuaj//EABgRAQEAAwAAAAAAAAAAAAAAAAEAEBEx/9oACAECAQE/EAC1uMf/xAAgEAEBAAIBAwUAAAAAAAAAAAABEQAhMUFhsRBRcYGh/9oACAEBAAE/EGfNgAVPb7yZYA6Wrp31k+cmyLEMcBcNgdyLzcp1cdaHSnbnneJWrtHjADmNbAah3cGBXqTRf30//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"nope\" title=\"\" src=\"/static/f4617a9e1f692a7df11953b0a4b86f44/d7854/nope.jpg\" srcset=\"/static/f4617a9e1f692a7df11953b0a4b86f44/0913d/nope.jpg 160w,\n/static/f4617a9e1f692a7df11953b0a4b86f44/cb69c/nope.jpg 320w,\n/static/f4617a9e1f692a7df11953b0a4b86f44/d7854/nope.jpg 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>Unfortunately not. The way a program loads and uses values from the memory space a variable points to isn’t that simple.</p>\n<p>This is where the famous “call by value” and “call by reference” come into play.</p>\n<h3 id=\"call-by-value-and-call-by-reference\" style=\"position:relative;\">Call by Value and Call by Reference<a href=\"#call-by-value-and-call-by-reference\" aria-label=\"call by value and call by reference permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Call by value and call by reference are methods for how variables are passed from one context to another.</p>\n<p>This situation of passing variables between contexts is most commonly represented as passing arguments from an outer scope into a function — and in practice, that’s usually the case.</p>\n<p>Let’s declare a simple function to explore this further.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">foo</code> function is a pure function that takes a string argument and returns only its first two characters. In other words, <code class=\"language-text\">foo</code> uses the value it receives as an argument to produce its return value.</p>\n<p>Let’s try using <code class=\"language-text\">foo</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, World!'</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">He</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Since <code class=\"language-text\">foo</code> slices the string it receives as an argument, it might look like it’s directly modifying the <code class=\"language-text\">str</code> variable.</p>\n<p>But if you print the <code class=\"language-text\">str</code> variable that was used as <code class=\"language-text\">foo</code>’s argument, you’ll find the original value <code class=\"language-text\">Hello, World!</code> is still intact.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">He\nHello<span class=\"token punctuation\">,</span> World<span class=\"token operator\">!</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>How is this possible? The answer is that the String type — the data type of <code class=\"language-text\">str</code> — uses “call by value.”</p>\n<p>In JavaScript, variables of primitive types like <code class=\"language-text\">string</code>, <code class=\"language-text\">number</code>, and <code class=\"language-text\">boolean</code> all use call by value.</p>\n<p>Call by value means that when you pass a variable as a function argument, the value it holds is copied and the copy is given to the function. So instead of passing the value in the memory space that <code class=\"language-text\">str</code> points to, JavaScript copies that value into a new memory space and passes that instead.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/44d1018198529f57a7dbd342e7c5557c/6569d/call-by-value.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC1klEQVR42pVTzU8TURBfBIkm2BZLSaBCldIPut0u+0X3ox/sttra0gIlTRtLhBjLwdjIzXggkYsQ/wX0RAInQggnGw+IEBLDid4kfhAUMWo4eFBD5TmPQELQEJzkt/Pm92ZmZ968RxCnk3MAJ8ACMB/bw3YboAlwhuB53s0wDO+knJyTojin08lRoEFYURTP4wiTydSu1+tDBoMhiLXZbPZgHnzd5uYWzWKxqGazVbXZbDTBsOz3Dk747RekXYX3ln0+364oibssyyJBEEIQZwwEAp+TySRKJBK/enp6kCSJb4C/KHWw6/l+FWV7fT9j1yRE0+0bBMOxPwJeGWX8MRSXNJToSqBoNLoHFSJI2gWBl8Ph8LdcLodSqVQ5k8kgv9+/Afwln8y/vZe/igazgXJ/uhP8uU0CAlWao+NWloxcIR19LS22uN1uvw7VRWFPj1traGjgjEajWldXFwCtNTY2MphvbW1lXC67RrXZAiTpUK1WK3f88HXpdLryYF2BPy6XqxrOatjhcIyRJDkKGAeuAFtVDO2+Gwnx4yGVG+U5eoykqGFifzIEcZjEMDEx8XR2dvZZTU2NCexqAN/d3f21UCigfD5fxjoej+GWm7RO6d3IcBe6Mxgu38yG4cy9m3/dj5WVFe/y8nIoGAxWHVBGaH1RluUNSZLWYWgfwX4O/IUOgS7eSCkfervE14mIuOnx0AvEfwo+06ojdsUxEASuZGBgAF9cAlq9PT09XZqamlqcmZl5CfaLubm5BdBF4F9NTk7ewn4IoTMn/hYc9rPPz8+7YS3v7Oy0A9jV1VVtbW0tViwWI0tLS8lSqWQ96v9Pgak9dLvdjyk79ajeVP9Ep9ONwEu4D3hQW1vbfHTipxKBF5ASVJCaU1Fftg9lM1mkadoeDAC/lF7sMzQ0dBa3eWJlhwLv9j3DMtucwm3JPnlbUZRPkGjL4/F8gfumHbhVnrbCP+ts8mF/LuM/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"call by value\" title=\"\" src=\"/static/44d1018198529f57a7dbd342e7c5557c/6af66/call-by-value.png\" srcset=\"/static/44d1018198529f57a7dbd342e7c5557c/69538/call-by-value.png 160w,\n/static/44d1018198529f57a7dbd342e7c5557c/72799/call-by-value.png 320w,\n/static/44d1018198529f57a7dbd342e7c5557c/6af66/call-by-value.png 640w,\n/static/44d1018198529f57a7dbd342e7c5557c/d9199/call-by-value.png 960w,\n/static/44d1018198529f57a7dbd342e7c5557c/21b4d/call-by-value.png 1280w,\n/static/44d1018198529f57a7dbd342e7c5557c/6569d/call-by-value.png 1328w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>So the value held by <code class=\"language-text\">str</code> when we called <code class=\"language-text\">foo(str)</code> and the value accessed through <code class=\"language-text\">s</code> inside the <code class=\"language-text\">foo</code> function are stored in completely different memory locations — they’re separate values.</p>\n<p>That’s why no matter what <code class=\"language-text\">foo</code> does to its argument, the original variable is never affected. Even if <code class=\"language-text\">s</code> is reassigned inside <code class=\"language-text\">foo</code>, the value in the original variable doesn’t change.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, World!'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  s <span class=\"token operator\">=</span> <span class=\"token string\">'Reassigned'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Hello<span class=\"token punctuation\">,</span> World<span class=\"token operator\">!</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Even though <code class=\"language-text\">foo</code> reassigned its argument, the external <code class=\"language-text\">str</code> variable remained unchanged.</p>\n<p>In other words, maintaining immutability isn’t simply about “not modifying function arguments” or “not reassigning variables.” The point is not changing values that are already stored in memory.</p>\n<p>On the other hand, objects like <code class=\"language-text\">Array</code> and <code class=\"language-text\">Object</code> — which don’t use call by value — behave differently.</p>\n<p>This time, let’s declare a simple function that takes an array and pushes the string <code class=\"language-text\">'hi'</code> into it, and see what happens.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The primitive <code class=\"language-text\">str</code> variable uses call by value, but <code class=\"language-text\">Array</code> — an object — uses “call by reference.” Let’s use the function and check what happens to the original variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Unlike <code class=\"language-text\">foo</code>, where the original variable was unaffected no matter what the function did to its argument, <code class=\"language-text\">bar</code> actually changed the <code class=\"language-text\">array</code> variable’s value.</p>\n<p>Unlike call by value — which copies the value into a new space before passing it — call by reference passes “the memory address that the variable points to.”</p>\n<p>In other words, the array stored in the memory space that <code class=\"language-text\">array</code> points to and the array received as <code class=\"language-text\">bar</code>’s argument are the exact same array stored in the exact same memory space.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8e28402edf974ba2f299767cd19f1f12/6569d/call-by-reference.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 58.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACE0lEQVR42mNgwA8YobQ0EOsCsRIQCyDJMwOxFhBrALEUWETPVE9NyUBTVdPAQFVJSUlVWVlZxcTERN3Y2FgEJM/Pzy/Ax8dnwsnJacrFxWUMYsvJyQna29uzANVqy8jImAoLC5vIysqaAPXLMViamn+1N7X+ZGVq8dnaxuaznZ3dB3Nz8/9GRkbzQAYaGhq2urq6/vf09PwAxB+B+D/QwjqQAQYGBn9NTU0/2drafgQ64Jeent4ZBk9rp/8x9r7/fWxd/wcGB/2Pjo7+A9IENGg11MA5CQkJIPG/ILmYmJj/lpaWXUCX2ZuZmf23sbH55+3t/Rco9h9owQ0GHUO9XDV9rWwtfd1sDQ2NbDU1tUygRDFQgRPIQHV1dRMFBYVyoDfLQBjorQogNtHS0hLS0dEpBuIiILtQV1e3TFNTM5yBBMAFxJxIkcWIVVVoaChzfX09k7y8PAcwwIWAQnwTJkyoWLdu3ZKZM2cuBuJ4oBgHMOClREVFef7//w8yiAlkIEgvMgaLgwwDGSwoKMgvKSnJBZKYMmVK0q5du7qWL1/euXjxYm+QPNBbbDhdhSOtiSN5iXygq607V1dNd4aKiso6JWWlxcBIma6vr78MiFNhQUKSgbaetv8doh3+BwWBk8z/qKioP8C0CEqHa0HysCAhGhiaGr41tDZ8bWFp8QaYpt4Ac8BLYNr7qa2tPR2qhCQDAXhMmtiBpCW6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"call by reference\" title=\"\" src=\"/static/8e28402edf974ba2f299767cd19f1f12/6af66/call-by-reference.png\" srcset=\"/static/8e28402edf974ba2f299767cd19f1f12/69538/call-by-reference.png 160w,\n/static/8e28402edf974ba2f299767cd19f1f12/72799/call-by-reference.png 320w,\n/static/8e28402edf974ba2f299767cd19f1f12/6af66/call-by-reference.png 640w,\n/static/8e28402edf974ba2f299767cd19f1f12/d9199/call-by-reference.png 960w,\n/static/8e28402edf974ba2f299767cd19f1f12/21b4d/call-by-reference.png 1280w,\n/static/8e28402edf974ba2f299767cd19f1f12/6569d/call-by-reference.png 1328w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Since the array received as <code class=\"language-text\">bar</code>’s argument is an object that uses call by reference, any modifications to it inside the function modify the original array itself.</p>\n<p>In this case, the array stored in memory is directly changed, so we can say state has been mutated — immutability has been broken.</p>\n<p>The same act of modifying an argument inside a function leads to vastly different outcomes depending on whether the data type uses call by value or call by reference. If you want to preserve immutability, you must always keep this distinction in mind when writing code.</p>\n<h2 id=\"what-are-the-benefits-of-preserving-immutability\" style=\"position:relative;\">What Are the Benefits of Preserving Immutability?<a href=\"#what-are-the-benefits-of-preserving-immutability\" aria-label=\"what are the benefits of preserving immutability permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Programming while preserving state immutability inevitably means more things to watch out for. But the fact remains that immutability is widely embraced by developers today.</p>\n<p>What exactly do we gain by preventing state from changing, and why is everyone so obsessed with immutability?</p>\n<h3 id=\"preventing-indiscriminate-state-changes\" style=\"position:relative;\">Preventing Indiscriminate State Changes<a href=\"#preventing-indiscriminate-state-changes\" aria-label=\"preventing indiscriminate state changes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>State plays a useful role in representing a program’s current situation. But when code everywhere references or modifies state indiscriminately, even the developer can lose track of how the program is behaving.</p>\n<p>That’s why developers prefer to impose specific rules and constraints on state mutations — minimizing indiscriminate changes and keeping them trackable.</p>\n<p>The most classic situation where indiscriminate state changes cause programs to break is “global variable abuse.” This is exactly why JavaScript conventions recommend banning global variable usage entirely.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> greeting <span class=\"token operator\">=</span> <span class=\"token string\">'Hi'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setName</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  greeting <span class=\"token operator\">=</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>greeting<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">greeting</code> variable is a global variable declared in the global scope. The <code class=\"language-text\">setName</code> function implicitly declares a global variable too, and the <code class=\"language-text\">setTimeout</code> callback also reassigns the global <code class=\"language-text\">greeting</code> variable.</p>\n<p>In a situation like this, tracking which piece of code changed the global <code class=\"language-text\">greeting</code> state is nearly impossible. If the console suddenly printed <code class=\"language-text\">Get out, Evan</code> instead of <code class=\"language-text\">Hi, Evan</code>, it wouldn’t be surprising at all.</p>\n<p>The reason developers end up working overtime in situations like this is, sadly, that it’s not a bug. These are perfectly valid, error-free logic as far as the console is concerned. <em>(An actual error would honestly make debugging easier.)</em></p>\n<p>Using pure functions while maintaining immutability means not accessing external state to modify values already allocated in memory — which defends against these unexpected state changes.</p>\n<h3 id=\"tracking-state-changes-becomes-easy\" style=\"position:relative;\">Tracking State Changes Becomes Easy<a href=\"#tracking-state-changes-becomes-easy\" aria-label=\"tracking state changes becomes easy permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In general, when you need to change an object’s property or an array’s element in JavaScript, immutability inevitably breaks.</p>\n<p>After all, when arrays and objects were first conceived, their purpose was to store structured data and maintain and modify state.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nevan<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Not Evan'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// State change!</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>But directly modifying values already stored in memory violates the principle of immutability. So a developer who wants to maintain immutability can’t modify object properties or array elements this way.</p>\n<p>On top of that — just like the indiscriminate global variable usage we saw — state changes to objects and arrays are equally untraceable. If some rogue code changes an object’s or array’s state and causes a bug, debugging it is no easy task.</p>\n<p>But you can’t just ban modifying object properties or array elements either. So how do we solve this?</p>\n<p>Let’s look at a simple function that changes an object’s property to understand how state changes occur and how to address them.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">convertToJohn</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">person<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  person<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> person<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">convertToJohn</code> function takes an object as an argument and assigns the string <code class=\"language-text\">'John'</code> to its <code class=\"language-text\">name</code> property. In other words, this function changes the object’s state.</p>\n<p>To state the conclusion upfront: this is not a pure function, because when a function directly modifies a property of an object passed by reference, it also changes the original object outside the function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> john <span class=\"token operator\">=</span> <span class=\"token function\">convertToJohn</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>john<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'John'</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// ?</span>\n<span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'John'</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Someone using <code class=\"language-text\">convertToJohn</code> might look at the name and think “Oh, this function converts an object into a John object.” But this function was secretly modifying the original object passed as its argument.</p>\n<p>The unintended property change is a problem, but the bigger issue is that this state change is completely untraceable. If you compare the <code class=\"language-text\">evan</code> and <code class=\"language-text\">john</code> objects above, JavaScript evaluates them as the same object.</p>\n<p>The two objects merely have different variable names pointing to the same memory space — they’re actually the same object stored in the same location.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan <span class=\"token operator\">===</span> john<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>In this situation, the developer is stuck with two nasty problems: “unintended state change” and “untraceable state change.” How can we solve this?</p>\n<p>The solution is simpler than you might think — just create a brand new object with <code class=\"language-text\">name</code> set to <code class=\"language-text\">'John'</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">convertToJohn</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">person</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> newPerson <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  newPerson<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> newPerson<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> john <span class=\"token operator\">=</span> <span class=\"token function\">convertToJohn</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>john<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'John'</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The updated <code class=\"language-text\">convertToJohn</code> no longer directly modifies the <code class=\"language-text\">person</code> object it receives. Instead, it creates a new object with the same structure using <code class=\"language-text\">Object.assign</code>, changes the <code class=\"language-text\">name</code> property to <code class=\"language-text\">'John'</code>, and returns it.</p>\n<p>If this feels too cumbersome, you can use ES6’s spread operator for a more concise syntax.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">convertToJohn</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">person</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>person<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>By creating a new object this way, you can prevent unintended state changes and track state changes. Because the object returned by <code class=\"language-text\">convertToJohn</code> is an entirely new object, separate from <code class=\"language-text\">evan</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan <span class=\"token operator\">===</span> john<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">false</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>When changing an object’s state, if you create a “new object with the changed state,” you can use the fact that comparing the previous and next state objects yields <code class=\"language-text\">false</code> to detect that the object’s state has changed.</p>\n<p>This principle is used in React — a UI library for web frontends — to detect state changes. When a developer changes state using methods like <code class=\"language-text\">setState</code>, React compares the previous and next state using <code class=\"language-text\">Object.is</code>. If the two objects are evaluated as different, React determines that state has mutated and re-renders the component.</p>\n<p>Redux, a state management library, also uses the same principle to detect state changes. That’s why when writing reducers, you shouldn’t directly modify the existing <code class=\"language-text\">state</code> object’s properties — you must create and return a new object.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">SET_NAME</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>These characteristics of immutability make it easy to detect state changes in reference types, which helps prevent bugs that developers wouldn’t anticipate.</p>\n<p>Immutability is also extremely useful in multi-threading scenarios. When multiple threads frantically read and modify a single piece of state, it quickly becomes impossible to tell what value a thread is actually referencing.</p>\n<p>It’s like having multiple painters applying paint to a single canvas while trying to complete a picture together. But with proper immutability, it’s more like giving each thread its own canvas, having them paint, and then submit their work.</p>\n<p>The developer can detect state changes each time a thread submits its work and can even build logs tracking those changes. How to consolidate the results, or discard unnecessary ones — that becomes a separate concern.</p>\n<h2 id=\"immutability-in-practice\" style=\"position:relative;\">Immutability in Practice<a href=\"#immutability-in-practice\" aria-label=\"immutability in practice permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Programming while maintaining immutability is undeniably great for easily tracking and managing state changes. But that doesn’t mean it’s all upside.</p>\n<p>The biggest challenge with immutability is that it’s difficult to integrate with traditional object-oriented programming.</p>\n<p>Functional programming’s emphasis on immutability is quite different from the object-oriented programming we’re accustomed to.</p>\n<p>OOP uses access modifiers like <code class=\"language-text\">private</code> to hide state from the outside, giving users a simple interface. Functional programming, by contrast, pursues immutability — not changing program state at all — making program behavior easy to predict and simple.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/def489f1400293515499d529e83b420a/e9140/oop_fp.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXklEQVR42m2RyU9TURTGL05xgUtj4k4sJAwxIS7Y+SfoQhRkJTPEKSRuTCQyJCx4xCHQFHi0ry21lilVEINBGV+hpeWVliHpI4gR6EAhAjXQ9tF+3leCQeNJvpyTc5Pf+e45hBCSREUyMjKSs9NTb1zPVFwlR5F0/PafSPRzsjPTc7KyLp3sER64PLiLtKEDKAbCSB0GUoYAhaxV4Py/JPWE92K7bTONnQoo9HMHV966D1Lkun1iPa2DD14gjaq5HUbtBtPhlhjWLTWyrkOGdUVe6z2obZhqlyEAEtO7F3BOY/E7Ome2wfG+qMbiO9TwCUWMwh7UvE9LHt3qQ3Vxf7y2fBA1ZR/xvLAfdRWD8arcXlTe7IlW3u65duyOApN11i3ROLsLzhKI6a1B6KaD4KYCUs98GJ22bTN58nImXMLYUMZY4+VNNpQyVlnSg5ZFVL+yaxIg4HQijwaSqQvR6NiBcmQ9VvNhBfUD38BOeKUu1z6oUzMp1i+G8lg3Cti5eAHrQv6RooWmH2gYWq2XQW0OnD0JNNh/Qj3pi5VwC3ja5aEuA5LpGPi4c3HnTrMjnq90Ru+pnNLdFkHKVwr7pYYVMJ9W646Ajj9AzuJfMti20DKyEWn+uia9GV6T2sa9YZMQkvfaR6p6v4cKdcso0nniFYZl3Nd6UKQXow/NQTR9Cf7tkO7QOBsSuxciMAl7MZMzhC4qo3NPei8C74RfZkIv9bl1bGO+bcw72zruFeg0QTW2Yad7EXXTm3ky6MXo6JlEBk5pLX6OHmRJw/sdVAL9pkBd2zneL2onfc9+A3kmnpn735kWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"oop fp\" title=\"\" src=\"/static/def489f1400293515499d529e83b420a/6af66/oop_fp.png\" srcset=\"/static/def489f1400293515499d529e83b420a/69538/oop_fp.png 160w,\n/static/def489f1400293515499d529e83b420a/72799/oop_fp.png 320w,\n/static/def489f1400293515499d529e83b420a/6af66/oop_fp.png 640w,\n/static/def489f1400293515499d529e83b420a/d9199/oop_fp.png 960w,\n/static/def489f1400293515499d529e83b420a/e9140/oop_fp.png 1226w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    OOP creates simplicity by hiding mutable state,<br>\n    while FP creates simplicity by eliminating mutable state entirely\n  </small>\n</center>\n<p>In other words, OOP and functional programming have fundamentally different perspectives on state. OOP is a paradigm focused on “changing state well,” which puts it at some distance from immutability.</p>\n<p>Moreover, most APIs and libraries we use today are still designed around OOP, so we can’t fully break free from object-oriented programming.</p>\n<p>The problem is that managing OOP-based constructs with immutable principles can be quite costly.</p>\n<p>For easier understanding, let’s look at a situation where we create an object using the Web Audio API and need to change its state.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">createGain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I created a simple object to represent state and assigned a <code class=\"language-text\">GainNode</code> to it. A <code class=\"language-text\">GainNode</code> has a <code class=\"language-text\">gain</code> property that controls audio signal volume, and developers can manipulate the audio signal simply by changing this property’s value.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">state<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>gain <span class=\"token operator\">=</span> <span class=\"token number\">1.2</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>But directly accessing an object and changing its property violates immutability. To satisfy immutability here, you’d need to create a new gain node object every time you change the <code class=\"language-text\">gain</code> property.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setGain</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> newGain <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">createGain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  newGain<span class=\"token punctuation\">.</span>gain <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> newGain<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nstate <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> <span class=\"token function\">setGain</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>While this preserves immutability and lets you track gain node state changes, it can cause problems when object creation is expensive.</p>\n<p>The gain node object provided by the Web Audio API is a full-fledged instance with member variables and methods — it’s not a simple object like <code class=\"language-text\">{ gain: 1 }</code>.</p>\n<p>If an instance has many member variables and methods, or if heavy operations are involved in object creation, creating a new object every time a property changes can put significant strain on performance.</p>\n<p>You could try copying the existing object, but objects created through constructors require re-linking all prototype chains after copying — which isn’t exactly lightweight compared to copying plain objects. <em>(I’ve actually tried this several times, and the performance was worse than expected.)</em></p>\n<p>Carelessly writing code like this in the name of immutability can severely degrade your entire program’s performance, so wise judgment for each situation is necessary.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Originally, I planned to cover not just immutability but also technical topics like currying using the concept of first-class citizens. But once again, I failed at controlling the length.</p>\n<p>It seems that when I write about topics I’m currently passionate about, the content just keeps growing.</p>\n<p>While immutability has been getting a lot of attention on the frontend lately, it’s actually not a frontend-exclusive keyword. Immutability originally gained attention as a way to solve the various problems that arise when mutable state is shared across multiple locations.</p>\n<p>These problems commonly occurred in concurrent programming scenarios like multi-threading. The traditional approach was to use locks — essentially permissions to access state — where threads could only access state when the lock was released.</p>\n<p>But state isn’t limited to one or two variables, and if a lock is set incorrectly and state gets tangled, it’s just as hard for developers to notice. That’s why the concept of immutability — eliminating mutable state entirely — gained traction.</p>\n<p>Languages like Erlang and Rust actually enforce immutability far more strictly than JavaScript. If you’re interested in this topic, experiencing those languages might be worthwhile. <em>(I’m thinking about giving Rust a try myself.)</em></p>\n<p>But JavaScript too — due to its characteristically permissive nature — has caused many developers to suffer from unchecked state management since the ES5 era. As web frontend applications grew more sophisticated and demanded complex state management, these concepts became increasingly relevant.</p>\n<p>I personally have struggled countless times debugging bugs caused by untraceable state changes, so when I first learned about immutability, I remember following the concept with keen interest.</p>\n<p>But as I mentioned, programming with immutability isn’t the right answer for every situation.</p>\n<p>I myself naively attached Redux to my toy project — a <a href=\"https://github.com/evan-moon/simple-waveform-visualizer\" target=\"_blank\" rel=\"nofollow\">Web Audio editor</a> — and have been struggling with performance issues due to the object creation costs I described above. <em>(The example I used earlier was from my own experience.)</em></p>\n<p>As I always say, there’s no absolute technology that fits every situation. Rather than claiming immutability is unconditionally good, I believe the right approach is to use immutability through wise decision-making that fits each situation.</p>\n<p>This concludes my post: How to Keep State from Changing — Immutability.</p>","fields":{"slug":"20200105-what-is-immutableen","path":"/2020/01/05/what-is-immutable/en/","lang":"en"},"frontmatter":{"title":"How to Keep State from Changing – Immutability","subTitle":"Programming that protects state: the meaning and value of immutability","date":"Jan 05, 2020","categories":["Programming","Architecture"],"tags":["Functional Programming","Pure Functions","Immutable","Immer","Redux","Reducer"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/5015b01788f79d9bfd780840b41814f1/d803c/thumbnail.png","srcSet":"/static/5015b01788f79d9bfd780840b41814f1/d803c/thumbnail.png 320w,\n/static/5015b01788f79d9bfd780840b41814f1/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/5015b01788f79d9bfd780840b41814f1/fc5c5/thumbnail.webp 320w,\n/static/5015b01788f79d9bfd780840b41814f1/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/5015b01788f79d9bfd780840b41814f1/01fb2/thumbnail.png","srcSet":"/static/5015b01788f79d9bfd780840b41814f1/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/5015b01788f79d9bfd780840b41814f1/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"b84c22ee-f591-5862-b134-8c6cc7353607","tableOfContents":"<ul>\n<li>\n<p><a href=\"#pure-functions-are-just-mathematical-functions\">Pure Functions Are Just Mathematical Functions</a></p>\n<ul>\n<li><a href=\"#functions-in-mathematics\">Functions in Mathematics</a></li>\n<li><a href=\"#functions-in-programming\">Functions in Programming</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#returning-to-pure-mathematical-functions\">Returning to Pure Mathematical Functions</a></p>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"Following up on my previous post, Functional Thinking – Breaking Free from Old Mental Models, this time I want to talk about “pure functions” — one of the essential concepts you need to understand in order to translate functional programming’s philosophy into actual programs. Around 2017, as the fu…","html":"<p>Following up on my previous post, <a href=\"/2019/12/15/about-functional-thinking/\">Functional Thinking – Breaking Free from Old Mental Models</a>, this time I want to talk about “pure functions” — one of the essential concepts you need to understand in order to translate functional programming’s philosophy into actual programs.</p>\n<p>Around 2017, as the functional programming paradigm rose to prominence, the concept of pure functions gained attention along with it. Even today, if you search for “pure functions” you’ll find countless posts by developers describing their characteristics.</p>\n<p>Generally, when studying pure functions, you’ll encounter a definition like this:</p>\n<blockquote>\n<ol>\n<li>Given the same input (arguments), it must always produce the same output.</li>\n<li>It must not modify external state, nor be affected by external state.</li>\n</ol>\n</blockquote>\n<p>But learning it this way makes it easy to just memorize “pure functions are functions with these characteristics” — when in reality, pure functions are a much simpler concept that doesn’t need to be approached this way.</p>\n<p>Sure, just memorizing these traits is perfectly fine for understanding and using pure functions. But I want to dig a bit deeper into where these characteristics come from and what pure functions actually mean at a fundamental level.</p>\n<h2 id=\"pure-functions-are-just-mathematical-functions\" style=\"position:relative;\">Pure Functions Are Just Mathematical Functions<a href=\"#pure-functions-are-just-mathematical-functions\" aria-label=\"pure functions are just mathematical functions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>We give them the special name “pure functions” and study their characteristics as if they’re something novel, but pure functions are really nothing more than mathematical functions faithfully implemented in the programming world.</p>\n<p>The Wikipedia definition of functional programming gives a more detailed explanation of this concept:</p>\n<blockquote>\n<p><strong>Functional programming</strong> is a programming paradigm that treats computation as the evaluation of <strong>mathematical functions</strong> and avoids changing-state and mutable data. In contrast to imperative programming, which emphasizes changes in state, functional programming emphasizes the application of functions.</p>\n<p><strong>Functional programming - Wikipedia</strong> <em><a href=\"https://en.wikipedia.org/wiki/Functional_programming\" target=\"_blank\" rel=\"nofollow\">source</a></em></p>\n</blockquote>\n<p>The most important keyword in this definition is “mathematical functions.” The thing we study by memorizing various characteristics is literally a pure function — that is, a function as used in mathematics.</p>\n<p>Because we use the concept of “function” in both mathematics and programming, we sometimes forget that programming functions are actually quite different from their mathematical counterparts.</p>\n<p>So let’s revisit the definition of mathematical functions to understand the differences between mathematical and programming functions.</p>\n<h3 id=\"functions-in-mathematics\" style=\"position:relative;\">Functions in Mathematics<a href=\"#functions-in-mathematics\" aria-label=\"functions in mathematics permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The concept of a function that we learned in middle school has roughly the following definition:</p>\n<blockquote>\n<p>For any <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">x \\in X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span>, there <strong>uniquely exists</strong> a corresponding <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>∈</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">y \\in Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n</blockquote>\n<p>It uses the intimidating syntax typical of mathematics, but it’s really not complicated. In this definition, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span> is called the domain and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span> is called the range — think of the domain as the set of possible inputs to the function and the range as the set of possible outputs.</p>\n<p>In other words, the domain contains the values used as function arguments, and the range contains the values produced as results.</p>\n<p>But the most important part of this definition isn’t the domain or range — it’s the concept that for each input value, the corresponding output value <strong>uniquely exists</strong>.</p>\n<p>When you give a value to a function, it must return exactly one value. That is the original definition of a function.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/33c48b0d809a227af542dee05cf064b5/80cfc/functions.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVR42m2T207DMAyG3axt0tM6YBsgJC6QuNlASLvhqXggXoEX4zGK034GD7D0K4kPvx07ERE5Kk6KR0Uhi7SKF8U9OtNfK14Vz4pRfuQBXZMPSdFDYrLi3DqyLAHfTlE6fUIXBYdKscaQCTbok2VFGnQt/gUkl6ydsedsA4YctFdcucwmPdVnny22C8UNLcj+38xrKsv7HYSBcwAtyRtg5NFVPx8yagIqSBIBRmh9DfjYviE22jUi1fkK91wp/ENYYr8jZuTKAz5nldhgrJcFfQtuv6LCLf2ztbIBtrBvMNRk3PnJIR1Bg3tmeb1F19jkLLBw78omXDvC2pEm9zZtML38aeyb4mO+VvKNdhKx1QfFtPS0dEOiqnG+8kne9Qt9zk0Xmc5+yW95UsLDtHxZdV18vwAdIhBsPqNo7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"functions\" title=\"\" src=\"/static/33c48b0d809a227af542dee05cf064b5/6af66/functions.png\" srcset=\"/static/33c48b0d809a227af542dee05cf064b5/69538/functions.png 160w,\n/static/33c48b0d809a227af542dee05cf064b5/72799/functions.png 320w,\n/static/33c48b0d809a227af542dee05cf064b5/6af66/functions.png 640w,\n/static/33c48b0d809a227af542dee05cf064b5/d9199/functions.png 960w,\n/static/33c48b0d809a227af542dee05cf064b5/21b4d/functions.png 1280w,\n/static/33c48b0d809a227af542dee05cf064b5/80cfc/functions.png 1844w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>As shown in the right diagram, if a domain element has no corresponding range element<br>or has two or more, it no longer satisfies the definition of a function</small>\n</center>\n<p>For easier understanding, consider a simple function that multiplies its argument by 2. We express this as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">f(x) = 2x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">x</span></span></span></span></span>.</p>\n<p>If we set <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> to 1, we get <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mo>×</mo><mn>1</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">f(1) = 2 \\times 1 = 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span></span>. If one day <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> suddenly equaled 3, then the function would no longer have a unique range element corresponding to a specific domain element — and it could no longer be called a function.</p>\n<p>The characteristics commonly attributed to pure functions originate from these very properties of mathematical functions.</p>\n<h3 id=\"functions-in-programming\" style=\"position:relative;\">Functions in Programming<a href=\"#functions-in-programming\" aria-label=\"functions in programming permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>But functions in programming have no such constraints. Without even getting into elaborate examples — don’t we have <code class=\"language-text\">void</code> functions that return nothing at all?</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>From the perspective of mathematical functions, a <code class=\"language-text\">void</code> function is not a function. There’s no range element corresponding to the domain element <code class=\"language-text\">x</code>. That’s why we say the concept of a function in programming differs somewhat from its mathematical counterpart.</p>\n<p>In truth, programming functions merely borrowed the idea of “you give it a value and it computes something” from mathematical functions. From a mathematical standpoint, programming functions are more often <em>not</em> functions than they are.</p>\n<p>Most importantly, the biggest difference between mathematical functions and programming functions is that a programming function’s behavior can be inconsistent.</p>\n<p>The mathematical function <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">f(x) = 2x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">x</span></span></span></span></span> from earlier is guaranteed to always return 2 when given 1 as input, regardless of its internal implementation. But in programming, you can easily create functions that don’t behave this way.</p>\n<p>Think of functions that use methods like <code class=\"language-text\">Math.random</code> or <code class=\"language-text\">Date.prototype.getTime</code>. These methods produce values that have nothing to do with the function’s logic, so if a function’s computation depends on them, the developer can never predict what value the function will return.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">sum</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token number\">5</span> <span class=\"token comment\">// ?</span>\n<span class=\"token number\">4</span> <span class=\"token comment\">// ?</span>\n<span class=\"token number\">9</span> <span class=\"token comment\">// ?</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>These kinds of concepts exist only in the programming world, where values with specific meanings can be stored, assigned, and retrieved. In mathematics, such concepts simply don’t exist.</p>\n<p>We call these values with specific meanings “state.” State plays a useful role in representing a program’s current situation, but when code everywhere references or modifies state indiscriminately, even the developer can lose track of how the program is behaving.</p>\n<p>That’s why developers prefer to impose specific rules and constraints on state mutations — minimizing indiscriminate state changes and making changes trackable.</p>\n<p>The problem is that programming functions frequently develop entanglements with state — more precisely, with state outside the function. Here’s a simple function called <code class=\"language-text\">addState</code> that takes a number and adds it to a variable declared outside the function.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">let</span> state <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">addState</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> state <span class=\"token operator\">+</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">addState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">4</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The <code class=\"language-text\">addState</code> function references an external value called <code class=\"language-text\">state</code> and adds it to its argument. In other words, this function’s return value is dependent on the external state variable <code class=\"language-text\">state</code> — a situation that can make it impossible for developers to predict the function’s behavior.</p>\n<p>If <code class=\"language-text\">state</code> gets modified somewhere else, things get even messier.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">state <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">addState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token number\">11</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>We called the same function with the same argument, but got a completely different result. Because this function’s return value changes with external state, the developer simply cannot predict its behavior.</p>\n<p>When a function is affected by external state or directly modifies external state, we call this a “side effect.” Functions that produce side effects are one of the risk factors that cause bugs developers can’t anticipate.</p>\n<p>For this reason, languages like JavaScript have conventions that discourage declaring and assigning global variables, and React Hooks provides a <code class=\"language-text\">useEffect</code> hook specifically to separate side-effect-producing operations.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">TestComponent</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'greeting'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">removeItme</span><span class=\"token punctuation\">(</span><span class=\"token string\">'greeting'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">TestComponent</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is a simple function in a contrived scenario, so it might look artificial. But in real applications, there are plenty of functions doing far more complex and bizarre things.</p>\n<p>For instance, a simple function that returns the result of communicating with an API server is also a type of impure function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getUsers</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It’s obvious that <code class=\"language-text\">getUsers</code> won’t return the same value every time it’s called. The user list can change depending on the current database state.</p>\n<p>Because impure functions make it impossible for developers to predict results, writing tests to verify their behavior is also impossible. How do you test something when you can’t even guess what it’ll output?</p>\n<p>As you can see, functions in the programming world have far more variables than mathematical functions and are much harder to predict.</p>\n<h2 id=\"returning-to-pure-mathematical-functions\" style=\"position:relative;\">Returning to Pure Mathematical Functions<a href=\"#returning-to-pure-mathematical-functions\" aria-label=\"returning to pure mathematical functions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now that we’ve examined the differences between mathematical functions and programming functions, let’s revisit the definition of pure functions:</p>\n<blockquote>\n<ol>\n<li>Given the same input (arguments), it must always produce the same output.</li>\n<li>It must not modify external state, nor be affected by external state.</li>\n</ol>\n</blockquote>\n<p>As I discussed, in mathematics, a function simply takes an input, performs some calculation, and produces exactly one result.</p>\n<p>And since mathematics has no concept of state — values that can be stored, assigned, and retrieved — there can obviously be no such thing as a side effect where a function interacts with external state.</p>\n<p>In other words, when you apply mathematical functions directly to programming, the pure function properties — “a function’s result is determined only by its arguments” and “a function must not modify or be affected by external state” — are naturally satisfied.</p>\n<p>And the immutability that functional programming talks about is also rooted in mathematics. Since pure functions implement mathematical functions — which have no concept of state — the concept of mutating state shouldn’t exist either.</p>\n<p>But because state undeniably exists in the programming world, we explicitly define and uphold constraints like “you must not directly modify a function’s arguments.”</p>\n<p>The advantages that come with using pure functions — “testing becomes easier” and “referential transparency is guaranteed” — are also completely obvious when you think about mathematical functions.</p>\n<p>As I briefly mentioned, writing unit tests for a function that returns different values each time is truly hopeless. Since the developer can’t predict the function’s behavior, they can’t provide a correct answer to test against — making test writing impossible.</p>\n<p>And the claim that pure functions guarantee referential transparency is really nothing special once you consider what the <code class=\"language-text\">=</code> sign means in mathematics.</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mo>∴</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mn>1</mn><mo>=</mo><mn>3</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\nf(x) = 2x\\\\\n\\\\\nf(1) = 2\\\\\n\\\\\n\\therefore f(1) + 1 = 3\n\\end{aligned}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:7.5em;vertical-align:-3.5em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4em;\"><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">2</span></span></span><span style=\"top:-1.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mrel amsrm\">∴</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5em;\"><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<center>\n  <small>Referential transparency means that replacing $f(1)$ (the function call) with $2$ (the function's result)<br />doesn't change the computation's outcome — and we've been using this concept in math all along</small>\n  <br />\n  <br />\n</center>\n<p>Pure functions let you predict what result you’ll get for any given arguments, and because they eliminate the concept of state entirely, they make it easier for developers to build predictable applications.</p>\n<p>Furthermore, since a pure function focuses solely on its own computation regardless of external state, a pure function declared in one application is guaranteed to behave identically when transplanted to another. This aligns with one of the key conditions for good modularization: “high cohesion.”</p>\n<p>Applications built with pure functions are easier for developers to understand in terms of both structure and behavior. So even outside the functional programming paradigm, pure functions are a concept that meaningfully benefits overall application design.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When I first encountered the concept of pure functions, I learned about their characteristics, advantages, and disadvantages through Google searches and blog posts by other developers. At the time, my reaction was “Great, yet another thing to study.”</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ec770d51e3153214eac6e428c748abbb/80e3c/study.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 113.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECBAMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAfbjPCbFS86hpB//xAAcEAEAAgIDAQAAAAAAAAAAAAABAAIRIgMSMTL/2gAIAQEAAQUCvrURmScttj76ktTKURPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGBABAAMBAAAAAAAAAAAAAAAAEQEQIQD/2gAIAQEABj8CRsniJ202v//EABoQAQEAAwEBAAAAAAAAAAAAAAERACFBUXH/2gAIAQEAAT8hQlF4dz2h8cl2YJTqwM2io3OzBCpfuPSDunpgDf0rtwwmf//aAAwDAQACAAMAAAAQ7M8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8QKf/EAB0QAQACAwEAAwAAAAAAAAAAAAEAESExQWGBoeH/2gAIAQEAAT8QpGGti8i3Ae37AVU8OJVFeiG3V39RoErA9NvxLsE9hQU5GkhsIFAUZ7FabQBn/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"study\" title=\"\" src=\"/static/ec770d51e3153214eac6e428c748abbb/c08c5/study.jpg\" srcset=\"/static/ec770d51e3153214eac6e428c748abbb/0913d/study.jpg 160w,\n/static/ec770d51e3153214eac6e428c748abbb/cb69c/study.jpg 320w,\n/static/ec770d51e3153214eac6e428c748abbb/c08c5/study.jpg 640w,\n/static/ec770d51e3153214eac6e428c748abbb/80e3c/study.jpg 720w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>Yet another thing to add to the study list...</small>\n  <br>\n  <br>\n</center>\n<p>When you first encounter a paradigm like pure functions, you instinctively turn to Google to gather information. Most of the time, you end up studying from posts that other people have written.</p>\n<p>But studying this way, I found that I often learned a few characteristics and pros and cons first, without deeply understanding the fundamental reason or principle behind the paradigm.</p>\n<p>So I initially received pure functions as “something new I need to study.” But when I later thought about it carefully and realized it was simply the mathematical concept of a function — something I’d learned as a kid — implemented in programming, I remember feeling a bit anticlimactic.</p>\n<p>That’s exactly why I didn’t explain pure functions in this post as “functions with such-and-such characteristics.” This is just my personal view, but since most people already learned the definition and concept of functions in school, I thought approaching it through the lens of “mathematical functions” would actually lead to faster understanding.</p>\n<p>Anyway, what I wanted to convey through this post is that pure functions are not a novel concept at all — they’re something anyone who went through basic math education should find familiar.</p>\n<p>Of course, how to design programs using pure functions isn’t covered in school curriculum and requires separate study. But at least understanding pure functions and immutability — key concepts in functional programming — shouldn’t be all that difficult.</p>\n<p>In the next post, I plan to discuss “immutability” — another important concept in functional programming alongside pure functions.</p>\n<p>This concludes my post: Pure Functions — A Programming Paradigm Rooted in Mathematics.</p>","fields":{"slug":"20191229-about-pure-functionsen","path":"/2019/12/29/about-pure-functions/en/","lang":"en"},"frontmatter":{"title":"Pure Functions – A Programming Paradigm Rooted in Mathematics","subTitle":"Pure functions: the power to make complex code simple","date":"Dec 29, 2019","categories":["Programming","Architecture"],"tags":["Functional Programming","Pure Functions","Side Effects"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/023de5bc6ce10c061b00421bd714ce0c/d803c/thumbnail.png","srcSet":"/static/023de5bc6ce10c061b00421bd714ce0c/d803c/thumbnail.png 320w,\n/static/023de5bc6ce10c061b00421bd714ce0c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/023de5bc6ce10c061b00421bd714ce0c/fc5c5/thumbnail.webp 320w,\n/static/023de5bc6ce10c061b00421bd714ce0c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/023de5bc6ce10c061b00421bd714ce0c/01fb2/thumbnail.png","srcSet":"/static/023de5bc6ce10c061b00421bd714ce0c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/023de5bc6ce10c061b00421bd714ce0c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"706d803f-d599-55ee-a766-9b6bc1f21fd2","tableOfContents":"<ul>\n<li>\n<p><a href=\"#why-should-i-learn-functional-programming\">Why Should I Learn Functional Programming?</a></p>\n</li>\n<li>\n<p><a href=\"#a-high-level-of-abstraction\">A High Level of Abstraction</a></p>\n<ul>\n<li><a href=\"#what-abstraction-really-means\">What Abstraction Really Means</a></li>\n<li><a href=\"#is-a-higher-level-of-abstraction-always-better\">Is a Higher Level of Abstraction Always Better?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#imperative-and-declarative-thinking-are-fundamentally-different\">Imperative and Declarative Thinking Are Fundamentally Different</a></p>\n<ul>\n<li><a href=\"#how-do-we-solve-it-imperative-programming\">How Do We Solve It? (Imperative Programming)</a></li>\n<li><a href=\"#what-are-we-solving-declarative-programming\">What Are We Solving? (Declarative Programming)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#programs-made-of-objects-vs-programs-made-of-functions\">Programs Made of Objects vs. Programs Made of Functions</a></p>\n<ul>\n<li><a href=\"#thinking-in-smaller-pieces\">Thinking in Smaller Pieces</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"Recently, more and more languages have been adopting the functional programming paradigm, and developer interest has been rising steadily along with it. I remember becoming deeply curious about functional programming — a paradigm that felt so different from what I was used to — after reading the bo…","html":"<p>Recently, more and more languages have been adopting the functional programming paradigm, and developer interest has been rising steadily along with it. I remember becoming deeply curious about functional programming — a paradigm that felt so different from what I was used to — after reading the book <em>Functional Thinking</em>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9ef259e7b6e3fe6fc92d5652c070314f/9568a/functional_thinking_book.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMEBQH/xAAXAQEBAQEAAAAAAAAAAAAAAAACAwAB/9oADAMBAAIQAxAAAAHkc9c1laBTxLxzVQj/AP/EABsQAAMBAQADAAAAAAAAAAAAAAECAwASERMx/9oACAEBAAEFAoy5l9PqOdj46bF1TRqUAu2ZiW//xAAXEQADAQAAAAAAAAAAAAAAAAABERIg/9oACAEDAQE/AZYx/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQIBAT8BI//EABoQAAMAAwEAAAAAAAAAAAAAAAABESExQRD/2gAIAQEABj8CzslfmH0RHsiODbP/xAAbEAEBAQEBAAMAAAAAAAAAAAABEQAhMUFxof/aAAgBAQABPyEEb6Fmh+odfya7aPw+sAoVTzTZ8dmTwlvck8z2QXf/2gAMAwEAAgADAAAAECcHvv/EABkRAQACAwAAAAAAAAAAAAAAAAEAEBEhYf/aAAgBAwEBPxAehmexr//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESFh/9oACAECAQE/ECu7HIi//8QAHhABAAIBBAMAAAAAAAAAAAAAAQARMSFBUXFhgdH/2gAIAQEAAT8QE0rAUs0PUXEfEswU2bzLgQVuuykrJwWK36iBgAgaDCtaxHjuGWu/D9iNZDP/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"functional thinking book\" title=\"\" src=\"/static/9ef259e7b6e3fe6fc92d5652c070314f/c08c5/functional_thinking_book.jpg\" srcset=\"/static/9ef259e7b6e3fe6fc92d5652c070314f/0913d/functional_thinking_book.jpg 160w,\n/static/9ef259e7b6e3fe6fc92d5652c070314f/cb69c/functional_thinking_book.jpg 320w,\n/static/9ef259e7b6e3fe6fc92d5652c070314f/c08c5/functional_thinking_book.jpg 640w,\n/static/9ef259e7b6e3fe6fc92d5652c070314f/6a068/functional_thinking_book.jpg 960w,\n/static/9ef259e7b6e3fe6fc92d5652c070314f/eea4a/functional_thinking_book.jpg 1280w,\n/static/9ef259e7b6e3fe6fc92d5652c070314f/9568a/functional_thinking_book.jpg 3024w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A cute little squirrel book I've read multiple times because it's so enjoyable</small>\n</center>\n<p>Of course, reading this book alone doesn’t make you fluent in functional programming. Concepts and techniques like currying, monads, and higher-order functions can become familiar with dedicated study and practice, but as I mentioned, truly designing programs with any paradigm requires fundamentally changing the way you think.</p>\n<p>For that reason, this post won’t focus on specific functional programming skills. Instead, I want to talk about why functional programming has gained so much attention, and what concepts this paradigm uses to view and structure programs.</p>\n<h2 id=\"why-should-i-learn-functional-programming\" style=\"position:relative;\">Why Should I Learn Functional Programming?<a href=\"#why-should-i-learn-functional-programming\" aria-label=\"why should i learn functional programming permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Honestly, object-oriented thinking and imperative programming are more than enough to design and write most programs. We’ve been building massive programs with these approaches for decades, haven’t we?</p>\n<p>But functional programming is attracting so much attention because it clearly differs from those approaches — and those differences allow developers to be more productive.</p>\n<p>So what exactly about functional programming has won developers over?</p>\n<p>Different developers will have different reasons, but the key advantages I’ve personally felt are these:</p>\n<blockquote>\n<ol>\n<li>It provides a high level of abstraction</li>\n<li>Code reuse at the function level is easier</li>\n<li>By favoring immutability, program behavior becomes more predictable</li>\n</ol>\n</blockquote>\n<p>You’ll likely find similar points highlighted in other blog posts and books on functional programming.</p>\n<p>Among these advantages, immutability is less a benefit of functional programming itself and more a natural consequence of using pure functions. I’ll save that discussion for when I cover pure functions in detail. For this post, I want to focus on the keywords “high-level abstraction” and “function-level reuse.”</p>\n<h2 id=\"a-high-level-of-abstraction\" style=\"position:relative;\">A High Level of Abstraction<a href=\"#a-high-level-of-abstraction\" aria-label=\"a high level of abstraction permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Fundamentally, functional programming is a paradigm that implements the characteristics of declarative programming through compositions of functions. And one of the hallmark advantages of declarative programming is that it provides a higher level of abstraction than the methods used in imperative or object-oriented programming — allowing developers to focus solely on solving the problem at hand.</p>\n<p>To understand what this “high level of abstraction” that declarative programming offers really means, and what its pros and cons are, we first need a clear understanding of the concept of abstraction itself.</p>\n<h3 id=\"what-abstraction-really-means\" style=\"position:relative;\">What Abstraction Really Means<a href=\"#what-abstraction-really-means\" aria-label=\"what abstraction really means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>If you’re familiar with object-oriented programming, you might describe abstraction as the act of extracting and organizing the characteristics of something that exists in the real world. That’s not wrong, and when you’re first learning OOP, thinking about it this way is perfectly fine.</p>\n<p>But the fundamental meaning of the word “abstraction” covers a much broader range of concepts than simply defining a class from an object’s characteristics.</p>\n<p>At its core, abstraction is about making the complex things that underlie some task appear simple. The act of abstracting an object into a class definition in OOP is, fundamentally, consistent with this definition.</p>\n<p>Consider a <code class=\"language-text\">Human</code> class that has a name and can introduce itself. Let’s create an object from it and call its method.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Human</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello, I am </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> me <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Human</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>me<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Hello, I am Evan.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>There’s an important fact here. Because we usually create both the class and the object ourselves, it’s easy to overlook — but even if you had no idea how the <code class=\"language-text\">Human</code> class was implemented, you could still create an object from it and use its methods without any problem.</p>\n<p>As long as you know what functionality the class exposes to the outside world, you can create objects and call methods to get the behavior you want.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">constructor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Human<span class=\"token punctuation\">;</span>\n  <span class=\"token function-variable function\">say</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In object-oriented programming, we use access modifiers like <code class=\"language-text\">public</code> and <code class=\"language-text\">private</code> to expose only what we want to — a technique called encapsulation — in order to provide users with a high level of abstraction.</p>\n<p>Beyond classes, the libraries we commonly use are also a form of abstracted modules.</p>\n<p>If we had to fully understand the implementation source of a library like React or RxJS before we could use it, things would be incredibly difficult. But we don’t need to examine every line of a library’s source code — as long as we read the official documentation to understand its features, we can use it just fine. <em>(The catch is that using it well does require reading the source.)</em></p>\n<p>And the OS APIs and browser APIs we use when writing programs are also a kind of abstracted feature list. Thanks to these abstracted lists, as long as we know what each API does, we can comfortably issue commands to the computer without dealing with low-level operations directly.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d9fa4d13c36832f6cdcfb84a4637551c/37523/abstraction.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 97.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADOElEQVR42q3PXWgTWRQH8OsXorARNQEf3AcxWvBNir5pcAvqUlvjJ21Nqijqrk8u+iZSQdBVsBUEl+2DrtraSVPqR5tQ20lMWtu0ySSdTCbz0Ta1aTOp6ColutZA4tmTYSuzaSoVvPCbc+89/3u5Q0jhseC/WoQOoq3oGFqX1//msQytMRqN67Ea0BLyHcaCkpKSzcXFxfO87NChRXMymRbnLty2c+ePxt27l5KamoVfzc/ndbnPPpNp7an5vlBfWrlBb7ZuLGR1+ZEinanMuGbLtu2rfirfpN9/bM6socxiVP/IsO8o6PdapvV7rWktA1pZdiRttPyS3vHbhfS6qlPq2pCXU5mtnwxm62fDfusussJcDbrSyoxuTyVorSirguU/H4ai6jNgvngF1ltOq+vcfn5Wt6ciqyu3wA+lFeXkxLU/7XM5jqou37IfvnTTbsH6tezJ6/VUTX3rRnLr6Quoa6GzdS0u0Lphp6G+/QU8pBn4q6MfHnT64fZjL9Tifn62tsWV+cPhg3ttfWfJ1QZH+vdG59TVRmdK60qDI1XX3JW6296Tqn/qTd3BWmvrVPcLZKeuPezI3HcO/ErsdNDXTDN9+SjU0OHvu+/0oX5Vbk11zs7aupjeFjrE+HyxA+TRgAw2D5u1ecMwo8nDQptPBA87Cq7QCNAoN/eER6G1lwcK+9o85WUzbUwMHL3iOdLY6X+NEo1dfmVGA7K5GOVJd1h55A0rrR4WDSpPcE7RAbWvzeP5iSaaedvREz1O3AGZd/nlMOK06AGJe+aLcnS/oM5pPxoQuPxcjjswxOI9cpAdryCB0TfQzY9le6Jx+EIYBy83Cu2eADi6g+DwBqHN7QdnTwi6Iy/hf1mE5zOh+DtgxMQ54maGRDcjR54zMj9LQOLdfpGn+5GPxyrgvjQr5w7KnJcZGmZC41UkIiXjvJQcQTGtiKjEBvl4jI2OqyJiIsYJiVh+Ts1KyWFeTiqCkKwmb/8BmHj9MZt4Mw0zlL8/QXzyPQQGh4FhEdYgOwKD/BjEX31Q+9o8ns9MTQOMJT6cJ1FpsjkqvWrixSRVCCcoFCcqVFiYUOeFMlEp2ZS7h5cnt/4L+y9SOB3xvXcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"abstraction\" title=\"\" src=\"/static/d9fa4d13c36832f6cdcfb84a4637551c/6af66/abstraction.png\" srcset=\"/static/d9fa4d13c36832f6cdcfb84a4637551c/69538/abstraction.png 160w,\n/static/d9fa4d13c36832f6cdcfb84a4637551c/72799/abstraction.png 320w,\n/static/d9fa4d13c36832f6cdcfb84a4637551c/6af66/abstraction.png 640w,\n/static/d9fa4d13c36832f6cdcfb84a4637551c/37523/abstraction.png 720w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>If you know the abstracted OS API, you can build programs without understanding the hardware</small>\n  <br>\n  <br>\n</center>\n<p>If you’re not a developer, think about the everyday programs you use.</p>\n<p>For example, imagine you’re using Photoshop to convert a color photo to black and white. Photoshop performs complex image processing operations under the hood, but thanks to its various features, we can focus solely on the act of editing the photo.</p>\n<p>In reality, converting a color photo to black and white requires iterating through the pixel data — a matrix of values — and averaging the RGB values, among other steps. But because all that complex, tedious work is abstracted away, the user simply needs to click “Image > Adjustments > Desaturate.”</p>\n<p>In short, abstraction means taking something complex and distilling it down to its core concepts or features to make it simple. When a program is well-abstracted, the user can comfortably use its features without knowing what lies beneath their layer of abstraction or how it works.</p>\n<h3 id=\"is-a-higher-level-of-abstraction-always-better\" style=\"position:relative;\">Is a Higher Level of Abstraction Always Better?<a href=\"#is-a-higher-level-of-abstraction-always-better\" aria-label=\"is a higher level of abstraction always better permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As we just discussed, abstraction is the act of making something complex appear simple. A higher level of abstraction means the act of simplification itself has become more sophisticated.</p>\n<p>In that sense, a higher level of abstraction is certainly more convenient for users. For those who aren’t sure what “more convenient” means here, let me use programming languages as an example.</p>\n<p>When building a program, we could use machine code made of <code class=\"language-text\">0</code>s and <code class=\"language-text\">1</code>s, or assembly, or a high-level language close to natural language like Java.</p>\n<p>If you grabbed a random developer off the street and asked “Would you rather code in machine code or assembly?”, almost no one would pick machine code. Machine code is barely abstracted at all — practically raw — making it extremely difficult for humans to understand.</p>\n<p>And if you asked “Assembly or Java?”, very few would choose assembly either. In this case, assembly has a much lower level of abstraction compared to Java, so coding in Java is simply more comfortable for humans. This is a textbook example of the difference in abstraction levels.</p>\n<p>Writing a large program in assembly means the developer has to manage an enormous number of details, but with Java, you can use syntax like <code class=\"language-text\">for</code> and <code class=\"language-text\">if</code> along with various APIs, programming more comfortably than in assembly. All the tedious work of allocating values to memory, gathering them in registers, and pulling them back out is handled by the JRE (Java Runtime).</p>\n<p>This pattern of newer technologies providing higher levels of abstraction and greater convenience isn’t something that started with functional programming — it’s been an extremely common occurrence throughout the history of computer science. As technology advances and raises the level of abstraction, we become capable of building increasingly complex programs.</p>\n<p>However, a high level of abstraction isn’t all upside. Whenever a technology touts high abstraction as an advantage, there’s a strong chance it will face criticism like “the performance is bad” or “how are you supposed to optimize when everything’s abstracted away?” The poster children for this kind of controversy are Java and garbage collectors. <em>(And assembly, for that matter…)</em></p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 490px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/80458efa897102920b95181e9337ff64/41d3c/von_neumann.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 130.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7zAAAO8wEcU5k6AAAElUlEQVR42i2UWSyeWxSGv0NKDX9pY55V1VzzUDUrLS1qlqJBBQklhqopjTGEqKHEXI2QiLlucEUI0gukKgTpkVAhgkQi4krO8/vPd7Gzs7/97vWud71rCdbW1g8fPjQxMXFwcHBycvL29vb39w8KCoqPj09MTHz79m10dPSbN2+eP3/+9OlTyR0+d3f3gIAAwdDQUENDw8DAwMLCwsXFxc/Pj9OQkJCkpKTs7Oz09HSeCA8PB/zs2TNHR0dXV1c3NzdPT8+XL18KqqqqsrKyKioq4O3t7bn06tWryMjIjIyMzMzMhISEmJiYuLi4sLAwCR4YG2KIwQ8ePJCRkZGXl1dWVjY3N/fy8iIymJycHEtLS2dnZ/bctrGx4TYZsff19ZUQFMD8c/tJSUlpa2vzmzw/f/5cWFiYnJw8Ojr69+/frq6u+/fvk2BwcDBgdAEfGBgo3Lt3TxAEwKwwJ71Pnz719va2tLTMzc3t7OycnZ1dXFyQPxfQDPF8fHwkov4PJiyrra1tdXX14ODg2NjY2tra/v7+8fHx5eXlzc3Nr1+/UBSaoaGhyPn69WtUEBQUFIDduXOHlSeXlpbm5+cBHx4eQvjo6Oj6+vrq6ur8/DwqKgqCSEA6KEoJBTk5OWCKiopKSkqksb6+Pjk52dnZ+fv37z9//vx7++3t7fEQGKQtKioqKCigkLGxseLI0tLSFExHRwdKXBoYGGhoaIDn5uYmyIODg93d3e3tbfTX09Orq6srKyvLz89PS0sTCEgmjx8/trKyghLR2tvbkQ3BpqenGxsbCUKd+/v7W1tbEYy1qqoKUfPy8gRdXV0jIyO8Rd3ev38/MTGBMT08PCSADx8+UBuCoMKPHz8wXHNzM6J+/PgxNzdXQEOM9eLFi3fv3vHYysrKly9furu729raxsfHyXZjYwPaJycnQ0NDPDEyMlJRUQEY/wm4HMchXVZWFqc/f/6Edl9fH5qR9tbWFitCLC4u4pyvX79+//69tLSUsotzxuh4DZLo8e3bN+LMzs729PSwJ3h5eTlv4RbCwnN4eJhDCJIgEIEWob9oA55EJGCrq6uoXVNTAxHsifgo1NHRgXIlJSWETU1NpS7ixrCzs4MPrqLdMLCZmRn3oMch9SA3GPEKKy4gRzoHb2FvgMLCwsLU1JS6ujpWEYlE1IxL9AYkERaFuYAf0JmuAMzY4ALBMbmAMAwDicloT3qD4KampikpKeiPmahccXExmdNz9DOlhjNpV1ZWiqNJvE1L4zMJmEOctLy8zCEvnp6ekqqamhpzgrBki53QUmwSkAwT4rMHzAoGhihH32J+hKyvrycsVHEECZM2dASmh6amJjF5mGGI29ijHM8h0szMDP5tamqqra0FTDOSC/3IHvMJGJM0IiIijI2NmTVEZp7x0JMnT2h3eGppaaE8daKonEiGKb5ktgnswOA1xIQPBaMGTC/JrKSBoUaeVIG/3KGT8RUxiCpQBmISgfJAQTLl0IwOBUwDIxjThrblUV6EM8MMIWAn0EAMfWoDHpH4ARKq9LlkpRYgWZFGX1//0aNHd28/kUj0Hzx0J4PMGZytAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"von neumann\" title=\"\" src=\"/static/80458efa897102920b95181e9337ff64/41d3c/von_neumann.png\" srcset=\"/static/80458efa897102920b95181e9337ff64/69538/von_neumann.png 160w,\n/static/80458efa897102920b95181e9337ff64/72799/von_neumann.png 320w,\n/static/80458efa897102920b95181e9337ff64/41d3c/von_neumann.png 490w\" sizes=\"(max-width: 490px) 100vw, 490px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    John von Neumann (1903–1957)<br>\n    The man who said we shouldn't waste computer performance on things like assembly\n  </small>\n</center>\n<p>Java’s great strength was that using bytecode and the JVM (Java Virtual Machine), you could write code once and have it run on any OS. Compared to earlier languages that were tied to specific operating systems or CPUs, the level of abstraction had risen significantly. But when Java first came out, it was heavily criticized for being too slow compared to C to be practical.</p>\n<p>Garbage collectors, too, provide the convenience of not having to manually allocate and free memory. But they come with their own issues: performance costs from constantly tracking when to free objects, the difficulty of knowing exactly when an object is freed from memory, and problems like the inability to free circular references when using <a href=\"https://en.wikipedia.org/wiki/Reference_counting\" target=\"_blank\" rel=\"nofollow\">reference counting</a>. They don’t always work perfectly.</p>\n<p>That said, not many people would actually prefer to use C and manually manage memory in an environment where Java and garbage collection are available. These high-abstraction technologies exist and thrive precisely because modern machines can cover the performance costs to a reasonable degree.</p>\n<p>Functional programming, as a paradigm that pursues a high level of abstraction, does come with some performance trade-offs. In fact, the concept of abstracting programs at the function level has been around since <a href=\"https://en.wikipedia.org/wiki/Lisp_(programming_language)\" target=\"_blank\" rel=\"nofollow\">LISP</a> was introduced in 1958, but back then, such concepts probably felt like a luxury. When memory was so scarce that even a single task was a struggle, who had room for abstraction?</p>\n<p>But today’s machines are performant enough to comfortably handle the level of abstraction that functional programming demands, so performance concerns feel largely irrelevant.</p>\n<p>And if you’re writing a program where performance truly matters, you don’t have to insist on functional programming. There’s no single “correct” paradigm anyway. Just as people still use C or assembly for optimization today, functional programming is best used judiciously, in the right situations.</p>\n<p>Now, to see what form functional programming’s high-level abstraction actually takes, let’s compare imperative programming — the paradigm we’re already familiar with — against declarative programming, the parent concept of functional programming.</p>\n<h2 id=\"imperative-and-declarative-thinking-are-fundamentally-different\" style=\"position:relative;\">Imperative and Declarative Thinking Are Fundamentally Different<a href=\"#imperative-and-declarative-thinking-are-fundamentally-different\" aria-label=\"imperative and declarative thinking are fundamentally different permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Imperative programming means explicitly telling the computer <em>how</em> to solve a problem, step by step. Declarative programming means focusing on <em>what</em> to solve, and delegating the how to the computer.</p>\n<p>From the earliest days of programming until relatively recently, we’ve primarily used imperative programming — explicitly commanding the computer. Functional programming, however, is a form of declarative programming: it focuses more on the problem to solve and hands the mundane details off to the computer.</p>\n<p>Because declarative programming delegates trivial tasks to the computer, the keyword “high-level abstraction” inevitably follows. If the abstraction level were low, the developer would have to manually control every one of those trivial tasks.</p>\n<p>Let’s compare how imperative and declarative programming solve a problem, and examine the difference in abstraction levels between the two paradigms. Here’s our problem:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'evan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'joel'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mina'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<blockquote>\n<p>Iterate through the array, filter out empty strings, and capitalize the first letter of each element.</p>\n</blockquote>\n<h3 id=\"how-do-we-solve-it-imperative-programming\" style=\"position:relative;\">How Do We Solve It? (Imperative Programming)<a href=\"#how-do-we-solve-it-imperative-programming\" aria-label=\"how do we solve it imperative programming permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Imperative programming is literally about giving the computer detailed instructions on how to perform the task. More precisely, it’s about issuing step-by-step commands to build your way toward the result you want.</p>\n<p>Since most working developers today started learning to code with the traditional imperative paradigm, this approach feels natural to many of us — myself included.</p>\n<p>When most developers encounter this kind of problem, they’ll think of using a loop like <code class=\"language-text\">for</code> to sequentially traverse and process the array elements.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> newArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> arr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    newArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Writing code that repeats an action using a <code class=\"language-text\">for</code> loop is so familiar to developers that we could do it with our eyes closed — but that very familiarity makes us overlook just how many instructions are packed into this short piece of code.</p>\n<p>Here’s roughly what I was thinking when I wrote the code above:</p>\n<blockquote>\n<ol>\n<li>Initialize variable <code class=\"language-text\">i</code> to <code class=\"language-text\">0</code></li>\n<li>If <code class=\"language-text\">i</code> is less than the length of <code class=\"language-text\">arr</code>, execute the loop body</li>\n<li>After each iteration, increment <code class=\"language-text\">i</code> by <code class=\"language-text\">1</code></li>\n<li>Access the <code class=\"language-text\">i</code>th element of <code class=\"language-text\">arr</code></li>\n<li>If the element’s length isn’t <code class=\"language-text\">0</code>, capitalize its first letter</li>\n<li>Push the resulting string into the <code class=\"language-text\">newArr</code> array</li>\n</ol>\n</blockquote>\n<p>My thought process while writing the code maps exactly to the commands I need to give the computer.</p>\n<p>In other words, I have to manually manage the state of <code class=\"language-text\">i</code>, keep track of which index I’ve traversed by incrementing <code class=\"language-text\">i</code> each loop, access array elements directly using <code class=\"language-text\">i</code>, and check whether each element is an empty string.</p>\n<p>This approach — issuing granular commands to the computer to build toward your desired result — is what we call imperative programming.</p>\n<p>Now let’s revisit the problem we need to solve:</p>\n<blockquote>\n<p>Iterate through the array, filter out empty strings, and capitalize the first letter of each element.</p>\n</blockquote>\n<p>Can you read through those commands and immediately picture this problem? Since this particular problem is simple, you might. But for something more complex, you’d probably need to read through it several times and maybe sketch a diagram.</p>\n<p>In other words, imperative programming is closer to how computers think than how humans think, so it’s not exactly human-friendly. That’s why developers practice this kind of thinking through exercises like algorithm problems.</p>\n<p>So what does the same task look like in declarative programming?</p>\n<h3 id=\"what-are-we-solving-declarative-programming\" style=\"position:relative;\">What Are We Solving? (Declarative Programming)<a href=\"#what-are-we-solving-declarative-programming\" aria-label=\"what are we solving declarative programming permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Declarative programming, by contrast, feels more like telling the computer “I want to do this!” You delegate the tedious work to the computer and focus only on what needs to be done to solve the problem.</p>\n<p>Functional programming, then, is a paradigm that implements this declarative approach through functions. Let’s solve the same problem using declarative programming.</p>\n<blockquote>\n<p>Iterate through the array, filter out empty strings, and capitalize the first letter of each element.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> newArr2 <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">filter</code> method here iterates through the array and produces a new array containing only the elements for which the callback returns true. The <code class=\"language-text\">map</code> method iterates through the array and produces a new array using the callback’s return values.</p>\n<p>Here’s what I was thinking when I wrote this code:</p>\n<blockquote>\n<ol>\n<li>Declare a function that capitalizes only the first letter of a given string</li>\n<li>Filter <code class=\"language-text\">arr</code> to keep only elements whose length isn’t 0</li>\n<li>Iterate through the filtered array and use the function from step 1 to capitalize each element’s first letter</li>\n</ol>\n</blockquote>\n<p>We wrote code that performs the same task, but the flow of thought is noticeably different. Internally, it’s handled similarly to the imperative approach, but at least I no longer have to think about declaring and managing an index variable.</p>\n<p>And more importantly, my thought process now closely mirrors the problem itself:</p>\n<blockquote>\n<p>Iterate through the array, filter out empty strings (filter), and capitalize the first letter of each element (convert + map).</p>\n</blockquote>\n<p>Declarative programming focuses on letting the developer concentrate on the essence of the problem. And functional programming is simply the implementation of this declarative paradigm through functions.</p>\n<p>But delegating trivial control to the computer isn’t all upside. The classic trade-off here is the “performance” issue I mentioned when discussing abstraction.</p>\n<p>When I used imperative programming to perform these tasks, I did everything inside a single loop. But the declarative version has <code class=\"language-text\">filter</code> and <code class=\"language-text\">map</code> each iterating through the entire array, which can result in a performance penalty.</p>\n<p>Even though modern machines are powerful enough to handle this level of abstraction, if you had a billion elements to process, this kind of difference could have a significant impact on overall program performance. That’s why I said functional programming should be used judiciously, in the right situations.</p>\n<h2 id=\"programs-made-of-objects-vs-programs-made-of-functions\" style=\"position:relative;\">Programs Made of Objects vs. Programs Made of Functions<a href=\"#programs-made-of-objects-vs-programs-made-of-functions\" aria-label=\"programs made of objects vs programs made of functions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>So far, we’ve looked at the difference in thinking between imperative and declarative programming.</p>\n<p>As I mentioned, functional programming implements the declarative paradigm through collections of functions and their composition, so it’s frequently compared not just to imperative programming but also to object-oriented programming, which defines programs as collections of objects and their relationships.</p>\n<p>Just as I said when discussing imperative and declarative programming, there’s no hierarchy between OOP and functional programming. Each simply has different strengths and weaknesses.</p>\n<p>So what advantages does functional programming offer over object-oriented programming?</p>\n<p>There are many pros and cons, of course, but I personally believe the biggest advantage is that code reuse at the function level becomes much easier.</p>\n<h3 id=\"thinking-in-smaller-pieces\" style=\"position:relative;\">Thinking in Smaller Pieces<a href=\"#thinking-in-smaller-pieces\" aria-label=\"thinking in smaller pieces permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A developer accustomed to object-oriented programming will, upon hearing a set of requirements, immediately picture object blueprints in their head. They then define the relationships between these objects to lay the foundation for a large program.</p>\n<p>In OOP, an object — composed of member variables (state) and methods (behavior) — is the smallest unit of a program. When using OOP, we can’t design with anything smaller than an object.</p>\n<p>When we use OOP, we define an object’s state and behavior through a class — a kind of blueprint that serves as an abstraction of the object.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Queue<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> queue<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Internal state</span>\n\n  <span class=\"token comment\">// Queue behavior expressed as methods</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">dequeue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> head <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">.</span>length <span class=\"token operator\">=</span> length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> head<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> myQueue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyQueue<span class=\"token punctuation\">.</span><span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">Queue</code> class holds an internal array as its state and implements queue operations — adding and removing elements. The <code class=\"language-text\">private</code> access modifier prevents external code from directly accessing and modifying the internal <code class=\"language-text\">queue</code> array, bypassing the class’s methods.</p>\n<p>This works perfectly fine for everyday programming. But what if I now want to create a <code class=\"language-text\">Stack</code> class?</p>\n<p>Intuitively, it seems like I could reuse the <code class=\"language-text\">dequeue</code> operation as-is and just reverse the <code class=\"language-text\">enqueue</code> behavior to get a working stack. But the only way to take a method already implemented inside one class and use it in another class as if it were its own is through inheritance — and creating a Stack that inherits from Queue would start tangling the relationships between objects.</p>\n<p>In other words, because the smallest unit of abstraction and reuse in OOP is the “object,” it becomes difficult to break things down any further. But in functional programming, instead of focusing on objects representing queues or stacks, we focus solely on the operations these structures use to handle data.</p>\n<blockquote>\n<ol>\n<li>An operation that adds an element to the tail of an array (push)</li>\n<li>An operation that removes an element from the head and shifts the remaining elements forward (shift)</li>\n</ol>\n</blockquote>\n<p>Using JavaScript’s built-in methods <code class=\"language-text\">push</code> and <code class=\"language-text\">shift</code>, we can perfectly implement queue behavior without declaring any classes or objects, and without writing out queue operations imperatively as I did above.</p>\n<p>And if we want to additionally implement a stack, we can use <code class=\"language-text\">shift</code> to remove elements and <code class=\"language-text\">unshift</code> instead of <code class=\"language-text\">push</code> to add them.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> queue<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nqueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> head <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> stack<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nstack<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nstack<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This might seem obvious, but this is the fundamental advantage of composing programs from functions rather than objects. The scope over which you can reuse elements becomes much wider.</p>\n<p>However, when you reuse small functions across a wide scope, program complexity can grow quickly. To defend against this, functional programming imposes several constraints: functions shouldn’t modify values outside themselves, and a function given the same arguments should always return the same result.</p>\n<p>Functions with these constraints are called “pure functions.” When explaining pure functions, the description usually ends up as “functions with a few constraints” — but fundamentally, they’re nearly identical to the concept of functions in mathematics.</p>\n<p>Functions in computer science did originate from mathematical functions, but because the two disciplines have pursued different goals and evolved along different paths, the concept of “function” shares only the name — they’re actually quite different in practice. Pure functions, then, are about returning to the original essence of mathematical functions to reclaim simplicity.</p>\n<p>For that reason, I personally find it easier and faster to understand pure functions from a mathematical perspective rather than a programming perspective.</p>\n<p>Since the topic of this post is more about the advantages and characteristics of thinking in functions rather than functional programming itself, I’ll save the discussion of pure functions and immutability for a future post where I cover functional programming’s features and techniques in more detail. <em>(That topic is surprisingly fun, too.)</em></p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Until recently, I wasn’t deeply interested in functional programming. I thought imperative programming and object-oriented thinking were sufficient to design most applications.</p>\n<p>But that was simply because the first paradigms I learned in school were imperative and object-oriented programming — they were ingrained in my muscle memory. Being able to wield any paradigm freely means you’ve already internalized its way of thinking, so adopting a new design pattern or paradigm means breaking those existing mental models.</p>\n<p>Personally, I find changing the way you think far more difficult than learning techniques like currying, higher-order functions, or monads. To be honest, even now — after studying functional programming and opening my mind to it — when I hear a set of requirements, I still instinctively reach for imperative and object-oriented approaches first.</p>\n<p>But as I’ve said multiple times in this post, functional programming doesn’t replace object-oriented or imperative programming, nor is there any hierarchy among these paradigms. Each has its own strengths and weaknesses, and you simply pick the right one for the situation.</p>\n<p>Moreover, many libraries are still designed around object-oriented concepts, and their usage patterns involve creating objects with member variables and methods. Integrating these libraries with your program often makes it more convenient to design the overall architecture in an object-oriented style — and that’s a perfectly valid consideration.</p>\n<p>For example, Redux — a popular state management library in the JavaScript ecosystem — detects state changes based on pure functions and immutability. I’ve personally struggled quite a bit trying to manage <code class=\"language-text\">AudioNode</code> object states with Redux in a toy project using the Web Audio API.</p>\n<p>That said, the advantages functional programming brings — its high level of abstraction and finer-grained code reuse — clearly help when building complex programs. Ultimately, being good at functional programming isn’t just about deeply understanding the paradigm — it also means being able to judge which situations it’s best suited for.</p>\n<p>In the next post, I plan to cover essential functional programming concepts like pure functions, immutability, and lazy evaluation, along with various techniques used to reduce program complexity.</p>\n<p>This concludes my post: Functional Thinking — Breaking Free from Old Mental Models.</p>","fields":{"slug":"20191215-about-functional-thinkingen","path":"/2019/12/15/about-functional-thinking/en/","lang":"en"},"frontmatter":{"title":"Functional Thinking – Breaking Free from Old Mental Models","subTitle":"From imperative to declarative: how to shift the way you think about programming","date":"Dec 15, 2019","categories":["Programming","Architecture"],"tags":["Functional Programming","Functional Thinking","Imperative Programming","Object-Oriented Programming","Declarative Programming"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/9044dbb610cf83c50525198f5c9e28fb/d803c/thumbnail.png","srcSet":"/static/9044dbb610cf83c50525198f5c9e28fb/d803c/thumbnail.png 320w,\n/static/9044dbb610cf83c50525198f5c9e28fb/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/9044dbb610cf83c50525198f5c9e28fb/fc5c5/thumbnail.webp 320w,\n/static/9044dbb610cf83c50525198f5c9e28fb/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/9044dbb610cf83c50525198f5c9e28fb/01fb2/thumbnail.png","srcSet":"/static/9044dbb610cf83c50525198f5c9e28fb/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/9044dbb610cf83c50525198f5c9e28fb/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"fab189b7-7e6c-5c9e-b403-8ee13807fe24","tableOfContents":"<ul>\n<li>\n<p><a href=\"#congestion-window-cwnd\">Congestion Window (CWND)</a></p>\n<ul>\n<li><a href=\"#initializing-the-congestion-window-size\">Initializing the Congestion Window Size</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#congestion-avoidance-methods\">Congestion Avoidance Methods</a></p>\n<ul>\n<li><a href=\"#aimd\">AIMD</a></li>\n<li><a href=\"#slow-start\">Slow Start</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#congestion-control-policies\">Congestion Control Policies</a></p>\n<ul>\n<li><a href=\"#3-ack-duplicated-timeout\">3 ACK Duplicated, Timeout</a></li>\n<li><a href=\"#slow-start-threshold-ssthresh\">Slow Start Threshold (ssthresh)</a></li>\n<li><a href=\"#tcp-tahoe\">TCP Tahoe</a></li>\n<li><a href=\"#tcp-reno\">TCP Reno</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"Congestion control is exactly what it sounds like — detecting network congestion and controlling data transmission to resolve it. The network is such a vast black box that it’s hard to pinpoint exactly where or why transmission is slowing down. But each endpoint can at least detect “things are gett…","html":"<p>Congestion control is exactly what it sounds like — detecting network congestion and controlling data transmission to resolve it.</p>\n<p>The network is such a vast black box that it’s hard to pinpoint exactly where or why transmission is slowing down. But each endpoint can at least detect “things are getting slow.” If you send data and the response from the other party comes late or doesn’t come at all, something is clearly wrong.</p>\n<p>When using only the flow control and error control techniques discussed earlier, retransmission inevitably keeps happening.</p>\n<p>If just one or two hosts are doing this, it might not be a big deal. But since the network is a shared space used by all sorts of participants, once things start going wrong, everyone starts shouting “I’m retransmitting too!” — making the problem progressively worse. This is called congestion collapse.</p>\n<p>So when network congestion is detected, the sender forcibly reduces its data transmission volume by adjusting its window size, in order to avoid this worst-case scenario. This is congestion control.</p>\n<h2 id=\"congestion-window-cwnd\" style=\"position:relative;\">Congestion Window (CWND)<a href=\"#congestion-window-cwnd\" aria-label=\"congestion window cwnd permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In my post <a href=\"/2019/11/22/tcp-flow-control-error-control/\">TCP’s Flow Control and Error Control</a>, I mentioned that the sender’s window size is determined by considering both the receiver’s reported window size and the current network conditions.</p>\n<p>When determining its final window size, the sender uses the smaller of two values: the receiver window (RWND) — the window size reported by the receiver — and the congestion window (CWND) — the window size the sender determined based on network conditions.</p>\n<p>In other words, the window size that the congestion control techniques below increase and decrease is not the send window itself, but the sender’s “congestion window size.”</p>\n<p>Note that since both RWND and CWND have “window” in their names, you might think they’re the same as the window used in sliding window. But they’re just numbers representing the receiver’s window size and the congestion window size, respectively.</p>\n<p>So while the congestion window size can be flexibly adjusted based on network congestion during communication, how is it initialized before communication even starts?</p>\n<h3 id=\"initializing-the-congestion-window-size\" style=\"position:relative;\">Initializing the Congestion Window Size<a href=\"#initializing-the-congestion-window-size\" aria-label=\"initializing the congestion window size permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>During communication, information like lost ACKs or timeouts can be used to infer network congestion. But before communication begins, none of that information exists, making it tricky to set the congestion window size. This is where MSS (Maximum Segment Size) comes in.</p>\n<p>MSS represents the maximum amount of data that can be sent in a single segment, and can be roughly calculated as:</p>\n<blockquote>\n<p><strong>MSS</strong> = MTU - (IP header length + IP option length) - (TCP header length + TCP option length)</p>\n</blockquote>\n<p>MTU (Maximum Transmission Unit) represents the maximum unit that can be sent in a single transmission.</p>\n<p>In other words, MSS tells you how much space is left for actual data after stripping away all the non-data parts like IP and TCP headers from the maximum transmission unit.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5b899382aa98f56f7c00f116ac55322e/d4b10/mtu-setting.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 79.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABsUlEQVR42u2UTWvbQBCG/UsM/pZlrVa7UqwoFlFqJ/ZBliyToIZeGsgtl5IcShqb9tyfbFh4OyPZJZdS0XMPDzPD7j6aRcy2xuNxaLveq22LZ8uyXobDYSOsYafGotyy+Owru1qTyWQvog8IowujtYJSNb7vQ2td8T6v92gIdQHhx7AdCRIZxxEc963RaLSTroQQ4hBFkdlutybLMlMURRWz9dps8tzklDNFnpl0Uxo/35mg/GnsMDWuYx1c6YFdLNzzlz3PMwSklJwjSRLMb24QX17iaj7HgvKr+QL+2Rkkd6gDuJ6q9vJZvhW7KiEXJ2EFSYPpFJ9W13hYLfDt8TPeiC/3d3i63RA57vNHBPqcGnD/LlSEQ9IH38FTco79XY4fHwt8Lzf4mi3xkl7jeXWLRAVwPNmgw5OYpNqlDoSAOsJ1jaA9suGV3yGrqI54f6K5sCH/hf8g5AFw6W8fY3X2JNyxkBYOvNAEGlOae23CMDzFw5QGoRo9fhy4sG3bEGgCvSyYzWYoyxJxHCNNU7NcLusOu93ugJ6jYjAYpP1+f92UTqfzm3a7nfZ6vYJdvwDAltCnclfZvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mtu setting\" title=\"\" src=\"/static/5b899382aa98f56f7c00f116ac55322e/6af66/mtu-setting.png\" srcset=\"/static/5b899382aa98f56f7c00f116ac55322e/69538/mtu-setting.png 160w,\n/static/5b899382aa98f56f7c00f116ac55322e/72799/mtu-setting.png 320w,\n/static/5b899382aa98f56f7c00f116ac55322e/6af66/mtu-setting.png 640w,\n/static/5b899382aa98f56f7c00f116ac55322e/d9199/mtu-setting.png 960w,\n/static/5b899382aa98f56f7c00f116ac55322e/21b4d/mtu-setting.png 1280w,\n/static/5b899382aa98f56f7c00f116ac55322e/d4b10/mtu-setting.png 1394w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If you dig around in system preferences, you can find a setting to change the default MTU</small>\n</center>\n<p>On macOS, the default MTU is set to the Ethernet standard of <code class=\"language-text\">1500 bytes</code>. If the TCP and IP headers are each 20 bytes, then MSS is <code class=\"language-text\">1500 - 40 = 1460 bytes</code>.</p>\n<p>The sender initializes the congestion window size to <code class=\"language-text\">1 MSS</code> when first starting communication. From there, it increases or decreases the congestion window size based on network congestion as communication proceeds.</p>\n<h2 id=\"congestion-avoidance-methods\" style=\"position:relative;\">Congestion Avoidance Methods<a href=\"#congestion-avoidance-methods\" aria-label=\"congestion avoidance methods permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP, the grandpa protocol, has accumulated a diverse set of congestion control policies over the past 50 years.</p>\n<p>Each policy has evolved by improving how to identify congestion and how to increase or decrease the congestion window size. But the most fundamental congestion control approach combines two avoidance methods — AIMD and Slow Start — as the situation demands.</p>\n<p>So in this post, I’ll first explain AIMD and Slow Start, then discuss the representative congestion control policies Tahoe and Reno.</p>\n<h3 id=\"aimd\" style=\"position:relative;\">AIMD<a href=\"#aimd\" aria-label=\"aimd permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>AIMD (Additive Increase / Multiplicative Decrease) means exactly what it says. When the network seems fine and you want to speed up transmission, you increase the congestion window size by 1. But when congestion is detected — data loss, missing responses — you cut the congestion window size in half.</p>\n<p>Increase: <code class=\"language-text\">ws + 1</code>. Decrease: <code class=\"language-text\">ws * 0.5</code>. Literally additive increase, multiplicative decrease. Because of this characteristic — linear growth and sharp halving — graphing the congestion window size of a connection using AIMD produces a sawtooth pattern.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 571px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFElEQVR42oVRi26DMAzk/3+xUmkF0rpAV5oEJ3ZiZw70RTdtkWXsC3ecjkamqYjgPAdrS0qF6P9CLHratikxWueGYcAVKkXK+5G3QZZn1zV0vSJRAFjJshT/FNiI3cn9bjcDpJRijOvVnGVEfv3UGQVyHcOq+iCPXaeejTEnX8k+i0+i3S5dEZfkQkxcVxMrLyS+kU/7vdoWEeOCy/VVxUeUz8iqomtkQa5e5kXxmoQyP22P57OdLh8u2lQeztXhgMqsK/LNxRdW/GnbHA7W+9l7iPgWbJbfM3+S2Xsdcs6PwP7+WxuyAKxkH0JUCY39XoHIAWh/BSuOCMyl75viXNEpJdmW6hFA17ao6jlvbolqFMfjN/U+hHTP2SsOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"aimd\" title=\"\" src=\"/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png\" srcset=\"/static/1f8521aeeab86f9056a053a93f69adb1/69538/aimd.png 160w,\n/static/1f8521aeeab86f9056a053a93f69adb1/72799/aimd.png 320w,\n/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png 571w\" sizes=\"(max-width: 571px) 100vw, 571px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Gradual increase, sharp decrease</small>\n</center>\n<p>This approach is remarkably simple, yet surprisingly fair. Imagine several hosts are already occupying the network when a latecomer joins.</p>\n<p>Naturally, the latecomer starts with a smaller congestion window and is at a disadvantage. But when congestion hits, the host with the larger window is more likely to lose data from trying to push too much through. That host then reduces its window size to resolve the congestion, freeing up bandwidth for the latecomers to grow their windows.</p>\n<p>Over time, regardless of when each host joined the network, all hosts’ window sizes converge to an equilibrium.</p>\n<p>However, AIMD’s weakness is that even when bandwidth is plentiful, it increases the window size too slowly. It takes time to reach full network utilization.</p>\n<h4 id=\"window-sizes-really-converge\" style=\"position:relative;\">Window Sizes Really Converge?<a href=\"#window-sizes-really-converge\" aria-label=\"window sizes really converge permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>AIMD is simple enough that you can simulate the network behavior with a basic example. Doing so lets you actually see what “window sizes converging to equilibrium” means.</p>\n<p>I was going to include the code in this post, but trying to simulate something close to real network conditions made it longer than expected, so I’ll just share the results. Here’s my experimental setup:</p>\n<blockquote>\n<ol>\n<li>Maximum network congestion is <code class=\"language-text\">50</code>, determined by the sum of all hosts’ congestion window sizes.</li>\n<li>A new host is added to the network every <code class=\"language-text\">300ms</code>.</li>\n<li>Each host calculates current network congestion every <code class=\"language-text\">100-200ms</code> and adjusts its window size.</li>\n<li>Each host performs 300 window size adjustments before leaving the network.</li>\n</ol>\n</blockquote>\n<p>A small caveat: I used <code class=\"language-text\">setInterval</code> for concurrency, but since <code class=\"language-text\">setInterval</code> callbacks go through the event loop and execute on the call stack, true parallelism isn’t guaranteed like in a real network. But this doesn’t affect the test’s purpose — verifying that latecomers can achieve adequate congestion window sizes.</p>\n<p>For more on this concept, check out my post <a href=\"/2019/08/01/nodejs-event-loop-workflow/\">A Low-Level Look at the Node.js Event Loop</a>.</p>\n<p>Here’s the time-series visualization of the test data. First, let’s look at each host’s congestion window size changes:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/019ed4a2768805580d59e27bb7099b7a/42267/cwnd-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwElEQVR42q2PC27EIAxEuf8lGyUbIKRhtyp/Q2Yn6RG2lkbPRuMPylqLGCOuOM8Tn4YSEfxbjBNqjPHxdec9i3OkQ5WSIU2oDpHGwQODm6R3tCHMBa1X1o2efHtqqehkbxUxBJRLKdw+Zc0DevmCNQs5YdMP7FbDmRVW803P5AyzLuQEw1zPE9w6Y2ePf37fSikjlAR1bSulIOeEWiuZ8fMb8Do2+MPBbzv5ZO3JF7x3cP5AiH9+aQ2Zv6zt6i14AwNI1E8L97aCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cwnd chart\" title=\"\" src=\"/static/019ed4a2768805580d59e27bb7099b7a/6af66/cwnd-chart.png\" srcset=\"/static/019ed4a2768805580d59e27bb7099b7a/69538/cwnd-chart.png 160w,\n/static/019ed4a2768805580d59e27bb7099b7a/72799/cwnd-chart.png 320w,\n/static/019ed4a2768805580d59e27bb7099b7a/6af66/cwnd-chart.png 640w,\n/static/019ed4a2768805580d59e27bb7099b7a/d9199/cwnd-chart.png 960w,\n/static/019ed4a2768805580d59e27bb7099b7a/21b4d/cwnd-chart.png 1280w,\n/static/019ed4a2768805580d59e27bb7099b7a/42267/cwnd-chart.png 2670w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The graph shows that early arrivals and latecomers don’t have dramatically different congestion window sizes. The lone spike at the end is from the last host having the network all to itself after everyone else left.</p>\n<p>This visualization confirms that each host’s congestion window size converges to roughly the same range. What about the total window size of all hosts in the network?</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/1192d/total-cwnd-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLUlEQVR42p2Qy3KjMBBF+f9/SxYm2OIlAQI9MA8Bg+MpV3JGk+Usp6vOpvv2qa5OnHWEEOD7m/+qf/aSM9w5TMfsNfPYck6Oc/bss+WxTjy2Kc5atr/9yfK53HmOltd58PXr5HfT8YpHvab5h0T3NXn2TpWlCCkQuqHsFaK7cpEZuUjJ8pSyEBTygiw/EJFS3TDVhSF/RxdvTDHzTK8kk8qZpGZRI1vZcHSOpb0zSEMrO7y44a6Ce11jqwot2yhqcXqgUJI8HnCzksJdWUVGImKwURWqiUT50Hzg2iIKFabJaLqM1tzoBoEtUroyo68UoS4ZlaIeN3y/YgeHVClJOB5sx8G6B8Kx/+CXBeM0xg+YGLR+xjpPH39lxh7tLcsaOPaNz/3kuUWiJ+wrfwA1Vr7W2+QK4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"total cwnd chart\" title=\"\" src=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/6af66/total-cwnd-chart.png\" srcset=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/69538/total-cwnd-chart.png 160w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/72799/total-cwnd-chart.png 320w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/6af66/total-cwnd-chart.png 640w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/d9199/total-cwnd-chart.png 960w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/21b4d/total-cwnd-chart.png 1280w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/1192d/total-cwnd-chart.png 2662w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The total congestion window sizes across all hosts clearly stay below the congestion threshold of <code class=\"language-text\">50</code> I set, with hosts jockeying back and forth to adjust their window sizes.</p>\n<p>Excluding the early and late phases when hosts are joining and leaving, the middle portion shows that individual congestion window sizes don’t vary significantly.</p>\n<p>Running this simulation and seeing the data made the abstract concept of “window sizes converging to equilibrium” much more tangible.</p>\n<p>If you’d like to run the code yourself and observe the entire process, you can clone it from my <a href=\"https://github.com/evan-moon/tcp-congestion-test\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>.</p>\n<h3 id=\"slow-start\" style=\"position:relative;\">Slow Start<a href=\"#slow-start\" aria-label=\"slow start permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, AIMD increases window size linearly, so it takes a while to reach proper speed.</p>\n<p>These days, with generous network bandwidth and excellent infrastructure, congestion occurs far less frequently than before. This has made AIMD’s drawback — taking too long to reach full speed even when no congestion exists — increasingly prominent.</p>\n<p>Slow Start shares the same basic principle as AIMD, but increases the window size exponentially. When congestion is detected, it drops the window size to <code class=\"language-text\">1</code>.</p>\n<p>This approach increases window size each time an ACK arrives, so it may start slowly, but the window grows progressively faster over time.</p>\n<p>Since the only difference from AIMD is how the window size increases and decreases, adjusting the window-sizing logic in the earlier example produces a Slow Start chart:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/88ad13152143dd8acea98a68b149d91e/963fa/slow-start-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVR42lWRi27DIAxF+///uE1qt5BACoSEBMLjzM20SUNcXWzZx5a4aa3x3lHLCb3L/dHr/Hrr7Z/31mmt/dVUiXutl27btpFSoJ6RnjOlV0orV3E5s3RArlmsX37l08lxHAJr5FwJqZD9ShHdjnQQD097AY+dVE9ySxco7dJUMnuKAknEUwbXfgFfizTZKO6FReLsN8oiwBhXpvGNyXyyzhPKGmyYWZcNqw1BK+xz5qnu3Md3zKAIUjd8Kpy8H4Pmy1jMx4M4W25JVvfeYkVhDSxhwYeA1iPmqdFKYQSsJ8WoRskPMlzjnCc4J25x8gfWOpYl8A3H6YItahN4cgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow start chart\" title=\"\" src=\"/static/88ad13152143dd8acea98a68b149d91e/6af66/slow-start-chart.png\" srcset=\"/static/88ad13152143dd8acea98a68b149d91e/69538/slow-start-chart.png 160w,\n/static/88ad13152143dd8acea98a68b149d91e/72799/slow-start-chart.png 320w,\n/static/88ad13152143dd8acea98a68b149d91e/6af66/slow-start-chart.png 640w,\n/static/88ad13152143dd8acea98a68b149d91e/d9199/slow-start-chart.png 960w,\n/static/88ad13152143dd8acea98a68b149d91e/21b4d/slow-start-chart.png 1280w,\n/static/88ad13152143dd8acea98a68b149d91e/963fa/slow-start-chart.png 2666w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>You’ll notice cases where hosts’ congestion windows exceed the maximum congestion threshold of <code class=\"language-text\">50</code> I set. This is an artifact of how JavaScript processes <code class=\"language-text\">setInterval</code> callbacks and wouldn’t happen in a real network. (The congestion calculation is also far more complex in reality.)</p>\n<p>The biggest difference between the AIMD and Slow Start graphs is the time to reach peak network congestion.</p>\n<p>AIMD grows window size linearly, so it can’t claim much bandwidth when new hosts join. Slow Start grows slowly at first but then ramps up exponentially when there’s still headroom, ultimately growing the window size faster than AIMD.</p>\n<p>Modern TCP policies like Tahoe and Reno blend AIMD and Slow Start, differing primarily in how they respond when congestion occurs.</p>\n<h2 id=\"congestion-control-policies\" style=\"position:relative;\">Congestion Control Policies<a href=\"#congestion-control-policies\" aria-label=\"congestion control policies permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP has a dizzying array of congestion control policies — Tahoe, Reno, New Reno, CUBIC, and even the recent Elastic-TCP, to name just a few.</p>\n<p>These policies all share the premise that when congestion occurs, you reduce (or stop increasing) the window size to avoid it. Newer methods detect congestion more intelligently and utilize network bandwidth more quickly and safely.</p>\n<p>Covering all of them here would be impractical, so I’ll focus on the most representative and well-known policies — Tahoe and Reno — to explain the fundamentals of congestion control.</p>\n<p>Both Tahoe and Reno start with Slow Start, then switch to AIMD when the network feels congested.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8ee0d539b474748716d8e1199b313356/1ac29/taheo_reno.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTUlEQVR42jWR2W7cMAxF/f+/0y8IigB9aoAm89RinIkXWV4lUQu1l/a050UUyQuKV42/SClFIl3EmFMqpeRc2G7bSd4nYTE8W2I8g5wzRU0IgcRn50VMOZUK2nDOJz6//Ly9vN1+3DpwodZycR61VmpuhBDGmKcy5PL66/Ht+/vrR6+0WI/BovRJk4zmLPM8jmM3PCxSptITm/u9lVJRzVqLQsiB8aE9YMGgaUJyqJbRewQFSstDcbGOARRqbYxt2rYFpRQAa1u9rrXUADJEF0OEiblt1+vk0Gz7ssxfou/stjtjNBwAuiGhQ0zOeSlzrWSap4zW7M/v/vPT+eD0Ifd5490x9HxkI2Nkx3PNJuWMAG5bYwhkMl291noYOGNCStrNGnns3eNx/+r68t804p/baIxHxOvP8MIAhBjdCRWNc/YQgta2F5Q9N1XqL8UGx+8sa/crAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"taheo reno\" title=\"\" src=\"/static/8ee0d539b474748716d8e1199b313356/6af66/taheo_reno.png\" srcset=\"/static/8ee0d539b474748716d8e1199b313356/69538/taheo_reno.png 160w,\n/static/8ee0d539b474748716d8e1199b313356/72799/taheo_reno.png 320w,\n/static/8ee0d539b474748716d8e1199b313356/6af66/taheo_reno.png 640w,\n/static/8ee0d539b474748716d8e1199b313356/d9199/taheo_reno.png 960w,\n/static/8ee0d539b474748716d8e1199b313356/1ac29/taheo_reno.png 1022w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Red represents Tahoe, green represents Reno's window size</small>\n</center>\n<p>The Y-axis shows the congestion window and the X-axis shows time. Before diving into Tahoe and Reno, let me quickly cover a few terms to help you understand what this graph is showing.</p>\n<p>Let’s look at the “3 ACK Duplicated” and “Timeout” labels where the graph bends, and the “Threshold” where the growth rate changes. (The spelling in the diagram looks off because it’s Italian, not English — don’t worry about it.)</p>\n<h3 id=\"3-ack-duplicated-timeout\" style=\"position:relative;\">3 ACK Duplicated, Timeout<a href=\"#3-ack-duplicated-timeout\" aria-label=\"3 ack duplicated timeout permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Both methods reduce the window size when two scenarios occur: 3 ACK Duplicated and Timeout. These are the fundamental situations that congestion control policies use to detect congestion.</p>\n<p>Timeout means the sender’s data was lost or the receiver’s ACK was lost due to various factors.</p>\n<p>3 ACK Duplicated — receiving the same acknowledgment number three or more times — is also abnormal. Since the receiver only sends ACKs for data it successfully processed, receiving the same acknowledgment number three times suggests the receiver couldn’t properly process data after a certain sequence number.</p>\n<p>However, since TCP uses packet-based transmission where arrival order isn’t guaranteed, one or two duplicate acknowledgment numbers don’t immediately indicate congestion.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/41dd4882153e87b8f1db9ae7f6353451/813c1/fast-transmit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.12499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42o1T223CQBAcx287NsGghIBBSWpASgtpIQ3wTy9UQXNpIXt4VlkdtnMrjVl79+ZmHwBAhMEWgqPgA+Omee+CT8EbAuxZ8Ch4ECQTOS7WmAtm7UlQCmpBQb8geWyU1iFkOAPdF9CegAoD3MGcqgtz2ZJ+Mkv4DawvcvhHlF7/SlfilhW07N+eF81a7/ooj7IbDqqyVJDRd/17EaxCSneJa6pQwoa/NUkTxhIi5/fYnxyYWNDX5NIQuriIx5YbsaG/YezOdAixUaDEOii3rwcS9eznjvvrqrkp0jV5ZeMjEqVmZSx0YLEXv1Xamdu2fG/MMMb+MWF76O1WZtRXfE9JWP1HFI0Q+vGcaNizIMv98U+QTyr8BdWrC5EqySd2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"fast transmit\" title=\"\" src=\"/static/41dd4882153e87b8f1db9ae7f6353451/6af66/fast-transmit.png\" srcset=\"/static/41dd4882153e87b8f1db9ae7f6353451/69538/fast-transmit.png 160w,\n/static/41dd4882153e87b8f1db9ae7f6353451/72799/fast-transmit.png 320w,\n/static/41dd4882153e87b8f1db9ae7f6353451/6af66/fast-transmit.png 640w,\n/static/41dd4882153e87b8f1db9ae7f6353451/d9199/fast-transmit.png 960w,\n/static/41dd4882153e87b8f1db9ae7f6353451/21b4d/fast-transmit.png 1280w,\n/static/41dd4882153e87b8f1db9ae7f6353451/813c1/fast-transmit.png 2004w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>TCP uses cumulative acknowledgment — it sends the acknowledgment number for the last correctly received data in sequence. So if the sender keeps receiving the same acknowledgment number, it knows that data up to that point was transmitted successfully, but something went wrong after that.</p>\n<p>When 3 duplicate ACKs trigger immediate retransmission of the corresponding data, the receiver then uses its error control method (Go Back N or Selective Repeat) to tell the sender which packets to send next.</p>\n<p>In this situation, the sender can retransmit the packet immediately without waiting for its timeout — a technique called <a href=\"https://www.isi.edu/websites/nsnam/DIRECTED_RESEARCH/DR_HYUNAH/D-Research/fast-retransmit.html\" target=\"_blank\" rel=\"nofollow\">Fast Retransmit</a>.</p>\n<p>Without Fast Retransmit, the sender would have to wait until its timeout expires before responding, wasting time before retransmitting the errored data.</p>\n<h3 id=\"slow-start-threshold-ssthresh\" style=\"position:relative;\">Slow Start Threshold (ssthresh)<a href=\"#slow-start-threshold-ssthresh\" aria-label=\"slow start threshold ssthresh permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Looking at the Tahoe vs. Reno graph, you’ll notice the word “Threshold” appearing frequently. This refers to the Slow Start Threshold (ssthresh), meaning “I’ll only use Slow Start up to this point.”</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 539px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFUlEQVR42pWSSW6FQAxEuf/N2HABJMQkJiEQ8/zJC/VFfkhvUouW2+6yXW1b53nWde37fhRF4zie/4HV932WZWVZ7vt+HMf+G/Ks64phIA/DUBRF0zT7H2zbNs/zeAG+gTxNUxAESZJsH4ApGsbrAk4DmZR03rYtLz4DMJdlkW0k47RkUedBRg5ljWT1RVUrDMM4jpHNRToV67oOj64YqLsNOtL/fX8YHfKUu+TxgrDEy0NIEjjJ+6P5Vnh/r97pw2+ypkXoU50lSYyqvUAW8dXRdAGDEP7HLN+VqSnN92IoxXFBHUmOQMaqqt5klUI5q4pXw8vzvLigLXgMMk1T6x4GJ0vK53ueh6GddxzHtm3XdY27/QXAbvf3UeGvvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ssthresh\" title=\"\" src=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png\" srcset=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/69538/ssthresh.png 160w,\n/static/4dd1f6d8c7b9d31ff90f21619da03947/72799/ssthresh.png 320w,\n/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png 539w\" sizes=\"(max-width: 539px) 100vw, 539px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The reason for this threshold is that exponentially increasing window size with Slow Start eventually leads to uncontrollable growth. When congestion seems imminent, it’s much safer to increase cautiously and incrementally rather than aggressively.</p>\n<p>Think of it simply: if the current window size is <code class=\"language-text\">10</code> and the remaining network capacity is <code class=\"language-text\">15</code>, Slow Start would blow past <code class=\"language-text\">20</code>, but additive increase gives you about 5 more rounds of safe growth.</p>\n<p>So a threshold is set, and once exceeded, AIMD’s linear increase is used instead. That’s why it’s called the Slow Start Threshold.</p>\n<p>The sender initializes ssthresh to half its congestion window — <code class=\"language-text\">0.5 MSS</code> — before communication begins, then responds differently depending on which congestion control method is being used.</p>\n<h3 id=\"tcp-tahoe\" style=\"position:relative;\">TCP Tahoe<a href=\"#tcp-tahoe\" aria-label=\"tcp tahoe permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP Tahoe is an early congestion control policy using Slow Start, and the first to introduce the Fast Retransmit technique. Policies developed after Tahoe use Fast Retransmit as a baseline, adding refinements for efficiency.</p>\n<p>Fun fact: TCP Tahoe is named after Lake Tahoe in Nevada. So it’s pronounced “Tah-ho.” (Not “Tah-ho-ay”!)</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/672252932977a8df688679a0e462d3c2/01ab0/lake_tahoe.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABds1gbSUt/8QAGhABAQACAwAAAAAAAAAAAAAAAQIAAwQRIf/aAAgBAQABBQKd9mOyXHkyM0invQZ//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AbGP/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEDERP/2gAIAQIBAT8BUlGjP//EABoQAAICAwAAAAAAAAAAAAAAAAAREDEhMqH/2gAIAQEABj8CpmWzXpc//8QAGBABAQEBAQAAAAAAAAAAAAAAAQARIXH/2gAIAQEAAT8h4i4gJ9EkBucKiJWxoAwv/9oADAMBAAIAAwAAABCIH//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxClZf/EABcRAQADAAAAAAAAAAAAAAAAAAABEUH/2gAIAQIBAT8Q0puf/8QAGhABAQADAQEAAAAAAAAAAAAAAREAITGRgf/aAAgBAQABPxDQakEYn2byleO1e5XKjFlvmIg5Ig9Mhy8zWEPDP//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"lake tahoe\" title=\"\" src=\"/static/672252932977a8df688679a0e462d3c2/c08c5/lake_tahoe.jpg\" srcset=\"/static/672252932977a8df688679a0e462d3c2/0913d/lake_tahoe.jpg 160w,\n/static/672252932977a8df688679a0e462d3c2/cb69c/lake_tahoe.jpg 320w,\n/static/672252932977a8df688679a0e462d3c2/c08c5/lake_tahoe.jpg 640w,\n/static/672252932977a8df688679a0e462d3c2/6a068/lake_tahoe.jpg 960w,\n/static/672252932977a8df688679a0e462d3c2/eea4a/lake_tahoe.jpg 1280w,\n/static/672252932977a8df688679a0e462d3c2/01ab0/lake_tahoe.jpg 1300w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>I'm not sure why they named it after this lake, but it is beautiful</small>\n</center>\n<p>Tahoe starts with Slow Start, exponentially increasing its window size until hitting the Slow Start Threshold, then switches to AIMD’s additive increase for linear growth.</p>\n<p>When 3 ACK Duplicated or Timeout occurs, it determines that congestion has happened and modifies both the Slow Start Threshold and its window size. Let’s look at Tahoe’s congestion window graph for a clearer picture:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/ccf0c/tahoe-ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACf0lEQVR42mNgYGBgB2JWIGb4//8/Iwgz4AAweXwYpE5IREREEshhrq+vZwNilpvLl9teXb0y7Nrq5UHX168Jvr5iafCN1cv91/f3C4SuWgVTxzZz5kxWdDbIQG4gEAOZDjIMJHB37Zq1F5Yv/XF1xfIn55Ysen184fwPV1ateHJ//nwFkDxQHRMIh4aGMq8CYaAloVAaJC/BxcUlATMwLS2NdX98PcexR8c45zTWWh7zdLWe+f8/64mJE/kubVkq+P/YMaH/u3cL71y0iBtqMAsyBhkoIyoqKrF//36QABvIlvj18wUSVs3TTVs6U6Nw3mRdkKLz69cLPNy04fKpJYuenFu25NvLbVuaQOLz58/ngAUVzMsy4uLiYmABBgYmVQsLM7/qEpesKVN4coGuyly9QA+kCOhdjpcH97lfbWlovDtrevLNzZv1gcJMIAcUL+rmzp07V7Te3h7sQnk+Pj4hECMNGLDxs3uMXWNiuIFcFvv4eIGY6b36wsLCvIJSgrIiNXmqSY0lloW99UKwmM9et1A4e/Uck4y1i8RgYlIgL4NiGeSijNULDf8zMDDWr1rFBgrobKDX4+vrOcwiAp0svV11EidOFI1uazQF6hMMqK0wzloyy6B+5kwuUOTAvMwrIiciCWKkz5+ukLlwtibIQJAhYBesWGyUtXqBdvnu9br/gd4r2rRUJHZGv6VJsI+nXUK06f96BibkpAPSw8nDwyNSvWO9bPbaeUYzz5xhBbqWCZYE8jYuE89ZM1+jHhiG4JQAdHnOzlWKnQ/PSoH4oHS5CpI24Xp45GxMlDxrynUFlZT4QXwgBtF8UJoLiEFe4YXyQTQnFMPUwTAvAI+yOQfWAhMfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tahoe ssthresh\" title=\"\" src=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/6af66/tahoe-ssthresh.png\" srcset=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/69538/tahoe-ssthresh.png 160w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/72799/tahoe-ssthresh.png 320w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/6af66/tahoe-ssthresh.png 640w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/d9199/tahoe-ssthresh.png 960w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/21b4d/tahoe-ssthresh.png 1280w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/ccf0c/tahoe-ssthresh.png 1428w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The teal line shows the sender’s congestion window size, and the bold black line shows ssthresh. In this scenario, the initial congestion window is <code class=\"language-text\">8</code>, so ssthresh is set to <code class=\"language-text\">8 * 0.5 = 4</code>.</p>\n<p>The sender exponentially increases its window size using Slow Start until hitting ssthresh, then switches to linear increase. What happens when congestion (3 ACK Duplicated or Timeout) occurs?</p>\n<p>At the first congestion event, the congestion window is <code class=\"language-text\">6</code>. The sender sets ssthresh to half of that — <code class=\"language-text\">3</code> — and resets its congestion window to <code class=\"language-text\">1</code>. Then it starts Slow Start again, switching to additive increase upon reaching the threshold. Rinse and repeat.</p>\n<p>In essence, it remembers where it got hit last time and starts being cautious as it approaches that point. A reasonable approach.</p>\n<p>But there’s no silver bullet. Tahoe’s weakness is that the initial Slow Start phase takes too long to grow the window. While exponential growth is faster than additive growth overall, resetting the window to <code class=\"language-text\">1</code> after every congestion event is arguably wasteful.</p>\n<p>This led to TCP Reno, which uses the Fast Recovery approach.</p>\n<h3 id=\"tcp-reno\" style=\"position:relative;\">TCP Reno<a href=\"#tcp-reno\" aria-label=\"tcp reno permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP Reno was developed after Tahoe. Like Tahoe, it starts with Slow Start and switches to additive increase after the threshold.</p>\n<p>But Reno has a clear difference: it distinguishes between 3 ACK Duplicated and Timeout. When 3 duplicate ACKs occur, Reno doesn’t drop the window to 1 — it halves it (like AIMD) and sets ssthresh to the reduced window value.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/ccf0c/reno-ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVR42mNgYGBgB2JWIGb4//8/Iwgz4AAweXwYpE5IREREEshhrq+vZwNilpvLl9teXb0y7Nrq5UHX168Ivr5iafCN1cv9N3R28oJNDg1ltgeqmzlzJisIg/TBaJA0NxCIgUwHGQYSuLt2zdoLy5f+uLpi+ZNzSxa9PrFowfsrK1c8uzFnjvPLVatU3q1fr3tp9mxxoFLGVatWMYMwSC+IBumX4OLikoAZmJaWxro/vp7j2KNjnHMaay2P+3jYAP3KdH3ZHKnnO7bfurR2zavL69f8f7V7eztI87Zt29hB+v7X1zPBHCQjKioqsX//fhaQk0G2xK+fLxC3bLZe4tyJWpkLJuiBFM00Blq0Zb3BvoyU7DOlpbbXtq+VtLe3BxtUOHu2UO7iWTJwA8XFxcVAnHoGBiZVCwsz7+oSl6Q5c3hnnpnJmr1+ie78/fs5yrevVwjYtk65ZMksg4pp7YIgjatA4b5/m0zB6oUmIENDgWELEpfn4+MTAjHSgAEbP7vH2DUmhtvY2BgU8yLuxdkOgS1V3nZpCbpAPr95fLiCR3GmKZDN61FdZOOSm2IhaSzJBdIPdBQTiJYCeRkUy7kTJ/JlrF5o+B8Y2DPPnGFVUVHh4xPlU+YVEVEFqpMDYkVlCwsj41AfGx13Z0s9UPgCfaimpiZSDwqy0FBwLPOKyIlIghjp86crZC6crQkyMDc3lx0cQUCFIAy0kAUccTtWCZXtWWdWvnu97kRghIAcAkoyILWwZMPJw8MjUr1jvWz22nlGIJcBFTFBkwKYBoUNCIP4II3pS+epAoOHH2QxSBxZLchAHjkbEyXPmnJdQSUlfhAfFFZAzIcHc0DVoYvzAgAyVDLF8aGvfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"reno ssthresh\" title=\"\" src=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/6af66/reno-ssthresh.png\" srcset=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/69538/reno-ssthresh.png 160w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/72799/reno-ssthresh.png 320w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/6af66/reno-ssthresh.png 640w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/d9199/reno-ssthresh.png 960w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/21b4d/reno-ssthresh.png 1280w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/ccf0c/reno-ssthresh.png 1428w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The graph above uses the same notation — teal for the congestion window, bold black for ssthresh.</p>\n<p>Unlike Tahoe, when 3 duplicate ACKs occur, Reno halves the congestion window and proceeds with additive increase from there. Since this avoids resetting to 1 and starting from scratch like Tahoe, it reaches the previous window size much faster — hence the name Fast Recovery.</p>\n<p>The ssthresh is set equal to the reduced window size. In the graph, when congestion occurs, the window drops from <code class=\"language-text\">6</code> to <code class=\"language-text\">3</code>, and ssthresh is also set to <code class=\"language-text\">3</code>.</p>\n<p>However, if data is lost due to a timeout, Reno drops the window to 1 just like Tahoe and proceeds with Slow Start — without changing ssthresh.</p>\n<p>In other words, it differentiates between duplicate ACKs and timeouts, responding differently to each. By assuming duplicate ACKs indicate less severe congestion than timeouts and not dropping the window to <code class=\"language-text\">1</code>, Reno effectively weighs the severity of congestion situations.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This post covered TCP’s congestion control policies. Honestly, Tahoe and Reno are somewhat dated — they’re not widely used in modern networks.</p>\n<p>Being designed for the network conditions of their era, they don’t quite fit today’s high-bandwidth networks.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACbklEQVR42oWSzW7TQBCA3QYhWiEhcWlTiVDuPAHPkEsRUg/QoB7KAcRrIPomNBbqAZWUQzGKFFFU4kaImJBfx47b+i+xE+en9nqH2bhGKRQx0mhmZzXfzswOl81mExyKKIoPOpqzpyjaTq32k6/X63ytVuNt2+Ydx/lLbdvhTdPhXdfhe73eG9d1c7IsP+YEQbiGvJv5fH4TUNyeSxRVgU6nA4qigO/7MCuURtbzAAwj8sMwDJg1DGObS6fTiwhMFIvFJywYBP5kNBoFk8kk8DwvYMLCsYZhZLtdCFqtyCcExiwXu3nFLS0trSLweqlU2oheoySu4iqJ72wboFq9XKFlWa+5ZDKZQuAizjATA1Evkuk/gaxdVb0CuLy8fHe2QkIomTb5nwoZUJIA+v0pcppxcoLAlZWVOwxYLEbAXo+Sw8PLyczGijMETQNwHIBKBUCWIyC7UxQE4gzvIXAhBppGSI6OosRZUAxnIFGM/DF+ha6zjwzZZ+EdAlOpVBKB88fH36a/bJqEWFYIPyQKdDpLCq5LwdApWCbFdaIwGkZx9kpbpqB1SBA9hkC0bLETX0TxKQvq6rlPKJAzHUhThnA0BlKpAvkuAanWgJg2hGzUiCPMnhlA2iqc/16bCyAntpsZ6Bjgfm0Q6Dtw3h2ALnlglIcwUF3sCzfZHwKMBlgKngcDNnDs24NwPIgW27K2GXCOAXO53OrpqbF+sPduq1QobDTL5fX8x93nk7629unD+2eFA2HzTNHWdrPZlyeNxqPPgrAp7O9v6S314dsd/kVTkjJ1SbrPXSFzM/78jL/A9vWPeyY3UG+j3mLb8gt3bCsK4xoUeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cubic vs tahoe\" title=\"\" src=\"/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png\" srcset=\"/static/dec2a168ed319557e87c6c34fa3afc85/69538/cubic_vs_tahoe.png 160w,\n/static/dec2a168ed319557e87c6c34fa3afc85/72799/cubic_vs_tahoe.png 320w,\n/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png 398w\" sizes=\"(max-width: 398px) 100vw, 398px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The efficiency gap between Tahoe and CUBIC at high bandwidth is staggering</small>\n</center>\n<p>Compared to when Tahoe and Reno were developed, today’s network bandwidth is probably at least 1,000 times more generous.</p>\n<p>This means the probability of problems when a sender aggressively grows its congestion window is much lower than before. So modern congestion control policies focus on how to grow the congestion window faster and how to detect congestion more intelligently.</p>\n<center>\n  <img src=\"/2eb82cf5c7758194f2ec3b424cd04b32/cubic_function.gif\" width=\"100%\">\n  <small>\n    TCP CUBIC, which leverages cubic function properties, barely increases window size while avoiding congestion, then explosively ramps up once congestion clears\n  </small>\n  <br>\n  <br>\n</center>\n<p>The reason I introduced the older Tahoe and Reno is that as early TCP congestion control methods, their principles are straightforward, and later methods don’t fundamentally deviate from the same mechanisms.</p>\n<p>This post aimed to understand how the congestion control mechanism works as a whole, not to catalog every policy. So I intentionally left out other congestion control approaches.</p>\n<p>If you’re curious about modern congestion control policies, check out these links:</p>\n<blockquote>\n<ul>\n<li><a href=\"http://squidarth.com/rc/programming/networking/2018/08/01/congestion-cubic.html\" target=\"_blank\" rel=\"nofollow\">CUBIC</a></li>\n<li><a href=\"http://squidarth.com/rc/programming/networking/2018/08/01/congestion-red.html\" target=\"_blank\" rel=\"nofollow\">RED</a></li>\n<li><a href=\"https://ieeexplore.ieee.org/document/8642512\" target=\"_blank\" rel=\"nofollow\">Elastic TCP</a></li>\n</ul>\n</blockquote>\n<p>That concludes this post on sharing the network nicely with TCP’s congestion control.</p>","fields":{"slug":"20191126-tcp-congestion-controlen","path":"/2019/11/26/tcp-congestion-control/en/","lang":"en"},"frontmatter":{"title":"Sharing the Network Nicely: TCP's Congestion Control","subTitle":"How TCP adjusts window sizes to keep the network in harmony","date":"Nov 26, 2019","categories":["Programming","Network"],"tags":["TCP","Congestion Control","AIMD","Slow Start","CWND","TCP Tahoe","TCP Reno"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/45252c4560c0c973b1e5157d6a3c19ce/d803c/thumbnail.png","srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/d803c/thumbnail.png 320w,\n/static/45252c4560c0c973b1e5157d6a3c19ce/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/fc5c5/thumbnail.webp 320w,\n/static/45252c4560c0c973b1e5157d6a3c19ce/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/45252c4560c0c973b1e5157d6a3c19ce/01fb2/thumbnail.png","srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"9dad4008-64b7-56a7-b07c-f8346a92a048","tableOfContents":"<ul>\n<li>\n<p><a href=\"#tcps-flow-control\">TCP’s Flow Control</a></p>\n<ul>\n<li><a href=\"#stop-and-wait\">Stop and Wait</a></li>\n<li><a href=\"#sliding-window\">Sliding Window</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tcps-error-control\">TCP’s Error Control</a></p>\n<ul>\n<li><a href=\"#how-do-we-know-an-error-occurred\">How Do We Know an Error Occurred?</a></li>\n<li><a href=\"#stop-and-wait-1\">Stop and Wait</a></li>\n<li><a href=\"#go-back-n\">Go Back N</a></li>\n<li><a href=\"#selective-repeat\">Selective Repeat</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"TCP (Transmission Control Protocol) has built-in features for controlling the flow of transmitted data and detecting and responding to network congestion. If TCP didn’t provide these features, developers would have to manually define what units to send data in, and handle exceptions when packets ar…","html":"<p>TCP (Transmission Control Protocol) has built-in features for controlling the flow of transmitted data and detecting and responding to network congestion.</p>\n<p>If TCP didn’t provide these features, developers would have to manually define what units to send data in, and handle exceptions when packets are lost. Thanks to TCP handling all of this, we can focus entirely on application-layer behavior.</p>\n<p>TCP’s transmission control methods are generally divided into three categories: flow control (regulating the amount of data being transmitted), error control (handling lost or corrupted data during communication), and congestion control (responding to network congestion).</p>\n<p>Of course, application-layer developers rarely need to touch transport-layer protocols like TCP directly. But if something goes wrong at this level, not understanding how TCP works means you won’t even be able to identify the cause, let alone fix it. (And overtime will inevitably follow.)</p>\n<p>With that in mind, this post covers TCP’s flow control and error control techniques.</p>\n<h2 id=\"tcps-flow-control\" style=\"position:relative;\">TCP’s Flow Control<a href=\"#tcps-flow-control\" aria-label=\"tcps flow control permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When a sender and receiver exchange data, various factors can cause their processing speeds to differ. If the receiver processes data faster than the sender transmits it, there’s really no problem.</p>\n<p>It handles everything as fast as it comes in. The issue arises when the sender is faster than the receiver.</p>\n<p>Both the sender and receiver have buffers for storing data. If the sender transmits data faster than the receiver can process what’s in its buffer, the receiver’s buffer will eventually fill up.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/79384/overflow.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAEDBAUC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAe9PPk3qhnsK9iP/xAAcEAEAAgEFAAAAAAAAAAAAAAABAgMAEBESITP/2gAIAQEAAQUCdUk2cJuV7kHq5XKvP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAMAAwAAAAAAAAAAAAAAAAABEBEhIv/aAAgBAQAGPwKvc6eWOI//xAAeEAEAAwAABwAAAAAAAAAAAAABABEhEDFBUWFxsf/aAAgBAQABPyHZLO/Dne3C6qJsz2wkKDrNkzCCI7R8/Z//2gAMAwEAAgADAAAAECvPPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABcRAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8Qys//xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhYRAxQZGh0f/aAAgBAQABPxAAi0WQToPPGZREFg7HH2ICj7UYl4WIg3Bb1NlOiXgcxHFqr2n/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"overflow\" title=\"\" src=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/c08c5/overflow.jpg\" srcset=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/0913d/overflow.jpg 160w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/cb69c/overflow.jpg 320w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/c08c5/overflow.jpg 640w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/6a068/overflow.jpg 960w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/eea4a/overflow.jpg 1280w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/79384/overflow.jpg 3488w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>It's like pouring water into an already full glass</small>\n</center>\n<p>Data that arrives when the receiver’s buffer is full gets discarded — there’s simply no room left. The sender would of course resend the data, but since data transmission is highly variable depending on network conditions, it’s best to minimize this kind of retransmission whenever possible.</p>\n<p>So the sender needs to gauge the receiver’s processing speed and decide how fast and how much data to transmit. This is TCP’s flow control.</p>\n<p>The receiver includes its window size — representing how much data it can handle — in its response header and sends it to the sender. The sender then references this window size and current network conditions to send an appropriate amount of data, thereby controlling the overall flow.</p>\n<h3 id=\"stop-and-wait\" style=\"position:relative;\">Stop and Wait<a href=\"#stop-and-wait\" aria-label=\"stop and wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Stop and Wait is a general term for any approach where, after sending data, you wait for a confirmation response before sending more. The receiver can reply with things like “got it!” or “didn’t get it…” — and the type of response determines which error control methods can be used.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/65ff8e861f0894835574fb210cb11888/e9d87/stop-and-wait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC1klEQVR42pVVz2saYRDdXdfEqGuSJhtsaWpNraCFQistQewP2ksPpZS0QkqhQkshl+Cf4D3kkmNyzCnouSKJv6KgxhSxaKtUq1L0JuToTTtjZ2Gz0Y1ZeHzL7rfzzZt585ZhGOYV4AngJWCW+X+xjPolvdcDXgCeAp4DXPhwGWAH3AZMKT4aYjAYjDtAA1gCOABWgFl6sQgQADxgmla17FgFC8zUIN80Tw+Q8hxhXhCEBVhnwuHwo729vZu4cUy2FwLOKbNyuVzazc1NzJYJBoMft7e3sT56u92ObK4BTFQirSyhcwG1CkqXUZ4iRhjogayh5zOUKDWbTUe73d6oVCqf4/H4F1xPTk6+FovFdb/fP0cBp2UZCvKAFuq2xul0GvHB6enph1ar9aNer2eSyWQuk8lkDw8Pv0ej0W+BQABpM16vV0PfG5WUl2QncAgVqTCTNAVTngHoSFtD6hKoMRrIjEeMkI5BGVCkzgmSZBCiKCIVPhKJ2I6OjtSmyKgmG1ai7Xa78QBtKBTa2NnZceNHZrNZpAA6YjWWsnbCOWYokECBcX08VjZXuDgCT+Uyyl8uSLO8uro6pFEul980Go1mrVb7eXx8XMnn879Aj79TqVQepgbNhLNYLDpiNqukfIvchrHZbChWDoJYu93u+06n8xaa8i6dTq/FYrG1RCLxen9/3zDCxi50WaBC6yaso6ps5mVpGyWn8Xg8IrnNs93d3Tu4ETLkRxx4qduwIGAOgPPKHxwceLe2tu4jCyiJSPulINOjanhV2bAkHT2V6KGabFgaPaHX662Au1ihIStnZ2dWMAsrONCyz+fT0X6eRtWklM0Nkg4HDjKUTaFQ+ASy+Qu2hXKp5nK5CrjNH7hPQynw38GSIjSU3bmAaF3XZZu4arW6CFne6/f7jlKp5Mhmsw44xAm4SwahKpurTgqrWC/IxjSihmhdGgRaF0K6HzPbQ6P4B8hy+YLbIMmSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"stop and wait\" title=\"\" src=\"/static/65ff8e861f0894835574fb210cb11888/6af66/stop-and-wait.png\" srcset=\"/static/65ff8e861f0894835574fb210cb11888/69538/stop-and-wait.png 160w,\n/static/65ff8e861f0894835574fb210cb11888/72799/stop-and-wait.png 320w,\n/static/65ff8e861f0894835574fb210cb11888/6af66/stop-and-wait.png 640w,\n/static/65ff8e861f0894835574fb210cb11888/d9199/stop-and-wait.png 960w,\n/static/65ff8e861f0894835574fb210cb11888/e9d87/stop-and-wait.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>The core principle of Stop and Wait flow control is simply “send data when the other party responds,” making it straightforward to implement and easy for developers to understand.</p>\n<p>If you think about implementing basic ARQ (Automatic Repeat Request), you could set the receiver’s window size to 1 byte and use something like <code class=\"language-text\">can process = 1</code>, <code class=\"language-text\">cannot process = 0</code> — a rough implementation that would still work.</p>\n<p>But an approach that only exchanges “can process” or “cannot process” signals is as inefficient as it is simple. The sender can only find out whether the receiver can handle data by actually sending it. In other words, this basic Stop and Wait approach essentially amounts to just keep sending until it works.</p>\n<p>For this reason, when using Stop and Wait for flow control, various error control methods are introduced alongside it to compensate for this inefficiency.</p>\n<h3 id=\"sliding-window\" style=\"position:relative;\">Sliding Window<a href=\"#sliding-window\" aria-label=\"sliding window permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As we just saw, Stop and Wait has efficiency issues, so modern TCP uses the sliding window approach in almost all cases unless there are special circumstances.</p>\n<p>Sliding window works by having the receiver define how much data it can process at once, and continuously informing the sender of its current processing status to control the data flow.</p>\n<p>While there are many differences from Stop and Wait, the biggest one is that the sender knows how much data the receiver can handle. With this information, the sender can roughly predict whether data will be processed without the receiver having to explicitly respond “can process” to each piece.</p>\n<p>Both the sender and receiver have buffers for storing data, plus a separate masking tool called a window. The sender can continuously transmit data within this window without waiting for the receiver’s response.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1b3989f922769714854cd9b45b5bd9ca/11f9c/window.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVR42hXM2UoCYQCGYe8qiIpKCbyacBmXGBV3Z0YdQ/GgTgrSNLcRKXGBkBxs1Nx+JZfUEekg6Rb0yw5eeI5eBZ2YFp3P35leNF1aUI7mF81KawsrjSm3NDN7pLWVk6ZmRpJN7sZLslEwZVc5Z2YuxMVfwZqeC7b0vzeCMydnLal5UXEaGEAdHu4K3hhaWjfeDRyIPYy2I4q2LYw+zUOkOHT1XgRCFRzzBGq+B0N6BWWgi4u9tckl1Nf97Tk/guKQ6UHJD3Z5TwxNjQsNigVxRPDhu0XXe4OBJYS6jkFX5wEbLOOAG0Dl7+wnMk7YDs64Di4fF1AFe9sjP4FC/zB5o4V1qRVJilPKPpzQDFlaGDKinGRs9BDZypLPKx9ZmFz9fEx81TwtK3RyVr2vbarGxKxq2ndX+6nSqUXZEJ/W/wAfQdwulAraEgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"window\" title=\"\" src=\"/static/1b3989f922769714854cd9b45b5bd9ca/6af66/window.png\" srcset=\"/static/1b3989f922769714854cd9b45b5bd9ca/69538/window.png 160w,\n/static/1b3989f922769714854cd9b45b5bd9ca/72799/window.png 320w,\n/static/1b3989f922769714854cd9b45b5bd9ca/6af66/window.png 640w,\n/static/1b3989f922769714854cd9b45b5bd9ca/d9199/window.png 960w,\n/static/1b3989f922769714854cd9b45b5bd9ca/21b4d/window.png 1280w,\n/static/1b3989f922769714854cd9b45b5bd9ca/11f9c/window.png 1707w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Frames within the window can be sent continuously without waiting for the receiver's response</small>\n</center>\n<p>The sender’s window size is determined during the 3-way handshake when the TCP connection is first established. During this process, both sides inform each other of their current buffer sizes, and the sender uses the receiver’s buffer size to determine its own window size through a process of “hmm, they can probably handle about this much.”</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1487079775</span>, win <span class=\"token number\">65535</span>\nlocalhost.receiver <span class=\"token operator\">></span> localhost.initiator: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3886578796</span>, ack <span class=\"token number\">1487079776</span>, win <span class=\"token number\">65535</span>\nlocalhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">1</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Observing the 3-way handshake via <code class=\"language-text\">tcpdump</code>, you can see that the initial <code class=\"language-text\">SYN</code> and <code class=\"language-text\">SYN+ACK</code> packets each report their own buffer sizes, and in the final <code class=\"language-text\">ACK</code> packet the sender announces its chosen window size.</p>\n<p>Both sides reported their buffer size as <code class=\"language-text\">65535</code>, but the sender’s final window size is <code class=\"language-text\">6379</code>. Why did the sender set its window to one-tenth of the receiver’s buffer?</p>\n<p>The sender’s window size isn’t determined by the receiver’s buffer size alone — it considers various other factors as well. The network is too unpredictable to simply trust the buffer size the other party reported. A key value used here is RTT (Round Trip Time), representing the round-trip time of packets.</p>\n<p>The sender measures the time between sending its initial <code class=\"language-text\">SYN</code> packet and receiving the <code class=\"language-text\">SYN+ACK</code> response, using this to infer the current network conditions. If this value is too large, it means the round trip is slow, suggesting poor network conditions, so the sender reduces its window size.</p>\n<p>This window size isn’t fixed — it can change dynamically throughout the communication based on network congestion and the window sizes the receiver reports. By adjusting the window size (the amount of data sent continuously), TCP can flexibly control the flow.</p>\n<p>Now that you have a general understanding of windows, let’s see why this technique is called <strong>sliding</strong> window.</p>\n<p>Imagine the sender wants to transmit data with sequence numbers <code class=\"language-text\">0 through 6</code>. The sender’s buffer would contain the data to be transmitted like this:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/232f15946f1a7d8a42025e582ef6400f/8d9a9/sw-0.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.375000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVR42n2OOwpEIRAE3/2vZeodRDAwUFHxi2gvMyC83WCzoqfpqaeUgpwzvPf45ZTSF4cQUGtFjJGZcmLnHM45EELgUUqh9445J5fGGGitQWvNTLc3G2O4S2OUr7X4mbUWUko8bysa+md4+RpeWzLce7PhB0qX47bPh+fNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 0\" title=\"\" src=\"/static/232f15946f1a7d8a42025e582ef6400f/6af66/sw-0.png\" srcset=\"/static/232f15946f1a7d8a42025e582ef6400f/69538/sw-0.png 160w,\n/static/232f15946f1a7d8a42025e582ef6400f/72799/sw-0.png 320w,\n/static/232f15946f1a7d8a42025e582ef6400f/6af66/sw-0.png 640w,\n/static/232f15946f1a7d8a42025e582ef6400f/d9199/sw-0.png 960w,\n/static/232f15946f1a7d8a42025e582ef6400f/21b4d/sw-0.png 1280w,\n/static/232f15946f1a7d8a42025e582ef6400f/8d9a9/sw-0.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The sender considers the receiver’s window size and current network conditions, sets its window size to 3, and starts transmitting the data within the window.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/16d1ae2726a8f3f4e63bad71de5db069/8d9a9/sw-1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.624999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVR42q2OzUrDQBDHt2A9qBXfoAiFQl/CqydveYW8hg/mB7T5aLJBSrHVqyTEEMk2m91kUyGZcRssKHhQcODH/ze7MDOEfK9jzTn5h+p95oHm6Mtb78+TjMnk5HI0Ot3nxXB4djUeD3bs/NowDk3T7P8WImbTYEt9Xzm2r7y5r93bu3KtgK1WVCpFpRA0yzJa1zUVP3jTNDSKIkq2iwd8ubvB9nGJ78sFbjwX8XmNIqAY398iJK/IOMe3NMW2bTHVWZYl6gEYxzFWVYVKKUySpPsjwp4Bd22QjgXl3AHpuVDqXmgX1hQ2T2vgUkKe5x36IuCcd14URQdjDPQSCMMQPgC0vexT2sGI+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 1\" title=\"\" src=\"/static/16d1ae2726a8f3f4e63bad71de5db069/6af66/sw-1.png\" srcset=\"/static/16d1ae2726a8f3f4e63bad71de5db069/69538/sw-1.png 160w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/72799/sw-1.png 320w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/6af66/sw-1.png 640w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/d9199/sw-1.png 960w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/21b4d/sw-1.png 1280w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/8d9a9/sw-1.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>What state is the data in the window? It’s been sent, but the sender hasn’t yet received confirmation from the receiver.</p>\n<p>In other words, data in the window is always in a state of “sent, but don’t know if the other party has processed it.” There could also be situations where data is placed in the window but blocked and can’t be processed, but let’s keep things simple and not worry about those cases.</p>\n<p>The receiver then processes data at its own speed and responds with the amount of remaining space in its buffer. If the receiver sends back <code class=\"language-text\">Window Size: 1</code>, it means “I have 1 byte of buffer space left, so only send that much more.”</p>\n<p>Now the sender knows it can send one more piece of data, so it slides its window one position over and transmits the newly included data (number 3) to the receiver.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ad1acdaf42325f81a805f9972417f525/8d9a9/sw-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42q2OP0vDQBiHA+pmwUmjDo6VgoObk5MO9SP0E4iL36MiCkIdHALiFChtIZN/6FC99pq01GKtOFQNgSO0plySS5NGeb0Uqh07+MLDPdy9v+MntNvtWMRBKrW2sxlfuTg73VURunxttaTHWu0qc3KU3EskxOT21kYul1swTXN+nJmk2+3G8vl8TGCMEce2iadVjUG1YvhqRffQQ8fFqMPKqDOoIN1XscHqmm71esTzPNLv94llWb/e4/cAQEqlEhF0XYfA9wFenuET3cOw2YBvzvvdDYT8/OJ83F5D8NSEAWNACIEgCIAXAcMwIAxDoJQCbwiapoHAHyn/kHp1jXoqHsEwom71zx1ctp2aSh2eDIZDyptR13VplI3ctm3KG1KMMRUURRFlWRbfJEl0ZUk0IyJX5JFDNruYOdyPo/Pj1UKhsDTej5j0YrEoptNpUZhyljmzwj/NDGedMzfN9g/YBTGIBWRq1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 2\" title=\"\" src=\"/static/ad1acdaf42325f81a805f9972417f525/6af66/sw-2.png\" srcset=\"/static/ad1acdaf42325f81a805f9972417f525/69538/sw-2.png 160w,\n/static/ad1acdaf42325f81a805f9972417f525/72799/sw-2.png 320w,\n/static/ad1acdaf42325f81a805f9972417f525/6af66/sw-2.png 640w,\n/static/ad1acdaf42325f81a805f9972417f525/d9199/sw-2.png 960w,\n/static/ad1acdaf42325f81a805f9972417f525/21b4d/sw-2.png 1280w,\n/static/ad1acdaf42325f81a805f9972417f525/8d9a9/sw-2.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Because the window moves sideways to include new data for transmission, it’s called a <strong>sliding</strong> window. If the receiver had sent a window size larger than 1, the sender would slide its window further and send more data continuously.</p>\n<p>However, since the sender’s window size is 3, even if the receiver reports 4, it won’t slide 4 positions — only up to its own window size of 3. But in this case, the sender would recognize that the receiver’s performance has improved and could respond by increasing its own window size.</p>\n<p>The sender’s buffer can be roughly divided into three states:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/db7ce/sw-3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVR42oWOz0vCYBzG56VuXfph/0AheZDqP+jQOf+A/hPFk9fasUsQSBdh+OMgghNzc7nZnFIyECEp0BGibu/GtndTvr2Oea0HPjwPvC/P96GorQAiG8tms1GGZZNcr3dTFUSCEJArFpOZTOYo/B2h/hKeNW7B6jys58Kd/lK/B0lK23wjBVI7wOWbKVDk9KLF3f9oGm3bNj2dTmmEEK3repDX6zU9Ho/pcNzweYVV8GzV90cqWOoA4OsTrMEH4R3gewxLpQt4NAQTGWAgBL7vAykE0zTB8zwwDAM0TYOg0F8KuZUuAZ61bSS2PEN8xXZHxPMWR+Cx8ybhGdfEiDgpdDHGDsEkSyeO40xItlzXdUihGy6UjvGingAkxKDfPwVZjmmlUhzX6wGbDDwfRyx7VigULqvVaqJcLl93u90nWZYfGYa5qtVq58QvNn1RwgHhMGSfsEf9o0qlstsnxxVFOcnn8zvbh1+TxRfeE68QWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 3\" title=\"\" src=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/6af66/sw-3.png\" srcset=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/69538/sw-3.png 160w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/72799/sw-3.png 320w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/6af66/sw-3.png 640w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/d9199/sw-3.png 960w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/21b4d/sw-3.png 1280w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/db7ce/sw-3.png 2404w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>In short, the sliding window approach repeats the cycle of “send → receive response → slide window,” continuously transmitting as much data as currently possible.</p>\n<p>This simplified diagram with only numbers <code class=\"language-text\">0 through 6</code> might not seem impressive, but TCP’s maximum window size without any options is 65,535 bytes, and with the WSCALE option maxed out, it can be set to 1 GB.</p>\n<p>Plus, the data sent continuously in one batch isn’t just one or two pieces — it’s often hundreds of bytes at a time. In real-world environments, this delivers significantly better efficiency compared to Stop and Wait flow control. Theoretically, up to 1 GB can be transmitted continuously without a single ACK response from the receiver.</p>\n<p>Because the sliding window approach is clearly faster in terms of transmission speed compared to Stop and Wait’s one-at-a-time send-and-wait cycle, and because the window size can be flexibly adjusted through ongoing communication between sender and receiver, modern TCP uses sliding window for flow control by default.</p>\n<h2 id=\"tcps-error-control\" style=\"position:relative;\">TCP’s Error Control<a href=\"#tcps-error-control\" aria-label=\"tcps error control permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP fundamentally uses ARQ (Automatic Repeat Request) — retransmission-based error control. In plain terms, if something goes wrong during communication, the sender must retransmit the affected data to the receiver.</p>\n<p>But since retransmission means redoing work that’s already been done, various methods are used to minimize this retransmission overhead.</p>\n<h3 id=\"how-do-we-know-an-error-occurred\" style=\"position:relative;\">How Do We Know an Error Occurred?<a href=\"#how-do-we-know-an-error-occurred\" aria-label=\"how do we know an error occurred permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There are broadly two ways for TCP endpoints to detect errors.</p>\n<p>The first is the receiver explicitly sending a <code class=\"language-text\">NACK (negative acknowledgment)</code> to the sender. The second is inferring an error when the sender doesn’t receive an <code class=\"language-text\">ACK (positive acknowledgment)</code>, or keeps receiving duplicate ACKs.</p>\n<p>At first glance, NACK might seem more straightforward, but using NACK requires additional logic on the receiver’s side to decide whether to send an ACK or NACK. So in practice, inferring errors using only ACKs is the more common approach.</p>\n<p>A timeout occurs when data sent by the sender is lost in transit (so the receiver never received it and therefore never sent an ACK), or when the receiver responded correctly but the ACK packet itself was lost.</p>\n<p>In both cases, from the sender’s perspective, it sent data and the receiver didn’t respond within a certain time period.</p>\n<p>The second method — detecting errors through duplicate ACKs — works roughly like this:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/9ac09/duplicated-ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVR42o2SSQrCQBBFv2ZOHHBC4wQO4M6NIF7E87h24U29g/42P9BmICl4dFJJ/ZoaADrIbEKuOmH5UfjnQvZoaWMSE5d0C6K5xfrWWjAhoXWGVgJjUU2isr0o+KDAnUFHIFA1kcT7yHwbMmsleqPgk4EfCryBgSoLLEHj25ElcdoUuVZQbwuMrJY9iTtazKBpjnn5K1Vkgn38t50va6gkUQWlMSQ1rTgSD9WySZyShdqf6/0XawY8lSNVFa7Vple4QnHTQg7kRM569isutm2RlaAIvrJoCfc06g3RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"duplicated ack\" title=\"\" src=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/6af66/duplicated-ack.png\" srcset=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/69538/duplicated-ack.png 160w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/72799/duplicated-ack.png 320w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/6af66/duplicated-ack.png 640w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/d9199/duplicated-ack.png 960w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/21b4d/duplicated-ack.png 1280w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/9ac09/duplicated-ack.png 2204w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>To put this more simply: the sender has already sent <code class=\"language-text\">SEQ 2</code>, but the receiver keeps saying “hey, it’s time to send me number 2.” The sender can then infer that something went wrong with its data number 2.</p>\n<p>However, since TCP uses packet-based transmission where arrival order isn’t guaranteed, receiving one or two duplicate ACKs doesn’t immediately trigger an error determination. Typically, it takes three duplicate ACKs before an error is declared.</p>\n<h3 id=\"stop-and-wait-1\" style=\"position:relative;\">Stop and Wait<a href=\"#stop-and-wait-1\" aria-label=\"stop and wait 1 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Stop and Wait is the same approach we looked at in flow control — send data, wait for a positive response, then send the next piece.</p>\n<p>It appears again in error control because it inherently provides basic error control. Two birds with one stone, if you will. Since data keeps being retransmitted until a positive response arrives, it handles both flow control and error control.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8beaea3d1aff1e971396525f6b9fbd36/eb2ef/stop-and-wait-error.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVR42pWUPWxSURTH3ydfbYEHWIVGnxqsg8FEqYbEuJgY2ZyYuzUm2r1TWRrTicSFgXTo4lIYWBz4SGiHpkBIKg0BUvkKJjAwsLhfz8Hz4pPywvMmv/Aeue/cc+7/fw7H/V0R4C3wBrBwyxdPv0+BKPAaeKnfsAKowC3dZjPLCviBDcA9f5oCOIE1QgYkhDHGIwZBZdp/YznpRFHb5HK58FQ5lUq9SyQSr/A6gsGgVTvITEBp0V01Gg1PuVx20n822ovYgYfAnaUBscTRaKTW6/XH/X7//ng8ftBsNjcvLy83aItEAdcBzyLF8JT1cDiMJci7u7vOwWDwrdfrtSC7erVa/X56evojn88fU5kyfWuZL1kLiAq76FlAhsOhHTJ15HK5lVqt5sD36+tr6zJR5lXWRBFNetFQFMzOAaxq1lEUBf+zHR0dbWUymUe4ia7EtG30KvPb29uoKJfNZrcg6DM8MBQKaZVoCSiEKdsYLZEQzNpG2NnZkbvd7kewzOH5+fnB1dXVQalUOgQ+kbmtpLCdvr1xudiTdzVRotGotdPpxH8Oh8dgmxQCtjkuFov78XhcoOx4CnxT5Rcc5/0MMOxdCMbAKibL/0eUAPnvNqbNVNUGAe1sb2+TZbMfZs+RiOeXz+dvxGKWOGMC+5OdYcB7wHPgCbWPqLUdK5UkCCgAPOBhxoIZGttNQTVLrJBI4hfojhpjskFAi14Uni5Xr7KgCaOqKh4ipdPp98lkcjbNyeyyrpv+a3zNFlhFOjk5EXUeXNONr6Dp8TWdTt3tdtsHHlTgXalUKl4YDk6qTD8DFo4vH95dLBbDDCw4vsDUBTB3/+Liog3BWpDpsFAofKUyNWPbjEQJkH1m94rmBWOvTyaTAAxW/9nZmb/VagUgoNfscFg1MbKMbDNrgt+w9OsqEzQqSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"stop and wait error\" title=\"\" src=\"/static/8beaea3d1aff1e971396525f6b9fbd36/6af66/stop-and-wait-error.png\" srcset=\"/static/8beaea3d1aff1e971396525f6b9fbd36/69538/stop-and-wait-error.png 160w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/72799/stop-and-wait-error.png 320w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/6af66/stop-and-wait-error.png 640w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/d9199/stop-and-wait-error.png 960w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/21b4d/stop-and-wait-error.png 1280w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/eb2ef/stop-and-wait-error.png 1324w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>However, when using sliding window for flow control, data within the window needs to be sent continuously. Using Stop and Wait for error control would negate the benefits of sliding window.</p>\n<p>For this reason, more efficient and smarter ARQ methods are generally used instead.</p>\n<h3 id=\"go-back-n\" style=\"position:relative;\">Go Back N<a href=\"#go-back-n\" aria-label=\"go back n permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Go Back N sends data continuously and then checks which piece of data first caused an error.</p>\n<p>As mentioned above, detecting errors through ACK anomalies is more commonly used in practice, but assuming the receiver uses NACK makes the diagrams easier to follow. So for explaining error control techniques, I’ll assume the receiver uses NACK.</p>\n<p>Since this section focuses on explaining error control techniques, let’s concentrate on how errors are controlled rather than how they’re detected.</p>\n<p>With Go Back N, after sending data continuously, a single ACK or NACK is enough to understand the receiver’s processing status, which makes it a great fit with sliding window flow control.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1bc040f7f4090114bb5b65db8e769d5b/e9d87/go-back-n.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 133.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD10lEQVR42o1VSUtbURR+0ZjEmLyYxLk1FomhjVpL01hX2i5aui3FTaEoLVRLV/0FQldC3QhWiFAiVLAVjG4c4ggOcUAjOIBWs2iwFDW6EGoWpr5+JzmhLxrFCx/33dx7vzPc75wIgiA8BaqBx0CGEBsK4XpDzfdqgEdAJf14C7jNc5rssCIOSZIuM5AC5AB2oAQoiG9kAxogla0qr/BKIUN80F29/BARZgJGQGQYMGitHh4ernC5XPlXGLlAmMMklEMdkdHa4XBoyevu7u63ra2tDnyrYCSTjes4RUo+n0CYy94ZeYMsihaLhdYpCwsL9UtLS/fJW6PRSJfT+ZwJIKNlgFlOaJblUMceiEVFRTQrh4aGGjs7O8lDgQkNsmiIvBTIkhMa+cUSRm1trYrm/v7+6paWFhuRkBEmFdkRIrayt0kJr6vBVM6fOlnICR5ub29bp6enq3Z2dh4EAgHn+vp6pd/vd25ubjqDwaBza2urcnR0lAjSrFarmkMX5YQ3KQc1NTWUR2FiYuLL4ODg8erq6s+1tbXd2dnZXa/Xuzs/P787MzMTHBkZCQ0MDDyhs01NTcoLhDBRzF5GQz47O1OjOjIA7d7enk6OyclJHTzWMdGlOsyKi5mtpTAU16iYi4TPBSG/B6/UhI3X2LDHXkxkEau/9fW9+NjcTNIQniFnjsSav0iImspyQ3sSPAQyGDoJwp7ES657vfUT7e2kQ61MMgbWKwk7j78TKiWTrYh4IVMtLnzKzSWNpUl9fa+krq5yGFFKZrOeDC8BiEjrAtBi7iWVDUhSEa6K9ZXBpZf63eNp/OxyOcmbl2gYH1AdX2FYikWlAWxvzgnbxEJNOn74/dlBny+dlyoOU8NzOkKr0MU6VgKhgqVSCNncPDk5KVxcXCyEgC1utztvf38/H4K+cXBwUIAzUfwKBCzuujoNN9b/ObTZbNHCjkQiDSDDWenP8fFx2OfzhdFlwuPj4+GNjY0wDIRBGsb+ySkGzv+GNqmOVdxI2D2TiVq4HlXxDuUm4fIpBPx3ZWUlAhFHUHKR5eXlyNjYWHRGtZxOTU1Jc3NzIVRREUXHrx8bWq2WurG+t7c3/+joqOLw8LAUNVuG73JCKBS6g3U5vKsggOwuzTBYCsPxBiGe79gGWU9Uyh8JoafzxcuGNlnHzqTK0Ov15lzoD2kQi4uLyZASjeF9R0dHFb0o5cput1PONNxpktaySfZvp2FvDSCkWdnT09PQ1tb2kHJFhvi8KOvc5Vf2w/hAR4n+5vF4KtGxC+kyJ1/PhPHqKjnfsQ3nCBXX6DRpMtjj7e8fXQh0aZiMba4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"go back n\" title=\"\" src=\"/static/1bc040f7f4090114bb5b65db8e769d5b/6af66/go-back-n.png\" srcset=\"/static/1bc040f7f4090114bb5b65db8e769d5b/69538/go-back-n.png 160w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/72799/go-back-n.png 320w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/6af66/go-back-n.png 640w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/d9199/go-back-n.png 960w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/e9d87/go-back-n.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>In the diagram above, the receiver detects an error starting from data number 4 and tells the sender “resend everything from number 4.”</p>\n<p>In Go Back N, when the receiver detects an error in data number 4, it discards all data it received after number 4 and sends a NACK to the sender.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/393dda4bf3efb487525f9567f2d08f12/b88bf/go-back-n-example.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVR42p2KSShEcRzHnywlOWiuzhwcmTJlSZpQ8zRIWU5qsmTLkiVN2ZeQJWGs72BpJs00svaII8+8mf/M65kZxgENN7yiJHw9cVAc8KtP38/v9/tS1B9GrVaHpSSqklKVSsXnKeBbCUCgTPAvCJEJSNA1ReV+eNAPnUBqYO3SrJsRRP2Kz9FqPiO6aRfpWzsndYseUjYvkn7ZyxmRVC35yCHrJGfLZuFkhyNt635SOOcm3Rt+0mI5txcxXu/g1jVDlS6cXMV12aAZcb5qxwTEdhwg3yAipZ+HqptDnuEYyb0cEoZF8OPLQKced6PjqOrZAV1hQrWcxe3bL9rGTeinbQ6q0ei7yBh2QDcrvpYwbqQNHqFm6RR5E05kjthRK3v2qB05Bjc40y4kwyT8RivqGQEFzdaXZsaFyin7c+6QDe1GD0+xLkllsd1qWeFes00k2sLd0PvCA73BS/Qq/+4fuSrvnFuieeFazptM9gLprq65kr3jR41VxuR4yGI9T0rqv6OIVoQ3RITFxEdGhn59vAEdrBxc2iz0dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"go back n example\" title=\"\" src=\"/static/393dda4bf3efb487525f9567f2d08f12/6af66/go-back-n-example.png\" srcset=\"/static/393dda4bf3efb487525f9567f2d08f12/69538/go-back-n-example.png 160w,\n/static/393dda4bf3efb487525f9567f2d08f12/72799/go-back-n-example.png 320w,\n/static/393dda4bf3efb487525f9567f2d08f12/6af66/go-back-n-example.png 640w,\n/static/393dda4bf3efb487525f9567f2d08f12/d9199/go-back-n-example.png 960w,\n/static/393dda4bf3efb487525f9567f2d08f12/21b4d/go-back-n-example.png 1280w,\n/static/393dda4bf3efb487525f9567f2d08f12/b88bf/go-back-n-example.png 1702w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A ruthlessly cool approach — when an error occurs, perfectly good data after it gets tossed too</small>\n</center>\n<p>This means the sender, upon receiving the NACK, must retransmit the errored data number 4 and everything it sent after it. Even though the sender had transmitted up to number 5, it has to go back to number 4 and retransmit from there — hence the name Go Back N.</p>\n<h3 id=\"selective-repeat\" style=\"position:relative;\">Selective Repeat<a href=\"#selective-repeat\" aria-label=\"selective repeat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Selective Repeat means exactly what it sounds like — selective retransmission. While Go Back N is much more efficient than Stop and Wait, it still has the inefficiency of discarding and retransmitting data that was successfully delivered after the error point.</p>\n<p>So the approach of “just retransmit the errored data” was born.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/e9d87/selective-repeat.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 153.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEaElEQVR42p1WTUxjZRR9pYWWtvT1h06nRqnDMAOCKQqBQKJ0ZjayYFsTN6MbG01kYeJCk6ksjInMwmBgFoQIU0mGyIRpIuU/gK/8g/yEv0AxSHAoC5WN45REST23vWUehRJmvuTkvdLvO/d+955ziyAIwjtAFXALyBLiSyFcbGmAm4ALuAGU0R9fAfIBB5Au26xIIBqNpgqQBliBAiAXuJz4gv6oBZSAGlCdk5VChsTKBPTyTdmAiWFgiFj0Wd3d3V3c3NxsPyfIKcJLRMBZ6vlddDqdOipDR0eHp7GxsYTeEcSIp5H3ZfBtTGcRyjOkiIacnBz6nDY3N3d7dXX1DcrWZDKJie8BCyfxOp89XhbuGNVQxxkYcnNz6bCqr6/vo9bWVuqggjMUeZ+eyYsAs5zQxGQnlsfjiXW9s7Pzrfr6+mtE4HA4jJxlIkMdq8SYivCiGlTKVFF4HqGwsbFRIEnSrc3NzbeBqsXFxRuzs7OutbW1qu3t7ar19XVXb28vSU2Vl5enZkNkyQlfBmwul4vqKIyMjDTjwD/Ly8u/oxnhycnJ8ODgYHh6ejo8Pj7+eGho6K9AIHCTy6HkWj4jRIgrsqKmySORSxJ4Hh1auHNGjqRiKC/gmNOEbnhwEhmOQjrfoXsV8WyzuJuaBw8fvvf13btO2utyODSFcUGnzhBv2Z+jMVFkCegAPZAVhbDxVP0aCHww0dBAOtSazeaENY3cTB33QEx2SuK6Inaby3HIY7eTCzL+6+q6Hb1/30nkURBS4D/xfScy+wlBrgpCSbJTYrLBRoU7XjdqjJatp3zw6NGHDffuxTJ0wSkoSeY38dsYAQ1w/f0zdKiSdVYJpCU6Gw6FrJCRgZxTXl5ueKmgwCLCMXx1LezkNJxhPZXwnKsON+Eb2Zn8GSFEHSPE3Mvu6en5Hk75AWL2Qdg+iNkHsftGR0d98/PzbXj+iO8+odKwU/TJTslXq9U0woX29vZ8WK1rZWXFPzU15afnzMyMHwFiT7ima2Jiog/Ed2TnTxGaamtr1Vy/j4+Ojv7G4cfw7z5I92HBfdhtH+T0Ht7d3f0D+zaQ6auUJY+0E1e+ZrPZyH7CwMDAp9gYxeEnQAQDIYJsDoeHh59i0D5Fpk+Af1GG35qammI/Sva4vE5Yz8Y6VCC6eWxsrIgmzuHhYQyRSCQPU+e1nZ2dQgyIwq2trSJMnOt1dXWJRp4itDKhyLXQyLsOEgOuqErh5zMJj+eh2+1W0kiqqKjILCsro6GR4ff7P2tpaSmlOhUXFxtLS0u1/AOmSjVtTNiUHgqF1ASIWA25ZCCrdMrs4OBARF31bW1tGgQUKysrL1VXV1shtcsc9M1zJ/YLLGtyl3W45hVkJaEZEjKU0BgJ4pWCwaAEqUhogrSwsIAGS0FIKLi0tPQzxP5Lf3//t1QWHnXH62pNTU3J3t7eF+jklzjkhQ5jAJEXZYgBJF7o0gtheyGhOwj2FQK/S7W0WCwnhC2+iJeT/gujTgv/Ayrd38q3b/JAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"selective repeat\" title=\"\" src=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/6af66/selective-repeat.png\" srcset=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/69538/selective-repeat.png 160w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/72799/selective-repeat.png 320w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/6af66/selective-repeat.png 640w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/d9199/selective-repeat.png 960w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/e9d87/selective-repeat.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>At first glance this seems nothing but efficient and wonderful, but unlike Stop and Wait and Go Back N, there’s a drawback: the data in the receiver’s buffer is no longer sequential.</p>\n<p>Looking at the example above, the receiver’s buffer wouldn’t contain <code class=\"language-text\">0, 1, 2, 3, 4, 5</code> in order — it would have <code class=\"language-text\">0, 1, 2, 3, 5</code> with the discarded 4 missing. When the sender retransmits 4, the receiver needs to insert it somewhere in the middle of the buffer and sort the data.</p>\n<p>Since you can’t sort data in place within the same buffer, a separate buffer is needed.</p>\n<p>In the end, the retransmission step was eliminated but a reordering step was added. When retransmission is more advantageous, use Go Back N; when reordering is more advantageous, use Selective Repeat.</p>\n<p>If you want to use Selective Repeat in TCP communication, set the <code class=\"language-text\">SACK</code> option to 1 — though in practice it’s usually enabled by default.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sysctl</span> net.inet.tcp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> sack:\nnet.inet.tcp.sack: <span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On macOS, using the <code class=\"language-text\">sysctl</code> command to check TCP-related kernel variables shows <code class=\"language-text\">net.inet.tcp.sack</code> set to 1.</p>\n<p>Given that in most cases it’s more beneficial for the receiver to handle reordering than to traverse the jungle of the network again, it makes sense that Selective Repeat is the default.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The hardest part about studying TCP recently has been how many different concepts are intertwined within this single topic.</p>\n<p>Being a nearly 50-year-old protocol, TCP has accumulated a massive number of improvements and options compared to its early versions. So whenever you try to dig into any single TCP behavior, everything else comes along for the ride like a chain of sausages.</p>\n<p>For example, the window size discussed in the sliding window section isn’t simply set to whatever the receiver reported. It’s determined by comprehensively considering various network-related variables like RTT, MTU, and MSS. To be precise, the sender’s final window size is the smaller of two values: the window size reported by the receiver and the window size the sender determined based on network congestion.</p>\n<p>Additionally, the error detection techniques discussed in the error control section are also an important part of congestion control. They feed into the logic that resets the sender’s window size, followed by retransmission using whichever error control technique both sides agreed upon.</p>\n<p>In other words, even though this post didn’t cover it, congestion control content is mixed into the topic of flow control.</p>\n<p>Personally, I feel like splitting things into topics like flow, congestion, and error sometimes makes it more confusing. I considered writing a post that ignored these distinctions, but since everyone is used to this categorization, I decided to go along with it.</p>\n<p>I actually intended to include congestion control in this post, but when the line count exceeded 500, I decided to split it out. Long posts are exhausting for readers.</p>\n<p>In the next post, I’ll cover TCP’s congestion control.</p>\n<p>That concludes this post on TCP’s flow control and error control.</p>","fields":{"slug":"20191122-tcp-flow-control-error-controlen","path":"/2019/11/22/tcp-flow-control-error-control/en/","lang":"en"},"frontmatter":{"title":"TCP's Flow Control and Error Control","subTitle":"How TCP delivers packets safely — a guide to flow control and error control","date":"Nov 22, 2019","categories":["Programming","Network"],"tags":["TCP","Flow Control","Error Control","Stop and Wait","Go Back N","Selective Repeat","Sliding Window"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/2ebbc07e03d747e529b6345b51c1196d/d803c/thumbnail.png","srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/d803c/thumbnail.png 320w,\n/static/2ebbc07e03d747e529b6345b51c1196d/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/fc5c5/thumbnail.webp 320w,\n/static/2ebbc07e03d747e529b6345b51c1196d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/2ebbc07e03d747e529b6345b51c1196d/01fb2/thumbnail.png","srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"8f450265-eb42-5be8-97a8-0080169e7b57","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-connection-oriented-really-means\">What “Connection-Oriented” Really Means</a></p>\n</li>\n<li>\n<p><a href=\"#3-way-handshake\">3-Way Handshake</a></p>\n<ul>\n<li><a href=\"#closed\">CLOSED</a></li>\n<li><a href=\"#listen\">LISTEN</a></li>\n<li><a href=\"#syn_sent\">SYN_SENT</a></li>\n<li><a href=\"#syn_recv\">SYN_RECV</a></li>\n<li><a href=\"#established-initiator\">ESTABLISHED (Initiator)</a></li>\n<li><a href=\"#established-receiver\">ESTABLISHED (Receiver)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#4-way-handshake\">4-Way Handshake</a></p>\n<ul>\n<li><a href=\"#fin_wait_1\">FIN_WAIT_1</a></li>\n<li><a href=\"#close_wait\">CLOSE_WAIT</a></li>\n<li><a href=\"#fin_wait_2\">FIN_WAIT_2</a></li>\n<li><a href=\"#last_ack\">LAST_ACK</a></li>\n<li><a href=\"#time_wait\">TIME_WAIT</a></li>\n<li><a href=\"#closed-receiver\">CLOSED (Receiver)</a></li>\n<li><a href=\"#closed-initiator\">CLOSED (Initiator)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"Following up on my previous post, What Information Is Stored in TCP’s Header?, this time I want to explore TCP’s handshake process and the TCP states that change throughout it. Because TCP pursues reliable connections, it goes through a special process called a handshake even when creating and term…","html":"<p>Following up on my previous post, <a href=\"/2019/11/10/header-of-tcp/\">What Information Is Stored in TCP’s Header?</a>, this time I want to explore TCP’s handshake process and the TCP states that change throughout it.</p>\n<p>Because TCP pursues reliable connections, it goes through a special process called a handshake even when creating and terminating connections — all in the name of ensuring reliability. The endpoints communicating via TCP use this handshake to exchange information needed for communication, such as which TCP options to use and synchronization of packet sequence numbers.</p>\n<p>But explaining with words alone isn’t much fun, so I wrote a simple client and server in C, and I’ll include snippets of the packets they exchange during the handshake — captured by secretly eavesdropping on them.</p>\n<h2 id=\"what-connection-oriented-really-means\" style=\"position:relative;\">What “Connection-Oriented” Really Means<a href=\"#what-connection-oriented-really-means\" aria-label=\"what connection oriented really means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Before discussing handshakes, I want to talk about the concept of a “connection” that TCP creates and terminates. If you’ve studied TCP, you’ve probably heard of one of its key characteristics: being connection-oriented.</p>\n<p>Connection-oriented literally means it aims to maintain a connected state. “Connected” and “connectionless” are terms you encounter repeatedly when studying networking. Personally, I found these terms a bit confusing at first.</p>\n<p>Common sense tells you that two devices need some kind of connection — whether a cable or otherwise — to communicate. So I didn’t understand why they bothered distinguishing between connection-oriented and connectionless.</p>\n<p>The confusion arises from the difference between physical connections and logical connections.</p>\n<p>When we normally think of connecting one device to another, we picture scenarios like connecting a computer to a monitor or plugging a USB into a computer. That is, physical connections between devices.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 19.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42mNggIL//xkY/9czMIHwqlAGZh93JyMvN0crd3dnS2dnZ0MnJyc9L1cHcw8XextvN0d9kBqY+v8MDIwMcIPO+wv8v5US8v9SpiDMYLgkQygziFxVaMG5KsueB8KvZ4JgBPh3K5f9383MoH+3UmQY/j8pKvr/f/n/n5dSJtwp1jB+Ptna4Vm/pd2rSWa2LyeY27ydbGr5dIJF4ItJlpFvp1pagcTeTTG3AakBqX1YoWH87Xhsxf//a///f1E+jeH/3RK9/3fLF/w6l2l6RYuB7c1ED77XnVa8yPhpvTHX//n2HOjiILX34+U5fhyPVP1/v3HO/ztFzgCVcHv231n+BwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"physical connection\" title=\"\" src=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png\" srcset=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/69538/physical-connection.png 160w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/72799/physical-connection.png 320w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png 640w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/d9199/physical-connection.png 960w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png 1251w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Using a cable to physically connect two devices</small>\n</center>\n<p>In contrast, the “connection” in “connection-oriented” refers to a logical connection. Of course, devices still need physical connections to communicate with each other.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVR42mNgwA4YtbVtZR0cHKzdHB2tjH18NExdXQ1c7O1N7O3tLXR17WUYcIH//xkYQRhV7D/j55Mp2uv74wVA/Pf8/IrPxfkVQOwzM9P4P13O1MRqDgOSOf/rGZggdD3L+/X1Av8vpmX//79Q7r+rq9h/AZ6s/4I8af8DAoT/v5yi8v9ietb/VVN4QGpBhsD0Qgy6ECj2/3KgPtRlLEDMAWLf/3+f47u5usJ/EQG7/1PqgZpDef6L8zv8M1ORAclB1XMAMTOYfTXW8P+1WGGG/w8qd/5/3/f/f69T8n8GfsP/3Kx6QFt1//NyF/1XlfO+te0f+//rJcH/b1X43J9/n+O/smTAP17OAqAa7f9crPo/GbgM/8z0z/r/Y/b//w+qljP8v1vZ9P9B/Yn/qyP0Ptl4iH5w0xICKub6Jy1m8Xl2nvjT/0+5fl4o1vl/qUgD6BrO/1OyJEByQDWc/wNMhT/Z24v83xpr8v9hy7n/t8tKGJDDABQZ//+f4QLSrP//nxf4dGOmyJf9UyT+X5om+P9MB/+Xk1MkPj5ZKPz//13+K///s0HVMsLiABwp/xmAhoAwVAIseayX89+NjILvF5oVwfxbuSH/b+T6Q8K8Xu3/1fT8/2dmssLVI5kBAOyQ/gHAEaq2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logical connection\" title=\"\" src=\"/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png\" srcset=\"/static/025135c6a12488fad9c15e904f065386/69538/logical-connection.png 160w,\n/static/025135c6a12488fad9c15e904f065386/72799/logical-connection.png 320w,\n/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png 640w,\n/static/025135c6a12488fad9c15e904f065386/d9199/logical-connection.png 960w,\n/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png 1201w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>To put it more simply, it means two devices maintain an ongoing state of being connected to each other.</p>\n<p>Using a phone as an example: the phone being connected to the phone line is a physical connection, while actually being on a call with another phone is a logical connection — a connected state.</p>\n<p>So why does TCP maintain this connected state? The reason is simple: to ensure the reliability of continuous data transmission.</p>\n<p>TCP uses packet switching, so it splits data into multiple packets before sending them. Rather than blasting all the data through the network at once, it bundles them into units and streams them to the other party.</p>\n<p>Now think from the receiver’s perspective. One advantage of packet switching is that it doesn’t monopolize the circuit — multiple simultaneous communications can happen over limited bandwidth.</p>\n<p>This means each endpoint is simultaneously exchanging packets with multiple devices. Without information like “who sent this” and “which packet number is this,” the receiver would be extremely confused.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVR42n2Sz08TQRTHB/HCvyGJwYuJ/wAxqZqQGPWg0Xgw8Vc8QeLJRCMcNEYTgUp/7lZol1ZKS0lpqYBCbSnsj/6g7Xa7RbZ0u21QoxjAA4FY6fi2VNMDMMnb75s3M5/35s0iml+VEUJNi2nJG0kt345EeQ2dWU1ADPX04GOoYbgxblaV4aVhOvX5UYhOtDFZmYfQ8VkmtRwVChcRzedrQCaTd4bZZD+bK4ucqERrQHw4MBwTH8/QdBsjyLxe2/diKsTi5W+bZxGXW9uNxIQbADal5XVM89ICk5bmDqoQ14GcUCQt1Ig08SHYPj0fw7oBrTjHpOSYWOxATEb+yQryF04s7XC50rPalfl89EhgVtG6vQFstVHlySCzfr1DczKWKwUjCfEKZJOF+cXEhbj0dY/jpatRfqWdE4vxfWDPgVdmswUqLZW7X73uo8LxnKLGolmZ5fj8ZcRkFXb/GiUS+niNTktnGEGZOqpCNiP3cxn5QWB24QSc/7SfRJlgMoVzKKVsagNOy6nYSrmXXsrcWWDj55Plre6DHgXX50l542myuHFTkEqtaWXLWospv0xL8o92FP+8hmNCvposfK8uraxV42IRHmZ12+/3axoh4DWp397ehy2jHu/OiHs8ZHeM6HxTHzFlpTrHfe/xu1G3HXkmJrHbN7035p/GY/4Z7PIGKl5fADscjvu1vrndzfUCm+rzFqPBsGsyGsNms1k3+NaCCcLSRRBmbDIZ7UgNGHQDewb9AFbNqNdVbFYrJkny7mFAgiB2Yb0GpCgKgETX4OCQqnY0NAQOSVYIgqyqBht/U9QwZDMdBdwGWBD0jXoeznSCqUAKuVwubLVa/6gLoKpVPB4Pttls9xqB0Mv/QGjHjt1uD0N1epir7elyOp2q2hFQRyEbDZoBS4MfAjWBtTaC/g3134S1J3CDW7BXA/rSYrGcBv85xC/9BYcvGjU7koP9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pipes\" title=\"\" src=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png\" srcset=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/69538/pipes.png 160w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/72799/pipes.png 320w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png 640w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/d9199/pipes.png 960w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/21b4d/pipes.png 1280w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png 1427w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Trying to distinguish connectionless packets is like trying to tell apart water mixed in a single bucket</small>\n</center>\n<p>In the diagram above, think of the pipes as physical connections, the openings at the end of each pipe as ports, and the bucket as the process that handles packets. Trying to distinguish packets without connection state is like trying to identify which pipe opening a particular bit of water in the bucket came from.</p>\n<p>That’s why TCP maintains separate connection states — A’s connection with B, A’s connection with C, and so on. To create or release these connection states, TCP goes through a special process called a handshake.</p>\n<h2 id=\"3-way-handshake\" style=\"position:relative;\">3-Way Handshake<a href=\"#3-way-handshake\" aria-label=\"3 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Let’s start by looking at how connections are created. The handshake for creating a connection is called the 3-Way Handshake — as the name suggests, it involves exactly 3 rounds of communication.</p>\n<p>Through this process, both endpoints exchange information like who they’re communicating with and what sequence number to expect for incoming data, establishing the connection state.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVR42nVUS0sbYRRNa9VYo1GTmBptm7bWRdqdTVtQkFqlUCK48Q+40EILgn/ArRvFjSt1o0hQioLvB4ggogZJIE3MS5OYd2JM1GDQwjg99+vE+mgG7sydjzPnu+fc+43I5/NxJycnXCKR4KLRKLe2tsatr69zR0dHbC2ZTHKxWIwLBAIsJ+z+/j7DbWxscMFgkOFSqRRns9k40fT09Ge32/3BbrdrDQaDdnBwkIXRaNTSmtPp/Li1tVU/Nzf3iXAWi+U9NrzGbW5uamkNG70bGBjQiXBJ6NbQ0PBod3c3l+d5FpTTmujvRc/CbLja2tpcAVdBtwKTyVQCiQmSc3BwcLm3t3eJnEeEu7q6SgRC8c7Ojgy4OElHtQyHnHChyclJKkxJhGJ4JwHQAS/CkOmHF34AIwCa29vbi4B5iMinjeGnjXAul4vhkEeBNYOwABjFteSRkRFFJBJRLi4uqvV6fU04HC6nNUFKbkYyPlSYzWbl8vLyC8KhQeVDQ0PKm5LFML74+Pg4BpILSD63Wq3nqOTy7OzMD8/kmQpBVBqPxyPpdPoCFaYhOY3u/j49PfXNzMw8zlTIJIPADsIwCElKAO8RSPmlUqlqGhsbK5uamqRogBRYC22EyjwUwAQh23hPck9PjxhdEw8PDxd1d3fLPR6PuK+vj0Ci+fn5b+Pj452Uw5IKzG7lysrKa5Bo4L0K36huSpYILw/ujkhmbWFhIR+PIoxHM0QkUWUa1THJ8J1JHh0dLbxVYRZCRgZ/5K2tra90Ol09CFywIwpCmghyKQ7J1nuS8WExJEvHxsYqent7nyEvbWtry8FJ+rq9va3HMfu5tLTUnNmE7Ojo6JACl6PRaPJudRmNkGLnFIaVdzgcV+jgldfr5bH7uVqt/lJVVVWAbkvwcUbFrVESpuAfIXU5FArZQRyCDB/GyAfyENatIHvb0tKipEbdsSYr4bWHVMGdYMDZ2dkfExMT3ylfXV2VYV0GK5729/e/RF42NTUl+x9h1gsjRR6V1NXVNUPJhd/v56HmigK/LzrLcZyce13Oegmm51F16KgJpO7Dw0Mn5tEBQi9Oi4HmFphywj9HlCHkWYLkPBFw9OeRV1dXK26GQFSMePMHzD+L1nW+DwIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way handshake\" title=\"\" src=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png\" srcset=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/69538/3way-handshake.png 160w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/72799/3way-handshake.png 320w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png 640w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/d9199/3way-handshake.png 960w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/21b4d/3way-handshake.png 1280w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Here, the initiator is the side that sends the connection request first, and the receiver is the side that receives it. I use these terms because either the client or the server can freely initiate the connection request.</p>\n<p>Let’s examine what each state means and what the <code class=\"language-text\">SYN</code> and <code class=\"language-text\">ACK</code> being exchanged represent.</p>\n<h3 id=\"closed\" style=\"position:relative;\">CLOSED<a href=\"#closed\" aria-label=\"closed permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADl0lEQVR42nVU3U9SYRymDxMLRRMlycrKvLDuiGqzjWW6tqabN/4L1FZX/gPe2oUfN1647CKdOVmT/AA/2ERFwjmnG6KAHEBBOQckD0iQth1Pz4sHE4t3+3He8/Kc5/09v9/zviK/38+xLMvt7+9zDMNwMzMz3OzsLLe3t5daI/+Fw2FuZ2cnNY9GoxxFUSmc2Wzmdnd3U7h4PM45HA5OpNPpXnq93qdOp1O1tLKi6u7pUXV1d6tW1tZUa1jb3Nx8ZrVan4+Pj78gOLvL9cRosaQwBGtZWlKRNWz0uKurq0GEISE/vFp9mddocniePwkyx5roZJDntROc6DLf05OBW1YqcwRcGfnJY02mwp8W8z5rMXNew/iR85vuKGox8wnrd3q1s7NQIBTHjMZi4CIE55vQHzlOcZYgbzeRxOSEUMzb7ZKfC3Mudn6OpkZHAq4RXSC6MM8krQs2x4cP+cBcROTyZOOFeQdrnqM9Y8B9Gw6w87OhhMVs4/3+PGBKTiUbtNoSnmHkqyZThXFwsIqn6VKD9lOJICUnLZngGJtNvjgyclf/+XNVnKJKv3z8KD8rWYzCF0R+/AgHafrQ4/Um7OvriVA4fBQ7OAio1WpZOkObzVa0F4kwyV+/Dt0UldzY2EgexOO/o7GYf3R09Go6Q3EoFJLAGk4aw+PxBND+HbwzsMmaQqGoqq2tvVlXVyddXl6WAms/wEawjo8EMLuwzYpWq82U3NraKkbXxL29vfktLS0yn88nbm9vJyCRXq9/OzAw8IbMJyYmyuDdm9PT0w9AUg2/KvCN4qxkifBy4bxF0msGgyEXj3ylUlkPESyyTFKCZByG3zFI7uvru5aRYRbCFBnqI2tqarrf0NDwHARulCMEQhqHgVQpAsnr/0jGhwWQLO3v7y9ra2u7jXlRc3PzJZyk14uLi4M4Zl8nJyfr05uQcmg0Gilwl6qrq69kdBmNkGLnOI4W73K5jt1u9/HW1hacQycqKipelZeX56HbEnycVpFhJcEFfwlJl4PBoBPEQcjww0Z+kAexvg6yR42NjXLSqHOlyUp4WkOSwblIAcfGxt4PDQ29I3Mjjh/Wi1GKWx0dHfcwvz48PFz8P8KsA5YiNSqsqamph5LDQCDAQ80xCVxfPG6ayNTU1D9dzjqEol8h2aGjqyD1bm9vb8KPLhBu4S5cIr4FppTg7yCuI2RZgsi5IeDIzSOrrKwsORsCUQHi4R/sy4j4AHHV7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way closed\" title=\"\" src=\"/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png\" srcset=\"/static/b234afd5db4ad276398327e6c8e1a562/69538/3way-closed.png 160w,\n/static/b234afd5db4ad276398327e6c8e1a562/72799/3way-closed.png 320w,\n/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png 640w,\n/static/b234afd5db4ad276398327e6c8e1a562/d9199/3way-closed.png 960w,\n/static/b234afd5db4ad276398327e6c8e1a562/21b4d/3way-closed.png 1280w,\n/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>No connection request has been initiated yet, so there’s no connection at all.</p>\n<h3 id=\"listen\" style=\"position:relative;\">LISTEN<a href=\"#listen\" aria-label=\"listen permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADfklEQVR42nVUTU8TURStIloUKEqhUlFRkQW6Q9QEEyJKTAwkbPgDLNBEExL+AFs2kG7YGNhAkNAY0LZ8WUOQQgukKUbpFy0tTGln+kELrW3AZBjPHVsEtC+5nTu3Z8675977noRhGD4Wi/HRaJTnOI6fnZ3l5+bm+HA4LMbov1AoxG9vb4v+7u4u73a7RZzBYOD9fr+ISyQSvN1u5yXj4+PPPB7PI4fDUbuyslLb19cnmsViqaXY+vr6Y5PJ9ESn0z0l3Nra2kNseIRbXFyspRg2eqBSqZokWPn0U19ff85sNucKgiAa+RST/Fn0vJQNV1NTk5vGldFP3urqahEkRknOxsbGgc1mO4AvwNiOjo6iNKF0eXm5GLgISUe2Ig4+4QJqtZoSUxChNBgM5gPoRC1YyPShFj4AOQC/t7W1FQBzFnaBNg5FIvZoLMa6XC6fHVj4wRhwIMwDpuRI8sDAQAmaopiamqoYGRmpYlm2lGJpKbkZyfOEM5kUS58+3Zp4964q8e1b6XuVSnFcshSFL9zZ2QmBZB+Sk1arNYnOHsTjcR9qJs9kKBgMl38uzHPJZdO+W6dJ2T+OpeLGhV8/jQuM4DdfzGQoSgaBA4QsCEnyNt45yP6hVCqrGhoartU8fy4T9HpZfP7rWsK44PPoNN4Nnda7uzjvTxoNFoExnpTc1dUlRdek/f39BZ2dnXKv1yvt6ekhkGRiYuL18PDwK/LNX6fKBIa5ZvmsvftFra4WwmHl5/f9yuOS89MvZ06PSCY2OTl5AY8CjEcjy3KxYDCUcrndKavNluK44K+9vTgzODh46USGWQhFMo1GI29pabnT1NT0BI1zoRxBnBaaCKpSBNNh/afL+LAQkmVDQ0Nl3d3dN+Bfbm1tzcFJerm0tDSCY/Zhenq6MbMJlaO9vV0GXE51dfX5E11GI2TYOYFhFZxO5yFm7HBzc1PA7smKiooX5eXleeh2Pj7OqDgxSukp+EtIXQ4EAg4QByCDwRgxIA8gbgXZ/ebmZgU16lRpshIe1ZAyOGUiUKvVvh0dHX1Dvl6vL0a8GKW43tvbexv+lbGxseL/EWZdGCmqUVFdXV0jlOz7fD4Bag7JcH3RWY7MzMz80+WsK13085QdOroKUs/W1tY67lInCDdxF67Q3AJTSvibsCsweRYjOVfTOLp55JWVlSXHLU1UCLv3G5OfidZiiQDBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way listen\" title=\"\" src=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png\" srcset=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/69538/3way-listen.png 160w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/72799/3way-listen.png 320w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png 640w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/d9199/3way-listen.png 960w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/21b4d/3way-listen.png 1280w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The receiver is waiting for a connection request from the initiator.</p>\n<p>The receiver stays in this state until the initiator sends a request. Since it doesn’t actively reach out, this state is called Passive Open, and the receiver is also known as the Passive Opener.</p>\n<p>In socket programming, after socket binding, calling the <code class=\"language-text\">listen</code> function puts the receiver into the LISTEN state.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Listen failed...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server listening..\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Once the receiver detects a connection request from the initiator, it calls the <code class=\"language-text\">accept</code> function to proceed to the next step.</p>\n<h3 id=\"syn_sent\" style=\"position:relative;\">SYN_SENT<a href=\"#syn_sent\" aria-label=\"syn_sent permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiElEQVR42nVUS08TURSuD7RooTxakIeKisSgu4oaISEixMRA4oaFWxbVRA0Jf6BbXEBwwUIpCyGGQJTGUsujvKQChTQ0qZU+KC10aGdaalvANsVkGL87tsjD3uRMT89897vnO/ecEXg8HjYcDrOhUIhlGIadnJxkp6en2c3NTT5G3gUCAXZjY4P3I5EI63Q6eZxer2e9Xi+P29nZYa1WKytQqVQPXS7XXZvNVrG4uFjR2dnJ29LSUgWJORyOe/Pz81UajeYBwVksljs4cB83OztbQWI46HZHR0e9AEtEHtXV1aeNRmMax3G8EZ/EBH8X+T2fCieTydISuALySDeZTFmQGCJyVldXd5eXl3fhczC6ubk5K0EoXFhYyAUuSKQjWx4Hn+B8AwMDJLF8Qij0+/0iAO2hcJi22e2U1WajwpEIAzM3NTVlAHMSdpYcjHpaUTN6ZWWFQs0o+H6QmkGYDox0X/JMd7eUM5vzTSpVie79uzLO6czTdr+RJqSkJSVjo9QM3Ojo6JW+vr4yXFBeV1dX/kHJwj2DITM69y3gG9fFXVpNdHnwYzQwNbEbn5+lvE+fSpIZgig7GAwysVgsjgxjkBzD7f7e2tryqNXqc8kMhZzFIvqln7ExE+O0e1hDOT6rNgLTk0x0Tv89fuNG2VBNTdHV2lrxqtEoRnks29vbFDJzE4NcL2QvHZM8pVAIObdbaFUqM97K5RLiz7W1EZBg7suX518/fHhG/E/DwwXo3aKxsbHrIClH7QuVSmXhQcmixJ8TR1skGXul1Z59LRBkeGWyup80Hab9/hiy4yVjGHjJPT095w9lmIJQoAXZlFotuf/kybWW+vqqTYZZ8QcCfhDSaHwaKwjJP45JxsZMNKq4t7e3oLW19RL87MbGxlOYpMcGg6EPY/ZxZGSkLnlIG8ohl8vFwJ0qLy8/c+iW0cxipL6DZuXsdvsebnBvbW2Nw+nRkpKSR8XFxemYEBE2J1UcaqVEF/wjJI3t8/lsIPZBhgfz6wG5D/EfILvV0NCQ39LSIjlSmpSE+zUkGRwxHjg0NPSyv7//BfF1Ol0u4rkoxcX29var8HMGBwdz/0eYcikUClKjrMrKyjooiVMUxUHNHjF8vsgsBzE5x2455UoU/QzJDjdqAqlrfX3dgX60g3AN07LoRt8Ck0fwl2E5MEkKI3IuJHDkyyMpLS2VHrQEUSbs5h+zi4w8rnD0PAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synsent\" title=\"\" src=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png\" srcset=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/69538/3way-synsent.png 160w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/72799/3way-synsent.png 320w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png 640w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/d9199/3way-synsent.png 960w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/21b4d/3way-synsent.png 1280w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator sends a connection request to the receiver, generating a random sequence number and including it in the <code class=\"language-text\">SYN</code> packet. From this point on, both sides will use this sequence number to create new values, verifying the connection state and packet order through mutual confirmation.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [S], seq 3414207244, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Capturing this with <code class=\"language-text\">tcpdump</code> — a utility that can capture TCP segments — we can see the initiator setting the packet flag to <code class=\"language-text\">S</code> (meaning SYN) and sending the sequence number <code class=\"language-text\">3414207244</code> to the receiver.</p>\n<p>Since the initiator is actively reaching out to create a connection, this state is called Active Open, and the initiator is also known as the Active Opener.</p>\n<h3 id=\"syn_recv\" style=\"position:relative;\">SYN_RECV<a href=\"#syn_recv\" aria-label=\"syn_recv permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADg0lEQVR42nVUTU8TYRCuH0hRoCAtlYqKih6QG6ImmDQiRGLkSLhzQBNNSPgDvXKBQAwn6IkQhCA1BYqINtXaIKRpSaX0kwJb6Lal0NJKAybL+szaIh/2TWZ3dvbZZ+eZmfcVMQzDRaNRbnt7mwsGg5xer+cMBgO3ubkpxOhdOBzm1tfXBT8Wi3Fer1fAGY1GbmNjQ8AlEgnO4XBwIo1G89Tn8z10Op3V8/Pz1b29vYJZLJZqirnd7kezs7OPJyYmnhBucXHxAX54iDOZTNUUw4/ud3d3vxBh5dJFqVSeN5vNWTzPC0Y+xUR/F90vZcJVVVVlpXAldMmxWq0FkLhNcpaXl/eXlpb24fMwtq2trSBFKJ6bmysCLkLSka2Ag0+4wMjICCUmJ0JxKBTKBdCFWrCQ6Uct/AAGAbS1tLTkAXMWlk0/Rj0dhPN4PAIOfghYGwhzgJEdSlar1TI0RT41NVU2NDR0l2XZYoqlpGSlJeNDmc1mk09PT98kHBpU3NfXJz8qWYzC529tbYVBsgfJu3a7fReZ7MfjcT9qJk1nCKLCSCQSTCaTe8gwCclJdPf3zs4Oo9VqL6YzFCSDwAlCFoQkZR3PQUj5qVAo7tbW1l6tq6uToAGSUDi8GE8k/B6vd4UsGottoPiWU5JVKpUYXRP39/fntbe3S1dWVsSdnZ0EEk1OTr56Nzj4knzz+/clu1brVcvo6J3PanUF73AoPr19qzgqOTf1cObkiKRjup6ebNzymior62Nf9dGg/nPSO6FNOj6MJdkvM79/zZoYfmHh0rEMMxCK3Dpdtkqrleqam2+bGxoex78ZPGGDPuTTjbMe7QcW5JGEyWjnGea4ZJ1Olw/JkoGBgZKOjo7r8AtFTU3nvms0zx0/fgxZjMZR48eP9YTl3e5sBuXoaG2VAHdOVVFx4ViX0QgJRiaBYeVdLtcBOnjgW13loyy7+7Os7BlfWpojUypz8XFaxbFRSk3BP0LqciAQcII4gMFmMEbMss8X2AyF7PWlpZW1jY1yatSJ0mQkPKwhZXDCBOD4+Pib4eHh1+TPzMwUIV6EQ+VaV1fXLfiXx8bGiv5HmHFhpKhGBTU1NfVQsuf3+3moOSDD8UV7OYKdc6rLGVfF36JfoOywd60g9a2trblxlrpAuIrdMk9zC0wx4W/ALsOkGYzkXEnh6OSRlpeXy45aiigfdu8PYW6M66s3vdgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synrecv\" title=\"\" src=\"/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png\" srcset=\"/static/5bd44caabf2f0d8fa07c3974a108337d/69538/3way-synrecv.png 160w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/72799/3way-synrecv.png 320w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png 640w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/d9199/3way-synrecv.png 960w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/21b4d/3way-synrecv.png 1280w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p><code class=\"language-text\">SYN_RECV</code> means the receiver has properly received the initiator’s SYN packet.</p>\n<p>The receiver then creates an acknowledgment number — confirming it received a valid sequence number — and sends it back to the initiator. This acknowledgment number is <code class=\"language-text\">initiator's sequence number + 1</code>.</p>\n<p>Creating this acknowledgment number isn’t complicated. As I discussed in the previous post, when actually exchanging data over TCP, the acknowledgment number is calculated as <code class=\"language-text\">peer's sequence number + bytes of data sent by peer</code>. It’s essentially a marker saying “I’ve received up to here, so send from here next time.”</p>\n<p>But during the handshake, no actual data is being exchanged yet, so there’s nothing to add to the sequence number. However, using the same sequence number back and forth would make it impossible to distinguish packet order. So they simply add 1.</p>\n<p>We can verify this with tcpdump as well:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.receiver > localhost.initiator: Flags [S.], seq 435597555, ack 3414207245, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The receiver’s packet has the flag set to <code class=\"language-text\">S.</code>. The <code class=\"language-text\">.</code> means the <code class=\"language-text\">ACK</code> flag field in the header is set to 1, indicating this packet contains a valid acknowledgment number.</p>\n<p>The receiver is sending the acknowledgment number <code class=\"language-text\">3414207245</code> — which is the initiator’s sequence number <code class=\"language-text\">3414207244</code> plus 1.</p>\n<p>We can also see the receiver generating its own random sequence number, <code class=\"language-text\">435597555</code>, and sending it along to the initiator.</p>\n<h3 id=\"established-initiator\" style=\"position:relative;\">ESTABLISHED (Initiator)<a href=\"#established-initiator\" aria-label=\"established initiator permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADgklEQVR42n1US0sbURQea6OJxvcjVgVLKy4CUtGmLaUQGumituAqG3+AiK0b/QFZiSC4EHQhVgSfVVDUJDagrYnRaK1Ym0ajSTSaTN4m8UFjsxin302TEKX2wpk5995vzj3fd84dym63X56enl4FAgHG5/Mxi4uLzPLyMuN2u5lgMBgxr9fL0DQd8YFlDg8PmaWlJUaj0TD4PrJ+cXHB7O3tMdTMzMxLAJ4aDIYnW1tbot7e3ohtbGyIABCZTKZna2trLxQKRRynVqvjuNXVVRFZw0GPMX9DYfDJQywW3+3r6+OwLBuxzc1NDlmj/g7yTo/hyF4irqamhhPFCcgjbX19PRN0PYQ6sgjv7u6GIcHV2dmZp729vQCYZBhPq9XmAOcCxTgOPgvzqFSqXGAIluJtb2+nQycDgrjNZrPdaDTa/X6/GwcYOjo6coBJgnGxngGcnuD29/cjOOIjoGF+fj4TmLw45YGBgQIUQgCx709PT1dA5MKhoaHCKBVOjDLB6fX6CG58fLzCYrEU9vf3CxIpcyEqHyfRLpcrfHBw8GtnZyeE4L8R1NHc3FwUzTAVemWdnJzYQqFQGExCoBwCJgxpaByQHcswTtnj8bgRkFChMXeB8k5VVZVQIpGU1NfXZ6+srBDK38/Pz2lkZiUGujTk+UH2rlGWyWRcq9XKRRtltLa25hMfa2lkT6lUNo2MjDQRf2pq6p7NZitBRuWTk5NCFKl4bGysOJEyPzpJutkisbXu7u5UvDIqKytrnU6nD0wuY5QhTZhknEj5fwGpwcFB7sLCQl5DQ8ODurq65whgBG0vpHGi0i7MfdDfSFrvWkDT8HAmywayvvb0FH1oaytD02azUmny3Nzca51O9xHXcQq99opg0SKpXV1dvMbGxizgkoVCYcq1KrMQ9EyrDhyp5lmTfPbKDLPC935euGyorn5LUaU8qVjMx8cxFtdaCeNOYkAeiyoHNeqfR5+ULot81maRz9msKqUzoPlitIoeVeklEoG0paXghjS3BoxrSDJINFSRXDlKI5e/105MvCO+SqfLxV4eaJd2dnY+hJ87Ojqa/6+Atw6pTJbSSFFZlyJRrd/huLDRNIuiXBFzOBwsqhwg9/xmlW8d0b9JCqtQ5AT9/m9oncPj42MT+nEfvhW3ZZPc81jAMhj5U+TfYgRUFMVFeq28vLwg0aJ/GdI2wj/W6IuG9QJJxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established client\" title=\"\" src=\"/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png\" srcset=\"/static/71081fa52243d495fece15995bd54306/69538/3way-established-client.png 160w,\n/static/71081fa52243d495fece15995bd54306/72799/3way-established-client.png 320w,\n/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png 640w,\n/static/71081fa52243d495fece15995bd54306/d9199/3way-established-client.png 960w,\n/static/71081fa52243d495fece15995bd54306/21b4d/3way-established-client.png 1280w,\n/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator can verify the connection was properly established by comparing its original sequence number with the acknowledgment number from the receiver (<code class=\"language-text\">my sequence number + 1</code>). If the difference between its sent sequence number and the received acknowledgment number is 1, it confirms the connection is valid.</p>\n<p>The initiator then enters the <code class=\"language-text\">ESTABLISHED</code> state. It takes the receiver’s newly generated sequence number, adds 1, uses that as its acknowledgment number, and sends it back to the receiver.</p>\n<p>So the initiator’s acknowledgment number should be <code class=\"language-text\">435597555 + 1 = 435597556</code>… but tcpdump showed something different from what I expected.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [.], ack 1, win 6379</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCBQb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABWi/YjmxwZ//EABoQAAMAAwEAAAAAAAAAAAAAAAECAwAEExL/2gAIAQEAAQUCWY881M+a5rKGCzQZtzVa/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BiP/EABsQAAICAwEAAAAAAAAAAAAAAAABESECEEEi/9oACAEBAAY/Asr5ro5Uj8opRR//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMUHw/9oACAEBAAE/IacrYwEBHs+TEgqPsUrwgQrNsn//2gAMAwEAAgADAAAAEGAf/8QAFhEBAQEAAAAAAAAAAAAAAAAAACEB/9oACAEDAQE/ENRX/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQBx/9oACAECAQE/EELbv//EABsQAQEAAwEBAQAAAAAAAAAAAAERACFBMVHw/9oACAEBAAE/ECaIzaEBEwiQHmL93iWhk/OY5kgRZj8a+ZTd5g8g2JC15n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"why\" title=\"\" src=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" srcset=\"/static/0d802ed236b13cf140bc5d184c65e2a3/0913d/why.jpg 160w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/cb69c/why.jpg 320w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Why is it showing 1...?</small>\n</center>\n<p>The initiator’s final acknowledgment number, which should have been <code class=\"language-text\">435597556</code>, somehow became <code class=\"language-text\">1</code>. <em>(Confused…)</em></p>\n<p>This is actually not TCP’s own behavior but a <code class=\"language-text\">tcpdump</code> feature. <code class=\"language-text\">tcpdump</code> shows sequence numbers as “relative positions” to make them easier to read. Capturing data exchanged between the two endpoints afterward makes this clearer:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [P.], seq 1:81, ack 1, win 6379, length 80: HTTP</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The real acknowledgment number would be <code class=\"language-text\">435597556</code>, so the first data packet’s sequence range should be <code class=\"language-text\">435597556:435597637</code>.</p>\n<p>But since it’s hard for humans to keep analyzing such large numbers, tcpdump shows the acknowledgment as <code class=\"language-text\">1</code> and starts subsequent sequence numbers from 1 for readability. <code class=\"language-text\">1:81</code> is certainly easier to read than <code class=\"language-text\">435597556:435597637</code>.</p>\n<p>But this is just tcpdump being helpful — the actual values haven’t changed. Using tcpdump’s <code class=\"language-text\">-S</code> option disables this feature and shows the original numbers:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> tcpdump <span class=\"token parameter variable\">-S</span>\nlocalhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">435597556</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"established-receiver\" style=\"position:relative;\">ESTABLISHED (Receiver)<a href=\"#established-receiver\" aria-label=\"established receiver permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYUlEQVR42nVU3U9ScRimTMX8QAUk0crKvKAu3Izqws1lWlvTzRv/AS+srTY3/wEu88bNG67UC3WOyVpuighYjM3hB3OwESj4AQz5FlEkSduOp+c9gfkRv+095z0/nvP83ud53wPP7/czBwcHTCKRYCKRCGM0GhmTycTs7e1xe/RbLBZjAoEAlx8eHjLb29scbnFxkQkGgxwulUoxGxsbDG96evq1x+N54XK55BaLRa5UKrmwWq1y2tvc3Hy5vLzcrNFoXhHO4XA8x4HnOLPZLKc9HPRsaGiog4dVQpeWlpZba2tr+SzLckE57fH+LroX58I1NTXlZ3DVdCmy2WzlkJggOTs7O6fr6+unyFlEuK+vrzxDyF9dXRUCFyfpqJbDISdcSK1WU2ESIuRHo9ESAN3wIgyZu/BiF8AIgPaenp5SYG4iCulg+LlBuK2tLQ6HPAqsHYRFwIjPJY+OjorRFMn8/HydSqVqCIfDVbSXkZKflYwXxXa7XaLX6x8QDg2qGh4ellyUzIfxZfv7+zGQnEDysdPpPEYlp0dHR7vwTJStEEQV8Xg8kk6nT1BhGpLT6O7vZDLpn5mZuZ2tkJMMAhcIwyAkKQE8RyDlh1QqbWhtba1pa2sToAECYB10ECrzUgAThGzrNckKhYKPrvFHRkZK+/v7RV6vlz84OEgg3tzc3IfJycn3lMOSasxujcFgeAwSGbyX4h3pRcklmYcbV0cku6fVagtxK8V4tEPEAapMozpOMnznJI+PjxdfqjAHIUcGf0RdXV2POjo6mkGwBTuiIKSJIJfikOy8JhkvlkGyYGJionpgYOAe8oru7u48fEnvVlZWVPjMvuh0uvbsIWRHb2+vALg8mUxWcKnLaIQAJ6cwrKzb7T5DB898Ph+L04/r6ure1tbWFqHbJXg5q+LSKGWm4B8hdTkUCrlAHIIMP8bID/IQ9p0ge9rZ2SmhRl2xJifhuYdUwZXggLOzs5+mpqY+Uh5Y+CpkkwGhRam8O/lZ8ZBlDyvXx8aE/yPMudQKBXlU/gZdTpiMJ36DjvVoNWcUwW8G9ueSOQ5/rnU558qYXkCV/FpZskW+L3gCet1m0KB3R4wLvpPVZQvNMDBVhL+PqESIcgTJuZPB0T+PqLm+XsxFY6O4EfcMURniyR8gPYl1Eyx9hwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established server\" title=\"\" src=\"/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png\" srcset=\"/static/be47dca10f68741755f229c81dba5895/69538/3way-established-server.png 160w,\n/static/be47dca10f68741755f229c81dba5895/72799/3way-established-server.png 320w,\n/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png 640w,\n/static/be47dca10f68741755f229c81dba5895/d9199/3way-established-server.png 960w,\n/static/be47dca10f68741755f229c81dba5895/21b4d/3way-established-server.png 1280w,\n/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Just like the initiator, the receiver checks that the difference between its sent sequence number and the received acknowledgment number is 1. If so, it considers the connection properly established and enters the <code class=\"language-text\">ESTABLISHED</code> state. At this point, both sides consider the connection safe and reliable, and full communication can begin.</p>\n<h2 id=\"4-way-handshake\" style=\"position:relative;\">4-Way Handshake<a href=\"#4-way-handshake\" aria-label=\"4 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Just as creating a connection requires a special process, terminating one does too.</p>\n<p>You might ask “can’t we just cut the connection?” — but if one side unilaterally disconnects, the other side has no way of knowing whether the connection was terminated or is still alive.</p>\n<p>There might also be unprocessed data before the connection is terminated, so a process is needed to confirm both sides are ready to properly close the connection.</p>\n<p>This process involves 4 rounds of communication, which is why it’s called the 4-Way Handshake.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEFElEQVR42pVUSUtbURSObaMxxiimMYNtBbHQZldstAsXLYoItW6KqxakpQjFghURdOUv0I1uxAkRxAFxFkVExVnEBquJcYqkMYnGOMShPvHl9TuvLzZxKO2Fm3tyc3Lu/YZzRVarld3f3+enzWZjh4eH2ZGREXZ3d5fd29vj93d2dvjfKD44OGDX19fZoaEhdnR0lN+nvOPjY9ZoNLKi9vb2lI2NjaTFxcXE2dlZfVNTk762tlY/Pz+vX15e1q+srLyYmppK7unpeeXLm5iY0Dc0NPB5FBsMhiQc9LysrOyNCCOcPkpKSu5xHCf2n7Qn+j1oDbstLycnRyzkaelDCggRDodj12QyeZeWlhjcjDGbzZzb7Xbm5eVFCgUlgKRAnht5BI/BygAB5W11dXVJkaOmgqHb29syJBo3Nzcda2trP2gidoKb74WFhYTgDmaIxWKJtNvta1hdyHGsrq46ELtdLtdSX19fCHJUl5Db2to0uH7M5ORkfEtLiw6xlvYEKGIf5Lq6Ogl+k4BDeVFRkQJxSH5+fqg/5FBcPRynOKD4GSCc4PsJSGYwbRkZGfcpSalUyoQ/BV09REDwpyCUkzmdTjOg70BJO6YDFnGBG1NsbOwTlUoVnZWVFfGvBcP9N0kxnU7H3wbQ79La0dHxrqqq6j3FMzMzBFMBuz2ETeIQR9XX1ytuKhh01SK+PVglmPISExNfQ5RzCMjBGV4I4gUqDqZ24XDiMfqfCiJZJpVK1SkpKc9Q0Ayut6AyUbOF4QQ1BtAWHKByf39/FEGBsg8ICgSJGhwc5KHAY4Uo+sGfBoFDqRDfDRAFysrhuUP0LEcwcLr39PSUDHsCQV7Gx8fL09PT5cKfROh3CdqxAOvXK+h+FwQnYVDZCD7sKGiFqa1kIzwQi8nJycorthHhAiG9vb2fmpubP95U0Mfh38alRQYGBqI9Ho+yoqJClpubqzg6OopubGxU/VdB2IgIF5eXl2tR4ASDw7PlBTKeGoZhXKWlpddUvmnwUKqrq8M1Gs2j1NTUp+D5O+ghWixQ2QKabOB67prKaG4lkjTwlJomXhMN3jr+xNbW1o94J99SDCfwDZCQkOCvckCnSKanp+WHh4ceMikpjFfEi+8clP8JMdKQEwy1w4SCQX4FfW9kYC/DnFJAGQMnCyj4DdMAhRcwx9RqtS4zM1NbXFysvKGXpbf2MnpVRTBh5jg8UU8ohon5B7Ozs/ML4s8Uj4+Pa9EpMd3d3Y9ramp0sJcWva4NgEzGhnoelmU5JPOQKT4/P9/Lzs6OFG4VgV5OAw3MxcXFZR4o4M7OzgJ6mYcM/ibxZBmh3AIafwGxCXOsoKAgzPdiV1ZW3kfeNIr65y1D5dG5uTmxT2W5cIPbJl9MoOZvOTzkX+JaE9Cfxie/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way handshake\" title=\"\" src=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png\" srcset=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/69538/4way-handshake.png 160w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/72799/4way-handshake.png 320w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png 640w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/d9199/4way-handshake.png 960w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/21b4d/4way-handshake.png 1280w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Again I’m using the terms initiator and receiver — just like with the 3-Way Handshake, either the client or server can initiate the disconnection.</p>\n<p>The side that originally requested the connection might initiate the termination, or the side that originally received the connection request might be the one to initiate termination this time.</p>\n<p>Developers tend to be more sensitive about the 4-Way Handshake than the 3-Way Handshake. If something goes wrong during connection creation, you can just retry. But if something goes wrong during the 4-Way Handshake — which terminates an already-established connection — the connection remains stuck.</p>\n<p>Moreover, unlike the sequential back-and-forth of the 3-Way Handshake, the 4-Way Handshake includes waiting periods where one side waits for the other to respond. If anything goes wrong in between, both sides can end up just waiting for each other — a deadlock.</p>\n<p>Of course, depending on configuration, a timeout might kick in after a certain period, forcing the connection closed or advancing to the next step. But during that time, the process is still occupying memory and a port, so for high-traffic servers, this can always cause bottlenecks.</p>\n<h3 id=\"fin_wait_1\" style=\"position:relative;\">FIN_WAIT_1<a href=\"#fin_wait_1\" aria-label=\"fin_wait_1 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEWklEQVR42pVV3U9aZxw+XSfSARpkioy0yVy6rmb2xuGMmTE28WYzbF6QLE22XdUba3bVxO3G/8BE442hkRjiF1anxTHNqqCi25zR1Vik8iHfB1FRURGmh7PnPT0YdGxzb/LC77w85/d7n+f3AeX3+5m9vT1uE3t6epqxWCzMzs4OE41GufOtrS0mEAhw9sHBAeN0OpmpqSlmdnaWCQaDzP7+/unR0RG7vb3tpcbGxu673e6P7Xa7an5+XjUwMKDq7u5WLS8vq8jZxsZGpdVqrR4fH68luLW1tQoEVOn1eg5H3iG49fX1qsXFRRWFJSYfra2tb7Ism5O5yRn1euVgi4jR2NiYcxlXU1OTxnHfQpvNJqNpeh9RGNhJREziZuzu7m5ArVZLysvLicNcl8slJzhgOBzwCdAnuE2NRkMudp04zIVW+SGadrjcbtrhdPkdTqd/0+PZ2o1GV+rr69/igQLoKAuFQptYEYfDEcamYUeh9wqCEty1c8pLer2CPT5WvjQ+vW3Rau+yvlfK33S64gzK5AVKp9MJQVMIDfNaWlpkxIY0wkzKuezcnDQ2N7PjnfwpsfFsNG4f/eF4zzr759GC1bv/4DMpiSznNUzfIjNIxhnvcGkp/2DO4g5PP494TD/SvgkTvTc/tx2bn11LKJW3h0tKiso1mvyrOhTzD29w1Lu6curu3eNuozEYOJF/NRq/ft7V9SWxn5nNb4OmzGAw3Oro6HgXdgFKSprNYWaUC/TgWPCYoiTe6urPd8Lhs2AoxLpdrpTH42EikQgbj8cDdXV1ogtJ+TeHo0+eSPBV/L1a/REdDDpRAUGUUAiFDt+hLXTQYmVl5Y0LDicmJgoIlf7+/pttbW0lpETIGfkN3fTdU4PhK2IbeBmIhgqFIntSvF6vFLUYR8+yqKsUijV1cnLCgs6hWCz+pKKiIo8UOP8StbCwcAP78czMzCPq4nrtENfPD4fDG9ikan0I4EWx0mj2F2VlZVL+BmkZKGCESETj0NDQN9kciqn/Xue9DPryWCxW2NnZKW5qapIdHh4WQYZCHnf9Sg5LS0sFJHpPT88tjKkEnLDQOIW+ZhKJBHt6ehoARnw5y9kWB2hvb8+TSqU3GxoaPoSuNkjjRclsIsub0D0I/Rf+luXh4eEigBS4QTHZmCaKycnJIvIbtHrY29v7BbFRCVwD8BMoe5YxNAugSxyRWSQohdGVIrSQlGORSHSfTBq5XC7iHV677DB9dj4P8aIEVH6BJi/gcAVl8wdorCLTFoFAcAezTtnc3Fz4v3pZq9XKCWWTyfQeRtQHhLKOH19Go/HbwcHBh3wNKn0+n3JkZOR9JOkuLvOO2WwuzswyRxkUT87OzliAUxicKSw2mUxGqqqqJJh3RLe82traT8kfEhaLUiUNwIAuwQXwN3CeZY4ysrUImjZkbhW0V9GfdjybARSmJ3ZfX58cuN9x/jID9wrPP/M4LmES3vM/bQLKvSJO8BeWZwg1dMYKUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait1\" title=\"\" src=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png\" srcset=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/69538/4way-finwait1.png 160w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/72799/4way-finwait1.png 320w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png 640w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/d9199/4way-finwait1.png 960w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/21b4d/4way-finwait1.png 1280w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator — the side wanting to terminate the connection — sends a FIN packet to the other side and enters the <code class=\"language-text\">FIN_WAIT1</code> state.</p>\n<p>The FIN packet does include a sequence number, but this time it’s not randomly generated. The 3-Way Handshake needed random initialization because there was no existing sequence number. This time, since sequence numbers already exist, the initiator simply uses whatever sequence number is next in order.</p>\n<blockquote>\n<ul>\n<li>Initiator ---<strong>SEQ: 1</strong>---> Receiver</li>\n<li>Initiator &#x3C;---<strong>ACK: 2</strong>--- Receiver</li>\n<li>Initiator ---<strong>FIN: 2</strong>---> Receiver</li>\n</ul>\n</blockquote>\n<p>Think of it as just changing the FIN flag to 1 and sending. The meaning of this flag is basically: “I have nothing more to say.”</p>\n<p>Since the initiator is actively initiating the disconnection, it’s called the Active Closer, and this state is called Active Close.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [F.], seq 701384376, ack 4101704148, win 6378</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>But when I captured the initiator’s termination request, the flag wasn’t <code class=\"language-text\">F</code> but <code class=\"language-text\">F.</code> — meaning <code class=\"language-text\">FIN+ACK</code>. Looking at other blogs that captured packets with tcpdump, I could see most people encountered the same situation.</p>\n<p>Theoretically it should be a <code class=\"language-text\">FIN</code> packet, so why is it being sent as <code class=\"language-text\">FIN+ACK</code> with an acknowledgment number bundled in?</p>\n<h4 id=\"the-half-close-technique\" style=\"position:relative;\">The Half-Close Technique<a href=\"#the-half-close-technique\" aria-label=\"the half close technique permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The reason the initiator sends a <code class=\"language-text\">FIN+ACK</code> packet is the Half-Close technique. As the name suggests, instead of fully closing the connection when terminating, you only close half of it.</p>\n<p>When using Half-Close, the initiator includes an acknowledgment number in its initial <code class=\"language-text\">FIN</code> packet. The meaning is: “I’m going to close the connection, but I’ll keep my ears open. I’ve processed up to this acknowledgment number, so if you still have data to send, go ahead.”</p>\n<p>In other words, “closing half” means closing only one of the two streams — the send stream — while keeping the receive stream alive.</p>\n<p>The receiver can then send any remaining data, and the initiator can process it using its still-alive receive stream and respond with <code class=\"language-text\">ACK</code> packets. Once the receiver finishes sending all data, it sends a FIN packet back to the initiator, signaling that all data has been processed.</p>\n<p>Then the initiator closes the remaining half, terminating the connection more safely.</p>\n<p>In socket programming, you can use <code class=\"language-text\">close()</code> or <code class=\"language-text\">shutdown()</code> to terminate a connection. Using <code class=\"language-text\">shutdown()</code> enables Half-Close.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> SHUT_WR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If the initiator uses <code class=\"language-text\">close()</code>, all streams are destroyed immediately as the socket’s resources are returned to the OS. So even if the receiver belatedly sends unsent data after receiving the FIN packet, there’s no way to process it.</p>\n<p>In the example above, passing <code class=\"language-text\">SHUT_WR</code> as the second argument declares that only the send stream will be closed first.</p>\n<p>For more details, search for “Half-Close” or “graceful shutdown” — there’s plenty of material available.</p>\n<h3 id=\"close_wait\" style=\"position:relative;\">CLOSE_WAIT<a href=\"#close_wait\" aria-label=\"close_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAESElEQVR42pVVXUhbZxg+rjXGJVFipkkWWpijayvTG5dMZEMsvRri5oWwm3W7qTdOSikFd+VF76WCDIqiiMSfiEJmlkWcJrpouxS0FRf/8/9jEo1RE02qJ2fPd3q0x5Bt7oMv58uX57zf9zzP+76hvF4vvbe3x06ynp6epi0WC72zs0NHo1F2PxQK0T6fj13v7+/Tm5ub9NTUFD07O0v7/X46FoudxONxJhKJuCm9Xn/H4XB8vrq6qp6bm1MPDQ2pe3p61AsLC2qyt76+XmW1Wr80GAy1BLe8vKzBger+/n4WR94huJWVlWqbzaamMMTko62t7SrDMLn8SfaotyMXU0QWTU1NuZm4mpqaMxz7FNrtdlkwGIzhFBrrFE5M4WbM7u6ur76+XlJZWUkC5m1tbckJDhgWB3wS9AnO2djYSC52hQTMg1aFgUBgA5SCAHg3Nja8LpcrBOBiXV3d+xxQAB1lwDkxwsBsYwaxjkLvRRxKcDnnlEdHR5W4vgr63BgbG7udSCRUOp1OwaNMXqB6e3uFwAmhYUFra6uMrCGNkE85z+12S8Ph8A6eybW1tSNQScC5N3DVXV5eLuVOFnEv5WQewtt7GxDaFCI1HNvb22Gsg4Q6AkZAZVkikdwoLS0tgUaFlw0o5r68d+ZiRUUFextQZkUeHx+/1/3s2bdk7f9F+wEDLSefPr2ue/LkIyYWK1rSaqXZAvJPuUAPgQV4SH7QaL6OzVhO/b9PMg6jIe0yGenIjJl58/JP36tHj0QXTPm3gI+7uyW9FKVw3737WdQyvekxGf1OoyHg+u1Xf2BqMhR/brV5Hj7MvxDQZDIVwTHZ4ODgtfb29tJ90NJhj/z2h17/06xO9x1fBqKhUqnMbgpxGbl4BGMY5FUauZhOHB8z8XD4cEss/sKo0RTcRIJzL1HzHk++9cWLx+aZmR+pi+Ody3B4HZNkrQcHuOFwcC8Sef0zlzbydzJQwAhR200jIyPfZwsopv5jVPJqGc1EfnBwUNzZ2Slubm6WHR4elkCGYg565VIBy8rKiMtX+/r6rqNNJREEmeNLo67pZDLJnJyc+IARZ7qcbbCAjo6OAqlUeq2hoeFTVJQd0rhR604UgBO6+6H/fFVVVX5mLZcApMQNFGSimygnJiZKyG/Q6r5Wq/2GrJEJbAFwHSi7y2iaRdDlCCczMCiN1pUmtNCBEyKR6A7pNHK5XMQFzMkMeLZ33g/xogRUnkOT1wi4iLR5BRpLcNoiEAhuoo5VLS0txf+rlru6uuSEstFo/Bgt6hahjKeCq+UHw8PD99kcnJ9XeTweFVrcJzDpNi7zodlsVvBdZimD4vHp6SkDcBqNM43BpFKpcHV1tQT9juhWUFtb+xX5Q8JgkKqkAGjQJTgf/gbOXWYpwy0baNrh3BJoL6EXruK7GUDhWcceGBiQA/cS+3/xcGv4PsnhWMMkXOR/mgSUd0mc4G+aEgkbh9qDcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closewait\" title=\"\" src=\"/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png\" srcset=\"/static/f08ce32e213678f2016221fe117de99c/69538/4way-closewait.png 160w,\n/static/f08ce32e213678f2016221fe117de99c/72799/4way-closewait.png 320w,\n/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png 640w,\n/static/f08ce32e213678f2016221fe117de99c/d9199/4way-closewait.png 960w,\n/static/f08ce32e213678f2016221fe117de99c/21b4d/4way-closewait.png 1280w,\n/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After receiving the <code class=\"language-text\">FIN</code> packet from the initiator, the receiver creates an acknowledgment number using <code class=\"language-text\">initiator's sequence number + 1</code> and responds to the initiator, entering the <code class=\"language-text\">CLOSE_WAIT</code> state.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.receiver <span class=\"token operator\">></span> localhost.initiator: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">701384377</span>, win <span class=\"token number\">6378</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Since the initiator sent <code class=\"language-text\">701384376</code> as the FIN packet’s sequence number, the receiver’s acknowledgment number becomes <code class=\"language-text\">701384377</code>.</p>\n<p>The receiver will then continue sending any remaining data, and once everything is sent, it explicitly calls <code class=\"language-text\">close()</code> or <code class=\"language-text\">shutdown()</code> to proceed to the next step.</p>\n<p>This means the initiator doesn’t know when the receiver will finish processing data, so it must wait until the receiver completes its work and sends back a <code class=\"language-text\">FIN</code> packet signaling agreement to close.</p>\n<p>If the receiver finishes processing data but the termination function isn’t explicitly called at this stage, the connection can’t advance to the next state — creating the potential for deadlock.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVR42q2T2wrDIBBE+///GHKD3Bujxkg0yXTXktKXQohdmAdBjruz48N7DykliqJAmqboug5cx3FckhACShrMywbrdjyc37AsFsPwxDRJeDrTvctyzpE8/HaQGEgHpRTqukbTNNBa427t+xewbdswNoPPkW8DtZ5p5CEAGfwHoA7ALMtQVVU8UBGQOyvLkhYzxXvIHfJC2L88z9H3ffxSGMhKkgTGmBigCx1yoM8u7/j3AVprQ6AZeEaHH+Af9A7tb63rinEUQew9s15AXl7Gmc11bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"deadlock\" title=\"\" src=\"/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png\" srcset=\"/static/0bd0fc4fa229c60f0980e590aafde785/69538/deadlock.png 160w,\n/static/0bd0fc4fa229c60f0980e590aafde785/72799/deadlock.png 320w,\n/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png 640w,\n/static/0bd0fc4fa229c60f0980e590aafde785/d9199/deadlock.png 960w,\n/static/0bd0fc4fa229c60f0980e590aafde785/21b4d/deadlock.png 1280w,\n/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png 1356w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Google's autocomplete suggestions speak to the pain of developers caught in deadlocks</small>\n</center>\n<p>Since the receiver only passively prepares to close after receiving a termination request, it’s called the Passive Closer, and this state is called Passive Close.</p>\n<h3 id=\"fin_wait_2\" style=\"position:relative;\">FIN_WAIT_2<a href=\"#fin_wait_2\" aria-label=\"fin_wait_2 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEPElEQVR42pVVTUxjVRR+OEPp2D5IqaWtzUwizowOETZYJERCmISNQ1AWJG7U1bBhiCsTXHXpGsIsCARCCARKICEwIFHoj4XROgGnwfL/0/8foJSfdlrh9fmdNw8sWBVvcvtO7/vuufc73znnMR6Phzs4OBAm2bOzs5zZbOb29va4SCQirIdCIc7r9Qr24eEht7Gxwc3MzHBWq5Xz+XxcNBo9PTk54Xd3d13M2NjYw62trY9WVlb0c3Nz+sHBQX13d7d+YWFBT2tra2vlNputcmJioppwS0tLZThQ39fXJ+BoD+GWl5cr7Ha7nsGQ04/BYLjJ83x2+qQ15vXIxpSR0djYmH0VV1VVdY4TnlKn06kMBAJRnMLBTuLEJG7G7+/ve+vq6tjS0lJymLO5uakmHDACDvgE6BNuu6GhgS52gxzmIFZ5fr9/HZQCAHjW19c9Ozs7IQAXa2tr3xSBEsRRCdw2RhiYIGYAdgTxXsShhMu6oDwyMqLF9XWIz73R0dEHsVhMZzQaNWmUaQPT09MjBU6KGOa2tLQoyUZopOmUc1wulyIcDu/hmVhdXY2DSgzK/QFVXcXFxQrxZJm4KevqIWlrrx0iNnlIja1gMBiGHSDqcLgLKkssy94rLCwsQIzyrutQLv5541zFkpIS4TagLAR5fHz8y46Ojs/JNplMb4GmEu/utLW1vQM7HymlyOQw/ZRL9LBZggdbWVn5KVicQRgeTFIQjkOo+Hg87q2pqZFdEuXfHHZ1dbF4aJBCH6IyNuDIB4d+hMYH5yHE2l5eXn7rkkO3sTOf9zqVlqdPb/cbDIW88xel+3tjPr1DNX2LW36RHgaKoVarzSwK73AoYs9t8aBpht+ZmkxtPhtPvbL/zEes5uP7KtXHd8vKcinBxU3M/Pz8LcxvLBbLE+byEB2+eJEX/cmyFpz90e+aeuZ2T0+59q3mwKHN8vK7R4+EtFH/FQYGySyFEI3Dw8NfZXIoZ/57XNQy6KuPjo5U7e3t8qamJuXx8XEBwqAScTeu5bCoqIhUvtnb23sHbSoBJzzKMIW65hKJBH96euoFRn5V5UxDALS2tuYqFIrb9fX1HyBNnEgdF5TehsrbKAgfesH831RGLRcApMUNNDTRTbTT09MF9A6xetzf3/8Z2UhkoQDEDpRZZTTNfMQljpOFhEXrShEtdOCYTCZ7SJ1GrVbLRIdZVx2er130Q2xkQeU5YvISDhfRwn4DDQdq2SyRSN5DHeuam5tV/6uWOzs71UR5cnLyXbSo94kynhqxlr8eGhp6LOagzu1269Di7kOkB7jM26hvTbrKAmVQfHV2dsYDnELjTGHwyWQyXFFRwaLfUdxyq6urP6EPEgaPVpeijxXoEs6Lz8CFygJlqGUHTSeUc4C2A/W5gv8mAKXnHXtgYEAN3K9Y/z0Nt4r/P4g4QTBW9PxPk0A518RJ/gTqwAStpoJTXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait2\" title=\"\" src=\"/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png\" srcset=\"/static/608e421d25ac8fa76021750f0110bed6/69538/4way-finwait2.png 160w,\n/static/608e421d25ac8fa76021750f0110bed6/72799/4way-finwait2.png 320w,\n/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png 640w,\n/static/608e421d25ac8fa76021750f0110bed6/d9199/4way-finwait2.png 960w,\n/static/608e421d25ac8fa76021750f0110bed6/21b4d/4way-finwait2.png 1280w,\n/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>The initiator receives the acknowledgment number from the receiver and verifies that the difference between its sent sequence number and the acknowledgment is 1. But since the receiver might not have finished sending all its data, the initiator enters <code class=\"language-text\">FIN_WAIT2</code> and waits for the receiver to send a <code class=\"language-text\">FIN</code> packet granting permission to close.</p>\n<p>As I explained in the <code class=\"language-text\">CLOSE_WAIT</code> section, from this point on the initiator keeps waiting until the receiver sends a <code class=\"language-text\">FIN</code> packet.</p>\n<p>Unlike <code class=\"language-text\">CLOSE_WAIT</code>, however, it doesn’t wait indefinitely. If a timeout is configured via kernel parameters, the connection can automatically advance to the next step after a certain period.</p>\n<h3 id=\"last_ack\" style=\"position:relative;\">LAST_ACK<a href=\"#last_ack\" aria-label=\"last_ack permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEQElEQVR42pVV30+aVxj+ulbEARpkCoy0yVy6rWZ6Q7HGzBibeLMa543JbrZd1YtmZunFEnvlf2Bal10YrcaY+jOaGC3RrQIaoClmao1DBRT5JfJDRRGQjY/T53x+WrS2cyc5nPc73/O95zzv874vjMfjYff29rhJbZ1OxxoMBjYcDrO7u7vcfiAQYL1eL2fv7++zDoeDnZ6eZmdnZ1mfz8dGIpF/Dw8PSSgUcjFjY2N3NzY27qyurmpMJpNmYGBA09XVpZmfn9fQPZvNVm40GisnJiaqKW55ebkMB2p6e3s5HP2G4lZWViosFouGwRDTn5aWlmuEkKzMSfeY45GFKaJGY2Nj1nlcVVXVCY5bhVarVeb3+yM4hYWdxIlJ3Izs7Ox46+rqJGq1mjrMXl9fl1McMBwO+CPQpzhnQ0MDvdhV6jAbscrb2tqyg5IfAI/dbvdsbm4GAFyora39mAcKEEcZcE6MIDDbmH7Yu4j3Ag6luCunlEdGRpS4vgrxuTk6OnorFouphoaGFBmU6QdMd3e3EDghYpjb3NwsozZCI8yknO1yuaTBYDCM9WhtbS0OKjEo9w9UdZWUlEj5k0X8R1fOH5Kxd+wQsclDamxsb28HYfspdTgMgcqyRCK5WVRUVIgY5V3WoZh/+OhExdLSUu42oMwFeXx8/Mf29vbvqa3X6z8BTRne3Whra/sMdj5SSnqRw8xTztDDxwIsksrKyu/AIgVhCJikIRyLUJF4PO6tqakRnRHlQw47OzslWBRIoduoDAcc+eBwC6HxwXkAsbaUl5fnnHE4OTmZT6n09/dfb21tLaIpQvfoO1TTI9zyh8ww0BgqlcqLRaEqIxfjEIYgr9LIxXQikSCgExWLxd+UlZXl0gTnP2LMZnMO5q8zMzM/M2fHW5URGxsmzVo3DnBBYT+K/fUFacPonU7hmFbbODg8/NNFDsXMf4/TWl7q65AT23yBHqX2W329jDgWC21DTwt43NVLOSwuLqYqXyOPH99Izb06OnhpIr4Xf6T9uhdsYu4VIYt/efUPHojPq/zOIDyg6cmT3N+l0uvk3r2vo8ZZa0A/7XJPPXe6Jp87wwad79BsMpsfPsw5X8uFSAclGqWCTnQT5cjUVCF9Zxwevq9/9qyea3OEcAWgVn9AZTTN/IODgzhE4RLWbrOlI9EoiYVCMZNIdBc3FTByORdDpNa7pfd277gfQk0JUuQlet1rOFxA2iwijZb2wmHDbYHgS9Sx6lFTU8H/quWOjg45pazVaj9Hi/qKUsaq4Gv5l8HBwft8DqrcbrcKLe6Lnp6eW7jMp6hvRabKHOVoNJpIpVIE4DQaZxqDJJPJYEVFhQT9jsYtt7q6+lv6h4RBkKq0AFiEgOK8+Bs4VZmjjCqxgKYV9bkE2kuoz1U86wEUnnTsvr4+OXBz2P87A7eG5z95HCeYhPf8vklB2ZfECd4A2pIHyYStE2kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way lastack\" title=\"\" src=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png\" srcset=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/69538/4way-lastack.png 160w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/72799/4way-lastack.png 320w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png 640w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/d9199/4way-lastack.png 960w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/21b4d/4way-lastack.png 1280w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Once the receiver has no more data to process, it explicitly calls a termination function and sends another <code class=\"language-text\">FIN</code> packet to the initiator — signaling agreement to the initiator’s earlier termination request.</p>\n<p>The sequence number in this <code class=\"language-text\">FIN</code> packet uses whatever sequence number the receiver is supposed to send next, and the acknowledgment number reuses the last one it responded with.</p>\n<p>The receiver then enters the <code class=\"language-text\">LAST_ACK</code> state and waits for the initiator to send back an acknowledgment number.</p>\n<h3 id=\"time_wait\" style=\"position:relative;\">TIME_WAIT<a href=\"#time_wait\" aria-label=\"time_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERklEQVR42pVV309aVxy/tlXo5GrwTpGRNplL19VMXxzOmBljE18W4+YDyZJl21N9sc2elrgn/wMTjS8mRmMN1co0odDMbSI/hnRhja6GgQqCCIjgbwWE4eXsc27RoWObO8nhfjn3c77f8/18vt9zmUAgwO/v7wuT2nNzc7zJZOJ3dnb4vb09YT0SifDBYFCwDw8PeY/HwxsMBt5isfChUIg/ODhIx2Ixsr297We0Wu19r9f74fLysnJ+fl45MTGhHB4eVi4sLCjp2urqaoPVam3S6/UtFOdwOOoRUDk2Nibg6B6Kc7lcjXa7XclgSOhPT0/PDUJIYe6ka8zrUYhZTI3Ozs7Cy7jm5uYznPAUO51OLhwOHyAKDzuFiCmcjOzu7gbb29vZuro66lC0trYmozhgBBzwSaRPcT6VSkUPdp06FIGr0s3NTTdSCgMQcLvdgfX19QiAi21tbW9kgUXgkQPOhxEFZgszDHsPfC8iKMUVnKc8NTUlx/EV4OfO9PT0vXg8rpicnKzMSZluYEZGRsTAicFhSXd3N0dtUCPOTVnk9/ul0Wh0B8/kyspKAqnEodwfUNVfU1MjzUYuzm4quBwkZ+21Q3BTitLwbm1tRWGHaepwuI1UHCzL3qmqqqoAR6VXdSjJ/rl2pmJtba1wGqQskKzT6b4cHBz8jNpGo/FNpMnh3e3+/v63YZehpKT5HOZGuZAeNhfhwTY1NX2CLE4hDEEmGQjHgyqSSCSCra2txRdE+TeHQ0NDLB6VKKEP0BkeOArB4SaoCcF5BFzbGxoabl5wODMzU0ZTGR8fv9Xb21tFS4Su0Xfopm9xyi9yaaAcyuXy/KJQlVGLCQhDUFcZ1GLm5OSEIJ1jiUTyUX19fQkt8Owmxmaz3cT8xmw2P2Qujr9UBjermLRqNxDAD4XDaPZXecqGAUYMITo1Gs1X+RxKmP8e572M9GVHR0flAwMDkq6uLu74+LgCNJRncdev5LC6upqqfGN0dPQ2rqkknBBwnEFf88lkkqTT6SAwkssq5xsCoK+vr0Qqld7q6Oh4H7w6QY0fSvugsg+8h8C/7W8qex4/riAvX8qJw1EpTPP38vAPUxX03bRG80CtVn9KbVSC0ADZGyi/ygTlkbL/kgjPGYj3uS7j1j/LHL2wkUOLKd7CcffpTSOTyYqzDgsuOzxbO78PicvKxqzmFxHDj6/Wnz9b9Om1v+1bjEuxn00mF8fdXVSpFKpHj8r/Vy9rZ2dlsWhUbjUY3vlOrX4PXMlRGsL1ZdLpvrY+ffqA2rM2m2JjY0OBK+5diHQPpfUW+rsyV2URvhNlUO7k9PSUAJzBxZnBIKlUKtre2Mji+3Dtc4YpibW0fBzDBymVThOUKm0AHulSXBCfgXOVxYjCQi071HJCuSUU+hL6cxn/jQCKz27srSdPZNFI5Fes/56DW8H/n7I4QTA26/mfJgWJuKvhiv4EPZUHkwvVy94AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way timewait\" title=\"\" src=\"/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png\" srcset=\"/static/9d3cabeb3e6e66223cb4475d42aba133/69538/4way-timewait.png 160w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/72799/4way-timewait.png 320w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png 640w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/d9199/4way-timewait.png 960w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/21b4d/4way-timewait.png 1280w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Upon receiving the receiver’s <code class=\"language-text\">FIN</code> packet, the initiator creates an acknowledgment number using <code class=\"language-text\">receiver's sequence number + 1</code> and responds with an <code class=\"language-text\">ACK</code> packet. The initiator then enters <code class=\"language-text\">TIME_WAIT</code>, beginning the actual connection termination process. The role of <code class=\"language-text\">TIME_WAIT</code> is to prevent the connection from falling into deadlock due to unintended errors.</p>\n<p>The wait time in <code class=\"language-text\">TIME_WAIT</code> is defined as 2MSL (Maximum Segment Lifetime), and the exact MSL value is defined by kernel parameters.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sysctl</span> net.inet.tcp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> msl\nnet.inet.tcp.msl: <span class=\"token number\">15000</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On my machine (macOS), MSL is set to 15 seconds. So my computer waits about 30 seconds in <code class=\"language-text\">TIME_WAIT</code>. Note that this value cannot be changed, so the time spent in <code class=\"language-text\">TIME_WAIT</code> is fixed.</p>\n<p>The commonly mentioned TCP timeout parameter <code class=\"language-text\">net.ipv4.tcp_fin_timeout</code> controls the <code class=\"language-text\">FIN_WAIT2</code> timeout and doesn’t apply to <code class=\"language-text\">TIME_WAIT</code>.</p>\n<p>But just like <code class=\"language-text\">CLOSE_WAIT</code>, deadlocks can occur here too. That’s why many network engineers use various methods — like adjusting the <code class=\"language-text\">tcp_tw_reuse</code> kernel parameter — to reduce time spent here or eliminate deadlocks caused by bad luck. <em>(A state designed to prevent deadlocks that itself causes deadlocks — the irony.)</em></p>\n<p>But as they say, leaving it alone is usually the best approach.</p>\n<h3 id=\"closed-receiver\" style=\"position:relative;\">CLOSED (Receiver)<a href=\"#closed-receiver\" aria-label=\"closed receiver permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERElEQVR42pVVS09bRxg1TTBObYOMC7ZrJVKp0jSosKGmyCpCjcSmRbQskLpJuwqLUJRVJbriH5CA2BAQCCHESyAhuwTagjExTuUUSCxq3viNsTFgHn7VXN+e73KhhrptOtIw47lnvplzzjcfArfbzRwcHHCd5tPT08zMzAwTDAaZ/f19bt3v9zMej4ebHx4eMhsbG8zU1BQzOzvLeL1eJhQKJU5OTtjd3V2nYGxs7N7W1tYnKysrmrm5Oc3AwICmq6tLs7CwoKG1tbW1MpPJVK7X6z8j3NLSUikO1PT29nI42kO45eVlrcVi0QjQJPSnqanpOsuymamd1gRnLRNdTJO6urrMq7iKiopzHDeKbDab3OfzhXAKg3kcJ8ZxM3Zvb89TXV0tLSkpoYBZm5ubCsIBw+GAj4E+4ey1tbV0sWsUMAta5Wxvb6+Dkg8A9/r6utvhcPgBXKyqqnqbBwqhoxw4O1oAmB10H+b70HsRhxIu44LyyMiICtdXQ5/bo6Ojd8PhsHpoaEiZQpk2CLq7u0XAiaBhdmNjo5zmkEaUSjnL6XTKAoFAEGNsdXU1AiphOPcHXHUWFRXJ+JPF/KaMq4ekrJ0FhDY5SI2tnZ2dAOY+oo6Au6CyJJVKbxcUFORDo5w3DSjhf7x17mJxcTF3G1DmRNbpdN+0t7d/TXODwfAOaMrx7VZra+t7mOcipWTpAqaecokeNgsxSMvLy78Ei1MYw4JJEsYxkIqNRCKeyspK8SVT/i1gZ2enFIMSKfQxXsYGAnkRcBvSeBHcD60tZWVlNy4FnJiYyCUq/f39N5ubmwsoRWiNvuE1/YBb3k+VgTRUqVTpTSGXkYsRGMMir5LIxWQ0GmVB51gikXxaWlqaTQnObxKYzeYb6N8bjcbvBJfbXy5DmzV0yloXDnDCYR8e++s0aSMARgQj6oaHh79NF1Ai+O928ZZBX3F0dJTX1tYmqa+vlx8fH+dDhjwed+2NAhYWFpLL13t6em6hTMUQhIXGSbxrJhaLsYlEwgOM5KrL6RoHaGlpyZbJZDdramo+gq42SOOE03a4bIfuXuhv/pvLeMv5AKlwAyV1VBPV5ORkPn2DVg/6+vq+ojkygXsAfAVK7zKKZi50ieBkLmFRupJEC6aExWLxPao0CoVCzAfMuBrwfO2iHmKjFFReQJPXCLiItHkFGlY4PSMUCu/gHasbGhry/tdb7ujoUBDl8fHx91GiPiTKGJX8W340ODj4gOZBnU7Nms3q2adPP/jp8eO77Pz8u369XpnqMkcZFKOnp6esy+VKonAm0dh4PB7QarVS1DvSLfsLrfbz6K/mRHz+JeuafJbc/FHPsNZXLLPwm8fw8OGFyxxluGUBTRucs4K2Fe9zBb8N+H8hOq/Yvzx5ojh6bnwZMhl/dzzTWx3jemto7vlq+IXpZ/tZkeUMk/KR/6kTKCsVx1KHEbwZqTjhn+PqDKvbZq2WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed server\" title=\"\" src=\"/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png\" srcset=\"/static/7d21721d413da9a3d6803c77909963be/69538/4way-closed-server.png 160w,\n/static/7d21721d413da9a3d6803c77909963be/72799/4way-closed-server.png 320w,\n/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png 640w,\n/static/7d21721d413da9a3d6803c77909963be/d9199/4way-closed-server.png 960w,\n/static/7d21721d413da9a3d6803c77909963be/21b4d/4way-closed-server.png 1280w,\n/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After receiving the initiator’s <code class=\"language-text\">ACK</code> packet, the receiver enters the <code class=\"language-text\">CLOSED</code> state and fully terminates the connection.</p>\n<h3 id=\"closed-initiator\" style=\"position:relative;\">CLOSED (Initiator)<a href=\"#closed-initiator\" aria-label=\"closed initiator permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEUElEQVR42pVVTUxiVxTGzghMAQ1SBUpmktpMp2OqG4s1TY1xEjeNsXVh0k3bpMm4cUxXk9iVKzeTxkTjxsRojfE/mlpJ1TaKEmAaamUkFlT+5E/kT1AEYejj9bvPh0VL2+lNLu9w33fPvef7zjmP4/F4qGg0ykxir6+vUxsbG1Q4HKZOTk6Y9UAgQHm9XsY+PT2lbDYbtba2Rmk0Gsrn81GxWCxzfn5Oh0IhF2dxcfGRw+H4YG9vT6nT6ZTT09PKkZER5fb2tpKsHRwc1Gu12gaVStVEcLu7u3U4UDk+Ps7gyB6Cs1gsHxoMBiUHQ0h+enp6btM0XZw/yRrnchRjCojR0dFRfBPX2NiYwzFPvtlslvj9/hhOoWCncWIaN6MjkYi3tbVVVFtbSxzy7Ha7lOCAYXDApxA+wTnb29vJxW4RhzxwVXp0dGRFSH4APFar1XN4eBgA0NjS0vI6C+SCRwlwTowgMMeYftgn4NuIQwmu6Crk+fl5Oa6vAD/3FxYWHiYSCcXs7KwsL2SygTM6OsoHjg8OS7q7uyXEBjX8/JB5LpdLHAwGw3im9vf3kwglAeVeQlVXdXW1mD1ZwG4qunlI3tqlQ3BTitRwHB8fB2H7SehwGEIouyKR6H5lZWUFOCp9VYdC9s9rORVramqY2yBkhuSlpaUvhoaGPiO2Wq1+A2FK8O7ewMDAW7DLkFLiQg7zT7kWHjZz8RA1NDR8gij+gDA0IslCOApU0clk0tvc3Cy4Jsq/ORweHhbhIUMKvY/KsMGRDw6PQI0PzgPg2lBfX3/nmsOVlZUyEsrU1NTdvr6+SpIiZI28QzV9g1t+nk8D4VAulxcWhaiMXExCGBp5lUUuZi8uLmiEExcKhR/V1dWVkARnN3H0ev0dzKebm5tPONfHXyqDmwNMkrVuHOCCwn4U+06BtOEAw4cQHXNzc18Wcijk/Pe4qmWELz07OysfHBwUdnZ2SuLxeAVoKGdxt17JYVVVFVH59tjY2D20qRSc0OA4i7qmUqkUnclkvMAIb6pcaDCA/v7+ErFYfLetre098GoGNS4o7YTKTvDuA//6v6mMWq4ASI4byMhEN5Gvrq5WkHfg6vHExMSnxEYmMAXAdqDCKqNploGXJE5mEhatK0vCgigJgUDwiHQaqVQqYB0W3XSYW7vqh9goCoZCz/2BwI7N4TBa7fYX4WjUFI5ENrhc7gPUsaKrq6v8f9Xy895eKb28LN/6bujtH77tffcctvrZMxlby1/PzMw8ZnNQ4Xa7FWhx70Ckh7jMm6hvWb7KPFqvL8tsGS5eGn+j3T+tZG2qpWx2x0hTxq3g90+/EuH7QHgraWpq+ph8kDBopCopAArh0ul02ovPwJXKfNpiEcW1GkNUqzEfLqtMzh9VpphOs5f4Rad2XjZPpmNPTk5KoeqvUPV3KGwC3ybU8T7+/wyH/FzHErGei2gyQTBLcm4SEC8f9w+T4Lh/AhK1DBDx/1/XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed client\" title=\"\" src=\"/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png\" srcset=\"/static/dc94254134e7f891452d785d1de2120f/69538/4way-closed-client.png 160w,\n/static/dc94254134e7f891452d785d1de2120f/72799/4way-closed-client.png 320w,\n/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png 640w,\n/static/dc94254134e7f891452d785d1de2120f/d9199/4way-closed-client.png 960w,\n/static/dc94254134e7f891452d785d1de2120f/21b4d/4way-closed-client.png 1280w,\n/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After 2MSL has elapsed in <code class=\"language-text\">TIME_WAIT</code>, the initiator also transitions to <code class=\"language-text\">CLOSED</code>. As mentioned, this time is fixed by kernel parameters — about 30 seconds on my macOS machine.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>And that wraps up my second TCP topic: the handshake. I studied TCP in school, but I’d never examined each state in this much detail, so it was a fresh experience.</p>\n<p>Writing this post, I could see just how much work TCP does to ensure reliability even for the simple acts of creating and terminating connections. <em>(Which also made it clear why Google chose UDP for HTTP/3…)</em></p>\n<p>Originally I tried capturing the handshake between my blog’s local server and the browser, but they don’t just exchange a few simple messages — they transfer massive amounts of data, making it difficult to track the specific parts I wanted.</p>\n<p>So I ended up doing some socket programming for the first time in a while. Using C after so long was a bit rough on the hands, but it was fun in its own way. C is the kind of thing that’s fun precisely because you only do it occasionally.</p>\n<p>If you’d like to try running the example application I used, you can clone it from my <a href=\"https://github.com/evan-moon/simple-tcp-example\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>. It’s a simple app that just exchanges messages, so it should be easy to peek at packets using <code class=\"language-text\">tcpdump</code>.</p>\n<p>This concludes my post: How TCP Creates and Terminates Connections — The Handshake.</p>","fields":{"slug":"20191117-tcp-handshakeen","path":"/2019/11/17/tcp-handshake/en/","lang":"en"},"frontmatter":{"title":"How TCP Creates and Terminates Connections: The Handshake","subTitle":"How does TCP guarantee reliable connections?","date":"Nov 17, 2019","categories":["Programming","Network"],"tags":["TCP","SYN","ACK","FIN","TCP Handshake","3 Way Handshake","4 Way Handshake","TCP Flags","CLOSE_WAIT"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/fc5c5/thumbnail.webp 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"fb52a67f-beac-5f82-a8b4-3dde37245e63","tableOfContents":"<ul>\n<li>\n<p><a href=\"#tcp-transmission-control-protocol\">TCP, Transmission Control Protocol</a></p>\n</li>\n<li>\n<p><a href=\"#why-was-tcp-created\">Why Was TCP Created?</a></p>\n<ul>\n<li><a href=\"#a-network-that-survives-nuclear-war\">A Network That Survives Nuclear War</a></li>\n<li><a href=\"#problems-with-packet-switching\">Problems with Packet Switching</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lets-crack-open-tcps-header\">Let’s Crack Open TCP’s Header</a></p>\n<ul>\n<li><a href=\"#source-port--destination-port\">Source Port / Destination Port</a></li>\n<li><a href=\"#sequence-number\">Sequence Number</a></li>\n<li><a href=\"#acknowledgment-number\">Acknowledgment Number</a></li>\n<li><a href=\"#data-offset\">Data Offset</a></li>\n<li><a href=\"#reserved-3-bits\">Reserved (3 bits)</a></li>\n<li><a href=\"#flags-ns-through-fin\">Flags (NS through FIN)</a></li>\n<li><a href=\"#window-size\">Window Size</a></li>\n<li><a href=\"#checksum\">Checksum</a></li>\n<li><a href=\"#urgent-pointer\">Urgent Pointer</a></li>\n<li><a href=\"#options\">Options</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In my previous post, Why Did HTTP/3 Choose UDP?, I briefly touched on TCP, but that post focused on what problems TCP had that led HTTP to move away from it. This time, I want to focus more on TCP itself. I originally planned to cover all of TCP in a single post, but the sheer volume of material fo…","html":"<p>In my previous post, <a href=\"/2019/10/08/what-is-http3/\">Why Did HTTP/3 Choose UDP?</a>, I briefly touched on TCP, but that post focused on what problems TCP had that led HTTP to move away from it. This time, I want to focus more on TCP itself.</p>\n<p>I originally planned to cover all of TCP in a single post, but the sheer volume of material forced me to split it into several posts. (This grandpa protocol just never ends no matter how deep you dig…)</p>\n<p>So in this post, I’ll focus exclusively on the fields inside TCP’s header and what they mean.</p>\n<h2 id=\"tcp-transmission-control-protocol\" style=\"position:relative;\">TCP, Transmission Control Protocol<a href=\"#tcp-transmission-control-protocol\" aria-label=\"tcp transmission control protocol permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP (Transmission Control Protocol) is a protocol used at the transport layer of the OSI 7-layer model. Its purpose is to ensure that information is exchanged reliably, in order, and without errors between devices.</p>\n<p>In computer science, things closer to the machine are described as “lower” or “behind,” while things closer to humans are “higher” or “in front.” The OSI model works the same way — lower layers are closer to the hardware, and higher layers are closer to people.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d3f96/osi.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD1UlEQVR42mPgNbHt5DW13c1tbLNJws51i5KrzxYFIFZy890i4+i5RdbJc4skUJzb2Hozj4nNDh5j20VyNjaC9QwMTFpaWmzGxsasQMzl5uYm5OHhwcfAZeRwkNvI8T+brs1XJbeg73ZxWd9Nw5K+W0Smftf2jfxuFp78XdUz5DuHvt1XLkOHP9yGDo+ULexV/KyseC0sLIRsgIa7uLjIOTo66gOxMoOSp+xUBXfZi4qessfVfFVOqvgon1T2Ujqp7Kl0UslD/qSSpwJQTOmkoofsCUV32XMKnjKbtEJFeRgggJEBHah7Cx5W9xH8r+Yl8M0t1ehHQJ7Nj+AChx+hRY4/3NNMfvjn2Pzwy7b6oebF/03dW+CvupfAI0UnbnGodiaooYxQNhODUYbUZKN0yfOG6ZJHDdIkjptmyR03zpQC0rIotEG65DGjdKkzQPUb9IrFuXG60LRU6rhFlcx/IP3XokL2f3S/y//4SZ7/o/qc/4d02/6PnuD637pSASxvXglW98I8TwziwnoUF0JA8CSr/tDJVidDJlnuD51kdTB8svXBECAdMsniYMRkm4NAuYPBQDZQ7kDoJMtjQHp1TLceuguZgDHM/v//f0aGnDUBJwo2hfzPWu3/t2Bd2P+O3YX/u/aW/G8H0o3bs/737q/4X7ox5n/mar+/+RuC/+esDngZXeOubqbiwecc4Czs7OwsDEwyssCYNrG3txdgqN6S3F+zNeUkEO8H4oONOzIPtu7OPdiyKxvIzgCz67alHwSqOwCUPwakV2etCuXB4mUIe+qxuuMzTzf9B9K/pxyp/du0ouBv0/KCvy2rCv92bCj927K68O+kA9V/px1v+D39ROP/KUfqXpT2Z6irCJnxBQQECHt7ewsC0586KC2CLZl3qqtv3qnuk/NOdu0Hsg/OO9FzcO5xEA3EQBrMBomf7DoAVHcMSK+es6GTF6Q3dFUoc319PRMot4SGhjKDDdx2beXRXbfX/N9+Y8XPTZeW/p67bfLvxQdm/F5ycObvZYdn/Z6/c8rvDecX/d5xc9XPHTdW/t9+fcWTnRcWiYH0giMBHey5vb5vz631x/bc3rBn1811+7ZdXLVv55W1+3ZeW7tvO5DeCuTvurFu3+5b6/cC1R0G0iv3X1nFg9PAe+9vHnvx69H/Bx9v/b377vr/E9cO/z998ygYn7936v/pW8f+33l7DSz/9Nv9/0D1z289OyeK08AbLy+13nh5eevN11fW3Hh1ed3p20fXHbmyf93x64fA+Mjl/euuP7+47sarS2tvvrq06ebrS3Ouvz7Ci8tAAAaq+RhRBRVjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"osi\" title=\"\" src=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/6af66/osi.png\" srcset=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/69538/osi.png 160w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/72799/osi.png 320w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/6af66/osi.png 640w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d9199/osi.png 960w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d3f96/osi.png 1093w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Protocols we’re familiar with — like HTTP (Hypertext Transfer Protocol), SMTP (Simple Mail Transfer Protocol), and FTP (File Transfer Protocol) — sit at the highest layer, the application layer. In contrast, lower-layer protocols like TCP, UDP, and IP are ones we encounter far less often.</p>\n<p>That’s because the OS handles most of these for us. Developers programming at higher layers don’t need to worry about every detail of what happens down below.</p>\n<p>This is one of the reasons the layered model exists in the first place. Networking is a convergence of countless technologies, and no single developer can know everything. Through strict separation of responsibilities between layers, the scope of what you need to worry about for any given task is narrowed down.</p>\n<p>Thanks to this, when using HTTP, we don’t need to simultaneously think about which DNS server to use or how to process packets.</p>\n<p>That said, even with these clear layer boundaries, if you have zero knowledge of what happens in the lower layers, you might encounter situations where everything looks fine at the application layer but a lower-layer issue leaves you completely helpless.</p>\n<p>For this reason, I think it’s worth knowing at least the general workings and overview of the protocols you use. So with this post, I want to crack open TCP — a protocol I previously only knew through a handful of high-level characteristics.</p>\n<h2 id=\"why-was-tcp-created\" style=\"position:relative;\">Why Was TCP Created?<a href=\"#why-was-tcp-created\" aria-label=\"why was tcp created permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Personally, when studying any technology, I find it far more effective to understand <em>why</em> it was needed and empathize with that reasoning, rather than just memorizing facts.</p>\n<p>TCP is old enough that it’s hard to fully relate to the circumstances of its creation, but looking at why this protocol was developed reveals the struggles engineers faced back then.</p>\n<h3 id=\"a-network-that-survives-nuclear-war\" style=\"position:relative;\">A Network That Survives Nuclear War<a href=\"#a-network-that-survives-nuclear-war\" aria-label=\"a network that survives nuclear war permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As I just mentioned, TCP was developed as part of ARPANET, a project by the U.S. Department of Defense during the Cold War in the 1970s. One of the key topics of interest during ARPANET research was “a network that survives even nuclear war.” (The opponent in said nuclear war being, of course, Mother Russia…)</p>\n<p>The reason was that 1970s networks used circuit switching. If a relay station took a direct hit and was destroyed, or if a single connecting line was cut, communication would be severed entirely.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/872ac67a7c6196542ca4a5ece19b54b5/b17f8/old-telephone.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFTc92ECoH/xAAaEAEBAQADAQAAAAAAAAAAAAACAQMAERIh/9oACAEBAAEFAjCplj1xGlevmegp0Qt//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgEEAwAAAAAAAAAAAAAAAAERAgMhMRAiQf/aAAgBAQAGPwLWRq5T5uCGo4SqeTspP//EABoQAQADAAMAAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hblDo9XAam4UPrzxnOewigEzdgO1hzP/aAAwDAQACAAMAAAAQHz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhQWFRcf/aAAgBAQABPxB40ewW5Foq+MIw3qjFsL/SKiPfDifSCePKeSoMJR403SJNZQNZbU//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"old telephone\" title=\"\" src=\"/static/872ac67a7c6196542ca4a5ece19b54b5/c08c5/old-telephone.jpg\" srcset=\"/static/872ac67a7c6196542ca4a5ece19b54b5/0913d/old-telephone.jpg 160w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/cb69c/old-telephone.jpg 320w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/c08c5/old-telephone.jpg 640w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/6a068/old-telephone.jpg 960w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/eea4a/old-telephone.jpg 1280w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/b17f8/old-telephone.jpg 1600w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>I wasn't there personally, but I imagine it looked something like this...?</small>\n</center>\n<p>What relay stations did back then was essentially this: when A asked the station to “connect me to B,” the operator would find the jacks labeled A and B on a patch panel full of cables (like the photo above) and physically connect them with a cable.</p>\n<p>Literally switching circuits. If A then wanted to talk to C instead, you’d unplug the cable from B’s jack and plug it into C’s.</p>\n<p>With circuit switching, you physically hold one dedicated line for communicating with your counterpart, which means circuit utilization is inherently low. It’s the same principle as getting a “the person you’re calling is currently on another call” message when you try to phone someone.</p>\n<p>Of course, monopolizing a circuit has advantages — like being able to stream large amounts of data at high speed. But what mattered to the U.S. at the time was a connection that wouldn’t break even if a nuke went off, so depending entirely on a single circuit was a major drawback.</p>\n<p>This led to the idea of packet switching. Instead of sending data through a single circuit — where a destroyed line or relay station means losing the data forever — the idea was to split data into small pieces and send them through multiple circuits. A kind of diversified investment, if you will.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/200a4648f12fe0e8e32c2a9308df4465/0d98f/packets.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 29.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42mPw9vZWsnXXkGQAgv//GRhDQ0OZgSymX6fTrX/dyMkCiX861yr653Jm9f/96QpgdQ9SUtf196fGuB5UhOirZ2KAgSS/hUnxnkum/d/PwALit6SvMqtMWp8LYu/ff5/jye7Jwk/WVQjv3/+f5cm6NuHGjDXB9fVX2KrTNztMLlhmAjPn/yZJrv/zGTgYurLqJdZOXvXi+an2m/8veOv8X5opWBK/1mN1zzSf/w8ynJ7v7Ob+/38R9+/rBb7HdqwSas7YGP90b2nk//+hQsWBi8Q6s5bH/t8bpv//Qced/w8adkFMf1Sx5v/9xhufdkRq/H9kwVmRsMkUbODXBNPijKM6U8vmBf2/n+Vx+PAWQZD671eLnP8/zJaqj1kkVpu13f/D4USl/w/brv170LQNYuAVLbZ/2xjYwexVhZz/z6Rx/f//nxEYpkyza1dYV2ducAHJXdh5gfvIkeu8Z86cYb1y5QobiAapA8n926bC/v8MAys8LP8zMIAMYITxf57MMvh/PSsdKMP48uUUnl/X8/IfXZktBJL7cyMn+d/NMk0Qu76+nglZHwDNUtCZl2fElwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"packets\" title=\"\" src=\"/static/200a4648f12fe0e8e32c2a9308df4465/6af66/packets.png\" srcset=\"/static/200a4648f12fe0e8e32c2a9308df4465/69538/packets.png 160w,\n/static/200a4648f12fe0e8e32c2a9308df4465/72799/packets.png 320w,\n/static/200a4648f12fe0e8e32c2a9308df4465/6af66/packets.png 640w,\n/static/200a4648f12fe0e8e32c2a9308df4465/d9199/packets.png 960w,\n/static/200a4648f12fe0e8e32c2a9308df4465/0d98f/packets.png 1276w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>This way, even if one node is destroyed, not all data is lost</small>\n</center>\n<p>In the worst case, a destroyed circuit or relay station might cause some data loss, but as long as the entire network isn’t hit at once, the chance of losing all data is low. And since you’re not holding a dedicated circuit open — you just mark a destination on each packet and send it off — circuit utilization improves as well.</p>\n<p>For these reasons, the Department of Defense adopted this idea for ARPANET. Early tests were a massive success, proving the practicality of packet switching.</p>\n<p>ARPANET, initially used only by a handful of universities and military installations, was eventually opened to the public and grew into what we now know as the internet. Along the way, TCP — ARPANET’s communication protocol — rose to prominence with it.</p>\n<h3 id=\"problems-with-packet-switching\" style=\"position:relative;\">Problems with Packet Switching<a href=\"#problems-with-packet-switching\" aria-label=\"problems with packet switching permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>But packet switching wasn’t a silver bullet either; it had several problems. The concepts that always come along when studying TCP — ARQ, SYN, ACK, and so on — are the result of past engineers racking their brains to solve these very problems.</p>\n<blockquote>\n<p>Q: What if a packet silently disappears or gets corrupted mid-transmission?<br />\nA: <strong>Then ask for just that packet to be resent! (ARQ)</strong></p>\n<p>Q: The receiver needs to know the order the sender split the packets in to reassemble them, right?<br />\nA: <strong>Then send a sequence number along with each packet! (Sequence Number)</strong></p>\n<p>Q: What if the sender sends packets faster than the receiver can process them?<br />\nA: <strong>Then have the receiver tell the sender how much it can handle and only send that much! (Sliding Window)</strong></p>\n</blockquote>\n<p>The many features and concepts TCP has might look complex and memorization-heavy on paper, but when you consider the situation at the time, you can see they were all absolutely necessary.</p>\n<p>And since these features work by reading information in the header of the segments the other party sends, before examining each feature individually, I want to look at what information TCP’s header contains and what it all means.</p>\n<h2 id=\"lets-crack-open-tcps-header\" style=\"position:relative;\">Let’s Crack Open TCP’s Header<a href=\"#lets-crack-open-tcps-header\" aria-label=\"lets crack open tcps header permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Protocols like HTTP, TCP, and IP each have their own roles, and they attach their own headers to the data being sent to represent information about that data.</p>\n<p>Since TCP is responsible for transmission reliability, flow control, congestion control, and similar concerns, the TCP header contains various values needed to support these functions.</p>\n<p>In other words, looking at the header gives you a quick overview of TCP’s features — which is why I chose header dissection as the first step in this TCP series.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42j2P147CMBRE8/9/x4IQkEKq4zi9YofA7NjS7sOR43jKvV6YSMh2xbJs6PoR47Rg5vc0rxjGGbKq8fADVKpx/5q2d5o/rKbtBvTDhO2l4V0fCcK0gpAKWSGRCYkozvBMcqR5ibQoIVWLsmrce5wWjuvNx+0RIMkEYmr9KEHbD/ByoVz7/j6gzU4M20ZOucLsb9cqK4W8ENTVWLeXo6N5GCfnsTpNzL7DS3PJ9hrLurmQhUyzXWfGwDWSNEMYPSFK6mQFVTeuxIZuRGuDF9mIYbib0K7UsLHuejwZkNEsaVRtB9W06DiJOQ4c3y/eZKXZvlv9y05ntyOGeGFcoMwKHFxTM0A3HaoogopjTJxoYvggSow8F65uTxGEKMOIuif6vIC2wSw23MwTNSdIUnx9H0cQ4BOG2Pk9ns+O6XJx9KfT/338OaPjXd/v+LLcej7WrxR+AYjFDnQh+N9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp header\" title=\"\" src=\"/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png\" srcset=\"/static/ac69210c44cd473bcb737665d590b124/69538/tcp-header.png 160w,\n/static/ac69210c44cd473bcb737665d590b124/72799/tcp-header.png 320w,\n/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png 640w,\n/static/ac69210c44cd473bcb737665d590b124/d9199/tcp-header.png 960w,\n/static/ac69210c44cd473bcb737665d590b124/21b4d/tcp-header.png 1280w,\n/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>TCP uses a 20-byte (160-bit) header divided into multiple fields. Each field’s bits are set to 0 or 1 to represent information about the segment being transmitted.</p>\n<p>However, 20 bytes is the size of a basic header with no options. When using TCP’s various options, additional option fields are appended to the end of the header, which can add up to 40 more bytes for a maximum of 60 bytes.</p>\n<p>Let’s go through each field in the order shown in the diagram.</p>\n<h3 id=\"source-port--destination-port\" style=\"position:relative;\">Source Port / Destination Port<a href=\"#source-port--destination-port\" aria-label=\"source port  destination port permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/c7bb6/header-source-destination.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABgUlEQVR42j2Q2ZKiQBBF+f+PmiUmpqft1VZ7WlRAFNl3QYpFziQ8zMOJqsy6N5fSDNvHzxuuqiO53shvilL1FE1HViu8JEO3bPy0kFxLXFTkkp90+a0VTUNS1qRVQ931aJ+Gg7XcELwucN9e8AT78YHT4oHLyxOuEK+WhMt33Ndnzk+PM7sf39j9/I7zvJD4D9bvX+T6F5oTJETbL+5Hg/5k0dkm5faT+qAznC3a44Fo9SbNpPD6ncbco6w9xXbDdfdXPObs68XXOzbayfHw4pRKxp3WnihltUJWyqobtutjnBzcKBZdQpjl3PphXq/uBpphFO4zStAcN8QPY+I0I0pSLPuE43qSiwglDqVImhe0UmQYR/r7SK3U/D7pm7ZDSfGJdvpD43jBO18YxKREoGTawDQJj0dKP6D0fHJpUMhZBeF8ugcDzzBFZ5E5F5QM00jj9lqhuZFMIFON+z3D4cDdMOjkXqzXM+VmM5N9fPyPi9WaVGKl64zSfPLcJ38Y8g/pAAhNJ6xOXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header source destination\" title=\"\" src=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/6af66/header-source-destination.png\" srcset=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/69538/header-source-destination.png 160w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/72799/header-source-destination.png 320w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/6af66/header-source-destination.png 640w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/d9199/header-source-destination.png 960w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/21b4d/header-source-destination.png 1280w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/c7bb6/header-source-destination.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>These fields indicate the source and destination of the segment, with 16 bits allocated to each. To identify the source and destination addresses, you need both an IP address and a port number.</p>\n<p>Since the IP address naturally belongs in the IP header one layer below (the network layer), the TCP header doesn’t have an IP address field — only port fields.</p>\n<h3 id=\"sequence-number\" style=\"position:relative;\">Sequence Number<a href=\"#sequence-number\" aria-label=\"sequence number permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/98943a4651928dcb5ab4fb58fc381649/c7bb6/header-sequence.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42j2R23abMBBF+f+v6kPzkrQrJXaIbe5gg7gJEGDjGHt3TNfqw16aOZozGkmWHytUMzFOF3Rn6IeJQWIznunMiCprDl5AUTWrVute9Gmte9KZgaY1tP3AeZ6xHDfBjxRZmpHGR47JicALCf2QJEpES1F5QXbK1zgKIiHG2TrsnB1xmKyau/doGo11LDW1/ZvHl83iOiz7LcOfN87bd+7uJ9+7D+rXn+QvP2jeXpgdm6tg3l8Z7V9r/f3w+W91v7DiU4FKj0x1xVjXK0NVYcqCTimSw4HA+SQPAlQUUqUJl1Zz1g0XrZm7TmiZRbuaXibMSlQlU8r7VW1PKM1TJYfUDaXuKOUaujdclzsLcHvAdL2t+1XbcbktzMtj5Vlj+dGJPD2xdD2zmGcpLPyAMoww0tjkiu6U0Wc5o+R9npN5PrlQBCGtDPD0XapaJhywMvk9HSc8XJfF87j7Pt8S95vNitluV1rb/p/3Hxu05PN+z0Oe4um5P/1lyV++PwgKyWhZIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header sequence\" title=\"\" src=\"/static/98943a4651928dcb5ab4fb58fc381649/6af66/header-sequence.png\" srcset=\"/static/98943a4651928dcb5ab4fb58fc381649/69538/header-sequence.png 160w,\n/static/98943a4651928dcb5ab4fb58fc381649/72799/header-sequence.png 320w,\n/static/98943a4651928dcb5ab4fb58fc381649/6af66/header-sequence.png 640w,\n/static/98943a4651928dcb5ab4fb58fc381649/d9199/header-sequence.png 960w,\n/static/98943a4651928dcb5ab4fb58fc381649/21b4d/header-sequence.png 1280w,\n/static/98943a4651928dcb5ab4fb58fc381649/c7bb6/header-sequence.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The sequence number indicates the order of the data being transmitted and is allocated 32 bits. It can represent values up to 4,294,967,296, so sequence numbers don’t duplicate easily.</p>\n<p>Thanks to this sequence number, the receiver can determine the order of split segments and reassemble the data correctly.</p>\n<p>When the sender transmits data for the first time, it initializes this number to a random value. After that, it increments the sequence number by 1 for each byte of data it sends. When the maximum value of 4,294,967,296 is exceeded, it wraps around back to 0.</p>\n<h3 id=\"acknowledgment-number\" style=\"position:relative;\">Acknowledgment Number<a href=\"#acknowledgment-number\" aria-label=\"acknowledgment number permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/39c82afd470e6193a6a529065650699b/c7bb6/header-ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR42j2QWZOTQBSF+f8/ywetUkudJBMTwhqgabrDTtiSmc87WPpw6q7nLsfxY40uB4b+TlW1tG1PL37XDTRNh9YG1/UoCrvlyrLeev6haVrKqqGuW8Zxwjm6MX5qUaYkyS2JtgRXRZgorqrgmhv0rUbZSuqGKM0FmqPrc/JC4qwgSnK8KKGUA5xU3zBhyLNQrEXOohVN6NMnMQ+jmfMMcz6Sve6w7okxS5hUsvV0cSicv7xVeOvN4MRylTnsmM4H7v6Z0Ttxv/xmcI90p1fSr5+Jvnyi+PEN8+s75f4nS3hh8l3m4MIa+SyRt+UeAidV8pLoc7MWawxhEJAmCTrPsYXB6IK6rFiXhefjwXNdGYf7Vr9J/zSOLNPEIvajx/GjjFz0eorAs4g7VzU6jCjiK50samVok2taGdwbu1nlB+RBSBHF1JlirhsmWbr0A46yJZWQ3y8Xnp7Hm++zit/u9xu6w2FD/fLyP253eyqJ5/OZd/nog/P2wTeGP93kCAjG+USDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header ack\" title=\"\" src=\"/static/39c82afd470e6193a6a529065650699b/6af66/header-ack.png\" srcset=\"/static/39c82afd470e6193a6a529065650699b/69538/header-ack.png 160w,\n/static/39c82afd470e6193a6a529065650699b/72799/header-ack.png 320w,\n/static/39c82afd470e6193a6a529065650699b/6af66/header-ack.png 640w,\n/static/39c82afd470e6193a6a529065650699b/d9199/header-ack.png 960w,\n/static/39c82afd470e6193a6a529065650699b/21b4d/header-ack.png 1280w,\n/static/39c82afd470e6193a6a529065650699b/c7bb6/header-ack.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The acknowledgment number represents the next sequence number that the receiver expects, and is allocated 32 bits.</p>\n<p>During the handshake process for connection setup and teardown, each side creates its acknowledgment number as <code class=\"language-text\">the other party's sequence number + 1</code>. But during actual data exchange, the acknowledgment number is calculated as <code class=\"language-text\">the other party's sequence number + the number of bytes received</code>.</p>\n<p>For example, imagine sending 1 MB of data. Since you can’t send such a large amount in one go, the sender must split it into multiple segments and transmit them incrementally. The amount of data the sender can transmit at once varies depending on the network and receiver’s state, but let’s assume it’s 100 bytes.</p>\n<p>The sender transmits 100 bytes in the first transmission and initializes the sequence number to 0. Since the sequence number increments by 1 per byte, the first byte chunk gets 0, the second gets 1, the third gets 2, and so on.</p>\n<p>So in this transmission, the receiver received 100 byte chunks numbered 0 through 99, and the sequence number it should expect in the next transmission is not 2, but 100.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4c5dc85683ae837d23500d773f219316/05244/ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVR42mOor69nCg0NFY2JiRED4fisLAkYziguFvPw8FCW1NS0XWZoaDLPxUXVo7JSNC0tTTI+PksCpgeEfX19xUFmMSRlZ0tFJyZqgTi5Hh7s/xkYGBmIACD19fb2HCAcumoVc3h8vEJMcTE3Q9Gi1deKF62+Wbps/bz9//+zHL/5s2H/5V9L913+Me/A1d/z913+Nf/ojR8LTt/+MR+E91/+MffglR8rT936mQQy+P///4ylSzcsKFq0BmjO2isM7Vv2/m/fduB/zYpN926n1Ghfv//u8Z27l/5fv3723+3bl/7fuH7y/7WH7/9ffvr//xUgvnr9wp+Hz57+v/Lk/xagbzTf8/M71W/ac69j6/7/bUCzGLq27vvfs/PQ/5pl6x7cCcgzvv/4/pOfL1b8//x46b8vj5f9//547v97j+//P3n33/9zD///f/9k058fH479v3jv/3aggUZfeHk9Gzbuut+74+D/7m37/zMULlpzs2jxmtslS9YuA3n57K3PrZfvvVp98c7LJUB66dV7L5eevftp6YmbP5aeuP1j6cU7bxZfvPt2/Ymbv9JgXi5ZvG5F0aK1t0AYAHD8D+xKjCj6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ack\" title=\"\" src=\"/static/4c5dc85683ae837d23500d773f219316/6af66/ack.png\" srcset=\"/static/4c5dc85683ae837d23500d773f219316/69538/ack.png 160w,\n/static/4c5dc85683ae837d23500d773f219316/72799/ack.png 320w,\n/static/4c5dc85683ae837d23500d773f219316/6af66/ack.png 640w,\n/static/4c5dc85683ae837d23500d773f219316/d9199/ack.png 960w,\n/static/4c5dc85683ae837d23500d773f219316/21b4d/ack.png 1280w,\n/static/4c5dc85683ae837d23500d773f219316/05244/ack.png 1752w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>100 bytes are bundled into a single segment for transmission</small>\n</center>\n<p>If you capture packets using <code class=\"language-text\">tcpdump</code>, you can actually see the receiver’s acknowledgment number increasing by the length of data the sender transmitted.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.http-alt <span class=\"token operator\">></span> localhost.49680: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">160</span>:240, ack <span class=\"token number\">161</span>, win <span class=\"token number\">6374</span>, length <span class=\"token number\">80</span>\nlocalhost.49680 <span class=\"token operator\">></span> localhost.http-alt: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">240</span>, win <span class=\"token number\">6374</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Looking at the sender’s segment, the sequence number shows <code class=\"language-text\">seq 160:240</code>, and the receiver uses the value after the colon as its acknowledgment number.</p>\n<p>Here, the sequence number format represents a range of <code class=\"language-text\">n inclusive : m exclusive</code>. Since the number after the colon is not included in the sender’s sequence range, the receiver can use it directly.</p>\n<p>In other words, the acknowledgment number indicates the starting point of the data that should be sent next.</p>\n<h3 id=\"data-offset\" style=\"position:relative;\">Data Offset<a href=\"#data-offset\" aria-label=\"data offset permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e1e371de646e3735c414e9a897af2db6/c7bb6/header-data-offset.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42j1Q6ZKiMBjk/Z9uRmenVATDnQQIEM4g0ttQtfujK1dfX7wgkpD1iGGYYJoOnR3Qc2/7EW3XQ6oSD/8Jpavzrqqbk/MPB6c2LZrWYpoXeL9+hCBWyKVCkhVIM4VQJHhFKeK0QMw7qWsUquK7hIizE783H7fHE1GSQ5DrhxHqpoWX5RqyMnA7sLw3LM4xrWPLEW59n6lSaQblbFlinOYThuK2s+SvJ28h3LrCi/IS6n7DLAKMscDQD7A062yPlmNEcYIgfCEvJApOocvqDDlMJ2JZHGZiIhzNvVQZlJcv1CJE/eeCVxAioVBSqGsDXdUwbOK2Ddu+402MFB/vpWkwH+2OyQhHeEHMP7rfsT8fcJHAQhMVhtBCwNLYslmbF+i4Dhz9WPNngILBis2bNMNyGDPYcTov54ebJMXnJbCRsAcBVt9Hd72esD8/J5rv7//n7nKF4Xk5ijD8Q82Hmk1r/AVxsA1M+2D96gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header data offset\" title=\"\" src=\"/static/e1e371de646e3735c414e9a897af2db6/6af66/header-data-offset.png\" srcset=\"/static/e1e371de646e3735c414e9a897af2db6/69538/header-data-offset.png 160w,\n/static/e1e371de646e3735c414e9a897af2db6/72799/header-data-offset.png 320w,\n/static/e1e371de646e3735c414e9a897af2db6/6af66/header-data-offset.png 640w,\n/static/e1e371de646e3735c414e9a897af2db6/d9199/header-data-offset.png 960w,\n/static/e1e371de646e3735c414e9a897af2db6/21b4d/header-data-offset.png 1280w,\n/static/e1e371de646e3735c414e9a897af2db6/c7bb6/header-data-offset.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The data offset field indicates where the actual data (as opposed to the header) begins within the segment.</p>\n<p>This offset is expressed in 32-bit word units, where <code class=\"language-text\">1 word = 4 bytes</code> in a 32-bit system. Multiplying this field’s value by 4 gives you the starting position of the actual data after the header.</p>\n<p>The 4 bits allocated to this field can represent values from 0000 to 1111, meaning 0 to 15 words, which translates to 0 to 60 bytes. However, since all fields except options are mandatory, the minimum value is fixed at 20 bytes (5 words).</p>\n<p>This field is needed because the Options field, described below, has a variable length.</p>\n<h3 id=\"reserved-3-bits\" style=\"position:relative;\">Reserved (3 bits)<a href=\"#reserved-3-bits\" aria-label=\"reserved 3 bits permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0349ac9a4c277a5a0090feab26782143/c7bb6/header-reserved.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABZ0lEQVR42j2RyZKjMBBE+f8v65hbtx0OYwy2WCWxil0YOztRzMzhhSjIqkwVXigkZD1hHGc0rYHpRwx87ocJnRkgVYlbcIfSlXtX1a3T/OPQ1E2HtusxLyu8y00gjBVyqZFkBVISPRI8RIo4LRCzlrpGoSp+l3jGmeNyDXC93SGSHE9qg0igbjt4aa6d+/basZJlf6Ol6zCMsNvLuUqlaZRTV2KaF0fD5s70WO3mdCux2wYvTiUKWWJcLKZUYA59jErCjLxyZyDiBGH0QF4cOgVdVs7kGDqTdbVYyEwsh7uEkgnLnru4nCH+fCE7/0ByL7pqSI2GSey+Y/988CITmyUHl02L5Uj393aWeOEzQ5Fk2DnQJjGsf4Hyr9BCoGeinsm6vIDhOfLqx5nfQxRhBMXkbZphPQbT2HJNXl4ygYjxCQLsUYT3U2DjXzWnk6M/nx3t9/f/2vyc0LBefR+foycM8T76tcYvjnYNZW+98D0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header reserved\" title=\"\" src=\"/static/0349ac9a4c277a5a0090feab26782143/6af66/header-reserved.png\" srcset=\"/static/0349ac9a4c277a5a0090feab26782143/69538/header-reserved.png 160w,\n/static/0349ac9a4c277a5a0090feab26782143/72799/header-reserved.png 320w,\n/static/0349ac9a4c277a5a0090feab26782143/6af66/header-reserved.png 640w,\n/static/0349ac9a4c277a5a0090feab26782143/d9199/header-reserved.png 960w,\n/static/0349ac9a4c277a5a0090feab26782143/21b4d/header-reserved.png 1280w,\n/static/0349ac9a4c277a5a0090feab26782143/c7bb6/header-reserved.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>A field reserved for future use — all bits must be set to 0. You can see it marked as <code class=\"language-text\">0 0 0</code> in the header diagram above.</p>\n<h3 id=\"flags-ns-through-fin\" style=\"position:relative;\">Flags (NS through FIN)<a href=\"#flags-ns-through-fin\" aria-label=\"flags ns through fin permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/c7bb6/header-flags.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVR42jWQ527jMBAG9f4PdocEAQLHjousYhVLlKjerGJ7biXgfgxIkPsNd2nYnkLlPV03UJQ1ddPRyr5pe6q6RSUa82qRpNl2luXlVvOftSYvKsqqYXiMGEfTw/YTIpUS3NWG4/q4XoAfRgRhLNKMWOnt7uaF3Pw7x/OVs2nhBdF2dnU88rLCCKN0e31enozTzDjPFGuX/YPp+WaYFlRWEMaKNNX0w2OjkHBVN1tmmhfJLbLOGH6oiGWsrh9EMtBVNb11pvVcatci+Pnm9vGH2LwQi3CVrqOt0kEYx4mHMAiTyLcOVZqTlSVaZK5pEn/+JQl8Ms9DBwGliJc4ZAGW15tewkpn6KLksXa3TidMgmHf7sTBnafIRvnwUWv01wfZ9xfd6Zf2dKA57Gi8G618TS2jR5ZNbDskjksZ3hlXcZYztR1GpHMKz+dtXXlaFi/HYZbi6ve40RxP1EK531MLzeFA/bOn2O0YLxfeUv+ybV5Xyacp/wCQHgwqbb+AcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header flags\" title=\"\" src=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/6af66/header-flags.png\" srcset=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/69538/header-flags.png 160w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/72799/header-flags.png 320w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/6af66/header-flags.png 640w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/d9199/header-flags.png 960w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/21b4d/header-flags.png 1280w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/c7bb6/header-flags.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Nine bit flags that indicate the properties of the current segment. Originally there were only 6 flags, but <code class=\"language-text\">NS</code>, <code class=\"language-text\">CWR</code>, and <code class=\"language-text\">ECE</code> were added using bits from the <code class=\"language-text\">Reserved</code> field to improve congestion control.</p>\n<p>Here are the original flags and their meanings:</p>\n<table>\n<thead>\n<tr>\n<th>Field</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>URG</td>\n<td>Indicates that the Urgent Pointer field contains a valid value. Data pointed to by this pointer is given high priority and processed first. Rarely used today.</td>\n</tr>\n<tr>\n<td>ACK</td>\n<td>Indicates that the Acknowledgment Number field contains a valid value. If this flag is 0, the acknowledgment number field is ignored entirely.</td>\n</tr>\n<tr>\n<td>PSH</td>\n<td>Push flag. Requests that the receiver deliver this data to the application as quickly as possible. If this flag is 0, the receiver waits until its buffer is full. When this flag is 1, it also implies there are no more segments connected after this one.</td>\n</tr>\n<tr>\n<td>RST</td>\n<td>Reset flag. A request to forcefully reset the connection with a counterpart that is already in <code class=\"language-text\">ESTABLISHED</code> state.</td>\n</tr>\n<tr>\n<td>SYN</td>\n<td>Synchronize flag. Indicates this segment is for synchronizing sequence numbers when establishing a connection with the other party.</td>\n</tr>\n<tr>\n<td>FIN</td>\n<td>Finish flag. Indicates this segment is a request to terminate the connection with the other party.</td>\n</tr>\n</tbody>\n</table>\n<p>The newly added <code class=\"language-text\">NS</code>, <code class=\"language-text\">CWR</code>, and <code class=\"language-text\">ECE</code> flags (carved out of the former Reserved field) are used for Explicit Congestion Notification (ECN).</p>\n<p>Before ECN, the conventional method for detecting network congestion relied on timeouts. But for latency-sensitive applications, even that waiting time was too costly, so a special mechanism was needed to explicitly notify senders and receivers of congestion — and that’s ECN.</p>\n<p>The <code class=\"language-text\">CWR</code>, <code class=\"language-text\">ECE</code>, <code class=\"language-text\">ECT</code>, and <code class=\"language-text\">CE</code> flags are used to inform the other party about congestion. Of these, <code class=\"language-text\">CWR</code> and <code class=\"language-text\">ECE</code> reside in the TCP header, while <code class=\"language-text\">ECT</code> and <code class=\"language-text\">CE</code> are in the IP header.</p>\n<table>\n<thead>\n<tr>\n<th>Field</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NS</td>\n<td>A field added in RFC 3540 to guard against the CWR and ECE fields being accidentally or maliciously concealed.</td>\n</tr>\n<tr>\n<td>ECE</td>\n<td>ECN Echo flag. When this field is 1 and the SYN flag is also 1, it signals to the other party that ECN is supported. If the SYN flag is 0, it’s a request to reduce the segment window size because the network is congested.</td>\n</tr>\n<tr>\n<td>CWR</td>\n<td>Indicates that an ECE flag has already been received and the sender has reduced its segment window size.</td>\n</tr>\n</tbody>\n</table>\n<p>ECN is a separate topic from this post, so if you’re curious, I recommend looking into the details through other resources.</p>\n<h3 id=\"window-size\" style=\"position:relative;\">Window Size<a href=\"#window-size\" aria-label=\"window size permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/c7bb6/header-window-size.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVR42k2Q646bQAxGef8na7VttVUS2CWBAMNlhvs1AUL21KGq1B9H47Hsz/5seaFGVxPjeKNuOrp+ZJC4HybabkCbAvd8weTlniurZq/5x6umqluatud2n7FsN8SLDKnOUYlGpRo/UFzDmCjOiJIMnVekWYGSfyD5IIqxHZePzwuhSiSnOHvBLmzFab5PXx8b87IKi0zrZMuJZX3sU3UuYjLQVDXjvDJJXd0PtFJz354s/2FFsSYTW+N020VGoR9edqRBbIQqxj+f0b9/YZwT5afDnCjucSRvxJLFLKkguTVVfzd8WSqblqJuuEYKlcldi5JcNspf9zGGLfLZbje2vuNelZjAp1Qi2tQsbcPctTwCD8sLEjK5wyY2ZxGYyxrj++RBQK/NThsnDB8nJmGwD+i3b5gf3yl+vtEd3lk9l9V1WLMEKy0q6jDiS2xtlwtPz2OVuDscdvrjcac5nuhsm95x6E429eHIfPH4CkKe10D6xEFZ8gfP2wrLCGEJRgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header window size\" title=\"\" src=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/6af66/header-window-size.png\" srcset=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/69538/header-window-size.png 160w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/72799/header-window-size.png 320w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/6af66/header-window-size.png 640w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/d9199/header-window-size.png 960w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/21b4d/header-window-size.png 1280w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/c7bb6/header-window-size.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The window size field contains a value representing the amount of data that can be transmitted at once. It can express values up to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>=</mo><mn>65535</mn></mrow><annotation encoding=\"application/x-tex\">2^{16} = 65535</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">16</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">65535</span></span></span></span></span>, and since the unit is bytes, the maximum window size is <code class=\"language-text\">64KB</code>.</p>\n<p>However, this maximum was set long ago and doesn’t always fit today’s high-capacity, high-speed communication environments. So a method of left-shifting the bits to increase the maximum window size is also used, with the number of shifts specified using the <code class=\"language-text\">WSCALE</code> field in the options.</p>\n<h3 id=\"checksum\" style=\"position:relative;\">Checksum<a href=\"#checksum\" aria-label=\"checksum permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/c7bb6/header-checksum.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVR42jWP2WrbQBhG9f7PU0qhpSm0pstVHJvUsSzZ2kf7LmtxdPproBcHZqRvG8NyFCrv6bqBoqypm45Wzk3bU9UtKk45mxfiJNPfsrzUmv9smryoKKuG4T5ivJ4dLDcmVAleoPBChX3zuDo+rh/hBhEqyYniTP+/uYHm9WRyOl9wvJCbaE3bIS8rDD9MdPu8PBinWZikrZaVPdO86FYVJ/hBKLqUfrhrCjFXdaM9m24UpnnGcH2l2zsRtf2gaSSsbjttcDwf6+oQRqJTMUma6ZItdBDGceIuDMIk4bIwRUUxWZqSClf7ii8hSgJSWZTIujIvmKX9scKyrvRiVhKcFiX3bd32OmESjIsvrb9+wM9vLH92LL+/k3/+QP7lI8PuK/3uie7pE+3fI21WUIcR4cUismxiKS/9gHELznImeZURpjnF9cb69sa7eWY1TebTifr5WdO+7GmEcr+nPhxojkfqlwOF3EfxrLbNu2WJ1+SRJPwD5hELaAgKsR8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header checksum\" title=\"\" src=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/6af66/header-checksum.png\" srcset=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/69538/header-checksum.png 160w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/72799/header-checksum.png 320w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/6af66/header-checksum.png 640w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/d9199/header-checksum.png 960w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/21b4d/header-checksum.png 1280w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/c7bb6/header-checksum.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The checksum is a value used to detect errors that may occur during data transmission.</p>\n<p>TCP’s checksum is generated by dividing the data to be transmitted into 16-bit chunks and adding them sequentially. The method is simple, but since looking at 16-bit additions would make the numbers painfully long, let me demonstrate with a simpler 8-bit example.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  11010101\n+ 10110100\n-----------\n 110001001</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Oops — adding two 8-bit numbers produced a 9-bit result with an extra digit. This overflow can’t fit in the checksum field.</p>\n<p>This extra digit that appears when adding two numbers is called a carry. Just take that carry bit, detach it from the result, and add it back:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  10001001\n+        1 (the overflowed bit)\n-----------\n  10001010</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This technique is called wrap-around. Now take the one’s complement of the final result, and you have the checksum. “One’s complement” might sound fancy, but it just means flipping all the bits.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">10001010\n01110101 (after taking one's complement)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Now <code class=\"language-text\">01110101</code> is the checksum for this data. In this example I used 8 bits, so an 8-bit checksum came out. In practice, the data is split into 16-bit chunks for this process, producing a value that fits perfectly into the 16-bit checksum field.</p>\n<p>The receiver, upon receiving the data, goes through the same process but stops before taking the one’s complement — at the value <code class=\"language-text\">10001010</code>. It then adds this value to the checksum sent by the sender. If all bits are 1, the data is considered valid.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  10001010\n+ 01110101\n-----------\n  11111111</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If even a single bit is 0, it indicates that something was altered in the data the sender transmitted.</p>\n<h3 id=\"urgent-pointer\" style=\"position:relative;\">Urgent Pointer<a href=\"#urgent-pointer\" aria-label=\"urgent pointer permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/555aeadb010efbf3bcfcac8043546218/c7bb6/header-urgent.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42jWPW2vcMBSE/f//TUMfmlBKIJRCCElzIdmu7V3LV1m25Kts2WtnciTow4eENGdmjhcyDi41xnGCajp0/YiB7v2g0XYDeFnh6AcoRe3eatk4zX+sRqoWTdtjmg289yNDGJfIuUCScSQ5xylKcGYp4rRAnBXgQqIoa/cfxZnj/eDjcAzAkhwRaf0Tg2xaeGkuXPp62WCWlVgoraOWGst6cam8FEiznHQV9DQ7FA23Xe9mrM4Qy7rCi1NO6RVGPTmTkegHu86AltZgcYLwHCEvrE5A1BKTWcjUuDBrOBP2zRq7hnalmhIr1eBMBgkN86qGkIoMFBQ1Xo3BRltcLtRaa3DSVNR4praG/iwL4YVRhiLJsNGQIQNDBuXpBBFF6HmJnlp1jEHfXmP+/Qv67ifEj2+orq8gb75joPft/g7bn1vsLw/w8kpCsRifvo8tCLCHIVa6d6+vjv7tzdE8PaF//ovh5RkdnerxEcvHBz4DH7t/xP7vgJ1zfAE0ggsWfcStyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header urgent\" title=\"\" src=\"/static/555aeadb010efbf3bcfcac8043546218/6af66/header-urgent.png\" srcset=\"/static/555aeadb010efbf3bcfcac8043546218/69538/header-urgent.png 160w,\n/static/555aeadb010efbf3bcfcac8043546218/72799/header-urgent.png 320w,\n/static/555aeadb010efbf3bcfcac8043546218/6af66/header-urgent.png 640w,\n/static/555aeadb010efbf3bcfcac8043546218/d9199/header-urgent.png 960w,\n/static/555aeadb010efbf3bcfcac8043546218/21b4d/header-urgent.png 1280w,\n/static/555aeadb010efbf3bcfcac8043546218/c7bb6/header-urgent.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>As the name suggests, this is an urgent pointer. If the URG flag is 1, the receiver prioritizes the data that this pointer references.</p>\n<h3 id=\"options\" style=\"position:relative;\">Options<a href=\"#options\" aria-label=\"options permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d6d70f7f103f663d79397716f4598afb/c7bb6/header-options.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfElEQVR42jWRbW/TQBCE/f//D7QqUFSoQJQUitQaN67T+P1sx+92YjtxHtYHfBjN6nZ2du7OcFyFynu6bk9R1tRNRyt10/ZUdYtKMtb2C0m602e7vNSa/1g0eVFRVg37w4Bhrl0cLyFSKX6o8CPFZuvz6gZ4QYwXxqg0J052ur/1Qg3TsrHWL7h+xFa09sYlLyuMIEr19ul4YhgnwSjbaknZM05HvVUlKUEYiS6j3x80Chmu6kbPLLpBME4ThhcoYpXJlXvattPcCNcirsTY83wcZ0MUxcSxIhXT/WLa7zUPw8hBli71KGF0QrUr2IlBKgavQYgv14/zglRSJEVJ0TSM88wJOAp6SaOkn4n+cJoZ5rPGKLXhePJGpsl5YzMtcNakP1ZkD/d0lklrPdGYj7S/n+ifTc1qdUdy/53s54r68dffOdtiCj2MqJCf/XYLN1ecv36CLzecbj/Svr+gEXQfLjWad2+FL+ivL3WvunrD9Pka/s0gM/PDHX8A7lcIgtr6L4IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header options\" title=\"\" src=\"/static/d6d70f7f103f663d79397716f4598afb/6af66/header-options.png\" srcset=\"/static/d6d70f7f103f663d79397716f4598afb/69538/header-options.png 160w,\n/static/d6d70f7f103f663d79397716f4598afb/72799/header-options.png 320w,\n/static/d6d70f7f103f663d79397716f4598afb/6af66/header-options.png 640w,\n/static/d6d70f7f103f663d79397716f4598afb/d9199/header-options.png 960w,\n/static/d6d70f7f103f663d79397716f4598afb/21b4d/header-options.png 1280w,\n/static/d6d70f7f103f663d79397716f4598afb/c7bb6/header-options.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The options field contains fields used to extend TCP’s functionality, and its length is variable rather than fixed. This is why the data offset field described above is needed — so the receiver can tell where the header ends and the data begins.</p>\n<p>I mentioned that the data offset field can represent values from 20 to 60 bytes. The header without any options — from Source Port through Urgent Pointer — is 20 bytes, and the maximum length of the options field is 40 bytes.</p>\n<p>If the data offset field’s value is greater than 5 (20 bytes) but no TCP options are being used, the excess bytes must be filled with zeros so the receiver can correctly determine the header size.</p>\n<p>Notable options include <code class=\"language-text\">WSCALE</code> for extending the maximum window size, <code class=\"language-text\">SACK</code> for using the Selective Repeat method, and roughly 30 other options — far too many to explain one by one here.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>That covers a brief TCP overview and its header structure. Admittedly, this only scratches the surface of TCP, but given that this is a nearly 50-year-old protocol, there’s far too much content to fit into a single post.</p>\n<p>As I mentioned at the start, protocols like TCP and IP are ones you rarely interact with directly unless you’re doing socket programming.</p>\n<p>But even without direct interaction, as a web developer who uses HTTP every day, I think it’s worth knowing how the protocols underlying your daily work actually operate.</p>\n<p>If you want to see how TCP is implemented in the kernel, you can check out the implementations in <a href=\"https://github.com/torvalds/linux/tree/master/net/ipv4\" target=\"_blank\" rel=\"nofollow\">linux/net/ipv4</a> in the Linux source on GitHub. (Fair warning — the Linux source itself is so massive that cloning it takes ages.)</p>\n<p>If you’d like to observe TCP communication firsthand, you can use a simple <a href=\"https://github.com/evan-moon/simple-tcp-example\" target=\"_blank\" rel=\"nofollow\">TCP example program</a> along with utilities like <code class=\"language-text\">tcpdump</code> and <code class=\"language-text\">netstat</code>. Use <code class=\"language-text\">tcpdump</code> to inspect the content of packets exchanged between client and server, and <code class=\"language-text\">netstat</code> to check the TCP states of the client and server.</p>\n<p>In the next post, I’ll cover TCP’s handshake process, flow control, and congestion control mechanisms.</p>\n<p>That concludes this post on what information is stored in TCP’s header.</p>","fields":{"slug":"20191110-header-of-tcpen","path":"/2019/11/10/header-of-tcp/en/","lang":"en"},"frontmatter":{"title":"What Information Is Stored in TCP's Header?","subTitle":"From packet switching to checksums — everything about the TCP header","date":"Nov 10, 2019","categories":["Programming","Network"],"tags":["TCP","Header","ECN","TCP Flags","SYN","ACK","TCP Header","Packet Switching","TCP Checksum"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/08849868fcdd6a15a88abb391dccacf7/d803c/thumbnail.png","srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/d803c/thumbnail.png 320w,\n/static/08849868fcdd6a15a88abb391dccacf7/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/fc5c5/thumbnail.webp 320w,\n/static/08849868fcdd6a15a88abb391dccacf7/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/08849868fcdd6a15a88abb391dccacf7/01fb2/thumbnail.png","srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"aa2d548e-4eb6-5e1b-804f-7cb6a2a8c809","tableOfContents":"<ul>\n<li>\n<p><a href=\"#a-brief-introduction-to-http3\">A Brief Introduction to HTTP/3</a></p>\n</li>\n<li>\n<p><a href=\"#why-is-tcp-considered-slow\">Why Is TCP Considered Slow?</a></p>\n<ul>\n<li><a href=\"#3-way-handshake\">3-Way Handshake</a></li>\n<li><a href=\"#holb-head-of-line-blocking\">HOLB (Head-of-Line Blocking)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#why-http3-uses-udp\">Why HTTP/3 Uses UDP</a></p>\n<ul>\n<li><a href=\"#udp-is-a-blank-canvas\">UDP Is a Blank Canvas</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-http3-improves-over-previous-protocols-by-using-udp\">How HTTP/3 Improves Over Previous Protocols by Using UDP</a></p>\n<ul>\n<li><a href=\"#reduced-latency-in-connection-setup\">Reduced Latency in Connection Setup</a></li>\n<li><a href=\"#faster-packet-loss-detection\">Faster Packet Loss Detection</a></li>\n<li><a href=\"#multiplexing-support\">Multiplexing Support</a></li>\n<li><a href=\"#connections-survive-ip-changes\">Connections Survive IP Changes</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n<li>\n<p><a href=\"#references\">References</a></p>\n</li>\n</ul>","excerpt":"HTTP/3 is the third major version of HTTP (Hypertext Transfer Protocol). Unlike HTTP/1 and HTTP/2, it communicates using QUIC, a UDP-based protocol. The biggest difference between HTTP/3 and its predecessors is that it runs on UDP instead of TCP. I first learned about HTTP/3 after reading a post so…","html":"<p>HTTP/3 is the third major version of HTTP (Hypertext Transfer Protocol). Unlike HTTP/1 and HTTP/2, it communicates using QUIC, a UDP-based protocol. The biggest difference between HTTP/3 and its predecessors is that it runs on UDP instead of TCP.</p>\n<p>I first learned about HTTP/3 after reading a post someone shared: <a href=\"https://blog.cloudflare.com/http3-the-past-present-and-future/\" target=\"_blank\" rel=\"nofollow\">HTTP/3: the past, the present, and the future</a>. My honest first reaction when I saw the title was:</p>\n<blockquote>\n<p>Wait, HTTP/2 was only released about 4 years ago. HTTP/3 already? Isn’t it just in the design phase?</p>\n</blockquote>\n<p>But after reading the post, I was surprised to learn that Google Chrome had already shipped a Canary build with HTTP/3 support — it was at the point where you could actually try it. It took roughly 15 years to go from HTTP/1 to HTTP/2, yet just 4 years later, the next major version was already usable.</p>\n<p>On top of that, the global adoption rate of HTTP/2 was still only around 40% at the time. That’s how recent HTTP/2 still was.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABKklEQVR42pWS2W6DMBBF+f8vzAPYHryUBLyw2NikD70JqJGatErR0WgYrrnjsatt287nZO2ntdc3ce46DGVZSjVNM2OjUkXK/BKlnil1HYchVuM4CTEZs2ldjHmBlIXogLHSNIVzLEazsQph5DxApHVu20z0gLFc14gr5ysiaNtVylUpJNH7m/N8OoWmge5QfEN0SLU+QL6/ChGdi9U8L2h73wzMn3neM4pEaXeeOB/3X8LnHaA8nLGYsXAf7P8XL0vkfHp1Hr/yaBt7xrT3tt8EAyO6O6eEwY445D+sftwZiOHsXKq893X9IYQlsm3rhBiI3B0rZUCCT1L6HaVQgcByPvS9h3OKMeacQ/BCcK0VkUBUSgohLpczcmN0132g3nWm7/t8e9aU0hd/j8r0CkmYvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ce http2\" title=\"\" src=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png\" srcset=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/69538/ce-http2.png 160w,\n/static/8a0a69c0fbc05eba2198cd4f552845d4/72799/ce-http2.png 320w,\n/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>HTTP/2 adoption rate as of August 2019, surveyed by W3Techs.com</small>\n</center>\n<p>With programming languages and frameworks, the publisher pushes an update and users upgrade — done. But protocols are agreements, requiring coordination between software vendors, so I assumed such rapid changes wouldn’t happen often.</p>\n<p>Technology moves fast, sure, but HTTP is a foundational web protocol. The fact that such a dramatic change happened in just 4 years was genuinely surprising. (Web developers who had just adopted HTTP/2 a few months earlier were in tears.)</p>\n<p>The other thing that surprised me was that HTTP/3 uses UDP instead of TCP. There’s no rule saying web protocols <em>must</em> use TCP, but from what we learn in school to what we use in practice, HTTP being defined on top of TCP was so deeply ingrained that using UDP felt novel. I couldn’t help but wonder: “Why abandon TCP when it works perfectly fine?”</p>\n<p>Technically, HTTP/3 hadn’t been formally released yet — it was still in the testing phase. But as mentioned above, Chrome already had a Canary build with HTTP/3 support, Mozilla Firefox was planning to support it in Nightly builds soon, and cURL was offering HTTP/3 as an experimental feature. It seemed very likely that HTTP/3 would become the main protocol in the near future.</p>\n<p>If you want to try HTTP/3 in Google Chrome, you can launch it from the terminal with the <code class=\"language-text\">--enable-quic</code> and <code class=\"language-text\">--quic-version=h3-23</code> flags:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">open</span> <span class=\"token parameter variable\">-a</span> Google<span class=\"token punctuation\">\\</span> Chrome <span class=\"token parameter variable\">--args</span> --enable-quic --quic-version<span class=\"token operator\">=</span>h3-23</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1d6e0c652510ca8a97827fff1fad7575/5a6dd/http3-demo.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACTElEQVR42lWRSXPTQBCF/QcgS0EVBwriRIvtaLVkS9Y20mixExNClkMqcQrHCVVw4sbff/S0i5AcXnVP98yn162elBK1rDB2bXiO9azAsxH6ziupWlNLnH1ZIokmnC+Xp8jSGXzXwjTw0Gtuf8NabPA5u4Em7qCVK+jVPd6Fl3jrfsWOd44d95zyc7yxz6i3woFYYZd6ZvMdo24DjWqmvMf7yRV6d7/+IOxuYJfXcOU1jotv+OgI7Bsz7GgRdrUYe5Tvmwl29RjD9Ayf/BZ7lFviAra4hFVcwKmu8MEq0fv5Y4OTroHIE8iygMgSBGQ/Ivtx6CEi+fYQI6PPytOYeyovixRS5BS3bz17gN7m8RGyaZHmAhmplA1yUUFUNeft/BRJlkM3DOi6jiTNEYRTOuvIihJFKSkK5GWFY8sm4GaDum7pYkbAAgXBFFhBgzBEOJnC98cM0zSN76m6rmtIs//3CwJaloXeIzmcL04IULKqmsanr6oLChaEEziuC88bwzBMBoZUM8hxzg4rioLfWDY5fHh4QNvNnyHxLEUQhPB8nx2ocSbTiOoJQ1R/HITsWPUKMrGNNPIxOVyv12jajoGy6Rg2Go34wdHREUuNqpMUMKV9KuemaTKEjRBU7dx2nC2wJtAsyXjctltgfrKE47gMeKntDnNeg/qgWpH4N3Iltzt8enqiP7lgoLqsonIxjWIMBoNXYof049QKTNNgSEnOlFNlRpngHfKBFt/vH+Dw8JBin0dVLl5KOZzQuK7rcT6NY96tihHF4XCEv+fijBWB+5EDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"http3 demo\" title=\"\" src=\"/static/1d6e0c652510ca8a97827fff1fad7575/6af66/http3-demo.png\" srcset=\"/static/1d6e0c652510ca8a97827fff1fad7575/69538/http3-demo.png 160w,\n/static/1d6e0c652510ca8a97827fff1fad7575/72799/http3-demo.png 320w,\n/static/1d6e0c652510ca8a97827fff1fad7575/6af66/http3-demo.png 640w,\n/static/1d6e0c652510ca8a97827fff1fad7575/5a6dd/http3-demo.png 802w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The entries showing http/2+quic/46 are connections using the HTTP/3 protocol</small>\n</center>\n<p>As a web developer, I couldn’t just ignore the fact that HTTP was getting a major update. I was also curious about what using UDP actually meant. So I dug into HTTP/3, and this post is a summary of what I found.</p>\n<h2 id=\"a-brief-introduction-to-http3\" style=\"position:relative;\">A Brief Introduction to HTTP/3<a href=\"#a-brief-introduction-to-http3\" aria-label=\"a brief introduction to http3 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>HTTP/3 was originally called “HTTP-over-QUIC.” Mark Nottingham, chair of both the HTTP and QUIC working groups within the IETF (Internet Engineering Task Force), proposed renaming the protocol to HTTP/3. The proposal was accepted in November 2018, and the name changed from HTTP-over-QUIC to HTTP/3.</p>\n<p>In other words, HTTP/3 is HTTP running on top of a protocol called QUIC. QUIC stands for “Quick UDP Internet Connection” — literally, a protocol that establishes internet connections using UDP. (It’s pronounced just like “quick,” by the way.)</p>\n<p>HTTP/3 uses QUIC, and QUIC uses UDP, so we can say HTTP/3 uses UDP.</p>\n<p>So what exactly is QUIC, and why can it achieve faster transmission speeds than TCP? To understand that, we first need to know why TCP is considered slow and what advantages UDP offers.</p>\n<h2 id=\"why-is-tcp-considered-slow\" style=\"position:relative;\">Why Is TCP Considered Slow?<a href=\"#why-is-tcp-considered-slow\" aria-label=\"why is tcp considered slow permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When I first learned about the differences between TCP and UDP in a networking class, my professor said it would definitely be on the exam, so I memorized this table:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Connection</td>\n<td>Connection-oriented</td>\n<td>Connectionless</td>\n</tr>\n<tr>\n<td>Packet exchange</td>\n<td>Virtual circuit</td>\n<td>Datagram</td>\n</tr>\n<tr>\n<td>Order guarantee</td>\n<td>Guaranteed</td>\n<td>Not guaranteed</td>\n</tr>\n<tr>\n<td>Reliability</td>\n<td>High</td>\n<td>Low</td>\n</tr>\n<tr>\n<td>Speed</td>\n<td>Slow</td>\n<td>Fast</td>\n</tr>\n</tbody>\n</table>\n<p>From this table, the takeaway is roughly “TCP is reliable but slow” and “UDP is unreliable but fast.” The “reliability” here refers to whether all data sent by the sender arrives intact at the receiver — by checking packet ordering, detecting packet loss, and so on.</p>\n<p>TCP uses several mechanisms to ensure reliable communication between client and server. But these mechanisms are themselves communications between client and server, so they inevitably add latency. And since these processes have been part of the TCP standard since its inception, you can’t just skip them.</p>\n<p>To reduce latency, you’d need to touch things outside of TCP’s defined features — but there are many constraints. No matter how much you increase bandwidth, the data we need to transmit keeps growing with advancing technology, so things will eventually get slow again. And even if you increase the raw transmission speed, you can’t go faster than the speed of light.</p>\n<p>This is exactly why HTTP/3 chose QUIC, a UDP-based protocol — it opted to modify the protocol itself to overcome these constraints. But TCP is such an old protocol, deeply defined at the low level down to the kernel, that overhauling it would be a massive undertaking. So they chose UDP instead.</p>\n<p>Let’s look at why the mechanisms TCP uses for reliable communication are considered slow.</p>\n<h3 id=\"3-way-handshake\" style=\"position:relative;\">3-Way Handshake<a href=\"#3-way-handshake\" aria-label=\"3 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP is an extremely polite protocol. Before starting or ending communication, it always asks whether both sides are ready, establishes packet ordering, and only then begins the actual data transfer.</p>\n<p>The process at the start of communication is called the 3-Way Handshake, and the process at the end is called the 4-Way Handshake. Since the purpose of this post isn’t to cover these in detail, I’ll only explain how the 3-Way Handshake works.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA9gAAAPYAF6eEWNAAACX0lEQVR42k1S227aQBD1//9EH/LQqhSpJNCE2IAvwXfWxvLd611fARHRgBSJW7A7wEvnYTS7O2fm7JlhTqdz27bb7Ycyldfr9fl8Ph6OTdO0/9nlcjkcDvCUpqltWbvdDhLgyCiKMpnwgiAihBzHCYIA/HK5BExzMwjKspzP557n2bataxrPC7wgTmWZEUW+8/MHxw0JwUmSYJwAvijKe8M7OM/zoijquoaiGGOOe+12O5I0YTx3riqS50Fpa2bOLAuZpllV9b0zwCEAtsPhkGVfx+NxHMfI1gWB8/w5A5TCMABKPM8PBgOWZf88PyfJtfNqtd5sPiAghMg3myGUxFhjPfaXYk19JooSWdaCIPZ93zCN668MI4qK/b5FqAj81R2sqSo8aRpkhqHrz3QjDkOGZdHDw/CpP03iCKGZaRqSJOVZBpjPz/3m7+fHtuUnCc9PBFBVkqIoTlLsuE61qJk0jZGlJ0kI5YG8YRij0SjPr+C5EUQOaY+thzA34uAevmZb9nOH6357El5Epi7r0I/LvAIlQBhCKQTEq067dk3279m+OYPaWYpxlmWQQAn1HM9UjSgIGNVRBmJ/oo+kN1EUhF7vd78/sJTqcmqrugbNrmpj/PjYAy0ty8rynGTE9d2yKpmRMey9dYbqE6UpMAflXc+lWXk8tba9CIJ3AGNMQSdCKDSnlBa0DNxgUS2YZb1c1Svwt03Iq6oCbuAB8/XVnE7NdttOp1TTVF3XLdvGBI8MtjvuyPM3BrZihkzQ2brZdVS6fgffFqy5jYrK8hTmZJowI7037na57y/C4z+QeJZeh7viqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way handshake\" title=\"\" src=\"/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png\" srcset=\"/static/dd7f29fecd14fe5feebc6cf562123c48/69538/3way-handshake.png 160w,\n/static/dd7f29fecd14fe5feebc6cf562123c48/72799/3way-handshake.png 320w,\n/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The 3-Way Handshake process when starting communication</small>\n</center>\n<p>As shown above, when a client first creates a TCP connection to a server, they exchange <code class=\"language-text\">SYN</code> and <code class=\"language-text\">ACK</code> packets. The values inside these packets allow client and server to verify packet ordering and confirm that packets were properly received.</p>\n<p>This process requires 3 round trips of communication. If you’re on macOS or Linux, you can observe this process directly using the <code class=\"language-text\">tcpdump</code> utility in your terminal.</p>\n<p>Note that running <code class=\"language-text\">tcpdump</code> without options will monitor all packets on the device, making it hard to find what you want. So I captured only the communication with a blog server running on loopback:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> tcpdump <span class=\"token function\">host</span> localhost <span class=\"token parameter variable\">-i</span> lo0\nIP localhost.53920 <span class=\"token operator\">></span> localhost.terabase: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1260460927</span>, win <span class=\"token number\">65535</span>\nIP localhost.terabase <span class=\"token operator\">></span> localhost.53920: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3009967847</span>, ack <span class=\"token number\">1260460928</span>, win <span class=\"token number\">65535</span>\nIP localhost.53920 <span class=\"token operator\">></span> localhost.terabase: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">3009967848</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>sender > receiver: Flags [flag type], header values</p>\n</blockquote>\n<p>The original output contains more information, but I’ve trimmed it to what’s needed for the explanation. The key fields here are <code class=\"language-text\">Flag</code>, <code class=\"language-text\">seq</code>, and <code class=\"language-text\">ack</code>. Let’s break them down.</p>\n<p><code class=\"language-text\">localhost.53920</code> is the client, and <code class=\"language-text\">localhost.terabase</code> is the server. Each line’s first field shows <code class=\"language-text\">sender > receiver</code>, so the first packet is from client to server, the second from server to client. Each line also has a <code class=\"language-text\">Flag</code> that indicates what type of packet it is:</p>\n<table>\n<thead>\n<tr>\n<th>Flag</th>\n<th>Name</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>S</td>\n<td>SYN</td>\n<td>Client sends a sequence number to the server to initiate connection</td>\n</tr>\n<tr>\n<td>S.</td>\n<td>SYN-ACK</td>\n<td>Server generates an ACK value and responds to the client</td>\n</tr>\n<tr>\n<td>.</td>\n<td>ACK</td>\n<td>Response using the ACK value</td>\n</tr>\n</tbody>\n</table>\n<p>After this communication, client and server can establish a reliable TCP connection. Since it takes 3 exchanges, it’s called a 3-Way Handshake.</p>\n<p>What happens during this process that creates a reliable connection? Looking more closely, the client and server go through roughly this flow:</p>\n<blockquote>\n<p>Line 1: Client sends a sequence number in the <code class=\"language-text\">seq</code> field to the server<br />\nLine 2: Server increments the client’s sequence number by 1 and sends it back in the <code class=\"language-text\">ack</code> field<br />\nLine 3: Client increments the server’s sequence number by 1 and sends it back in its own <code class=\"language-text\">ack</code> field<br /></p>\n</blockquote>\n<p>The 3-Way Handshake begins when a client sends a random sequence number to the server to create a new TCP connection. This sequence number later serves as the ordering guide when the receiver reassembles packets from the sender.</p>\n<p>Both client and server increment the received <code class=\"language-text\">seq</code> (sequence number) by 1 and place it in their own <code class=\"language-text\">ack</code> (acknowledgment number) field, essentially saying: “This packet follows the sequence number you sent earlier.”</p>\n<p>These 3 exchanges are the 3-Way Handshake. Through this process, client and server inform each other that they’re ready to exchange data and establish the sequence numbers needed for subsequent data transfer. Ending a connection goes through a similar 4-Way Handshake process, requiring 4 exchanges.</p>\n<p>In short, as long as you’re using TCP, you must go through this tedious process before any real communication can begin.</p>\n<p>HTTP/1 processed only one request per TCP connection and then closed it, so this handshake had to happen with every single request. HTTP/2 changed this by maintaining a single TCP connection and handling multiple requests over it, minimizing handshakes.</p>\n<p>Even in the transition from HTTP/1 to HTTP/2, the handshake process itself was left untouched — they only minimized how often it occurred to reduce latency. This is because handshaking is mandatory as long as TCP is in use.</p>\n<p>HTTP/3, however, chose UDP, eliminating the handshake process entirely and securing connection reliability through other means.</p>\n<h3 id=\"holb-head-of-line-blocking\" style=\"position:relative;\">HOLB (Head-of-Line Blocking)<a href=\"#holb-head-of-line-blocking\" aria-label=\"holb head of line blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There’s another problem with HTTP over TCP: Head-of-Line Blocking (HOLB). While HTTP-level HOLB and TCP-level HOLB technically mean different things, they share the same essence — a bottleneck in one request increases overall latency.</p>\n<p>In TCP communication, packets must be processed in exact order. The receiver must reassemble packets using the sequence numbers exchanged with the sender.</p>\n<p>If a packet is lost mid-transmission, the data can’t be fully reassembled, so it’s never ignored. The sender must confirm that the receiver got every packet, and if any packet wasn’t received, it must be retransmitted.</p>\n<p>Since packets must be processed in order, subsequent packets can’t be processed until previous ones are parsed. When a packet is lost or the receiver’s parsing speed is slow, this bottleneck is called “HOLB.” This is a fundamental TCP issue affecting not just HTTP/1 but HTTP/2 as well.</p>\n<p>To solve these problems, HTTP/3 chose to run on QUIC, a protocol built on UDP. Let’s now look at what QUIC actually is and what advantages UDP offers over TCP.</p>\n<h2 id=\"why-http3-uses-udp\" style=\"position:relative;\">Why HTTP/3 Uses UDP<a href=\"#why-http3-uses-udp\" aria-label=\"why http3 uses udp permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Since HTTP/3 runs on QUIC, understanding HTTP/3 means focusing on QUIC. QUIC is a UDP-based protocol developed by Google to solve TCP’s problems and break through latency limitations.</p>\n<p>QUIC was designed from the start with a focus on optimizing TCP’s handshake process, and it achieved this by using UDP.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/e8950/quic.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 87.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3klEQVR42o1U/UuTURT2H4gI+iGTgqB+S5McFqlJZDaz0LK0NHSpSYkmlbNiH1okiC00h6SULjQykrWK/MyVpqFoUzIlNXP4rdkHfmzpdren+95t2mxbXTjcc+8553mfe597XjcAC86MEOJy/YfNUTNTq3eDk2E2m9k8O69DQ1sX5nR6u/1VucTqNrs5A1oyGFHV1IYD0Slw38lHcEwq6lo6/spzCWhL0v1axCNVDbb5H8WWM2Lwyt9ia4IEG31CEHvxBj4OaO3yHQISk4nNlbWNOJYsQux1OQIq3oHXoIVPqRretYPg0dmDL8Am/wg8a2hZrnMMSCyAIlkx1vidgG/TGHaUqBEnkiFbdhfh6TnwftCIXXTf/aAA4tvF1jriGlCadx/r/I5jj6oLPGUnAkUFEOYWoVjxGOICBUIVdVgbEIVMmucS0GQ98vuefuyLuYANu8OwXVIEn5p+eKk+4EihElLKPrdQAQkF0/QMWOvM/xZlnj6RgjIlPPdHwSM4Dl6Z97CeHtPrsACvWjv/X2X2RZpoYzsyNYNLN+XwDDoJYbYco5Nfl0/DMXMKaDQa6bszMDMaLTFuNlkUxMTMj+VXwOXY2Blo3aKlzjnD1VdgY8sxMjnoEocMa5vbkZyVTy0P1bQ7uPHpyzCKKl4wv6SyCh3dfcyXlz/F1Mx35iuUNUgQ3YL0jmIFUE+7IiA6FWWqOjx8Xg/fiHMs8rpVg9CzV5gfmZbFYtwIPJ0G7dgkej9rWZ2qvhnqVs0K4NyCHv6nUjAyMY3x6W8IElxmkTf0h8BPyGB3GU47p+Klmu3z44VMHE1vP0ISM8ARon1vd2STJL+U0CA5lHSVbN4bSdq7+8jP2XkSK8wmYedFJCJVSgaHx4mRvuL4azmEMiQLOj1JFOWS4Ph0kiSWLVlFb2R3aLaagXZLS2cPhkYnV0Qxc7Nz4bg4FcyO4RDVcQirjJKxW1O1Xa0HqXEsnvwGZ3Pl7+F/khcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"quic\" title=\"\" src=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/6af66/quic.png\" srcset=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/69538/quic.png 160w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/72799/quic.png 320w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/6af66/quic.png 640w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/d9199/quic.png 960w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/21b4d/quic.png 1280w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/e8950/quic.png 2000w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<p>As the name “User Datagram Protocol” suggests, UDP uses a datagram approach with independent packets that have no inherent ordering. Since datagrams only need a destination — they don’t care about the intermediate path — there’s no end-to-end connection setup either. In other words, no handshake is needed.</p>\n<p>The bottom line is that UDP is faster because it skips the many steps TCP takes to ensure reliability. But does using UDP mean we lose the reliability and data integrity that TCP provided?</p>\n<p>No. Even with UDP, you can implement all the features TCP has. UDP’s real advantage is that it’s highly customizable.</p>\n<h3 id=\"udp-is-a-blank-canvas\" style=\"position:relative;\">UDP Is a Blank Canvas<a href=\"#udp-is-a-blank-canvas\" aria-label=\"udp is a blank canvas permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In school, I was taught that the biggest difference between UDP and TCP is “UDP is faster but less reliable than TCP.” This is half right and half wrong.</p>\n<p>UDP has no features defined beyond data transmission itself, so it’s true that the protocol doesn’t guarantee reliability on its own. But put differently, it’s a blank-slate protocol with nothing but data transmission capability. To get a sense of how many features TCP packs in for reliability and congestion control, just look at its header:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42j2P147CMBRE8/9/x4IQkEKq4zi9YofA7NjS7sOR43jKvV6YSMh2xbJs6PoR47Rg5vc0rxjGGbKq8fADVKpx/5q2d5o/rKbtBvTDhO2l4V0fCcK0gpAKWSGRCYkozvBMcqR5ibQoIVWLsmrce5wWjuvNx+0RIMkEYmr9KEHbD/ByoVz7/j6gzU4M20ZOucLsb9cqK4W8ENTVWLeXo6N5GCfnsTpNzL7DS3PJ9hrLurmQhUyzXWfGwDWSNEMYPSFK6mQFVTeuxIZuRGuDF9mIYbib0K7UsLHuejwZkNEsaVRtB9W06DiJOQ4c3y/eZKXZvlv9y05ntyOGeGFcoMwKHFxTM0A3HaoogopjTJxoYvggSow8F65uTxGEKMOIuif6vIC2wSw23MwTNSdIUnx9H0cQ4BOG2Pk9ns+O6XJx9KfT/338OaPjXd/v+LLcej7WrxR+AYjFDnQh+N9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp header\" title=\"\" src=\"/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png\" srcset=\"/static/ac69210c44cd473bcb737665d590b124/69538/tcp-header.png 160w,\n/static/ac69210c44cd473bcb737665d590b124/72799/tcp-header.png 320w,\n/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png 640w,\n/static/ac69210c44cd473bcb737665d590b124/d9199/tcp-header.png 960w,\n/static/ac69210c44cd473bcb737665d590b124/21b4d/tcp-header.png 1280w,\n/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>TCP's header, already packed with information</small>\n</center>\n<p>TCP was designed a long time ago and includes so many features that its header is nearly full. If you want to implement custom features beyond TCP’s built-in ones, you’d use the <code class=\"language-text\">Options</code> field at the bottom, but since it can’t grow infinitely, it’s capped at <code class=\"language-text\">320 bits</code>.</p>\n<p>And the later-defined options like <code class=\"language-text\">MSS (Maximum Segment Size)</code>, <code class=\"language-text\">WSCALE (Window Scale Factor)</code>, and <code class=\"language-text\">SACK (Selective ACK)</code> already take up most of that options space, leaving barely any room for custom features.</p>\n<p>UDP, on the other hand, was designed with a sole focus on data transmission, so its header is practically empty:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/73dae/udp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.750000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAq0lEQVR42j2O226DMBAF+f/P60vTkNoO2GAuBoxNopJEky1S+zDSzh7tpVCVx0+ZdLszxcSSNtbtfhDzjXlN6KpGXesjiykTpoW4Zqm3gzmuTHNkkfnio3Qo7QjW4U1Nf7U0yqBOZ5pvg9cVvfQ7wTUdVqidp7Ytn6eS8qKxbU8l/kvRjYEwjOxy5WeJPOSjLN5q8+9/2T6OPIVXCOz9QPt1Zjbm8KfseQwDb9HI4QyOb6OzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"udp header\" title=\"\" src=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/6af66/udp-header.png\" srcset=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/69538/udp-header.png 160w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/72799/udp-header.png 320w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/6af66/udp-header.png 640w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/d9199/udp-header.png 960w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/21b4d/udp-header.png 1280w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/73dae/udp-header.png 2122w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Compared to TCP, UDP's header is noticeably bare</small>\n</center>\n<p>UDP’s header contains only source port, destination port, packet length, and checksum. The checksum is used for verifying packet integrity, but unlike TCP’s mandatory checksum, UDP’s checksum is optional.</p>\n<p>In other words, while the UDP protocol itself is less reliable than TCP and lacks flow control, depending on how a developer implements the application layer, it can achieve TCP-like functionality.</p>\n<p>Sure, it’s convenient that TCP provides all those reliability features out of the box. But the unfortunate part is that these features are mandatory processes defined in the protocol itself — developers can’t customize them. This makes it nearly impossible to even attempt reducing the latency they introduce.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e0bf6f0a79b033925a91b04e4653d7af/e2310/tcp-tls.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 102.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADtklEQVR42s2TbUxTVxjHsWwuRMbclmWGKZoN3USigsFJ1A9kWZZJsixmbPHLFr84i2lLaUtf0uaEVpcimkDGQjYVBTK23ESBZnTicLp0AtG2lL5cyu1tb+9tb6G0lHaoHVR6dm4DRnRu9sOSneRJ7n2ec375n/P8n5yc/3IJBIICoVC4VSqVviWRSDbX1dW9WV9fvwnlihoaGjbKZLJCPp+/icuLRKL1y7XX0dE1q0AYBnO5UCi+elUuB1sAABuXgeUItEOr1W7V6XSb1Wr1dg4gFovfUCj4LwOgL5LJQCGEMBfFc6uhN0C+sllZqmxVvsb9Awh5T7sJBA9rPK1Wv0MJwDurNty5M9kyMkzYzL/jt1wW0jwViQ5csAY+PKb/9iUPjpcHg8GjDMMcpWm6hts/KLlcCnJq1vqmUx8RzPwEPX3PNhVJVj0Edl2yD7WfGoEXVFdT174zw5nYQqSfjB/JqEkmtyDYCYIgakmSPIYxWF5Pbc+7bvsUFp39M3U/uZRegjAdu5uC1vEZUQbonIgPOYgktDHzKR99D17rsET7iOgn3cbRAjYQEPn9/hORSIQfDoWlOIl/0S3o3nf7FiO1k3+kTWb2wc1RJm3xJhZ/tYU/yABn5lP6u6kl08JS2hhL3L9uHqaw86OB6isDv2xDykQul+szpPJjpPBIcDpY2av6abegWPDCb65Eo2ViDjqJWMpiC9X//YNDmLGA6opzby1oy08kIm+zLNuAVMpCodCXXK1H3ldmbDUWcN9zc3D3/AIs5c4hd/BWIJm2c2E2w+e5nOZHR8U57OorLEsfQCA+RVHHUVOOOwlnyQ+NvQe7JF3rHhPC+0eFwnOWnSMWx3afz/cNUncKx3Hd+Ph4u5/xSzvVxrK2Wiz/ETG5T52WFaCmw1oRjieLY+Hwrng8vndxcbECXf2g1z9Z/XO36dOaErD2mcZv5R1Of2+vnJ6Jtnk9nkuoGc1ut/uM3W4/zYYCHe7bDHhi3P5NoeKMaU9np6Fo0uU6xCmbnZ3dj6xTheobWoT9O8/L+l7MCqhqGiqn6UghgjUiy+i9Xq+OcBOtoXDg8681hspmyeC6rIBy7c0yg8FUhOPOk6jDOnRlDUGQzYEQdbhJZihvAzfyswJqNIN7jEaigKI8VUhdNTL3IYfNcdiOW99vaex976x4OC8roFp+fZfTSpSQpAfzeDw9KNopyt8ZYOm6JtXQsytEyAwQKAa2XbyIbRgbG1u/bHreit+Aor/4rBjLy/k/rDXZnvgLm+tNcqo265oAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp tls\" title=\"\" src=\"/static/e0bf6f0a79b033925a91b04e4653d7af/6af66/tcp-tls.png\" srcset=\"/static/e0bf6f0a79b033925a91b04e4653d7af/69538/tcp-tls.png 160w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/72799/tcp-tls.png 320w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/6af66/tcp-tls.png 640w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/d9199/tcp-tls.png 960w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/e2310/tcp-tls.png 968w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If you add TLS on top of TCP, you have to go through all of this before communication even begins</small>\n</center>\n<p>To reduce latency, you’d need to modify things outside the protocol. But as I mentioned, the areas a typical developer can touch in the communication process are limited. (We just have to wait for the telecom giants to lay down the infrastructure.)</p>\n<p>If the difference between TCP and UDP still isn’t clicking, think of it as “a heavy, full-featured library” versus “a lightweight library with only the essentials.”</p>\n<p>For example, <a href=\"https://lodash.com/\" target=\"_blank\" rel=\"nofollow\">lodash</a> in the JavaScript world is incredibly feature-rich and convenient, but most people don’t use every single method. It’s handy, but you’re bundling features you’ll never use.</p>\n<p>A small library with a single purpose has fewer features than lodash, but you can pick exactly what you need. The tradeoff is that anything the library doesn’t support, you have to implement yourself. In this analogy, lodash is TCP and the small single-purpose library is UDP.</p>\n<p>This is why Google chose UDP when building QUIC: TCP was too difficult to modify, and the blank-slate nature of UDP made it easy to extend QUIC’s capabilities.</p>\n<h2 id=\"how-http3-improves-over-previous-protocols-by-using-udp\" style=\"position:relative;\">How HTTP/3 Improves Over Previous Protocols by Using UDP<a href=\"#how-http3-improves-over-previous-protocols-by-using-udp\" aria-label=\"how http3 improves over previous protocols by using udp permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>So far we’ve briefly covered why QUIC, the backbone of HTTP/3, chose UDP over TCP. What concrete benefits does using UDP actually bring? Is HTTP/3 truly better than the old HTTP + TCP + TLS approach?</p>\n<p>The answer can be found in the Chromium Projects’ <a href=\"https://docs.google.com/document/d/1gY9-YNDNAB1eip-RTPbqphgySwSNSDHLq9D5Bty4FSU/edit\" target=\"_blank\" rel=\"nofollow\">QUIC Overview</a> document. Let’s look at the advantages Google describes.</p>\n<h3 id=\"reduced-latency-in-connection-setup\" style=\"position:relative;\">Reduced Latency in Connection Setup<a href=\"#reduced-latency-in-connection-setup\" aria-label=\"reduced latency in connection setup permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since QUIC doesn’t use TCP, it doesn’t need the tedious 3-Way Handshake to start communication. A cycle where the client sends a request and the server processes and responds is called an “RTT (Round Trip Time).” TCP requires at least 1 RTT to create a connection, and if you add TLS encryption, the TLS handshake adds up to a total of 3 RTTs.</p>\n<p>QUIC, on the other hand, requires only 1 RTT for the initial connection setup. The client sends a signal to the server, the server responds, and real communication begins immediately. The connection setup time is roughly halved.</p>\n<center>\n  <img src=\"/95f5c7e411d0b7f96d182abe284be551/gcp-cloud-cdn-performance.gif\" width=\"100%\">\n  <br>\n</center>\n<p>How is this possible? The reason is simpler than you’d expect. During the first handshake, QUIC sends the data along with the connection setup information. TCP + TLS exchanges all the information needed for a reliable connection and encryption, validates it, and <em>then</em> exchanges data. QUIC just fires off the data immediately.</p>\n<p>This process is explained in detail in the session ”<a href=\"https://youtu.be/vXgbPZ-1-us\" target=\"_blank\" rel=\"nofollow\">How Secure and Quick is QUIC?</a>” presented at the 2015 IEEE Symposium.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe title=\"\" src=\"https://www.youtube.com/embed/vXgbPZ-1-us?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" loading=\"eager\" allowfullscreen=\"\" sandbox=\"allow-same-origin allow-scripts allow-popups\"></iframe> </div> </div></p>\n<center>\n  <small>Start watching from 3:33.<br />The presenter's swagger, hand in pocket, is hard to miss.</small>\n  <br />\n  <br />\n</center>\n<p>The key point of the video is this: TCP + TLS must exchange session keys and establish an encrypted connection before data can be exchanged with those session keys. QUIC can exchange data <em>before</em> session keys are even exchanged, which is why connection setup is faster.</p>\n<p>However, when a client sends its first request to the server, it doesn’t yet know the server’s session key. So it encrypts the communication using an Initial Key generated from the destination server’s Connection ID. For a detailed explanation, see the QUIC working group’s <a href=\"https://quicwg.org/base-drafts/draft-ietf-quic-tls.html#rfc.section.5.2\" target=\"_blank\" rel=\"nofollow\">Using TLS to Secure QUIC</a> document.</p>\n<p>Once a connection succeeds, the server caches the configuration and uses it for the next connection, enabling communication to start with 0 RTT. This is how QUIC achieves lower latency compared to TCP + TLS.</p>\n<p>Note that this session was presented before TLS 1.3 was released, so it wasn’t mentioned. Today, using TCP Fast Open with TLS 1.3, you can achieve a similar connection setup process, giving TCP some of the same benefits.</p>\n<p>However, TCP SYN packets are limited to about <code class=\"language-text\">1460 bytes</code> per packet, while QUIC can include all the data in the first round trip. So for large payloads, QUIC still has the advantage.</p>\n<h3 id=\"faster-packet-loss-detection\" style=\"position:relative;\">Faster Packet Loss Detection<a href=\"#faster-packet-loss-detection\" aria-label=\"faster packet loss detection permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Like TCP, QUIC also needs flow control for transmitted packets. Both QUIC and TCP are fundamentally ARQ-based protocols — ARQ (Automatic Repeat Request) means recovering from errors through retransmission.</p>\n<p>TCP uses “Stop and Wait ARQ”: after sending a packet, the sender starts a timer, and if the receiver doesn’t respond within a certain time, the packet is considered lost and retransmitted.</p>\n<p>According to Google’s 2017 <a href=\"https://datatracker.ietf.org/doc/draft-ietf-quic-recovery/?include_text=1\" target=\"_blank\" rel=\"nofollow\">QUIC Loss Detection and Congestion Control</a>, QUIC detects packet loss similarly to TCP but with several improvements.</p>\n<p>A major issue with TCP’s packet loss detection is dynamically calculating how long to wait after sending a packet — when to trigger a timeout. This timeout is called the RTO (Retransmission Time Out), and the data it needs is a collection of RTT (Round Trip Time) samples.</p>\n<p>You measure how long it takes to receive an acknowledgment after sending a packet, then dynamically determine the timeout. To measure RTT samples, you must receive an ACK from the sender. Under normal conditions this isn’t a problem, but when a timeout occurs and a packet is retransmitted, the RTT calculation becomes ambiguous:</p>\n<blockquote>\n<p>Send packet → Timeout → Retransmit packet → ACK received!<br />\n(But is this ACK for the first packet or the second one?)</p>\n</blockquote>\n<p>To determine which packet the ACK corresponds to, you need additional methods like timestamps on packets, plus extra packet inspection. This is called Retransmission Ambiguity.</p>\n<p>To solve this, QUIC assigns a separate packet number space in its header. This packet number represents only the transmission order itself. Unlike sequence numbers (which remain the same on retransmission), packet numbers increase monotonically with each transmission, making it possible to clearly identify packet ordering.</p>\n<p>With TCP, if timestamps are available, you can determine transmission order through them. If not, you’re left implicitly inferring order from sequence numbers. QUIC eliminates this unnecessary ambiguity through unique per-packet numbers, reducing the time needed for packet loss detection.</p>\n<p>QUIC uses roughly 5 additional techniques to speed up packet loss detection. For details, I recommend reading Chapter “3.1 Relevant Differences Between QUIC and TCP” in <a href=\"https://datatracker.ietf.org/doc/draft-ietf-quic-recovery/?include_text=1\" target=\"_blank\" rel=\"nofollow\">QUIC Loss Detection and Congestion Control</a>.</p>\n<h3 id=\"multiplexing-support\" style=\"position:relative;\">Multiplexing Support<a href=\"#multiplexing-support\" aria-label=\"multiplexing support permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Multiplexing is crucial because it prevents the HOLB problem mentioned earlier as a TCP drawback. With multiple streams, even if packets are lost in one stream, only that stream is affected — the others continue running fine.</p>\n<p>Note that multiplexing doesn’t mean creating multiple TCP connections. It’s a technique for sending multiple data flows without mixing them up within a single connection. Each individual data flow is called a stream.</p>\n<p>HTTP/1 used only one stream per TCP connection, so it couldn’t escape the HOLB problem. And since the connection closed after each transfer, you had to go through the handshake all over again.</p>\n<p>The <code class=\"language-text\">keep-alive</code> option could maintain a connection for a certain time, but if there was no access within that window, the connection would still close.</p>\n<p>HTTP/2 introduced multiplexing — handling multiple streams within a single TCP connection — to boost performance. With a single TCP connection carrying multiple data transfers, the number of handshakes dropped and data transfer became more efficient.</p>\n<center>\n  <img src=\"/40cb0bc1d62eba25c2e351d213d1700d/multiplexing.svg\">\n  <br>\n  <small>HTTP/3 supports the same multiplexing as HTTP/2.</small>\n  <br>\n  <br>\n</center>\n<p>QUIC also supports multiplexing like HTTP/2, carrying over these benefits. Even if one stream encounters a problem, the other streams are unaffected.</p>\n<h3 id=\"connections-survive-ip-changes\" style=\"position:relative;\">Connections Survive IP Changes<a href=\"#connections-survive-ip-changes\" aria-label=\"connections survive ip changes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP identifies connections using the source IP and port plus the destination IP and port. If the client’s IP changes, the connection breaks. A broken connection means going through the tearful 3-Way Handshake all over again, adding more latency.</p>\n<p>This is especially noticeable today because people frequently use mobile internet — switching from Wi-Fi to cellular, or moving between different Wi-Fi networks, all of which change the client’s IP.</p>\n<p>QUIC, on the other hand, uses a Connection ID to establish connections with the server. A Connection ID is just a random value completely unrelated to the client’s IP, so even if the client’s IP changes, the existing connection is maintained. This means you can skip the handshake that would otherwise be needed to create a new connection.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>To properly explain HTTP/3 and QUIC, foundational networking knowledge is essential, so there were parts that were hard to cover in depth in this single post. I tried to be as detailed as possible, but the post was getting quite long, so I had to trim things down.</p>\n<p>After studying HTTP/3 and digging through various resources, my main takeaway was: “How did so much change?” Granted, once you throw out TCP, a lot is bound to change. But as someone who had only adopted HTTP/2 a few months earlier, it was a bit overwhelming. (The fact that they built HTTP but threw out TCP still blows my mind.)</p>\n<p>Honestly, whether developers use HTTP/2 or HTTP/3, users in countries with excellent internet infrastructure might not notice much difference. The small geographic size and strong infrastructure can cover up handshake latency and then some. But in countries with weaker infrastructure, the difference could be quite significant.</p>\n<p>In this post, I only talked about the advantages of HTTP/3 and UDP. Many people are concerned about abandoning TCP for UDP, and of course no technology is perfect — there will be issues.</p>\n<p>But as an attempt to break through the limitations of existing HTTP and TCP, it seems like a great move.</p>\n<p>That concludes this post on why HTTP/3 chose UDP.</p>\n<h2 id=\"references\" style=\"position:relative;\">References<a href=\"#references\" aria-label=\"references permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><a href=\"https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46403.pdf\" target=\"_blank\" rel=\"nofollow\">The QUIC Transport Protocol: Design and Internet-Scale Deployment</a></li>\n<li><a href=\"https://medium.com/codavel-blog/quic-vs-tcp-tls-and-why-quic-is-not-the-next-big-thing-d4ef59143efd\" target=\"_blank\" rel=\"nofollow\">QUIC vs TCP+TLS - and why QUIC is not the next big thing</a></li>\n<li><a href=\"https://blog.cloudflare.com/http3-the-past-present-and-future/\" target=\"_blank\" rel=\"nofollow\">HTTP/3: the past, the present, and the future</a></li>\n<li><a href=\"https://www.saturnsoft.net/network/2019/03/21/quic-http3-1/\" target=\"_blank\" rel=\"nofollow\">QUIC과 HTTP/3 - 1.UDP기반 전송 프로토콜의 대두</a></li>\n<li><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"nofollow\">QUIC, a multiplexed stream transport over UDP</a></li>\n<li><a href=\"https://quicwg.org/base-drafts/draft-ietf-quic-tls.html#rfc.section.5.2\" target=\"_blank\" rel=\"nofollow\">Using TLS to Secure QUIC</a></li>\n<li><a href=\"https://blog.cloudflare.com/the-road-to-quic/\" target=\"_blank\" rel=\"nofollow\">The Road to QUIC</a></li>\n</ul>","fields":{"slug":"20191008-what-is-http3en","path":"/2019/10/08/what-is-http3/en/","lang":"en"},"frontmatter":{"title":"Why Did HTTP/3 Choose UDP?","subTitle":"The web standard is changing. HTTP/3 picks UDP for speed.","date":"Oct 08, 2019","categories":["Programming","Network"],"tags":["HTTP3","TCP","UDP","Network"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/3a812/thumbnail.jpg","srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/3a812/thumbnail.jpg 320w,\n/static/70cbe98ca5682a8f70aa5afe9a5533ed/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/fc5c5/thumbnail.webp 320w,\n/static/70cbe98ca5682a8f70aa5afe9a5533ed/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/2d839/thumbnail.jpg","srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"f08092c0-752e-5a85-b744-a8fbd1d140b6","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-does-synchronous-actually-mean\">What Does Synchronous Actually Mean?</a></p>\n<ul>\n<li><a href=\"#understanding-the-nuance-of-the-word\">Understanding the Nuance of the Word</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#synchronous-in-computer-science\">Synchronous in Computer Science</a></p>\n<ul>\n<li><a href=\"#synchronous--blocking\">Synchronous + Blocking</a></li>\n<li><a href=\"#synchronous--non-blocking\">Synchronous + Non-Blocking</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#asynchronous-in-computer-science\">Asynchronous in Computer Science</a></p>\n<ul>\n<li><a href=\"#asynchronous--non-blocking\">Asynchronous + Non-Blocking</a></li>\n<li><a href=\"#asynchronous--blocking\">Asynchronous + Blocking</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about what synchronous — a concept used across various models including I/O and networking — actually means, and explore the difference between synchronous and asynchronous approaches. I’ll also briefly touch on blocking and non-blocking, two concepts that are frequentl…","html":"<p>In this post, I want to talk about what synchronous — a concept used across various models including I/O and networking — actually means, and explore the difference between synchronous and asynchronous approaches. I’ll also briefly touch on blocking and non-blocking, two concepts that are frequently confused with sync and async.</p>\n<p>Before diving in, I want to make one thing absolutely clear: synchronous and asynchronous are mechanisms concerning the guaranteed order of process execution, while blocking and non-blocking are concepts about the idle state of a process. They are entirely separate ideas.</p>\n<p>Because the mechanics of synchronous + blocking and asynchronous + non-blocking feel more intuitive, many people mistakenly treat these pairs as identical or similar. But as I just mentioned, they focus on completely different things and have almost no direct relationship. They are simply combined in use.</p>\n<center>\n  <img src=\"/62da0c7a07594deebfee5e538995fe34/4elements.gif\" width=\"100%\">\n  <small>Source - Boost application performance using asynchronous I/O, IBM</small>\n</center>\n<p>There are already plenty of excellent posts on this topic by talented writers, but most of them bundle these concepts together, which makes it easy for newcomers or those unfamiliar with computer science to assume they’re related. The reason so many posts cover them together is simply that in actual implementations, these concepts are used in combination — making it harder to explain them separately.</p>\n<p>So I’ll inevitably be explaining them together as well, but rather than focusing on the more intuitive blocking &#x26; non-blocking concepts, I’ll center the discussion on the more abstract synchronous &#x26; asynchronous.</p>\n<h2 id=\"what-does-synchronous-actually-mean\" style=\"position:relative;\">What Does Synchronous Actually Mean?<a href=\"#what-does-synchronous-actually-mean\" aria-label=\"what does synchronous actually mean permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>If you read posts about synchronous programming, you’ll find that people interpret the word differently. Some say it means things happening at the same time, others describe it as communicating on a specific clock cycle, and still others define it as making states identical. With so many uses of the word, there are equally many interpretations. It’s hard to know which one is right.</p>\n<p>I too was confused when I first learned the concept — the word “synchronous” and its mechanism just didn’t click. Terms like “blocking” are easier to grasp because they come up in everyday contexts like sports, and the meaning of “to block something” is immediately intuitive. But “synchronous”? Not so much.</p>\n<p>The most common everyday usage of the word is probably <strong>synchronization</strong>. Think of the sync feature in iTunes when transferring music to an iPhone. In that context, synchronization means “making two different states identical.”</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54ef639a4f73e6df84f47163440f0557/66465/itunes.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGklEQVR42lVSyXLTQBTUzcibbMuS5b1iybaUyAuSvMUbgeAlTsCOHYcEgkucKE78CsWNA7/azJsgSA5dT5p506+7Z4Rxp4Nhv4PjugHLrKBe02GaJsrlMnK5HPL5PAqFwj/QWjab5TXYD1AsFiGcff0F9+En7A8/4Pi/YYzukVVlZFmzJEmIRCIIh8McoihCURRkMhkkEgm+T+vxeByxWAzpdBrC9vAdq9tvGM4/YnL5BSfOGFI8xpuj0SgnJCJCKBTi6mzbhmEYHKSKhlA/J9zf+1jvPmFydoHJqyUajZd8YgBqJDWBIk3TYFkWt6/rj/EQESlUVRXC+voOi4sNev0pBoMpm95CtWo8y+1pTpQbWSalRE4kzzJ8d3WN8/MlOt4Ave6QXYrFDmn8EOVDtgOQfVmWUSqVOAGpTqVSSCaT/Jtb3qxvMJ+v0O2cosdQr5lQtDyOKhVukQ4QiIj+SYXrupyUFNKg4NKoR5i9ZdmN38B1+kzhCGbdgqzkYFRrzJbGpxOINMiQnhStkaJAHWVIPYLjDNjER3jeKWrMsii+4FmRCok1x6X/lxM8o6dREES2xglb7S5a7R6otlk1TRuFYoGFnYGmsCzp3clpyH+tkypC8E1PRlVZj5JGnokQGk0XjaYHqq1WF3qtjqU3w35/ielhBH31GvpmhvcPd/A/H7DdbbHb7eD7PuaLBcveQ5PFVe3f4Kh6jD/2YjO/1wA8TwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"itunes\" title=\"\" src=\"/static/54ef639a4f73e6df84f47163440f0557/6af66/itunes.png\" srcset=\"/static/54ef639a4f73e6df84f47163440f0557/69538/itunes.png 160w,\n/static/54ef639a4f73e6df84f47163440f0557/72799/itunes.png 320w,\n/static/54ef639a4f73e6df84f47163440f0557/6af66/itunes.png 640w,\n/static/54ef639a4f73e6df84f47163440f0557/d9199/itunes.png 960w,\n/static/54ef639a4f73e6df84f47163440f0557/66465/itunes.png 1097w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>We've all had the experience of losing all our iPhone music after a bad sync, right?</small>\n</center>\n<p>But in computer science, “synchronous” is mostly explained as “happening at the same time,” which feels different. Of course, there are cases like database synchronization where it carries the same meaning, but since many posts discuss I/O and networking, the former interpretation tends to dominate.</p>\n<p>Between the words synchronous and asynchronous, “asynchronous” simply means “not synchronous” — so we should focus on understanding what synchronous precisely means.</p>\n<h3 id=\"understanding-the-nuance-of-the-word\" style=\"position:relative;\">Understanding the Nuance of the Word<a href=\"#understanding-the-nuance-of-the-word\" aria-label=\"understanding the nuance of the word permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In high school, you might have heard the advice “the answer is in the passage” when studying language or foreign language sections. In engineering and science, terminology is often derived from English, and the translation process can sometimes produce words that are harder to understand than the originals. That’s why grasping the original English word’s meaning matters.</p>\n<p>It might feel like we’ve suddenly switched to a language lesson, but I personally think this process is important. It helps us understand why the word “synchronous” can carry different meanings in different contexts.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9094539313df482f1f1f54d153a73b83/15ec7/memorize.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9hMR2QMktEf/xAAZEAADAQEBAAAAAAAAAAAAAAAAARESAhD/2gAIAQEAAQUChDI+qcvJuDSMpef/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAABBAMAAAAAAAAAAAAAAAAAARAhMRFBUf/aAAgBAQAGPwKjrUYk20Fqf//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExEEFRkbH/2gAIAQEAAT8hMwrnuNK6eeGp9QKA0uoEAnpFbLghRUph/9oADAMBAAIAAwAAABBf/wBD/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEDAQE/ECML/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxCjqcrv/8QAHhABAAICAgMBAAAAAAAAAAAAAQARITFRYUFxgcH/2gAIAQEAAT8QyMNFZrG+YOJVOH56lHJFI2LdV5V39lgJwAHgsr7uFRIQPRjsl8ClNeSK6LoQn//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"memorize\" title=\"\" src=\"/static/9094539313df482f1f1f54d153a73b83/c08c5/memorize.jpg\" srcset=\"/static/9094539313df482f1f1f54d153a73b83/0913d/memorize.jpg 160w,\n/static/9094539313df482f1f1f54d153a73b83/cb69c/memorize.jpg 320w,\n/static/9094539313df482f1f1f54d153a73b83/c08c5/memorize.jpg 640w,\n/static/9094539313df482f1f1f54d153a73b83/15ec7/memorize.jpg 690w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Don't memorize — understand</small>\n</center>\n<p>Looking at the Korean translation “동기(同期),” it uses the characters for “same” (同) and “period” (期), literally meaning “same period” or “same cycle.” It’s the same word used when Koreans refer to colleagues who joined a company or military service at the same time. But this literal meaning doesn’t quite match what we mean by “synchronization.”</p>\n<p>After all, syncing an iPhone with iTunes isn’t about aligning their periods or cycles, is it?</p>\n<p>But the English word “Synchronous” actually carries a slightly different nuance:</p>\n<blockquote>\n<p><strong>synchronous</strong> <small>[adjective]</small><br />\n: happening, existing, or arising at precisely the same time</p>\n<p><strong><a href=\"https://www.merriam-webster.com/dictionary/synchronous\" target=\"_blank\" rel=\"nofollow\">- Source: Webster</a></strong></p>\n</blockquote>\n<p>First, note that “synchronous” is an adjective. And its meaning is “happening or existing at precisely the same time.” Since it’s an adjective, it doesn’t specify <em>what</em> is happening at the same time. Now let’s look at the noun “synchronization”:</p>\n<blockquote>\n<p><strong>synchronization</strong><br />\n: the state of being synchronous</p>\n<p><strong><a href=\"https://www.merriam-webster.com/dictionary/synchronization\" target=\"_blank\" rel=\"nofollow\">- Source: Webster</a></strong></p>\n</blockquote>\n<p>Synchronization is “the state of being synchronous.” In other words, synchronous and synchronization are fundamentally the same concept.</p>\n<p>Moreover, all words derived from “Synchro” — <strong>Synchro</strong>nize, <strong>Synchro</strong>nization, <strong>Synchro</strong>nous — share a common nuance: <strong>the feeling of things progressing identically at the same time.</strong> Whether it’s states, actions, or events, they all evoke the sense of things moving in unison.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/edf9c97710f3443a11147da87d5eb3e8/01ab0/synchronized-swimming.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAME/9oADAMBAAIQAxAAAAGdM20qIEH/xAAWEAEBAQAAAAAAAAAAAAAAAAABABD/2gAIAQEAAQUCNJm//8QAFxEBAAMAAAAAAAAAAAAAAAAAAgEQUf/aAAgBAwEBPwEycr//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8BNX//xAAWEAADAAAAAAAAAAAAAAAAAAABECD/2gAIAQEABj8CgL//xAAYEAEBAQEBAAAAAAAAAAAAAAABABEhcf/aAAgBAQABPyEE5k4TufUnb//aAAwDAQACAAMAAAAQFM//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QyMW//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAgEBPxA67Bf/xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMUFh/9oACAEBAAE/EBBbrvILwNHQHHgA8hFsMktMX7Gtz//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"synchronized swimming\" title=\"\" src=\"/static/edf9c97710f3443a11147da87d5eb3e8/c08c5/synchronized-swimming.jpg\" srcset=\"/static/edf9c97710f3443a11147da87d5eb3e8/0913d/synchronized-swimming.jpg 160w,\n/static/edf9c97710f3443a11147da87d5eb3e8/cb69c/synchronized-swimming.jpg 320w,\n/static/edf9c97710f3443a11147da87d5eb3e8/c08c5/synchronized-swimming.jpg 640w,\n/static/edf9c97710f3443a11147da87d5eb3e8/6a068/synchronized-swimming.jpg 960w,\n/static/edf9c97710f3443a11147da87d5eb3e8/eea4a/synchronized-swimming.jpg 1280w,\n/static/edf9c97710f3443a11147da87d5eb3e8/01ab0/synchronized-swimming.jpg 1300w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A classic example of \"synchro\"</small>\n</center>\n<p>So, making an iPhone and iTunes share the same state is synchronous because once the operation completes, both simultaneously arrive at an identical state. And what computer science calls synchronous — events happening at the same time — is also a synchronous event. Both interpretations share the same underlying nuance.</p>\n<p>Even the etymological root “Syn-” simply carries the meaning of “together,” which is why it works in contexts like:</p>\n<blockquote>\n<p>He and I are <strong>out of sync</strong> in everything<br /></p>\n</blockquote>\n<p>For words that are difficult to translate literally, it’s better to understand them through their nuance. To sum up: words using “Synchro-” all share the nuance of <strong>“things progressing identically at the same time.”</strong> Whether it’s state unification (synchronization) or simultaneous events (synchronous processing in CS), the underlying nuance is the same.</p>\n<h2 id=\"synchronous-in-computer-science\" style=\"position:relative;\">Synchronous in Computer Science<a href=\"#synchronous-in-computer-science\" aria-label=\"synchronous in computer science permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Many posts explain synchronous as “the request and response of the current task happening at the same time,” but I’ve always felt a contradiction there — the word “simultaneous” suggests no time gap, yet there’s inevitably some duration between a request and its response.</p>\n<p>Technically, “simultaneous” doesn’t strictly mean an instantaneous moment (just as “simultaneous outbreaks” don’t happen in a single instant), but given how we commonly use the word, it doesn’t feel intuitive.</p>\n<p>That’s why I think it’s more accurate to say what happens simultaneously is not “the current task’s request and response,” but rather <strong>“the current task’s response and the next task’s request.”</strong> (After all, “synchronous” is an adjective with no subject.)</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c9b31/sync.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 24.375000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd0RRX//xAAWEAADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQEAAQUCVP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABsQAAEEAwAAAAAAAAAAAAAAAAEAEBExQWGR/9oACAEBAAE/IY2erNln/9oADAMBAAIAAwAAABAMD//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QgX//xAAZEAEAAgMAAAAAAAAAAAAAAAABABEhQXH/2gAIAQEAAT8QcIgSyz2o01P/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync\" title=\"\" src=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c08c5/sync.jpg\" srcset=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/0913d/sync.jpg 160w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/cb69c/sync.jpg 320w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c08c5/sync.jpg 640w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/6a068/sync.jpg 960w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/eea4a/sync.jpg 1280w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c9b31/sync.jpg 1853w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Synchronous: the response of the current task and the request of the next task are timed together</small>\n</center>\n<p>In other words, saying the current task’s response triggers the next task’s request simultaneously means that tasks proceed <strong>in a definite order.</strong> And “response” here is flexible — in a network model, it could be a server’s response; in an I/O model, it could be the return of process control.</p>\n<p>Let’s look at the most common example of a synchronous approach.</p>\n<h3 id=\"synchronous--blocking\" style=\"position:relative;\">Synchronous + Blocking<a href=\"#synchronous--blocking\" aria-label=\"synchronous  blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The most common synchronous pattern we encounter is the synchronous &#x26; blocking approach. Because it’s synchronous, the sequential flow of tasks is guaranteed. Because it’s blocking, no other task can proceed while one is in progress.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">101</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nEmployee: Attaching doll eye #1\nEmployee: Attaching doll eye #2\n...\nEmployee: Attaching doll eye #100\nBoss: Leaves work</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Looking at this code, we naturally know these tasks will execute in order. Internally, it’s because tasks are pushed onto a single call stack and processed LIFO (Last In First Out), but let’s just focus on the fact that tasks proceed sequentially.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/fe251be8bc28c901b166ea3f99eb1302/0f98f/sync-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFRABAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAIDAAAAAAAAAAAAAAAAAAABIDFB/9oACAEBAAE/IRgqh//aAAwDAQACAAMAAAAQcM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABExQRAhcf/aAAgBAQABPxCi7uo9oceQAAxN8//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync block\" title=\"\" src=\"/static/fe251be8bc28c901b166ea3f99eb1302/c08c5/sync-block.jpg\" srcset=\"/static/fe251be8bc28c901b166ea3f99eb1302/0913d/sync-block.jpg 160w,\n/static/fe251be8bc28c901b166ea3f99eb1302/cb69c/sync-block.jpg 320w,\n/static/fe251be8bc28c901b166ea3f99eb1302/c08c5/sync-block.jpg 640w,\n/static/fe251be8bc28c901b166ea3f99eb1302/6a068/sync-block.jpg 960w,\n/static/fe251be8bc28c901b166ea3f99eb1302/eea4a/sync-block.jpg 1280w,\n/static/fe251be8bc28c901b166ea3f99eb1302/0f98f/sync-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>No going home until all the doll eyes are attached</small>\n</center>\n<p>The parent process <code class=\"language-text\">boss</code> performs its “arrive at work” task, then requests the child process <code class=\"language-text\">employee</code> to attach doll eyes. Only after this task completes can <code class=\"language-text\">boss</code> perform its “leave work” task.</p>\n<p>Simply put, the parent process — the one giving orders — cannot leave until the child process finishes. This synchronous + blocking mechanism is what most people picture when they think of “synchronous,” and it’s intuitively easy to understand.</p>\n<p>But can the <code class=\"language-text\">boss</code> function do other things while <code class=\"language-text\">employee</code> is attaching doll eyes, while still maintaining a synchronous flow?</p>\n<h3 id=\"synchronous--non-blocking\" style=\"position:relative;\">Synchronous + Non-Blocking<a href=\"#synchronous--non-blocking\" aria-label=\"synchronous  non blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Absolutely. Whatever the case, synchronous means tasks have a sequential flow — as long as this premise holds, everything else is fair game. This is precisely why we can’t say <code class=\"language-text\">synchronous === blocking</code>.</p>\n<p>Using JavaScript generators, we can maintain task order while letting the parent process do its own work:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">101</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">yield</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> generator <span class=\"token operator\">=</span> <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">=</span> generator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Boss: Watching YouTube...</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nEmployee: Attaching doll eye #1\nBoss: Watching YouTube...\nEmployee: Attaching doll eye #2\nBoss: Watching YouTube...\n...\nEmployee: Attaching doll eye #100\nBoss: Watching YouTube...\nBoss: Leaves work</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, the parent process <code class=\"language-text\">boss</code> arrives at work, calls the child process <code class=\"language-text\">employee</code> to attach doll eyes, and periodically checks whether the work is done.</p>\n<p>If the task isn’t finished yet, <code class=\"language-text\">boss</code> also diligently performs its own task of <code class=\"language-text\">Watching YouTube</code>. This code clearly follows a synchronous flow, but since <code class=\"language-text\">boss</code> is also doing its own work in between, it’s using a non-blocking approach.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/0f98f/sync-non-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFRABAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAABESEQMVH/2gAIAQEAAT8h6NoVIiyMf//aAAwDAQACAAMAAAAQEM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFx/9oACAEBAAE/EK2O1NQdPkAAclNVsp4QKKJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync non block\" title=\"\" src=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/c08c5/sync-non-block.jpg\" srcset=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/0913d/sync-non-block.jpg 160w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/cb69c/sync-non-block.jpg 320w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/c08c5/sync-non-block.jpg 640w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/6a068/sync-non-block.jpg 960w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/eea4a/sync-non-block.jpg 1280w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/0f98f/sync-non-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>While you work, I'll sneak in some YouTube</small>\n</center>\n<p>In this example, just like in the synchronous &#x26; blocking approach, <code class=\"language-text\">boss</code> absolutely cannot leave work until <code class=\"language-text\">employee</code> finishes. The order of tasks is preserved. In other words, as long as the sequential flow is maintained, synchronous doesn’t care whether it’s blocking or non-blocking.</p>\n<h2 id=\"asynchronous-in-computer-science\" style=\"position:relative;\">Asynchronous in Computer Science<a href=\"#asynchronous-in-computer-science\" aria-label=\"asynchronous in computer science permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I described synchronous as the timing of the current task’s response and the next task’s request being aligned. Asynchronous literally means “not synchronous,” so think of it as the opposite: the current task’s response and the next task’s request don’t have to be aligned.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/6ca16/async.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHbkiwr/8QAFxABAAMAAAAAAAAAAAAAAAAAAQAQEv/aAAgBAQABBQLIwAr/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAh/9oACAEBAAY/AjFP/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERMXH/2gAIAQEAAT8hehUwBcKf/9oADAMBAAIAAwAAABCMD//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxClf//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxCBf//EABkQAQADAQEAAAAAAAAAAAAAAAEAEZFRcf/aAAgBAQABPxCifMqmR/BVFnJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"async\" title=\"\" src=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/c08c5/async.jpg\" srcset=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/0913d/async.jpg 160w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/cb69c/async.jpg 320w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/c08c5/async.jpg 640w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/6a068/async.jpg 960w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/eea4a/async.jpg 1280w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/6ca16/async.jpg 1855w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Once you assign the task, you don't care when it finishes</small>\n</center>\n<p>In a synchronous approach, the parent process must be aware of when the child process’s task ends. Whether the child has produced a result or is still working, the parent is always keeping track of the completion point.</p>\n<p>But in an asynchronous approach, once the parent process assigns a task, it doesn’t care whether the task is in progress or finished. Just as with synchronous, whether the parent can do its own work or not is a separate question.</p>\n<p>Also, since the parent process doesn’t care about the child’s completion status, there’s no guarantee that tasks will finish in sequential order. Let’s start with the familiar async &#x26; non-blocking pattern.</p>\n<h3 id=\"asynchronous--non-blocking\" style=\"position:relative;\">Asynchronous + Non-Blocking<a href=\"#asynchronous--non-blocking\" aria-label=\"asynchronous  non blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The combination of asynchronous and non-blocking is a pattern we’re very familiar with. Since it’s asynchronous, the parent process doesn’t bother tracking the child’s completion. When the child finishes, it will either report back to the parent on its own or delegate to another process.</p>\n<p>And since it’s non-blocking, the parent can continue with its own work after assigning the task.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">maxDollCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> dollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> interval <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dollCount <span class=\"token operator\">></span> maxDollCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    dollCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dollCount<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Employee: Eye count final report'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nBoss: Leaves work\nEmployee: Attaching doll eye #1\nEmployee: Attaching doll eye #2\n...\nEmployee: Attaching doll eye #100\nEmployee: Eye count final report</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, <code class=\"language-text\">boss</code> tells <code class=\"language-text\">employee</code> to attach <code class=\"language-text\">100</code> doll eyes and immediately leaves work.</p>\n<p>The parent process <code class=\"language-text\">boss</code> doesn’t care when <code class=\"language-text\">employee</code> finishes. The completion signal is handled by the <code class=\"language-text\">Eye count final report</code> task passed in as a callback.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/576918463dddd506e08ef5a97177dd7e/0f98f/async-non-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd6LAD//xAAVEAEBAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQABBQKn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAAIDAAAAAAAAAAAAAAAAEQABIDFB/9oACAEBAAE/ITaFBzH/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhMRAR/9oACAEBAAE/ENsVH3obXbAAAw44wyf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"async non block\" title=\"\" src=\"/static/576918463dddd506e08ef5a97177dd7e/c08c5/async-non-block.jpg\" srcset=\"/static/576918463dddd506e08ef5a97177dd7e/0913d/async-non-block.jpg 160w,\n/static/576918463dddd506e08ef5a97177dd7e/cb69c/async-non-block.jpg 320w,\n/static/576918463dddd506e08ef5a97177dd7e/c08c5/async-non-block.jpg 640w,\n/static/576918463dddd506e08ef5a97177dd7e/6a068/async-non-block.jpg 960w,\n/static/576918463dddd506e08ef5a97177dd7e/eea4a/async-non-block.jpg 1280w,\n/static/576918463dddd506e08ef5a97177dd7e/0f98f/async-non-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The boss gives orders and heads straight home</small>\n</center>\n<p>The async &#x26; non-blocking approach is efficient because it can handle multiple tasks simultaneously. However, overly tangled asynchronous processing can make it difficult for developers to follow the application’s flow. This is exactly why JavaScript introduced syntax like <code class=\"language-text\">Promise</code> and <code class=\"language-text\">async/await</code> — to make asynchronous flows clearer and more explicit.</p>\n<p>Also, even asynchronous approaches like Node.js’s event loop contain synchronous patterns under the hood, so overusing async can create bottlenecks somewhere.</p>\n<h3 id=\"asynchronous--blocking\" style=\"position:relative;\">Asynchronous + Blocking<a href=\"#asynchronous--blocking\" aria-label=\"asynchronous  blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Finally, let’s look at the less common concept of asynchronous &#x26; blocking. This pattern isn’t commonly used at the application layer — it appears in low-level contexts like I/O multiplexing models in Linux and Unix operating systems. So let’s let our boss and employee go home and continue the explanation without them.</p>\n<p>At first glance, this combination might seem purely inefficient. The advantage of async is that by not waiting for child processes to finish, you can handle multiple tasks simultaneously. If the process is blocked and sits idle, it can’t process anything.</p>\n<p>But this concept emerged for good reasons:</p>\n<blockquote>\n<ol>\n<li>Synchronous &#x26; blocking I/O is intuitive but can’t handle multiple I/O operations simultaneously.</li>\n<li>Non-blocking I/O makes controlling processes tricky. (Most of these low-level programs are written in C — don’t think in terms of JS or Python.)</li>\n<li>Combining synchronous &#x26; blocking I/O with multi-processing or threading introduces resource issues and complex inter-process/thread communication and synchronization.</li>\n</ol>\n</blockquote>\n<p>So the idea was: “What if we just block the process and asynchronously multiplex multiple I/O operations into a single handler?” In other words, maintain an intuitive code flow while processing tasks concurrently.</p>\n<p>For reference, this is also covered in IBM’s 2006 post <a href=\"https://developer.ibm.com/articles/l-async/\" target=\"_blank\" rel=\"nofollow\">Boost application performance using asynchronous I/O</a>.</p>\n<center>\n  <img src=\"/0855a1508418e6ca6cb4b933f2dc3e61/async-block.gif\" width=\"100%\">\n  <br>\n  <small>Async + blocking workflow</small>\n  <br>\n  <br>\n</center>\n<p>In the diagram above, you’ll notice a <code class=\"language-text\">select()</code> function in the middle — this is the one that blocks the process while simultaneously handling multiple I/O operations. It’s provided as a C API; you can simply <code class=\"language-text\">include &lt;sys/select.h></code> and use it.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">select</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> nfds<span class=\"token punctuation\">,</span> fd_set <span class=\"token operator\">*</span>readfds<span class=\"token punctuation\">,</span> fd_set <span class=\"token operator\">*</span>writefds<span class=\"token punctuation\">,</span>\n    fd_set <span class=\"token operator\">*</span>exceptfds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> <span class=\"token operator\">*</span>timeout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Here, <code class=\"language-text\">nfds</code> is the number of files to monitor, and the <code class=\"language-text\">fd_set</code> structs represent file lists to watch for read data, written data, and exceptions respectively. “fd” stands for File Descriptor. When a monitored file triggers I/O, the corresponding value in its bit array structure is set to <code class=\"language-text\">1</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// If the 3rd file in the list has changes, the FD bit array structure is updated</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">timeout</code> argument (a timeval struct) specifies how long to monitor. In other words, <code class=\"language-text\">select</code> blocks the parent process for the duration specified in <code class=\"language-text\">timeout</code> while continuously watching its file list. During monitoring, if reads, writes, or exceptions occur on any files, <code class=\"language-text\">select</code> returns the number of files that need processing when it terminates.</p>\n<p>That’s roughly how <code class=\"language-text\">select</code> — the quintessential example of async &#x26; blocking — works. To summarize: it halts the process for a set duration, watches its monitored files for I/O, and when time is up, returns the I/O results and unblocks the process.</p>\n<p>This approach is intuitive for developers because it’s blocking, and because it’s asynchronous, it can monitor and handle multiple I/O operations simultaneously. However, the performance isn’t great, so IBM recommends avoiding it for high-performance applications.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I first learned about synchronous concepts in a networking course in college, but back then, my understanding was pretty shallow — just the idea that two devices communicate by aligning their clocks and frame sizes.</p>\n<p>But as I kept studying and working as a developer, I encountered the concept in different contexts — synchronous I/O, synchronous programming, and more. As I mentioned at the beginning, everyone had different interpretations: some said it means things happen at the same time, others said it’s about communicating on a clock, and still others described it as waiting for the previous task to finish. The inconsistency was confusing.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 86.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAL/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHXfVybGcIAD//EABoQAAEFAQAAAAAAAAAAAAAAAAEAAhAREiH/2gAIAQEAAQUC31jiVdRS0TIX/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGhAAAQUBAAAAAAAAAAAAAAAAEAERICExYf/aAAgBAQAGPwJeDHFR/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPyEbfzV15OuAl2zx+lzq672YDGJrLTYFcyPI8nqf/9oADAMBAAIAAwAAABCDxwD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEBAAMAAgMBAAAAAAAAAAABEQAhMVGxQXGB4f/aAAgBAQABPxAqlmUwUPb+PjBbeRb1yaxcBhKD+MQQojb5nDLghRBoDdYy7KV0S6h5XPfnb6c9mf/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dont know\" title=\"\" src=\"/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg\" srcset=\"/static/1ac47e8dbaafebf35dc0419285bce15f/0913d/dont-know.jpg 160w,\n/static/1ac47e8dbaafebf35dc0419285bce15f/cb69c/dont-know.jpg 320w,\n/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Why does everyone explain it differently...?</small>\n</center>\n<p>So while writing this post, I went back to studying what the word “Synchronous” actually means. Once I understood the nuance of the word, it became somewhat clear why all these different interpretations exist. Since the word itself carries an inherent meaning, it really does come down to interpretation.</p>\n<p>In any case, setting everything else aside, I think the biggest takeaway from this post is understanding that the word “Synchronous” carries the nuance of <strong>“things progressing identically at the same time.”</strong></p>\n<p>And with that, I’ll close this post on what synchronous really means.</p>","fields":{"slug":"20190919-sync-async-blocking-non-blockingen","path":"/2019/09/19/sync-async-blocking-non-blocking/en/","lang":"en"},"frontmatter":{"title":"What Does Synchronous Really Mean?","subTitle":"Clarifying the often-confused concepts of sync, async, blocking, and non-blocking","date":"Sep 19, 2019","categories":["Programming"],"tags":["Synchronous","Asynchronous","Blocking","Non Blocking","Asynchronous Programming"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/3a812/thumbnail.jpg","srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/3a812/thumbnail.jpg 320w,\n/static/e075bee6dfcc71a33568cd0ef7b6f61c/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/fc5c5/thumbnail.webp 320w,\n/static/e075bee6dfcc71a33568cd0ef7b6f61c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/2d839/thumbnail.jpg","srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"903e28d3-c3a1-5cde-90da-2d3a97bb77cf","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-the-v8-engine\">What Is the V8 Engine?</a></p>\n</li>\n<li>\n<p><a href=\"#how-the-v8-engine-works\">How the V8 Engine Works</a></p>\n<ul>\n<li><a href=\"#parsing-understanding-what-the-code-means\">Parsing: Understanding What the Code Means</a></li>\n<li><a href=\"#generating-bytecode-with-ignition\">Generating Bytecode with Ignition</a></li>\n<li><a href=\"#cooling-down-hot-code-with-turbofan\">Cooling Down Hot Code with TurboFan</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V…","html":"<p>In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V8’s actual source code.</p>\n<h2 id=\"what-is-the-v8-engine\" style=\"position:relative;\">What Is the V8 Engine?<a href=\"#what-is-the-v8-engine\" aria-label=\"what is the v8 engine permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The V8 engine is a high-performance JavaScript &#x26; WebAssembly engine written in C++, led by Google. It’s also open source, so you can clone it from the <a href=\"https://github.com/v8/v8\" target=\"_blank\" rel=\"nofollow\">V8 engine GitHub repository</a>. It’s currently used in Google Chrome and Node.js, and implements the ECMAScript and WebAssembly standards.</p>\n<p>As of June 28, 2019, if you check the <a href=\"https://compat-table.github.io/compat-table/es2016plus/\" target=\"_blank\" rel=\"nofollow\">Kangax Table</a>, you can see that CH (Chromium) and Node — both powered by V8 — have implemented nearly all ES2016+ features, while Microsoft’s Chakra and Mozilla’s SpiderMonkey still have noticeable gaps marked in red.</p>\n<blockquote>\n<p>To improve compatibility with other platforms and reduce mutual risk, Microsoft Edge will now use the V8 engine as part of this change. We still have a lot to learn, but we’re excited to become part of the V8 community and to contribute to this project.</p>\n<p><strong>ChakraCore team</strong> <em><a href=\"https://github.com/Microsoft/ChakraCore/issues/5865\" target=\"_blank\" rel=\"nofollow\">ChakraCore Github Issue</a></em></p>\n</blockquote>\n<p>As it happens, the Edge browser — which had been using the Chakra engine — has announced it will adopt V8 as part of joining the Chromium open-source project. Whether this is good or bad… I’m not quite sure yet.</p>\n<p>If you want to build V8 yourself and actually debug it, you can’t just clone it with git. If you want to go that far, check out the V8 official site’s <a href=\"https://v8.dev/docs/source-code\" target=\"_blank\" rel=\"nofollow\">Checking out the V8 source code</a>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAWqmWguiFRl//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIABBETIf/aAAgBAQABBQLYGCvstkqh9Sqx5//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/Aaf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEJ/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAESMRARQVH/2gAIAQEABj8CJuV4TXpt2X0//8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFRQfH/2gAIAQEAAT8hoZUK3AiejiFgexiaXKdd9QbNCP/aAAwDAQACAAMAAAAQIz//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAwEBPxCD/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/ENFj/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBYbHR/9oACAEBAAE/EKLyBDy1bKKN9MM0wCZHUVaOyn5NGIgL516gUVkB2iif/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme1\" title=\"\" src=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg\" srcset=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/0913d/meme1.jpg 160w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/cb69c/meme1.jpg 320w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg 640w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg 743w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Chromium is such a massive project that just the installation process for building is quite demanding</small>\n</center>\n<p>I’ve set it up once before, and as you might expect, it didn’t go smoothly — so I recommend attempting it on a weekend when you have plenty of time. Since I’ll only be analyzing the source code this time, I simply cloned it using git.</p>\n<h2 id=\"how-the-v8-engine-works\" style=\"position:relative;\">How the V8 Engine Works<a href=\"#how-the-v8-engine-works\" aria-label=\"how the v8 engine works permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In general, when using JavaScript, you don’t need to think deeply about low-level details like how the engine works. After all, the whole point of using an engine is so developers don’t have to worry about such things. But if you truly want to squeeze the best possible performance out of JavaScript, you need at least some understanding of how your code is executed.</p>\n<p>Let’s start with a simple diagram showing how V8 interprets and executes our JavaScript source code. I’ll explain the details below, so for now, just get a general feel for the flow.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVR42nVSO27cMBT04XIJH8MHSJHWvoNLH8BFgJQBUqQIDBd2s81+tZBISqT4E0VSVIbSOrEE7NsnAsvH4ZsZvpvxevR97xwW37nedh12hmFI45imwN+ba0iUWylZXe/3+6Io2lbO+yGOMd8wLsAhBGMsWjnnpJTH47EsS8YYIaQihHOBMz++P989Hr8+vv75/XMBBhJ4HNVaNzxHHKKxFsS7zlmbab+8vn35tru9fy+L/QKMQ9paqRTA2hhQLasKRIRo9bQ1H3t4bp5+qaw/pYXm7EdK8wqj6roB7c1mg4uUUpce2UO/1rwKyihjtZpYYEVmF+e8+PUBRivI673P5MH5VPCaj/PxqYqnQmnS36W0dBtWCSG22y1M5g2n+Hl+NmckdVRYYbQ5nU6ogor3YQGOMUIVyU/Cjbbaa+XVPAzCC2oo2BOKOpVSodOadohRtC3edvIrrQYGLgKJmYlTeUU72s5hpOqmgbphWIBxL+zAmyHxCqC5AHvvIQaytVLGdgPn2Bo/JHkoYmy32x0OB0opOl3Acw+AIQYziJDaDE0zns+XLMsgVYkRJQS0q4r812xN3zIKJR4XxojP/+v5STOKuRQCFIMjnFdK/QX7NF/0AdGOjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"v8compiler pipeline\" title=\"\" src=\"/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png\" srcset=\"/static/27979b3d2674a00f5b68af5f303fb27c/69538/v8compiler-pipeline.png 160w,\n/static/27979b3d2674a00f5b68af5f303fb27c/72799/v8compiler-pipeline.png 320w,\n/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png 640w,\n/static/27979b3d2674a00f5b68af5f303fb27c/d9199/v8compiler-pipeline.png 960w,\n/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png 1019w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Slides from Franziska Hinkelmann's presentation at JSConf EU 2017</small>\n</center>\n<p>V8 takes our source code and first hands it to the <code class=\"language-text\">Parser</code>. The parser analyzes the source code and transforms it into an <code class=\"language-text\">AST (Abstract Syntax Tree)</code>.</p>\n<p>Next, this AST is passed to <code class=\"language-text\">Ignition</code>, which is an interpreter that converts JavaScript into bytecode. By converting the original source into bytecode — a form much easier for the computer to interpret — V8 avoids the overhead of re-parsing the original code, reduces the amount of code, and saves memory during execution.</p>\n<p>The bytecode is then executed, making our source code actually run. Among the executed code, frequently used portions are sent to <code class=\"language-text\">TurboFan</code>, where they’re recompiled into <code class=\"language-text\">Optimized Machine Code</code>. If that code later becomes less frequently used, it gets deoptimized.</p>\n<p>An interesting detail is that many of V8’s components are named after real engine parts. The V8 engine is actually a type of engine commonly found in high-performance cars — named because eight pistons are arranged in a V shape, driving a single crankshaft.</p>\n<p><code class=\"language-text\">Ignition</code> refers to the igniter used to start an engine. Your source code is revving up and running. And when it gets called too many times and your code starts running hot, <code class=\"language-text\">TurboFan</code> optimizes it — cooling things down so it doesn’t overheat.</p>\n<p>If you’ve read other V8 analysis posts, you may have also seen components called <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. The name <code class=\"language-text\">Crankshaft</code> also comes from real engines — it’s the core component connected to the pistons that converts their reciprocating motion into rotational motion. But as of June 19, 2019, these components can no longer be found in V8.</p>\n<blockquote>\n<p>Starting with V8 v5.9, Ignition and TurboFan are used across the board for JavaScript execution. Additionally, starting with V8 v5.9, Full-codegen and Crankshaft — technologies that have served V8 well — are no longer used in V8, as they were unable to keep up with new JavaScript features and the optimizations those features demand. We plan to remove them entirely soon, which means V8 will have a much simpler and more maintainable architecture going forward.</p>\n<p><strong>V8 team</strong> <em><a href=\"https://v8.dev/blog/launching-ignition-and-turbofan\" target=\"_blank\" rel=\"nofollow\">Launching Ignition and TurboFan</a></em></p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 509px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAADBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFx+lmwZkn/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQMREiH/2gAIAQEAAQUCcVmDI+Ipn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwG6r//EABcQAQEBAQAAAAAAAAAAAAAAAAAxECH/2gAIAQEABj8C4irv/8QAHBAAAwABBQAAAAAAAAAAAAAAAAERUSFhgbHw/9oACAEBAAE/IUV2LyKz5QugmW5Lcnmn/9oADAMBAAIAAwAAABBjP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCYj//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EAp//8QAGxABAQEBAAMBAAAAAAAAAAAAAREhADFBYZH/2gAIAQEAAT8QQrJ6HKlMVGY/nSyHzTmGgRR5Y15drE3PXQyD9x3/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bye\" title=\"\" src=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" srcset=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/0913d/bye.jpg 160w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/cb69c/bye.jpg 320w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg 509w\" sizes=\"(max-width: 509px) 100vw, 509px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Yep. They were replaced starting from V8 v5.9.</small>\n</center>\n<p>Before v5.9, <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> coexisted alongside the newer components — but this wasn’t by choice. Early versions of <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> didn’t perform as well as expected, and there were issues where optimized code couldn’t be directly deoptimized back to bytecode, so the V8 team had no choice but to keep <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> around as fallbacks.</p>\n<p>The V8 team’s original goal was always to use only <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code>, freely moving between <code class=\"language-text\">bytecode ↔ optimized code</code>.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe title=\"\" src=\"https://www.youtube.com/embed/r5OWCtuKiAk?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" loading=\"eager\" allowfullscreen=\"\" sandbox=\"allow-same-origin allow-scripts allow-popups\"></iframe> </div> </div>\n<br /></p>\n<p>This video is from BlinkOn 2016, where <strong>Ross McIlroy</strong> of the Chrome Mobile Performance London Team introduces <code class=\"language-text\">Ignition</code>. The 9:47–11:14 segment explains the unfortunate reasons they couldn’t remove the legacy <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. He seems to find it funny himself while explaining.</p>\n<p>Now let’s take a brief look at how V8 actually parses and executes JavaScript.</p>\n<h3 id=\"parsing-understanding-what-the-code-means\" style=\"position:relative;\">Parsing: Understanding What the Code Means<a href=\"#parsing-understanding-what-the-code-means\" aria-label=\"parsing understanding what the code means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Parsing is the process of loading source code and transforming it into an AST (Abstract Syntax Tree). The AST is a data structure widely used in compilers — think of it as restructuring the source code we write into a form that’s easy for the computer to understand.</p>\n<p>For example, if we were to parse JavaScript with JavaScript, it would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// The code above can be roughly structured like this:</span>\n\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'FunctionDeclaration'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'hello'</span>\n  <span class=\"token literal-property property\">arguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'Variable'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'name'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Laid out like this, it’s simpler than you might expect. But this is just one example — the parser also has to interpret and parse syntax like <code class=\"language-text\">for</code>, <code class=\"language-text\">if</code>, <code class=\"language-text\">a = 1 + 2</code>, <code class=\"language-text\">function () {}</code>, and so on. That’s why the parser’s internals are surprisingly large. V8’s <code class=\"language-text\">parser.cc</code> file alone exceeds 3,000 lines.</p>\n<p>In any case, just remember that parsing is the process of converting code into an AST — a form that’s easy for the computer to analyze. The V8 engine does exactly what we just illustrated in JavaScript, but using C++.</p>\n<p>Let’s take a look at the method in V8’s parsing code that handles literal arithmetic expressions like <code class=\"language-text\">1 + 2</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token keyword\">bool</span> <span class=\"token class-name\">Parser</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShortcutNumericLiteralBinaryExpression</span><span class=\"token punctuation\">(</span>Expression<span class=\"token operator\">*</span><span class=\"token operator\">*</span> x<span class=\"token punctuation\">,</span> Expression<span class=\"token operator\">*</span> y<span class=\"token punctuation\">,</span> Token<span class=\"token double-colon punctuation\">::</span>Value op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> y<span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">double</span> x_val <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">double</span> y_val <span class=\"token operator\">=</span> y<span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>op<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>ADD<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">+</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>SUB<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">-</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is a static method called <code class=\"language-text\">ShortcutNumericLiteralBinaryExpression</code> <em>(what a mouthful…)</em> on the <code class=\"language-text\">Parser</code> class, declared in V8’s <code class=\"language-text\">parser.cc</code>.</p>\n<p>Looking at the parameters: <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> are <code class=\"language-text\">Expression</code> objects representing the values used in the expression. <code class=\"language-text\">op</code> represents the actual operation — whether the expression means <code class=\"language-text\">x + y</code> or <code class=\"language-text\">x - y</code> — along with its type. <code class=\"language-text\">pos</code> indicates the position of the code currently being parsed within the overall source.</p>\n<p>As explained above, this method is called when it encounters source code like <code class=\"language-text\">1 + 2</code>. You can see it inspecting the expression against conditions like <code class=\"language-text\">Token::ADD</code> and <code class=\"language-text\">Token::SUB</code> and parsing accordingly. The “tokens” here are string fragments produced by lexically analyzing the source code according to JavaScript’s grammar rules.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Tokens look roughly like this</span>\n<span class=\"token punctuation\">[</span><span class=\"token string\">'const'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>After the calculation, the resulting value is turned into an AST node using the <code class=\"language-text\">AstNodeFactory</code> class’s <code class=\"language-text\">NewNumberLiteral</code> static method.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/ast/ast.cc</span>\nLiteral<span class=\"token operator\">*</span> <span class=\"token class-name\">AstNodeFactory</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> number<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> int_value<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DoubleToSmiInteger</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>int_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">NewSmiLiteral</span><span class=\"token punctuation\">(</span>int_value<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>zone_<span class=\"token punctuation\">)</span> <span class=\"token function\">Literal</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>During this process, V8 identifies the meaning of code elements like variables, functions, and conditionals. JavaScript’s scoping — something we’re all familiar with — is also established during this phase. For more details on variable declarations, see <a href=\"/2019/06/18/javascript-let-const\">JavaScript’s let and const, and TDZ</a>.</p>\n<h3 id=\"generating-bytecode-with-ignition\" style=\"position:relative;\">Generating Bytecode with Ignition<a href=\"#generating-bytecode-with-ignition\" aria-label=\"generating bytecode with ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/3ef804b01e47419b1954df82e079ed32/ignition.svg\" width=\"300\">\n  <br>\n</center>\n<p>Bytecode is an intermediate representation produced by compiling high-level source code into a form that a virtual machine can understand more easily. In V8, <code class=\"language-text\">Ignition</code> is responsible for this.</p>\n<h4 id=\"what-is-ignition\" style=\"position:relative;\">What Is Ignition?<a href=\"#what-is-ignition\" aria-label=\"what is ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">Ignition</code> is an interpreter that completely replaces the legacy <code class=\"language-text\">Full-codegen</code>. The old <code class=\"language-text\">Full-codegen</code> compiled the entire source code at once. As mentioned earlier, the V8 team recognized that <code class=\"language-text\">Full-codegen</code>’s approach of compiling all source code at once consumed a significant amount of memory.</p>\n<p>Additionally, since JavaScript is a dynamically typed language — unlike statically typed languages like C++ — there were too many unknowns before runtime, making optimization with this approach extremely difficult.</p>\n<p>So when developing <code class=\"language-text\">Ignition</code>, they opted for an interpreter-based approach that processes code line by line as it executes, rather than compiling everything at once, aiming for three key benefits:</p>\n<blockquote>\n<ol>\n<li><strong>Reduced memory usage.</strong> Compiling JavaScript to bytecode is more efficient than compiling directly to machine code.</li>\n<li><strong>Reduced parsing overhead.</strong> Bytecode is concise, making it easier to re-parse.</li>\n<li><strong>Reduced compilation pipeline complexity.</strong> Both optimization and deoptimization only need to deal with bytecode, simplifying everything.</li>\n</ol>\n<p><strong>Ross McIlroy</strong> <em>Ignition - an interpreter for V8</em></p>\n</blockquote>\n<p>Just remember that <code class=\"language-text\">Ignition</code> is the component that converts code to bytecode line by line as it executes.</p>\n<p>So what does bytecode actually look like, and why is it easier for the computer to interpret? Let’s take the <code class=\"language-text\">hello</code> function from earlier and see what bytecode it generates.</p>\n<h4 id=\"viewing-the-bytecode-yourself\" style=\"position:relative;\">Viewing the Bytecode Yourself<a href=\"#viewing-the-bytecode-yourself\" aria-label=\"viewing the bytecode yourself permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// If the code isn't used, it won't be interpreted to bytecode, so we need to call it.</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you’re using Node.js v8.3+, you can add the <code class=\"language-text\">--print-bytecode</code> flag to see how your source code was interpreted into bytecode. Alternatively, you could use V8’s D8 debugging tool, but that requires building V8 — and as I mentioned, the build setup isn’t exactly smooth. So I just used <code class=\"language-text\">--print-bytecode</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --print-bytecode add.js\n<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span>generated bytecode <span class=\"token keyword\">for</span> function: hello<span class=\"token punctuation\">]</span>\nParameter count <span class=\"token number\">2</span>\nFrame size <span class=\"token number\">8</span>\n   <span class=\"token number\">15</span> E<span class=\"token operator\">></span> 0x2ac4000d47b2 @    <span class=\"token number\">0</span> <span class=\"token builtin class-name\">:</span> a0                StackCheck\n   <span class=\"token number\">30</span> S<span class=\"token operator\">></span> 0x2ac4000d47b3 @    <span class=\"token number\">1</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">12</span> 00             LdaConstant <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n         0x2ac4000d47b5 @    <span class=\"token number\">3</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">26</span> fb             Star r0\n         0x2ac4000d47b7 @    <span class=\"token number\">5</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             Ldar a0\n   <span class=\"token number\">46</span> E<span class=\"token operator\">></span> 0x2ac4000d47b9 @    <span class=\"token number\">7</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">32</span> fb 00          Add r0, <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">53</span> S<span class=\"token operator\">></span> 0x2ac4000d47bc @   <span class=\"token number\">10</span> <span class=\"token builtin class-name\">:</span> a4                Return\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is what the <code class=\"language-text\">hello</code> function looks like after being converted to bytecode. Wait — I only used one parameter, <code class=\"language-text\">name</code>, but the <code class=\"language-text\">Parameter count</code> says <code class=\"language-text\">2</code>.</p>\n<p>One of them is the implicit receiver, <code class=\"language-text\">this</code>. If you use <code class=\"language-text\">this</code> inside a function to refer to the function itself — yes, it’s that <code class=\"language-text\">this</code>. Below that, you can see values being assigned to registers. Let me explain briefly.</p>\n<p>For those who might not be familiar: a register is high-speed memory built into the CPU, and an accumulator is a register used to store intermediate calculation results.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">StackCheck</code>: Checks the upper limit of the stack pointer. If the stack exceeds the threshold, a Stack Overflow occurs and function execution is halted.</li>\n<li><code class=\"language-text\">LdaConstant [0]</code>: <code class=\"language-text\">Ld</code> stands for <code class=\"language-text\">Load</code>. It loads a constant into the accumulator. This constant is <code class=\"language-text\">Hello,</code>.</li>\n<li><code class=\"language-text\">Star r0</code>: Moves the value in the accumulator to register <code class=\"language-text\">r0</code>. <code class=\"language-text\">r0</code> is a register for local variables.</li>\n<li><code class=\"language-text\">Ldar a0</code>: Loads the value from register <code class=\"language-text\">a0</code> into the accumulator. In this case, <code class=\"language-text\">a0</code> holds the argument <code class=\"language-text\">name</code>.</li>\n<li><code class=\"language-text\">Add r0, [0]</code>: Adds <code class=\"language-text\">Hello,</code> from <code class=\"language-text\">r0</code> and <code class=\"language-text\">0</code>, storing the result in the accumulator. The constant <code class=\"language-text\">0</code> is mapped to the argument <code class=\"language-text\">name</code> at runtime.</li>\n<li><code class=\"language-text\">Return</code>: Returns the value in the accumulator.</li>\n</ol>\n<hr>\n<p>The <code class=\"language-text\">hello</code> function is something you’d declare without a second thought when writing JavaScript, but internally it goes through 6 steps to return a value.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 204px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEu0lEQVR42l2VWUhXXRTFb2Rv9ZA+CQUGBtFzYIIviUJUZmRhNpelmBOhaKiVRWWDaWJig5qalJhmZE6lVGSllZQTFFhWqIlDlj2EZq6P34778l04/M+955x11l577f13Xr9+raqqKvX39ysnJ0ebNm1SbGysNm/erB07digqKkpXr15VZWWlLl26pIiICKWkpOj79+/Kzs5Wamqqtm/fbuPEiRNyOjs71dzcrKKiIgMJDQ010ISEBIWFhen8+fMqLy/X7t27FRMToytXrmhgYMDAIiMjlZ6ernXr1unw4cM6evSonJKSEtXW1qqsrEw7d+5UYmKibYTd/v37DWDv3r3GuqenR79+/dLFixeNEd/27dtn63Fxcaqvr5eTkZGhO3fu2Dhw4IABrly5UqtWrdLq1asVFBRkF23ZskW3bt3S5cuXtWfPHrsoOTnZJGFtw4YNqqurk9Pd3a0HDx7o2LFjpg+Ly5Yt08aNG7V06VIFBwfbJchw8uRJY0R4Z86c0fHjxy0SZILhs2fP5HR0dKirq8sWd+3apfj4eFtEz4ULF2rFihXy9fXV/Pnz5efnZ1GcPXvWLti2bZtCQkJ07tw5S1pLS8s/hgA2NDRYIk6fPm0b29vblZeXp+XLl2vBggVasmSJhZ6fn28XMo+Ojja9KyoqbG4achCxGYRDIrDH0NCQHj9+rNu3b9tFJIIEoh8JAYhMY6mtW7eafZ4/fy5nZGREL1++tMOtra1Gm6epqUlHjhzRqVOnLBmAkYi1a9eabnixuLjYrMX6z58/1dbWJoeDhN3b22sfebAGNoIpicD4jIMHD2r9+vXmTdiFh4frzZs3dgamyOZ8+fLF9AIQLXl3GVI5169ft3lhYaHWrFmjmzdvCqsdOnRIExMTevHihTkDGYjSoUoIkw1uiY2Pjxvox48fTWjeMTGVQNhkmcvT0tIs21x67949PXnyRM61a9f08OFDM2hNTY2VGQadnp7W7OysZmZmDJzQ0Y1wL1y4YJ7l2/379y3LuANypiEDdiwwqAZkePfunaj1Hz9+2GEqAx1hSFREg8HJME6AmAGSXUAQHkCy52o3NTWlt2/fGms0JQkMIoMxg6YBY2OIHRobGw0AH1HTJIBQCBtd7t69aw6gPeXm5hpDwAmfkqU0qTIIOAUFBaYJmWNzZmamsrKy7BDf8SGZ//37t96/fy/6J2Xq6ekpb29v+fv7W/lR+waIKalf+trTp0+VlJRkWiEBgOjC8+jRI1H3X79+tQtYxypeXl5yHEc+Pj4WqcMBQGBCqITCZtii5+TkpBkfz5H1ubk5u8D9HRwcVEBAgDw8PP7V8qtXr6znUQHoWVpaauYlMZQlCQHUfVw7/f37V3/+/LFv9AE6kvVD6o/WtGjRIqtR/goYNAdC6+vrs0P8YiGaBToC6A6cQN+k85tt0GDevHk26H8YHDBs9O3bNwMcHR21yvnw4YM+ffpk3nRNz3famwESHoD0PJgyp4PzwMTtPjD5/+PqSEkuXrz4X8j0OZchtzDHSq5ebMLIY2NjGh4e1ufPn409czwbGBhonR3bmLHpEPiOdkT4JAMjkwwY8ss7wGSxurragNhLo4Adnr1x44b9p/wHGUBrDK6MFtQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow\" title=\"\" src=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" srcset=\"/static/e75c06934a527f059c1754c33f12e6ff/69538/slow.png 160w,\n/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png 204w\" sizes=\"(max-width: 204px) 100vw, 204px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>It does this much work under the hood, so let's not complain too much when it's occasionally slow</small>\n</center>\n<p>Bytecode is essentially a set of instructions telling the CPU exactly how to use its registers and accumulator. It’s mind-bending for humans, but much easier for the computer to understand.</p>\n<p>Since the V8 engine converts all of our JavaScript code into bytecode like this internally, the first time a line of code runs there’s a slight delay — but from then on, it can achieve performance close to a compiled language.</p>\n<h3 id=\"cooling-down-hot-code-with-turbofan\" style=\"position:relative;\">Cooling Down Hot Code with TurboFan<a href=\"#cooling-down-hot-code-with-turbofan\" aria-label=\"cooling down hot code with turbofan permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/69868eb577b0cc588456498aa200170b/turbofan.svg\" width=\"300\">\n  <br>\n</center>\n<p><code class=\"language-text\">TurboFan</code> is the optimizing compiler that completely replaced the legacy <code class=\"language-text\">Crankshaft</code> starting with V8 v5.9. So why did <code class=\"language-text\">Crankshaft</code> get retired?</p>\n<p>Since V8 first came into the world, new computer architectures emerged and JavaScript continued to evolve, so V8 had to keep up. The V8 team kept patching things to accommodate new specifications, but eventually they determined that <code class=\"language-text\">Crankshaft</code>’s architecture couldn’t sustain continued expansion. So they built <code class=\"language-text\">TurboFan</code> — designed with multiple layers for more flexible extensibility.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADp0lEQVR42j2SWVNiVxSF+WN570ollUpix6HbsXFqTeyYGByAy8wFZJ4RUUCmCzKpOLUoKnZrnvN7vuz4kIdVtc+9+6y91tpHd1OIcnkY5mrfz+d8kC9FP/1Siq/NDC8HLp4OgrxoSe4qcW61FP2aoBThsRjjpRjm+ThNt5xm32/CvPIe3U0xwW0hxk0+wrUQP5cCDMsRHg68fM2YeTx0MdRiPNeSPAnpsJ6UOsFLNcawEOBrKcQ/J0KasGJbm0X3WE3Q3/fRSar0ckHuiyGGrTQPorQXNtPMqtzL+UsjxW0+zH01zmM9zY2oPM/tciv3/25naMYUlNVJdINylLtihFZC5SznY1AMiL0kzT2VesjIVcHLw1GQpyMZVA1xURI34qSb8XAZt3Mj/Q+lKFrQjHlpHF0/o3KzJz9zfq4O/QyqQa6qSc4Pd2mGNjlNO7mrRXkQq/c1IZMch6JqKMNv91VuyyGejrMUAxaMi6PortNuumkXFykbVxErg4KPa7lwtuflJLrJWUqRYW76OY/EINnK4gZ5H/18QJbo404cDkVAN2hkS/+LLCVh5yxmpRG1o0VtDGQZxzE7Oe8m5cAWvbTC54SRRthIO2OnHTfRTdroSc9RVKGSkozrCbmv8Nfcz+guMy5p9FCPuzmVTFohM+dxMxdit+U10PILqW9DlDpoin0t7eV0z0knZKLo3qAl2XUk74JvWyyPoWv4d16XUYqpYlGhIdLb8q21a6AXMFD3GGhHrTJIFhSz0BVFvQNB3MGxDK5Jby1sIRsw4vhdnk0zbKPgtxATFSeS4YWo7ckT0oIKnbiF+u4mWeUTQeMnMrZ1TlNOulGnWHfSEtUF7xZnhZCQ23F/lIftjk7zp/cHdiIjaEU3tawVj38Bj3dasrRyKQPUPxYZGx1BPztGXtS2JaZO1k1HllU5UOgeeMipa6xv/IjOWpvgPxjzb7HkR/GWZliPfs9q6A1qZo5IfgWjf4rFrbes+UZwZ2dR89PY8uNsp3/iY+QNa/5vWfN8x6TrG3SW6iRWbRpnc+EVjoYep8BcncVYncFYmcNUnkOpfmC7NMX20RTG8iSbxXFMFekpTWLRZgRTwjOFzqHN46zrhWhJGmew1eZxaMtyXn6tTUcfsFSWhXSBnaNZwQxbxWkMhYn/iSyanp3Se5TaO3SG/IRMnsQkapSaHmt9GXtjEVdrCbW9gqu5jFvg6fwqWJV6BbX1Gz6pbSLEeSyu6vNCOCWD3vEv/fEw1QLEp/4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"legacy\" title=\"\" src=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" srcset=\"/static/0b92cf561c8d37d00ae81e4db81baadb/69538/legacy.png 160w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/72799/legacy.png 320w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Running Crankshaft and TurboFan simultaneously probably felt something like this...</small>\n</center>\n<p>When supporting 7 architectures, what took 13,000–16,000 lines of code in <code class=\"language-text\">Crankshaft</code> could be covered in under 3,000 lines with <code class=\"language-text\">TurboFan</code>.</p>\n<p>During runtime, V8 has a component called the <code class=\"language-text\">Profiler</code> that collects data such as how frequently functions and variables are called. When this data is brought to TurboFan, it picks out the code that meets its criteria and optimizes it.</p>\n<p>The optimization techniques include Hidden Classes, Inline Caching, and various others, but I’ll cover those in more detail in a future post.</p>\n<p>To briefly explain: Hidden Classes involve classifying similar objects together for reuse. Inline Caching means that if a frequently used piece of code is a function call like <code class=\"language-text\">hello()</code>, it gets replaced with the function’s actual body <code class=\"language-text\">function hello () { ... }</code>. It’s literally caching.</p>\n<h4 id=\"what-conditions-trigger-optimization\" style=\"position:relative;\">What Conditions Trigger Optimization?<a href=\"#what-conditions-trigger-optimization\" aria-label=\"what conditions trigger optimization permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>So what exact conditions does <code class=\"language-text\">TurboFan</code> use to determine which code to optimize? Let’s look at <code class=\"language-text\">RuntimeProfiler</code>’s <code class=\"language-text\">ShouldOptimize</code> method, which determines whether a function should be optimized.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/execution/runtime-profiler.cc</span>\nOptimizationReason <span class=\"token class-name\">RuntimeProfiler</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShouldOptimize</span><span class=\"token punctuation\">(</span>JSFunction function<span class=\"token punctuation\">,</span> BytecodeArray bytecode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// int ticks = how many times this function has been called</span>\n  <span class=\"token keyword\">int</span> ticks <span class=\"token operator\">=</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">feedback_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">profiler_ticks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> ticks_for_optimization <span class=\"token operator\">=</span>\n      kProfilerTicksBeforeOptimization <span class=\"token operator\">+</span>\n      <span class=\"token punctuation\">(</span>bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> kBytecodeSizeAllowancePerTick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ticks <span class=\"token operator\">>=</span> ticks_for_optimization<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If the call count exceeds the threshold, consider it \"hot\"</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kHotAndStable<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>any_ic_changed_ <span class=\"token operator\">&amp;&amp;</span> bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> kMaxBytecodeSizeForEarlyOpt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If not inline-cached and bytecode length is small, consider it a small function</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kSmallFunction<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// If none of the above apply, don't optimize</span>\n  <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kDoNotOptimize<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I was a bit surprised by how few conditions there are. Of course, there are more granular conditions handled elsewhere, but this method captures the big picture.</p>\n<p><code class=\"language-text\">kHotAndStable</code> means the code is hot and stable — in plain terms, it’s called frequently (hot) and doesn’t change (stable). Code inside loops that repeatedly performs the same operation is a prime candidate for this.</p>\n<p><code class=\"language-text\">kSmallFunction</code> means that based on the length of the interpreted bytecode, if it doesn’t exceed a certain threshold, the function is considered small and gets optimized. Small, simple functions are likely to have very abstract or limited behavior, which makes them stable.</p>\n<h4 id=\"peeking-at-turbofan-in-action\" style=\"position:relative;\">Peeking at TurboFan in Action<a href=\"#peeking-at-turbofan-in-action\" aria-label=\"peeking at turbofan in action permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Let’s see how optimization works with a simple code example. I’ll declare a small function and call it repeatedly in a loop.</p>\n<p>My goal is for the function to hit the <code class=\"language-text\">ticks >= ticks_for_optimization</code> condition and reach <code class=\"language-text\">kHotAndStable</code> status. I figure if I declare any function, use the same argument types, and call it rapidly and repeatedly, it should hit <code class=\"language-text\">ShouldOptimize</code>’s threshold and get optimized as <code class=\"language-text\">kHotAndStable</code>.</p>\n<p>When running Node.js with the <code class=\"language-text\">--trace-opt</code> flag, you can observe code being optimized at runtime.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> d <span class=\"token operator\">=</span> c <span class=\"token operator\">-</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> d <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>marking 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan OSR<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.132</span>, <span class=\"token number\">0.453</span>, <span class=\"token number\">0.027</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.850</span>, <span class=\"token number\">0.549</span>, <span class=\"token number\">0.012</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>completed optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It did get optimized. The <code class=\"language-text\">ICs with typeinfo: 3/3 (100%)</code> tells us inline caching was applied.</p>\n<p>But the optimization reason says <code class=\"language-text\">small function</code>. Since I wanted the <code class=\"language-text\">kHotAndStable</code> condition, I need to tweak the code and try again. My function was too simple — <code class=\"language-text\">TurboFan</code> didn’t take it seriously.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>arguments<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Please provide arguments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> array\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">*</span> el<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I made it moderately more complex — though the logic itself is meaningless. The <code class=\"language-text\">sample</code> function simply takes arguments, transforms them, filters them, reverses the order, and returns the result. The optimization targets <code class=\"language-text\">TurboFan</code> would be watching are functions like <code class=\"language-text\">sample</code>, <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, <code class=\"language-text\">reverse</code>, and <code class=\"language-text\">Array.from</code>.</p>\n<p>Since there are many targets, the log output is enormous, so I’ll just show the parts where <code class=\"language-text\">TurboFan</code> marks functions for optimization.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc51 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa9611 <span class=\"token operator\">&lt;</span>JSFunction array.map.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d46f9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa96a1 <span class=\"token operator\">&lt;</span>JSFunction array.map.filter.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4761<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc11 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">10</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">90</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4785c01 <span class=\"token operator\">&lt;</span>JSFunction UseSparseVariant <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36660866d9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">20</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4786fc1 <span class=\"token operator\">&lt;</span>JSFunction reverse <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a3666086f21<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">4</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">80</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>There it is — <code class=\"language-text\">reason: hot and stable</code>. Since the output includes the function name in the format <code class=\"language-text\">&lt;JSFunction function_name></code>, we can see that <code class=\"language-text\">sample</code> and <code class=\"language-text\">reverse</code> were the ones marked for optimization. This shows how <code class=\"language-text\">TurboFan</code> profiles multiple data points — not just one — to determine whether to optimize a piece of code.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>They say that well-written JavaScript can achieve performance approaching C++. When I first heard this, I thought “How can an interpreted language match a compiled language’s performance?” — but after examining V8’s internals, I was surprised by just how many optimization techniques are packed in.</p>\n<p>Tearing apart the JavaScript engine piece by piece and deepening my understanding of a language I love was genuinely fun. <em>(I wish I’d used C++ more back in school…)</em></p>\n<p>There are actually many optimization techniques inside V8 that’ll make you go “Whoa, that’s brilliant…” — and I wanted to introduce them all. But as I wrote, the content kept getting longer and started going off on tangents…</p>\n<p>So for now, I’ll stop at explaining the overall flow. In the next post, I’ll dive deeper into how <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> work in more detail.</p>\n<p>Understanding TurboFan’s workflow in particular is a shortcut to optimizing your own JavaScript code, so it should come in handy.</p>\n<p>This concludes my post: How Does the V8 Engine Execute My Code?</p>","fields":{"slug":"20190628-v8-analysisen","path":"/2019/06/28/v8-analysis/en/","lang":"en"},"frontmatter":{"title":"How Does the V8 Engine Execute My Code?","subTitle":"From bytecode to optimized compilation: a look inside V8's execution pipeline","date":"Jun 28, 2019","categories":["Programming","JavaScript"],"tags":["NodeJS","V8","JavaScript","JavaScript Fundamentals","JavaScript Engine"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/fc5c5/thumbnail.webp 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"242399b1-5837-5746-abe2-dcfa60792881","tableOfContents":"<ul>\n<li>\n<p><a href=\"#checking-the-keplerian-element-data\">Checking the Keplerian Element Data</a></p>\n<ul>\n<li><a href=\"#examining-the-orbital-element-data\">Examining the Orbital Element Data</a></li>\n<li><a href=\"#orbital-elements-measured-at-the-j2000-epoch\">Orbital Elements Measured at the J2000 Epoch</a></li>\n<li><a href=\"#rate-of-change-per-century\">Rate of Change Per Century</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#finding-earths-current-orbit-and-position\">Finding Earth’s Current Orbit and Position</a></p>\n<ul>\n<li><a href=\"#calculating-earths-current-orbital-elements\">Calculating Earth’s Current Orbital Elements</a></li>\n<li><a href=\"#where-is-earth-in-its-orbit\">Where Is Earth in Its Orbit?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, continuing from the previous post, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it. Checking the Keplerian Element Data The method for calculating an orbit using Keplerian elements is the same regardless of the celestial bod…","html":"<p>In this post, continuing from the <a href=\"/2017/05/03/calculate-orbit-1/en\">previous post</a>, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it.</p>\n<h2 id=\"checking-the-keplerian-element-data\" style=\"position:relative;\">Checking the Keplerian Element Data<a href=\"#checking-the-keplerian-element-data\" aria-label=\"checking the keplerian element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The method for calculating an orbit using Keplerian elements is the same regardless of the celestial body, so in this post let’s calculate the orbit of the planet most familiar to us — Earth.</p>\n<p>NASA’s <a href=\"https://ssd.jpl.nasa.gov/planets/approx_pos.html\" target=\"_blank\" rel=\"nofollow\">Jet Propulsion Laboratory (JPL)</a> provides Keplerian element data for planets in the solar system, and I’ll use this data directly to calculate Earth’s orbit.</p>\n<p>JPL provides three sets of orbital data, each serving different purposes depending on the calculation goal and required precision:</p>\n<hr>\n<ul>\n<li>Table 1: Keplerian elements and their rates of change, referenced to the mean ecliptic and equinox. Valid for predictions between 1800 AD and 2050 AD. Ignores long-term orbital element variations but is simple and fast to compute.</li>\n<li>Table 2a: Measured using the same reference as Table 1, but valid for predictions between 3000 BC and 3000 AD. Because it covers a wider time range, additional correction terms from Table 2b must be applied for orbital calculations from Jupiter through Neptune.</li>\n<li>Table 2b: Correction terms for the mean anomaly calculations of Jupiter, Saturn, Uranus, and Neptune in Table 2a. These terms account for gravitational perturbations, interplanetary interactions, and general relativistic effects.</li>\n</ul>\n<hr>\n<p>Tables 2a and 2b are for high-precision calculations needed for things like space exploration. Massive planets like Jupiter have significant gravitational effects on other bodies, requiring separate correction values for better precision.</p>\n<p>Since my goal is just a simple simulation rather than high-precision calculation, the elements from Table 1 are more than sufficient.</p>\n<h3 id=\"examining-the-orbital-element-data\" style=\"position:relative;\">Examining the Orbital Element Data<a href=\"#examining-the-orbital-element-data\" aria-label=\"examining the orbital element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Table 1 provides Keplerian element values measured at the epoch J2000 — January 1, 2000, at noon (Julian calendar) — along with the rate of change per century. The orbital element data given in this table is as follows:</p>\n<hr>\n<ol>\n<li>Semi-major axis (<code class=\"language-text\">a</code>): In AU.</li>\n<li>Eccentricity (<code class=\"language-text\">e</code>): In radians.</li>\n<li>Inclination (<code class=\"language-text\">I</code>): In degrees.</li>\n<li>Mean longitude (<code class=\"language-text\">L</code>): In degrees.</li>\n<li>Longitude of perihelion (<code class=\"language-text\">long.peri.</code>): In degrees.</li>\n<li>Longitude of the ascending node (<code class=\"language-text\">long.node</code>): In degrees.</li>\n</ol>\n<hr>\n<p>JPL provides data for all solar system planets, but since this post aims to explain the orbital calculation process simply, we only need to look at the row labeled EM Bary, which is Earth’s orbital element. <small>(EM Bary stands for Earth/Moon Barycenter — the center of mass between Earth and the Moon.)</small></p>\n<p>Let’s look at Earth’s orbital elements from Table 1. The data is divided into values measured at the J2000 epoch and the rate of change per century.</p>\n<h3 id=\"orbital-elements-measured-at-the-j2000-epoch\" style=\"position:relative;\">Orbital Elements Measured at the J2000 Epoch<a href=\"#orbital-elements-measured-at-the-j2000-epoch\" aria-label=\"orbital elements measured at the j2000 epoch permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>J2000 refers to noon on January 1, 2000, in the Julian calendar. The time at which the reference observation for planetary orbital elements was made is called the epoch.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.00000261</td>\n<td>0.01671123</td>\n<td>-0.00001531</td>\n<td>100.46457166</td>\n<td>102.93768193</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"rate-of-change-per-century\" style=\"position:relative;\">Rate of Change Per Century<a href=\"#rate-of-change-per-century\" aria-label=\"rate of change per century permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>These values represent how much the orbital elements have changed over one century. Using these, we can calculate what Earth’s orbital elements look like at the time of writing this post — May 3, 2017, at 10:27 PM.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0.00000562</td>\n<td>-0.00004392</td>\n<td>-0.01294668</td>\n<td>35999.37244981</td>\n<td>0.32327364</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<p>Now let’s use these values to calculate where Earth is currently positioned in its orbit.</p>\n<h2 id=\"finding-earths-current-orbit-and-position\" style=\"position:relative;\">Finding Earth’s Current Orbit and Position<a href=\"#finding-earths-current-orbit-and-position\" aria-label=\"finding earths current orbit and position permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Looking at the data above, you’ll notice that two of the Keplerian elements explained in the previous post are missing: the argument of periapsis and the time of periapsis passage. But this isn’t a problem.</p>\n<p>For the argument of periapsis — since it simply means how far the perihelion is from the ascending node — it can be calculated from the longitude of perihelion and longitude of the ascending node that we already have. However, in this post we’ll only be finding the planet’s position on the 2D orbital plane, so we don’t actually need to calculate the argument of periapsis (which is used for determining the orbit’s orientation in 3D space).</p>\n<p>As for the time of periapsis passage, it’s essentially a time reference for finding where a planet is located at a given moment. Since the JPL data provides both values measured at J2000 and the rate of change per century, the evolution of orbital elements over time is already accounted for.</p>\n<p>The key to calculating a planet’s position in its orbit around the Sun is: compute the <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>)</a> and the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>)</a> from the orbital elements, then derive the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates on the orbital plane.</p>\n<p>We don’t need the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span></span> coordinate at this stage because once we find the planet’s position on the orbital plane, applying the inclination (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span></span>), longitude of the ascending node (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Ω</mi></mrow><annotation encoding=\"application/x-tex\">\\Omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Ω</span></span></span></span></span>), and argument of periapsis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) to place the orbit in 3D space will naturally yield the planet’s 3D position.</p>\n<p>The important question is whether we can derive the mean anomaly and eccentric anomaly from the given data — and as mentioned, the values we have are more than sufficient.</p>\n<p>Let’s get started with the calculations.</p>\n<h3 id=\"calculating-earths-current-orbital-elements\" style=\"position:relative;\">Calculating Earth’s Current Orbital Elements<a href=\"#calculating-earths-current-orbital-elements\" aria-label=\"calculating earths current orbital elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the JPL data consists of orbital element values measured at J2000 and the rate of change per century.</p>\n<p>So to find the current orbital element values, we need to determine how many centuries have passed since J2000, then multiply the rate of change per century by that value to adjust the final orbital elements.</p>\n<p>To make calculations easier, let’s first declare some functions for converting between time units:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">DAY</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">YEAR</span> <span class=\"token operator\">=</span> <span class=\"token number\">365.25</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The Julian calendar defines 1 year as 365.25 days</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertMillisecondsToSeconds</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>milliseconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> milliseconds <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertSecondsToDays</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>seconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> seconds <span class=\"token operator\">/</span> <span class=\"token constant\">DAY</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDaysToYears</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>days<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> days <span class=\"token operator\">/</span> <span class=\"token constant\">YEAR</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertYearsToCenturies</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>years<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> years <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now let’s figure out how many centuries have passed since the J2000 epoch:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">J2000</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2000-01-01T12:00:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2017-05-03T22:27:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> epochTime <span class=\"token operator\">=</span> <span class=\"token function\">convertMillisecondsToSeconds</span><span class=\"token punctuation\">(</span>\n    now<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token constant\">J2000</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Date arithmetic returns milliseconds, so divide by 1000 to get seconds</span>\n<span class=\"token comment\">// Result: 547,122,420 seconds</span>\n\n<span class=\"token keyword\">const</span> centuries <span class=\"token operator\">=</span>\n  <span class=\"token function\">convertYearsToCenturies</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">convertDaysToYears</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">convertSecondsToDays</span><span class=\"token punctuation\">(</span>epochTime<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Result: 0.17337263289984028 centuries</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>So approximately <code class=\"language-text\">6,332.43</code> days have passed since J2000, which converts to about <code class=\"language-text\">0.1734</code> centuries. Now that we know how many centuries have elapsed since the epoch, let’s declare the JPL orbital elements and calculate Earth’s current orbital elements.</p>\n<p>For easier downstream calculations, I’ll convert all AU units to kilometers. 1 AU is the mean distance between the Sun and Earth, approximately 149,597,870 km.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">KeplerOrbitElement</span> <span class=\"token punctuation\">{</span>\n  semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  inclination<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  meanLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">JPLOrbitElementData</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n  ratePerCentury<span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AU</span> <span class=\"token operator\">=</span> <span class=\"token number\">149597870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertAUtoKM</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>au<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> au <span class=\"token operator\">*</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> earthOrbitElements<span class=\"token operator\">:</span> JPLOrbitElementData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.00000261</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 149598260.45044068 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token number\">0.01671123</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00001531</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">100.46457166</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">102.93768193</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  ratePerCentury<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.00000562</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 840.7400294 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00004392</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.01294668</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">35999.37244981</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.32327364</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With the orbital elements declared, it’s time to calculate. Using an abstracted <a href=\"https://es-toolkit.slash.page/reference/object/mapValues.html\" target=\"_blank\" rel=\"nofollow\">mapValues</a> function to easily map over object properties, we can express this concisely:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> currentElements <span class=\"token operator\">=</span> <span class=\"token function\">mapValues</span><span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span><span class=\"token constant\">J2000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> element <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span>ratePerCentury<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> centuries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/**\n  {\n    semiMajorAxis: 149598406.21175316,\n    eccentricity: 0.01670361547396304,\n    inclination: -0.0022599099989117043,\n    ascendingNodeLongitude: 0,\n    meanLongitude: 6341.770556025533,\n    perihelionLongitude: 102.99372873211391\n  }\n */</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this simple process, we’ve calculated the state of Earth’s orbital elements at May 3, 2017, 10:27 PM. Now let’s use these values to find where Earth is actually positioned in its orbit.</p>\n<h3 id=\"where-is-earth-in-its-orbit\" style=\"position:relative;\">Where Is Earth in Its Orbit?<a href=\"#where-is-earth-in-its-orbit\" aria-label=\"where is earth in its orbit permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the key to orbital calculation using Keplerian elements is computing the mean anomaly and eccentric anomaly, then expressing the planet’s position on the orbital plane as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. Let’s calculate these values and see why they’re necessary for orbital computation.</p>\n<h4 id=\"calculating-the-mean-anomaly\" style=\"position:relative;\">Calculating the Mean Anomaly<a href=\"#calculating-the-mean-anomaly\" aria-label=\"calculating the mean anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly</a> is an angle used to calculate the position of a body on an elliptical orbit in the classical two-body problem.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMCAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAfdjaLVnCbyJoH//xAAaEAEAAgMBAAAAAAAAAAAAAAABAAISICEx/9oACAEBAAEFAlmXTyNYVNP/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPwEj/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAACEw/9oACAEBAAY/AhQ//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARECEx/9oACAEBAAE/IRJouo2l9jdajKKqsAYWsf/aAAwDAQACAAMAAAAQ88g8/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QwOp//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGhAAAwEBAQEAAAAAAAAAAAAAAAERITFREP/aAAgBAQABPxBCn2uYOerv3q+KpPir0wEA8sIpWDSY6Jmi4j//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mean anomaly ko\" title=\"\" src=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg\" srcset=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/0913d/mean-anomaly-ko.jpg 160w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/cb69c/mean-anomaly-ko.jpg 320w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg 640w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/6a068/mean-anomaly-ko.jpg 960w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/eea4a/mean-anomaly-ko.jpg 1280w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg 2128w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small></small>\n</center>\n<p>The diagram above shows the areas swept by a planet as it moves along its orbit over equal time intervals. Notice that the gray orbital areas are slightly different from each other, while the pink orbital areas are all equal.</p>\n<p>A planet in an elliptical orbit exhibits nonlinear motion according to Kepler’s second law — the <a href=\"https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion\" target=\"_blank\" rel=\"nofollow\">law of equal areas</a>. That is, the planet moves faster near perihelion and slower near aphelion.</p>\n<p>The mean anomaly represents the angular distance between a body and the perihelion, assuming the body were transferred to a perfect circular orbit while maintaining its orbital speed and period. By simplifying the orbit to a near-circular shape, the angle representing the planet’s position increases linearly with time, making calculations simpler.</p>\n<p>Of course, if a planet’s orbital eccentricity were 0 (a perfect circle), the planet would actually move this way. But since most orbits are elliptical, the mean anomaly and eccentricity are used to correct the calculation and determine the planet’s actual motion.</p>\n<p>The mean anomaly serves as the most fundamental ingredient for calculating a planet’s position in its orbit. There are several ways to compute it, but since I already have the mean longitude and longitude of perihelion, I’ll use those.</p>\n<p>The formula for calculating the mean anomaly from mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) and longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>M</mi><mo>=</mo><mi>l</mi><mo>−</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">M = l - \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 6238.776827293419 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>To understand the principle behind this, we need a bit more context on what mean longitude is. The mean longitude used in this calculation represents, on average, how far a planet has progressed in its orbit, measured from the vernal equinox. Mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) can be expressed as:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>l</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>ϖ</mi></mrow><annotation encoding=\"application/x-tex\">l = \\frac{2\\pi}{P}(t - T_0) + \\varpi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">ϖ</span></span></span></span></span></div>\n<hr>\n<ul>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>: Mean motion (the time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> for a planet to complete one orbit). This is the total angle of 360°, or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span> radians, divided by the planet’s orbital period.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>: Time elapsed since the reference time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>. Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the J2000 epoch.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>: Longitude of perihelion.</li>\n</ul>\n<hr>\n<p>Looking at this formula, when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">t - T_0 = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, we get <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo>=</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">l = \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span> — mean longitude equals longitude of perihelion. This tells us that <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> represents the average angle the planet has traveled from the perihelion.</p>\n<p>The final addition of the longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) shifts the reference point of the mean longitude to an angle measured from the vernal equinox.</p>\n<p>But what we need is the mean anomaly, which — as its name suggests — uses the perihelion as its reference, not the vernal equinox. So by subtracting the longitude of perihelion from the mean longitude, we shift the reference back to the perihelion.</p>\n<h4 id=\"calculating-the-eccentric-anomaly\" style=\"position:relative;\">Calculating the Eccentric Anomaly<a href=\"#calculating-the-eccentric-anomaly\" aria-label=\"calculating the eccentric anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now that we’ve used the mean anomaly to find how far the planet has traveled from perihelion, it’s time to calculate the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly</a>.</p>\n<p>The mean anomaly we calculated is like a clock ticking at a constant rate — it simply assumes that since time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span></span> has passed, the planet must have moved through angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>.</p>\n<p>But in reality, a planet in an elliptical orbit moves at nonlinear speeds depending on its distance from the central body. So we need to use the mean anomaly and eccentricity to compute the eccentric anomaly, which accounts for the planet’s nonlinear motion — speeding up and slowing down — to find the actual position.</p>\n<p>The eccentric anomaly is an angle defined to simplify the actual position of a planet on an elliptical orbit. It represents the central angle when the planet’s position is projected onto an imaginary circular orbit whose radius equals the semi-major axis of the actual elliptical orbit. A diagram makes this more intuitive:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>In the diagram, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> represents the planet’s position on the orbit, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> represents the planet’s position projected onto an imaginary circular orbit with radius <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> (the semi-major axis of the actual orbit).</p>\n<p>The center of the actual elliptical orbit is <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> is one of the ellipse’s foci. The focus represents the gravitational center of the orbit — in the solar system, this would be the Sun. The eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the angle from the ellipse’s center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span> to the projected position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> on the imaginary circular orbit.</p>\n<p>Like the mean anomaly, the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit. However, because the eccentricity is factored into the calculation, the eccentric anomaly — unlike the mean anomaly — reflects the geometric characteristics of the elliptical orbit and exhibits a nonlinear rate of increase.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB7CAAAewgFu0HU+AAABcElEQVR42qVTi3KDIBDk//+yVVujAV+IqMj2ltQ0yaSxM70ZBzyX9Y7bVZDYwoq4BazrirquUVUVjDE4n89omgZd10FrjbZtU4575vkYo7EsC2kQY4SaZy8gDaNb5HkmT46iKDDP8xX0GCl3k49xlZ9ZKSgRztCmgXU+/bHve4zjiBACjiNiXkYUVYemveCV9z618pdIhX3vtyCdyVW8lQ7t8FOtItkwDIdEe2zbgla6yE8WVbNJm/dYVZZlavOQKEQMvUNVW5gu3BHd4hSn9ljhDuA6+SiTnNA3E5xbpcLnRFdCSoSyeCTqbcRHPaHWPaiEu6m+uB7lnEuEO9464P3k8Xnu4L09OP6EkGLep1ybIFMT2ThWHH5t6yXhJpcy2kGqFJcYEi34TyiqvpMpG92IhSYZkAW1yclba7FfCQ3Ald+4Ms/vxE3TlLokRl20RT0tyVLOjemdB3iYjqF3qYYsyxKGTqJ/SUAcMVQKvfwFtwj7PCL7F18AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"m vs e\" title=\"\" src=\"/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png\" srcset=\"/static/54cc99e748edcd1fc096e8849a6441d0/69538/m_vs_e.png 160w,\n/static/54cc99e748edcd1fc096e8849a6441d0/72799/m_vs_e.png 320w,\n/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png 640w,\n/static/54cc99e748edcd1fc096e8849a6441d0/d9199/m_vs_e.png 960w,\n/static/54cc99e748edcd1fc096e8849a6441d0/21b4d/m_vs_e.png 1280w,\n/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png 1707w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    Mean anomaly vs. eccentric anomaly calculated after changing Earth's eccentricity to 0.6 in JPL's orbital elements.<br>\n    At day 0 (perihelion) the difference is small, but it grows as we approach day 180 (aphelion).\n  </small>\n</center>\n<p>Once we have the eccentric anomaly, we can finally determine the distance from the gravitational center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> to the actual planet position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, as well as the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> — the true anomaly.</p>\n<p>Like the mean anomaly, the eccentric anomaly can be derived from multiple definitions. Since I’ve already calculated the mean anomaly, I’ll use the formula derived from it:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mo>+</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E = \\frac{M+e \\sin M}{1-e \\cos M}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>This formula calculates the eccentric anomaly using the mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>) and the ellipse’s eccentricity (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span>). The nonlinear characteristics of planetary motion grow stronger with higher eccentricity, which is reflected through the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> terms.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> adjusts the mean anomaly to account for the nonlinear motion of the ellipse, while <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> acts as a normalization factor indicating whether the planet is closer to perihelion or aphelion.</p>\n<p>If <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, the orbit would be a perfect circle and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">E = M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>. But when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e > 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span> (an elliptical orbit), near perihelion both <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> are small so the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> is small, while near aphelion both values increase and the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> grows.</p>\n<p>Unfortunately, the formula for the eccentric anomaly is a nonlinear equation that yields an approximation rather than an exact solution, so we need to reduce the error using the <a href=\"https://en.wikipedia.org/wiki/Newton%27s_method\" target=\"_blank\" rel=\"nofollow\">Newton-Raphson method</a>:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>E</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mfrac><mrow><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E_{n+1} = E_n - \\frac{E_n - e \\sin E_n - M}{1 - e \\cos E_n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1963em;vertical-align:-0.836em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>Now that we know how to calculate the eccentric anomaly, let’s proceed with the actual computation. Since JavaScript’s trigonometric methods like <code class=\"language-text\">Math.sin</code> and <code class=\"language-text\">Math.cos</code> accept radians rather than degrees, we need to convert the mean anomaly to radians:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDegreeToRadian</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>degree<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> degree <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">convertDegreeToRadian</span><span class=\"token punctuation\">(</span>\n  currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then we declare a Newton-Raphson helper function and an eccentric anomaly function, and iterate 6 times:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">newtonRaphson</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> initialValue<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> x1 <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> iterations<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    x <span class=\"token operator\">=</span> x1<span class=\"token punctuation\">;</span>\n    x1 <span class=\"token operator\">=</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> x1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> eccentricAnomaly <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>meanAnomaly <span class=\"token operator\">+</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> eccentricAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">newtonRaphson</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  meanAnomaly<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">6</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 108.9017193604219 radians</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Higher eccentricity means larger errors in the <code class=\"language-text\">getEccentricAnomaly</code> function’s output, requiring more iterations. But since Earth’s orbital eccentricity is about <code class=\"language-text\">0.02</code> — nearly circular — 6 iterations is sufficient.</p>\n<p>With the eccentric anomaly calculated, it’s time to use everything we’ve gathered to find the planet’s actual position on the orbital plane.</p>\n<h4 id=\"finding-the-planets-x-y-coordinates-on-the-orbital-plane\" style=\"position:relative;\">Finding the Planet’s x, y Coordinates on the Orbital Plane<a href=\"#finding-the-planets-x-y-coordinates-on-the-orbital-plane\" aria-label=\"finding the planets x y coordinates on the orbital plane permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now we need to find where the planet is on the orbital plane and express it as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. The coordinates we’re calculating are relative to the center of the ellipse, but ultimately we’ll use them to determine how far Earth is from the Sun and how many degrees it has traveled from perihelion.</p>\n<p>First, the formula for the planet’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the ellipse’s center:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x = a \\cdot (\\cos E - e)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span></span></span></span></span></div>\n<p>Since the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit (because the ellipse’s complex proportions are hard to work with directly), when using the eccentric anomaly to find the planet’s actual position on the elliptical orbit, we need to correct for the difference between the imaginary circular orbit and the actual elliptical orbit.</p>\n<p>The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E - e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> term in the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> formula performs this correction. <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> calculates how far the planet is horizontally from the center on the imaginary circular orbit (based on the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>). Then subtracting the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> shifts the result by the distance between the ellipse’s center and its focus.</p>\n<p>Up to this point, the calculated value is dimensionless — merely a ratio relative to the semi-major axis — so we multiply by the semi-major axis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span>) to set the orbit’s scale.</p>\n<p>The formula for the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate follows a similar principle:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">y = a \\cdot \\sqrt{1 - e^2} \\cdot \\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.1777em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0623em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.0223em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span></div>\n<p>For the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> first calculates how far the planet is vertically on the imaginary circular orbit, then corrects for the difference between the imaginary circle and the actual ellipse.</p>\n<p>The difference here is that we need vertical correction, so we must use the semi-minor axis instead of the semi-major axis. The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">a \\cdot \\sqrt{1 - e^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span> in the formula is precisely the formula for deriving the semi-minor axis from the semi-major axis and eccentricity.</p>\n<p>Now that we understand the general principle, let’s write the code and extract Earth’s coordinates:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> positionX <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>eccentricity\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> positionY <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>From this, I was able to determine that Earth is located approximately -76,411,956 km along the X-axis and approximately 130,045,428 km along the Y-axis from the center of the ellipse.</p>\n<h4 id=\"finding-the-distance-from-the-sun-and-the-true-anomaly\" style=\"position:relative;\">Finding the Distance from the Sun and the True Anomaly<a href=\"#finding-the-distance-from-the-sun-and-the-true-anomaly\" aria-label=\"finding the distance from the sun and the true anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>We’ve found Earth’s coordinates on the orbital plane, but these coordinates represent the distance from the center of the orbit itself — not from the Sun, which is the gravitational center.</p>\n<p>What I actually want to know is Earth’s position relative to the Sun, not the orbital center, so additional calculation is needed. Let’s bring back the diagram from earlier:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Earlier, I calculated the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> shown in the diagram, and used it to find the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> — the planet’s position on the actual red orbit. But a planet in an elliptical orbit doesn’t orbit the center of the ellipse <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>; it orbits the gravitational center located at one of the ellipse’s foci.</p>\n<p>Since a planet orbiting a gravitational center experiences different gravitational forces depending on its distance, and its orbital speed varies accordingly, what truly matters in orbital calculations is the distance and angle from the gravitational center — not the ellipse’s center.</p>\n<p>In other words, I now need to find the distance from <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> (not <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>) to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, and the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span>. This angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> is called the <a href=\"https://en.wikipedia.org/wiki/True_anomaly\" target=\"_blank\" rel=\"nofollow\">true anomaly</a> — literally the “true” angle from periapsis.</p>\n<p>Let’s first calculate the distance from the Sun to Earth. Since we already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, the Euclidean distance (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span>) from the Sun to Earth can be simply calculated using the Pythagorean theorem:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>r</mi><mo>=</mo><msqrt><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>⋅</mo><mi>e</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">r = \\sqrt{(x - (a \\cdot e))^2 + y^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.2561em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9839em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9439em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2561em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> is the distance from the center of the elliptical orbit to the Sun. Since we calculated Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the orbital center, we subtract the distance between the orbital center and the Sun to shift the reference to the Sun’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate. Beyond this adjustment, the formula is just the familiar Pythagorean theorem <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">c = \\sqrt{a^2 + b^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span>, so I’ll skip the detailed explanation.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertKMtoAU</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>km<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> km <span class=\"token operator\">/</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionY<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">convertKMtoAU</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1.0168205539250386 AU</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Running this calculation tells us that on May 3, 2017, at 10:27 PM, Earth is located approximately 1.02 AU from the Sun.</p>\n<p>Now that we have the Sun-Earth distance, let’s calculate the true anomaly to find how many degrees Earth has traveled from perihelion.</p>\n<p>While the standard approach derives the true anomaly from the eccentric anomaly, since I already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, I can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2\" target=\"_blank\" rel=\"nofollow\">Math.atan2</a> function to find the true anomaly directly.</p>\n<p>The <code class=\"language-text\">Math.atan2</code> function uses the relative positions of <code class=\"language-text\">y</code> and <code class=\"language-text\">x</code> to calculate the angle a point forms from a reference point. The result is a radian value between -180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">-\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>) and 180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>).</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAB7CAAAewgFu0HU+AAABYUlEQVR42s1U27KDIAz0///S8cHxUu+CopCytLFQa4+epzKTEZI1LAlLZIwhHlVVURzHlKYpdV1H/vBxRVFQkiSUZRm1bRvgonmet4XWmtZ1pWVZ3JwHfEqpYA3MO84lnKZpx4RBUhoCMT+hEGaHO5VQyomaRu0Y1rVyMT7RYUIkYuv7noZh3NY42qs0xsYGh8FG/n+wSEq5scJX2Q2GpiHjmGnnBztsjDh8iI22aWoc3RwYtq81PGrK5RoiwV8JmdHppvyb4WjrgILDUE8UHMY+9gshgvWjcSEOm0bcDIyyLJ1S8jx3quGY3zQYFAKlAFfXdRALlML14+twdGQfd0kpP9plAE8k/IRzCT8ppUVDnr53pbCvs2qazyjl8aIIGuy14Mb4DFnrTORUDY3R9l4put0UoUxavxIWhbLzxT0Sl5XCBMCQrxfnOOwyjofnCQxg+BGb8JrrhyOC2Tcc8twBC4Eq2UyW6lYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"atan2 2\" title=\"\" src=\"/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png\" srcset=\"/static/aba07d7dd119d6c7cf99ca046209025f/69538/atan2_2.png 160w,\n/static/aba07d7dd119d6c7cf99ca046209025f/72799/atan2_2.png 320w,\n/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png 640w,\n/static/aba07d7dd119d6c7cf99ca046209025f/d9199/atan2_2.png 960w,\n/static/aba07d7dd119d6c7cf99ca046209025f/21b4d/atan2_2.png 1280w,\n/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png 1979w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The atan2 function measures angles from the origin relative to the positive x-axis</small>\n</center>\n<p>Note that this function is designed to receive the <code class=\"language-text\">y</code> coordinate first, as in <code class=\"language-text\">Math.atan2(y, x)</code>. This is because tangent is expressed as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>tan</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mi>y</mi><mi>x</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\tan(\\theta) = \\frac{y}{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">tan</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0925em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>, following the form <code class=\"language-text\">Math.tan(y / x)</code>.</p>\n<p>The coordinates that <code class=\"language-text\">Math.atan2</code> receives aren’t necessarily calculated from the origin — they represent relative coordinates from any arbitrary origin. Since the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates I calculated for Earth are relative to the Sun’s position, plugging them into <code class=\"language-text\">Math.atan2</code> directly gives us the angle of Earth’s position relative to the Sun.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertRadianToDegree</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>radian<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> radian <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">180</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> trueAnomaly <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">atan2</span><span class=\"token punctuation\">(</span>\n  positionY<span class=\"token punctuation\">,</span>\n  positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'True anomaly:'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">convertRadianToDegree</span><span class=\"token punctuation\">(</span>trueAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 120.4375985828049 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this, I was able to determine that as of May 3, 2017, at 10:27 PM, Earth is located approximately 120° from perihelion at a distance of 1.02 AU.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This post only covered finding a planet’s position on the 2D orbital plane. However, once you place the orbit in 3D space by applying the orbital inclination and argument of periapsis, the planet will naturally exhibit three-dimensional motion.</p>\n<p>You can check out the simulator I built using these formulas <a href=\"https://evan-moon.github.io/solarsystemts/\" target=\"_blank\" rel=\"nofollow\">here</a>, and the full source code is available on the <a href=\"https://github.com/evan-moon/solarsystemts\" target=\"_blank\" rel=\"nofollow\">Solarsystem project GitHub repository</a>.</p>\n<p>That wraps up this post on calculating planetary positions.</p>","fields":{"slug":"20170503-calculate-orbit-2en","path":"/2017/05/03/calculate-orbit-2/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Implementing Planetary Motion","subTitle":"Implementing a celestial simulation using Kepler's equation","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Equation","Keplerian Elements","JavaScript","WebGL","ThreeJS","Mathematics","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"59c15557-97c3-50f1-afde-ef327112b002","tableOfContents":"<ul>\n<li>\n<p><a href=\"#coordinates-and-reference-planes\">Coordinates and Reference Planes</a></p>\n<ul>\n<li><a href=\"#the-celestial-sphere-and-the-ecliptic\">The Celestial Sphere and the Ecliptic</a></li>\n<li><a href=\"#right-ascension-and-declination\">Right Ascension and Declination</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#orbital-terminology\">Orbital Terminology</a></p>\n<ul>\n<li><a href=\"#ascending-node--descending-node\">Ascending Node / Descending Node</a></li>\n<li><a href=\"#aphelion--perihelion\">Aphelion / Perihelion</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#keplerian-elements\">Keplerian Elements</a></p>\n<ul>\n<li><a href=\"#semi-major-axis\">Semi-major Axis</a></li>\n<li><a href=\"#eccentricity\">Eccentricity</a></li>\n<li><a href=\"#inclination\">Inclination</a></li>\n<li><a href=\"#longitude-of-the-ascending-node\">Longitude of the Ascending Node</a></li>\n<li><a href=\"#argument-of-periapsis\">Argument of Periapsis</a></li>\n<li><a href=\"#time-of-periapsis-passage\">Time of Periapsis Passage</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar expe…","html":"<p>In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar experience.</p>\n<p>There are plenty of resources online about plotting orbits and estimating planetary positions, but understanding them requires familiarity with basic astronomical terminology. Apparently these are terms you learn in a high school earth science class, but since I spent most of high school sleeping, I had to look everything up from scratch.</p>\n<p>I’m not an astrophysics graduate — just a developer — so there may be inaccuracies in my explanations.</p>\n<p>Before diving into the Keplerian elements themselves, let’s cover the most fundamental terms needed to understand the explanations that follow.</p>\n<h2 id=\"coordinates-and-reference-planes\" style=\"position:relative;\">Coordinates and Reference Planes<a href=\"#coordinates-and-reference-planes\" aria-label=\"coordinates and reference planes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Celestial bodies move through an infinitely extending three-dimensional space, so a coordinate reference system is essential to describe their motion. This means deciding where to place the center of the coordinates and what to consider 0° when measuring angles.</p>\n<h3 id=\"the-celestial-sphere-and-the-ecliptic\" style=\"position:relative;\">The Celestial Sphere and the Ecliptic<a href=\"#the-celestial-sphere-and-the-ecliptic\" aria-label=\"the celestial sphere and the ecliptic permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is an imaginary sphere of infinite radius centered on the observer.</p>\n<p>Here, “the observer” doesn’t mean an actual person but the celestial body where the observer is located. Since humans haven’t yet had occasion to use these concepts from any planet other than Earth, the observer is conventionally Earth. The projection of Earth’s equator onto the celestial sphere is called <strong>the celestial equator</strong>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 638px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADBUlEQVR42kWT21LaUBSGN2CLLaJykJNAiJwEAgkhEXIgEQinJAOEgwgosWpVbC/aaa86velMH6DP0Ufq9GG6ou10Jhd71vq/7H/v9W80WH+MV7QMb6S5UYobZfgRLDBGKyuL/vnGuPpANucJVodimhtaXX50LI6jVO/i8SuCHtrL20NlFKBQsIz8pC1Q9uebOdFgh5va4CFdHeCsnmBVe6hiaQKUI0Sjnaw0ukFs/xKYbazmxKqO6MluSmK6l7z+piBNCopZ6pgFaVpTzeb4Lkgo9kN2G+Ne4Tzyl5SzDQIpOqBexmuOQxaq1b5JNs4DhOJO1ffTkidz6joSg8U2Ic+q/bULF1CQfhE9Qd5ia/rwH7aFmYI0o9tLX64JIie4SAotY12UjB2cCxLNSmdJNaYxuhul+8hDtGbPcKC8FT3ZSdY51cQZdS8puhPc7lHNkxaiRH0/Kbhxbv+IdyWUzacrtqN6c8rTzvd/YXuEiZAdUTNDhLKfFjwZ4WWMzdR1VlvBOR2RE2+m/vjZ/PjlJlRogXPkKz3BPQu2RZgCP5CGt7685Iwzuxk5QTXnl5uHbz9duLyNieb96PevH/rqPs1o8Lsn2LJ9ATAKVw6L7dnypjsxk9WBOyWhEBMuT1KNDdHQe4txazrWzx+M+Vu83LFF2L87s5ZtyonxMVoZLK8ZadzoL9TJtazOZc2YrGbqxCiLWorql/iBqK1309LW823PAAbbvlK8ohbloTy8kI3r5njN6/Nqb7y6BZM9W4BxYbw3KxGNOUzREWGcWO0JfrYNo4pVUajiSgji4Lq3eOfPNeCSfDnFl2u9xnl/vlWQzwT9jftIsP+DFYCr6hqFaMgNlCAnnuxppbPitKtcfQphztenWXEMCeO1K+/xKQicGLedgISRbUgY2TxHewV7mLaCDTPwk1thJkJ1S40zTrOY4unskOxuha2Wle0D0gEyV7Y+vEH95ftwqYOxepzR4MMYPVbRgsVOXpooszt18XgsGIFiG4oxWgVTsnErjW7hOd19/v4HfhW6L3NhaLIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"1\" title=\"\" src=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" srcset=\"/static/7ae3e4bed5b1240285335fdd519f6924/69538/1.png 160w,\n/static/7ae3e4bed5b1240285335fdd519f6924/72799/1.png 320w,\n/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png 638w\" sizes=\"(max-width: 638px) 100vw, 638px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The yellow line labeled <strong>ecliptic</strong> in the diagram above represents the apparent path the Sun traces across the sky as observed from Earth.</p>\n<p>In other words, the concepts of the celestial sphere and ecliptic originate from the geocentric model. They define the positions of celestial objects in the sky relative to Earth as the observer.</p>\n<p>Because Earth’s rotational axis is tilted 23.5°, the celestial equator and the ecliptic meet at an angle of 23.5°. Due to this tilt, from Earth’s perspective the Sun appears to orbit Earth while drifting south and then north. The point where the Sun moves from south to north is called the <strong>vernal equinox</strong>, and the point where it moves from north to south is called the <strong>autumnal equinox</strong>.</p>\n<p>But living in the 21st century, we know that it’s actually Earth orbiting the Sun, not the other way around. So while the diagram above shows Earth standing upright with the Sun orbiting at a tilt, in reality the ecliptic is the reference plane and the celestial equator is the one tilted at 23.5°.</p>\n<h3 id=\"right-ascension-and-declination\" style=\"position:relative;\">Right Ascension and Declination<a href=\"#right-ascension-and-declination\" aria-label=\"right ascension and declination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is ultimately a concept for expressing the positions of objects in the sky relative to Earth. The positions of celestial bodies are expressed using right ascension and declination.</p>\n<p>This is the same idea as using the geographic coordinate system with longitude and latitude to express a specific location on Earth. In the geographic coordinate system, latitude takes the equator as 0° and the poles as 90° to mark vertical position, while longitude takes the Greenwich Observatory as 0° and divides 180° east and 180° west for horizontal position.</p>\n<p>By the same principle, when looking up at the sky from Earth, any object on the celestial sphere can be located with just two values — right ascension and declination.</p>\n<p>Right ascension and declination are the longitude and latitude in the equatorial coordinate system, which uses the celestial equator as its baseline. Right ascension measures the counterclockwise angle from the vernal equinox to the target object along the celestial equator. Declination measures the angular distance from the celestial equator to the target object. In short, knowing the celestial equator, the vernal equinox, the right ascension, and the declination is enough to pinpoint any object on the celestial sphere. <small>(Of course, the equatorial coordinate system assumes objects exist on the two-dimensional surface of the celestial sphere, so it doesn’t define the distance to the object.)</small></p>\n<p>An interesting fact is that most celestial bodies — except for solar system objects and comets — barely move on the celestial sphere, so they have essentially fixed right ascension and declination values that make them easy to locate.</p>\n<p>Unlike geographic longitude, right ascension in the equatorial coordinate system is expressed in time units like hours and minutes. Since Earth rotates 360° in 24 hours, 1 hour of right ascension corresponds to 15°. Declination takes the celestial equator as 0° and defines the celestial north pole as +90° and south pole as -90°, so it always falls between -90° and +90°.</p>\n<p>For reference, the coordinate system centered on a ground-level observer on Earth (rather than the equator), using the observer’s horizon as the reference plane, is called the horizontal coordinate system.</p>\n<h2 id=\"orbital-terminology\" style=\"position:relative;\">Orbital Terminology<a href=\"#orbital-terminology\" aria-label=\"orbital terminology permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"ascending-node--descending-node\" style=\"position:relative;\">Ascending Node / Descending Node<a href=\"#ascending-node--descending-node\" aria-label=\"ascending node  descending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A celestial body’s orbital plane is generally tilted relative to a reference plane. The reference plane can vary by definition, but for the solar system it refers to the ecliptic.</p>\n<p>Earlier, I explained that in the equatorial coordinate system, the point where the Sun moves from south to north is the vernal equinox, and where it moves from north to south is the autumnal equinox.</p>\n<p>Similarly, for any body orbiting a central object, the point where it crosses from south to north of the reference plane is called the ascending node, and the point where it crosses from north to south is the descending node. While “vernal equinox” and “autumnal equinox” are terms specific to us living on Earth, “ascending node” and “descending node” are universal terms applicable to any body orbiting along a specific trajectory.</p>\n<p>In the solar system, since the central body is the Sun, the ecliptic is used as the reference.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVR42rVSy2rDQAzUW/uy13Ycm1IKhRZyyKH//3dVHj0k0GN01M5opJkFeHUxkKIm8kJ5SlO3rij/os1tHMfsxYIgLXMxdkEhoON63I/bkhcEeuAgM2hoWMpDzdNh2VJtoIwuoHJ7QlE27T4h4B8NCd1R1Tk1b+5ODG68r8tYizOaEimhXYCD9ZSGy7g7WU01ZXCP9cqleyh1H+e3df85n9dxzpfLQVxHHxQkVCmVOzlz7m21UkmkTSM5l6GoUlwZwqfTV87u6jU1ZgER8oRyVa5ULA4yrW0ADl+U1AIBJrEuIG3b++fHd2szu0cfg4/Xg3O4XzoLI+KDeRjmauJcpDJKACICokeHQ3bu07ZvkU0YSHiLNMXQCJae8niq2LJxm1Jf8lyoZEpOxsgv/3m/zscMNxDZT98AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pluto orbit\" title=\"\" src=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" srcset=\"/static/4693485f3e9d15673833669486a0c618/69538/pluto_orbit.png 160w,\n/static/4693485f3e9d15673833669486a0c618/72799/pluto_orbit.png 320w,\n/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Looking at Pluto's orbit, it's easy to see what it means to rise north or descend south of the ecliptic relative to the Sun.</small>\n</center>\n<h3 id=\"aphelion--perihelion\" style=\"position:relative;\">Aphelion / Perihelion<a href=\"#aphelion--perihelion\" aria-label=\"aphelion  perihelion permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they have two foci. Typically the star occupies one of these foci. The aphelion is the point farthest from the star, and the perihelion is the closest. Parabolic orbits have an aphelion at infinity, so they only have a perihelion.</p>\n<h2 id=\"keplerian-elements\" style=\"position:relative;\">Keplerian Elements<a href=\"#keplerian-elements\" aria-label=\"keplerian elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now that we’ve covered the basic terms, let’s look at the Keplerian elements that define the shape, size, and orientation of an orbit.</p>\n<p>The Keplerian elements consist of: the semi-major axis and eccentricity (which define the orbit’s shape and size), the inclination and longitude of the ascending node (which define the orbital plane), and finally the argument of periapsis (which defines the orbit’s orientation) along with the time of periapsis passage (which pins down the body’s position at a specific time).</p>\n<h3 id=\"semi-major-axis\" style=\"position:relative;\">Semi-major Axis<a href=\"#semi-major-axis\" aria-label=\"semi major axis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they’re defined not by a radius but by a semi-major axis and semi-minor axis. The semi-major axis is the point on the orbit farthest from the orbital center, while the semi-minor axis is the closest point.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35QB/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFhABAQEAAAAAAAAAAAAAAAAAAIEg/9oACAEBAAE/IUTH/9oADAMBAAIAAwAAABBgz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQADAAMAAAAAAAAAAAAAAAEAESEQMUH/2gAIAQEAAT8QG7xNqWnp2Cp2Iw4//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"semi major axis\" title=\"\" src=\"/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg\" srcset=\"/static/18c739abac106732c5daf91effd1103d/0913d/semi-major-axis.jpg 160w,\n/static/18c739abac106732c5daf91effd1103d/cb69c/semi-major-axis.jpg 320w,\n/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg 640w,\n/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg 678w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The difference from aphelion/perihelion is that the reference point is the center of the orbit, not the star. Parabolic and hyperbolic orbits have an infinite semi-major axis, so they only have a semi-minor axis.</p>\n<p>The Keplerian elements only deal with the semi-major axis (not the semi-minor axis) because what matters for orbital energy calculations is the average distance of the orbiting body, not the orbit’s shape. The semi-major axis represents the overall size of the orbit, while the semi-minor axis merely indicates how squashed it is — not a suitable metric for energy calculations.</p>\n<p>For this reason, celestial mechanics generally uses the semi-major axis, and Kepler’s equation does the same.</p>\n<h3 id=\"eccentricity\" style=\"position:relative;\">Eccentricity<a href=\"#eccentricity\" aria-label=\"eccentricity permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 440px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 121.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVR42qWVvYvTYBzHv2l7aZOnbZo06fW8qCDccJXqKs4OgiLcUHR0cBIcfENu6iQK4iCCi8LtB7eJuIrQyb9CEHETzz1+f3mes8nlUhN84JuXPs2H3/sDAF1qzahNdYxs4C739gZ672zH7JfJ1qyLGOAtAryAwhwNFFYSUi6qLaUvAnoCD7uI+DygWhmgBRyuL6HyXrrcvxezLMJcPCX4GfwlWCCfzwBf/mVpDmgZ6XUfDoGj1OJ0Xe4BXzcJb9WxMA9OUou7jO8IN0DgwuGP4n6jDtCwYCUGPGeM3UcYq1sQmECHtYBJ1vXlamAHG96ehECA39y6FtpUjwqNvHd891kN3QfXQ11O1S30qYhSVHOf4r1zAMS/0I0mL1m3WwtJUDsT9zzwyE3eAwGWxKj1nnuHF5ik2zdP89/esdrMW5hoS6KyWM6R1uWpBbA5vTY9h/DTRhpbTOxVwDCb5Wy2L4G1Sbc/OIi3r2xvITiIdZ/HjnHbOcllf4XLst/+McEYd3YIS/orXT6WFMmsk1HnZxrf3jCWpJz/KDG0S5NSUjYDKReRhtG9fXbOvatRSXHXKmzgue/hjYQjCYDvqlZhI5OM2QxN9VCNglfo6zFWr/XyU0eGA/uYd07sZM0MB+v/xlc6yZMm8HusoavHlyoM2N3CgG2Yqe1UGbAOs9Dgx/3ipD6qsWREqQpnCoFTAqSuHnOAFg6pFBZVhBlvfR5Ocdoytmkd14jPMzb/66E+JtdVZu8kybf9P8qYk5p9WHxjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentricity\" title=\"\" src=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" srcset=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/69538/eccentricity.png 160w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/72799/eccentricity.png 320w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png 440w\" sizes=\"(max-width: 440px) 100vw, 440px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Eccentricity is simply a measure of how squashed an ellipse is. In the geometric definition, the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of an ellipse is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>−</mo><mfrac><msup><mi>b</mi><mn>2</mn></msup><msup><mi>a</mi><mn>2</mn></msup></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1-\\frac{b^2}{a^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.44em;vertical-align:-0.7406em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6994em;\"><span class=\"svg-align\" style=\"top:-4.4em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.6594em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:2.48em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"2.48em\" viewBox=\"0 0 400000 2592\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M424,2478\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl0 -0c4,-6.7,10,-10,18,-10 H400000\nv40H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M1001 80\nh400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7406em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> is the semi-major axis and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> is the semi-minor axis. However, the eccentricity used in Keplerian orbits has a slightly different formula.</p>\n<p>The standard formula for an ellipse’s eccentricity only describes the geometric squashing without considering factors like gravity or energy, so it’s not suitable for Keplerian orbits, which are based on the interaction between a body’s kinetic energy and gravitational forces.</p>\n<p>To calculate the eccentricity of a Keplerian orbit, you need to account for physical dynamics like kinetic energy and angular momentum:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>2</mn><mi>E</mi><msup><mi>L</mi><mn>2</mn></msup></mrow><mrow><msub><mi>m</mi><mtext>red</mtext></msub><msup><mi>α</mi><mn>2</mn></msup></mrow></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1+\\frac{2EL^2}{m_\\text{red}\\alpha^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.04em;vertical-align:-1.1156em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9244em;\"><span class=\"svg-align\" style=\"top:-5em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">red</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.8844em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:3.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"3.08em\" viewBox=\"0 0 400000 3240\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M473,2793\nc339.3,-1799.3,509.3,-2700,510,-2702 l0 -0\nc3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM1001 80h400000v40H1017.7z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1156em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>The solution <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of this equation is called the orbital eccentricity.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the total energy of the body in orbit, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span></span> is the angular momentum, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>m</mi><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">m_{red}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">re</span><span class=\"mord mathnormal mtight\">d</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the reduced mass, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span> is the coefficient for the inverse-square law central force. The inverse-square law means a force’s magnitude is inversely proportional to the square of the distance — in this case, that force is gravity.</p>\n<p>Since I’ll be using data where the eccentricity is already provided, I don’t actually need to calculate all this. Just knowing that it differs from the standard eccentricity formula is enough.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 212px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 112.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAUEAQP/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtOZTNLxEPSG0H/8QAGhAAAwEBAQEAAAAAAAAAAAAAAQIDBBETMf/aAAgBAQABBQLTUmk+rEfKpzWjPRYEtOwf3WjShjBEP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAIDAAEFAAAAAAAAAAAAAAECABEhMRBBUWGh/9oACAEBAAY/AmQFgRxUWrOd+hN+4rYBLJu4552Uusfk3zP/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMUFRYXH/2gAIAQEAAT8hXQJuz3MFK2VW3L7bl0HJV6h1uFp3M5tL88mNEeoRL0cIAHbaf//aAAwDAQACAAMAAAAQEwc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAwEBAAAAAAAAAAAAAQARITFhcYFBsf/aAAgBAQABPxAlDhY4mu8dQ1zxRYM3be4kE0th8ajEBzDwN9ahBU4WqyVwQA+xErb8RpGUFjBxmO1cgLHs56I+BEy64n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme\" title=\"\" src=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" srcset=\"/static/68ee7ca2b63f32445afe5c63a2526b87/0913d/skip.jpg 160w,\n/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg 212w\" sizes=\"(max-width: 212px) 100vw, 212px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Keplerian orbital eccentricity takes four forms:</p>\n<hr>\n<ul>\n<li>Circular orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span></li>\n<li>Elliptical orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>&#x3C;</mo><mi>e</mi><mo>&#x3C;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0 &#x3C; e &#x3C; 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6835em;vertical-align:-0.0391em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Parabolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Hyperbolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e > 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n</ul>\n<hr>\n<p>Earth’s orbital eccentricity is currently about <code class=\"language-text\">0.0167</code>, making it nearly circular. Mercury, the planet with the highest eccentricity in the solar system at <code class=\"language-text\">0.2056</code>, receives roughly twice as much solar radiation at perihelion compared to aphelion.</p>\n<p>Pluto used to be the champion in this category with <code class=\"language-text\">0.248</code>, but as we all know, it’s been demoted… <small>(Adiós…)</small></p>\n<p>Comets have quite varied eccentricities. Periodic comets typically range from <code class=\"language-text\">0.2</code> to <code class=\"language-text\">0.7</code>, while some with extremely elongated orbits approach nearly <code class=\"language-text\">1</code>.</p>\n<p>For example, the well-known Halley’s Comet has an eccentricity of <code class=\"language-text\">0.967</code> and takes 76 years to complete one orbit due to its extremely elongated path. Its next approach is in 2061, by the way.</p>\n<h3 id=\"inclination\" style=\"position:relative;\">Inclination<a href=\"#inclination\" aria-label=\"inclination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This is the angle between the star’s ecliptic plane and the orbit. If the inclination exceeds 90°, the body is orbiting in the opposite direction compared to bodies with inclinations between 0° and 90°.</p>\n<h3 id=\"longitude-of-the-ascending-node\" style=\"position:relative;\">Longitude of the Ascending Node<a href=\"#longitude-of-the-ascending-node\" aria-label=\"longitude of the ascending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the ascending node is the point where a body crosses the reference plane from south to north while following its orbit. The ascending node is expressed as a longitude — the angle measured counterclockwise from the vernal equinox along the ecliptic to the ascending node.</p>\n<p>This allows us to define the position of the ascending node in a 3D coordinate system.</p>\n<h3 id=\"argument-of-periapsis\" style=\"position:relative;\">Argument of Periapsis<a href=\"#argument-of-periapsis\" aria-label=\"argument of periapsis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The argument of periapsis is the angle from the ascending node to the periapsis, measured within the orbital plane. As the term “periapsis” suggests, this angle is measured from the gravitational focus of the orbit, not the center of the ellipse.</p>\n<p>This value indicates how much the orbital ellipse is rotated relative to the reference plane (like the ecliptic). If the argument of periapsis is 0°, the ascending node and periapsis coincide, meaning the body is closest to its star at the moment it crosses the ascending node. If it’s 90°, the body is at its closest approach when it’s at the point farthest north of the reference plane.</p>\n<h3 id=\"time-of-periapsis-passage\" style=\"position:relative;\">Time of Periapsis Passage<a href=\"#time-of-periapsis-passage\" aria-label=\"time of periapsis passage permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This marks the time when the body passes through periapsis.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In the <a href=\"/2017/05/03/calculate-orbit-2\">next post</a>, we’ll implement orbital calculations in code. That wraps up this glossary of astronomical terms and introduction to the Keplerian elements.</p>","fields":{"slug":"20170503-calculate-orbit-1en","path":"/2017/05/03/calculate-orbit-1/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Understanding the Keplerian Elements","subTitle":"A guide to Keplerian orbital elements — no astronomy or math expertise required","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Laws","Keplerian Elements","JavaScript","WebGL","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}],"pageInfo":{"currentPage":2,"pageCount":2}}},"pageContext":{"limit":15,"skip":15,"lang":"en","totalCount":29}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}