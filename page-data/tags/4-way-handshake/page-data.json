{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/4-way-handshake/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"bf7fffc2-8817-50bd-8e71-84ed7cbdb5aa","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%97%B0%EA%B2%B0-%EC%A7%80%ED%96%A5%EC%9D%98-%EC%9D%98%EB%AF%B8%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C\">연결 지향의 의미에 대해서</a></p>\n</li>\n<li>\n<p><a href=\"#3-way-handshake\">3 Way Handshake</a></p>\n<ul>\n<li><a href=\"#closed\">CLOSED</a></li>\n<li><a href=\"#listen\">LISTEN</a></li>\n<li><a href=\"#syn_sent\">SYN_SENT</a></li>\n<li><a href=\"#syn_recv\">SYN_RECV</a></li>\n<li><a href=\"#established%EC%9A%94%EC%B2%AD%EC%9E%90\">ESTABLISHED(요청자)</a></li>\n<li><a href=\"#established%EC%88%98%EC%8B%A0%EC%9E%90\">ESTABLISHED(수신자)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#4-way-handshake\">4 Way Handshake</a></p>\n<ul>\n<li><a href=\"#fin_wait_1\">FIN_WAIT_1</a></li>\n<li><a href=\"#close_wait\">CLOSE_WAIT</a></li>\n<li><a href=\"#fin_wait_2\">FIN_WAIT_2</a></li>\n<li><a href=\"#last_ack\">LAST_ACK</a></li>\n<li><a href=\"#time_wait\">TIME_WAIT</a></li>\n<li><a href=\"#closed%EC%88%98%EC%8B%A0%EC%9E%90\">CLOSED(수신자)</a></li>\n<li><a href=\"#closed%EC%9A%94%EC%B2%AD%EC%9E%90\">CLOSED(요청자)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></p>\n</li>\n</ul>","excerpt":"저번에 작성했던 TCP의 헤더에는 어떤 정보들이 담겨있는걸까? 포스팅에 이어 이번에는 TCP의 핸드쉐이크 과정과 그 속에서 변화하는 TCP 상태에 대해서 한번 알아보려고 한다. TCP는 신뢰성있는 연결을 추구하기 때문에 연결을 생성하고 종료하는 순간에도 나름의 신뢰성 확보를 위해 핸드쉐이크(Handshake)라고 하는 특별한 과정을 거치게 된다. TCP를 사용하여 통신을 하는 각 종단은 핸드쉐이크 과정을 통해 어떤 TCP 옵션들을 사용할 지, 패킷의 순서 번호 동기화와 같이 통신에 필요한 몇 가지 정보를 주고 받는다.","html":"<p>저번에 작성했던 <a href=\"/2019/11/10/header-of-tcp/\">TCP의 헤더에는 어떤 정보들이 담겨있는걸까?</a> 포스팅에 이어 이번에는 TCP의 핸드쉐이크 과정과 그 속에서 변화하는 TCP 상태에 대해서 한번 알아보려고 한다.</p>\n<p>TCP는 신뢰성있는 연결을 추구하기 때문에 연결을 생성하고 종료하는 순간에도 나름의 신뢰성 확보를 위해 핸드쉐이크(Handshake)라고 하는 특별한 과정을 거치게 된다. TCP를 사용하여 통신을 하는 각 종단은 핸드쉐이크 과정을 통해 어떤 TCP 옵션들을 사용할 지, 패킷의 순서 번호 동기화와 같이 통신에 필요한 몇 가지 정보를 주고 받는다.</p>\n<!-- more -->\n<p>하지만 말로만 설명하면 재미가 없으니, C를 사용하여 직접 간단한 클라이언트와 서버를 작성해보고 이 친구들이 핸드쉐이크 과정에서 주고 받는 패킷을 몰래 엿본 결과물도 조금씩 첨부하려고 한다.</p>\n<h2 id=\"연결-지향의-의미에-대해서\" style=\"position:relative;\">연결 지향의 의미에 대해서<a href=\"#%EC%97%B0%EA%B2%B0-%EC%A7%80%ED%96%A5%EC%9D%98-%EC%9D%98%EB%AF%B8%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C\" aria-label=\"연결 지향의 의미에 대해서 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>핸드쉐이크를 이야기하기에 앞서, TCP가 생성하고 종료하는 연결이라는 개념에 대한 이야기를 먼저 하려고 한다. 아마 TCP에 대해서 공부해보신 분들은 TCP의 대표적인 특징 중 하나인 연결 지향(Connection Oriented)이라는 키워드에 대해서 들어보았을 것이다.</p>\n<p>연결 지향은 말 그대로 연결되어 있는 상태를 지향한다는 의미이다. 사실 연결과 비연결은 네트워크를 공부하다보면 여러 번 마주치게 되는 단어인데, 필자는 개인적으로 이 단어들의 의미가 조금 헷갈렸었다.</p>\n<p>상식적으로 두 기기가 통신을 하려면 케이블이든 뭐든 연결이 되어있어야 할텐데, 굳이 왜 연결 지향과 비연결 지향을 나누어 놓은 것인지 이해가 되지 않았기 때문이다.</p>\n<p>이게 헷갈리는 이유는 물리적인 연결과 논리적인 연결의 차이 때문이다.</p>\n<p>우리가 일반적으로 기기와 다른 기기를 연결했다고 할 때 떠올리는 생각은 컴퓨터와 모니터를 연결하거나, USB와 컴퓨터를 연결하는 등의 상황이다. 즉, 기기 간의 물리적인 연결이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 19.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42mNggIL//xkY/9czMIHwqlAGZh93JyMvN0crd3dnS2dnZ0MnJyc9L1cHcw8XextvN0d9kBqY+v8MDIwMcIPO+wv8v5US8v9SpiDMYLgkQygziFxVaMG5KsueB8KvZ4JgBPh3K5f9383MoH+3UmQY/j8pKvr/f/n/n5dSJtwp1jB+Ptna4Vm/pd2rSWa2LyeY27ydbGr5dIJF4ItJlpFvp1pagcTeTTG3AakBqX1YoWH87Xhsxf//a///f1E+jeH/3RK9/3fLF/w6l2l6RYuB7c1ED77XnVa8yPhpvTHX//n2HOjiILX34+U5fhyPVP1/v3HO/ztFzgCVcHv231n+BwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"physical connection\" title=\"\" src=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png\" srcset=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/69538/physical-connection.png 160w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/72799/physical-connection.png 320w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png 640w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/d9199/physical-connection.png 960w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png 1251w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>케이블을 사용하여 두 개의 장치를 물리적으로 연결한다</small>\n</center>\n<p>반면, 연결 지향이라는 단어에서 사용하고 있는 연결의 의미는 논리적인 연결(Logical Connection)을 의미한다. 이때 당연히 여러 개의 기기가 서로 통신을 하기위해서는 물리적인 연결 또한 동반되어야한다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVR42mNgwA4YtbVtZR0cHKzdHB2tjH18NExdXQ1c7O1N7O3tLXR17WUYcIH//xkYQRhV7D/j55Mp2uv74wVA/Pf8/IrPxfkVQOwzM9P4P13O1MRqDgOSOf/rGZggdD3L+/X1Av8vpmX//79Q7r+rq9h/AZ6s/4I8af8DAoT/v5yi8v9ietb/VVN4QGpBhsD0Qgy6ECj2/3KgPtRlLEDMAWLf/3+f47u5usJ/EQG7/1PqgZpDef6L8zv8M1ORAclB1XMAMTOYfTXW8P+1WGGG/w8qd/5/3/f/f69T8n8GfsP/3Kx6QFt1//NyF/1XlfO+te0f+//rJcH/b1X43J9/n+O/smTAP17OAqAa7f9crPo/GbgM/8z0z/r/Y/b//w+qljP8v1vZ9P9B/Yn/qyP0Ptl4iH5w0xICKub6Jy1m8Xl2nvjT/0+5fl4o1vl/qUgD6BrO/1OyJEByQDWc/wNMhT/Z24v83xpr8v9hy7n/t8tKGJDDABQZ//+f4QLSrP//nxf4dGOmyJf9UyT+X5om+P9MB/+Xk1MkPj5ZKPz//13+K///s0HVMsLiABwp/xmAhoAwVAIseayX89+NjILvF5oVwfxbuSH/b+T6Q8K8Xu3/1fT8/2dmssLVI5kBAOyQ/gHAEaq2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logical connection\" title=\"\" src=\"/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png\" srcset=\"/static/025135c6a12488fad9c15e904f065386/69538/logical-connection.png 160w,\n/static/025135c6a12488fad9c15e904f065386/72799/logical-connection.png 320w,\n/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png 640w,\n/static/025135c6a12488fad9c15e904f065386/d9199/logical-connection.png 960w,\n/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png 1201w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>조금 더 쉽게 이야기해보자면, 두 기기가 서로 연결되어 있는 상태를 유지하는 것이다.</p>\n<p>전화를 예로 들자면, 전화가 전화선에 연결되어있는 것이 물리적인 연결이고 실제로 다른 전화와 통화를 하고 있는 상황이 논리적인 연결, 즉 연결되어 있는 상태인 것이다.</p>\n<p>그렇다면 왜 TCP는 이런 연결 상태를 유지하는 걸까? 그 이유는 간단하다. 바로 연속적인 데이터 전송의 신뢰성을 위해서이다.</p>\n<p>기본적으로 TCP는 패킷 전송 방식을 사용하기 때문에 보내려고 하는 데이터를 여러 개의 패킷으로 쪼개서 보낸다. 이때 네트워크를 통해 모든 데이터를 한번에 팍! 보내는 것이 아니라 일정 단위로 묶어서 스트림처럼 상대방에게 흘려보내게 된다.</p>\n<p>그럼 한번 데이터를 받는 수신자 입장에서 생각해보자. 패킷 전송 방식의 장점 중 하나는 회선을 점유하지 않고 적은 양의 회선으로도 동시에 통신을 할 수 있다는 점이다.</p>\n<p>그렇다는 것은 각 종단이 동시다발적으로 여러 기기들과 패킷을 주고 받고 있다는 의미인데, 이때 “누가 보낸 몇 번째 패킷”이라는 정보가 없다면 수신 측은 굉장히 혼란스러울 것이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVR42n2Sz08TQRTHB/HCvyGJwYuJ/wAxqZqQGPWg0Xgw8Vc8QeLJRCMcNEYTgUp/7lZol1ZKS0lpqYBCbSnsj/6g7Xa7RbZ0u21QoxjAA4FY6fi2VNMDMMnb75s3M5/35s0iml+VEUJNi2nJG0kt345EeQ2dWU1ADPX04GOoYbgxblaV4aVhOvX5UYhOtDFZmYfQ8VkmtRwVChcRzedrQCaTd4bZZD+bK4ucqERrQHw4MBwTH8/QdBsjyLxe2/diKsTi5W+bZxGXW9uNxIQbADal5XVM89ICk5bmDqoQ14GcUCQt1Ig08SHYPj0fw7oBrTjHpOSYWOxATEb+yQryF04s7XC50rPalfl89EhgVtG6vQFstVHlySCzfr1DczKWKwUjCfEKZJOF+cXEhbj0dY/jpatRfqWdE4vxfWDPgVdmswUqLZW7X73uo8LxnKLGolmZ5fj8ZcRkFXb/GiUS+niNTktnGEGZOqpCNiP3cxn5QWB24QSc/7SfRJlgMoVzKKVsagNOy6nYSrmXXsrcWWDj55Plre6DHgXX50l542myuHFTkEqtaWXLWospv0xL8o92FP+8hmNCvposfK8uraxV42IRHmZ12+/3axoh4DWp397ehy2jHu/OiHs8ZHeM6HxTHzFlpTrHfe/xu1G3HXkmJrHbN7035p/GY/4Z7PIGKl5fADscjvu1vrndzfUCm+rzFqPBsGsyGsNms1k3+NaCCcLSRRBmbDIZ7UgNGHQDewb9AFbNqNdVbFYrJkny7mFAgiB2Yb0GpCgKgETX4OCQqnY0NAQOSVYIgqyqBht/U9QwZDMdBdwGWBD0jXoeznSCqUAKuVwubLVa/6gLoKpVPB4Pttls9xqB0Mv/QGjHjt1uD0N1epir7elyOp2q2hFQRyEbDZoBS4MfAjWBtTaC/g3134S1J3CDW7BXA/rSYrGcBv85xC/9BYcvGjU7koP9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pipes\" title=\"\" src=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png\" srcset=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/69538/pipes.png 160w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/72799/pipes.png 320w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png 640w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/d9199/pipes.png 960w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/21b4d/pipes.png 1280w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png 1427w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>연결 상태가 없는 패킷을 구분한다는 것은 한 양동이에 담긴 물을 구분하고 싶다는 말과 같다</small>\n</center>\n<p>위 그림에서 파이프는 물리적인 연결, 각 파이프 끝의 구멍은 포트, 양동이는 패킷을 처리할 프로세스라고 생각해보자. 이때 연결 상태에 대한 구분을 하지 않고 패킷을 구분하고 싶다는 것은 마치 한 양동이에 담긴 물 중에서 어떤 한 파이프 구멍에서 나온 물을 구분해내고 싶다는 말과 비슷하다.</p>\n<p>그렇기 때문에 TCP는 A와 B의 연결 상태, A와 C의 연결 상태 등 각 기기간의 연결 상태를 따로 구분하고 있는 것이다. 이때 TCP는 상대방과 연결 상태를 만들거나 해제하기 위해 특별한 과정을 거치는데, 이 과정을 핸드쉐이크(Handshake)라고 한다.</p>\n<h2 id=\"3-way-handshake\" style=\"position:relative;\">3 Way Handshake<a href=\"#3-way-handshake\" aria-label=\"3 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>먼저, 연결을 만드는 과정부터 살펴보도록 하자. 연결을 생성할 때 거치는 핸드쉐이크 과정을 3 Way Handshake라고 하는데, 3 Way라는 말 그대로 총 3번의 통신 과정을 거친다.</p>\n<p>이 과정을 거치면서 통신을 하는 양 종단은 내가 누구랑 통신하고 있는지, 내가 받아야할 데이터의 시퀀스 번호가 몇 번인지와 같은 정보를 주고 받으면서 연결 상태를 생성하게 된다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVR42nVUS0sbYRRNa9VYo1GTmBptm7bWRdqdTVtQkFqlUCK48Q+40EILgn/ArRvFjSt1o0hQioLvB4ggogZJIE3MS5OYd2JM1GDQwjg99+vE+mgG7sydjzPnu+fc+43I5/NxJycnXCKR4KLRKLe2tsatr69zR0dHbC2ZTHKxWIwLBAIsJ+z+/j7DbWxscMFgkOFSqRRns9k40fT09Ge32/3BbrdrDQaDdnBwkIXRaNTSmtPp/Li1tVU/Nzf3iXAWi+U9NrzGbW5uamkNG70bGBjQiXBJ6NbQ0PBod3c3l+d5FpTTmujvRc/CbLja2tpcAVdBtwKTyVQCiQmSc3BwcLm3t3eJnEeEu7q6SgRC8c7Ojgy4OElHtQyHnHChyclJKkxJhGJ4JwHQAS/CkOmHF34AIwCa29vbi4B5iMinjeGnjXAul4vhkEeBNYOwABjFteSRkRFFJBJRLi4uqvV6fU04HC6nNUFKbkYyPlSYzWbl8vLyC8KhQeVDQ0PKm5LFML74+Pg4BpILSD63Wq3nqOTy7OzMD8/kmQpBVBqPxyPpdPoCFaYhOY3u/j49PfXNzMw8zlTIJIPADsIwCElKAO8RSPmlUqlqGhsbK5uamqRogBRYC22EyjwUwAQh23hPck9PjxhdEw8PDxd1d3fLPR6PuK+vj0Ci+fn5b+Pj452Uw5IKzG7lysrKa5Bo4L0K36huSpYILw/ujkhmbWFhIR+PIoxHM0QkUWUa1THJ8J1JHh0dLbxVYRZCRgZ/5K2tra90Ol09CFywIwpCmghyKQ7J1nuS8WExJEvHxsYqent7nyEvbWtry8FJ+rq9va3HMfu5tLTUnNmE7Ojo6JACl6PRaPJudRmNkGLnFIaVdzgcV+jgldfr5bH7uVqt/lJVVVWAbkvwcUbFrVESpuAfIXU5FArZQRyCDB/GyAfyENatIHvb0tKipEbdsSYr4bWHVMGdYMDZ2dkfExMT3ylfXV2VYV0GK5729/e/RF42NTUl+x9h1gsjRR6V1NXVNUPJhd/v56HmigK/LzrLcZyce13Oegmm51F16KgJpO7Dw0Mn5tEBQi9Oi4HmFphywj9HlCHkWYLkPBFw9OeRV1dXK26GQFSMePMHzD+L1nW+DwIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way handshake\" title=\"\" src=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png\" srcset=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/69538/3way-handshake.png 160w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/72799/3way-handshake.png 320w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png 640w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/d9199/3way-handshake.png 960w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/21b4d/3way-handshake.png 1280w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>이때 요청자(Initiator)는 연결 생성 요청을 먼저 보낸 쪽, 수신자(Receiver)는 연결 생성 요청을 받은 쪽을 의미한다. 이렇게 표현하는 이유는 일반적으로 우리가 생각하는 클라이언트와 서버, 둘 중에 어느 쪽이든 자유롭게 먼저 연결 생성 요청을 보낼 수 있기 때문이다.</p>\n<p>그럼 한 번 각각의 상태가 어떤 것을 의미하는지, 두 기기가 서로 주고 받고 있는 <code class=\"language-text\">SYN</code>과 <code class=\"language-text\">ACK</code>는 무엇을 의미하는지 살펴보도록 하자.</p>\n<h3 id=\"closed\" style=\"position:relative;\">CLOSED<a href=\"#closed\" aria-label=\"closed permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADl0lEQVR42nVU3U9SYRymDxMLRRMlycrKvLDuiGqzjWW6tqabN/4L1FZX/gPe2oUfN1647CKdOVmT/AA/2ERFwjmnG6KAHEBBOQckD0iQth1Pz4sHE4t3+3He8/Kc5/09v9/zviK/38+xLMvt7+9zDMNwMzMz3OzsLLe3t5daI/+Fw2FuZ2cnNY9GoxxFUSmc2Wzmdnd3U7h4PM45HA5OpNPpXnq93qdOp1O1tLKi6u7pUXV1d6tW1tZUa1jb3Nx8ZrVan4+Pj78gOLvL9cRosaQwBGtZWlKRNWz0uKurq0GEISE/vFp9mddocniePwkyx5roZJDntROc6DLf05OBW1YqcwRcGfnJY02mwp8W8z5rMXNew/iR85vuKGox8wnrd3q1s7NQIBTHjMZi4CIE55vQHzlOcZYgbzeRxOSEUMzb7ZKfC3Mudn6OpkZHAq4RXSC6MM8krQs2x4cP+cBcROTyZOOFeQdrnqM9Y8B9Gw6w87OhhMVs4/3+PGBKTiUbtNoSnmHkqyZThXFwsIqn6VKD9lOJICUnLZngGJtNvjgyclf/+XNVnKJKv3z8KD8rWYzCF0R+/AgHafrQ4/Um7OvriVA4fBQ7OAio1WpZOkObzVa0F4kwyV+/Dt0UldzY2EgexOO/o7GYf3R09Go6Q3EoFJLAGk4aw+PxBND+HbwzsMmaQqGoqq2tvVlXVyddXl6WAms/wEawjo8EMLuwzYpWq82U3NraKkbXxL29vfktLS0yn88nbm9vJyCRXq9/OzAw8IbMJyYmyuDdm9PT0w9AUg2/KvCN4qxkifBy4bxF0msGgyEXj3ylUlkPESyyTFKCZByG3zFI7uvru5aRYRbCFBnqI2tqarrf0NDwHARulCMEQhqHgVQpAsnr/0jGhwWQLO3v7y9ra2u7jXlRc3PzJZyk14uLi4M4Zl8nJyfr05uQcmg0Gilwl6qrq69kdBmNkGLnOI4W73K5jt1u9/HW1hacQycqKipelZeX56HbEnycVpFhJcEFfwlJl4PBoBPEQcjww0Z+kAexvg6yR42NjXLSqHOlyUp4WkOSwblIAcfGxt4PDQ29I3Mjjh/Wi1GKWx0dHfcwvz48PFz8P8KsA5YiNSqsqamph5LDQCDAQ80xCVxfPG6ayNTU1D9dzjqEol8h2aGjqyD1bm9vb8KPLhBu4S5cIr4FppTg7yCuI2RZgsi5IeDIzSOrrKwsORsCUQHi4R/sy4j4AHHV7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way closed\" title=\"\" src=\"/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png\" srcset=\"/static/b234afd5db4ad276398327e6c8e1a562/69538/3way-closed.png 160w,\n/static/b234afd5db4ad276398327e6c8e1a562/72799/3way-closed.png 320w,\n/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png 640w,\n/static/b234afd5db4ad276398327e6c8e1a562/d9199/3way-closed.png 960w,\n/static/b234afd5db4ad276398327e6c8e1a562/21b4d/3way-closed.png 1280w,\n/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>아직 연결 요청을 시작하지 않았기 때문에 아무런 연결도 없는 상태이다.</p>\n<h3 id=\"listen\" style=\"position:relative;\">LISTEN<a href=\"#listen\" aria-label=\"listen permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADfklEQVR42nVUTU8TURStIloUKEqhUlFRkQW6Q9QEEyJKTAwkbPgDLNBEExL+AFs2kG7YGNhAkNAY0LZ8WUOQQgukKUbpFy0tTGln+kELrW3AZBjPHVsEtC+5nTu3Z8675977noRhGD4Wi/HRaJTnOI6fnZ3l5+bm+HA4LMbov1AoxG9vb4v+7u4u73a7RZzBYOD9fr+ISyQSvN1u5yXj4+PPPB7PI4fDUbuyslLb19cnmsViqaXY+vr6Y5PJ9ESn0z0l3Nra2kNseIRbXFyspRg2eqBSqZokWPn0U19ff85sNucKgiAa+RST/Fn0vJQNV1NTk5vGldFP3urqahEkRknOxsbGgc1mO4AvwNiOjo6iNKF0eXm5GLgISUe2Ig4+4QJqtZoSUxChNBgM5gPoRC1YyPShFj4AOQC/t7W1FQBzFnaBNg5FIvZoLMa6XC6fHVj4wRhwIMwDpuRI8sDAQAmaopiamqoYGRmpYlm2lGJpKbkZyfOEM5kUS58+3Zp4964q8e1b6XuVSnFcshSFL9zZ2QmBZB+Sk1arNYnOHsTjcR9qJs9kKBgMl38uzHPJZdO+W6dJ2T+OpeLGhV8/jQuM4DdfzGQoSgaBA4QsCEnyNt45yP6hVCqrGhoartU8fy4T9HpZfP7rWsK44PPoNN4Nnda7uzjvTxoNFoExnpTc1dUlRdek/f39BZ2dnXKv1yvt6ekhkGRiYuL18PDwK/LNX6fKBIa5ZvmsvftFra4WwmHl5/f9yuOS89MvZ06PSCY2OTl5AY8CjEcjy3KxYDCUcrndKavNluK44K+9vTgzODh46USGWQhFMo1GI29pabnT1NT0BI1zoRxBnBaaCKpSBNNh/afL+LAQkmVDQ0Nl3d3dN+Bfbm1tzcFJerm0tDSCY/Zhenq6MbMJlaO9vV0GXE51dfX5E11GI2TYOYFhFZxO5yFm7HBzc1PA7smKiooX5eXleeh2Pj7OqDgxSukp+EtIXQ4EAg4QByCDwRgxIA8gbgXZ/ebmZgU16lRpshIe1ZAyOGUiUKvVvh0dHX1Dvl6vL0a8GKW43tvbexv+lbGxseL/EWZdGCmqUVFdXV0jlOz7fD4Bag7JcH3RWY7MzMz80+WsK13085QdOroKUs/W1tY67lInCDdxF67Q3AJTSvibsCsweRYjOVfTOLp55JWVlSXHLU1UCLv3G5OfidZiiQDBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way listen\" title=\"\" src=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png\" srcset=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/69538/3way-listen.png 160w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/72799/3way-listen.png 320w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png 640w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/d9199/3way-listen.png 960w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/21b4d/3way-listen.png 1280w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>수신자가 요청자의 연결 요청을 기다리고 있는 상태이다.</p>\n<p>이후 요청자가 연결 요청을 보내기 전까지 수신자는 계속 이 상태로 대기하게 된다. 즉, 적극적으로 상대방에게 대시하지 않는다는 것인데, 그래서 이 상태를 수동 개방(Passive Open)이라 하고, 수신자를 Passive Opener라고도 한다.</p>\n<p>소켓 프로그래밍을 할 때, 소켓 바인딩을 한 후 <code class=\"language-text\">listen</code> 함수를 호출하게 되면 수신자가 LISTEN 상태로 들어가게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Listen failed...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server listening..\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이후 수신자는 요청자의 연결 요청이 확인되면 <code class=\"language-text\">accept</code> 함수를 호출하여 다음 단계로 넘어가게 된다.</p>\n<h3 id=\"syn_sent\" style=\"position:relative;\">SYN_SENT<a href=\"#syn_sent\" aria-label=\"syn_sent permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiElEQVR42nVUS08TURSuD7RooTxakIeKisSgu4oaISEixMRA4oaFWxbVRA0Jf6BbXEBwwUIpCyGGQJTGUsujvKQChTQ0qZU+KC10aGdaalvANsVkGL87tsjD3uRMT89897vnO/ecEXg8HjYcDrOhUIhlGIadnJxkp6en2c3NTT5G3gUCAXZjY4P3I5EI63Q6eZxer2e9Xi+P29nZYa1WKytQqVQPXS7XXZvNVrG4uFjR2dnJ29LSUgWJORyOe/Pz81UajeYBwVksljs4cB83OztbQWI46HZHR0e9AEtEHtXV1aeNRmMax3G8EZ/EBH8X+T2fCieTydISuALySDeZTFmQGCJyVldXd5eXl3fhczC6ubk5K0EoXFhYyAUuSKQjWx4Hn+B8AwMDJLF8Qij0+/0iAO2hcJi22e2U1WajwpEIAzM3NTVlAHMSdpYcjHpaUTN6ZWWFQs0o+H6QmkGYDox0X/JMd7eUM5vzTSpVie79uzLO6czTdr+RJqSkJSVjo9QM3Ojo6JW+vr4yXFBeV1dX/kHJwj2DITM69y3gG9fFXVpNdHnwYzQwNbEbn5+lvE+fSpIZgig7GAwysVgsjgxjkBzD7f7e2tryqNXqc8kMhZzFIvqln7ExE+O0e1hDOT6rNgLTk0x0Tv89fuNG2VBNTdHV2lrxqtEoRnks29vbFDJzE4NcL2QvHZM8pVAIObdbaFUqM97K5RLiz7W1EZBg7suX518/fHhG/E/DwwXo3aKxsbHrIClH7QuVSmXhQcmixJ8TR1skGXul1Z59LRBkeGWyup80Hab9/hiy4yVjGHjJPT095w9lmIJQoAXZlFotuf/kybWW+vqqTYZZ8QcCfhDSaHwaKwjJP45JxsZMNKq4t7e3oLW19RL87MbGxlOYpMcGg6EPY/ZxZGSkLnlIG8ohl8vFwJ0qLy8/c+iW0cxipL6DZuXsdvsebnBvbW2Nw+nRkpKSR8XFxemYEBE2J1UcaqVEF/wjJI3t8/lsIPZBhgfz6wG5D/EfILvV0NCQ39LSIjlSmpSE+zUkGRwxHjg0NPSyv7//BfF1Ol0u4rkoxcX29var8HMGBwdz/0eYcikUClKjrMrKyjooiVMUxUHNHjF8vsgsBzE5x2455UoU/QzJDjdqAqlrfX3dgX60g3AN07LoRt8Ck0fwl2E5MEkKI3IuJHDkyyMpLS2VHrQEUSbs5h+zi4w8rnD0PAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synsent\" title=\"\" src=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png\" srcset=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/69538/3way-synsent.png 160w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/72799/3way-synsent.png 320w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png 640w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/d9199/3way-synsent.png 960w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/21b4d/3way-synsent.png 1280w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>요청자가 수신자에게 연결 요청을 하면서 랜덤한 숫자인 시퀀스 번호를 생성해서 <code class=\"language-text\">SYN</code> 패킷에 담아 보낸 상태이다. 이제 요청자와 수신자는 이 시퀀스 번호를 사용하여 계속 새로운 값을 만들고 서로 확인하며 연결 상태와 패킷의 순서를 확인하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [S], seq 3414207244, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>TCP 세그먼트를 캡쳐할 수 있는 <code class=\"language-text\">tcpdump</code> 유틸리티로 이 과정을 확인해보면 요청자가 패킷의 플래그를 SYN 패킷을 의미하는 <code class=\"language-text\">S</code>로 설정하고 시퀀스 번호로 <code class=\"language-text\">3414207244</code>라는 값을 생성해서 수신자에게 보내고 있음을 알 수 있다.</p>\n<p>이 경우는 요청자가 수신자에게 연결을 생성하자고 적극적으로 대시하는 상황이므로 이 상태를 능동 개방(Active Open)이라고 하고, 요청자를 Active Opener라고도 한다.</p>\n<h3 id=\"syn_recv\" style=\"position:relative;\">SYN_RECV<a href=\"#syn_recv\" aria-label=\"syn_recv permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADg0lEQVR42nVUTU8TYRCuH0hRoCAtlYqKih6QG6ImmDQiRGLkSLhzQBNNSPgDvXKBQAwn6IkQhCA1BYqINtXaIKRpSaX0kwJb6Lal0NJKAybL+szaIh/2TWZ3dvbZZ+eZmfcVMQzDRaNRbnt7mwsGg5xer+cMBgO3ubkpxOhdOBzm1tfXBT8Wi3Fer1fAGY1GbmNjQ8AlEgnO4XBwIo1G89Tn8z10Op3V8/Pz1b29vYJZLJZqirnd7kezs7OPJyYmnhBucXHxAX54iDOZTNUUw4/ud3d3vxBh5dJFqVSeN5vNWTzPC0Y+xUR/F90vZcJVVVVlpXAldMmxWq0FkLhNcpaXl/eXlpb24fMwtq2trSBFKJ6bmysCLkLSka2Ag0+4wMjICCUmJ0JxKBTKBdCFWrCQ6Uct/AAGAbS1tLTkAXMWlk0/Rj0dhPN4PAIOfghYGwhzgJEdSlar1TI0RT41NVU2NDR0l2XZYoqlpGSlJeNDmc1mk09PT98kHBpU3NfXJz8qWYzC529tbYVBsgfJu3a7fReZ7MfjcT9qJk1nCKLCSCQSTCaTe8gwCclJdPf3zs4Oo9VqL6YzFCSDwAlCFoQkZR3PQUj5qVAo7tbW1l6tq6uToAGSUDi8GE8k/B6vd4UsGottoPiWU5JVKpUYXRP39/fntbe3S1dWVsSdnZ0EEk1OTr56Nzj4knzz+/clu1brVcvo6J3PanUF73AoPr19qzgqOTf1cObkiKRjup6ebNzymior62Nf9dGg/nPSO6FNOj6MJdkvM79/zZoYfmHh0rEMMxCK3Dpdtkqrleqam2+bGxoex78ZPGGDPuTTjbMe7QcW5JGEyWjnGea4ZJ1Olw/JkoGBgZKOjo7r8AtFTU3nvms0zx0/fgxZjMZR48eP9YTl3e5sBuXoaG2VAHdOVVFx4ViX0QgJRiaBYeVdLtcBOnjgW13loyy7+7Os7BlfWpojUypz8XFaxbFRSk3BP0LqciAQcII4gMFmMEbMss8X2AyF7PWlpZW1jY1yatSJ0mQkPKwhZXDCBOD4+Pib4eHh1+TPzMwUIV6EQ+VaV1fXLfiXx8bGiv5HmHFhpKhGBTU1NfVQsuf3+3moOSDD8UV7OYKdc6rLGVfF36JfoOywd60g9a2trblxlrpAuIrdMk9zC0wx4W/ALsOkGYzkXEnh6OSRlpeXy45aiigfdu8PYW6M66s3vdgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synrecv\" title=\"\" src=\"/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png\" srcset=\"/static/5bd44caabf2f0d8fa07c3974a108337d/69538/3way-synrecv.png 160w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/72799/3way-synrecv.png 320w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png 640w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/d9199/3way-synrecv.png 960w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/21b4d/3way-synrecv.png 1280w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p><code class=\"language-text\">SYN_RECV</code>는 요청자가 보낸 SYN 패킷을 수신자가 제대로 받은 상태를 의미한다.</p>\n<p>이후 수신자는 제대로 된 시퀀스 번호를 받았다는 확인의 의미인 승인 번호(Acknowledgement) 값을 만들어서 다시 요청자에게 돌려줘야한다. 이때 승인 번호는 처음 <code class=\"language-text\">요청자가 보낸 시퀀스 번호 + 1</code>이 된다.</p>\n<p>이 승인 번호 만드는 과정은 어렵게 생각할 필요가 없는게, 저번 포스팅에서 이야기했듯이 TCP를 사용하여 실제로 데이터를 주고 받을 때에는 <code class=\"language-text\">상대방이 보낸 시퀀스 번호 + 상대방이 보낸 데이터의 byte</code>를 합쳐서 승인 번호를 만들어낸다. 즉, 내가 여기까지 받았으니, 다음에는 여기부터 보내달라는 일종의 마킹인 것이다.</p>\n<p>그러나 이런 핸드쉐이크 과정에서는 아직 데이터를 주고 받지 않기 때문에 시퀀스 번호에 더할게 없다. 그렇다고해서 시퀀스 번호를 같은 번호로 주고 받자니 패킷의 순서를 구분할 수 없지 않은가? 그래서 그냥 1을 더하는 것이다.</p>\n<p>방금 전과 마찬가지로 tcpdump 유틸리티를 사용하여 이 과정을 확인해볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.receiver > localhost.initiator: Flags [S.], seq 435597555, ack 3414207245, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>수신자가 요청자에게 보내는 패킷을 캡처해보았더니 패킷의 플래그가 <code class=\"language-text\">S.</code>로 설정되어있다. 이때 <code class=\"language-text\">.</code>가 의미하는 것은 헤더의 <code class=\"language-text\">ACK</code> 플래그 필드가 1이라는 것이므로 이 패킷에는 유효한 승인 번호가 담겨있음을 알 수 있다.</p>\n<p>수신자는 이번 통신을 통해 요청자에게 <code class=\"language-text\">3414207245</code> 이라는 승인 번호를 전달하고 있는데, 이 값은 방금 전 요청자가 보냈던 시퀀스 번호인 <code class=\"language-text\">3414207244</code>에 1을 더한 값이다.</p>\n<p>또한 랜덤한 수로 자신의 시퀀스 번호인 <code class=\"language-text\">435597555</code>를 다시 생성하여 함께 요청자에게 보내주고 있는 것을 확인할 수 있다.</p>\n<h3 id=\"established요청자\" style=\"position:relative;\">ESTABLISHED(요청자)<a href=\"#established%EC%9A%94%EC%B2%AD%EC%9E%90\" aria-label=\"established요청자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADgklEQVR42n1US0sbURQea6OJxvcjVgVLKy4CUtGmLaUQGumituAqG3+AiK0b/QFZiSC4EHQhVgSfVVDUJDagrYnRaK1Ym0ajSTSaTN4m8UFjsxin302TEKX2wpk5995vzj3fd84dym63X56enl4FAgHG5/Mxi4uLzPLyMuN2u5lgMBgxr9fL0DQd8YFlDg8PmaWlJUaj0TD4PrJ+cXHB7O3tMdTMzMxLAJ4aDIYnW1tbot7e3ohtbGyIABCZTKZna2trLxQKRRynVqvjuNXVVRFZw0GPMX9DYfDJQywW3+3r6+OwLBuxzc1NDlmj/g7yTo/hyF4irqamhhPFCcgjbX19PRN0PYQ6sgjv7u6GIcHV2dmZp729vQCYZBhPq9XmAOcCxTgOPgvzqFSqXGAIluJtb2+nQycDgrjNZrPdaDTa/X6/GwcYOjo6coBJgnGxngGcnuD29/cjOOIjoGF+fj4TmLw45YGBgQIUQgCx709PT1dA5MKhoaHCKBVOjDLB6fX6CG58fLzCYrEU9vf3CxIpcyEqHyfRLpcrfHBw8GtnZyeE4L8R1NHc3FwUzTAVemWdnJzYQqFQGExCoBwCJgxpaByQHcswTtnj8bgRkFChMXeB8k5VVZVQIpGU1NfXZ6+srBDK38/Pz2lkZiUGujTk+UH2rlGWyWRcq9XKRRtltLa25hMfa2lkT6lUNo2MjDQRf2pq6p7NZitBRuWTk5NCFKl4bGysOJEyPzpJutkisbXu7u5UvDIqKytrnU6nD0wuY5QhTZhknEj5fwGpwcFB7sLCQl5DQ8ODurq65whgBG0vpHGi0i7MfdDfSFrvWkDT8HAmywayvvb0FH1oaytD02azUmny3Nzca51O9xHXcQq99opg0SKpXV1dvMbGxizgkoVCYcq1KrMQ9EyrDhyp5lmTfPbKDLPC935euGyorn5LUaU8qVjMx8cxFtdaCeNOYkAeiyoHNeqfR5+ULot81maRz9msKqUzoPlitIoeVeklEoG0paXghjS3BoxrSDJINFSRXDlKI5e/105MvCO+SqfLxV4eaJd2dnY+hJ87Ojqa/6+Atw6pTJbSSFFZlyJRrd/huLDRNIuiXBFzOBwsqhwg9/xmlW8d0b9JCqtQ5AT9/m9oncPj42MT+nEfvhW3ZZPc81jAMhj5U+TfYgRUFMVFeq28vLwg0aJ/GdI2wj/W6IuG9QJJxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established client\" title=\"\" src=\"/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png\" srcset=\"/static/71081fa52243d495fece15995bd54306/69538/3way-established-client.png 160w,\n/static/71081fa52243d495fece15995bd54306/72799/3way-established-client.png 320w,\n/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png 640w,\n/static/71081fa52243d495fece15995bd54306/d9199/3way-established-client.png 960w,\n/static/71081fa52243d495fece15995bd54306/21b4d/3way-established-client.png 1280w,\n/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>요청자는 자신이 맨 처음에 보냈던 시퀀스 번호와 수신자가 응답으로 보내준 승인 번호, 즉 <code class=\"language-text\">내 시퀀스 번호 + 1</code>를 사용하여 연결이 제대로 성립되었는지 확인할 수 있다. 자신이 보냈던 시퀀스 번호와 이번에 받은 승인 번호의 차가 1이라면 제대로 연결이 되었다고 판단하는 것이다.</p>\n<p>이후 요청자는 연결이 성립되었다고 판단하고 <code class=\"language-text\">ESTABLISHED</code> 상태로 들어가면서, 이번에는 수신자가 새롭게 만들어서 보내줬던 시퀀스 번호에 1을 더한 값을 다시 승인 번호로 사용하여 다시 수신자에게 보내준다.</p>\n<p>즉, 마지막으로 수신자가 보내줬던 시퀀스 번호인 <code class=\"language-text\">435597555</code>에 1을 더한 값인 <code class=\"language-text\">435597556</code>이 요청자의 승인 번호가 될 것이다…만 tcpdump의 동작은 필자의 예상과 달랐다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [.], ack 1, win 6379</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCBQb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABWi/YjmxwZ//EABoQAAMAAwEAAAAAAAAAAAAAAAECAwAEExL/2gAIAQEAAQUCWY881M+a5rKGCzQZtzVa/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BiP/EABsQAAICAwEAAAAAAAAAAAAAAAABESECEEEi/9oACAEBAAY/Asr5ro5Uj8opRR//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMUHw/9oACAEBAAE/IacrYwEBHs+TEgqPsUrwgQrNsn//2gAMAwEAAgADAAAAEGAf/8QAFhEBAQEAAAAAAAAAAAAAAAAAACEB/9oACAEDAQE/ENRX/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQBx/9oACAECAQE/EELbv//EABsQAQEAAwEBAQAAAAAAAAAAAAERACFBMVHw/9oACAEBAAE/ECaIzaEBEwiQHmL93iWhk/OY5kgRZj8a+ZTd5g8g2JC15n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"why\" title=\"\" src=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" srcset=\"/static/0d802ed236b13cf140bc5d184c65e2a3/0913d/why.jpg 160w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/cb69c/why.jpg 320w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>왜 1이 거기서 나와...?</small>\n</center>\n<p>원래대로라면 <code class=\"language-text\">435597556</code>이 되어야할 요청자의 마지막 승인 번호가 뜬금없이 <code class=\"language-text\">1</code>이 되었다. <small>(당황…)</small></p>\n<p>사실 이건 TCP의 자체 동작은 아니고 <code class=\"language-text\">tcpdump</code>가 제공하는 기능이다. <code class=\"language-text\">tcpdump</code>가 패킷들의 시퀀스 번호를 알아보기 쉽게끔 “상대적인 위치”로 알려주기 때문이다. 이후 이 두 종단이 주고 받는 데이터를 <code class=\"language-text\">tcpdump</code>로 캡처해보면 이게 무슨 말인지 조금 더 쉽게 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [P.], seq 1:81, ack 1, win 6379, length 80: HTTP</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>원래대로라면 요청자가 마지막으로 보내는 승인 번호는 <code class=\"language-text\">435597556</code>이 될 것이기 때문에 첫 번째로 전송하는 데이터의 시퀀스 번호의 범위 또한 <code class=\"language-text\">435597556:435597637</code>로 출력되어야한다.</p>\n<p>그러나 인간이 이렇게 큰 숫자를 계속 보면서 분석하기는 쉽지 않기 때문에 승인 번호를 <code class=\"language-text\">1</code>로 보여주고, 이후 주고받는 첫 번째 시퀀스 번호를 1부터 시작해서 알아보기 쉽게 만들어주는 것이다. 확실히 <code class=\"language-text\">435597556:435597637</code>보다는 <code class=\"language-text\">1:81</code>이 알아보기 쉽다.</p>\n<p>하지만 이건 인간이 알아보기 쉽게 <code class=\"language-text\">tcpdump</code>가 친절함을 베푼 것일뿐 실제로 값이 1로 변경된 것은 아니기 때문에 <code class=\"language-text\">tcpdump</code>의 <code class=\"language-text\">-S</code> 옵션을 사용하여 이 기능을 비활성화하면 원래 승인 번호와 시퀀스 번호를 그대로 출력할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> tcpdump <span class=\"token parameter variable\">-S</span>\nlocalhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">435597556</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"established수신자\" style=\"position:relative;\">ESTABLISHED(수신자)<a href=\"#established%EC%88%98%EC%8B%A0%EC%9E%90\" aria-label=\"established수신자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYUlEQVR42nVU3U9ScRimTMX8QAUk0crKvKAu3Izqws1lWlvTzRv/AS+srTY3/wEu88bNG67UC3WOyVpuighYjM3hB3OwESj4AQz5FlEkSduOp+c9gfkRv+095z0/nvP83ud53wPP7/czBwcHTCKRYCKRCGM0GhmTycTs7e1xe/RbLBZjAoEAlx8eHjLb29scbnFxkQkGgxwulUoxGxsbDG96evq1x+N54XK55BaLRa5UKrmwWq1y2tvc3Hy5vLzcrNFoXhHO4XA8x4HnOLPZLKc9HPRsaGiog4dVQpeWlpZba2tr+SzLckE57fH+LroX58I1NTXlZ3DVdCmy2WzlkJggOTs7O6fr6+unyFlEuK+vrzxDyF9dXRUCFyfpqJbDISdcSK1WU2ESIuRHo9ESAN3wIgyZu/BiF8AIgPaenp5SYG4iCulg+LlBuK2tLQ6HPAqsHYRFwIjPJY+OjorRFMn8/HydSqVqCIfDVbSXkZKflYwXxXa7XaLX6x8QDg2qGh4ellyUzIfxZfv7+zGQnEDysdPpPEYlp0dHR7vwTJStEEQV8Xg8kk6nT1BhGpLT6O7vZDLpn5mZuZ2tkJMMAhcIwyAkKQE8RyDlh1QqbWhtba1pa2sToAECYB10ECrzUgAThGzrNckKhYKPrvFHRkZK+/v7RV6vlz84OEgg3tzc3IfJycn3lMOSasxujcFgeAwSGbyX4h3pRcklmYcbV0cku6fVagtxK8V4tEPEAapMozpOMnznJI+PjxdfqjAHIUcGf0RdXV2POjo6mkGwBTuiIKSJIJfikOy8JhkvlkGyYGJionpgYOAe8oru7u48fEnvVlZWVPjMvuh0uvbsIWRHb2+vALg8mUxWcKnLaIQAJ6cwrKzb7T5DB898Ph+L04/r6ure1tbWFqHbJXg5q+LSKGWm4B8hdTkUCrlAHIIMP8bID/IQ9p0ge9rZ2SmhRl2xJifhuYdUwZXggLOzs5+mpqY+Uh5Y+CpkkwGhRam8O/lZ8ZBlDyvXx8aE/yPMudQKBXlU/gZdTpiMJ36DjvVoNWcUwW8G9ueSOQ5/rnU558qYXkCV/FpZskW+L3gCet1m0KB3R4wLvpPVZQvNMDBVhL+PqESIcgTJuZPB0T+PqLm+XsxFY6O4EfcMURniyR8gPYl1Eyx9hwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established server\" title=\"\" src=\"/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png\" srcset=\"/static/be47dca10f68741755f229c81dba5895/69538/3way-established-server.png 160w,\n/static/be47dca10f68741755f229c81dba5895/72799/3way-established-server.png 320w,\n/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png 640w,\n/static/be47dca10f68741755f229c81dba5895/d9199/3way-established-server.png 960w,\n/static/be47dca10f68741755f229c81dba5895/21b4d/3way-established-server.png 1280w,\n/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>요청자와 마찬가지로 수신자 또한 자신이 보냈던 시퀀스 번호와 이번에 받은 승인 번호의 차가 1이라면 제대로 연결이 되었다고 판단하고 <code class=\"language-text\">ESTABLISHED</code> 상태로 들어가게된다. 여기까지 오면 요청자와 수신자는 안전하고 신뢰성있는 연결이 생성되었다고 판단하고 본격적인 통신을 시작할 수 있다.</p>\n<h2 id=\"4-way-handshake\" style=\"position:relative;\">4 Way Handshake<a href=\"#4-way-handshake\" aria-label=\"4 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>연결을 생성할 때와 마찬가지로, 연결을 종료할 때도 특정한 과정을 거쳐서 연결을 종료해야한다.</p>\n<p>그냥 연결을 끊어버리면 안되냐고 할 수도 있지만, 한 쪽에서 일방적으로 연결을 끊어버리면 다른 한 쪽은 연결이 끊어졌는지 지속되고 있는지 알 방법이 없다.</p>\n<p>또한 연결을 종료하기 전에 아직 다 처리하지 못한 데이터가 있을 수도 있기 때문에 양 쪽이 다 정상적으로 연결을 종료할 준비가 되었는 지를 확인하는 과정이 필요한 것이다.</p>\n<p>이때 요청자와 수신자가 총 4번의 통신 과정을 거치기 때문에, 이 과정을 4 Way Handshake라고 부른다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEFElEQVR42pVUSUtbURSObaMxxiimMYNtBbHQZldstAsXLYoItW6KqxakpQjFghURdOUv0I1uxAkRxAFxFkVExVnEBquJcYqkMYnGOMShPvHl9TuvLzZxKO2Fm3tyc3Lu/YZzRVarld3f3+enzWZjh4eH2ZGREXZ3d5fd29vj93d2dvjfKD44OGDX19fZoaEhdnR0lN+nvOPjY9ZoNLKi9vb2lI2NjaTFxcXE2dlZfVNTk762tlY/Pz+vX15e1q+srLyYmppK7unpeeXLm5iY0Dc0NPB5FBsMhiQc9LysrOyNCCOcPkpKSu5xHCf2n7Qn+j1oDbstLycnRyzkaelDCggRDodj12QyeZeWlhjcjDGbzZzb7Xbm5eVFCgUlgKRAnht5BI/BygAB5W11dXVJkaOmgqHb29syJBo3Nzcda2trP2gidoKb74WFhYTgDmaIxWKJtNvta1hdyHGsrq46ELtdLtdSX19fCHJUl5Db2to0uH7M5ORkfEtLiw6xlvYEKGIf5Lq6Ogl+k4BDeVFRkQJxSH5+fqg/5FBcPRynOKD4GSCc4PsJSGYwbRkZGfcpSalUyoQ/BV09REDwpyCUkzmdTjOg70BJO6YDFnGBG1NsbOwTlUoVnZWVFfGvBcP9N0kxnU7H3wbQ79La0dHxrqqq6j3FMzMzBFMBuz2ETeIQR9XX1ytuKhh01SK+PVglmPISExNfQ5RzCMjBGV4I4gUqDqZ24XDiMfqfCiJZJpVK1SkpKc9Q0Ayut6AyUbOF4QQ1BtAWHKByf39/FEGBsg8ICgSJGhwc5KHAY4Uo+sGfBoFDqRDfDRAFysrhuUP0LEcwcLr39PSUDHsCQV7Gx8fL09PT5cKfROh3CdqxAOvXK+h+FwQnYVDZCD7sKGiFqa1kIzwQi8nJycorthHhAiG9vb2fmpubP95U0Mfh38alRQYGBqI9Ho+yoqJClpubqzg6OopubGxU/VdB2IgIF5eXl2tR4ASDw7PlBTKeGoZhXKWlpddUvmnwUKqrq8M1Gs2j1NTUp+D5O+ghWixQ2QKabOB67prKaG4lkjTwlJomXhMN3jr+xNbW1o94J99SDCfwDZCQkOCvckCnSKanp+WHh4ceMikpjFfEi+8clP8JMdKQEwy1w4SCQX4FfW9kYC/DnFJAGQMnCyj4DdMAhRcwx9RqtS4zM1NbXFysvKGXpbf2MnpVRTBh5jg8UU8ohon5B7Ozs/ML4s8Uj4+Pa9EpMd3d3Y9ramp0sJcWva4NgEzGhnoelmU5JPOQKT4/P9/Lzs6OFG4VgV5OAw3MxcXFZR4o4M7OzgJ6mYcM/ibxZBmh3AIafwGxCXOsoKAgzPdiV1ZW3kfeNIr65y1D5dG5uTmxT2W5cIPbJl9MoOZvOTzkX+JaE9Cfxie/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way handshake\" title=\"\" src=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png\" srcset=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/69538/4way-handshake.png 160w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/72799/4way-handshake.png 320w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png 640w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/d9199/4way-handshake.png 960w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/21b4d/4way-handshake.png 1280w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>이번에도 요청자(Initiator)와 수신자(Receiver)라는 용어를 사용하고 있는데, 3 Way Handshake와 마찬가지로 클라이언트와 서버, 둘 중에 어느 쪽이든 연결 종료 요청을 시작할 수 있기 때문에 이런 용어를 사용하는 것이다.</p>\n<p>먼저 연결 생성 요청을 했던 쪽이 먼저 연결 종료 요청을 보낼 수도 있고, 반대로 처음에는 연결 생성 요청을 당했던 쪽이 이번에는 먼저 연결 종료 요청을 보낼 수도 있다.</p>\n<p>사실 개발자들은 3 Way Handshake보다 연결을 종료하는 과정인 4 Way Handshake에 더 예민하게 반응할 수 밖에 없는데, 연결을 생성하는 과정에서 문제가 발생하여 연결이 생성되지 않는다면 다시 시도하면 그만이지만, 이미 생성된 연결을 종료하는 과정인 4 Way Handshake에서 문제가 발생하면 그대로 연결이 남아있기 때문이다.</p>\n<p>게다가 4 Way Handshake는 3 Way Handshake처럼 순차적으로 주고받는 방식이 아니라 상대방이 응답을 줄 때까지 대기하는 과정이 포함되어있기 때문에 중간에 뭐 하나 엇나가면 서로 계속 대기만 하고 있는 데드락(Deadlock) 상황이 연출될 수도 있다.</p>\n<p>물론 조건에 따라 일정 시간이 지나면 타임아웃이 되며 연결을 강제로 종료하거나 다음 단계로 넘어갈 수도 있지만 그래도 그 시간 동안 프로세스가 메모리와 포트를 점유하고 있으므로 트래픽이 많은 서버라면 이로 인해 병목이 발생할 가능성은 늘 있다.</p>\n<h3 id=\"fin_wait_1\" style=\"position:relative;\">FIN_WAIT_1<a href=\"#fin_wait_1\" aria-label=\"fin_wait_1 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEWklEQVR42pVV3U9aZxw+XSfSARpkioy0yVy6rmb2xuGMmTE28WYzbF6QLE22XdUba3bVxO3G/8BE442hkRjiF1anxTHNqqCi25zR1Vik8iHfB1FRURGmh7PnPT0YdGxzb/LC77w85/d7n+f3AeX3+5m9vT1uE3t6epqxWCzMzs4OE41GufOtrS0mEAhw9sHBAeN0OpmpqSlmdnaWCQaDzP7+/unR0RG7vb3tpcbGxu673e6P7Xa7an5+XjUwMKDq7u5WLS8vq8jZxsZGpdVqrR4fH68luLW1tQoEVOn1eg5H3iG49fX1qsXFRRWFJSYfra2tb7Ism5O5yRn1euVgi4jR2NiYcxlXU1OTxnHfQpvNJqNpeh9RGNhJREziZuzu7m5ArVZLysvLicNcl8slJzhgOBzwCdAnuE2NRkMudp04zIVW+SGadrjcbtrhdPkdTqd/0+PZ2o1GV+rr69/igQLoKAuFQptYEYfDEcamYUeh9wqCEty1c8pLer2CPT5WvjQ+vW3Rau+yvlfK33S64gzK5AVKp9MJQVMIDfNaWlpkxIY0wkzKuezcnDQ2N7PjnfwpsfFsNG4f/eF4zzr759GC1bv/4DMpiSznNUzfIjNIxhnvcGkp/2DO4g5PP494TD/SvgkTvTc/tx2bn11LKJW3h0tKiso1mvyrOhTzD29w1Lu6curu3eNuozEYOJF/NRq/ft7V9SWxn5nNb4OmzGAw3Oro6HgXdgFKSprNYWaUC/TgWPCYoiTe6urPd8Lhs2AoxLpdrpTH42EikQgbj8cDdXV1ogtJ+TeHo0+eSPBV/L1a/REdDDpRAUGUUAiFDt+hLXTQYmVl5Y0LDicmJgoIlf7+/pttbW0lpETIGfkN3fTdU4PhK2IbeBmIhgqFIntSvF6vFLUYR8+yqKsUijV1cnLCgs6hWCz+pKKiIo8UOP8StbCwcAP78czMzCPq4nrtENfPD4fDG9ikan0I4EWx0mj2F2VlZVL+BmkZKGCESETj0NDQN9kciqn/Xue9DPryWCxW2NnZKW5qapIdHh4WQYZCHnf9Sg5LS0sFJHpPT88tjKkEnLDQOIW+ZhKJBHt6ehoARnw5y9kWB2hvb8+TSqU3GxoaPoSuNkjjRclsIsub0D0I/Rf+luXh4eEigBS4QTHZmCaKycnJIvIbtHrY29v7BbFRCVwD8BMoe5YxNAugSxyRWSQohdGVIrSQlGORSHSfTBq5XC7iHV677DB9dj4P8aIEVH6BJi/gcAVl8wdorCLTFoFAcAezTtnc3Fz4v3pZq9XKCWWTyfQeRtQHhLKOH19Go/HbwcHBh3wNKn0+n3JkZOR9JOkuLvOO2WwuzswyRxkUT87OzliAUxicKSw2mUxGqqqqJJh3RLe82traT8kfEhaLUiUNwIAuwQXwN3CeZY4ysrUImjZkbhW0V9GfdjybARSmJ3ZfX58cuN9x/jID9wrPP/M4LmES3vM/bQLKvSJO8BeWZwg1dMYKUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait1\" title=\"\" src=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png\" srcset=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/69538/4way-finwait1.png 160w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/72799/4way-finwait1.png 320w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png 640w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/d9199/4way-finwait1.png 960w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/21b4d/4way-finwait1.png 1280w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>먼저 연결을 종료하고자 하는 요청자가 FIN 패킷을 상대방에게 보내면서 <code class=\"language-text\">FIN_WAIT1</code> 상태로 들어서게 된다.</p>\n<p>이때 FIN 패킷에도 시퀀스 번호가 포함되어있긴한데, 이번에는 랜덤한 값으로 생성해서 보내는 것이 아니다. 3 Way Handshake는 시퀀스 번호가 없는 상황에서 새로 만들어야하는 상황이라 랜덤한 값으로 초기화했지만, 이번에는 시퀀스 번호를 새롭게 생성할 필요가 없으므로 그냥 자신이 이번에 보내야할 순서에 맞는 시퀀스 번호를 사용하면 되는 것이다.</p>\n<blockquote>\n<ul>\n<li>요청자 ---<strong>SEQ: 1</strong>---> 수신자</li>\n<li>요청자 &#x3C;---<strong>ACK: 2</strong>--- 수신자</li>\n<li>요청자 ---<strong>FIN: 2</strong>---> 수신자</li>\n</ul>\n</blockquote>\n<p>즉, FIN 플래그만 1로 변경해서 보낸다고 생각하는 게 편하다. 이 플래그의 의미를 쉽게 얘기해보자면 “나 더 이상 할 말 없음” 정도이다.</p>\n<p>이때 요청자가 먼저 적극적으로 연결 종료 요청을 보내는 것이기 때문에 요청자를 Active Closer, 이 상태를 능동 폐쇄(Active Close)라고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [F.], seq 701384376, ack 4101704148, win 6378</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>하지만 요청자가 수신자에게 보낸 연결 종료 요청 패킷을 캡처해보니 <code class=\"language-text\">F</code> 플래그가 아니라 <code class=\"language-text\">FIN+ACK</code>를 의미하는 <code class=\"language-text\">F.</code> 플래그가 설정되어있다. tcpdump를 사용하여 패킷을 캡처한 다른 블로그를 봐도 대부분 필자와 같은 상황을 겪고 있음을 알 수 있었다.</p>\n<p>분명 이론적으로는 <code class=\"language-text\">FIN</code> 패킷을 보내야하는데 왜 승인 번호를 함께 묶어서 <code class=\"language-text\">FIN+ACK</code>로 보내고 있는 것일까?</p>\n<h4 id=\"half-close-기법\" style=\"position:relative;\">Half-Close 기법<a href=\"#half-close-%EA%B8%B0%EB%B2%95\" aria-label=\"half close 기법 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>요청자가 <code class=\"language-text\">FIN+ACK</code> 패킷을 보내는 이유는 바로 Half-Close라는 기법을 사용하고 있기 때문이다. Half-Close 기법은 말 그대로 연결을 종료하려고 할 때 완전히 종료하는 것이 아니라 반만 종료하는 것이다.</p>\n<p>Half-Close 기법을 사용할 때는 요청자가 처음 보내는 <code class=\"language-text\">FIN</code> 패킷에 승인 번호를 함께 담아서 보내게 되는데, 이때 이 승인 번호의 의미는 “일단 연결은 종료할 건데 귀는 열어둔다. 이 승인 번호까지 처리했으니까 마저 보낼 거 있으면 보내”라는 의미가 된다.</p>\n<p>즉, 반만 닫겠다는 말의 의미는 연결을 종료할 때 전송 스트림과 수신 스트림 중 하나만 우선 닫겠다는 것을 의미하는 것이다.</p>\n<p>이후 수신자는 미처 못 보낸 데이터가 있다면 열심히 보낼 것이고, 이에 요청자는 아직 살아있는 수신 스트림을 사용하여 데이터를 처리한 후 <code class=\"language-text\">ACK</code> 패킷을 응답으로 보낼 수 있다. 이후 수신자가 모든 데이터를 처리하고나면 다시 요청자에게 FIN 패킷을 보냄으로써 모든 데이터가 처리되었다는 신호를 보내준다.</p>\n<p>그럼 요청자는 그때 나머지 반을 닫으면서 조금 더 안전하게 연결을 종료할 수 있는 것이다.</p>\n<p>소켓 프로그래밍을 할 때 연결 종료 함수로 <code class=\"language-text\">close()</code>와 <code class=\"language-text\">shutdown()</code>을 사용할 수 있는데, 이때 <code class=\"language-text\">shutdown()</code> 함수를 사용하면 Half-Close를 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> SHUT_WR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>만약 요청자가  <code class=\"language-text\">close()</code> 함수를 사용하면 호출 즉시 OS에게 소켓의 리소스를 반환하며 모든 스트림이 파기되므로 FIN 패킷을 받은 수신자가 미처 못 보낸 데이터를 뒤늦게 전송하더라도 더 이상 처리할 수 없는 상황이 된다.</p>\n<p>위의 예제에서는 <code class=\"language-text\">SHUT_WR</code> 값을 두 번째 인자로 사용함으로써 전송 스트림만 우선 닫겠다고 선언한 것이다.</p>\n<p>이와 관련된 더 자세한 정보는 구글에 “Half-Close”나 “우아한 종료” 등의 키워드로 검색하면 많은 자료가 나오니 한번 살펴보도록 하자.</p>\n<h3 id=\"close_wait\" style=\"position:relative;\">CLOSE_WAIT<a href=\"#close_wait\" aria-label=\"close_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAESElEQVR42pVVXUhbZxg+rjXGJVFipkkWWpijayvTG5dMZEMsvRri5oWwm3W7qTdOSikFd+VF76WCDIqiiMSfiEJmlkWcJrpouxS0FRf/8/9jEo1RE02qJ2fPd3q0x5Bt7oMv58uX57zf9zzP+76hvF4vvbe3x06ynp6epi0WC72zs0NHo1F2PxQK0T6fj13v7+/Tm5ub9NTUFD07O0v7/X46FoudxONxJhKJuCm9Xn/H4XB8vrq6qp6bm1MPDQ2pe3p61AsLC2qyt76+XmW1Wr80GAy1BLe8vKzBger+/n4WR94huJWVlWqbzaamMMTko62t7SrDMLn8SfaotyMXU0QWTU1NuZm4mpqaMxz7FNrtdlkwGIzhFBrrFE5M4WbM7u6ur76+XlJZWUkC5m1tbckJDhgWB3wS9AnO2djYSC52hQTMg1aFgUBgA5SCAHg3Nja8LpcrBOBiXV3d+xxQAB1lwDkxwsBsYwaxjkLvRRxKcDnnlEdHR5W4vgr63BgbG7udSCRUOp1OwaNMXqB6e3uFwAmhYUFra6uMrCGNkE85z+12S8Ph8A6eybW1tSNQScC5N3DVXV5eLuVOFnEv5WQewtt7GxDaFCI1HNvb22Gsg4Q6AkZAZVkikdwoLS0tgUaFlw0o5r68d+ZiRUUFextQZkUeHx+/1/3s2bdk7f9F+wEDLSefPr2ue/LkIyYWK1rSaqXZAvJPuUAPgQV4SH7QaL6OzVhO/b9PMg6jIe0yGenIjJl58/JP36tHj0QXTPm3gI+7uyW9FKVw3737WdQyvekxGf1OoyHg+u1Xf2BqMhR/brV5Hj7MvxDQZDIVwTHZ4ODgtfb29tJ90NJhj/z2h17/06xO9x1fBqKhUqnMbgpxGbl4BGMY5FUauZhOHB8z8XD4cEss/sKo0RTcRIJzL1HzHk++9cWLx+aZmR+pi+Ody3B4HZNkrQcHuOFwcC8Sef0zlzbydzJQwAhR200jIyPfZwsopv5jVPJqGc1EfnBwUNzZ2Slubm6WHR4elkCGYg565VIBy8rKiMtX+/r6rqNNJREEmeNLo67pZDLJnJyc+IARZ7qcbbCAjo6OAqlUeq2hoeFTVJQd0rhR604UgBO6+6H/fFVVVX5mLZcApMQNFGSimygnJiZKyG/Q6r5Wq/2GrJEJbAFwHSi7y2iaRdDlCCczMCiN1pUmtNCBEyKR6A7pNHK5XMQFzMkMeLZ33g/xogRUnkOT1wi4iLR5BRpLcNoiEAhuoo5VLS0txf+rlru6uuSEstFo/Bgt6hahjKeCq+UHw8PD99kcnJ9XeTweFVrcJzDpNi7zodlsVvBdZimD4vHp6SkDcBqNM43BpFKpcHV1tQT9juhWUFtb+xX5Q8JgkKqkAGjQJTgf/gbOXWYpwy0baNrh3BJoL6EXruK7GUDhWcceGBiQA/cS+3/xcGv4PsnhWMMkXOR/mgSUd0mc4G+aEgkbh9qDcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closewait\" title=\"\" src=\"/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png\" srcset=\"/static/f08ce32e213678f2016221fe117de99c/69538/4way-closewait.png 160w,\n/static/f08ce32e213678f2016221fe117de99c/72799/4way-closewait.png 320w,\n/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png 640w,\n/static/f08ce32e213678f2016221fe117de99c/d9199/4way-closewait.png 960w,\n/static/f08ce32e213678f2016221fe117de99c/21b4d/4way-closewait.png 1280w,\n/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>요청자으로부터 <code class=\"language-text\">FIN</code> 패킷을 받은 수신자는 <code class=\"language-text\">요청자가 보낸 시퀀스 번호 + 1</code>로 승인 번호를 만들어서 다시 요청자에게 응답해주면서 <code class=\"language-text\">CLOSE_WAIT</code> 상태로 들어간다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.receiver <span class=\"token operator\">></span> localhost.initiator: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">701384377</span>, win <span class=\"token number\">6378</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>아까 요청자가 FIN 패킷의 시퀀스 번호로 <code class=\"language-text\">701384376</code>을 보냈으니 이번에 수신자가 응답해줄 승인 번호는 <code class=\"language-text\">701384377</code>이 되는 것이다.</p>\n<p>이후 수신자는 자신이 전송할 데이터가 남아있다면 이어서 계속 전송한 후, 모든 전송이 끝났다면 명시적으로 <code class=\"language-text\">close()</code>나 <code class=\"language-text\">shutdown()</code>과 같은 함수를 호출하여 다음 단계로 넘어갈 것이다.</p>\n<p>즉, 요청자는 언제 수신자의 데이터 처리가 끝날지 모르는 상태이기 때문에 수신자가 작업을 마치고 다시 연결 종료 승인을 의미하는 <code class=\"language-text\">FIN</code> 패킷을 보내줄 때까지 대기해야한다는 말이 된다.</p>\n<p>만약 이 단계에서 수신자의 데이터 처리가 끝나도 연결 종료 함수가 명시적으로 호출되지 않으면 다음 상태로 넘어갈 수 없기 때문에 데드락이 발생할 가능성이 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVR42q2T2wrDIBBE+///GHKD3Bujxkg0yXTXktKXQohdmAdBjruz48N7DykliqJAmqboug5cx3FckhACShrMywbrdjyc37AsFsPwxDRJeDrTvctyzpE8/HaQGEgHpRTqukbTNNBa427t+xewbdswNoPPkW8DtZ5p5CEAGfwHoA7ALMtQVVU8UBGQOyvLkhYzxXvIHfJC2L88z9H3ffxSGMhKkgTGmBigCx1yoM8u7/j3AVprQ6AZeEaHH+Af9A7tb63rinEUQew9s15AXl7Gmc11bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"deadlock\" title=\"\" src=\"/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png\" srcset=\"/static/0bd0fc4fa229c60f0980e590aafde785/69538/deadlock.png 160w,\n/static/0bd0fc4fa229c60f0980e590aafde785/72799/deadlock.png 320w,\n/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png 640w,\n/static/0bd0fc4fa229c60f0980e590aafde785/d9199/deadlock.png 960w,\n/static/0bd0fc4fa229c60f0980e590aafde785/21b4d/deadlock.png 1280w,\n/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png 1356w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>구글의 자동 완성 검색어가 데드락에 잡아먹힌 개발자들의 심정을 대변해주고 있다</small>\n</center>\n<p>이때 수신자는 상대방으로부터 연결 종료 요청을 받은 후에야 수동적으로 연결을 종료할 준비를 하기 때문에 수신자를 Passive Closer, 이 상태를 수동 폐쇄(Passive Close)라고 한다.</p>\n<h3 id=\"fin_wait_2\" style=\"position:relative;\">FIN_WAIT_2<a href=\"#fin_wait_2\" aria-label=\"fin_wait_2 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEPElEQVR42pVVTUxjVRR+OEPp2D5IqaWtzUwizowOETZYJERCmISNQ1AWJG7U1bBhiCsTXHXpGsIsCARCCARKICEwIFHoj4XROgGnwfL/0/8foJSfdlrh9fmdNw8sWBVvcvtO7/vuufc73znnMR6Phzs4OBAm2bOzs5zZbOb29va4SCQirIdCIc7r9Qr24eEht7Gxwc3MzHBWq5Xz+XxcNBo9PTk54Xd3d13M2NjYw62trY9WVlb0c3Nz+sHBQX13d7d+YWFBT2tra2vlNputcmJioppwS0tLZThQ39fXJ+BoD+GWl5cr7Ha7nsGQ04/BYLjJ83x2+qQ15vXIxpSR0djYmH0VV1VVdY4TnlKn06kMBAJRnMLBTuLEJG7G7+/ve+vq6tjS0lJymLO5uakmHDACDvgE6BNuu6GhgS52gxzmIFZ5fr9/HZQCAHjW19c9Ozs7IQAXa2tr3xSBEsRRCdw2RhiYIGYAdgTxXsShhMu6oDwyMqLF9XWIz73R0dEHsVhMZzQaNWmUaQPT09MjBU6KGOa2tLQoyUZopOmUc1wulyIcDu/hmVhdXY2DSgzK/QFVXcXFxQrxZJm4KevqIWlrrx0iNnlIja1gMBiGHSDqcLgLKkssy94rLCwsQIzyrutQLv5541zFkpIS4TagLAR5fHz8y46Ojs/JNplMb4GmEu/utLW1vQM7HymlyOQw/ZRL9LBZggdbWVn5KVicQRgeTFIQjkOo+Hg87q2pqZFdEuXfHHZ1dbF4aJBCH6IyNuDIB4d+hMYH5yHE2l5eXn7rkkO3sTOf9zqVlqdPb/cbDIW88xel+3tjPr1DNX2LW36RHgaKoVarzSwK73AoYs9t8aBpht+ZmkxtPhtPvbL/zEes5uP7KtXHd8vKcinBxU3M/Pz8LcxvLBbLE+byEB2+eJEX/cmyFpz90e+aeuZ2T0+59q3mwKHN8vK7R4+EtFH/FQYGySyFEI3Dw8NfZXIoZ/57XNQy6KuPjo5U7e3t8qamJuXx8XEBwqAScTeu5bCoqIhUvtnb23sHbSoBJzzKMIW65hKJBH96euoFRn5V5UxDALS2tuYqFIrb9fX1HyBNnEgdF5TehsrbKAgfesH831RGLRcApMUNNDTRTbTT09MF9A6xetzf3/8Z2UhkoQDEDpRZZTTNfMQljpOFhEXrShEtdOCYTCZ7SJ1GrVbLRIdZVx2er130Q2xkQeU5YvISDhfRwn4DDQdq2SyRSN5DHeuam5tV/6uWOzs71UR5cnLyXbSo94kynhqxlr8eGhp6LOagzu1269Di7kOkB7jM26hvTbrKAmVQfHV2dsYDnELjTGHwyWQyXFFRwaLfUdxyq6urP6EPEgaPVpeijxXoEs6Lz8CFygJlqGUHTSeUc4C2A/W5gv8mAKXnHXtgYEAN3K9Y/z0Nt4r/P4g4QTBW9PxPk0A518RJ/gTqwAStpoJTXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait2\" title=\"\" src=\"/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png\" srcset=\"/static/608e421d25ac8fa76021750f0110bed6/69538/4way-finwait2.png 160w,\n/static/608e421d25ac8fa76021750f0110bed6/72799/4way-finwait2.png 320w,\n/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png 640w,\n/static/608e421d25ac8fa76021750f0110bed6/d9199/4way-finwait2.png 960w,\n/static/608e421d25ac8fa76021750f0110bed6/21b4d/4way-finwait2.png 1280w,\n/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>요청자는 수신자로부터 승인 번호를 받고 자신이 보냈던 시퀀스 번호와 승인 번호의 차가 1이 맞는지 확인한다. 하지만 아직 수신자의 데이터 전송이 전부 끝나지 않았을 수도 있기에 <code class=\"language-text\">FIN_WAIT2</code> 상태로 들어가서 수신자가 연결 종료를 허락하는 <code class=\"language-text\">FIN</code> 패킷을 보내줄 때까지 기다린다.</p>\n<p>방금 <code class=\"language-text\">CLOSE_WAIT</code> 섹션에서 설명했듯이 여기서부터는 수신자가 다시 <code class=\"language-text\">FIN</code> 패킷을 보내줄 때까지 요청자는 계속 대기하는 시간이다.</p>\n<p>하지만 <code class=\"language-text\">CLOSE_WAIT</code>와 다르게 무한정 대기만 하는 것은 아니고 커널 파라미터로 타임아웃이 정해져있는 경우, 일정 시간이 경과하면 자동으로 다음 단계로 넘어갈 수 있다.</p>\n<h3 id=\"last_ack\" style=\"position:relative;\">LAST_ACK<a href=\"#last_ack\" aria-label=\"last_ack permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEQElEQVR42pVV30+aVxj+ulbEARpkCoy0yVy6rWZ6Q7HGzBibeLMa543JbrZd1YtmZunFEnvlf2Bal10YrcaY+jOaGC3RrQIaoClmao1DBRT5JfJDRRGQjY/T53x+WrS2cyc5nPc73/O95zzv874vjMfjYff29rhJbZ1OxxoMBjYcDrO7u7vcfiAQYL1eL2fv7++zDoeDnZ6eZmdnZ1mfz8dGIpF/Dw8PSSgUcjFjY2N3NzY27qyurmpMJpNmYGBA09XVpZmfn9fQPZvNVm40GisnJiaqKW55ebkMB2p6e3s5HP2G4lZWViosFouGwRDTn5aWlmuEkKzMSfeY45GFKaJGY2Nj1nlcVVXVCY5bhVarVeb3+yM4hYWdxIlJ3Izs7Ox46+rqJGq1mjrMXl9fl1McMBwO+CPQpzhnQ0MDvdhV6jAbscrb2tqyg5IfAI/dbvdsbm4GAFyora39mAcKEEcZcE6MIDDbmH7Yu4j3Ag6luCunlEdGRpS4vgrxuTk6OnorFouphoaGFBmU6QdMd3e3EDghYpjb3NwsozZCI8yknO1yuaTBYDCM9WhtbS0OKjEo9w9UdZWUlEj5k0X8R1fOH5Kxd+wQsclDamxsb28HYfspdTgMgcqyRCK5WVRUVIgY5V3WoZh/+OhExdLSUu42oMwFeXx8/Mf29vbvqa3X6z8BTRne3Whra/sMdj5SSnqRw8xTztDDxwIsksrKyu/AIgVhCJikIRyLUJF4PO6tqakRnRHlQw47OzslWBRIoduoDAcc+eBwC6HxwXkAsbaUl5fnnHE4OTmZT6n09/dfb21tLaIpQvfoO1TTI9zyh8ww0BgqlcqLRaEqIxfjEIYgr9LIxXQikSCgExWLxd+UlZXl0gTnP2LMZnMO5q8zMzM/M2fHW5URGxsmzVo3DnBBYT+K/fUFacPonU7hmFbbODg8/NNFDsXMf4/TWl7q65AT23yBHqX2W329jDgWC21DTwt43NVLOSwuLqYqXyOPH99Izb06OnhpIr4Xf6T9uhdsYu4VIYt/efUPHojPq/zOIDyg6cmT3N+l0uvk3r2vo8ZZa0A/7XJPPXe6Jp87wwad79BsMpsfPsw5X8uFSAclGqWCTnQT5cjUVCF9Zxwevq9/9qyea3OEcAWgVn9AZTTN/IODgzhE4RLWbrOlI9EoiYVCMZNIdBc3FTByORdDpNa7pfd277gfQk0JUuQlet1rOFxA2iwijZb2wmHDbYHgS9Sx6lFTU8H/quWOjg45pazVaj9Hi/qKUsaq4Gv5l8HBwft8DqrcbrcKLe6Lnp6eW7jMp6hvRabKHOVoNJpIpVIE4DQaZxqDJJPJYEVFhQT9jsYtt7q6+lv6h4RBkKq0AFiEgOK8+Bs4VZmjjCqxgKYV9bkE2kuoz1U86wEUnnTsvr4+OXBz2P87A7eG5z95HCeYhPf8vklB2ZfECd4A2pIHyYStE2kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way lastack\" title=\"\" src=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png\" srcset=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/69538/4way-lastack.png 160w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/72799/4way-lastack.png 320w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png 640w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/d9199/4way-lastack.png 960w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/21b4d/4way-lastack.png 1280w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>수신자는 자신이 처리할 데이터가 더 이상 없다면 연결을 종료하는 함수를 명시적으로 호출하고, 아까 요청자가 보냈던 연결 종료 요청에 합의한다는 의미로 요청자에게 다시 <code class=\"language-text\">FIN</code> 패킷을 보낸다.</p>\n<p>이때 수신자가 보내는 <code class=\"language-text\">FIN</code> 패킷에 담기는 시퀀스 넘버는 자신이 이번에 전송해야 하는 데이터의 시퀀스 번호를 그대로 사용하며, 승인 번호는 마지막으로 자신이 응답했던 승인 번호를 그대로 사용한다.</p>\n<p>이후 수신자는 <code class=\"language-text\">LAST_ACK</code> 상태로 들어가며 요청자가 다시 승인 번호를 보내줄 때까지 대기한다.</p>\n<h3 id=\"time_wait\" style=\"position:relative;\">TIME_WAIT<a href=\"#time_wait\" aria-label=\"time_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERklEQVR42pVV309aVxy/tlXo5GrwTpGRNplL19VMXxzOmBljE18W4+YDyZJl21N9sc2elrgn/wMTjS8mRmMN1co0odDMbSI/hnRhja6GgQqCCIjgbwWE4eXsc27RoWObO8nhfjn3c77f8/18vt9zmUAgwO/v7wuT2nNzc7zJZOJ3dnb4vb09YT0SifDBYFCwDw8PeY/HwxsMBt5isfChUIg/ODhIx2Ixsr297We0Wu19r9f74fLysnJ+fl45MTGhHB4eVi4sLCjp2urqaoPVam3S6/UtFOdwOOoRUDk2Nibg6B6Kc7lcjXa7XclgSOhPT0/PDUJIYe6ka8zrUYhZTI3Ozs7Cy7jm5uYznPAUO51OLhwOHyAKDzuFiCmcjOzu7gbb29vZuro66lC0trYmozhgBBzwSaRPcT6VSkUPdp06FIGr0s3NTTdSCgMQcLvdgfX19QiAi21tbW9kgUXgkQPOhxEFZgszDHsPfC8iKMUVnKc8NTUlx/EV4OfO9PT0vXg8rpicnKzMSZluYEZGRsTAicFhSXd3N0dtUCPOTVnk9/ul0Wh0B8/kyspKAqnEodwfUNVfU1MjzUYuzm4quBwkZ+21Q3BTitLwbm1tRWGHaepwuI1UHCzL3qmqqqoAR6VXdSjJ/rl2pmJtba1wGqQskKzT6b4cHBz8jNpGo/FNpMnh3e3+/v63YZehpKT5HOZGuZAeNhfhwTY1NX2CLE4hDEEmGQjHgyqSSCSCra2txRdE+TeHQ0NDLB6VKKEP0BkeOArB4SaoCcF5BFzbGxoabl5wODMzU0ZTGR8fv9Xb21tFS4Su0Xfopm9xyi9yaaAcyuXy/KJQlVGLCQhDUFcZ1GLm5OSEIJ1jiUTyUX19fQkt8Owmxmaz3cT8xmw2P2Qujr9UBjermLRqNxDAD4XDaPZXecqGAUYMITo1Gs1X+RxKmP8e572M9GVHR0flAwMDkq6uLu74+LgCNJRncdev5LC6upqqfGN0dPQ2rqkknBBwnEFf88lkkqTT6SAwkssq5xsCoK+vr0Qqld7q6Oh4H7w6QY0fSvugsg+8h8C/7W8qex4/riAvX8qJw1EpTPP38vAPUxX03bRG80CtVn9KbVSC0ADZGyi/ygTlkbL/kgjPGYj3uS7j1j/LHL2wkUOLKd7CcffpTSOTyYqzDgsuOzxbO78PicvKxqzmFxHDj6/Wnz9b9Om1v+1bjEuxn00mF8fdXVSpFKpHj8r/Vy9rZ2dlsWhUbjUY3vlOrX4PXMlRGsL1ZdLpvrY+ffqA2rM2m2JjY0OBK+5diHQPpfUW+rsyV2URvhNlUO7k9PSUAJzBxZnBIKlUKtre2Mji+3Dtc4YpibW0fBzDBymVThOUKm0AHulSXBCfgXOVxYjCQi071HJCuSUU+hL6cxn/jQCKz27srSdPZNFI5Fes/56DW8H/n7I4QTA26/mfJgWJuKvhiv4EPZUHkwvVy94AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way timewait\" title=\"\" src=\"/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png\" srcset=\"/static/9d3cabeb3e6e66223cb4475d42aba133/69538/4way-timewait.png 160w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/72799/4way-timewait.png 320w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png 640w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/d9199/4way-timewait.png 960w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/21b4d/4way-timewait.png 1280w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>수신자가 보낸 <code class=\"language-text\">FIN</code> 패킷을 받은 요청자는 다시 <code class=\"language-text\">수신자가 보낸 시퀀스 번호 + 1</code>로 승인 번호를 생성하여 수신자에게 <code class=\"language-text\">ACK</code> 패킷으로 응답한다. 이후 요청자는 <code class=\"language-text\">TIME_WAIT</code> 상태로 들어가며, 실질적인 연결 종료 과정에 들어가게 된다. 즉 <code class=\"language-text\">TIME_WAIT</code> 상태의 역할은 의도하지 않은 에러로 인해 연결이 데드락에 빠지는 것을 방지하는 것이다.</p>\n<p><code class=\"language-text\">TIME_WAIT</code> 상태에서 대기하는 시간은 2MSL(Maximum Segement Lifetime)으로 정의되어 있으며, 정확한 MSL의 시간 값은 커널 파라미터로 정의되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sysctl</span> net.inet.tcp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> msl\nnet.inet.tcp.msl: <span class=\"token number\">15000</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>필자의 컴퓨터인 OSX의 MSL은 15초로 설정되어있다. 즉, 필자의 컴퓨터는 <code class=\"language-text\">TIME_WAIT</code> 상태에서 30초 정도 대기한다는 것이다. 참고로 이 값은 변경할 수 없기 때문에 <code class=\"language-text\">TIME_WAIT</code>에서 소비되는 시간은 변경할 수 없다.</p>\n<p>보통 TCP 타임아웃 파라미터로 많이 언급되는 <code class=\"language-text\">net.ipv4.tcp_fin_timeout</code>은 <code class=\"language-text\">FIN_WAIT2</code>의 타임아웃을 조절할 수 있는 값이라 <code class=\"language-text\">TIME_WAIT</code> 상태에는 해당 사항이 없다.</p>\n<p>하지만 <code class=\"language-text\">CLOSE_WAIT</code>와 마찬가지로 여기서도 데드락이 발생할 수 있다. 그런 이유로 많은 네트워크 엔지니어들이 여기서 소비되는 시간을 줄이거나 운 나쁘게 발생한 데드락을 없애기 위해 <code class=\"language-text\">tcp_tw_reuse</code> 커널 파라미터를 변경하는 등 여러가지 방법을 사용하고 있다. <small>(데드락 피하자고 만든 상태인데 데드락이 발생하는 현실)</small></p>\n<p>하지만 역시 그냥 가만 냅두는 게 제일 좋다고들 한다.</p>\n<h3 id=\"closed수신자\" style=\"position:relative;\">CLOSED(수신자)<a href=\"#closed%EC%88%98%EC%8B%A0%EC%9E%90\" aria-label=\"closed수신자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERElEQVR42pVVS09bRxg1TTBObYOMC7ZrJVKp0jSosKGmyCpCjcSmRbQskLpJuwqLUJRVJbriH5CA2BAQCCHESyAhuwTagjExTuUUSCxq3viNsTFgHn7VXN+e73KhhrptOtIw47lnvplzzjcfArfbzRwcHHCd5tPT08zMzAwTDAaZ/f19bt3v9zMej4ebHx4eMhsbG8zU1BQzOzvLeL1eJhQKJU5OTtjd3V2nYGxs7N7W1tYnKysrmrm5Oc3AwICmq6tLs7CwoKG1tbW1MpPJVK7X6z8j3NLSUikO1PT29nI42kO45eVlrcVi0QjQJPSnqanpOsuymamd1gRnLRNdTJO6urrMq7iKiopzHDeKbDab3OfzhXAKg3kcJ8ZxM3Zvb89TXV0tLSkpoYBZm5ubCsIBw+GAj4E+4ey1tbV0sWsUMAta5Wxvb6+Dkg8A9/r6utvhcPgBXKyqqnqbBwqhoxw4O1oAmB10H+b70HsRhxIu44LyyMiICtdXQ5/bo6Ojd8PhsHpoaEiZQpk2CLq7u0XAiaBhdmNjo5zmkEaUSjnL6XTKAoFAEGNsdXU1AiphOPcHXHUWFRXJ+JPF/KaMq4ekrJ0FhDY5SI2tnZ2dAOY+oo6Au6CyJJVKbxcUFORDo5w3DSjhf7x17mJxcTF3G1DmRNbpdN+0t7d/TXODwfAOaMrx7VZra+t7mOcipWTpAqaecokeNgsxSMvLy78Ei1MYw4JJEsYxkIqNRCKeyspK8SVT/i1gZ2enFIMSKfQxXsYGAnkRcBvSeBHcD60tZWVlNy4FnJiYyCUq/f39N5ubmwsoRWiNvuE1/YBb3k+VgTRUqVTpTSGXkYsRGMMir5LIxWQ0GmVB51gikXxaWlqaTQnObxKYzeYb6N8bjcbvBJfbXy5DmzV0yloXDnDCYR8e++s0aSMARgQj6oaHh79NF1Ai+O928ZZBX3F0dJTX1tYmqa+vlx8fH+dDhjwed+2NAhYWFpLL13t6em6hTMUQhIXGSbxrJhaLsYlEwgOM5KrL6RoHaGlpyZbJZDdramo+gq42SOOE03a4bIfuXuhv/pvLeMv5AKlwAyV1VBPV5ORkPn2DVg/6+vq+ojkygXsAfAVK7zKKZi50ieBkLmFRupJEC6aExWLxPao0CoVCzAfMuBrwfO2iHmKjFFReQJPXCLiItHkFGlY4PSMUCu/gHasbGhry/tdb7ujoUBDl8fHx91GiPiTKGJX8W340ODj4gOZBnU7Nms3q2adPP/jp8eO77Pz8u369XpnqMkcZFKOnp6esy+VKonAm0dh4PB7QarVS1DvSLfsLrfbz6K/mRHz+JeuafJbc/FHPsNZXLLPwm8fw8OGFyxxluGUBTRucs4K2Fe9zBb8N+H8hOq/Yvzx5ojh6bnwZMhl/dzzTWx3jemto7vlq+IXpZ/tZkeUMk/KR/6kTKCsVx1KHEbwZqTjhn+PqDKvbZq2WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed server\" title=\"\" src=\"/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png\" srcset=\"/static/7d21721d413da9a3d6803c77909963be/69538/4way-closed-server.png 160w,\n/static/7d21721d413da9a3d6803c77909963be/72799/4way-closed-server.png 320w,\n/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png 640w,\n/static/7d21721d413da9a3d6803c77909963be/d9199/4way-closed-server.png 960w,\n/static/7d21721d413da9a3d6803c77909963be/21b4d/4way-closed-server.png 1280w,\n/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>요청자가 보낸 <code class=\"language-text\">ACK</code> 패킷을 받은 수신자는 <code class=\"language-text\">CLOSED</code> 상태로 들어가며 연결을 완전히 종료한다.</p>\n<h3 id=\"closed요청자\" style=\"position:relative;\">CLOSED(요청자)<a href=\"#closed%EC%9A%94%EC%B2%AD%EC%9E%90\" aria-label=\"closed요청자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEUElEQVR42pVVTUxiVxTGzghMAQ1SBUpmktpMp2OqG4s1TY1xEjeNsXVh0k3bpMm4cUxXk9iVKzeTxkTjxsRojfE/mlpJ1TaKEmAaamUkFlT+5E/kT1AEYejj9bvPh0VL2+lNLu9w33fPvef7zjmP4/F4qGg0ykxir6+vUxsbG1Q4HKZOTk6Y9UAgQHm9XsY+PT2lbDYbtba2Rmk0Gsrn81GxWCxzfn5Oh0IhF2dxcfGRw+H4YG9vT6nT6ZTT09PKkZER5fb2tpKsHRwc1Gu12gaVStVEcLu7u3U4UDk+Ps7gyB6Cs1gsHxoMBiUHQ0h+enp6btM0XZw/yRrnchRjCojR0dFRfBPX2NiYwzFPvtlslvj9/hhOoWCncWIaN6MjkYi3tbVVVFtbSxzy7Ha7lOCAYXDApxA+wTnb29vJxW4RhzxwVXp0dGRFSH4APFar1XN4eBgA0NjS0vI6C+SCRwlwTowgMMeYftgn4NuIQwmu6Crk+fl5Oa6vAD/3FxYWHiYSCcXs7KwsL2SygTM6OsoHjg8OS7q7uyXEBjX8/JB5LpdLHAwGw3im9vf3kwglAeVeQlVXdXW1mD1ZwG4qunlI3tqlQ3BTitRwHB8fB2H7SehwGEIouyKR6H5lZWUFOCp9VYdC9s9rORVramqY2yBkhuSlpaUvhoaGPiO2Wq1+A2FK8O7ewMDAW7DLkFLiQg7zT7kWHjZz8RA1NDR8gij+gDA0IslCOApU0clk0tvc3Cy4Jsq/ORweHhbhIUMKvY/KsMGRDw6PQI0PzgPg2lBfX3/nmsOVlZUyEsrU1NTdvr6+SpIiZI28QzV9g1t+nk8D4VAulxcWhaiMXExCGBp5lUUuZi8uLmiEExcKhR/V1dWVkARnN3H0ev0dzKebm5tPONfHXyqDmwNMkrVuHOCCwn4U+06BtOEAw4cQHXNzc18Wcijk/Pe4qmWELz07OysfHBwUdnZ2SuLxeAVoKGdxt17JYVVVFVH59tjY2D20qRSc0OA4i7qmUqkUnclkvMAIb6pcaDCA/v7+ErFYfLetre098GoGNS4o7YTKTvDuA//6v6mMWq4ASI4byMhEN5Gvrq5WkHfg6vHExMSnxEYmMAXAdqDCKqNploGXJE5mEhatK0vCgigJgUDwiHQaqVQqYB0W3XSYW7vqh9goCoZCz/2BwI7N4TBa7fYX4WjUFI5ENrhc7gPUsaKrq6v8f9Xy895eKb28LN/6bujtH77tffcctvrZMxlby1/PzMw8ZnNQ4Xa7FWhx70Ckh7jMm6hvWb7KPFqvL8tsGS5eGn+j3T+tZG2qpWx2x0hTxq3g90+/EuH7QHgraWpq+ph8kDBopCopAArh0ul02ovPwJXKfNpiEcW1GkNUqzEfLqtMzh9VpphOs5f4Rad2XjZPpmNPTk5KoeqvUPV3KGwC3ybU8T7+/wyH/FzHErGei2gyQTBLcm4SEC8f9w+T4Lh/AhK1DBDx/1/XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed client\" title=\"\" src=\"/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png\" srcset=\"/static/dc94254134e7f891452d785d1de2120f/69538/4way-closed-client.png 160w,\n/static/dc94254134e7f891452d785d1de2120f/72799/4way-closed-client.png 320w,\n/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png 640w,\n/static/dc94254134e7f891452d785d1de2120f/d9199/4way-closed-client.png 960w,\n/static/dc94254134e7f891452d785d1de2120f/21b4d/4way-closed-client.png 1280w,\n/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p><code class=\"language-text\">TIME_WAIT</code> 상태에서 2MSL만큼 시간이 지나면 요청자도 <code class=\"language-text\">CLOSED</code> 상태로 변경된다. 위에서 설명했듯이 이 시간은 커널 파라미터에 고정되어 있고, 필자가 사용하고 있는 OSX의 경우 30초 정도이다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이렇게 두 번째 TCP 주제인 핸드쉐이크에 대한 포스팅을 마쳤다. TCP에 대해서 학교에서 배우긴 했지만 이렇게 각 상태에 대해서 자세히 공부하진 않았기 때문에 나름 새로운 경험이었다.</p>\n<p>이 포스팅을 작성하면서 TCP가 단순히 연결을 생성하고 종료하는데만 해도 신뢰성을 확보하기 위해 얼마나 많은 작업을 하는지 알 수 있었다. <small>(더불어 구글이 왜 HTTP/3에 UDP를 사용했는지 알 것 같았다…)</small></p>\n<p>처음에는 필자 블로그 로컬 서버와 브라우저의 핸드쉐이크를 캡처해보려고 했는데, 이 친구들은 단순한 몇 개의 메세지를 주고 받는 수준이 아니라 대량의 데이터를 주고 받는 사이다보니 필자가 원하는 부분을 추적하기가 쉽지 않았다.</p>\n<p>그래서 오랜만에 간단한 소켓 프로그래밍을 하게 되었는데, 음… 하도 오랜만에 C를 사용하다보니 손에 안 익어서 꽤나 고생하긴 했지만 나름 재미있었다. C는 역시 가끔 해야 재밌는 것 같다.</p>\n<p>혹시 필자가 예제로 사용한 어플리케이션을 직접 실행해보고 싶으신 분은 필자의 <a href=\"https://github.com/evan-moon/simple-tcp-example\" target=\"_blank\" rel=\"nofollow\">깃허브 레파지토리</a>에서 클론 받을 수 있다. 간단한 메세지만 서로 주고 받는 어플리케이션이니 <code class=\"language-text\">tcpdump</code>를 사용해서 패킷을 들여다보기도 한결 편할 것이다.</p>\n<p>이상으로 TCP가 연결을 생성하고 종료하는 방법, 핸드쉐이크 포스팅을 마친다.</p>","fields":{"slug":"20191117-tcp-handshake","path":"/2019/11/17/tcp-handshake/","lang":"ko"},"frontmatter":{"title":"TCP가 연결을 생성하고 종료하는 방법, 핸드쉐이크","subTitle":"TCP는 어떻게 신뢰성 있는 연결을 보장할까?","date":"Nov 17, 2019","categories":["프로그래밍","네트워크"],"tags":["TCP","SYN","ACK","FIN","TCP Handshake","TCP 핸드쉐이크","3 Way Handshake","4 Way Handshake","TCP 플래그","CLOSE_WAIT"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/fc5c5/thumbnail.webp 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"4 Way Handshake","lang":"ko"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}