{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/vue/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"1a39e8a2-cd36-519b-a474-9181c4206e69","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%B1%85%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%93%B0%EA%B2%8C-%EB%90%98%EC%97%88%EB%82%98\">책은 어떻게 쓰게 되었나?</a></p>\n<ul>\n<li><a href=\"#%EC%86%90%EC%97%90-%EC%9E%A1%ED%9E%88%EB%8A%94-%EC%9E%91%ED%92%88%EC%9D%84-%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%B4%EA%B3%A0-%EC%8B%B6%EB%8B%A4\">손에 잡히는 작품을 만들어 보고 싶다.</a></li>\n<li><a href=\"#%EC%B1%85%EC%9D%84-%EC%93%B0%EB%A9%B4%EC%84%9C-%EB%82%B4-%EC%A7%80%EC%8B%9D%EB%8F%84-%EC%A0%95%EB%A6%AC%ED%95%98%EC%9E%90\">책을 쓰면서 내 지식도 정리하자.</a></li>\n<li><a href=\"#%EC%83%9D%EA%B0%81%EB%B3%B4%EB%8B%A4-%EC%BD%94%EB%94%A9%EC%9D%84-%EB%B0%B0%EC%9A%B0%EA%B8%B0-%EC%9C%84%ED%95%B4%EC%84%9C-%EC%B1%85%EC%9C%BC%EB%A1%9C-%EC%9E%85%EB%AC%B8%ED%95%98%EB%8A%94-%EC%82%AC%EB%9E%8C%EC%9D%B4-%EB%A7%8E%EC%95%98%EB%8B%A4\">생각보다 코딩을 배우기 위해서 책으로 입문하는 사람이 많았다.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B1%85%EC%9D%84-%EC%93%B0%EA%B8%B0-%EC%A0%84%EC%97%90\">책을 쓰기 전에</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%B2%98%EB%9F%BC-%EC%A7%91%ED%95%84%ED%95%98%EC%9E%90\">개발자처럼 집필하자!</a></p>\n<ul>\n<li><a href=\"#markdown%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%B1%85-%EC%A7%91%ED%95%84%ED%95%98%EA%B8%B0\">Markdown을 사용하여 책 집필하기</a></li>\n<li><a href=\"#git%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AC%B8%EC%84%9C%EC%9D%98-%EB%B2%84%EC%A0%84%EA%B4%80%EB%A6%AC\">Git을 이용한 문서의 버전관리</a></li>\n<li><a href=\"#%EB%AC%B8%EC%84%9C-%EC%BB%A8%EB%B2%84%ED%8C%85-%ED%95%98%EA%B8%B0\">문서 컨버팅 하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EB%8F%99-%EC%A7%91%ED%95%84-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C%EC%9D%98-%EC%B6%A9%EB%8F%8C\">공동 집필 과정에서의 충돌</a></p>\n<ul>\n<li><a href=\"#%EC%84%A4%EA%B3%84%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B4%80%EC%A0%90%EC%9D%98-%EC%B0%A8%EC%9D%B4\">설계에 대한 관점의 차이</a></li>\n<li><a href=\"#%EC%9D%BC%ED%95%98%EB%8A%94-%EC%8A%A4%ED%83%80%EC%9D%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4\">일하는 스타일의 차이</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B1%85-%EB%A6%AC%EB%B7%B0%ED%95%98%EA%B8%B0\">책 리뷰하기</a></p>\n<ul>\n<li><a href=\"#%EC%8A%A4%ED%84%B0%EB%94%94%EC%9B%90%EB%93%A4%EC%9D%98-%EB%A6%AC%EB%B7%B0\">스터디원들의 리뷰</a></li>\n<li><a href=\"#%ED%98%84%EC%97%85-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%B6%84%EB%93%A4%EC%9D%98-%EB%A6%AC%EB%B7%B0\">현업 개발자분들의 리뷰</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></p>\n</li>\n</ul>","excerpt":"필자는 최근 커피 한잔 마시며 끝내는 VueJS라는 책을 집필했다. 필자는 책처럼 긴 글을 적는 게 사실 처음이라, 책을 쓰는 과정이나 책을 출판하는 과정에 대해서 무지한 상태로 집필을 시작했고 그래서 중간에 우여곡절도 꽤 많았다. 그래서 이번 포스팅에서는 필자와 같이 책을 집필하고 싶어하는 분들을 위해서 2018년 8월부터 2019년 7월까지 책을 집필했던 과정과 어려움에 대해서 이야기 해보려고 한다.","html":"<p>필자는 최근 <a href=\"https://m.yes24.com/Goods/Detail/76639545\" target=\"_blank\" rel=\"nofollow\">커피 한잔 마시며 끝내는 VueJS</a>라는 책을 집필했다. 필자는 책처럼 긴 글을 적는 게 사실 처음이라, 책을 쓰는 과정이나 책을 출판하는 과정에 대해서 무지한 상태로 집필을 시작했고 그래서 중간에 우여곡절도 꽤 많았다.</p>\n<p>그래서 이번 포스팅에서는 필자와 같이 책을 집필하고 싶어하는 분들을 위해서 2018년 8월부터 2019년 7월까지 책을 집필했던 과정과 어려움에 대해서 이야기 해보려고 한다.</p>\n<!-- more -->\n<h2 id=\"책은-어떻게-쓰게-되었나\" style=\"position:relative;\">책은 어떻게 쓰게 되었나?<a href=\"#%EC%B1%85%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%93%B0%EA%B2%8C-%EB%90%98%EC%97%88%EB%82%98\" aria-label=\"책은 어떻게 쓰게 되었나 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>먼저 책을 집필하게 된 계기는 친구인 김영훈 개발자로부터 함께 책을 공동집필해보자는 제의를 받았기 때문이었다. 사실 필자는 대학 교양 레포트 이후로 몇 개의 블로그 포스팅와 회사의 기술 문서 작성을 제외하면 글을 써본 적이 없었다. 지금 이 블로그의 포스트 아카이브를 봐도 한눈에 알 수 있는데, 본격적으로 블로그 뽕에 취하기 전인 2019년 6월 이전에는 지금처럼 일주일에 한두번씩 글을 쏟아내는 정도가 아닌 그냥 생각날 때 간간히 쓰는 수준이었다.</p>\n<p>게다가 저 친구의 제의를 처음 받았을 때 이걸 쓸지 말지 두 가지 이유 때문에 고민을 조금 했었는데, 그 중 첫 번째 이유는 “내가 책을 쓸 실력이 되나?”였다. 그리고 두 번째 이유가 조금 치명적인데…</p>\n<blockquote>\n<p>사실 필자는 대학 교재 이후로 기술 서적을 읽어본 적이 없는 사람이다.</p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 549px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a077827ec7796d1721f846e67ab4cd58/588f6/what.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAczKF2JDx//EABsQAAEEAwAAAAAAAAAAAAAAAAABAhIhAxEx/9oACAEBAAEFAk21cjiZUaE5/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQACIf/aAAgBAwEBPwHGRZe3/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Bqv/EAB0QAAIABwEAAAAAAAAAAAAAAAABAhARISIxMkH/2gAIAQEABj8CpCzF+mky6OZf/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBkdH/2gAIAQEAAT8hxBvawLvmslZAh7WKgWbLr9QiWp//2gAMAwEAAgADAAAAEMQv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAh/9oACAEDAQE/EFA7MIL/xAAYEQACAwAAAAAAAAAAAAAAAAAAAREhMf/aAAgBAgEBPxCWCof/xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMZFB/9oACAEBAAE/ECpFJpUnzbikoDVHHfb7hgBw175gESXbG7m+4361INawjRTlz//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"what\" title=\"\" src=\"/static/a077827ec7796d1721f846e67ab4cd58/588f6/what.jpg\" srcset=\"/static/a077827ec7796d1721f846e67ab4cd58/0913d/what.jpg 160w,\n/static/a077827ec7796d1721f846e67ab4cd58/cb69c/what.jpg 320w,\n/static/a077827ec7796d1721f846e67ab4cd58/588f6/what.jpg 549w\" sizes=\"(max-width: 549px) 100vw, 549px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>이렇게 또 책밍아웃을 합니다...</small>\n</center>\n<p>필자는 독서를 좋아하긴 하지만, 공부에 있어서는 “인터넷이 더 편한데?”라고 생각하는 쪽이라서 기술 서적보다는 소설이나 에세이, 조직 문화나 철학 같이 기술과는 관련 없는 책을 주로 읽는 편이다.</p>\n<p>게다가 필자의 포스팅을 몇번 보신 분들은 아실지도 모르겠지만 필자의 공부 스타일이 책을 하나 하나 읽어보면서 기초부터 하는 스타일은 아니다. 일단 뭘 만들지부터 정해놓고 그때그때 필요한 정보를 찾고 습득한 후에 바로 사용하고 넘어가는 스타일이다. <small>(물론 그래서 지식의 깊이는 넓고 얕은 편이다.)</small></p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6b892b18c7b5396515cda321b3f504ea/9568a/books.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAX/xAAYAQACAwAAAAAAAAAAAAAAAAACBAABA//aAAwDAQACEAMQAAABwVdrPKgvC1VENaAzZ//EABwQAAICAgMAAAAAAAAAAAAAAAECAAMEERITIv/aAAgBAQABBQJcZmhpOxQqynZlgjn3jueTseqxtv8A/8QAGREAAgMBAAAAAAAAAAAAAAAAAAECITEy/9oACAEDAQE/AVolRHpEcP/EABURAQEAAAAAAAAAAAAAAAAAABAB/9oACAECAQE/ASn/xAAdEAADAAAHAAAAAAAAAAAAAAAAAQIDEBEhQXKB/9oACAEBAAY/AuMtK3ZhCrwZCJ7DP//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhQWH/2gAIAQEAAT8hzGy0DAMvPYckA6RWN1ZSWcXiDj7MqqmK+aiL5s//2gAMAwEAAgADAAAAEF/PP//EABoRAAICAwAAAAAAAAAAAAAAAAABITERcZH/2gAIAQMBAT8QZQdZIkCdCnR//8QAGBEBAQADAAAAAAAAAAAAAAAAAQARMUH/2gAIAQIBAT8QSUzdTu//xAAcEAEAAwEAAwEAAAAAAAAAAAABABEhMUFRcZH/2gAIAQEAAT8QLA1wKfPfXJQtTrCDzfmxwehyGEoq2LtCxTzaybK24Ky/3FcAZnuXNXF+EfIF4DJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"books\" title=\"\" src=\"/static/6b892b18c7b5396515cda321b3f504ea/c08c5/books.jpg\" srcset=\"/static/6b892b18c7b5396515cda321b3f504ea/0913d/books.jpg 160w,\n/static/6b892b18c7b5396515cda321b3f504ea/cb69c/books.jpg 320w,\n/static/6b892b18c7b5396515cda321b3f504ea/c08c5/books.jpg 640w,\n/static/6b892b18c7b5396515cda321b3f504ea/6a068/books.jpg 960w,\n/static/6b892b18c7b5396515cda321b3f504ea/eea4a/books.jpg 1280w,\n/static/6b892b18c7b5396515cda321b3f504ea/9568a/books.jpg 3024w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>필자의 독서 취향은 이 쪽에 가깝다.(왠지 스파이가 하나 껴있는 것 같지만 신경쓰지말자.)</small>\n</center>\n<p>그럼 왜 책을 쓰게 되었냐? 뭐 여러가지 이유가 있겠지만 몇가지로 추려보자면 대충 이렇다.</p>\n<blockquote>\n<ol>\n<li>코드 같은 무형의 작품이 아니라 내 손에 잡히고 내 눈에 보이는 유형의 작품을 만들어 내보고 싶다.</li>\n<li>책을 쓰면서 내가 두루뭉술하게 알고 있던 지식을 정리할 수 있지 않을까?</li>\n<li>생각보다 코딩을 배우기 위해서 책으로 입문하시는 분들이 많았다.</li>\n</ol>\n</blockquote>\n<p>필자가 책 쓴다고 하니까 몇몇 분들께서 “와, 에반! 이제 책으로도 돈벌겠네요?”라는 드립을 간간히 쳐주셨는데 애초에 책을 팔아서 벌 수 있는 돈은 생각보다 많지 않다고 생각했기 때문에 별로 기대를 안했다.</p>\n<p>오히려 필자에게는 책이 돈을 벌 수 있는 부수입이라기보다 책을 집필했다는 나 자신의 만족과 내가 알고 있는 무엇인가를 다른 사람들에게 알릴 수 있는 점에서 매력으로 다가왔기 때문에 집필 제의를 받아들일 수 있었던 것 같다.</p>\n<p>그건 이 블로그도 마찬가지인데, 이 블로그로 돈을 벌어봤자 솔직히 얼마나 벌겠는가? 애초에 필자의 포스팅들은 대중적으로 소비할 수 있는 컨텐츠가 아니다. 그렇기 때문에 블로그가 진짜 흥해서 많이 벌어봤자 한달에 한 100만원 벌면 많이 버는 거다.</p>\n<p>물론 100만원이 작은 돈은 아니지만 그렇다고 내 인생이 바뀌는 돈도 아니니 별 의미는 없다고 생각한다. 그래서 필자는 그냥 필자의 생각과 지식을 다른 사람과 공유하고 싶은 마음으로 블로그를 운영하고 있다.</p>\n<h3 id=\"손에-잡히는-작품을-만들어-보고-싶다\" style=\"position:relative;\">손에 잡히는 작품을 만들어 보고 싶다.<a href=\"#%EC%86%90%EC%97%90-%EC%9E%A1%ED%9E%88%EB%8A%94-%EC%9E%91%ED%92%88%EC%9D%84-%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%B4%EA%B3%A0-%EC%8B%B6%EB%8B%A4\" aria-label=\"손에 잡히는 작품을 만들어 보고 싶다 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>필자는 개발자다 보니까 매일 프로그램을 만들어 낸다. 하지만 프로그램은 현실에 존재하는 물건이라는 느낌이라기 보다는 좀 더 추상적인 느낌으로 다가온다. 손으로 만질 수도 없고 냄새를 맡아볼 수도 없는 그런 무형의 개념체 같은 느낌이다.</p>\n<p>하지만 필자에게 책이라고 하면 딱 떠오르는 이미지는 새 책을 펼쳤을 때 풍기는 종이 냄새, 책꽂이에서 책을 꺼내올 때 느껴지는 감촉, 책장을 하나하나 넘길 때 들리는 소리와 같이 여러가지 감각이 함께 하는 공감각적인 이미지이기 때문에 프로그램을 만드는 것과는 매우 다르게 다가왔던 것 같다. 결과물이 기계적인 무언가가 아니라 어떤 형태를 지닌 물건으로 나온다는 것이 굉장히 새로운 느낌이었다.</p>\n<p>그리고 결정적으로 필자는 5살 때부터 할아버지 손 붙잡고 광화문 교보문고를 굉장히 자주 다닌 교보문고 빠돌이다. 그런 추억이 있는 광화문 교보문고에 내가 쓴 책이 진열될수도 있다는 것을 상상하니 뭔가 기분이 뭉클하면서도 묘했던 것 같다.</p>\n<h3 id=\"책을-쓰면서-내-지식도-정리하자\" style=\"position:relative;\">책을 쓰면서 내 지식도 정리하자.<a href=\"#%EC%B1%85%EC%9D%84-%EC%93%B0%EB%A9%B4%EC%84%9C-%EB%82%B4-%EC%A7%80%EC%8B%9D%EB%8F%84-%EC%A0%95%EB%A6%AC%ED%95%98%EC%9E%90\" aria-label=\"책을 쓰면서 내 지식도 정리하자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>필자가 Vue에 관한 책을 쓰긴 했지만, 당연히 Vue에 대한 모든 것을 완벽하게 알고 있는 상태로 책의 집필을 시작한 건 아니다. 물론 2년 동안 Vue를 사용했던 짬이 있으니 익숙하긴 하지만, 무언가에 익숙하다는 사실이 잘한다는 사실로 이어질 수는 없다.</p>\n<p>그래서 필자도 다시 기초부터 Vue를 쭉 공부한다는 생각으로 공식 문서부터 다시 읽어봤다. 가만보면 이런 점이 블로그 포스팅과 비슷한데, 예를 들어서 Vue의 라이프 사이클에 대한 글을 작성한다고 하면 당연히 대부분의 사람들은 리서치를 한다. 왜냐면 내가 알고 있는 것이 정답이라고 확신하지 못하기 때문이다. 이런 점에서 보면 책이든 블로그든 불특정 다수의 사람들이 내 글을 읽는다는 점에서 느껴지는 부담감은 비슷한 것 같다.</p>\n<p>게다가 필자는 사실 Vue를 따로 공부했던 적이 없다. 그냥 회사에 입사했는데 그 회사에서 Vue를 이미 도입한 상태였기 때문에 필자도 Vue를 사용한 게 시작이었고, 그 이후로는 그냥 비즈니스를 개발하면서 필요한 건 그때그때 찾아보면서 사용했었다. <small>(그래서 입사 초반에 작성한 컴포넌트를 보면 완전 개판 오분전이다.)</small></p>\n<p>이런 이유로 필자는 “기왕 이렇게 된 김에 VueJS에 대한 내 지식을 제대로 한번 다져보자”라고 생각하게 되었던 것이다.</p>\n<h3 id=\"생각보다-코딩을-배우기-위해서-책으로-입문하는-사람이-많았다\" style=\"position:relative;\">생각보다 코딩을 배우기 위해서 책으로 입문하는 사람이 많았다.<a href=\"#%EC%83%9D%EA%B0%81%EB%B3%B4%EB%8B%A4-%EC%BD%94%EB%94%A9%EC%9D%84-%EB%B0%B0%EC%9A%B0%EA%B8%B0-%EC%9C%84%ED%95%B4%EC%84%9C-%EC%B1%85%EC%9C%BC%EB%A1%9C-%EC%9E%85%EB%AC%B8%ED%95%98%EB%8A%94-%EC%82%AC%EB%9E%8C%EC%9D%B4-%EB%A7%8E%EC%95%98%EB%8B%A4\" aria-label=\"생각보다 코딩을 배우기 위해서 책으로 입문하는 사람이 많았다 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>앞서 얘기했듯이 필자는 “공부는 책보다는 인터넷이 편하지!”라고 생각하는 사람이라서 기술 서적에 대한 시각이 회의적인 편이었다. 그래서 처음 친구가 공동 집필 제의를 해줬을 때도 책을 쓴다는 것 자체가 조금은 의미 없는 일로 느껴졌고 “요즘 시대에 누가 책보고 공부하냐? 다 인터넷으로 검색해서 하지.”라는 말도 했었는데, 그 친구 말이 딱 이랬다.</p>\n<blockquote>\n<p>야, 처음 공부하시는 분들은 인터넷에서 어떤 키워드로 뭘 찾아봐야 하는지도 알기 힘들수도 있어.</p>\n</blockquote>\n<p>이 얘기를 듣고 필자가 생각이 많이 짧았다는 것을 바로 깨달을 수 있었다. 어디선가 “인간은 무의식적으로 타인에게 자신의 모습을 투영하려고 한다”라는 글을 본 적이 있는데, 필자가 딱 그 모양이었던 것이다.</p>\n<p>필자가 늘 인터넷으로 공부하는 것이 익숙했기 때문에 당연히 다른 분들도 그럴 것이라 생각했던 것인데, 기본적으로 인터넷으로 공부를 한다는 것은 어떤 키워드로 구글링을 해야 내가 원하는 정보가 나오는 지 알고 있다는 전제가 필요하다는 사실을 잊고 있었다.</p>\n<p>당연히 처음 개발을 접하거나 혹은 구글링이 익숙하지 않은 분들은 이런 점에서 진입 장벽을 느낄 수 있는데, 필자는 그 부분을 생각 안하고 있던 것이다. 그래서 친구의 저 말을 듣고 필자는 이런 마음이 들었다.</p>\n<blockquote>\n<p>상대적으로 진입 장벽이 낮은 책을 통해 공부한 후에 혼자 구글링을 할 수 있는 역량을 만드는 게 더 나을 수 있겠다.</p>\n</blockquote>\n<p>물론 당연히 책 한권 읽었다고 갑자기 Vue의 절대 고수가 되거나 그런건 아니겠지만, 적어도 책을 읽고 전반적인 내용을 이해한 후에 더 알아보고 싶은 것은 혼자서 키워드를 찾아내서 구글링 및 공부를 할 수 있는 능력을 독자 분들이 가질 수 있도록 도와주고 싶었다.</p>\n<p>이 이외에도 이력서에 뭐라도 한줄 더 쓸 수 있다거나 “작가라니 조금 근사한 걸…?”처럼 좀 깨는 이유도 있고 “개발랭이들의 생태계에 조금이라도 도움이 될 수 있겠다”라는 이타적인 이유도 있었지만 필자의 동기 부여에 큰 영향을 끼친 대표적인 이유는 저 위의 3가지였다. 결국 고민 끝에 2018년 8월 말, 필자는 친구 손을 잡고 고난의 길로 들어서게 되었다.</p>\n<h2 id=\"책을-쓰기-전에\" style=\"position:relative;\">책을 쓰기 전에<a href=\"#%EC%B1%85%EC%9D%84-%EC%93%B0%EA%B8%B0-%EC%A0%84%EC%97%90\" aria-label=\"책을 쓰기 전에 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>친구와 공동 집필이 결정된 후 제일 먼저 출판사 직원분과 역삼역 근처 카페에서 간단한 미팅을 가졌다. 내용은 뭐 대략 집필 계획서를 보내달라, 인세는 어떻게 나온다, 계약은 어떻게 진행될 것이다와 같은 간단한 내용들이었다.</p>\n<p>이때까지만 해도 필자와 친구는 대략 “이러이러한 내용을 써야겠다” 정도로만 얘기가 된 상태였지만 이제 출판사에 보낼 집필 계획서를 작성하기 위해 상세한 논의를 해야했다. 이때 협의되었던 몇가지 내용들 중 핵심 포인트는 “이 책을 읽고 회사에 입사했을 때 최소한 어플리케이션 개발 자체는 할 수 있어야 한다”였다.</p>\n<p>이 얘기는 지금 시중에 나와있는 다른 Vue 책을 몇개 읽어보고 나서 나오게 된 것이다. 시중에 판매되고 있는 책들은 대부분 해당 기술에 대한 API나 기술의 원리 등을 중점으로 설명하고 있었고, 예제 또한 간단한 To Do 리스트 또는 그와 비슷한 아키텍처를 가지는 작은 어플리케이션을 만들어 보는 편이었다.</p>\n<p>이런 책들을 읽어보며 필자와 친구가 느꼈던 아쉬운 점은 “이걸 읽고 바로 실무에 투입되면 일을 할 수 있나?”라는 점이었다.</p>\n<p>아무리 책을 통해 Vue의 API가 어떤 것이 있는지, 라이프 사이클은 어떤 순서로 실행 되는 지와 같은 지식을 익혔다고 해도 회사에 입사한 후에 신입 개발자가 마주하는 문제들은 “어떤 라이프 사이클에 이 로직을 넣을까?”같은 단순한 문제가 아니라 “컴포넌트는 어떤 단위로 나누어야 하나?”, “API 통신 로직은 컴포넌트에 있어야 할까? 아니면 Vuex 스토어에 있어야 할까?”, “유저가 로그인한 상태는 어떻게 관리해야하지?”와 같이 한 수준 더 높은 문제들이다.</p>\n<p>그래서 필자는 독자 분들이 이 책의 예제를 한번 작성해보고 회사에 갔을 때, 그 문제를 해결하는 건 둘째치고 “어, 이거랑 비슷한거 언제 한번 해봤는데?”라는 생각이 들게 하는 것만 해도 성공이라고 생각했고 친구도 필자와 동일하게 생각하고 있었기 때문에 책의 큰 방향을 정하는 건 어렵지 않았다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b3c3597b655396c4c38d530c43a47da5/ff42b/plans.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 97.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdElEQVR42q1VS4/TMBDO/78hxAEJiRsHThwQEkIIcYATatG2tLtd+kjSNG2Tps37aX/M2A3bpj30sI5Gntieycw3nycGaNQNnm0Yfizx6kuBgS3otcFofI/ZbAbLttHv/4azWsG0LPR7PYxGY8RJgiDYUxANJFl0xYhziQ+/asw9veR5Hna+jzSJSd+omWWzduF7W1RliSxNIIW4HmGcCxSVQFoIRJlAVkmkpURSPM1Kr7Tw+YSCiLIGIQnbRP9nASMhR1mpRetSCTtj51kFvVZL5OpdqL2c1vNan9Mf1vZGkEi8+VZi7HDKQuFn2xYcZ4nh4E6l6ixJHw4w/TvBkvYYEsucY/JwjyzLEIUH1FWlU44o/Hc/KjyuhcJw6bjYbDaIohjueo0wDEmP6CMOXNfFfr9HQoXxyema9itylCQp6iNVDKHAFZBSgnWebxEeXZ3tDb1wefB0dNe7Dk8DMfaE4dvvJR7cFsM5loTZivg3HA6x3W5VavzuOI6SNE1V6kVRXNLmkEq8/lpi5GgMbXsJl4wZOzYOgkAZe+SYOcofyPNcFaM6FuLM4ROGQoWOK2l0sWv3eO6KIfggPTxr/Ry7a0WQR6fKuZRnYoTE7vc/I8y3tYrUNC1YdHdN01Sy2+2ISo7SGUfGkylT0hWM4/iigETsBi8+BfhjlwrDBRkuFgtVGHbM+LE+nU4VD3mNseWC8N6FQw6zacRZyvKEGqJLo/ZMu99NuVuUa4VoAW+oZXHbak7koijcvj72apj+sX0RPowRU4RTZQwZL6bKTQ2Wm8PLzyXurPYurxT4NjXYyWSieMdEPhwOtzlsfwHymX4B/wCJuw6H/YhU0QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"plans\" title=\"\" src=\"/static/b3c3597b655396c4c38d530c43a47da5/ff42b/plans.png\" srcset=\"/static/b3c3597b655396c4c38d530c43a47da5/69538/plans.png 160w,\n/static/b3c3597b655396c4c38d530c43a47da5/72799/plans.png 320w,\n/static/b3c3597b655396c4c38d530c43a47da5/ff42b/plans.png 484w\" sizes=\"(max-width: 484px) 100vw, 484px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>어디선가 많이 본 짤이 떠오르는 장면</small>\n</center>\n<p>책의 큰 방향이 정해진 후 필자와 친구는 퇴근 후에 일주일에 한두번은 꼭 만나서 근처 카페로 간 뒤에 집필 계획서를 함께 작성하기 시작했다. 집필 계획서에는 대략 이런 정보가 포함된다.</p>\n<blockquote>\n<ol>\n<li>제목(가제)</li>\n<li>작성자</li>\n<li>작성일</li>\n<li>책의 핵심 컨셉</li>\n<li>내용 요약 및 특징</li>\n<li>이 책과 관련된 기술의 동향</li>\n<li>예상되는 탈고 날짜</li>\n</ol>\n</blockquote>\n<p>이외에도 몇가지 정보가 더 있지만 큰 틀은 대충 이렇다. 이때 작성한 집필 계획서는 향후 출판사가 책을 홍보할 때 사용하는 자료이기도 한 만큼 되도록이면 자세하게 작성하는 것이 좋다.</p>\n<p>어쨌든 출판사에서 요구한 대로 집필 계획서를 작성해서 제출한 뒤 본격적인 집필을 시작했다.</p>\n<h2 id=\"개발자처럼-집필하자\" style=\"position:relative;\">개발자처럼 집필하자!<a href=\"#%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%B2%98%EB%9F%BC-%EC%A7%91%ED%95%84%ED%95%98%EC%9E%90\" aria-label=\"개발자처럼 집필하자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>처음에는 구글 독스(Google Docs)를 사용하여 집필을 시작했다. 구글 독스는 H1, H2과 같은 글꼴 스타일 기능을 제공해주기 때문에 미리 합의한 스타일을 정해놓고 문서를 작성할 수 있었다. 하지만 구글 독스로 챕터 3개 정도를 작성했을 때, 필자는 구글 독스가 굉장히 비생산적이라는 생각이 들기 시작했다.</p>\n<p>글꼴을 변경하거나 이미지를 첨부하는 등의 행위를 할 때 변경하고자 하는 부분에 커서를 위치시킨 뒤 마우스로 메뉴를 클릭해서 진행해야하는 방식이 너무 번거로웠고, 그때마다 집중의 흐름이 끊겨서 불편했다. 게다가 각 챕터 별로 문서를 새로 만들때마다 글꼴 스타일을 출판사 규격에 맞게 매번 설정해줘야 한다는 점 또한 생산성을 저하시켰다.</p>\n<p>그리고 필자와 친구는 서로 놓치고 간 부분을 잡아주거나 문체의 통일을 위해 구글 독스 문서에 코멘트를 남기는 방식으로 서로 작성한 부분을 리뷰했다. 그러나 이 방식은 필자가 생각하기에 조금 비생산적이었는데, 리뷰를 하는 입장에서는 이번에 추가된 내용이 무엇인지, 삭제된 내용이 무엇인지 알기 힘들었고, 리뷰를 받는 입장에서는 댓글이 문서의 어느 부분에 달렸는지도 한 눈에 알아보기가 힘들었다.</p>\n<p>그래서 필자는 “어떻게 하면 글쓰기 외의 다른 행동에 시간을 쓰지 않고 글쓰기에만 집중할 수 있을까?” 라는 고민을 하기 시작했다.</p>\n<h3 id=\"markdown을-사용하여-책-집필하기\" style=\"position:relative;\">Markdown을 사용하여 책 집필하기<a href=\"#markdown%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%B1%85-%EC%A7%91%ED%95%84%ED%95%98%EA%B8%B0\" aria-label=\"markdown을 사용하여 책 집필하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>필자가 고민한 결과로 선택한 것은 바로 마크다운(Markdown) 포맷이었다. 필자와 친구 둘 다 개발자이기 때문에 일단 마크다운 포맷은 우리에게 굉장히 익숙한 포맷이었고, 문서의 전체적인 스타일도 이미 정해져있기 때문에 스타일에 관한 걱정이나 별다른 작업 없이 계속 글쓰기에만 집중할 수 있을 것 같았다.</p>\n<p>하지만 출판사는 MS Word를 사용하여 원고를 관리하니 결국 출판사에 원고를 보낼 때는 docx 파일로 보내야 하며, 다른 리뷰어 분들에게 책에 대한 리뷰를 받을 때에는 pdf 파일로 보내드려야 했다. 그래서 마크다운 파일을 docx나 pdf 파일로 컨버팅할 수 있는 방법을 찾아야 했다.</p>\n<p>그래서 찾아낸 게 <a href=\"https://pandoc.org/\" target=\"_blank\" rel=\"nofollow\">pandoc</a>과 <a href=\"https://github.com/alanshaw/markdown-pdf\" target=\"_blank\" rel=\"nofollow\">markdown-pdf</a>라는 라이브러리였다. <code class=\"language-text\">pandoc</code>은 홈페이지에 Universal Document Converter라고 홍보하고 있을 만큼 다양한 포맷의 문서 변환을 지원해준다. 물론 마크다운을 docx로 컨버팅하는 기능도 지원한다. 하지만 마크다운을 pdf로 컨버팅하는 기능은 지원하지 않기 때문에 해당 기능을 구현하기 위해 다른 라이브러리를 찾아야했는데, 그 과정에서 <code class=\"language-text\">markdown-pdf</code>라는 라이브러리를 찾았다.</p>\n<p>여기까지 리서치를 마친 필자는 친구에게 구글 독스에서 마크다운으로 갈아타자는 제안을 했고, 친구도 고민 끝에 수락하여 이후 책의 집필은 모두 마크다운과 깃(Git)을 사용하여 진행했다.</p>\n<h3 id=\"git을-이용한-문서의-버전관리\" style=\"position:relative;\">Git을 이용한 문서의 버전관리<a href=\"#git%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AC%B8%EC%84%9C%EC%9D%98-%EB%B2%84%EC%A0%84%EA%B4%80%EB%A6%AC\" aria-label=\"git을 이용한 문서의 버전관리 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>구글 독스를 사용할 때 겪었던 또 다른 문제점 중 하나가 바로 문서의 버전관리가 힘들다는 것이다. 물론 구글 독스도 <code class=\"language-text\">파일 > 버전기록</code> 메뉴에 들어가면 각 버전에서 추가된 내용이나 삭제된 내용을 확인할 수 있지만, 그 버전이 정확히 어떤 단위로 묶인 단위인지 명확하지않다는 것이 단점이다.</p>\n<p>하지만 깃을 사용하면 커밋을 할 때 의미있는 단위로 나누고 정확한 커밋 메세지를 작성함으로써 정확히 문서의 어떤 부분을 수정했는지 상대방에게 알릴 수 있다. 또한 일정 단위의 문서를 작성하고나면 풀 리퀘스트(Pull Request)를 통해 상대방에게 리뷰를 받는 식으로 서로 작성한 부분에 대해서 최소 1번 이상은 리뷰를 하도록 할 수 있다.</p>\n<p>그래서 필자와 친구는 깃허브(Github)에 레파지토리를 하나 생성하고 챕터 단위로 하나씩 맡아서 집필을 진행하되, 내용을 마스터 브랜치에 머지하고 싶을 땐 반드시 풀 리퀘스트를 보내고 머지하도록 협의하였고 그 결과 서로 작성한 부분이 아니더라도 내용을 파악하는데 큰 어려움이 없이 집필을 진행할 수 있었다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4ab6fb78bbb128bf0fd837c9b548a5ae/6569d/review.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVR42pWUDY+cIBCG/f9/rW2aXu9y7tb1E79FRF1PQPbtwDbpJU3bPZMnw4CMA/OOgVxWdANHz0e0/YCm6yFlA9F/xrpkOCxgjoOwf3DQvDYG6h3BVlRYLxlUXuHadhiyDqKoMeQnjCyFqBrIusXcdJAOGk805xjLGlpI2HnFIRcYssF2jrC/hMAlhXabsxIiLjDQR8Y4Q3v+gSnNyE/QRzFxAaexzAvotoel04ELz22cELSmQ6lKFNccfOfIuwKMMyR1irTNEdcJ4ipBVMaI2AUXsm4t63IUfYFiYBBqgjQSUs0I4ijEKXxCwwewukJHdhAC132HPoy/v8Na2NvtF7/HxtIa+ZrsdX/zfrCMA2TfYqCijOOIjorCOcc8L+QLLFS0R54bfcARvIYnfPry1QdjZQXGSm85+ZOcIWeC7L8eSyfY6UTOBkmS4HQ6+wkx0V1I6YO0HVVbTJThAqXU4xlGVLVv35/95rpuUDctGmIkf12v2LYNy7q6HY9leCbZPPmAAjlJoW4aJGmKljSptPbiNSTY/2Xn3vMZcipI31TYlfEBjLmr33G4brB37t3yd9y7SlOnJOcQcfiMeX2D1vdM3KL2gT/GrjQCF51Rh5QEq2rEWYGJJPP+oh/FaTNwxxReHivcj2Kintx2V9XbxwNai5/EnTY9Y+pYrwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"review\" title=\"\" src=\"/static/4ab6fb78bbb128bf0fd837c9b548a5ae/6af66/review.png\" srcset=\"/static/4ab6fb78bbb128bf0fd837c9b548a5ae/69538/review.png 160w,\n/static/4ab6fb78bbb128bf0fd837c9b548a5ae/72799/review.png 320w,\n/static/4ab6fb78bbb128bf0fd837c9b548a5ae/6af66/review.png 640w,\n/static/4ab6fb78bbb128bf0fd837c9b548a5ae/d9199/review.png 960w,\n/static/4ab6fb78bbb128bf0fd837c9b548a5ae/21b4d/review.png 1280w,\n/static/4ab6fb78bbb128bf0fd837c9b548a5ae/6569d/review.png 1328w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>리뷰를 하면 좋은 점.jpg</small>\n</center>\n<p>물론 나중에 전체 리뷰를 할 때 한번에 고쳐야 될 부분이 많아지는 경우가 있어서 충돌(Merge Conflict) 때문에 조금 고생하기는 했지만, 구글 독스로 진행했다면 두 명이 동시에 수정한 부분이 어딘지도 모르고 넘어갔을 가능성이 컸을 것이다.</p>\n<h3 id=\"문서-컨버팅-하기\" style=\"position:relative;\">문서 컨버팅 하기<a href=\"#%EB%AC%B8%EC%84%9C-%EC%BB%A8%EB%B2%84%ED%8C%85-%ED%95%98%EA%B8%B0\" aria-label=\"문서 컨버팅 하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이렇게 작성된 문서는 중간중간 PDF로 변경되어 부분 출판되었다. 밑에서 다시 설명하겠지만, 집필 초기에 친구가 제안했던 “책의 타겟 독자층을 모집해서 우리 책으로 스터디를 진행해보자”라는 아이디어를 냈었다. 그래서 매주 토요일마다 집필된 책을 참고 자료로 사용하여 스터디를 진행하고 있었기 때문에 지속적으로 md 파일을 pdf로 변경해야했었다.</p>\n<p>그래서 <code class=\"language-text\">markdown-pdf</code> 라이브러리를 사용하여 간단한 출판 스크립트를 작성했고 챕터 하나의 집필이 끝날 때 지속적으로 부분 출판하여 스터디에 참여하신 분들이 끊기지 않고 진도를 나갈 수 있도록 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// vuejs-book/scripts/publish.js</span>\n<span class=\"token function\">glob</span><span class=\"token punctuation\">(</span><span class=\"token string\">'book/**/*.md'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> mdFiles</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> pdfFilePaths <span class=\"token operator\">=</span> mdFiles<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Ready </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>path<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> newPath <span class=\"token operator\">=</span> path\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'book/'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>destDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.md'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.pdf'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> newPath<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token function\">mdpdf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">preProcessHtml</span><span class=\"token operator\">:</span> <span class=\"token function\">preProcessHtml</span><span class=\"token punctuation\">(</span>basePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">cssPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'./custom.css'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">remarkable</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">html</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>mdFiles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>pdfFilePaths<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    pdfFilePaths<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">pdf</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Created </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>pdf<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">preProcessHtml</code>는 컨버팅을 진행한 후 책에 들어간 이미지의 경로가 맞지 않아 pdf 파일에서 이미지가 출력되지 않는 이슈 때문에 작성한 함수인데, 마크다운을 우선 HTML로 파싱한 후 <code class=\"language-text\">img</code> 엘리먼트를 찾아서 <code class=\"language-text\">file://</code> 프로토콜을 사용한 링크로 바꿔주는 역할을 한다. 이 과정을 거치고 난 후 HTML을 pdf로 컨버팅했더니 이미지가 정상적으로 첨부되는 것을 확인할 수 있었다.</p>\n<p>이렇게 출판한 pdf 파일들을 구글 드라이브에 업로드해서 스터디원이나 리뷰어 분들이 부분 출판된 내용을 바로바로 확인할 수 있도록 진행하였다. 그리고 출판사에 보낼 docx 파일은 <code class=\"language-text\">pandoc</code>을 이용하여 컨버팅하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// vuejs-book/scripts/deploy.js</span>\n<span class=\"token function\">glob</span><span class=\"token punctuation\">(</span><span class=\"token string\">'book/**/*.md'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> mdFiles</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  mdFiles<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> chapter <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Ready for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chapter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> newPath <span class=\"token operator\">=</span> path\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'book/'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>destDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chapter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/README.md</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chapter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.docx</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> args <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">-f markdown -t docx -o </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// https://pandoc.org/MANUAL.html#syntax-highlighting 코드 하이라이팅 볼것</span>\n    <span class=\"token keyword\">const</span> originSource <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>path<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> source <span class=\"token operator\">=</span> originSource<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\(\\/assets</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>basePath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/assets</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">nodePandoc</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Finish </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chapter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 작성된 문서 컨버팅 스크립트들은 npm script로 등록하여 언제든 간편하게 md 포맷을 pdf와 docx 포맷으로 뽑아낼 수 있도록 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"publish\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node scripts/publish.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node scripts/deploy.js\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>사실 처음에 md 포맷을 pdf로만 변경할 때는 별 문제가 없었는데 나중에 <code class=\"language-text\">pandoc</code>을 통해 docx 포맷으로 변경할 때 글꼴 스타일에 관련된 이슈가 발생했다.</p>\n<p><code class=\"language-text\">pandoc</code>을 사용하여 docx 포맷으로 컨버팅할 때 일명 레퍼런스 문서라는 것을 설정할 수 있는데, 이 문서에 커스텀 글꼴 스타일을 설정해놓으면 컨버팅 되는 문서에서 이 문서의 글꼴 스타일을 참고하여 동일한 글꼴 스타일을 사용한 문서로 만들어준다.</p>\n<p>그래서 처음에는 이 기능만 믿고 “출판사 포맷대로 글꼴 스타일을 설정해놓은 레퍼런스 문서를 하나 만들어놓으면 되겠구나”했었는데 막상 레퍼런스 문서 옵션을 사용하여 스크립트를 돌려보니 문서에 첨부한 코드 블록의 스타일이 와장창나는 사태가 발생했다.</p>\n<p>그래서 결국은 마지막에 출판사에 원고를 보낼 때에는 <code class=\"language-text\">pandoc</code>을 사용하여 md 포맷을 docx 포맷의 기본 글꼴 스타일로 컨버팅 한 후에 그 문서의 글꼴 스타일을 직접 수작업으로 변경하는 방법을 사용했다.</p>\n<p>뭐 마지막에는 꽤 삽질을 하긴 했지만 그래도 md 포맷을 택함으로써 집필 과정에서 시간을 많이 줄일 수 있었고, 게다가 Git을 사용한 버전관리도 할 수 있엇으므로 결과적으로는 좋은 선택이었다고 생각한다.</p>\n<h2 id=\"공동-집필-과정에서의-충돌\" style=\"position:relative;\">공동 집필 과정에서의 충돌<a href=\"#%EA%B3%B5%EB%8F%99-%EC%A7%91%ED%95%84-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C%EC%9D%98-%EC%B6%A9%EB%8F%8C\" aria-label=\"공동 집필 과정에서의 충돌 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>필자는 혼자 책을 집필한 것이 아니라 친구와 함께 공동 집필을 한 것이기 때문에 서로의 의견을 일치시키고 합의점을 도출해내는 커뮤니케이션도 굉장히 중요한 일 중 하나였다.</p>\n<p>사실 필자와 이 친구는 함께 사이드 프로젝트를 진행해본 경험도 있고 평소에도 성격이 꽤 잘맞는 편이라서 같이 해외여행도 다녀온 막역한 사이이다. 하지만 책이라는 매체의 특성 상 코드와 다르게 배포 후 수정이 불가능해서 “최대한 완벽하게 끝내고 싶다”라는 마음 때문에 서로 의견의 일치를 보는 것이 평소보다 더 어려웠던 것 같다.</p>\n<h3 id=\"설계에-대한-관점의-차이\" style=\"position:relative;\">설계에 대한 관점의 차이<a href=\"#%EC%84%A4%EA%B3%84%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B4%80%EC%A0%90%EC%9D%98-%EC%B0%A8%EC%9D%B4\" aria-label=\"설계에 대한 관점의 차이 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>처음에 의견 충돌이 많이 났던 것은 예제 어플리케이션의 설계였다. 책에 들어가는 예제는 불특정 다수에게 노출되는 정보이기 때문에 최대한 주관성을 배제하고 널리 통용될 수 있는 지식을 사용하여 작성되어야한다. 그래서 필자와 친구는 “예제 어플리케이션의 설계를 어떻게 가져갈 것인가?”로 엄청 많은 이야기를 나누었다.</p>\n<p>간단하게는 컴포넌트의 네이밍과 프로젝트의 디렉토리 구조에서부터 스토어의 상태의 변경을 위한 액션은 어떤 컴포넌트가 Dispatch하는 것이 맞는 것이냐와 같이 심도있는 주제까지 다양한 이야기를 나누었다. 결국 이런 끊임없는 커뮤니케이션을 거쳐서 합의점을 도출해내고 나서야 예제 어플리케이션 개발에 들어갈 수 있었다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b0843883f37a5a8955d1b73bfc9d2333/077b7/meeting.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 79.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADD0lEQVR42oWUa08iSRSG/f+bmNkPO2pgBFQIgtLNTRp0hnvb3G+iwAADCA6O1wG8jIjPVrf7YbMZ3Ure1Knq1JNzTnW9S/f394yGQ4anp1xfXzEajTgVca/f5+LykrOz74aGxv7QmMfn5/TF916vx3g8Ns4MBWMwGLD0NH+iUq1RKFVotdo0ThpUKiV63Q73d1Nmk1smP2/5eXPNzdWV0CV3syl3d3foyTw+Php6eHgw9pZeXhb0OwJSzlGvFvl6XKJeztA5zjM4KdKtZWiXNVpFlXw6SkzxMug00cfLywv/HQbwdtzh/FuNq+EJP/p1jisazeohp80CXysq9VycqhZFjYZRfDt0mvV3gIsFN9/bJJJx1MM0bZFZQ8BymRjlfJJyNkYmuU8uGSYvlAx76Lcb7wMvR01RrkY8lUA7TJJRoyhhBY8vgC/gZ8OxzV5QQovvcRBw0f2/DAfdiujdId2G6N1JRpScolaMk05ECIf8RPf9fIl4iR/IhGQ77cbR+8BOI0cpd0C1EDNA1XyUZFxB9kkEgn58fpmg3yOgEv6dTVrHtbeBCwFsHomeqXsUM6JXqoKWVkR2IZSQF4+0gyy7kSUniih31/GJo3LxH+Did8Bn6qUE6ZiXVNRH7MBD7LNMMiZKjci4XA6CXidhv5OgZMdhXaFUyL0CF28Ay9kvxPd3RI8k9hUXkZCLoG+bLfsG1g0rm1tWbLZ1tjbWWfv4gXIhaxxe/Bb4/ExOlBgJ2IkEnYR8DsIBJ9KunVWTmTWTCavFzMeVFUymVZaX/6CYz7wNfJ7PiUc8+Nxm/B6boaC8hSyaL7ltSC4bnm0Lu85PuB1mLKvL5LPqK1Ako1/Mv7U0F29Z8YreWP7EbV8VWhMAM163FdllMWAepwXXpklojfW/RIa59NsZ6g+8kNfQVPFSUuJVHKaMtV5WVlONWVOT4iKy4vbFj68mhIHUhQOdGS6ju47uTrrbXFxc6BnO6Xa/0Wy2aDSaIu7SbncM93h1kl/ci/hBxLPZjF9PT4bLTKdTYz2ZTIxYl77/N/+2Z+cT2oKYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meeting\" title=\"\" src=\"/static/b0843883f37a5a8955d1b73bfc9d2333/6af66/meeting.png\" srcset=\"/static/b0843883f37a5a8955d1b73bfc9d2333/69538/meeting.png 160w,\n/static/b0843883f37a5a8955d1b73bfc9d2333/72799/meeting.png 320w,\n/static/b0843883f37a5a8955d1b73bfc9d2333/6af66/meeting.png 640w,\n/static/b0843883f37a5a8955d1b73bfc9d2333/d9199/meeting.png 960w,\n/static/b0843883f37a5a8955d1b73bfc9d2333/077b7/meeting.png 1166w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Form 컴포넌트의 정의부터 시작해서 어떤 라이브러리를 사용할 것인지까지 일일히 다 정했었다.</small>\n</center>\n<h3 id=\"일하는-스타일의-차이\" style=\"position:relative;\">일하는 스타일의 차이<a href=\"#%EC%9D%BC%ED%95%98%EB%8A%94-%EC%8A%A4%ED%83%80%EC%9D%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4\" aria-label=\"일하는 스타일의 차이 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>두 번째는 바로 일하는 스타일이었다. 사실 이게 정말 의외인 부분이었는데, 이미 필자는 이 친구와 사이드 프로젝트를 진행한 경험이 있었고, 도중에 의견 충돌이 나더라도 굉장히 서로 만족할 만한 결론을 도출해내면서 진행해왔기 때문에 이번에도 마찬가지일 것이라고 생각했다. 근데 이게 돈받고 하는 일이라서 그런지, 아니면 마감 기한이 정해져 있는 일이라서 그런지는 몰라도 사이드 프로젝트 때와는 굉장히 다른 상황이 펼쳐졌다.</p>\n<p>일단 필자는 어떤 일을 하든 마감 기한에 쫓기면서 하는 스타일이 아니다. 이렇게 할 수 있는 이유는 필자가 일하는 중간에 생기는 변수를 최소화하고 리스크가 생길 것 같은 일을 아예 차단해버리는 스타일이기 때문이다. 그리고 결정적으로 성격 자체가 좀 느긋하다. 좋게 말하면 느긋한거고 나쁘게 말하면 게으른거긴 한데, 뭐 어쨌든 그런 성격이다.</p>\n<p>하지만 이 친구는 뭘 하든 열정이 장난아니다. 하기 싫은 일이든 하고 싶은 일이든 항상 최선을 다하는 스타일이다. 이 친구가 이렇게 할 수 있는 이유는 기본적으로 책임감이 큰 성격이라서 그렇다고 생각한다. <small>(뭐 아닐 수도 있다. 아무리 친구라도 모르는 부분은 있으니)</small></p>\n<p>이 친구의 바로 이런 부분들이 필자에게 굉장히 자극을 주는 부분이고 친구라는 부분을 제외하고 개발자 대 개발자로 생각해도 굉장히 좋은 개발자라고 생각한다.</p>\n<p>하지만 같이 마감기한이 있는 일을 하다보니 이 친구 입장에서는 필자가 적극적으로 참여하지 않는다는 마음이 있었던 것 같고, 필자는 필자대로 “이게 이렇게까지 스트레스를 받으면서 할 일은 아닌데…”라는 생각이 있었던 것 같다. 그리고 이게 사람인 이상 마감기한이 다가올수록 “출판사와의 약속을 지키지 못하면 어떡하나”라는 불안감도 들기 마련이고, 둘 다 직장을 다니고 있기 때문에 회사 일은 또 회사 일대로 해야하는 상황이었다. 그래서 육체적인 피로감과 정신적인 피로감이 점점 쌓여서 그랬던 것 같기도 하다.</p>\n<p>그래도 다행히 이 친구와 필자의 가장 큰 공통점은 커뮤니케이션과 같은 소프트 스킬의 중요성을 알고 있다는 점이었다. 그래서 서로 마감기한에 쫓겨 스트레스를 받고 있는 상황에서도 최대한 서로를 배려하고 서로의 의견을 많이 듣고 교환하는 과정을 통해 큰 갈등 없이 책 집필을 마칠 수 있었다.</p>\n<h2 id=\"책-리뷰하기\" style=\"position:relative;\">책 리뷰하기<a href=\"#%EC%B1%85-%EB%A6%AC%EB%B7%B0%ED%95%98%EA%B8%B0\" aria-label=\"책 리뷰하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>책을 집필하는 동안 필자와 친구가 풀 리퀘스트를 사용한 리뷰를 계속 하긴 했지만 작가 시점의 리뷰는 주로 오탈자 수정, 문체의 통일 등의 기계적인 리뷰라면 다른 리뷰어 분들이 해주시는 리뷰는 “이 내용이 정말 도움이 되는가?”, “이런 내용이 있으면 더 좋을 것 같다.”와 같이 작가의 시점에서는 알아차리기 힘든 정성적인 리뷰들이다. 그래서 책을 집필하는 중이나 책을 집필한 후에 리뷰어 분들의 피드백을 최대한 많이 수집하고자 했다.</p>\n<p>사실 필자는 개발자 인맥도 별로 없고 사람 만나는 걸 좋아하는 편도 아니라서 직장 동료 외에는 리뷰를 부탁할 수 있는 사람이 많지 않았다. 하지만 친구는 필자보다 인맥도 풍부하고 사회성도 좋아서 리뷰를 부탁할 수 있는 사람도 많았다. <small>(대단쓰…)</small> 그런 이유로 책 리뷰는 필자 혼자서는 진행하지 못했을 일이고 진짜 친구 덕이 크다. 그리고 필자도 이 경험을 바탕으로 “아 나도 네트워킹 좀 해야하나…?”라는 생각이 싹트기 시작했다.</p>\n<h3 id=\"스터디원들의-리뷰\" style=\"position:relative;\">스터디원들의 리뷰<a href=\"#%EC%8A%A4%ED%84%B0%EB%94%94%EC%9B%90%EB%93%A4%EC%9D%98-%EB%A6%AC%EB%B7%B0\" aria-label=\"스터디원들의 리뷰 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>위에서 한번 설명했듯이, 책을 처음 집필할 때 이런 리뷰의 중요성을 알았던 친구가 먼저 책의 타겟 독자층을 모집해서 우리 책으로 스터디를 진행해보자는 아이디어를 제안해주었고 필자는 처음에는 고민했지만 다른 리뷰어분들이 해주시는 리뷰가 중요하다는 말에 설득당해서 스터디를 진행하게 되었다.</p>\n<p>필자는 낯을 가리는 성격이라 처음 보는 사람들과 스터디를 한다는 것에 대해서 익숙하지가 않다. 그래서 처음에는 “내가 스터디원들에게 뭘 해드려야하지…?”라는 고민을 굉장히 많이 했는데 막상 스터디가 시작되고 나니 그런 걱정은 필자의 기우였다는 것을 알 수 있었다.</p>\n<p>스터디를 지원해주신 모든 분들이 굉장히 열정적으로 질문도 먼저 건네주시고, 더 알고 싶은 부분에 있어서도 확실하게 의사 표현을 해주셔서 필자도 편한 마음으로 스터디를 진행할 수 있었다. 그리고 모두 성격이 좋으셔서 낯가림이 심한 필자도 잘 어울릴 수 있었다.</p>\n<p>책을 집필하는 동안 실제 타겟 독자층이었던 스터디원들로부터 피드백을 받으며 책을 수정하다보니까 뭔가 책에 대한 자신감도 생겼고, 필자가 작성한 책으로 스터디하시면서 막힘없이 학습해나가시는 모습들을 보고 약간 뿌듯함도 느꼈던 것 같다.</p>\n<p>실제로 필자는 내가 먼저 나서서 타인에게 지식을 공유하고 싶다는 욕구는 없는 편이었는데, 이번에 책도 집필하고 스터디를 진행하면서 필자는 별 거 아니라고 생각했던 지식들이 다른 분들에게는 큰 도움이 되는 것을 보고 교육에도 조금 관심이 생기기도 했고 낯가림도 조금은 나아진 것 같다. <small>(그래도 역시 인싸의 길은 멀고도 험하다…)</small></p>\n<h3 id=\"현업-개발자분들의-리뷰\" style=\"position:relative;\">현업 개발자분들의 리뷰<a href=\"#%ED%98%84%EC%97%85-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%B6%84%EB%93%A4%EC%9D%98-%EB%A6%AC%EB%B7%B0\" aria-label=\"현업 개발자분들의 리뷰 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>책을 모두 집필하고 난 후에 주위의 현업 개발자 분들께도 리뷰를 부탁했는데, 이런 분들을 베타 리더라고 부른다고 한다. 필자도 이번에 처음 알았다.</p>\n<p>베타 리더 분들은 각자의 여유 시간에 따라서 전체 리뷰와 챕터 리뷰로 나눠서 진행해주셨는데, 필자가 집필하면서 놓쳤던 부분을 되짚어 주시기도 하고 이해가 어려울 것 같은 설명에 대해서도 지적해주시는 등 정말 꼼꼼하게 피드백을 해주셔서 굉장히 든든했다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>사실 처음 필자는 “책? 그냥 조금 긴 포스팅 느낌일 것 같은데”라는 안일한 마음으로 시작했는데, 얼마 지나지 않아서 그게 아니라는 것을 깨달았다. 이 포스팅에는 작성하지 않았지만 예제 어플리케이션을 만드는 일도 만만치 않았는데, 문제는 예제 어플리케이션을 수정하면 같은 부분을 책에서 찾아서 코드 블록을 수정하고 코드에 대한 설명도 그에 맞춰서 바꿔줘야하는 것이었다. <small>(게다가 클라이언트 어플리케이션 2개와 API 서버까지 만들어야했다.)</small></p>\n<p>예제 어플리케이션과 책의 내용이 조금만 싱크가 어긋나도 독자는 상당한 혼란을 느낄 수 있기 때문에 이런 부분을 꼼꼼히 체크해야했는데, 이게 제일 힘들었던 것 같다.</p>\n<p>그리고 포스팅과 다르게 책은 한 주제의 호흡을 굉장히 길게 가져가야 하는 매체이다보니까 앞 쪽의 내용과 뒤 쪽이 내용의 컨셉이 달라지면 안되는데, 필자는 이렇게 긴 글을 써본 적이 없기 때문에 주기적으로 앞 쪽의 내용과 문체를 확인해가면서 집필을 해야했다.</p>\n<p>그래도 이렇게 책을 한번 집필하고 나니까 뿌듯하기도 하고 글을 적는 행위에도 많이 익숙해져서 한 주에 한두번 포스팅 올리는 것 정도는 크게 어렵지 않아서 전체적으로는 좋은 느낌이다. 이 책을 보시는 많은 예비 독자들이 유익했다고 느낄 수 있었으면 좋겠다. 특히 프론트엔드 개발을 처음 시작하시려는 분들이 이 책을 읽고 “어 뭐야 생각보다 별 거 없네?”라고 생각했으면 진짜 좋을 것 같다.</p>\n<p>그리고 마지막으로 바쁜 개인 시간 쪼개서 책을 리뷰해주신 베타 리더분들과 기술 서적 집필이라는 좋은 기회를 제안해준 김영훈 개발자에게 <strong>압도적인 감사</strong>를 올리고 싶다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/4b190/thanks.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 86.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAQBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFtswTKxRyQpB//xAAeEAACAgAHAAAAAAAAAAAAAAABAgADBBESEzEyM//aAAgBAQABBQIVFpUldj6QGXhSFbZGZmI9E6//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAeEAACAgICAwAAAAAAAAAAAAABAgAxESEDECKBof/aAAgBAQAGPwJnY4UGeNCwYwrcbjKnA+zQ2YTmzDE99f/EAB0QAAMAAgIDAAAAAAAAAAAAAAABESExEHFRgbH/2gAIAQEAAT8hyA5S4ZvuPgSOeGnpF7nHWhKs6BUT2h8OG1n/2gAMAwEAAgADAAAAEBMPAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQEAAwACAwAAAAAAAAAAAAERACExYfAQceH/2gAIAQEAAT8QNdEUtY7mbrYqXbUJ5xNgnKwwIEwQz1dAt/MCsCFCQliW4ZAU7NWa74zj278B7PrP/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"thanks\" title=\"\" src=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/c08c5/thanks.jpg\" srcset=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/0913d/thanks.jpg 160w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/cb69c/thanks.jpg 320w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/c08c5/thanks.jpg 640w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/4b190/thanks.jpg 800w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>참고로 필자의 책은 <a href=\"http://www.yes24.com/Product/Goods/76639545\" target=\"_blank\" rel=\"nofollow\">Yes24</a>에서 구경해볼 수 있지만, 아직 초판 인쇄가 끝나지 않았기 때문에 배송은 다음 달부터 가능하다.</p>\n<p>하지만 필자는 인터넷에서 책을 구매하는 것보다 나중에 교보문고 같은 오프라인 서점에 책이 입고되면 가서 직접 한번 읽어보고 사는 것을 추천하고싶다. 이 글을 읽는 미래의 독자님들께서 교보문고에 갔을 때 민트색 표지에 커피 일러스트를 보고나서 필자를 떠올리고 한번 책을 펼쳐보게 만드는 것만으로도 필자는 행복해질 것 같다.</p>\n<p>이상으로 흔한 개발랭이의 작가 입문기 포스팅을 마친다.</p>","fields":{"slug":"20190721-vuejs-book-retrospective","path":"/2019/07/21/vuejs-book-retrospective/","lang":"ko"},"frontmatter":{"title":"흔한 개발랭이의 작가 입문기","subTitle":"한번도 기술 서적을 읽어본 적 없는 개발자가 책을 썼다고?","date":"Jul 21, 2019","categories":["에세이"],"tags":["Vue","회고","개발 책","프로그래밍 책","공동집필","커피 한잔 마시며 끝내는 VueJS","책 집필","개발자"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/36bf9d7dadae859391a4aa978c7ae097/3a812/thumbnail.jpg","srcSet":"/static/36bf9d7dadae859391a4aa978c7ae097/3a812/thumbnail.jpg 320w,\n/static/36bf9d7dadae859391a4aa978c7ae097/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/36bf9d7dadae859391a4aa978c7ae097/fc5c5/thumbnail.webp 320w,\n/static/36bf9d7dadae859391a4aa978c7ae097/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/36bf9d7dadae859391a4aa978c7ae097/2d839/thumbnail.jpg","srcSet":"/static/36bf9d7dadae859391a4aa978c7ae097/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/36bf9d7dadae859391a4aa978c7ae097/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"be7c0ae7-da2d-5b2b-bb0a-9661bfe81244","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%9B%90%EB%9E%98-%ED%95%84%EC%9E%90%EC%9D%98-%EA%B3%84%ED%9A%8D\">원래 필자의 계획</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C-1-%EA%B4%80%EB%AC%B8-manifestjson\">제 1 관문, Manifest.json</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C-2-%EA%B4%80%EB%AC%B8-service-worker\">제 2 관문, Service Worker</a></p>\n<ul>\n<li><a href=\"#%EA%B0%9C%EB%B0%9C%ED%99%98%EA%B2%BD-%EC%84%B8%ED%8C%85\">개발환경 세팅</a></li>\n<li><a href=\"#service-worker-%EC%9E%91%EC%84%B1\">Service Worker 작성</a></li>\n<li><a href=\"#service-worker-%EC%84%A4%EC%B9%98\">Service Worker 설치</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C-3-%EA%B4%80%EB%AC%B8-pushmanager\">제 3 관문, PushManager</a></p>\n<ul>\n<li><a href=\"#%EC%9E%AC%EC%95%99%EC%9D%98-%EC%8B%9C%EC%9E%91\">재앙의 시작</a></li>\n<li><a href=\"#%EB%B9%A0%EB%A5%B8-%EC%86%90%EC%A0%88\">빠른 손절</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C-4-%EA%B4%80%EB%AC%B8-notification-api\">제 4 관문, Notification API</a></p>\n<ul>\n<li><a href=\"#%EA%B8%B0%EC%A1%B4-%EA%B8%B0%EB%8A%A5%EC%97%90-notification-%EB%81%BC%EC%9B%8C%EB%84%A3%EA%B8%B0\">기존 기능에 Notification 끼워넣기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></p>\n</li>\n</ul>","excerpt":"이번 포스팅에서는 필자가 회사에서 2019년 7월 5일 금요일 하루 동안 기존 어플리케이션에 PWA(Progressive Web Application) 기능을 붙힌 삽질기를 기록하려고 한다. PWA는 지원하지 않는 브라우저에 대한 예외처리만 꼼꼼하게 해주면 UX, 성능, SEO 등에서 무조건 플러스 요인이기 때문에 예전부터 계속 해보고 싶었다.","html":"<p>이번 포스팅에서는 필자가 회사에서 2019년 7월 5일 금요일 하루 동안 기존 어플리케이션에 PWA(Progressive Web Application) 기능을 붙힌 삽질기를 기록하려고 한다. PWA는 지원하지 않는 브라우저에 대한 예외처리만 꼼꼼하게 해주면 UX, 성능, SEO 등에서 무조건 플러스 요인이기 때문에 예전부터 계속 해보고 싶었다.</p>\n<!-- more -->\n<p>하지만 시간이 없어서 계속 미루고 있었는데 마침 어제 간만에 필자에게 여유 시간이 주어졌다.</p>\n<p>필자가 지금 작업하고 있는 프로젝트가 회사의 비즈니스 모델과 밀접한 관련이 있는 프로젝트이고, 또 워낙 이 기능에 관련된 사내 이해관계자들이 많아서 PO가 테스트를 좀 더 꼼꼼히 하고 싶다고 했기 때문이다.</p>\n<p>그래서 금요일 하루, 정확히 말하면 오전에는 버그 터진거 하나 핫픽스하고 점심먹고나서 자료 조사도 한 시간 정도 해본 다음에 15시 30분 쯤부터 시작해서 22시 55분까지 달렸다. 원래 필자는 근무시간에 열심히 하고 다른 시간은 나에게 투자하자는 주의라 야근은 왠만하면 안하는데, 필자에게 주어진 시간이 하루 밖에 없어서 그 안에 무조건 끝내야 했던 것도 있지만 사실 제일 큰 이유는…</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4b791df3dd464ea532b95b6c21f7e0e7/acb04/tyson.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAeacpxrNRZehUA//xAAbEAEAAgIDAAAAAAAAAAAAAAABABECAxIiMf/aAAgBAQABBQKsV601MVI7Fj7yYNRbn//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABoQAAICAwAAAAAAAAAAAAAAAAAhARECICL/2gAIAQEABj8CmrOsZEi4Qtf/xAAaEAEAAwADAAAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/IaQV5DR5XUbeiKGKFUpjhHcvPIisiK1n/9oADAMBAAIAAwAAABBb4H7/xAAYEQACAwAAAAAAAAAAAAAAAAABEBEhQf/aAAgBAwEBPxDFJpf/xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQIBAT8QI3//xAAcEAEBAAMBAAMAAAAAAAAAAAABEQAhMUFRgaH/2gAIAQEAAT8QF9Ka/HtyzwkXSGU40cW/eVRrsWn7hltvCVzeGPY5pUJ44TWsoGOJ7lz/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tyson\" title=\"\" src=\"/static/4b791df3dd464ea532b95b6c21f7e0e7/c08c5/tyson.jpg\" srcset=\"/static/4b791df3dd464ea532b95b6c21f7e0e7/0913d/tyson.jpg 160w,\n/static/4b791df3dd464ea532b95b6c21f7e0e7/cb69c/tyson.jpg 320w,\n/static/4b791df3dd464ea532b95b6c21f7e0e7/c08c5/tyson.jpg 640w,\n/static/4b791df3dd464ea532b95b6c21f7e0e7/acb04/tyson.jpg 750w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<blockquote>\n<p>네, 쉽게 보고 덤볐다가 쳐맞았습니다.</p>\n</blockquote>\n<p>필자는 사실 PWA를 구현해본 경험이 없다. 구글에서 제공해주는 데모는 몇번 돌려본 적이 있지만 나머지는 그냥 다른 굇수분들의 블로그를 보고 “오…나도 해보고 싶군” 정도로만 생각했었다.</p>\n<p>근데 다른 사람들이 구현한 걸 보면 뭐 코드가 복잡한 것도 아니고 서비스 워커(Service Worker)도 작동 원리가 그렇게 생소한 느낌은 아니기에 사실 얕보고 있었다.</p>\n<h2 id=\"원래-필자의-계획\" style=\"position:relative;\">원래 필자의 계획<a href=\"#%EC%9B%90%EB%9E%98-%ED%95%84%EC%9E%90%EC%9D%98-%EA%B3%84%ED%9A%8D\" aria-label=\"원래 필자의 계획 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>원래 필자도 PWA에게 쳐맞기 전까진 그럴싸한 계획이 있었다. 물론 필자는 자세히 공부를 하고 덤비는 타입이 아니라 그냥 대충 알아본 다음에 나머지는 직접 맞아가면서 배우는 타입이라 더 그랬던 것도 있다.</p>\n<p>어쨌든 어제 점심을 먹고 와서 필자가 사무실에 앉아서 가만히 생각을 해본 결과, “PWA나 해볼까…? Manifest 넣고 서비스 워커 붙히면 뭐 나머지는 문서보고 해도 대충 될 거 같은데…?”로 결론이 나왔다.</p>\n<p>그래도 PWA의 모든 기능을 다 구현하는 것은 퇴근 시간인 19시까지는 힘들 것 같아서 작업에 대한 스코프를 잡았다.</p>\n<blockquote>\n<ol>\n<li>기능을 전부 구현하는 건 힘들 것 같으니 일단 기반을 잡아놓는다고 생각하자.</li>\n<li>서비스 워커 설치.</li>\n<li>Manifest.json 추가. 이건 남들 다하는 거니까 우리도 기본적으로 해야함.</li>\n<li>Pusher SDK와 PushManager를 사용해서 브라우저가 꺼져있더라도 사용자에게 푸시 메세지를 보여주자.</li>\n<li>시간 되면 모바일에서 홈스크린에 어플리케이션을 추가하는 것까진 해보고 싶다.(우선순위 낮음)</li>\n<li>오프라인 캐싱은 다음 시간에… (나름 스코프 조절)</li>\n</ol>\n</blockquote>\n<p>자 이제 계획이 잡혔으니 PO와 테스터에게 “프로젝트 테스트 하시는 동안 저는 저만의 놀이터에서 놀다 오겠습니다”라고 협의를 한 뒤 마스터에서 브랜치를 하나 땄다.</p>\n<p>브랜치 이름도 필자의 의지가 돋보이는 <code class=\"language-text\">feature/service-worker-web-push</code>로 딱 지어놓고 15시 30분 쯤 부터 작업을 시작했다. 그래도 이정도면 한 4-5시간 안에 충분히 가능하겠다 싶었는데…</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d1377bc7e60fb06312324f3859994069/f93b5/babo.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 86.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAMEBQEC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdSrPFJYcHjMCMH/xAAeEAACAQMFAAAAAAAAAAAAAAAAASECAwQREiIxMv/aAAgBAQABBQKuFumC9xTZrbqMnyPv/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQMYFR/9oACAEBAAY/Aio0fC0bP//EABwQAAMAAgMBAAAAAAAAAAAAAAABESExQYGxcf/aAAgBAQABPyGcD5GlRp8KuEtEIi3kLVRdxZln4aBx2eR//9oADAMBAAIAAwAAABDPF/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAwEBAAAAAAAAAAAAAQARITFBcfBhsf/aAAgBAQABPxC5UcBbjFtEpF1DLKYWS+hztSkeXeyy4egbTgYni+R383NXT8n/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"babo\" title=\"\" src=\"/static/d1377bc7e60fb06312324f3859994069/f93b5/babo.jpg\" srcset=\"/static/d1377bc7e60fb06312324f3859994069/0913d/babo.jpg 160w,\n/static/d1377bc7e60fb06312324f3859994069/f93b5/babo.jpg 300w\" sizes=\"(max-width: 300px) 100vw, 300px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>코딩하는 내내 필자의 정신상태</small>\n</center>\n<p>결과적으로 저 중에서 달성한 제대로 달성한 목표는 1, 2, 3번 뿐이다. 4번 목표인 푸시 메시지의 경우, Background 메세징은 삽질만 하다가 시간이 너무 많이 가서 실패하고 Notification API를 사용하여 Foreground에서만 노출되도록 구현했다.</p>\n<p>처음에는 숨고 모바일 앱에서 이미 사용하고 있는 FCM(Firebase Cloud Messaging)을 사용하려고 했는데 그러면 웹 클라리언트의 푸시 채널이 이원화되기 때문에 일단 테스트도 해볼 겸 FCM없이 서비스 워커의 <code class=\"language-text\">PushManager</code>만 사용해서 구현하려고 했다.</p>\n<p>이제 필자가 이것들을 작업하면서 어떤 문제에 봉착했고, 어떻게 해결했는지 한번 설명해보겠다.</p>\n<h2 id=\"제-1-관문-manifestjson\" style=\"position:relative;\">제 1 관문, Manifest.json<a href=\"#%EC%A0%9C-1-%EA%B4%80%EB%AC%B8-manifestjson\" aria-label=\"제 1 관문 manifestjson permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>제일 처음 한 일은 <code class=\"language-text\">manifest.json</code>을 생성하는 것이다. 이건 그냥 말 그대로 생성하면 된다. 또한 <code class=\"language-text\">manifest.json</code>은 어차피 정적인 파일이기도 하고 업데이트도 잦지 않은 파일이기 때문에 굳이 Express에서 응답하지 않아도 된다. 그래서 프로젝트 내부의 <code class=\"language-text\">static</code> 디렉토리에 <code class=\"language-text\">manifest.json</code>을 생성하고 nginx가 바로 응답해주는 방식으로 작성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token comment\">// static/manifest.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"숨고\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"short_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"숨고\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://d1hhkexwnh74v.cloudfront.net/app_icons/1x.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"48x48\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://d1hhkexwnh74v.cloudfront.net/app_icons/2x.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"64x64\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://d1hhkexwnh74v.cloudfront.net/app_icons/3x.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"128x128\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://d1hhkexwnh74v.cloudfront.net/app_icons/3x.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"144x144\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"start_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/?pwa=true\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"display\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fullscreen\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"background_color\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#FFFFFF\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"theme_color\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#00C7AE\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">manifest.json</code>에 대한 자세한 내용은 Google Web Developer 문서의 <a href=\"https://developers.google.com/web/fundamentals/web-app-manifest/\" target=\"_blank\" rel=\"nofollow\">The Web App Manifest</a>를 참고해서 작성했다.</p>\n<p>그리고 저 아이콘은 지금 숨고 앱에서 사용하고 있는 아이콘들이다. 굳이 모바일 앱과 다른 아이콘을 사용할 이유도 없고, 디자이너 분들도 바빠서 멘탈나간 상황이기 때문에 필자의 기술적인 욕심 때문에 아이콘을 만들어 달라고 하기엔 너무 미안했다.</p>\n<p>또한 앱과 웹이 같은 아이콘을 사용해야 브랜딩 측면에서도 좋을 거라 생각해서 모바일 앱 레파지토리를 클론받아서 몰래 훔쳐왔다. 그리고 저 이미지들은 굳이 프로젝트 내에 저장할 필요가 없으므로 회사에서 사용하는 S3 버킷에 업로드하고 CloudFront로 딜리버리했다.</p>\n<p>위에서 설명했듯이 필자는 <code class=\"language-text\">manifest.json</code>에 대한 요청을 Express가 처리하는 것이 아니라 서버 엔진인 nginx가 처리하는 방식을 선택했는데, 이렇게 nginx가 서버 어플리케이션까지 요청을 토스해주지 않고 그냥 알아서 서빙하도록 하고 싶다면 간단한 설정을 추가하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ ^/static</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">root</span> /your/project/location</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  ...\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이런 식으로 설정하면 바로 프로젝트 내의 <code class=\"language-text\">static</code> 디렉토리에 접근할 수 있다. 위 설정은 “static이라는 경로로 시작하는 요청이 들어오면 <code class=\"language-text\">/your/project/location</code>에서 니가 알아서 찾아줘”라는 의미이다. 하지만 로컬에서 개발 서버를 사용할 때에는 nginx를 사용하지 않고 NodeJS를 사용하여 바로 개발용 서버를 띄우므로 로컬 환경에서는 Express가 직접 파일을 서빙할 수 있도록 해줘야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'local'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/static'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./static'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>이제 브라우저에게 “나의 Manifest 파일이 여기 있으니 가져가시오”라고 알려줄 수 있는 <code class=\"language-text\">link</code> 태그를 하나 넣어주면 끝이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// constants/meta.constant.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">link</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rel</span><span class=\"token operator\">:</span> <span class=\"token string\">'manifest'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">href</span><span class=\"token operator\">:</span> <span class=\"token string\">'/static/manifest.json'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>manifest<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/manifest.json<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-vue-meta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>필자는 vue-meta 라이브러리를 사용하고 있기 때문에 이렇게 <code class=\"language-text\">Object</code> 타입 객체를 리턴하는 방식을 사용하면 렌더링 때 <code class=\"language-text\">&lt;head></code> 내부에 알아서 넣어준다. 그 후 브라우저가 <code class=\"language-text\">manifest.json</code>을 제대로 가져가는지는 크롬 개발자 도구의 Application > Manifest 탭에서 확인할 수 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 505px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6752d69a5efe962003e820272d2ac7f7/c0cb9/has-manifest.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVR42p2UT0vjUBTFCw64czHjwmqnNv9e0uSlTaJNUiwt1sERFUZwKMN8Nr+B4pQR3MxiFi6EWc3eD3O852kLgqDJ4vLeS+B37zn3vtfwfR9ZlmEwGMDzPLiuuwyeq0aDwCRJDJQfut0uwjBEFOlaUAN0HMeEUgpaa/R6PfQlSW0gN0EQmErjWJs1TTO4kqQWkJUxCF3s1XOiWsA8zzGZTDAej42H/LEAe56qDqRX9DCKIuOflqaUkqQoCtOgKl4ugVx1HCMWqEr62JFqh+XQfKsMpDRKZYd1GCFME+yORjKbOUJJUAlIGGWlaWqABBcy5NPpAfJiaM61JPMQizx6yCSdzjZsy6o8i8s5XMgmlBVzsGOB1xob27ZNl7nvs8sCLfdG2C1KeErVu8v0zzwK/MEb0mrBlVBODclsSPw8HoFU5MjYbJyfwfr5HXYinla4gi8kK7l6O+Lf5uEhBv/ucfLwH+tfpwg6Fjx6TflvWPCiKWxEJnPXnuxjen2D/u9faA5LhBtN+O1t+J/bZn0X0DyuEr6Ek6T4OJvh048Ztr6dYuvkCM3TI9kfo3X85ala9x1AvjCpjI4lklfml1i5uULj9hKrf66x9neOxt0cH+YXcHr6qXGvyH8E5xc3GuSQDZIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"has manifest\" title=\"\" src=\"/static/6752d69a5efe962003e820272d2ac7f7/c0cb9/has-manifest.png\" srcset=\"/static/6752d69a5efe962003e820272d2ac7f7/69538/has-manifest.png 160w,\n/static/6752d69a5efe962003e820272d2ac7f7/72799/has-manifest.png 320w,\n/static/6752d69a5efe962003e820272d2ac7f7/c0cb9/has-manifest.png 505w\" sizes=\"(max-width: 505px) 100vw, 505px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>자, 여기까지 하는데 거의 10분 정도 걸렸던 것 같다. 아직까지는 필자의 계획대로 순탄히 흘러가고 있었다. 하지만 문제는 이제부터 생기기 시작한다…</p>\n<h2 id=\"제-2-관문-service-worker\" style=\"position:relative;\">제 2 관문, Service Worker<a href=\"#%EC%A0%9C-2-%EA%B4%80%EB%AC%B8-service-worker\" aria-label=\"제 2 관문 service worker permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>기분 좋게 커피 한잔 때리고 와서 이제 서비스 워커를 적용하는 작업을 시작했다. 서비스 워커는 브라우저에 설치하고 나면 백그라운드에서 실행되는 프로세스로, 웹 어플리케이션의 메인 로직과는 전혀 별개로 작동한다.</p>\n<p>서비스 워커와 웹앱의 메인 로직은 서로 메세지를 주고 받는 방식으로 작동한다. <code class=\"language-text\">postMessage</code>로 보내면 <code class=\"language-text\">onMessage</code>로 받는 방식인데, WebView나 Chrome Extension과 같은 방식이기 때문에 이미 우리에겐 익숙한 방식이다.</p>\n<p>단, 아직까지 모든 브라우저에서 지원되는 것이 아니기 때문에 반드시 <code class=\"language-text\">navigator</code> 전역 객체 내부에 <code class=\"language-text\">serviceWorker</code> 객체가 존재하는 지 확인한 후 초기화를 진행해야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>뭐 이 정도 쯤이야 필자같은 프론트엔드 개발자들에게는 굉장히 익숙한 상황이기 때문에 그냥 웃고 넘길 수 있지만 이것보다 더 귀찮은 게 있었다. 바로 서비스 워커의 개발환경 세팅이다.</p>\n<h3 id=\"개발환경-세팅\" style=\"position:relative;\">개발환경 세팅<a href=\"#%EA%B0%9C%EB%B0%9C%ED%99%98%EA%B2%BD-%EC%84%B8%ED%8C%85\" aria-label=\"개발환경 세팅 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>서비스 워커는 일반적인 웹 어플리케이션보다 많은 기능에 접근할 수 있기 때문에 보안이 굉장히 중요하다. 그래서 서비스 워커는 제한적인 환경에서만 작동할 수 있도록 만들어졌는데 그 조건은 딱 두가지이다.</p>\n<hr>\n<ol>\n<li>웹 어플리케이션의 호스트가 localhost이거나</li>\n<li>HTTPS 프로토콜을 사용하고 있을 것</li>\n</ol>\n<hr>\n<p>불행히도 필자는 이 두가지 모두 다 해당이 안된다. 필자의 회사는 로컬에서 <code class=\"language-text\">http://local.soomgo.com</code>이라는 오리진을 사용하고 있기 때문에 서비스 워커 객체가 활성화 되지 않는다.</p>\n<p>그럼 해결 방법은 2가지로 줄어든다. 내가 localhost로 접속하거나 로컬에 HTTPS를 붙히거나.</p>\n<p>사실 필자는 이걸 놓쳐서 “아 서비스 워커 어디갔어? 왜 안돼? 죽을래?”로 컴퓨터랑 실랑이하느라 한 30분 날려먹었다. 공식 문서에 버젓이 한국어로 적혀있는 내용이므로 항상 공식 문서를 꼼꼼히 읽자…</p>\n<h4 id=\"개발-서버를-https로-띄우자\" style=\"position:relative;\">개발 서버를 HTTPS로 띄우자!<a href=\"#%EA%B0%9C%EB%B0%9C-%EC%84%9C%EB%B2%84%EB%A5%BC-https%EB%A1%9C-%EB%9D%84%EC%9A%B0%EC%9E%90\" aria-label=\"개발 서버를 https로 띄우자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>필자가 localhost 개발 환경에 접속하면 백엔드 쪽에서 CORS를 허용할 때 내려주는 Access-Control-Allow-Origin 헤더까지 변경해야하는 상황이라, 그냥 개발 환경에 HTTPS를 붙히기로 했다.</p>\n<p>Express는 내장 객체로 HTTPS 객체를 지원해주고 있기 때문에 간단하게 셋업할 수 있다. 먼저 HTTPS를 사용하기 위해서는 SSH 키쌍이 필요하므로 <code class=\"language-text\">openssl</code>을 사용하여 키를 만들어 주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ openssl genrsa <span class=\"token number\">1024</span> <span class=\"token operator\">></span> private.pem <span class=\"token comment\"># 비공개키 생성</span>\n<span class=\"token punctuation\">..</span>.\n$ openssl req <span class=\"token parameter variable\">-x509</span> <span class=\"token parameter variable\">-new</span> <span class=\"token parameter variable\">-key</span> private.pem <span class=\"token operator\">></span> public.pem <span class=\"token comment\"># 공개키 생성</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>그 다음 이 키를 프로젝트의 적당한 곳에 저장한 다음 그냥 사용하면 되는데 여기서 주의 사항이 있다.</p>\n<blockquote>\n<p>> 생성한 ssh키는 로컬 개발환경에서만 사용되어야합니다.<br />\n> 이 디렉토리 내의 *.pem 파일은 gitignore에 추가되어있습니다.</p>\n<p><strong>/keys/README.md</strong></p>\n</blockquote>\n<p><strong>절대 리모트 저장소에 SSH 키를 업로드하지 말자.</strong> 보안 터진다. 물론 이 키로 뭔가 실질적인 인증을 하는 것이 아니라 로컬 개발 서버에서만 사용하기 때문에 뭔가 중요한 걸 털릴 염려는 없지만 그래도 습관이 중요하다. SSH 키는 폭탄 다루듯이 다루자.</p>\n<p>대신 필자는 다른 개발자들이 쉽게 HTTPS 환경을 세팅할 수 있도록 프로젝트 내에 키를 저장하는 디렉토리 내부에 <code class=\"language-text\">README.md</code>를 작성해놓고 이 키가 어떤 용도로 사용될 것인지 주의 사항은 무엇인지 상세하게 적어놓았다.</p>\n<p>그리고 개발할 때는 HTTPS가 아니라 HTTP로 서버를 띄울 일도 생길 수 있으므로 개발 서버를 띄울 때 옵션을 사용하여 프로토콜을 선택할 수 있도록 해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"serve\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=local node server\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"serve:https\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=local node server --https\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// server.js</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// node의 옵션들은 배열 형태로 process.argv에 담겨있다.</span>\n<span class=\"token keyword\">const</span> useHttps <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> val <span class=\"token operator\">===</span> <span class=\"token string\">'--https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isLocal<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> localApp <span class=\"token operator\">=</span> app<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>useHttps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    localApp <span class=\"token operator\">=</span> https<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 아까 생성한 키는 여기서 사용한다!</span>\n      <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./keys/private.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">cert</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./keys/public.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  localApp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> host<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>isHttps <span class=\"token operator\">?</span> <span class=\"token string\">'https://'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'http://'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>host<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">로 가즈아!!!!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이런 식으로 작성해놓으면 개발 서버를 올릴 때 원하는 프로토콜을 자유자재로 변경할 수 있기 때문에, 혹시 내가 개발 서버를 HTTPS로 바꿔놔서 다른 개발자 컴퓨터에서 개발 서버가 안 올라가도 일단 시간을 벌어놓고 버그를 수정할 수 있다.</p>\n<p>원래 진짜 고수는 맞기 전에 맞을 곳을 예상해서 미리 힘을 주고 있는 법이다. <small>(많이 맞아본 1인)</small></p>\n<p>개발 서버를 HTTPS로 띄우면 이제 <code class=\"language-text\">navigator</code> 객체 내부에 이쁘게 들어가있는 <code class=\"language-text\">serviceWorker</code> 객체를 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token operator\">></span> navigator<span class=\"token punctuation\">.</span>serviceWorker\n<span class=\"token operator\">&lt;</span> ServiceWorkerContainer <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">ready</span><span class=\"token operator\">:</span> Promise<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">controller</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">oncontrollerchange</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">onmessage</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h4 id=\"https를-쓰지-않고-문제-회피하기\" style=\"position:relative;\">HTTPS를 쓰지 않고 문제 회피하기<a href=\"#https%EB%A5%BC-%EC%93%B0%EC%A7%80-%EC%95%8A%EA%B3%A0-%EB%AC%B8%EC%A0%9C-%ED%9A%8C%ED%94%BC%ED%95%98%EA%B8%B0\" aria-label=\"https를 쓰지 않고 문제 회피하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>사실 필자도 처음에는 로컬에 HTTPS 붙히기가 귀찮아서 리서치하다가 찾은 얌생이인데, 로컬 서버에서도 HTTPS를 사용하지 않고도 서비스 워커를 사용할 수 있는 방법이 있다.</p>\n<p>Chrome Flag의 <a href=\"chrome://flags/#unsafely-treat-insecure-origin-as-secure\" target=\"_blank\" rel=\"nofollow\">unsafely-treat-insecure-origin-as-secure</a> 설정을 활성화하고 텍스트 필드에 원하는 호스트를 입력해놓으면 해당 호스트는 안전하다고 판단하여 서비스 워커를 사용할 수 있게 해준다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b815361813e64140e4a33b94ccc0a44f/0f586/secure-hack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVR42m2Qy07CQBhGeQti0AjhYlLamRZmesESWgoFpCXGxKVLEx7AvQs3hqWJLHwDVz7icVoSNro4Od+/+W+N8n7G8bjm4yM3rPk8rjgcFiitcMQI4Y4RclxbugrX06YeYTvuH6yhoKG0piwW7MoluyKn2GYUxZJ0viBJKzLm2ZI4nuEHEdEkRusAx5EMbXFqJjyT5amhGIUE+QNyukHEq9rS2AuzGumn5yx0gjRU+cZWPO7feX795unli/3bD1FS0uiKiIttTvMupbk2FBnN5JbWdY9Wu0+r0699WdEZnGh3ueoJvMkGf5KhwhR/usKRioYlfFw9R6pqelpv4BoLw8AJ6dvBvwzMIpZt/mbZ5lTn7F9yj6eT/mq1sAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"secure hack\" title=\"\" src=\"/static/b815361813e64140e4a33b94ccc0a44f/6af66/secure-hack.png\" srcset=\"/static/b815361813e64140e4a33b94ccc0a44f/69538/secure-hack.png 160w,\n/static/b815361813e64140e4a33b94ccc0a44f/72799/secure-hack.png 320w,\n/static/b815361813e64140e4a33b94ccc0a44f/6af66/secure-hack.png 640w,\n/static/b815361813e64140e4a33b94ccc0a44f/d9199/secure-hack.png 960w,\n/static/b815361813e64140e4a33b94ccc0a44f/21b4d/secure-hack.png 1280w,\n/static/b815361813e64140e4a33b94ccc0a44f/0f586/secure-hack.png 1498w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>이렇게 등록한 뒤 하단의 <code class=\"language-text\">Relaunch Now</code> 버튼을 클릭하면 크롬이 재시작되면서 설정이 변경된다. 하지만 이 방법은 스스로 보안 취약점을 만들어 내는 것이기 찜찜해서 결국 사용하지는 않았다.</p>\n<h3 id=\"service-worker-작성\" style=\"position:relative;\">Service Worker 작성<a href=\"#service-worker-%EC%9E%91%EC%84%B1\" aria-label=\"service worker 작성 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이제 개발환경 세팅이 다 끝났다면 이제부터는 딱히 귀찮은 건 없다. 그냥 문서보면서 쭉쭉 작성하면 된다. 일단 서비스 워커의 기능을 구현하기 전에 잘 작동하는 지 부터 확인해야 하므로 아무 내용이 없는 서비스 워커부터 만들었다.</p>\n<p>근데 이것도 <code class=\"language-text\">manifest.json</code>처럼 그냥 웹 어플리케이션과 완전 분리된 <code class=\"language-text\">static/service-worker.js</code>로 따로 작성하면 만들 때는 편하긴 한데, 나중에 서비스 워커에서 웹 어플리케이션에서 사용하고 있는 모듈이나 데이터에 접근하고 싶을 때 굉장히 애매해질 것 같아서 그냥 Webpack을 사용해서 같이 빌드하기로 결정했다.</p>\n<h4 id=\"일단-service-workerjs-파일을-만들자\" style=\"position:relative;\">일단 service-worker.js 파일을 만들자!<a href=\"#%EC%9D%BC%EB%8B%A8-service-workerjs-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EB%A7%8C%EB%93%A4%EC%9E%90\" aria-label=\"일단 service workerjs 파일을 만들자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Webpack으로 빌드한다고 해도 이 친구가 무에서 유를 창조하는 친구는 아니기 때문에 당연히 소스 파일은 있어야 한다. 일단 서비스 워커가 작동하는 것을 보는 것이 목적이므로 심플하게 작성해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// src/service-worker.js</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'저 쪽 테이블에서 보내신 겁니다 -> '</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"service-worker-webpack-plugin-사용하기\" style=\"position:relative;\">Service Worker Webpack Plugin 사용하기<a href=\"#service-worker-webpack-plugin-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"service worker webpack plugin 사용하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">ServiceWorkerWebpackPlugin</code>은 구글에 “Service Worker Webpack”을 검색하면 가장 상단에 나오는 플러그인이다. <a href=\"https://github.com/oliviertassinari/serviceworker-webpack-plugin\" target=\"_blank\" rel=\"nofollow\">깃허브 레파지토리</a>에 가서 다들 구경 한번 해보자.</p>\n<p>README를 읽어보니 사용법이 초간단 그 자체다. 그냥 Webpack 설정에 넣어주면 끝이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// build/webpack.client.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>baseConfig<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServiceWorkerWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../src/service-worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>서비스 워커 파일 경로를 찍어주고 <code class=\"language-text\">ServiceWorkerWebpackPlugin</code> 객체를 생성할 때 초기 인자로 넘겨주면 Webpack 설정의 <code class=\"language-text\">output</code>에 정의된 경로에 <code class=\"language-text\">sw.js</code> 파일을 생성해준다. 물론 이 파일 이름은 변경할 수 있으니 모두 각자의 취향대로 애정을 듬뿍 담은 이쁜 이름을 지어주자. 필자는 귀찮으니까 그냥 <code class=\"language-text\">sw.js</code>로 가기로 했다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 309px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d8c4a05ba385d071d692080e75d2241d/532e8/sw.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVR42oWQy07DMBBF/TlUie24NIkfsWOlkESlXYNYI7Ys+AQ+/DKeVuqilbo4mpE1PnNtoZXH0nkYE1C3CbKNkNsBsktca+kfU3vIJjDCkPC769H5Ec37EebjCL3OMJ8nrmX4obByUD5DDRmi3Xn8fkVYP6CydOhG1Dpch1UhXPu7CR3kc2SE6wP+fiJcpie+LWgOM6oytLFnniyqwsZxLWnuJZR94jBiazySD2gt/VveQ1NsnSeoifo9sbyioUVqnLgvf3sjvQilvQhfEgldhKKLejpLWLiS7LAwepnRnFa+dCMsT95FXvYP50rEEU2GbqEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw\" title=\"\" src=\"/static/d8c4a05ba385d071d692080e75d2241d/532e8/sw.png\" srcset=\"/static/d8c4a05ba385d071d692080e75d2241d/69538/sw.png 160w,\n/static/d8c4a05ba385d071d692080e75d2241d/532e8/sw.png 309w\" sizes=\"(max-width: 309px) 100vw, 309px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>이쁘게 태어난 sw.js</small>\n</center>\n<p>근데 이 방법의 단점이 있는데, 일반적인 서비스 워커보다 파일의 크기가 커진다는 것이다. 아무래도 Webpack으로 빌드하다보니 서비스 워커의 외부에 있는 모듈이나 라이브러리를 끌어오기 때문이다.</p>\n<p>뭐 이건 애초에 필자가 조금 편하게 쓰려고 선택한 상황이니 어쩔 수 없긴하다. 어쨌든 이런 단점이 있으니, 서비스 워커의 크기를 줄이고자 하시는 독자분들은 직접 작성하시는 게 더 좋을 수도 있다.</p>\n<p>이제 서비스 워커의 본체를 만들었으니 이걸 웹 어플리케이션이 초기화될 때 브라우저에 “나 서비스 워커 가지고 있어!”라고 알려주는 일만 남았다.</p>\n<h3 id=\"service-worker-설치\" style=\"position:relative;\">Service Worker 설치<a href=\"#service-worker-%EC%84%A4%EC%B9%98\" aria-label=\"service worker 설치 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>서비스 워커를 설치하는 방법은 간단하다. 이 브라우저에 <code class=\"language-text\">serviceWorker</code> 객체가 지원되는 지 확인한 후 설치하면 된다.</p>\n<p>일반적인 서비스 워커의 설치 방법은 구글의 <a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/?hl=ko\" target=\"_blank\" rel=\"nofollow\">서비스 워커:소개</a> 문서를 보고 따라하면 된다.  필자는 <code class=\"language-text\">ServiceWorkerWebpackPlugin</code>을 사용했기 때문에 해당 플러그인의 문서를 참조하여 작성했다.</p>\n<p>어차피 어떤 방법을 사용하든 설치 자체는 그렇게 어렵지 않다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token comment\">// settings/service-worker.setting.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> isSupported <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>browser <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isSupported<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'서비스 워커가 지원되는 브라우저 입니다.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> runtime <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceworker-webpack-plugin/lib/runtime'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  runtime<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'서비스 워커 설치 성공 ->'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'서비스 워커 설치 실패 ㅜㅜ -> '</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">isSupported</code> 변수에 <code class=\"language-text\">process.browser</code> 값을 검사하는 이유는, 숨고의 어플리케이션은 Next.js나 Nuxt.js처럼 유니버셜 SSR 환경에서 실행되기 때문이다.</p>\n<p>유니버셜 SSR이 뭔지 궁금하신 분은 이전에 작성한 포스팅인 <a href=\"/2018/09/25/universal-ssr\">Universal Server Side Rendering이란?</a>을 한번 읽어보자.</p>\n<p>해당 모듈은 물론 클라이언트 사이드에서만 호출되지만 그래도 혹시 모르니 왠만하면 현재 실행 컨텍스트가 클라이언트인지 서버인지는 체크해주는 것이 좋다. 서버 사이드 렌더링 사이클 때 브라우저 API인 <code class=\"language-text\">navigator</code>에 접근하려고 하면 당연히 에러가 발생한다.</p>\n<p>서비스 워커의 설치가 성공했다면 <a href=\"chrome://inspect/#service-workers\" target=\"_blank\" rel=\"nofollow\">chrome://inspect/#service-workers</a> 또는 <a href=\"chrome://serviceworker-internals\" target=\"_blank\" rel=\"nofollow\">chrome://serviceworker-internals</a>에 여러분의 서비스 워커가 노출될 것이다. 서비스 워커를 적용하는 방법은 사실 굉장히 심플한 편이다.</p>\n<p>근데 사실 필자가 가장 시간을 많이 잡아먹은 부분이 바로 이 서비스 워커였는데, 그 이유는 서비스 워커 공식 문서에 적혀있다.</p>\n<blockquote>\n<p><strong>설치 실패 알림 기능 부족</strong></p>\n<p>서비스 워커가 등록되더라도 <a href=\"chrome://inspect/#service-workers\" target=\"_blank\" rel=\"nofollow\">chrome://inspect/#service-workers</a> 또는 <a href=\"chrome://serviceworker-internals\" target=\"_blank\" rel=\"nofollow\">chrome://serviceworker-internals</a>에 표시되지 않는 경우 오류가 발생했거나 <code class=\"language-text\">event.waitUntil()</code>에 거부된 프로미스를 전달했기 때문에 설치하지 못했을 수 있습니다.</p>\n<p>이 문제를 해결하려면 <a href=\"chrome://serviceworker-internals\" target=\"_blank\" rel=\"nofollow\">chrome://serviceworker-internals</a>로 이동하여 ‘Open DevTools window and pause JavaScript execution on service worker startup for debugging’을 선택하고 설치 이벤트의 시작 위치에 디버거 문을 추가합니다. 이 옵션을 <a href=\"https://developers.google.com/web/tools/chrome-devtools/javascript/breakpoints?hl=ko\" target=\"_blank\" rel=\"nofollow\">확인할 수 없는 예외 시 일시 중지</a>와 함께 사용하면 문제를 찾을 수 있습니다.</p>\n<p><strong>Matt Gaunt</strong> <em>contributor to WebFundamentals</em></p>\n</blockquote>\n<p>아니 이게 디버깅이 진짜 힘들다. 서비스 워커의 설치가 실패했으면 어디서 에러가 났는지, 왜 났는지 보여줘야 하는데 <code class=\"language-text\">Uncaught DomException</code> 하나만 딸랑 보여주고 끝낸다.</p>\n<p>그래서 뭐가 잘못되었는지 하나하나 코드 라인에 <code class=\"language-text\">debugger</code> 찍고 추리해가면서 수정해야하는데 이게 진짜 힘들다. 근데 이걸 또 공식 문서에 디버깅 힘들다고 버젓이 적어놔서 괜히 더 힘든 거 같다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 436px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e57b6ba2e83f7ede90d76af1007b9b33/8574c/conan.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFVklEQVR42i2UW1CU5x3Gv/f9vt1lgbAgsMuyCLscdlGWwy4LLEcBcSEuEBUVMBBMPFAVNRqPoxFzUoxTT9EiMbUaiHaSeiCotUkm6UzbybTptE7bTA9pvelMbtppe5Gr3vz6r+3Ff77v5v19z/v9n+cxdIoX7fSj00MoVzUqqw6V3YJyJ7Dy+8jy9+AtSZAflPfyMczQIYzyE6jwKYyqc6jIJXT0Mrr2Cjr+PQyVHkRnVGJkxbDlxnHkdWJ4n8HKS7C4IERlwMdSn5uKAjc1xT4qK9vIr9lOfmSCRTWHBDSNis9ha54jreM9DJ0ZxcxuwhBF9uwYmTklmL4B7I5FpJiavOwsij0eCnNyCRcVUOP3koj6idUlcda/ha3xHVLbv09Gxw18KwWoctvRnh60dzXKuwbLFcSe6sZm2jC1nXSnU4Bu/Lm5lHk9REsD9NRXsyxcREnTLtJX3MHTPcfyHfe5vPAXUejtRxcMoorG0IGtmIWj2Jx52LSJ3XSgDBNPVibVpX5yMzJorQoysaaNxoYERUt7iW+8zdR7X/KTP/yLS/N/FIUCUAJSpbvRwX2YFW9gebqwGQapKWmERVG0rIhnWmNkP5VOQ7yFgzvGCcWG+daxOT5+9DU3f/w1yRfvkdl6UYClO1Ghg+glk+jwFKrmMvaKVzAMG7HyAKP9XSxPJDl3fB9b+xp5d2o/81ffYvb+Fzz41d8ZmfyUvK4rOOrOYK+dEqCAVOUUuvoCKjqDWX8do+4Wfat3cn5nko+mD/PJjQv89tZpHt86zu9n9zJ7bY4907+juP86joYLOKKnhSEiQvsFWHUWHZlBx66hGm6iW97HWLZA7fpZLh8e5+G53Xx+5SUe357kr/OTzJ1/k/KBm6TEp7HFzmCLnEBXHJVbvogu3iJLqb0qPrqBav4Ae8ddXD33yEl+SO7K2zQOTtPcMczmoVXMHnmO60e24V1+Eav+O9ijp9CiSoUOoEu3o/xjqIK1orDpfWztd3iqe4Hs5D3cyXkat37C0ZlfEl6+k4H+AX50fhcTyxoYro+TVbUNIyyqlh5Gl8kiA5vRhUNoSZVyd2GkJxbI6b2Pu/dDqkYfcmDmEZ8//jeTlx7Q3T3AByfHuXpwkJMTQ7x0+BjNnYN4JSVGYBxdNIL2rUHliY9z2tCLYhKQ3nuUDz9k+9lf89Fv/inzDzaeekR85SH5d3v56gev8OqmJHfeeJ6FM7t5cHEfvX2b5eBaLG8vpgTDXBRHZ1ZjZpRjjLz+c+Z/8Td++qdvOPj2lwTX3cWIXmVs08t8MTPO3RMv8O2JNewfW8uKFeuINA8JqA9DvKolsjorIqAKKZdidNpijJ999Q2nbv6ZqpEf4mx9F3vTFVTsEq66E4wPb2Dr6qdJJAYINW9kSeMwodo+nPntqMxatCssoDIBFUpj5aMdbozW7Z+RJuE2G6/J9qSGImfE4K9hBA9hL53AVbgMf00/JZF+AhUd1LQN4w52Y6SWYaaJKqdPQB5Mew6mlYFhNc9KY3wXM3pBbHASteRl2d4e2d4WHIH1LGnaQHXnJlE3QmXTEA1dz1MQ7sVI8WE6PVj2bCybC9NMRUv2DVV7EV11WmxwDCVZ1sXbnhSEkbeKjMDTRNpHCTaNUBp/lpbujRw4cpZgTY8cdGGzu7Asp8AcMvYnY+iK19HSwrpkxxNz6oL14qmkFG4rJdVJ+ga3sGrDXjpX76Gl5znePDdLXb34zdACTJVrCsyyY2mpO2XJh/5rTv8m9OIhlIB0bqcUbhwlLZ7pi9Kzch3HXz3PkaOn2fXCKE0Nbdgc6f9TJDBLnpaAzP/PfwDrN8WrTqXoQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"conan\" title=\"\" src=\"/static/e57b6ba2e83f7ede90d76af1007b9b33/8574c/conan.png\" srcset=\"/static/e57b6ba2e83f7ede90d76af1007b9b33/69538/conan.png 160w,\n/static/e57b6ba2e83f7ede90d76af1007b9b33/72799/conan.png 320w,\n/static/e57b6ba2e83f7ede90d76af1007b9b33/8574c/conan.png 436w\" sizes=\"(max-width: 436px) 100vw, 436px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>도와줘요 명탐정... 범인말고 내 버그도 찾아줘...</small>\n</center>\n<h2 id=\"제-3-관문-pushmanager\" style=\"position:relative;\">제 3 관문, PushManager<a href=\"#%EC%A0%9C-3-%EA%B4%80%EB%AC%B8-pushmanager\" aria-label=\"제 3 관문 pushmanager permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이제 서비스 워커도 설치했으니 서비스 워커의 <code class=\"language-text\">PushManager</code>만 연동해주면 모든 것이 끝난다! 라고 생각했지만 이 놈도 복병이었다.</p>\n<p><code class=\"language-text\">PushManager</code> 또한 아직 표준이 아니라서 모든 브라우저에서 지원되는 기능이 아니기 때문에 서비스 워커 설치 시 <code class=\"language-text\">PushManager</code>의 존재 여부도 함께 검사해주어야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// settings/service-worker.setting.js</span>\n<span class=\"token keyword\">const</span> isSupported <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>browser <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'PushManager'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>조건의 가독성이 조금 떨어진 것이 마음에 안들지만 일단은 구동 테스트를 하는 것이므로 그냥 넘어갔다. 딱 여기까지 하고나서 다음 스텝을 봤더니…</p>\n<h3 id=\"재앙의-시작\" style=\"position:relative;\">재앙의 시작<a href=\"#%EC%9E%AC%EC%95%99%EC%9D%98-%EC%8B%9C%EC%9E%91\" aria-label=\"재앙의 시작 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<blockquote>\n<p><strong>애플리케이션 서버 키 가져오기</strong></p>\n<p>이 코드랩으로 작업하려면 애플리케이션 서버 키를 몇 개 생성할 필요가 있는데, 도우미 사이트인 <a href=\"https://web-push-codelab.glitch.me/%EC%97%90%EC%84%9C\" target=\"_blank\" rel=\"nofollow\">https://web-push-codelab.glitch.me/에서</a> 생성할 수 있습니다.</p>\n<p>여기서 공개 키 쌍과 비공개 키 쌍을 생성할 수 있습니다.</p>\n<p>다음과 같이 <code class=\"language-text\">scripts/main.js</code>로 공개 키를 복사하여 <code class=\"language-text\">&lt;Your Public Key></code> 값을 바꾸세요.</p>\n<p><code class=\"language-text\">const applicationServerPublicKey = '&lt;Your Public Key>';</code></p>\n<p>참고: 절대로 비공개 키를 웹 앱에 두면 안 됩니다!</p>\n<p><strong>Matt Gaunt</strong> <em><a href=\"https://developers.google.com/web/fundamentals/codelabs/push-notifications/?hl=ko\" target=\"_blank\" rel=\"nofollow\">웹 앱에 푸시 알림 추가</a></em></p>\n</blockquote>\n<p>응…? SSH 키가 필요하다고…? 예상 못하긴 했지만 HTTPS 환경에서 서버와 클라이언트 통신 채널이 하나 더 생기는 것이므로 SSH 키가 필요한 건 맞는 것 같아서 빠르게 인정했다.</p>\n<p>Google의 공식 문서에서 PushManager로 푸시 채널을 구독하는 예제를 살펴봤더니 확실히 SSH 키가 필요하긴 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">subscribeUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> applicationServerKey <span class=\"token operator\">=</span> <span class=\"token function\">urlB64ToUint8Array</span><span class=\"token punctuation\">(</span>applicationServerPublicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  swRegistration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">userVisibleOnly</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">applicationServerKey</span><span class=\"token operator\">:</span> applicationServerKey\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>음 예상은 못했지만 이 정도는 괜찮다. 어차피 <a href=\"https://pusher.com/\" target=\"_blank\" rel=\"nofollow\">Pusher</a>라는 푸시 솔루션을 이미 사용하고 있고 이것도 결국 같은 원리로 작동하기 때문에 내부적으로는 SSH 키쌍을 사용한 인증을 사용했을 것이다.</p>\n<h3 id=\"빠른-손절\" style=\"position:relative;\">빠른 손절<a href=\"#%EB%B9%A0%EB%A5%B8-%EC%86%90%EC%A0%88\" aria-label=\"빠른 손절 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>그렇게 Pusher에서 사용되는 SSH 키가 어디 있는지 찾기를 어언 20분… 결국 못 찾았다.</p>\n<p>Pusher 내부적으로 서버에서 사용하는 <code class=\"language-text\">secret</code> 값과 클라이언트에서 사용하는 <code class=\"language-text\">key</code>를 사용하여 인증을 하는데, 이건 SSH 키쌍이 아니라 그냥 임의의 문자열이었다.</p>\n<p>어차피 SSH 키를 만든다고 해도 웹 푸시에 대한 컨트롤은 백엔드가 가지고 있으므로 필자 혼자 이것저것 건드리면서 테스트 해보기에는 조금 무리가 있다. 게다가 퇴근 시간은 이미 한참 지났기 때문에 백엔드 분들은 퇴근하셨다. <small>(사실 금요일 저녁에 이런 거 하고 있는 사람이 이상한거다.)</small></p>\n<p>이때 이미 필자의 멘탈은 조금 나가있었기 때문에 월요일에 출근해서 모바일 앱에서는 어떻게 Pusher와 FCM을 연동해서 사용하고 있는 지 물어본 후 진행해야겠다고 결론을 내리고 방향을 바꿨다.</p>\n<p>커밋 로그를 보니 이때 시간이 대략 21시 40분 쯤… 아니 그래도 퇴근은 해야하니까… 집에는 가야지…</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4bb0a72bb04f73e4997f67a28c30bbba/e3b18/giveup.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACCElEQVR42nVTSWtyQRB8f9pbQMSLePAm3gRRL+4xl0RBBXEX92hc4hLEPUo0hmjUCtUwId+HGWjmvZmemq6qHu3r6wvX4nQ6oV6vY7Vayf/Hx4esHY/Hn3h8fESj0UAqlUK320W73YZ2uVzwOzgI8Pn5KQnn81nWOBNE5ai15+dnlEol5HI59Hq9fwHV4c1mg2KxiJeXF/mfzWaIRCLw+/2Ix+N4enrC6+ur7HFmdZVKBdFo9Drg+/s7Wq0WRqMRttstbm9vYbFYoNfrcXNzA51OB6/XK7nT6RTNZhN3d3dwu93QCPJ/EJyUh8OhUDGbzQgEAjAajQiHw6hWq0JfVZjP52G1WmGz2aApPX5ryHE4HITKYrFAMBiEw+GQAy6XS6qnQRzz+RzpdFoksdvt0CaTiVCjTvzu9/sYDAbY7/fodDpygEGD6OhyuRTHyYSXZrNZ2bu/v0csFoNG8QuFgriVTCZF9Ewm8wOoAHw+n2jFfO7tdjuhTbq1Wu2nhTRlBmfVg8qc8Xgsjr69vYl2iURCQGkSGamOoLvUmsw0BfZXP7JqAj48PMDpdIp+7Lv1ei3G0WVeRtPYVto1MIYSna+FIBx8NTRJMeBFrI5UDQYDTCbT34AqWCUroJ7lclncJE1qTt34Olgxe5R5V/uQoSpkRXSQutE8GkAt2ch0nxeGQiF4PB5Z/wYETq25vc6tLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"giveup\" title=\"\" src=\"/static/4bb0a72bb04f73e4997f67a28c30bbba/e3b18/giveup.png\" srcset=\"/static/4bb0a72bb04f73e4997f67a28c30bbba/69538/giveup.png 160w,\n/static/4bb0a72bb04f73e4997f67a28c30bbba/72799/giveup.png 320w,\n/static/4bb0a72bb04f73e4997f67a28c30bbba/e3b18/giveup.png 439w\" sizes=\"(max-width: 439px) 100vw, 439px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>역시 아니다 싶으면 빠른 손절이 답이다...</small>\n</center>\n<h2 id=\"제-4-관문-notification-api\" style=\"position:relative;\">제 4 관문, Notification API<a href=\"#%EC%A0%9C-4-%EA%B4%80%EB%AC%B8-notification-api\" aria-label=\"제 4 관문 notification api permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>그래서 바꾼 방향은 “Background 푸시 메세지는 포기하고 Foreground 푸시 메세지라도 제대로 받게 하자”였다.</p>\n<p>이렇게 되면 필자가 처음 생각했던 “브라우저가 꺼져있더라도 푸시 메세지를 보여주고 싶다”는 달성하지 못하지만 브라우저가 켜져있고 soomgo.com에 접속되어 있다면 창을 내려놓든 다른 일을 하고 있든 사용자에게 푸시 메세지는 보여줄 수 있으므로 어느 정도 목적 달성은 된다.</p>\n<p>방향을 바꾸고 나니까 기존의 웹 어플리케이션에 구현되어있던 푸시 로직에 노티피케이션을 보여주는 코드만 추가하면 끝나는 간단한 일이 되었다. 어차피 Pusher를 사용하여 인증, 이벤트 구독 등의 로직은 예전에 채팅 기능 개발할 때 다 만들어 놨기 때문이다.</p>\n<h3 id=\"기존-기능에-notification-끼워넣기\" style=\"position:relative;\">기존 기능에 Notification 끼워넣기<a href=\"#%EA%B8%B0%EC%A1%B4-%EA%B8%B0%EB%8A%A5%EC%97%90-notification-%EB%81%BC%EC%9B%8C%EB%84%A3%EA%B8%B0\" aria-label=\"기존 기능에 notification 끼워넣기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>예전에 채팅 기능을 개발할 때 Pusher SDK를 한번 래핑한 헬퍼 클래스도 만들어 놨었기 때문에 나름 구조도 탄탄하다. 이제 여기에 메소드만 몇개 추가하고 웹 푸시 이벤트가 발생했을 때 알림만 보여주면 된다.</p>\n<p>우선 이 브라우저가 <code class=\"language-text\">Notification</code> API를 지원하는 지 확인하는 메소드가 필요하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// src/helpers/Pusher.js</span>\n<span class=\"token function\">isSupportNotification</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> process<span class=\"token punctuation\">.</span>browser <span class=\"token operator\">&amp;&amp;</span> window <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'Notification'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그 다음 사용자에게 알림에 대한 허가를 받는 메소드를 작성한다. <code class=\"language-text\">Notification</code>은 내부에 <code class=\"language-text\">permission</code> 속성을 가지고 있고 이 속성은 <code class=\"language-text\">granted</code>, <code class=\"language-text\">denied</code>, <code class=\"language-text\">default</code>로 나누어 진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// src/helpers/Pusher.js</span>\n<span class=\"token function\">getNotificationPermission</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isSupportNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isAllowNotification <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'not_supported'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">===</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isAllowNotification <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">!==</span> <span class=\"token string\">'denied'</span> <span class=\"token operator\">||</span> Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">===</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Notification<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isAllowNotification <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">granted</code>는 사용자가 이미 알림을 허용한 상태, <code class=\"language-text\">denied</code>는 거부한 상태, <code class=\"language-text\">default</code>는 아직 알림에 대한 퍼미션을 줄지말지 사용자가 결정을 하지 않은 상태이다.</p>\n<p>따라서 우리는 퍼미션이 <code class=\"language-text\">default</code> 상태일 때 <code class=\"language-text\">Notification.requestPermission</code> 메소드를 사용하여 사용자에게 알림 노출에 대한 허가를 받아야 한다.</p>\n<p>이제 실제로 알림창을 띄워줄 메소드를 작성해보자. <code class=\"language-text\">Notification</code> API 자체가 워낙 심플하다보니 그닥 어렵지 않다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">createForegroundNotification</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> body<span class=\"token punctuation\">,</span> icon<span class=\"token punctuation\">,</span> link <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> notification <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Notification</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    body<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> icon <span class=\"token operator\">||</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>AssetsCloudFrontHost<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/app_icons/1x.png</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  notification<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onshow</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> notification<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  notification<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  notification<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">,</span> <span class=\"token string\">'_blank'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">new</code> 키워드를 사용하여 <code class=\"language-text\">Notification</code> 객체를 생성하면 그 즉시 OSX는 화면 우측 상단에, Windows는 우측 하단에 알림 메세지가 노출된다. 그 다음 생성한 <code class=\"language-text\">Notification</code> 객체의 <code class=\"language-text\">onshow</code>, <code class=\"language-text\">onclick</code> 등의 이벤트 리스너에 핸들러를 등록해주면 된다.</p>\n<p>메소드 명은 Background 메세징을 실현하지 못한 필자의 슬픔을 담아 <code class=\"language-text\">createForegroundNotification</code>으로 결정했다. 굳이 Foreground를 강조한 이유는 언젠가 <code class=\"language-text\">createBackgroundNotification</code> 메소드를 만들겠다는 필자의 야망을 담았다.</p>\n<p>이제 필요한 모든 것을 만들었으니 Pusher SDK에서 Web Socket을 통해 푸시를 보낼 때마다 알림이 작동하도록 연결만 해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token function\">subscribeNotification</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isSupportNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getNotificationPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isAllowNotification<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPrivateUserChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">channel</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myUserId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> targetChatRoute <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>provider <span class=\"token operator\">?</span> <span class=\"token string\">'chats'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'pro/chats'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createForegroundNotification</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">님이 메세지를 보냈어요.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>profile_image<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">link</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>location<span class=\"token punctuation\">.</span>origin<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>targetChatRoute<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token punctuation\">.</span>chat<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Pusher SDK는 푸시 채널에 이벤트 핸들러를 바인딩할 수 있는 기능을 제공해준다. <code class=\"language-text\">message</code> 이벤트는 사용자가 채팅 메세지를 받았을 때 호출되는 이벤트이다. 단 자기 자신이 보낸 메세지에도 여과없이 이벤트가 호출되므로 <code class=\"language-text\">response.sender.id === this.myUserId</code> 조건을 통해 자신이 보낸 메세지에는 알림을 보여주지 않도록 처리하였다.</p>\n<p>그 다음은 이제 사용자가 작은 알림 메세지만 보고도 어떤 상황이 벌어지는 것인지 쉽게 알 수 있도록 “OOO님이 메세지를 보냈어요”라는 형식의 제목과 메세지의 내용, 상대방의 프로필 사진을 사용하여 <code class=\"language-text\">Notification</code> 객체를 생성하면 끝이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 499px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/32c54805c2f49dd0192728224f674405/119c7/push.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.12499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVR42o1R3WuSURh//6cgGOh01YVm+qrDm2mWi6gb16K6qGW4BVpBFwVtXQZhSdNXC+bqIvDGa8UPChkEsiFuil/z8/34dc5598Y0lj3w45zznOfj93sezmAwQINer4dOp4OR3C8sLKj++XmG+VMwGo0TUPPVP46320Fhdzjg8VyFz+eDjbfBcPESLDzP/DZyOhxO8DbyJrEWiwVms5nBZDLh8hUrzFYrXC4XuHPn50AxpzMgFH6G1E4Kd+77EVy9jrXAAzwKbuDh4wCC6xsIhcIIh8Ok6Q243W5CwIMlQuJ9LIrk1y94+eo1uDebm6DY2nqLSCQCYTuGa6u3cfPeEu6u3EJg/SnWngTg969g2bcMr9cLnrfDubgIp5OwJgrefYpC+LaD0Ivn4IrFIigKhQKy2SxyuRx2d1OIfPiIWDyBRDJJzjhiyc+IJgTEY3EkiS9OfIlEAoIgQCDndjyGdDoNDrNMUdgh12rA/gFq7Sb2qwfMNx6PIcvyH1Dj6EUhSadBfZIkqRBFSCSwWSoB5TL2jmoo/dqDSP7q9To6nQ7a7Ta63S5GoxG46UJaJ+WEmXaXacyUf1KIWoM77vVYIGWjBQ+HQ9ax3++j1Wqxt6pbnhjDtDImuU8LkgedhxZUJtLy+TxbUCaTQaVS+Yv1Wca1JBFNcYy+IrPO/5P0z4LfW4co9No4Gg9PVMlMJh00RbPZnNmEjktTyA3IFkeKhAFhShPpJ5WqgUoXScxZi6BGG1erVbXgMRl8/ucPHDYabAmUIQ1okLe28VlG2Q0GA1bwN33ZqDFqNl5aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"push\" title=\"\" src=\"/static/32c54805c2f49dd0192728224f674405/119c7/push.png\" srcset=\"/static/32c54805c2f49dd0192728224f674405/69538/push.png 160w,\n/static/32c54805c2f49dd0192728224f674405/72799/push.png 320w,\n/static/32c54805c2f49dd0192728224f674405/119c7/push.png 499w\" sizes=\"(max-width: 499px) 100vw, 499px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>필자의 멘탈 상태를 여과없이 보여주는 메세지...잉잉...</small>\n</center>\n<p>어쨌든 이렇게 해서 브라우저에 soomgo.com이 열려있다면 사용자들은 다른 일을 하다가 계속 페이지를 확인하거나 핸드폰을 확인할 필요없이 데스크탑 내에서 새로운 채팅 메세지를 바로 확인할 수 있게 되었다.</p>\n<p>아직도 Background 상태에서 푸시 메세지를 바로 보여주지 못했다는 게 아쉽긴 하다. 하지만 이 정도만 해도 사용자들 입장에서는 꽤나 편할 것이라고 생각한다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>사실 처음 목표했던 걸 다 이루진 못해서 찝찝했지만 너무 피곤했기 때문에 다음을 기약하기로 했다. 이제 월요일에 출근해서 PO한테 이걸 보여주고 혹시 뭐 추가하고 싶은 거 없는지 물어보고 몇가지 테스트를 좀 해본 후 배포할 예정이다.</p>\n<p>서비스 워커에 <code class=\"language-text\">fetch</code> 이벤트 핸들러를 추가하면 Add to Homescreen 기능도 사용할 수 있지만 사실 숨고의 프론트엔드 챕터 공식 입장은 사용자들이 모바일 웹보다는 모바일 앱을 많이 사용했으면 하는 것이기 때문에 이건 할까말까 고민 중이다. <small><del>(인앱 브라우저 크로스브라우징 하기 싫…)</del></small></p>\n<p>일단 처음 스코프를 너무 크게 잡은 것 같기도 하다. 하나하나 좀 자세히 알아보고 작업을 했으면 좋았을 것 같은데 월요일부터는 바로 또 하던 프로젝트 작업을 다시 해야해서 마음이 급했던 것도 있다. 그리고 회사에 프론트엔드 개발자가 부족하기 때문에 이런 기술적인 기능을 붙히는 건 우선 순위가 낮은 편이라서 “지금 아니면 앞으로 언제 할 수 있을 지 모른다”라는 마음도 컸던 것 같다.</p>\n<p>막간을 이용해, 필자와 함께 일해주실 <a href=\"https://www.wanted.co.kr/wd/14044\" target=\"_blank\" rel=\"nofollow\">프론트엔드 개발자 분을 모신다는 JD</a>를 뿌리면서 포스팅을 마무리 하겠다.</p>\n<p>PWA 외에도 다른 하고 싶은 건 많은데 프론트엔드 개발자가 모자라서 못하고 있기 때문에 경력 여하와 상관없이 그냥 재밌는 거 좋아하시는 분이면 된다.<small>(하고 싶은 개발 다 하실 수 있도록 이 한몸 불살라 보필하겠습니다.)</small></p>\n<p>이상으로 PWA 하루 만에 도입하기 포스팅을 마친다.</p>","fields":{"slug":"20190706-pwa-with-notification","path":"/2019/07/06/pwa-with-notification/","lang":"ko"},"frontmatter":{"title":"PWA 하루만에 도입하기","subTitle":"서비스 워커, 웹 푸시, 캐싱까지 – PWA 도입 삽질기","date":"Jul 06, 2019","categories":["프로그래밍","웹","튜토리얼"],"tags":["JavaScript","자바스크립트","Web Push","Web Socket","socket.io","Notification API","Vue","PWA","Progressive Web Application"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/ca7838e0f08103b712d883b16d280e71/d803c/thumbnail.png","srcSet":"/static/ca7838e0f08103b712d883b16d280e71/d803c/thumbnail.png 320w,\n/static/ca7838e0f08103b712d883b16d280e71/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/ca7838e0f08103b712d883b16d280e71/fc5c5/thumbnail.webp 320w,\n/static/ca7838e0f08103b712d883b16d280e71/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/ca7838e0f08103b712d883b16d280e71/01fb2/thumbnail.png","srcSet":"/static/ca7838e0f08103b712d883b16d280e71/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/ca7838e0f08103b712d883b16d280e71/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"f69a2e74-d6a6-5489-bb38-a3026e949bf9","tableOfContents":"<ul>\n<li>\n<p><a href=\"#vue-server-side-rendering%EC%9D%98-%EA%B5%AC%EC%A1%B0\">Vue Server Side Rendering의 구조</a></p>\n</li>\n<li>\n<p><a href=\"#server-side-rendering\">Server Side Rendering</a></p>\n<ul>\n<li><a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EA%B0%80-%EC%84%9C%EB%B2%84%EC%97%90-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%9A%94%EC%B2%AD\">클라이언트가 서버에 리소스 요청</a></li>\n<li><a href=\"#nginx%EA%B0%80-express%EA%B0%80-%EB%9D%84%EC%9B%8C%EC%A0%B8%EC%9E%88%EB%8A%94-%ED%8F%AC%ED%8A%B8%EB%A1%9C-%EC%9A%94%EC%B2%AD%EC%9D%84-%EC%84%9C%EB%B9%99\">nginx가 Express가 띄워져있는 포트로 요청을 서빙</a></li>\n<li><a href=\"#express-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%8B%9C%EC%9E%91\">Express 라우팅 시작</a></li>\n<li><a href=\"#code-classlanguage-textserver-entryjscode-%EC%8B%A4%ED%96%89\"><code class=\"language-text\">server-entry.js</code> 실행</a></li>\n<li><a href=\"#%EC%84%9C%EB%B2%84%EC%9D%98-code-classlanguage-textvue-routercode-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A7%84%ED%96%89\">서버의 <code class=\"language-text\">vue-router</code> 라우팅 진행</a></li>\n<li><a href=\"#vue-server-renderer%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-html-%EB%A0%8C%EB%8D%94%EB%A7%81\">vue-server-renderer를 사용하여 HTML 렌더링</a></li>\n<li><a href=\"#%EC%84%9C%EB%B2%84%EA%B0%80-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EB%A1%9C-%EC%9D%91%EB%8B%B5\">서버가 클라이언트로 응답</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#client-rendering\">Client Rendering</a></p>\n<ul>\n<li><a href=\"#code-classlanguage-textclient-entryjscode-%EC%8B%A4%ED%96%89\"><code class=\"language-text\">client-entry.js</code> 실행</a></li>\n<li><a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%B4%88%EA%B8%B0%ED%99%94-%ED%95%A8%EC%88%98-%EC%8B%A4%ED%96%89\">클라이언트 어플리케이션 초기화 함수 실행</a></li>\n<li><a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EC%9D%98-code-classlanguage-textvue-routercode-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A7%84%ED%96%89\">클라이언트의 <code class=\"language-text\">vue-router</code> 라우팅 진행</a></li>\n<li><a href=\"#appmount---%EB%A0%8C%EB%8D%94-%EC%A2%85%EB%A3%8C-vue-%EB%9D%BC%EC%9D%B4%ED%94%84%EC%82%AC%EC%9D%B4%ED%81%B4-%EC%8B%9C%EC%9E%91\">app.$mount -> 렌더 종료. Vue 라이프사이클 시작</a></li>\n</ul>\n</li>\n</ul>","excerpt":"이번 포스팅에서는 Universal Server Side Rendering에 이어서 VueJS의 공식 라이브러리인 와 Express를 사용하여 SSR(Server Side Rendering) 어플리케이션을 개발한 과정과 운영 환경에서 생겼던 문제, 그리고 그 문제를 어떻게 해결했는지 적어보려고 한다.","html":"<p>이번 포스팅에서는 <a href=\"/2018/09/25/universal-ssr\">Universal Server Side Rendering</a>에 이어서 VueJS의 공식 라이브러리인 <code class=\"language-text\">vue-server-renderer</code>와 Express를 사용하여 SSR(Server Side Rendering) 어플리케이션을 개발한 과정과 운영 환경에서 생겼던 문제, 그리고 그 문제를 어떻게 해결했는지 적어보려고 한다.</p>\n<!-- more -->\n<p>필자는 Frontend 개발자로 일하면서 Backend 프레임워크를 건드릴 일이 사실 거의 없었다. 그러나 필자의 현 직장에 SSR 서버를 필자가 도입하자고 주장하였고, 따라서 오너쉽도 필자에게 있었기 때문에 클라이언트 환경과 전혀 다른 서버의 작동방식과 여러 문제점에 대해서 상세하게 알고 있어야 할 필요가 있었다.</p>\n<p>보통 Frontend 개발자는 클라이언트에서 작동하는 어플리케이션을 개발하기 때문에 서버에서 작동하는 어플리케이션에서 발생할 수 있는 <small>(조금만 생각해보면 당연한)</small>문제에 대해서 의외로 쉽게 놓치고 지나갈 수 있다고 생각한다.</p>\n<p>그래서 두번 다시 이런 실수를 반복하지 않도록 문서로 정리를 하고 회고하려고 한다.</p>\n<p>먼저 Vue SSR의 렌더링 과정을 전체적으로 살펴본 후, 서버단 렌더링과 클라이언트단 렌더링을 나눠서 다시 살펴본다.</p>\n<blockquote>\n<p>이 포스팅에 예제로 나와있는 코드는 현 직장의 비즈니스 로직 때문에 생략된 부분이 있기 때문에 코드를 복사붙혀넣기해도 작동하지않을 수 있습니다.</p>\n</blockquote>\n<h2 id=\"vue-server-side-rendering의-구조\" style=\"position:relative;\">Vue Server Side Rendering의 구조<a href=\"#vue-server-side-rendering%EC%9D%98-%EA%B5%AC%EC%A1%B0\" aria-label=\"vue server side rendering의 구조 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>필자는 Nuxt.js를 사용하지 않고 보일러플레이트를 사용해서 약간 개선해서 구현했다. 처음에는 ‘그냥 Nuxt쓸걸…’이라고 후회하기도 했지만 그래도 덕분에 Universal SSR의 실행 과정을 더 깊게 알아볼 수 있는 좋은 기회였다고 생각한다.<small><del>(라고 삽질을 포장해본다)</del></small></p>\n<p>해당 포스팅에서는 필자가 작성했던 SSR 어플리케이션의 초기화 과정에 대해서 함수단위까지 자세하게 기재하려고 한다. 먼저 어플리케이션의 렌더링 과정은 다음과 같다. 이후 각 과정에 대한 자세한 설명을 후술하도록 하겠다.</p>\n<hr>\n<ol>\n<li>클라이언트가 서버에 리소스 요청</li>\n<li>nginx가 Express가 띄워져있는 포트로 요청을 서빙</li>\n<li>Express 라우팅 시작</li>\n<li><code class=\"language-text\">server-entry.js</code> 실행</li>\n<li>서버의 <code class=\"language-text\">vue-router</code> 라우팅 진행</li>\n<li>vue-server-renderer를 사용하여 HTML 렌더링</li>\n<li>서버가 클라이언트로 응답</li>\n<li><code class=\"language-text\">client-entry.js</code> 실행</li>\n<li>클라이언트 어플리케이션 초기화 함수 실행</li>\n<li>클라이언트의 <code class=\"language-text\">vue-router</code> 라우팅 진행</li>\n<li><code class=\"language-text\">app.$mount</code></li>\n</ol>\n<hr>\n<p>1번 요청과 7번 응답을 제외한 <code class=\"language-text\">2-6</code>번 까지는 서버에서 일어나는 과정이고 <code class=\"language-text\">8-10</code>번 까지는 클라이언트에서 일어나는 과정이다. 특이한 점은 서버와 클라이언트의 엔트리 포인트가 다르다는 것이다.</p>\n<p>그리고 후술하겠지만 이 엔트리 포인트들은 몇가지 같은 함수를 공유하며 사용한다. <code class=\"language-text\">router.onReady</code>나 <code class=\"language-text\">createApp</code> 같은 함수들이 그렇다. 애초에 Universal SSR은 기본적으로 첫 요청만 서버 사이드 렌더링하고 이후는 SPA처럼 작동하게 하자. 그리고 코드는 서버랑 클라이언트에서 재사용가능하게 하자는 개념이다. 그래서 편한 면도 있지만 실행 타이밍이나 환경이 같은 함수라도 완전 달라질 수 있기 때문에 별도의 예외처리를 해줘야 하는 등 헷갈리는 부분도 많았다.</p>\n<p>그리고 이 두개의 엔트리포인트가 서버와 클라이언트에서 실행될 때 서로 다른 초기화과정을 거치는데, 서버에서 초기화를 하고 클라이언트에서 싹 다 처음부터 다시 초기화를 진행하게 되면 비효율적이므로 몇가지 방법을 사용하여 최대한 효율적으로 렌더를 수행한다.</p>\n<p>먼저 서버 사이드 렌더링부터 살펴보자.</p>\n<h2 id=\"server-side-rendering\" style=\"position:relative;\">Server Side Rendering<a href=\"#server-side-rendering\" aria-label=\"server side rendering permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"클라이언트가-서버에-리소스-요청\" style=\"position:relative;\">클라이언트가 서버에 리소스 요청<a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EA%B0%80-%EC%84%9C%EB%B2%84%EC%97%90-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%9A%94%EC%B2%AD\" aria-label=\"클라이언트가 서버에 리소스 요청 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>클라이언트에서 서버로 요청을 보낸다.</p>\n<h3 id=\"nginx가-express가-띄워져있는-포트로-요청을-서빙\" style=\"position:relative;\">nginx가 Express가 띄워져있는 포트로 요청을 서빙<a href=\"#nginx%EA%B0%80-express%EA%B0%80-%EB%9D%84%EC%9B%8C%EC%A0%B8%EC%9E%88%EB%8A%94-%ED%8F%AC%ED%8A%B8%EB%A1%9C-%EC%9A%94%EC%B2%AD%EC%9D%84-%EC%84%9C%EB%B9%99\" aria-label=\"nginx가 express가 띄워져있는 포트로 요청을 서빙 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>보통 nodeJS를 사용하여 서버를 개발할 때 <code class=\"language-text\">node server.js</code>와 같은 명령어로 바로 서버를 띄우는 경우는 드물고 보통 Nginx나 Apache와 같은 서버 엔진을 같이 사용한다.\n그 이유는 다음과 같다.</p>\n<hr>\n<ol>\n<li>서버 엔진 소프트웨어의 특성 상 nodeJS보다 더 빠른 Static file serving이 가능하다. 그리고 그런 요청을 nodeJS까지 보내지 않고 엔진단에서 처리되므로 백엔드의 부하가 분산된다.</li>\n<li>Node.js의 창시자인 Ryan Dahl이 “You just may be hacked when some yet-unknown buffer overflow is discovered. Not that that couldn’t happen behind nginx, but somehow having a proxy in front makes me happy” 라는 말을 한 적이 있음. 즉, 아직 발견되지 않은 취약점에 의한 공격을 어느 정도 방지할 수 있다는 뜻이다.</li>\n</ol>\n<hr>\n<p>그래서 대략 다음과 같은 nginx config를 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">server_name</span> example.com</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> X-Real-IP <span class=\"token variable\">$remote_addr</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> Host <span class=\"token variable\">$http_host</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> X-NginX-Proxy true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://127.0.0.1:3000/</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">proxy_redirect</span> <span class=\"token boolean\">off</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token directive\"><span class=\"token keyword\">gzip</span> <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_comp_level</span> <span class=\"token number\">2</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_proxied</span> any</span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_min_length</span>  <span class=\"token number\">1000</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_disable</span>     <span class=\"token string\">\"MSIE [1-6]\\.\"</span>\n  gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>요청이 80 포트로 들어오면 <code class=\"language-text\">node server.js</code>로 실행된 nodeJS 서버가 대기하고 있는 3000 포트로 포워딩 해준다.</p>\n<p>그리고 사실 nodeJS 서버를 실행시킬 때 <code class=\"language-text\">pm2</code>나 <code class=\"language-text\">forever</code>와 같은 프로세스 관리자를 사용해서 실행시키는 편이 좋은데, 이 내용은 다음 포스팅에 <strong>언젠가</strong> 작성하겠다. 참고로 필자는 <code class=\"language-text\">pm2</code>를 사용 중이다.</p>\n<h3 id=\"express-라우팅-시작\" style=\"position:relative;\">Express 라우팅 시작<a href=\"#express-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%8B%9C%EC%9E%91\" aria-label=\"express 라우팅 시작 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이렇게 들어온 요청은 nodeJS서버인 <code class=\"language-text\">server.js</code>에서 처리하게 된다. <code class=\"language-text\">server.js</code>에는 Vue 코드는 없고 nodeJS로 작성된 Express 프레임워크의 코드가 작성되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createRenderer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">bundle<span class=\"token punctuation\">,</span> template</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vue-server-renderer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createBundleRenderer</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   template<span class=\"token punctuation\">,</span>\n   <span class=\"token literal-property property\">runInNewContext</span><span class=\"token operator\">:</span> <span class=\"token string\">'once'</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> bundle <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/vue-ssr-bundle.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> template <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> <span class=\"token function\">createRenderer</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./src/express/views'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'view engine'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ejs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/ping'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">health check from ELB</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'healthCheck'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> bundle <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/vue-ssr-bundle.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> template <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> <span class=\"token function\">createRenderer</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>renderer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;pre>렌더링 중 입니다 뿜뿜&lt;/pre>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">cookie</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>cookies <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>context<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">errorLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[ERR] context url is not exist!!'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 렌더 스트림 진행</span>\n  <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">renderToStream</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>필자는 Express를 사용했기 때문에 당연히 Express의 라우터를 사용했다. 그러나 실질적인 라우팅은 Vue가 진행하기 때문에 Express에서는 <code class=\"language-text\">app.get('*')</code>과 같이 와일드카드를 사용하여 모든 요청에 대한 콜백 함수를 실행하도록 한다.</p>\n<p>중간에 보면 <code class=\"language-text\">app.get('/ping')</code>이라는 코드도 있는데 저건 AWS의 Elastic Beanstalk의 Health Check 때문에 별도로 작성한 라우터이다. ELB에서는 현재 환경이 제대로 작동하고 있는지를 체크하려고 그 환경에 속한 인스턴스들의 특정 URL로 주기적으로 ping을 날린다. 이 URL은 ELB의 설정에서 바꿔줄 수 있고, 필자는 <code class=\"language-text\">/ping</code>이라는 URL로 설정했다.</p>\n<p>굳이 이 라우터를 따로 나눈 이유는 <code class=\"language-text\">vue-ssr-renderer</code>의 render 함수가 많이 실행될 수록 메모리에 올라가는 HTML 템플릿이 많아질 것이고 그렇게 됨으로써 결국 렌더 과정에 병목이 발생하기 때문에 <code class=\"language-text\">vue-ssr-renderer</code>를 실행시키지 않고 Express만으로 간단한 페이지를 응답으로 보내주게 해놓은 것이다.</p>\n<p>Express 라우팅과 밑에서 설명할 <code class=\"language-text\">vue-router</code>의 라우팅이랑 헷갈릴 수 있는데, 방금 설명한 대로 실질적인 라우팅은 Vue에서 진행하게 되지만 요청을 Express에서 먼저 받아 처리한 후에 Vue로 넘겨주는 순서이기 때문에 Express에서도 라우팅을 해줘야한다. 라우팅 후 마지막 줄의 <code class=\"language-text\">renderToStream</code> 메소드가 실행되고나면 Vue에서 진행되는 라우팅과 렌더링을 시작하게 된다.</p>\n<p>이제 <code class=\"language-text\">app.get('*')</code> 라우터 내부를 자세하게 설명한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>renderer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;pre>렌더링 중 입니다 뿜뿜&lt;/pre>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">cookie</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>cookies <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>context<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">errorLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[ERR] context url is not exist!!'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">renderToStream</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  stream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* @desc\n     * vue-meta 플러그인을 사용하면 컴포넌트에 선언되어있는 metaInfo 메소드에서 반환한 값을 받아올 수 있다.\n     * https://github.com/declandewet/vue-meta 참고할 것\n     */</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">,</span> link<span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">,</span> noscript<span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span><span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    context<span class=\"token punctuation\">.</span>head <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>meta<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>link<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>style<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>script<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>noscript<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">렌더 중 에러 발생</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 에러 페이지를 보여주는 등의 에러 핸들링 로직이 위치한다.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">렌더링 종료</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 라우팅에서 가장 중요한 부분은 <code class=\"language-text\">renderToStream</code> 메소드의 역할이다.</p>\n<p><code class=\"language-text\">vue-ssr-renderer</code>는 <code class=\"language-text\">renderToString</code>과 <code class=\"language-text\">renderToStream</code>이라는 2가지 렌더 함수를 가지고 있다.</p>\n<p><code class=\"language-text\">renderToString</code>은 모든 렌더가 끝나면 렌더된 HTML을 string의 형태로 반환하고 그 이후 클라이언트로 HTML을 한번에 반환한다. 때문에 렌더 속도가 오래 걸리게 되면 유저는 빈 화면을 보고 있을 수 밖에 없다. 또한 데이터를 한번에 내려주기 때문에 HTML 렌더를 진행할 때 내용을 전부 다 메모리에 올려야한다는 단점이 있다. HTML의 크기가 작으면 문제가 되지 않겠지만 파일의 크기가 커질 수록 매 렌더링 시 메모리 공간을 많이 잡아먹는다.</p>\n<p><code class=\"language-text\">renderToStream</code>은 한 이벤트가 끝날때마다 nodeJS의 <code class=\"language-text\">ReadableStream</code> 객체를 반환한다. <a href=\"https://nodejs.org/api/stream.html\" target=\"_blank\" rel=\"nofollow\">stream</a>은 데이터를 일정한 chunk단위로 불러오고 <code class=\"language-text\">on</code> 메소드를 사용한 이벤트 콜백 호출로 stream을 관리할 수 있는 nodeJS의 기능이다. data이벤트는 각 chunk가 <code class=\"language-text\">readable</code>상태가 될때마다 호출되며 모든 데이터를 불러왔다면 <code class=\"language-text\">end</code>이벤트가 호출된다. 이 <a href=\"https://nodejs.org/api/stream.html\" target=\"_blank\" rel=\"nofollow\">stream</a>에 관한 내용은 추후 다른 포스트에서 <strong>언젠가</strong> 설명하도록 하겠다.</p>\n<h3 id=\"code-classlanguage-textserver-entryjscode-실행\" style=\"position:relative;\"><code class=\"language-text\">server-entry.js</code> 실행<a href=\"#code-classlanguage-textserver-entryjscode-%EC%8B%A4%ED%96%89\" aria-label=\"code classlanguage textserver entryjscode 실행 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">renderToStream</code>함수가 실행되면 <code class=\"language-text\">vue-server-renderer</code>는 서버 쪽 엔트리 파일인 <code class=\"language-text\">server-entry.js</code>파일을 찾게된다. 이 파일에서는 <code class=\"language-text\">app.js</code>에 있는 팩토리 함수를 사용하여 app 객체를 생성하고 몇가지 초기화 과정을 거친 뒤 라우팅을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 팩토리 함수 import</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token parameter\">context</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 해당 프로미스에서 resolve되면 router.push가 호출된 후에도 stream이 계속 진행되고</span>\n    <span class=\"token comment\">// 해당 프로미스에서 reject되면 stream의 error이벤트가 호출된다.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 파일의 코드를 설명하기 위해서는 상단에 import된 <code class=\"language-text\">createApp</code> 함수에서 반환된 <code class=\"language-text\">app</code>, <code class=\"language-text\">store</code>, <code class=\"language-text\">router</code>가 뭔지 알고 있는 게 좋으므로, 자세히 살펴보기 전에 맨 위에서 import된 <code class=\"language-text\">createApp</code> 팩토리 함수를 먼저 살펴보자.</p>\n<p><code class=\"language-text\">createApp</code> 함수는 <code class=\"language-text\">Vue</code> 인스턴스, <code class=\"language-text\">VueRouter</code> 인스턴스, Vuex의 <code class=\"language-text\">Store</code> 인스턴스를 반환하는 팩토리 함수이다. 이후 이 팩토리 함수는 <code class=\"language-text\">client-entry</code>에도 재사용되어 초기화를 진행하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App.vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Store <span class=\"token keyword\">from</span> <span class=\"token string\">'./stores'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./router'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">Store</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> router<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">render</span><span class=\"token operator\">:</span> <span class=\"token parameter\">h</span> <span class=\"token operator\">=></span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span>App<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      app<span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>일반적으로 클라이언트에서 Vue를 초기화하는 코드와 비슷하지만 다른 부분이 하나 있는데, <code class=\"language-text\">Store</code>와 <code class=\"language-text\">Router</code> 인스턴스를 팩토리 함수를 사용해서 생성한다는 점이다. 보통 SPA 어플리케이션에서는</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">el</span><span class=\"token operator\">:</span> <span class=\"token string\">'#app'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">components</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> App <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;App/>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">router</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VueRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">store</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vuex<span class=\"token punctuation\">.</span>Store</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이런 식으로 <code class=\"language-text\">Vue</code> 인스턴스를 생성한다. 하지만 이 로직을 그대로 서버에서 사용하기엔 문제가 하나 있다.</p>\n<p>문제는 <code class=\"language-text\">export default</code>로 Call by Reference 평가전략을 사용하는 자료형을 반환하게 될 때 발생한다. <code class=\"language-text\">new Vue()</code>에서 호출하는 <code class=\"language-text\">Vue</code>는 인스턴스를 반환하는 클래스같이 작동하기 때문에 해당 코드는 최종적으로 <code class=\"language-text\">Vue</code> 인스턴스가 올라간 메모리 주소를 반환하게 되는데, 이 로직은 클라이언트에서는 딱히 문제가 없지만 서버에서는 문제가 발생할 수 있다.</p>\n<p>클라이언트와 다르게 서버는 한번 올라가면 오랜 시간동안 계속 돌아가는 프로그램이라는 것이다. 현재 서버에 접속해있는 유저들이 <code class=\"language-text\">Store</code>의 상태를 공유하면 안되기 때문에 서버는 각 요청에 대해서 새로운 <code class=\"language-text\">Store</code>와 <code class=\"language-text\">Vue</code> 인스턴스를 생성해야한다.</p>\n<p>하지만 위의 코드에서 <code class=\"language-text\">export</code>하는 것은 결과적으로 <code class=\"language-text\">Vue</code> 인스턴스의 메모리 포인터이고 위 모듈이 <code class=\"language-text\">import</code> 될때 이 모듈은 처음 한번만 <code class=\"language-text\">Vue</code> 인스턴스를 생성하고 이후는 참조해야하는 메모리 포인터, 즉 <strong>같은 인스턴스</strong>를 반환하게 된다.</p>\n<p>그렇기 때문에 서버 사이드 렌더링 때는 상태가 오염되는 것을 피하기 위해, 인스턴스의 메모리 포인터가 아닌 팩토리 함수를 노출시키고 매번 새로운 인스턴스를 생성해 반환하는 방법으로 작성하여야 한다.</p>\n<p>필자는 이 사실을 놓쳐서 유저들이 <code class=\"language-text\">Store</code> 내부의 세션을 공유하게 되서 내 계정으로 로그인했지만 다른 사람 계정으로 로그인되버리는 버그를 생성한 적이 있다. 지금 생각해도 아찔한 순간이다.</p>\n<blockquote>\n<p>A Node.js server is a long-running process. When our code is required into the process, it will be evaluated once and stays in memory.\n…\nSo, instead of directly creating an app instance, we should expose a factory function that can be repeatedly executed to create fresh app instances for each request.</p>\n<p><strong>Vue SSR Guide</strong> <em>Avoid Stateful Singletons</em></p>\n</blockquote>\n<p>심지어 이렇게 <a href=\"https://ssr.vuejs.org/guide/structure.html#avoid-stateful-singletons\" target=\"_blank\" rel=\"nofollow\">공식 문서</a>에도 버젓히 적혀있는 걸 놓쳐서 엄청난 버그를 내고 말았다. 공식 문서를 반드시 읽읍시다! 두번 세번 읽읍시다!</p>\n<p>자, 이제 <code class=\"language-text\">createApp</code>를 살펴보았으니 다시 <code class=\"language-text\">server-entry.js</code>로 돌아와서 해당 파일에 대한 설명을 계속 이어가겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 팩토리 함수 import</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">TOKEN_KEY</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/constants'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SET_TOKEN</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DESTROY_TOKEN</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/stores/auth/config'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> APIAuth <span class=\"token keyword\">from</span> <span class=\"token string\">'src/api/auth'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token parameter\">context</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> router<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 새로운 앱 생성</span>\n    <span class=\"token keyword\">const</span> cookies <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>cookie<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> authToken <span class=\"token operator\">=</span> cookies<span class=\"token punctuation\">[</span><span class=\"token constant\">TOKEN_KEY</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 요청을 보낸 클라이언트의 쿠키에 있는 토큰</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">next</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      router<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> APIAuth<span class=\"token punctuation\">.</span><span class=\"token function\">isValidToken</span><span class=\"token punctuation\">(</span>authToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// valid하면 200, invalid하면 400</span>\n        store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SET_TOKEN</span><span class=\"token punctuation\">,</span> authToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// throw하면 렌더 실패로 간주된다. 하지만 토큰이 invalid하다고 렌더 자체를 실패시키면 안된다.</span>\n        store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DESTROY_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 라우팅 로직이 위치</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 파일의 메인 로직은 크게 2가지로 나누어 진다.</p>\n<hr>\n<ol>\n<li>요청을 보낸 클라이언트의 쿠키에 토큰이 저장되어있을 경우 <code class=\"language-text\">store.dispatch(SET_TOKEN, authToken)</code>로 Store에 인증상태를 저장</li>\n<li><code class=\"language-text\">router.onReady</code>로 선언된 서버 측 라우팅 로직 및 예외처리</li>\n</ol>\n<hr>\n<p>먼저 1번부터 살펴보자. 왜 굳이 인증된 토큰을 Store에 담아야 할까? 먼저 이 서버는 렌더링만을 수행하는 렌더서버이기 때문에 세션의 유효성 검사는 외부에 있는 API서버와 통신을 해서 수행해야한다.</p>\n<p>인증상태는 서버에서도 필요할 수 있고 클라이언트에서도 필요할 수도 있는데, 그럼 서버에서 한번 통신해서 토큰을 검사하고 클라이언트에서도 또 통신을 해서 토큰을 검사해야한다. 하지만 이런 방식은 비효율적이기 때문에 보통 이런 유니버셜 SSR을 지원하는 프레임워크에서는 서버의 상태를 클라이언트로 반환해주는 방법으로 <code class=\"language-text\">window</code> 객체에 서버의 상태를 직렬화해서 렌더 시 <code class=\"language-text\">&lt;script></code> 태그 안에 선언해주는 방식을 사용한다.</p>\n<p><code class=\"language-text\">vue-server-renderer</code>에서는 클라이언트에 반환할 서버의 상태를 Vue의 <a href=\"https://haruair.github.io/flux/\" target=\"_blank\" rel=\"nofollow\">Flux 아키텍처</a> 라이브러리인 <a href=\"https://vuex.vuejs.org/kr/\" target=\"_blank\" rel=\"nofollow\">Vuex</a>를 사용하여 선언한다.</p>\n<p>그렇게 서버의 상태는 렌더 시 <code class=\"language-text\">JSON.stringify</code>를 사용하여 직렬화되어 <code class=\"language-text\">window.__INITIAL_STATE__</code>라는 프로퍼티에 담기게 되고, 이후 클라이언트 초기화 시 해당 프로퍼티에 접근해 <code class=\"language-text\">JSON.parse</code>를 사용하여 Object 타입으로 형변환 후 Vuex Store의 <code class=\"language-text\">replaceState</code> 메소드를 사용해 Store를 업데이트하게 된다.</p>\n<center>\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e35fb3b389f37a4a3a71e3a947ff18a5/37523/initial_state.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIElEQVR42p2Sy26DMBBF8yVdYBuS8jABTACpQFQUIAQ23fT/f+TUYVFVeVRVF0cjeaTjO2NvYt8n0xH5fk8ShRyShLei4Nx11EVOFgmWk6ZvAppiZ6vPqfaJdhJPOGxv2Ggds7cSk+drzYwhzQxllfM+fpLmbzjOC1IJPE/hWjzPxXUlQt6zcd1r8wfKxdt6lGnBWH5QmoamrWmbllc7jeMIpJBI+ZiNEIJbpJKYKKeLOruOlMs8sywLQRBYofNUtgrvDu3tylVWaBiTiT4ZKdKSYRwYhgGt9a/Sp8I0yjjFPY1uOR6PTNNEVVUopf6XMNeHVWhiw/lyZr7MhGH4nW5dzZ+E8iqUpGFGHbVkvqFuaoZ+wNgfsPZtyusDPkr7BYT48n0a47z1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"initial state\" title=\"\" src=\"/static/e35fb3b389f37a4a3a71e3a947ff18a5/6af66/initial_state.png\" srcset=\"/static/e35fb3b389f37a4a3a71e3a947ff18a5/69538/initial_state.png 160w,\n/static/e35fb3b389f37a4a3a71e3a947ff18a5/72799/initial_state.png 320w,\n/static/e35fb3b389f37a4a3a71e3a947ff18a5/6af66/initial_state.png 640w,\n/static/e35fb3b389f37a4a3a71e3a947ff18a5/37523/initial_state.png 720w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <small>브라우저 콘솔에서 이렇게 확인해볼 수 있다</small>\n</center>\n<h3 id=\"서버의-code-classlanguage-textvue-routercode-라우팅-진행\" style=\"position:relative;\">서버의 <code class=\"language-text\">vue-router</code> 라우팅 진행<a href=\"#%EC%84%9C%EB%B2%84%EC%9D%98-code-classlanguage-textvue-routercode-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A7%84%ED%96%89\" aria-label=\"서버의 code classlanguage textvue routercode 라우팅 진행 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>다음 2번이었던 라우팅 로직을 살펴보자. Universal SSR 어플리케이션은 맨 처음 사용자가 페이지를 열었을 때는 서버 쪽에서 라우팅을 진행하고 그 이후 사용자가 페이지를 이동할때는 클라이언트에서 라우팅을 진행하게된다.</p>\n<p>즉 <code class=\"language-text\">server-entry.js</code> 내부의 라우팅 로직은 맨 처음 사용자가 어플리케이션을 초기 실행시킬 때 딱 한번 실행되는 로직이라는 의미이다. 필자는 서버에서는 이 라우터에 연결된 컴포넌트가 있는지에 대한 검사만 진행하고 클라이언트에 라우터 인증 관련 로직을 작성했기 때문에 서버 쪽 엔트리의 라우팅 로직은 간단하게 작성했다.</p>\n<p>이 파일에서 사용된 <code class=\"language-text\">router</code> 객체는 <code class=\"language-text\">createApp</code> 팩토리 함수에서 생성되어 반환된 <code class=\"language-text\">vue-router</code> 라이브러리 내 <code class=\"language-text\">VueRouter</code> 클래스의 인스턴스이다. 필자는 이 클래스의 <code class=\"language-text\">getMatchedComponents</code> 메소드를 사용해서 현재 라우트가 유효한 라우트인지만 검사하기로 했다.</p>\n<p><code class=\"language-text\">VueRouter</code>의 멤버 변수와 메소드의 의미는 <code class=\"language-text\">vue-router</code>의 <a href=\"https://router.vuejs.org/kr/api/#router-link\" target=\"_blank\" rel=\"nofollow\">공식 문서</a>에도 나와 있지만 가끔씩 라이브러리는 업데이트가 되었으나 공식 문서는 업데이트가 늦는 경우도 있으므로 필자는 직접 <code class=\"language-text\">vue-router</code>의 코드를 살펴봤다.</p>\n<p><code class=\"language-text\">node_modules/vue-router/types/router.d.ts</code> 파일을 살펴보면 <code class=\"language-text\">VueRouter</code> 클래스의 멤버 변수와 메소드를 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\"><span class=\"token keyword\">declare</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VueRouter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span>options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> RouterOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  app<span class=\"token operator\">:</span> Vue<span class=\"token punctuation\">;</span>\n  mode<span class=\"token operator\">:</span> RouterMode<span class=\"token punctuation\">;</span>\n  currentRoute<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span> <span class=\"token punctuation\">(</span>guard<span class=\"token operator\">:</span> NavigationGuard<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">beforeResolve</span> <span class=\"token punctuation\">(</span>guard<span class=\"token operator\">:</span> NavigationGuard<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">afterEach</span> <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">hook</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>to<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">,</span> from<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">push</span> <span class=\"token punctuation\">(</span>location<span class=\"token operator\">:</span> RawLocation<span class=\"token punctuation\">,</span> onComplete<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span> onAbort<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">replace</span> <span class=\"token punctuation\">(</span>location<span class=\"token operator\">:</span> RawLocation<span class=\"token punctuation\">,</span> onComplete<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span> onAbort<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">go</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">back</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">forward</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">getMatchedComponents</span> <span class=\"token punctuation\">(</span>to<span class=\"token operator\">?</span><span class=\"token operator\">:</span> RawLocation <span class=\"token operator\">|</span> Route<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Component<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">onReady</span> <span class=\"token punctuation\">(</span>cb<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span> errorCb<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">onError</span> <span class=\"token punctuation\">(</span>cb<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">addRoutes</span> <span class=\"token punctuation\">(</span>routes<span class=\"token operator\">:</span> RouteConfig<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">resolve</span> <span class=\"token punctuation\">(</span>to<span class=\"token operator\">:</span> RawLocation<span class=\"token punctuation\">,</span> current<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Route<span class=\"token punctuation\">,</span> append<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    location<span class=\"token operator\">:</span> Location<span class=\"token punctuation\">;</span>\n    route<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">;</span>\n    href<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// backwards compat</span>\n    normalizedTo<span class=\"token operator\">:</span> Location<span class=\"token punctuation\">;</span>\n    resolved<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">static</span> install<span class=\"token operator\">:</span> PluginFunction<span class=\"token operator\">&lt;</span><span class=\"token builtin\">never</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">getMatchedComponent</code> 메소드는 <code class=\"language-text\">RawLocation</code> 타입이나 <code class=\"language-text\">Route</code> 타입을 인자로 받아서 <code class=\"language-text\">Component</code> 리스트를 반환해주는 메소드라는 것을 확인할 수 있다. 그럼 이제 <code class=\"language-text\">node_modules/vue-router/dist/vue-router.common.js</code> 파일에서 <code class=\"language-text\">getMatchedComponent</code>이 어떻게 구현되어있는지 확인해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token class-name\">VueRouter</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getMatchedComponents</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getMatchedComponents</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">to</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> route <span class=\"token operator\">=</span> to\n    <span class=\"token operator\">?</span> to<span class=\"token punctuation\">.</span>matched\n      <span class=\"token operator\">?</span> to\n      <span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>route\n    <span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>route<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">.</span>matched<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span>components<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> m<span class=\"token punctuation\">.</span>components<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">VueRouter</code> 클래스의 <code class=\"language-text\">getMatchedComponent</code>라는 메소드는 <code class=\"language-text\">to</code> 인자를 받으면 해당 라우트와 매치된 컴포넌트를 반환하고, 인자가 주어지지 않는다면 현재 라우트에 매치된 컴포넌트를 반환하도록 되어있다. <code class=\"language-text\">VueRouter</code> 클래스의 타입 선언부에서 확인한 대로 <code class=\"language-text\">to</code>인자에는 <code class=\"language-text\">optional</code>을 의미하는 <code class=\"language-text\">?</code>가 붙어있었기 때문에 필요한 경우가 아니면 굳이 인자를 넘겨줄 필요는 없을 것 같다. 이제 <code class=\"language-text\">router.onReady</code> 이벤트 훅 내부를 한번 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">router<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n  * @desc 현재 라우터에 연결되어 있는 컴포넌트가 없다면 reject함으로써\n  * nodeJS stream의 error이벤트가 호출되고 별도로 작성해놓은 errorHandler가 404페이지가 렌더 될 것이다.\n  */</span>\n  <span class=\"token keyword\">const</span> matchedComponents <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>matchedComponents<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>router<span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">.</span>fullPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is not found</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>얼추 된 것 같다. 하지만 필자의 어플리케이션은 <code class=\"language-text\">asyncData</code>라는 프로퍼티를 사용하여 라우팅을 진행하기 전에 비동기로직을 기다릴 수 있도록 작성이 되어있다. Vue의 SSR 라이브러리인 <code class=\"language-text\">Nuxt</code>에서도 비슷한 방식을 사용했던 것 같은데 이 부분은 잘 기억이 나지않는다.</p>\n<p>어쨌든 현재 라우트에 매치된 컴포넌트리스트 중 <code class=\"language-text\">asyncData</code>를 가지고 있는 컴포넌트가 있다면 <code class=\"language-text\">Promise</code>를 사용해서 기다리도록 만들어주면 되는 간단한 로직이기 때문에 <code class=\"language-text\">Promise.all</code>을 사용하여 다음과 같이 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">router<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n  * @desc 현재 라우터에 연결되어 있는 컴포넌트가 없다면 404페이지를 렌더한다.\n  */</span>\n  <span class=\"token keyword\">const</span> matchedComponents <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>matchedComponents<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>router<span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">.</span>fullPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is not found</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// start: 추가된 부분</span>\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>matchedComponents<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">Component</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Component<span class=\"token punctuation\">.</span>asyncData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Component<span class=\"token punctuation\">.</span><span class=\"token function\">asyncData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">route</span><span class=\"token operator\">:</span> router<span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** @desc\n     * context에 state를 넘겨주고 렌더러에`template` 옵션을 사용하면 context.state를 직렬화하여 `window .__ INITIAL_STATE__`로 HTML에 주입해준다.\n     */</span>\n    context<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// end: 추가된 부분</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그리고 모든 라우팅이 완료되었을 때 <code class=\"language-text\">context.state = store.state</code>처럼 <code class=\"language-text\">context.state</code>에 <code class=\"language-text\">store</code> 상태를 담아주면 <code class=\"language-text\">vue-server-renderer</code>가 알아서 <code class=\"language-text\">window.__INITIAL_STATE__</code>에 상태를 주입해준다.</p>\n<h3 id=\"vue-server-renderer를-사용하여-html-렌더링\" style=\"position:relative;\">vue-server-renderer를 사용하여 HTML 렌더링<a href=\"#vue-server-renderer%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-html-%EB%A0%8C%EB%8D%94%EB%A7%81\" aria-label=\"vue server renderer를 사용하여 html 렌더링 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">stream\n<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">errorHandler</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> bugsnag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">render stream end ==============================</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> s<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">'================================================'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 <code class=\"language-text\">server-entry.js</code>에서 <code class=\"language-text\">Promise.resolve</code>가 호출되어 초기화가 끝나면 아까 선언해놓았던 <code class=\"language-text\">server.js</code>의 stream의 <code class=\"language-text\">end</code> 이벤트가 실행되고나서 체이닝되어있는 <code class=\"language-text\">pipe</code> 메소드가 실행된다.</p>\n<h3 id=\"서버가-클라이언트로-응답\" style=\"position:relative;\">서버가 클라이언트로 응답<a href=\"#%EC%84%9C%EB%B2%84%EA%B0%80-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EB%A1%9C-%EC%9D%91%EB%8B%B5\" aria-label=\"서버가 클라이언트로 응답 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>위 과정을 거친 후 렌더가 끝난 HTML을 클라이언트로 전송한다.</p>\n<h2 id=\"client-rendering\" style=\"position:relative;\">Client Rendering<a href=\"#client-rendering\" aria-label=\"client rendering permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"code-classlanguage-textclient-entryjscode-실행\" style=\"position:relative;\"><code class=\"language-text\">client-entry.js</code> 실행<a href=\"#code-classlanguage-textclient-entryjscode-%EC%8B%A4%ED%96%89\" aria-label=\"code classlanguage textclient entryjscode 실행 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>클라이언트에서 서버 렌더링이 완료된 HTML과 entry.js를 받아온 후 클라이언트 렌더링이 시작된다. 이때 웹팩이 컴파일할때 클라이언트단 엔트리 포인트로 잡는 파일은 <code class=\"language-text\">client-entry.js</code>이다. 먼저 <code class=\"language-text\">client-entry.js</code> 파일의 <code class=\"language-text\">init</code> 함수를 살펴보자.</p>\n<h3 id=\"클라이언트-어플리케이션-초기화-함수-실행\" style=\"position:relative;\">클라이언트 어플리케이션 초기화 함수 실행<a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%B4%88%EA%B8%B0%ED%99%94-%ED%95%A8%EC%88%98-%EC%8B%A4%ED%96%89\" aria-label=\"클라이언트 어플리케이션 초기화 함수 실행 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">LOGIN</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/stores/auth/config'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">init</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">/** @desc 서버의 스토어의 클라이언트 스토어의 동기화 */</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>__INITIAL_STATE__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    store<span class=\"token punctuation\">.</span><span class=\"token function\">replaceState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>__INITIAL_STATE__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/** @desc 토큰 존재 여부 확인 후 로그인 처리  */</span>\n  <span class=\"token keyword\">const</span> hasToken <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span>authToken<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOGIN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 쿠키 내 토큰을 삭제하는 등의 별도 예외처리</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>현 직장의 코드다 보니까 전체를 적지는 못했지만 <code class=\"language-text\">init</code> 함수가 수행하는 로직은 서버의 스토어 상태를 클라이언트에 반영과 사용자 인증 처리이다. 서버의 스토어 상태를 받아오는 원리는 <a href=\"/2018/09/25/vue-ssr/#code-classlanguage-textserver-entryjscode-%EC%8B%A4%ED%96%89\">server-entry.js 실행</a>에서 설명했으니, 이번에는 “왜 로그인처리를 서버에서 하지않고 클라이언트에서 하는가”에 대해서 설명해보려고 한다.</p>\n<p>그 이유는 이 서버가 별도의 인증 로직을 가지고 있지 않은 렌더 서버이기 때문에 유저 정보를 가져오거나 인증 여부를 확인하거나 하는 작업은 모두 외부의 API 서버에 의존하고 있기 때문이다. 처음에 이 사실을 간과하고 서버 렌더링 시 API 통신을 한 후 유저데이터를 클라이언트로 내려주는 방법을 택했는데, 다음과 같은 문제가 발생했다.</p>\n<hr>\n<ol>\n<li>HTML 템플릿 렌더시간에 API 통신시간이 포함되었다. <small>(렌더가 끝나면 서버렌더링의 라이프사이클도 같이 끝나기 때문에 렌더 중간에 <code class=\"language-text\">await</code> 키워드를 사용하여 API 통신을 동기처리할 수 밖에 없다. 심지어 인증된 유저 정보 GET API가 꽤 느린 편)</small></li>\n<li><code class=\"language-text\">vue-ssr-renderer</code>의 <code class=\"language-text\">render</code> 메소드의 수행시간이 늘어났다.</li>\n<li><code class=\"language-text\">render</code> 메소드의 수행시간이 늘어나면서 한 번에 메모리에 올라가는 템플릿이 많아졌다.</li>\n<li>메모리가 꽉 차서 더 이상 렌더링을 수행하지 못한다.</li>\n<li>서버가 응답을 하지 못한다.</li>\n<li>Fail</li>\n</ol>\n<hr>\n<p>그래서 이 렌더 서버를 구축할 때 가장 집중했던 부분은 <code class=\"language-text\">render</code> 메소드의 수행시간 단축이었고, 그 결과 유저 데이터를 받아오는 로직을 클라이언트로 내리게 되었다. 나중에 생각해보니 현재 인증된 사용자의 데이터가 필요한 뷰는 SEO가 필요없는 부분이라서 굳이 서버에서 할 필요가 없었다. 이제 마지막으로 클라이언트의 라우팅을 살펴보자.</p>\n<h3 id=\"클라이언트의-code-classlanguage-textvue-routercode-라우팅-진행\" style=\"position:relative;\">클라이언트의 <code class=\"language-text\">vue-router</code> 라우팅 진행<a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EC%9D%98-code-classlanguage-textvue-routercode-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A7%84%ED%96%89\" aria-label=\"클라이언트의 code classlanguage textvue routercode 라우팅 진행 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">client-entry.js</code>에는 클라이언트 사이드의 전역 라우터도 같이 선언이 되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">LOGIN</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/stores/auth/config'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">init</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">to<span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> matched <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> prevMatched <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> diffed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> activated <span class=\"token operator\">=</span> matched<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> diffed <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>diffed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>prevMatched<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>activated<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>activated<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>asyncData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">asyncData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">route</span><span class=\"token operator\">:</span> to <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* LOADING INDICATOR */</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">$mount</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>사실 라우터 부분은 <code class=\"language-text\">sever-entry.js</code>에 있던 라우팅 로직 부분과 별로 다르지 않다. 그러나 한 가지 차이점이 있다면 <code class=\"language-text\">client-entry.js</code>의 라우팅에서는 현재 라우터의 컴포넌트와 이전 라우터의 컴포넌트를 비교하는 로직이 있다는 것이다.</p>\n<p>첫 요청 시 라우팅이 단 한번 일어나는 서버 렌더링과 다르게 클라이언트의 라우팅은 사용자의 액션에 따라서 여러 번 일어나게된다. 클라이언트 렌더링은 라우터가 변경되었을 때 컴포넌트가 변경된 부분만 새로 렌더하고 나머지는 그대로 유지하기 때문에 다음 라우터에는 현재 라우터에 있던 컴포넌트를 그대로 사용하고 있을 수 있다.</p>\n<p>중요한 점은 클라이언트에서도 <code class=\"language-text\">asyncData</code>를 서버와 마찬가지로 라우팅이 완료되기 전에 데이터를 <code class=\"language-text\">fetch</code> 해오는 용도로 사용되고 있다는 점이다.</p>\n<p>즉, 현재 라우터에 존재하는 컴포넌트가 다음 라우터에도 존재한다면 굳이 그 컴포넌트의 <code class=\"language-text\">asyncData</code>에서 중복되는 로직을 수행할 필요가 없기 때문에 라우터가 변경될 때 컴포넌트를 비교하는 로직을 수행한 후, 달라진 컴포넌트의 <code class=\"language-text\">asyncData</code>만 수행하도록 로직을 작성해야한다.</p>\n<h3 id=\"appmount---렌더-종료-vue-라이프사이클-시작\" style=\"position:relative;\">app.$mount -> 렌더 종료. Vue 라이프사이클 시작<a href=\"#appmount---%EB%A0%8C%EB%8D%94-%EC%A2%85%EB%A3%8C-vue-%EB%9D%BC%EC%9D%B4%ED%94%84%EC%82%AC%EC%9D%B4%ED%81%B4-%EC%8B%9C%EC%9E%91\" aria-label=\"appmount   렌더 종료 vue 라이프사이클 시작 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>그 후 마지막에 app을 <code class=\"language-text\">#app</code> DOM에 직접 마운트하면 클라이언트 사이드의 Vue 라이프사이클이 시작된다. 마지막으로 해당 프로젝트 보일러 플레이트의 <a href=\"https://github.com/evan-moon/vue-ssr-starter\" target=\"_blank\" rel=\"nofollow\">Github 링크</a>를 첨부한다.</p>\n<p>이상으로 Vue SSR 포스팅을 마친다.</p>","fields":{"slug":"20180925-vue-ssr","path":"/2018/09/25/vue-ssr/","lang":"ko"},"frontmatter":{"title":"Vue Server Side Rendering","subTitle":"Vue SSR의 렌더링 과정과 실전 구축, 운영 경험","date":"Sep 25, 2018","categories":["프로그래밍","자바스크립트","튜토리얼"],"tags":["Vue","NodeJS","Express","Server Side Rendering","SSR","서버사이드 렌더링","Universal Server Side Rendering","Universal","NuxtJS","NextJS","SEO"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/d637d6583a105b27784921c410c1eb2d/3a812/vue.jpg","srcSet":"/static/d637d6583a105b27784921c410c1eb2d/3a812/vue.jpg 320w,\n/static/d637d6583a105b27784921c410c1eb2d/4b287/vue.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/d637d6583a105b27784921c410c1eb2d/fc5c5/vue.webp 320w,\n/static/d637d6583a105b27784921c410c1eb2d/e9225/vue.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/d637d6583a105b27784921c410c1eb2d/2d839/vue.jpg","srcSet":"/static/d637d6583a105b27784921c410c1eb2d/2d839/vue.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/d637d6583a105b27784921c410c1eb2d/b384d/vue.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"Vue","lang":"ko"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}