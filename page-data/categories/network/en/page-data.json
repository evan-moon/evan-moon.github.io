{"componentChunkName":"component---src-templates-category-page-template-index-tsx","path":"/categories/network/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"a670b023-5d3b-59cb-a217-8dbd6c594eba","tableOfContents":"<ul>\n<li>\n<p><a href=\"#the-basics-of-cors\">The basics of CORS</a></p>\n<ul>\n<li><a href=\"#what-is-origin\">What is Origin?</a></li>\n<li><a href=\"#sopsame-origin-policy\">SOP(Same-Origin Policy)</a></li>\n<li><a href=\"#same-origin-and-different-origin\">Same origin and different origin</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-does-works-cors\">How does works CORS?</a></p>\n<ul>\n<li><a href=\"#preflight-request\">Preflight Request</a></li>\n<li><a href=\"#simple-request\">Simple Request</a></li>\n<li><a href=\"#credentialed-request\">Credentialed Request</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-to-solve-cors-policy-violations-problem\">How to solve CORS policy violations problem.</a></p>\n<ul>\n<li><a href=\"#setting-access-control-allow-origin\">Setting Access-Control-Allow-Origin</a></li>\n<li><a href=\"#reverse-proxying-with-webpack-dev-server\">Reverse proxying with Webpack Dev Server</a></li>\n<li><a href=\"#wouldnt-it-be-possible-to-put-the-request-in-the-img-tag\">Wouldn‚Äôt it be possible to put the request in the img tag?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#epilogue\">Epilogue</a></p>\n</li>\n</ul>","excerpt":"In this post, I‚Äôm going to talk about the CORS(Cross-Origin Resource Sharing) policy which every web developer would have heard of at least once. In fact, in web development, it is not an exaggeration to say that errors occur with CORS policy violations are very common, and every web developer will experience it at least once.","html":"<p>In this post, I‚Äôm going to talk about the CORS(Cross-Origin Resource Sharing) policy which every web developer would have heard of at least once. In fact, in web development, it is not an exaggeration to say that errors occur with CORS policy violations are very common, and every web developer will experience it at least once.</p>\n<!-- more -->\n<p>When I was in college, I first encountered this issue while making a toy project with my friends. At the time, I was making a client application in a local environment, and I tried to communicate with the API of a development server made by a friend.</p>\n<p>This was a simple task to communicate with the API server to receive data, but as soon as I tried to communicate, an unknown red message appeared on the console.</p>\n<blockquote>\n<p>üö® Access to fetch at ‚Äô<a href=\"https://api.lubycon.com/me\" target=\"_blank\" rel=\"nofollow\">https://api.lubycon.com/me</a>‚Äô from origin ‚Äòhttp://localhost:3000‚Äô has been blocked by CORS policy: No ‚ÄòAccess-Control-Allow-Origin‚Äô header is present on the requested resource. If an opaque response serves your needs, set the request‚Äôs mode to ‚Äòno-cors‚Äô to fetch the resource with CORS disabled.</p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAABAD/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAQoJBIk23//EABsQAAICAwEAAAAAAAAAAAAAAAECABEDEjEz/9oACAEBAAEFAkaiVXSpj6PQAT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAABECD/2gAIAQEABj8CcE//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMRBBcbH/2gAIAQEAAT8hSv8AJSUAnYb4bfI2i8XEGSf/2gAMAwEAAgADAAAAEOwP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/EByf/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAB/9oACAECAQE/EDWb/8QAGhABAQEBAQEBAAAAAAAAAAAAAREAIWFRcf/aAAgBAQABPxB6coHKy1h6dHhua+ZKr7xKkCF5lSK383//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"what\" title=\"\" src=\"/static/34d40d58a5f3a94ac3dce372aa54cd71/c08c5/what.jpg\" srcset=\"/static/34d40d58a5f3a94ac3dce372aa54cd71/0913d/what.jpg 160w,\n/static/34d40d58a5f3a94ac3dce372aa54cd71/cb69c/what.jpg 320w,\n/static/34d40d58a5f3a94ac3dce372aa54cd71/c08c5/what.jpg 640w,\n/static/34d40d58a5f3a94ac3dce372aa54cd71/80e3c/what.jpg 720w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>CO...What...? Access control allow origin...?</small>\n</center>\n<p>If I think about it now, it‚Äôs an error message that kindly tells me how to fix it, but I didn‚Äôt know what to do after seeing this message because I had little experience in developing web applications at the time.</p>\n<h2 id=\"the-basics-of-cors\" style=\"position:relative;\">The basics of CORS<a href=\"#the-basics-of-cors\" aria-label=\"the basics of cors permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>As such, all of the CORS-related issues we encounter arise from violations of CORS policies. Developers may be annoyed as there are more things to care about when developing because of that policy, but in fact, there is a barrier like CORS, so we can get a minimum guarantee that the resources we bring from other server are safe.</p>\n<p>CORS is short for ‚ÄúCross-Origin Resource Sharing‚Äù. Actually ‚ÄúCross Origin‚Äù means ‚ÄúDifferent Origin‚Äù. but I think that non-English people hard to understand this because we don‚Äôt understand the nuances of the English word ‚ÄúCross‚Äù.</p>\n<p>So I‚Äôm writing this post using the word ‚ÄúDifferent origin‚Äù instead of ‚ÄúCross Origin‚Äù for a little easier understanding of non-English speaking people like me.</p>\n<p>Then, before looking at the resource sharing between different origins, let‚Äôs simply dig into what exactly this <code class=\"language-text\">Origin</code> means and proceed.</p>\n<h3 id=\"what-is-origin\" style=\"position:relative;\">What is Origin?<a href=\"#what-is-origin\" aria-label=\"what is origin permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>URLs like <code class=\"language-text\">https://google.com</code>, which means the location of the server, look like a single string, but are actually made up of several components.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVR42h2MX0+CcAAA+f6PPbae6qG1XGuKytLE0JW62nKaGvkPDIQE4YdoU9CLtd12u5eTzu47XFSGeJsDJCdadQM590qzOmUfgxMbKN0cxbcbpmKIOzBoXSt08xqd2xpiPMbvFdHVK8LhI1LP8Jk4EftsRsba22HO1qzcmGMKv8cYOzRZ+FM2qWAf7fCNJYHhElgrku2GJLLYOmMSYSP1TcHsZ4tpBlhGgGOJzAJ7EWKZ4b8d8Z1N5wT2D2KxIlr6rOcOke0RZB27LgdvwilNkM4rIy61GaXyEK2sUyuOqCs6VXnAk/KF+tCnNpBR9QJdrYFeavOptBnIz/TzDT4KLyyaKv77Hek24A//mh4jJrvfIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"uri structure\" title=\"\" src=\"/static/e25190005d12938c253cc72ca06777b1/6af66/uri-structure.png\" srcset=\"/static/e25190005d12938c253cc72ca06777b1/69538/uri-structure.png 160w,\n/static/e25190005d12938c253cc72ca06777b1/72799/uri-structure.png 320w,\n/static/e25190005d12938c253cc72ca06777b1/6af66/uri-structure.png 640w,\n/static/e25190005d12938c253cc72ca06777b1/d9199/uri-structure.png 960w,\n/static/e25190005d12938c253cc72ca06777b1/21b4d/uri-structure.png 1280w,\n/static/e25190005d12938c253cc72ca06777b1/5bd27/uri-structure.png 1432w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <br>\n</center>\n<p>The origin means protocol and host, and port numbers such as <code class=\"language-text\">:80</code> and <code class=\"language-text\">:443</code>. In other words, it puts together the most basic things we need to find the location of the server.</p>\n<p>Also, as shown in the figure above, the port number in the origin can be omitted, because the default port number of the HTTP and HTTPS protocols used in each web is set. We can find the default port number defined in the <a href=\"https://tools.ietf.org/html/rfc2616#section-3.2.2\" target=\"_blank\" rel=\"nofollow\">RFC 2616</a> document where HTTP is defined.</p>\n<blockquote>\n<p>3.3.2 http URL</p>\n<p>‚Ä¶<br />\n<strong>If the port is empty or not given, port 80 is assumed.</strong> The semantics are that the identified resource is located at the server listening for TCP connections on that port of that host, and the Request-URI for the resource is abs_path (section 5.1.2).<br />\n‚Ä¶</p>\n</blockquote>\n<p>If a port number is explicitly included in the origin, such as ‚Äù<a href=\"https://google.com:443\" target=\"_blank\" rel=\"nofollow\">https://google.com:443</a>‚Äù, it is recognized that the origin is the same only if all port numbers match. However, since clear rules for this case are not established as standards, the evaluation of the origin may vary in some cases.</p>\n<p>We can easily find out origin which application is running from by accessing the <code class=\"language-text\">origin</code> property of the <code class=\"language-text\">Location</code> object from the browser‚Äôs developer tools console.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>origin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token string\">\"https://evan-moon.github.io\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"sopsame-origin-policy\" style=\"position:relative;\">SOP(Same-Origin Policy)<a href=\"#sopsame-origin-policy\" aria-label=\"sopsame origin policy permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There are two policies in the web ecosystem that limit requests for resources from other origins. One is CORS, the topic of this post, and the other is SOP(Same-Origin Policy).</p>\n<p>SOP is a web security policy first defined by <a href=\"https://tools.ietf.org/html/rfc6454#page-5\" target=\"_blank\" rel=\"nofollow\">RFC 6454</a> in 2011. It is literally a policy with the rule that ‚Äúyou can only share resources from the same origin‚Äù.</p>\n<p>However, the web is an open space environment, and it is very common to bring and use resources from different origins, so it cannot be banned without exception. So they defined some exception cases and decided to allow requests for resources contained in these exceptions, even if the resources originate differently. One of the exceptions is ‚Äúrequest for a resource that does not violate the CORS policy‚Äù. <small>(The name CORS first appeared in 2009, which is faster than SOP.)</small></p>\n<blockquote>\n<p>Access to network resources varies depending on whether the resources are in the same origin as the content attempting to access them.</p>\n<p>Generally, reading information from another origin is forbidden.\nHowever, an origin is permitted to use some kinds of resources retrieved from other origins. For example, an origin is permitted to execute script, render images, and apply style sheets from any origin.  Likewise, an origin can display content from another origin, such as an HTML document in an HTML frame. <strong>Network resources can also opt into letting other origins read their information, for example, using Cross-Origin Resource Sharing.</strong></p>\n<p><a href=\"https://tools.ietf.org/html/rfc6454#section-3.4.2\" target=\"_blank\" rel=\"nofollow\">RFC 6454 - 3.4.2 Network Access</a></p>\n</blockquote>\n<p>If we request a resource from a different origin, it violates the SOP policy, and if we do not comply with the CORS policy, which is an exception to the SOP, the resource of a different origin cannot be used at all.</p>\n<p>In other words, the act of restricting the use of resources of different origins is not a matter determined by only one policy. If the exception case defined in the SOP and the cases that can use CORS do not match, we may can not use resources from other origins.</p>\n<p>But why are these people making such annoying policies to bother developers? As we know, the developer would write the code to communicate only with the specified server anyway.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 436px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVR42n2SSY8BURSF679b2FlYCRsrFoYQiTKEhZipUkgtSMxCRIUgZl73R3UjnVTfxctL3jn3nHvuk/r9vqZp9Xq92WxOp9PZbGYYxna7FUJ8/VsApG6322g0yuUytOVyyZ0WnJ1OB8TxeLzf75bkYrEYi8UqlQpq7Xa7Wq3SDi+ZTGa9XtNuv99bkvP5fCKRqNVq0CDrup7NZoPBoKIo3AG9lMVvvcmlUkl7Fnzmx0IkErHZbF6vN5lMmiBL5V6vh6Df7+dyOp0YweVy2e12h8PhdDpvt5sJxTxZEMRgMHiTd7sdUXs8nsViAYIIotEoLRgHMqDD4TCZTDBFihhUVZVor9crT5L+rEKhsNlsAPEQCoUYO51OswJTczQajcdjXhEfDodc2MKD3Gq1fD4f2a5WK0wCRWE+n8O0WtLbNjnhUJZlNkRXJue3oExar6/Ceblc6PUZ+E/axItt5VmYT6VSbrc7Ho8TOKsGhyMSOZ/Pn+E/yKw0l8vRArdoYjscDpsDBwIBjJg4EvqzMyHEN7KqfRhZKKGAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"trust\" title=\"\" src=\"/static/b7814fc71828e37d43c7516e4d1314ab/8574c/trust.png\" srcset=\"/static/b7814fc71828e37d43c7516e4d1314ab/69538/trust.png 160w,\n/static/b7814fc71828e37d43c7516e4d1314ab/72799/trust.png 320w,\n/static/b7814fc71828e37d43c7516e4d1314ab/8574c/trust.png 436w\" sizes=\"(max-width: 436px) 100vw, 436px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>Can't you just trust the developer...?</small>\n</center>\n<p>However, if we think about it a little more, the environment in which two applications in different origins can communicate freely is a pretty dangerous environment.</p>\n<p>We must not forget that client applications, especially client applications running on the web, are too vulnerable to malicious attacks from users.</p>\n<p>When users use Chrome‚Äôs developer tools, they can check without any restrictions on a number of important information, such as the structure of the DOM, which server the client communicates with, and where the resource comes from.</p>\n<p>Some say it‚Äôs hard to read because we uglify the JavaScript source code, but uglify is only uglify, not encryption.</p>\n<p>And even if the source is uglified, it‚Äôs not even incomprehensible to humans, and being able to directly view the source code is a very dangerous part of security.</p>\n<p>In this situation, if there are no rules for applications of different origins to communicate with each other, then the bad user can reads the source code and uses a method like <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"nofollow\">CSRF(Cross-Site Request Forgery)</a>ÎÇò <a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\" target=\"_blank\" rel=\"nofollow\">XSS(Cross-Site Scripting)</a> to pretend the code was executed in your application.</p>\n<center>\n  <div style=\"max-width: 400px\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFOklEQVR42h2U6VOb1xXG34+1IXZKIA7E7ELbqw3QBpLQDgKtaEP7hgRCGIyDTcDO4mbB43ZiY8fJOElrT1s3JomXJDNO63xIZzxtPfmrfr2TD2feO/c955nnPOc5Vxo9bWGoZ5rB3mmG+qwo+21o+q2Yxr045EWW7DnqS5ts5Q9oxM5Rim6xGDnPbOoAg7OFWk4xPOShX2D0ntAhjffMMt7vQTnkY3xgFtWgA+OwkxllgIAxzlpii92dI/zeIhF3jlaqQ75wBU/2ALu3hVEfRx4LMNAzRV+XEUkeWmJidF6EF9WwC51gZlGHcJoSRJwFGpU/4LDlOKps86/PH9As7lCrXSGauYTLWWHKlMYgx1Eqwpwd8CBZ5AImXQq9NoJBu4jZEBcABfxzdSKBFirdMiGDl0/XLvHggxuU0xvk8rsko+fwuOrYXU2mZhvorWWUchLJ59rA5aoy68jjcORwO3MEgk3CS21i4Q3OvDlLyuzluwuH/HLzz1y9eEg82iSb2CYitA2E2rhEvt1dwSY6kgqhfZKBLZLBDqng+m+RXdiknr7MWv59oVEWs8LMwwtXebL/CdvVPfILbdaFhuXINvnQJunf6tokxFdq2S5TmBRCT7UpWTvkJlusBi5ybuMu5dw1MtH3UEyEsSkdhF1RMkK3Ded56rYOdfMaeWOV/GSToqXDimUTqW65TEq3yrK+SkxfIGbI0SxcI527js8v2oruEgjsoJcTDA45WDQVWDGUBIEqUTlLwlAhZqoRMTVIWDaQyuaLJOV1otoKcXmFqDFHu3mLRvMzMplDPO4WoUUxhPQ+s84aobDIXzogPFljQeQ7FAn8+hIBUx2vro4UVlSJqJuk9GuExjO4JzM0WncoVsREazfw+7ZwOhqEhZmdzjru+R1cCx08tnV86jQBfZGpsWXc2jJh0xpSaXqPrHGLqKpJQJHDPJUjnfmAWOx9YtF3mBcA7jnxz9fG42kzaSkj68IEvdvMjERERw3hgm28qnVCmm2kqnmPiKpFTFknZVhHFl6ac68LZptYbBVRHMUgNsZsEe05myjGfRgE4Jyrw4JGSKBep+Z4hw3/TXK260hxVYOliToZfZuq7QJabUIUFxgWW9PXo+GNPh29vTJnzhh4rc+ASXayFDrPnHcLj7pBcKzKvKJBxb5HybaP5B1KE1bXWLW/RVCuoJlcEYySwipR3nxdj10bZPTsDD2vTjAx5kWtCmG25jHbK8xM5HENruAbLeIeEZM3X0ByD6ep23eIjBUxjyToF8y0wsyjijiviRfoZNc4r3SP0d09yunTKvr7pxk4a0ejXMA+ssLMwAp+AeYbreEbqSE1gpeI21q4lVlmNEl0kyki2XeJJHfFKtVw+1fx+8s4PEUmp+dRquwYJ0KURV1IaL48vSVavUjJeYXUzFtIuxuf8vjrn7l8/g73vvqJu1/+zMF79/j46Dt+/P4l9/7xgmfPXvLo6a88++evPPnhvzy6/ws/fPOS29ee8s2959x695jn3/+Pm/t3kTqrh9z46AF/vf2Iq29/xZPjf3P04Rf86aP7HH3ymNs3n/Lj8X+48fFDrh8e8+3fXnD/L895evyCv996LHIfcOePD7l9/Vv20gdI1okEVmUSvzGDeTiMTiu0cS4zbYmgNUaxzdWYdWWR9SEhRwybY4UpcR82lng7+yE55zZLpjIBYex5TRHp7EkbQ112Bk5YGRTngVfsnOq1cqJbSdcpJd2n1fS9MS0sY6T71DgnRbx+Souyy0NQUyLr6DDyOyfy7/2oX/Xwf+8f/ytffeuZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hacker\" title=\"\" src=\"/static/8d7b67f798121b900eda125cf4e20698/6af66/hacker.png\" srcset=\"/static/8d7b67f798121b900eda125cf4e20698/69538/hacker.png 160w,\n/static/8d7b67f798121b900eda125cf4e20698/72799/hacker.png 320w,\n/static/8d7b67f798121b900eda125cf4e20698/6af66/hacker.png 640w,\n/static/8d7b67f798121b900eda125cf4e20698/c5bb3/hacker.png 680w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  </div>\n  <small>I think that gonna be fun to inject my script on this site...!\n  <br>\n  <br>\n</small></center>\n<p>Now, we keep talking on the subject of the same origin and different origins, so exactly in what cases does the web evaluate the origins as the same, and in what cases does the origins differ?</p>\n<h3 id=\"same-origin-and-different-origin\" style=\"position:relative;\">Same origin and different origin<a href=\"#same-origin-and-different-origin\" aria-label=\"same origin and different origin permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The logic for determining that the two origins are the same is very simple. Among the components of the two origins, only the three components, scheme, host, and port, need to be the same.</p>\n<p>For example, the origin of my blog, <code class=\"language-text\">https://evan-moon.github.io</code>, is recognized as the following.</p>\n<table>\n<thead>\n<tr>\n<th>URL</th>\n<th>isSame</th>\n<th>reason</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://evan-moon.github.io\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.github.io</a></strong>/about</td>\n<td>O</td>\n<td>Scheme, Host, Port is same</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://evan-moon.github.io\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.github.io</a></strong>/about?q=ÏïàÎáΩ</td>\n<td>O</td>\n<td>Scheme, Host, Port is same</td>\n</tr>\n<tr>\n<td>**https://**user:password@<strong>evan-moon.github.io</strong></td>\n<td>O</td>\n<td>Scheme, Host, Port is same</td>\n</tr>\n<tr>\n<td><strong><a href=\"http://evan-moon.github.io\" target=\"_blank\" rel=\"nofollow\">http://evan-moon.github.io</a></strong></td>\n<td>X</td>\n<td>Scheme is different</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://api.github.io\" target=\"_blank\" rel=\"nofollow\">https://api.github.io</a></strong></td>\n<td>X</td>\n<td>Host is different</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://evan-moon.naver.com\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.naver.com</a></strong></td>\n<td>X</td>\n<td>Host is different</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://evan-moon.github.com\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.github.com</a></strong></td>\n<td>X</td>\n<td>Host is different</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://evan-moon.github.io:8000\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.github.io:8000</a></strong></td>\n<td>?</td>\n<td>Depends on browser spec</td>\n</tr>\n</tbody>\n</table>\n<p>In the last case, if my blog origin has a port number, such as <code class=\"language-text\">https://evan-moon.github.io:80</code>, it is evaluated as a clearly different origin. However, in this case it is ambiguous to judge because the port number is not included to example origin. RFC 6454‚Äôs <a href=\"https://tools.ietf.org/html/rfc6454#section-5\" target=\"_blank\" rel=\"nofollow\">Comparing Origins</a> section presupposes ‚ÄúIf the two origins are scheme/host/port triples‚Ä¶‚Äù, and the implementation of this rule may vary depending on how it is interpreted.</p>\n<p>So in this case, each browser‚Äôs own origin comparison logic is followed.</p>\n<center>\n  <div style=\"max-width: 400px\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 106.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAYAQACAwAAAAAAAAAAAAAAAAABAgADBP/aAAwDAQACEAMQAAABis00VbKEbqzBAB//xAAcEAACAgIDAAAAAAAAAAAAAAABAgADEjETISP/2gAIAQEAAQUCzsmdhis0K97Ka4/RQUZa5//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ASH/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8BWNa//8QAGxAAAQUBAQAAAAAAAAAAAAAAAAECESIxMnH/2gAIAQEABj8CW7jtx0oueSVaYSS1TT//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhQVFhwf/aAAgBAQABPyFdZULuXQ0dldvA9gdFwBIRa0sQL12USnHK+ym26rJMTe/J/9oADAMBAAIAAwAAABDgyD3/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhMf/aAAgBAwEBPxDV3seQAgL/xAAYEQADAQEAAAAAAAAAAAAAAAAAARExUf/aAAgBAgEBPxCLgi4U3BtT/8QAHBABAQEAAwADAAAAAAAAAAAAAREAIUFRYYHx/9oACAEBAAE/EBMhgH65SElvN02lhzfRnCKbYVl06i8UTESR6V4YBZtplevlouawqR+89wVav73/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ie is trash\" title=\"\" src=\"/static/a21288d9ab75a6714b1f5a752d171ce4/c08c5/ie_is_trash.jpg\" srcset=\"/static/a21288d9ab75a6714b1f5a752d171ce4/0913d/ie_is_trash.jpg 160w,\n/static/a21288d9ab75a6714b1f5a752d171ce4/cb69c/ie_is_trash.jpg 320w,\n/static/a21288d9ab75a6714b1f5a752d171ce4/c08c5/ie_is_trash.jpg 640w,\n/static/a21288d9ab75a6714b1f5a752d171ce4/6a068/ie_is_trash.jpg 960w,\n/static/a21288d9ab75a6714b1f5a752d171ce4/fb914/ie_is_trash.jpg 998w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  </div>\n  <small>\n    Internet Explorer is the only browser that completely ignores port numbers when comparing origins.<br>So let's throw it to the trashcan now.<br>\n    <a href=\"https://www.memedroid.com/memes/detail/2429165/internet-explorer-is-crap\" target=\"_blank\">- memdroid -</a>\n  </small>\n  <br>\n  <br>\n</center>\n<p>The important thing is that this origin comparison logic is not a specification implemented in the server, but a specification implemented in the browser.</p>\n<p>Even if we make a request for a resource that violates the CORS policy, the server responds normally unless the server has logic that only allows requests from the same origin. And the browser checks the headers of this response, and if it determines that the request it sent violates the CORS policy, the response is discarded without using the response.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42lWSS0/CQBSF+b1ujAaBCiSAsDea4IKF8gtcmBCjwQcrg4muNJEYIlCoIH2ldMp0Oj3eKeDjNqd3krn97pneSUVRBMZ8cM7Bl8uVaL2krPZUxPF/qXAcC2N9iPF4QllHv98nDkOKcwVhkFIiomqpRGtBsHDpQfI5PHsE3x1T1ilPCGejc3MBLbuNXG4f1eoBCoUCBoMBUkII6rpuO52ttHYlQoZYeBAEXrhf8NwZAmbDF3O02y1k93aQ0zRUKhUUi0Xo5DQBqq/V0+1eY/TUIpwgp/QOTMTcIJc2QjaDYHMw38DL7Bmtq3PktQzy+QJqtRrK5fIvcOPwPfqEFX0kDcL7O/DTM4jXN8iNZQr1O1R0bi+xt7uFdDqDUqkEjZwOh8MVUEkVxmQrpvogCGBSt2mvB2c6RahOgTiRlKtBPXYfcHx0iHr9BM1mE41GA4ZhIKU2XddN5LgOTc+GZVlY0MTkGvMz2j8R0C0wTSupdRwHvu8nJ/0GiJD+Yn5vu6MAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cors\" title=\"\" src=\"/static/d4d623ba331c1d7851e7000c11cd3809/6af66/cors.png\" srcset=\"/static/d4d623ba331c1d7851e7000c11cd3809/69538/cors.png 160w,\n/static/d4d623ba331c1d7851e7000c11cd3809/72799/cors.png 320w,\n/static/d4d623ba331c1d7851e7000c11cd3809/6af66/cors.png 640w,\n/static/d4d623ba331c1d7851e7000c11cd3809/d9199/cors.png 960w,\n/static/d4d623ba331c1d7851e7000c11cd3809/21b4d/cors.png 1280w,\n/static/d4d623ba331c1d7851e7000c11cd3809/f4fb1/cors.png 1766w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>The server responds normally even if the request violates CORS,<br>and the browser decides whether to discard the response</small>\n</center>\n<p>In other words, CORS is a policy included in the browser implementation specification, so this policy does not apply when communicating between servers without going through a browser. so, even if an error occurs in the client application due to a resource request that violates the CORS policy, only logs about succeessful responded is recorded in server. So if we don‚Äôt know exactly how CORS works, it can be difficult to solve CORS problem.</p>\n<h2 id=\"how-does-works-cors\" style=\"position:relative;\">How does works CORS?<a href=\"#how-does-works-cors\" aria-label=\"how does works cors permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now, we will have a close look at how we can safely use resources with different origins.</p>\n<p>Basically, when a web client application requests a resource of a different origin, the HTTP protocol is used, and the application includes the origin of the current resource request in the <code class=\"language-text\">Origin</code> field in the request header.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\"><span class=\"token header\"><span class=\"token header-name keyword\">Origin</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">https://evan-moon.github.io</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Thereafter, when the server responds to this request, it returns the ‚Äúorigin allowed to access this resource‚Äù in the ‚ÄúAccess-Control-Allow-Origin‚Äù field of the response header. And the browser compares the <code class=\"language-text\">Origin</code> in the request header sent by itself with the <code class=\"language-text\">Access-Control-Allow-Origin</code> in the response header sent by server, and determines whether this response is a valid response.</p>\n<p>Although the basic flow of CORS is simple, in fact, the way CORS works is changed according to three scenarios rather than one. That‚Äôs why it will be easier to fix errors due to CORS policy violations if we understand what scenario our resource request is in.</p>\n<h3 id=\"preflight-request\" style=\"position:relative;\">Preflight Request<a href=\"#preflight-request\" aria-label=\"preflight request permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Preflight is the most common scenario we encounter when developing web applications. In this scenario, the browser does not send the request at once, but divides it into a preflight request and a main request and sends them to the server.</p>\n<p>And for this preflight request, the HTTP method <code class=\"language-text\">OPTIONS</code> is used. The role of the preflight request is to make sure it is safe to send this request by the browser itself before sending it.</p>\n<p>This process can be roughly expressed as a simple flow chart.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAClElEQVR42mNgYGDQBGJDIBZmgABGKAYBQVYGBgMuBgZJEKeegYHpP1QORP9HUsvJwCANpNRBbBYIHyzBdOnSJT0g1oAayATE3EgW4ANAuxnYQAxmIOYDYnaQ4MaNGyN37NjhAzZERYXdhYFB6ikDA9f/GzdE/q1dK7OnsFB6e1WV5ImyMpnN6enS/48ckfp/9KjYFAYGnmKI5WADOZCtgnqH5b+WFlsbMCj0gAof3Lu36ea1ay/279595+jhw/fOnDx579CBA3euX7364tXz5xtBPing4pLEMPD///+MjywsOIEGqgGxai4PjyhI/OrVq84fvnyp/fbjR9mtu3crHj99Wv7t16+yV2/e1F+5ccMGFDy9fHxCWF2I5EqmdCEhUGAz3rl2LfLB7dvPH929e/fEkSMPTgLx/du37zy6d+/N7y9f3EBqFikpieE0EGgkOCKiVcz4nuu5cm8y9uGqF1LhywWGNTC2WSBYnmOimQffc9di7lVKxvxpxsZceAyEAPHAbjEG7wpBhtB6HoaYRdxbDp2IPHL2Ytne4+cq9py4GMLAEMomFL2Yj8E4UJLbtRjVhaDwq6//zwQ2qe2/MHvzf0V5+3wBZAsunz2u+ebxY4tbF89YXDx1Sh052cgkz8Ydhgz1/7l4J/8XFrKIk+bn1xdgAHobjIEad+4+kHXg8NE0kDJR+1Aecb0Ybn45G0GZ0F6wgSyCgoL8IMaxY8d0b926FXLjxo1QIFYEiUk5xwprZe3nUZl4i92i9xgniN26bI9467JL4sb1T7nk6/dz2M//z6EUOpNf1D6LB2wgLy8vONvt3LnTeM+ePTG7du2KnT9/KSi3MAoJCfGRk1PY8SgEBkc9EyLm/zNiskHAGGwgAL767TM7F884AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cors preflight\" title=\"\" src=\"/static/c86699252752391939dc68f8f9a860bf/6af66/cors-preflight.png\" srcset=\"/static/c86699252752391939dc68f8f9a860bf/69538/cors-preflight.png 160w,\n/static/c86699252752391939dc68f8f9a860bf/72799/cors-preflight.png 320w,\n/static/c86699252752391939dc68f8f9a860bf/6af66/cors-preflight.png 640w,\n/static/c86699252752391939dc68f8f9a860bf/d9199/cors-preflight.png 960w,\n/static/c86699252752391939dc68f8f9a860bf/21b4d/cors-preflight.png 1280w,\n/static/c86699252752391939dc68f8f9a860bf/2b36a/cors-preflight.png 2268w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>Î∏åÎùºÏö∞Ï†ÄÎäî Î≥∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Í∏∞ Ï†Ñ ÏòàÎπÑ ÏöîÏ≤≠ÏùÑ Î®ºÏ†Ä Î≥¥ÎÇ¥Í≥†, ÏöîÏ≤≠Ïùò Ïú†Ìö®ÏÑ±ÏùÑ Í≤ÄÏÇ¨ÌïúÎã§</small>\n</center>\n<p>When we use JavaScript‚Äôs fetch API to tell the browser to fetch a resource, the browser sends a preflight request before sending the main request to the server. And in response to this preflight request, the server sends back to the browser with information about what was allowed and what was banned in the response header.</p>\n<p>After that, the browser compares the preflight request sent by itself with the permission policy included in the response from the server, and if it determines that it is safe to send main request, it sends the request again to the same endpoint. Then, when the server responds to this main request, the browser finally passes this response data to JavaScript.</p>\n<p>This flow can be reproduced simply in the browser‚Äôs developer tools console. In my blog environment, if we send a request to the RSS file resource of my Tistory blog, we can check that the browser sends a preflight request using the  ªOPTIONS` method before sending main request.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Headers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/xml'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://evanmoon.tistory.com/rss'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> headers <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">OPTIONS https://evanmoon.tistory.com/rss\n\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">*/*</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept-Encoding</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">gzip, deflate, br</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept-Language</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">en-US,en;q=0.9,ko;q=0.8,ja;q=0.7,la;q=0.6</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Access-Control-Request-Headers</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">content-type</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Access-Control-Request-Method</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">GET</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Connection</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">keep-alive</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Host</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">evanmoon.tistory.com</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Origin</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">https://evan-moon.github.io</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Referer</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">https://evan-moon.github.io/2020/05/21/about-cors/</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Sec-Fetch-Dest</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">empty</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Sec-Fetch-Mode</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">cors</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Sec-Fetch-Site</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">cross-site</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If we check the header of the preflight request sent by the browser as in the example above, we can see that information on the main request to be sent after the preflight request is also included, not just information about <code class=\"language-text\">Origin</code>.</p>\n<p>The browser notice to server that it will use the <code class=\"language-text\">Content-Type</code> field or the <code class=\"language-text\">GET</code> method in the main request through the <code class=\"language-text\">Access-Control-Request-Headers</code> field or the <code class=\"language-text\">Access-Control-Request-Method</code> field of the preflight request.</p>\n<p>browser has sent a preflight request to the Tistory server, now Tistory server to send a response to preflight request which browser sent.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">OPTIONS https://evanmoon.tistory.com/rss 200 OK\n\n<span class=\"token header\"><span class=\"token header-name keyword\">Access-Control-Allow-Origin</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">https://evanmoon.tistory.com</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Encoding</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">gzip</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Length</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">699</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Type</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">text/xml; charset=utf-8</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Date</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">Sun, 24 May 2020 11:52:33 GMT</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">P3P</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">CP='ALL DSP COR MON LAW OUR LEG DEL'</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Server</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">Apache</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Vary</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">Accept-Encoding</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">X-UA-Compatible</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">IE=Edge</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>What we need to note in this response is the value <code class=\"language-text\">Access-Control-Allow-Origin: https://evanmoon.tistory.com</code> included in the header.</p>\n<p>The Tistory server told the browser that the only origin that could access this resource is <code class=\"language-text\">https://evanmoon.tistory.com</code>. However, the origin I sent this request to is <code class=\"language-text\">https://evan-moon.github.io</code>, which is different from the origin allowed by the server.</p>\n<p>Therefore, the browser determines that this request violates the CORS policy and throws the following error.</p>\n<blockquote>\n<p>üö® Access to fetch at ‚Äô<a href=\"https://evanmoon.tistory.com/rss\" target=\"_blank\" rel=\"nofollow\">https://evanmoon.tistory.com/rss</a>‚Äô from origin ‚Äòhttps://evan-moon.github.io‚Äô has been blocked by CORS policy: Response to preflight request doesn‚Äôt pass access control check: The ‚ÄòAccess-Control-Allow-Origin‚Äô header has a value ‚Äòhttp://evanmoon.tistory.com‚Äô that is not equal to the supplied origin. Have the server send the header with a valid value, or, if an opaque response serves your needs, set the request‚Äôs mode to ‚Äòno-cors‚Äô to fetch the resource with CORS disabled.</p>\n</blockquote>\n<p>Here, we are confused because the error is displayed in red on the console window even though an error does not occur in the response to the prelight request and <code class=\"language-text\">200</code> status code is returned normally. In fact, errors caused by CORS policy violations have little to do with the success of the preflight request.</p>\n<p>This is because the browser determines whether the CORS policy is violated after receiving the response to the preflight request.</p>\n<p>Of course, even if the preflight request fails, it may be treated as a CORS policy violation, but more important thing is whether there is a valid Access-Control-Allow-Origin value in the response header. not whether the preflight request succeeds or fails. In other words, even if the preflight request fails and a status code <code class=\"language-text\">200</code> is not returned, if that value is properly entered in the header, it means that it is not a CORS policy violation.</p>\n<p>In most cases, the preflight scenario is used, in which the preflight request and the main request are divided, but in all situations, the request is not sent twice. Although this is a tricky condition, in some cases, it checks for CORS policy violations only with the main request without a preflight request.</p>\n<h3 id=\"simple-request\" style=\"position:relative;\">Simple Request<a href=\"#simple-request\" aria-label=\"simple request permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There is no official name for this scenario, but MDN‚Äôs CORS document calls this scenario as <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Examples_of_access_control_scenarios\" target=\"_blank\" rel=\"nofollow\">Simple Request</a>, so I will just call it Simple Request.</p>\n<p>In the simple request scenario, after sending main request to the server without sending a preflight request, the server sends a value such as <code class=\"language-text\">Access-Control-Allow-Origin</code> in the response header of this main request, then the browser checks CORS policy violations. In other words, the preflight scenario and the simple request scenario have the same overall logic, and differ only in the presence or absence of a preflight request.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVR42mNgYGDQB2I5BkzADMSaQKwDxKwMhIECEGuDGFyhoaEgzQzLli0TP3HihJaxsTHIAEYgZgPJQ9T/Z4RgGEDn27MACQ4Qi8/CwoITxFi9erXz/v37a+3t7XmgrhIEYh4G4gAzzEBOnErs61kkfepFjNPOcJnVb+NLnn1MaM6G61LLzj6UWn/5rWz9pqci9ln7eYzrz3DJRbULimqBHYIw8P///4yrVq1ihnqXQav+Cg+vRoCwjAzEB4vXrpU5ePhY5YmzZ8v2HTrStGv/fhOQuEVoISevlIawiHuVJHYX1v/nYqj5ry5Y/xQUWdwgi4DYE4hjf/78Fnv6xIm4169fxgL5MUAcBsS8IG0asZOFcRnIxLDqP7N8/noBBmF1KfusLJ6r127uvXvv/usr127cP3jk6MMLFy89uHP33tN7Dx7ePn75Jig1cOjFTBODGwjyKtAmLigGB65x2kxWpdCZ/KGr/rPJ28/nYLBYxckQv59DZeI/dnkgLRO6ihNEg+RBwSPsV8rLwM3NLQ6KofXr1xscO3asF5hsJhw5ciQTGmPciGRDWiwz1tfXs0ycOJEdhIFsNmjEwNMWnnTIiEiHKuwAnnGz5V1xAocAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"simple request\" title=\"\" src=\"/static/d8ed6519e305c807c687032ff61240f8/6af66/simple-request.png\" srcset=\"/static/d8ed6519e305c807c687032ff61240f8/69538/simple-request.png 160w,\n/static/d8ed6519e305c807c687032ff61240f8/72799/simple-request.png 320w,\n/static/d8ed6519e305c807c687032ff61240f8/6af66/simple-request.png 640w,\n/static/d8ed6519e305c807c687032ff61240f8/d9199/simple-request.png 960w,\n/static/d8ed6519e305c807c687032ff61240f8/21b4d/simple-request.png 1280w,\n/static/d8ed6519e305c807c687032ff61240f8/2b36a/simple-request.png 2268w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>The simple request scenario is a scenario in which CORS violations are checked with the main request without a preflight request.</small>\n</center>\n<p>However, we can use a simple request. the preflight request can be omitted only when certain conditions are satisfied. Moreover, it is quite difficult to meet this requirement, so if we design your web application architecture in a generic way, it is almost impossible to meet it. So I hardly ever experienced such a case.</p>\n<hr>\n<ol>\n<li>The request method must be one of <code class=\"language-text\">GET</code>, <code class=\"language-text\">HEAD</code>, and <code class=\"language-text\">POST</code>.</li>\n<li>Headers other than <code class=\"language-text\">Accept</code>, <code class=\"language-text\">Accept-Language</code>, <code class=\"language-text\">Content-Language</code>, <code class=\"language-text\">Content-Type</code>, <code class=\"language-text\">DPR</code>, <code class=\"language-text\">Downlink</code>, <code class=\"language-text\">Save-Data</code>, <code class=\"language-text\">Viewport-Width</code>, and <code class=\"language-text\">Width</code> should not be used.</li>\n<li>If <code class=\"language-text\">Content-Type</code> is used, only <code class=\"language-text\">application/x-www-form-urlencoded</code>, <code class=\"language-text\">multipart/form-data</code>, and <code class=\"language-text\">text/plain</code> are allowed as values of this field.</li>\n</ol>\n<hr>\n<p>In fact, if we want to follow the condition 1, we just do not use some methods such as <code class=\"language-text\">PUT</code> or <code class=\"language-text\">DELETE</code>. So actually it is not difficult. However, it is not condition 2 or 3.</p>\n<p>Since the header fields specified in condition 2 are really basic fields, it is rare that an additional field is not used in a complex commercial web application. Even the <code class=\"language-text\">Authorization</code> header used for user authentication is not included in that condition.</p>\n<p>In addition, since we usually design HTTP APIs to have a content type of <code class=\"language-text\">text/xml</code> or <code class=\"language-text\">application/json</code>, it is not so easy to create a situation that satisfies all of these conditions in reality.</p>\n<h3 id=\"credentialed-request\" style=\"position:relative;\">Credentialed Request<a href=\"#credentialed-request\" aria-label=\"credentialed request permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The third scenario is how to use credential requests. This scenario is not the basic scenario of CORS, but it is additionally used when we want to strengthen the security in communication between different origins.</p>\n<p>Basically, the <code class=\"language-text\">XMLHttpRequest</code> object or <code class=\"language-text\">fetch</code> API, which is an asynchronous resource request API provided by the browser, does not include the browser‚Äôs cookie information or authentication-related headers in the request without any options. At this time, if we can include authentication-related information to request with <code class=\"language-text\">credentials</code> option.</p>\n<p>A total of 3 values can be used for this option, and the meaning of each value is as follows.</p>\n<table>\n<thead>\n<tr>\n<th>Option</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>same-origin (default)</td>\n<td>Authentication-related information can be included in request between same origin</td>\n</tr>\n<tr>\n<td>include</td>\n<td>Authentication-related information can be included in any request</td>\n</tr>\n<tr>\n<td>omit</td>\n<td>Authentication-related information can not be included in any request</td>\n</tr>\n</tbody>\n</table>\n<p>If we use options such as <code class=\"language-text\">same-origin</code> or <code class=\"language-text\">include</code> to include authentication information in a resource request, now the browser add some strict rules to CORS policy conditions, not only check the <code class=\"language-text\">Access-Control-Allow-Origin</code> field.</p>\n<p>Let‚Äôs take a closer look at which rules have been added through communication with the local environment where I am writing this post and the Github server hosting my blog.</p>\n<p>In my blog, the value of the <code class=\"language-text\">Access-Control-Allow-Origin</code> field is set to <code class=\"language-text\">*</code>, which means that all origins are allowed. So when someone requests a resource from other origin to my blog server, they are not constrained by CORS policy violations.</p>\n<p>So, even in a local development environment such as <code class=\"language-text\">http://localhost:8000</code>, we can request and retrieve resources at will by using <code class=\"language-text\">fetch</code> API.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://evan-moon.github.io/feed.xml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">Request\nGET https://evan-moon.github.io/feed.xml\n\n<span class=\"token header\"><span class=\"token header-name keyword\">Origin</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">http://localhost:8000</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Referer</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">http://localhost:8000/2020/05/21/about-cors/</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">Response\nGET https://evan-moon.github.io/feed.xml 200 OK\n\n<span class=\"token header\"><span class=\"token header-name keyword\">Access-Control-Allow-Origin</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">*</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Encoding</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">gzip</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Length</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">1132748</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Type</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/xml</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Server</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">GitHub.com</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Status</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">200</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Also, the default value of <code class=\"language-text\">credentials</code> in Google Chrome browser is <code class=\"language-text\">same-origin</code>, which means that authentication-related information is used only within the same origin. So, in local environment, the resource request sent to <code class=\"language-text\">https://evan-moon.github.io</code> cannot contain authentication-related information such as browser cookies.</p>\n<p>That is why the browser simply checks the value of <code class=\"language-text\">Access-Control-Allow-Origin: *</code> and concludes that ‚ÄúThis request is safe‚Äù. However, if I change the <code class=\"language-text\">credentials</code> option to <code class=\"language-text\">include</code>, which means to include authentication-related information in all requests, and send the same request, the situation is a little different this time.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://evan-moon.github.io/feed.xml'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">credentials</span><span class=\"token operator\">:</span> <span class=\"token string\">'include'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Credentials is changed to \"include\"!</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>As we can see if we run this code in the browser console, this time, the <code class=\"language-text\">credentials: include</code> option was used to set the request to include authentication-related information unconditionally regardless of the same origin. So we can check that this request contains the browser‚Äôs cookie information.</p>\n<p>The Github server hosting my blog sent the same response this time, but the browser behavior changed a bit.</p>\n<blockquote>\n<p>üö® Access to fetch at ‚Äô<a href=\"https://evan-moon.github.io/feed.xml\" target=\"_blank\" rel=\"nofollow\">https://evan-moon.github.io/feed.xml</a>‚Äô from origin ‚Äô<a href=\"http://localhost:8000\" target=\"_blank\" rel=\"nofollow\">http://localhost:8000</a>‚Äô has been blocked by CORS policy: The value of the ‚ÄòAccess-Control-Allow-Origin‚Äô header in the response must not be the wildcard ‚Äô*‚Äô when the request‚Äôs credentials mode is ‚Äòinclude‚Äô.</p>\n</blockquote>\n<p>Browsers are saying that if the credentials mode is <code class=\"language-text\">include</code>, we should not use <code class=\"language-text\">*</code> in the <code class=\"language-text\">Access-Control-Allow-Origin</code> header field which meaning that all requests are allowed.</p>\n<p>Like this, when requesting a resource from other origins while authentication-related information is included in the request, the browser adds the two rules for checks for CORS policy violations.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">*</code> can not be used in <code class=\"language-text\">Access-Control-Allow-Origin</code> field, and this value is must be an explicit URL.</li>\n<li><code class=\"language-text\">Access-Control-Allow-Credentials: true</code> is must contained in response header.</li>\n</ol>\n<hr>\n<p>This scenario, including authentication, may feel a bit more complicated than other scenarios. but if we know about various scenarios for CORS policy like this can greatly shorten the time spent wandering in case of a problem caused by a violation of CORS policy in real life. So, It is recommended to be familiar with it.</p>\n<h2 id=\"how-to-solve-cors-policy-violations-problem\" style=\"position:relative;\">How to solve CORS policy violations problem.<a href=\"#how-to-solve-cors-policy-violations-problem\" aria-label=\"how to solve cors policy violations problem permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>So far, we have looked at what CORS is and in what situations it is applied and violated. In this section, let‚Äôs look at what can be done when a problem occurs due to a violation of the CORS policy.</p>\n<h3 id=\"setting-access-control-allow-origin\" style=\"position:relative;\">Setting Access-Control-Allow-Origin<a href=\"#setting-access-control-allow-origin\" aria-label=\"setting access control allow origin permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The most representative way to solve the problem caused by CORS policy violation is that to just set an valid value in the <code class=\"language-text\">Access-Control-Allow-Origin</code> header in the server.</p>\n<p>Using the wildcard `*‚Äô means that we are accepting requests from all origins, so you can be comfortable right now. However, if you think about it in a different sight, it means that we will receive all requests from strange origins that you don‚Äôt know about. Therefore, if we solve the problem in this way, serious security issues may arise.</p>\n<p>So, even if it‚Äôs bother as much as possible, try to specify the origin like <code class=\"language-text\">Access-Control-Allow-Origin: https://evan.github.io</code>.</p>\n<p>This header field can be added to the configuration file of server engines such as Nginx or Apache, but in this case, it is inconvenient to make complex settings, so I recommend setting it using response middleware in the source code.</p>\n<p>Named backend frameworks such as Spring, Express, and Django all provide CORS-related configuration settings or middleware libraries, so the setting itself will not be difficult.</p>\n<h3 id=\"reverse-proxying-with-webpack-dev-server\" style=\"position:relative;\">Reverse proxying with Webpack Dev Server<a href=\"#reverse-proxying-with-webpack-dev-server\" aria-label=\"reverse proxying with webpack dev server permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In fact, it is no exaggeration to say that the most common violation situation of CORS policy is the case of developing front-end applications in a local environment. because it is rare to put a general origin such as <code class=\"language-text\">http://localhost:3000</code> in this important field such as <code class=\"language-text\">Access-Control-Allow-Origin</code>.</p>\n<p>Most front-end developers use Webpack and webpack-dev-server to build a development environment on their local machine. If we use the proxy feature provided by these libraries, we can bypass CORS policy very comfortably.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">proxy</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'/api'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://api.evan.com'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">changeOrigin</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">pathRewrite</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'^/api'</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With this configuration, requests to URLs starting with <code class=\"language-text\">/api</code> in the local environment are proxyed to <code class=\"language-text\">https://api.evan.com</code>. In other words, browser thinks that it sent a request to <code class=\"language-text\">localhost:8000/api</code>, but in fact, Webpack is proxying the request to <code class=\"language-text\">https://api.evan.com</code> in background. So we can tricks the browser as if it followed the CORS policy.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 518px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKUlEQVR42pWUZ4siQRCG/fmifvCDkTUnMKGimLOucY2YUBEzBlAXQRBh63gLZrnd9Y67gZ7prq556q2qnhFVq1XK5/NkNpt5vLy8kMvlIpPJRGq1moxGI/n9fvL5fKTVaslqtZJGo2G7xWIhvV7PtkKhQKVSiUS4tVotcrvdDMSm3W7nuU6nI4VCQUqlkiQSCYnFYrYhkPBUqVQcvF6v0+vrK4nK5TIvGo0Gj2azyQPzbrdLTqeTZDIZSaVScjgcHFzYx7PdbrPtC/Dt7Y1qtRobMTDHC9lsllM9nU50PB45C6SGPcH39/EF+H0T0QHEAPB8PlMkEmGgEPS/gahvv99nCHzQwFwux2k+U/lHoLBOJBLU6XQoFApROp1mVcFgkLxe72eQfwJCSbFYpOVySfP5nEajEc1mM/J4PHxM0HmDwfAj7b8C39/fab/f03a7JZvNxmcTTYFCvIPaflf5A4gnnKbTKV0uF64TUo7H47z3eDy4rvBFo4TgT4HCUclkMrRarWi327FKNGWz2ZBwQfFwOOQ9nNOnKWNRqVQYjC6iw/f7nQGo3/V6/QSu12tKJpO0WCy4zoAIShmIG0CIBhg6Ox6PWRUUAwb47Xajj48PVocgh8OB7UIJ4MtALABC4cPhMAPRSXz4sAk/gUAgwD8JuVzOc3zvgPR6Pa5xNBpljmgymVAqleI/CDo3GAy4kzi8UI45gkAJ6oyXY7EYA+CLpqH7OAXw/wVI5OBE3AhEbgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"trap\" title=\"\" src=\"/static/e4e41838e8e9f4ac284b2b2a6214052f/6b9fd/trap.png\" srcset=\"/static/e4e41838e8e9f4ac284b2b2a6214052f/69538/trap.png 160w,\n/static/e4e41838e8e9f4ac284b2b2a6214052f/72799/trap.png 320w,\n/static/e4e41838e8e9f4ac284b2b2a6214052f/6b9fd/trap.png 518w\" sizes=\"(max-width: 518px) 100vw, 518px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n  <small>Webpack's Trap Card Reverse Proxying has been activated!</small>\n</center>\n<p>Even if you have built your own development environment with a combination of <a href=\"https://github.com/webpack/webpack-dev-middleware\" target=\"_blank\" rel=\"nofollow\">webpack-dev-middleware</a> and Node server, don‚Äôt worry as you can easily configure proxy by using the <a href=\"https://github.com/chimurai/http-proxy-middleware\" target=\"_blank\" rel=\"nofollow\">http-proxy-middleware</a> library. <small>(webpack-dev-server internally uses http-proxy-middleware)</small></p>\n<p>I recommend you that use this method when serving the origin of the client application and the origin of the API server are the same.</p>\n<p>Of course, in the local development environment, there is nothing wrong with webpack proxying requests, but after building the application and deploying it to the server, it is no longer an environment where webpack-dev-server runs. If so, the request will no longer be proxyed and the API request will be sent to where the client application is served, not the API server, and the request will fail.</p>\n<p>For example, if the origin of the API server is <code class=\"language-text\">https://api.evan.com</code> and the origin of the server serving the client application is <code class=\"language-text\">https://www.evan.com</code>, the following situation occurs.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/me'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">in local environment...\nGET https://api.evan.com/me 200 OK\n\nThere is no proxying logic in production environment...\nGET https://www.evan.com/api/me 404 Not Found</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Of course, we can also use the API host according to each environment by using environment variables such as <code class=\"language-text\">process.env.NODE_ENV</code> within the business logic. However, I avoid it because I don‚Äôt think it‚Äôs a good idea to include the source for this development environment in business logic.</p>\n<h3 id=\"wouldnt-it-be-possible-to-put-the-request-in-the-img-tag\" style=\"position:relative;\">Wouldn‚Äôt it be possible to put the request in the img tag?<a href=\"#wouldnt-it-be-possible-to-put-the-request-in-the-img-tag\" aria-label=\"wouldnt it be possible to put the request in the img tag permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>I said that there are several exceptions to the SOP policy that allow access to resources from different origins, and one of them is a request to comply with the CORS policy. And also there are other exceptions such as executable scripts, images to be rendered, and style sheets.</p>\n<p>So wouldn‚Äôt it be possible to bypass CORS policy violation by sending a request with a different exception case‚Ä¶? Like this!</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://evanmoon.tistory.com/rss<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://evanmoon.tistory.com/rss<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Well, if we request a resource in this way, the request succeeds without violating the CORS policy. And if we look closely at the headers of these requests in the network tab of the browser‚Äôs developer tools, we can see that they contain a value of <code class=\"language-text\">Sec-Fetch-Mode: no-cors</code>.</p>\n<p>This <code class=\"language-text\">Sec-Fetch-Mode</code> header is a field that configures the request mode. If the value of this field is <code class=\"language-text\">no-cors</code>, the browser does not check for CORS policy violations even resource is served from other origins. But sadly, the browser doesn‚Äôt tell JavaScript the response of requests with this value in request header. It means we can never access the body of this response from within JavaScript code.</p>\n<p>I was also curious if there really was no way to do this, so I tried several ways, and as a result all failed. So let‚Äôs just give up on trying to circumvent CORS policy violations and follow the CORS policy as the smart guys tell us.</p>\n<h2 id=\"epilogue\" style=\"position:relative;\">Epilogue<a href=\"#epilogue\" aria-label=\"epilogue permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Perhaps the most difficult thing when solving problems caused by CORS policy violations is that the someone who has the problem and the someone who needs to solve the problem is different.</p>\n<p>As I said, CORS policies are implementation specifications for browsers, so most of the people who actually have problems with CORS policy violations are front-end developers. However, in order for us to solve this problem, the backend developer needs to set correct value in  ªAcccess-Control-Allow-Origin` field of server application‚Äôs response header.</p>\n<p>Of course, front-end developers can solve it by themselves using the proxying option of webpack-dev-server which I talked about, but this method works only in a local development environment. In other words, it is not a solution to problems in an production environment.</p>\n<p>Therefore, in the end, in order to properly solve the problem of CORS policy violations, it is inevitable that we need help from backend developers.</p>\n<p>In fact, resolving CORS policy violations is not so difficult and complex, so if one of the front-end or back-end developers is familiar with these policies, they can solve it quicker and easier than you think.</p>\n<p>However, it is hard to find a solution if neither the frontend nor the backend has experience with this problem, such as when I first experienced a CORS policy violation. It‚Äôs a very subtle problem.</p>","fields":{"slug":"20200521-about-cors-en","path":"/2020/05/21/about-cors/en/","lang":"en"},"frontmatter":{"title":"Why we need to know about CORS?","subTitle":"Navigating the Cross-Origin Minefield: What Every Developer Needs to Know","date":"Oct 06, 2020","categories":["Programming","Network","Web"],"tags":["CORS","Cross-Origin Resource Sharing","Network","Web","Web Secure","Access-Control-Allow-Origin"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/e21f60bac8f04efc2928f1d0504fd95f/d803c/thumbnail.png","srcSet":"/static/e21f60bac8f04efc2928f1d0504fd95f/d803c/thumbnail.png 320w,\n/static/e21f60bac8f04efc2928f1d0504fd95f/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/e21f60bac8f04efc2928f1d0504fd95f/fc5c5/thumbnail.webp 320w,\n/static/e21f60bac8f04efc2928f1d0504fd95f/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/e21f60bac8f04efc2928f1d0504fd95f/01fb2/thumbnail.png","srcSet":"/static/e21f60bac8f04efc2928f1d0504fd95f/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/e21f60bac8f04efc2928f1d0504fd95f/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"e072f8ed-ce83-57b3-8a24-690f28d94f3a","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-does-rest-actually-mean\">What Does REST Actually Mean?</a></p>\n<ul>\n<li><a href=\"#what-we-exchange-isnt-actually-the-resource\">What We Exchange Isn‚Äôt Actually the Resource</a></li>\n<li><a href=\"#what-represented-state-of-a-resource-means\">What ‚ÄúRepresented State of a Resource‚Äù Means</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#restful-api\">RESTful API</a></p>\n<ul>\n<li><a href=\"#using-uris-to-express-which-resource\">Using URIs to Express Which Resource</a></li>\n<li><a href=\"#using-http-methods-to-express-actions\">Using HTTP Methods to Express Actions</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about APIs ‚Äî the meeting point between frontend and backend developers. When building applications that run on the web or mobile, we typically use HTTP or HTTPS protocols to create APIs. How intuitive and clear these API definitions are can dramatically reduce a project‚Äôs complexity, making API design a crucial part of system architecture.","html":"<p>In this post, I want to talk about APIs ‚Äî the meeting point between frontend and backend developers.</p>\n<p>When building applications that run on the web or mobile, we typically use HTTP or HTTPS protocols to create APIs. How intuitive and clear these API definitions are can dramatically reduce a project‚Äôs complexity, making API design a crucial part of system architecture.</p>\n<!-- more -->\n<p>That‚Äôs why we need conventions to clearly define what each API does, and the tools we use in this process are ‚ÄúHTTP methods‚Äù and ‚ÄúURIs (Uniform Resource Identifiers).‚Äù</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET https://evan.com/users/1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>An HTTP API endpoint uses HTTP methods and URIs like the above to express what the API does.</p>\n<p>The key point here is that what a user expects the API to do after reading this expression must clearly match what the server actually does. Imagine asking the server ‚Äútake one step forward!‚Äù and getting the response ‚Äúokay, I took one step backward!‚Äù ‚Äî that would be pretty confusing, wouldn‚Äôt it?</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5304fec38eebf202dff1871c8dc2a88e/6aca1/doesnt_know.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAE/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABTEBjtgk//8QAGhABAQACAwAAAAAAAAAAAAAAAQIAAwQRMf/aAAgBAQABBQJvX3yLhDXDL7bkSM//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAECERASIbH/2gAIAQEABj8Cu0yOngm5jx0//8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBUZH/2gAIAQEAAT8hDdefeJhi76pNoCekB8YjTe6Qui2f/9oADAMBAAIAAwAAABBHH//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxCiv//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EEf/xAAcEAEBAAICAwAAAAAAAAAAAAABEQAxUWEhQYH/2gAIAQEAAT8QC7sJVOqcd571u7BOzJ5BKJT5iKh5hnGBMkIPBlypaq5//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"doesnt know\" title=\"\" src=\"/static/5304fec38eebf202dff1871c8dc2a88e/c08c5/doesnt_know.jpg\" srcset=\"/static/5304fec38eebf202dff1871c8dc2a88e/0913d/doesnt_know.jpg 160w,\n/static/5304fec38eebf202dff1871c8dc2a88e/cb69c/doesnt_know.jpg 320w,\n/static/5304fec38eebf202dff1871c8dc2a88e/c08c5/doesnt_know.jpg 640w,\n/static/5304fec38eebf202dff1871c8dc2a88e/6aca1/doesnt_know.jpg 650w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Whether between humans or computers, poor expression leads to miscommunication</small>\n</center>\n<p>That‚Äôs why we use guidelines like <a href=\"https://en.wikipedia.org/wiki/REST\" target=\"_blank\" rel=\"nofollow\">REST</a>. REST is an API architecture guideline introduced by Roy Fielding in his doctoral dissertation back in 2000, and it remains widely used even after more than 20 years.</p>\n<p>But as I discussed in my previous post on <a href=\"/2020/03/15/about-http-status-code/\">HTTP status codes</a>, these are just guidelines ‚Äî not following them won‚Äôt cause errors or break anything. That said, ignoring these guidelines and developing however you please isn‚Äôt a great idea either. The term and concept of REST is so widespread in the industry that most developers assume any HTTP API they encounter will be RESTful. <small>(Its influence is practically on par with a de facto standard.)</small></p>\n<p>For that reason, in this post I want to explore why REST came about in the first place, and what it actually means when people keep saying ‚ÄúRESTful this, RESTful that.‚Äù</p>\n<h2 id=\"what-does-rest-actually-mean\" style=\"position:relative;\">What Does REST Actually Mean?<a href=\"#what-does-rest-actually-mean\" aria-label=\"what does rest actually mean permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>REST stands for <strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer. The heart of this impressive-sounding term is ‚ÄúRepresentational State‚Äù ‚Äî which roughly translates to ‚Äúa represented state.‚Äù The ‚Äústate‚Äù here refers to the state of resources that the server holds.</p>\n<p>In other words, REST is an architectural guideline about exchanging the represented state of resources through communication.</p>\n<p>When discussing REST, many people struggle with understanding ‚Äúrepresentational state‚Äù because they think what client and server exchange through API communication is the resource itself.</p>\n<p>But with a little thought, you can see that we‚Äôre not actually exchanging resources directly through communication.</p>\n<h3 id=\"what-we-exchange-isnt-actually-the-resource\" style=\"position:relative;\">What We Exchange Isn‚Äôt Actually the Resource<a href=\"#what-we-exchange-isnt-actually-the-resource\" aria-label=\"what we exchange isnt actually the resource permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The resources we exchange through APIs could be documents, images, or simple JSON data. But we‚Äôre not actually exchanging the resources directly. Let‚Äôs look at a simple example to understand what this means.</p>\n<p>Imagine a client sends a request to an API endpoint that fetches a specific user‚Äôs information from the server:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET https://iamserver.com/api/users/2\n<span class=\"token header\"><span class=\"token header-name keyword\">Host</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">iamserver.com</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/json</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The client used this endpoint to request user #2‚Äôs resource. If the server processed the request successfully, the client would receive a response roughly like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\"><span class=\"token response-status\"><span class=\"token http-version property\">HTTP/1.1</span> <span class=\"token status-code number\">200</span> <span class=\"token reason-phrase string\">OK</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Length</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">45</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Type</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/json</span></span>\n<span class=\"token application-json\">\n<span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  name<span class=\"token operator\">:</span> 'Evan'<span class=\"token punctuation\">,</span>\n  org<span class=\"token operator\">:</span> 'Viva Republica'<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The response body contains user #2‚Äôs data. Normally, we‚Äôd describe this situation as ‚Äúwe fetched user #2‚Äôs data resource through the <code class=\"language-text\">/api/users/2</code> endpoint.‚Äù I use this shorthand myself for convenience.</p>\n<p>But‚Ä¶ is that JSON data the server sent really the resource itself?</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5fafe421bec63ab1a86624ca4488daf0/6a068/no.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAQP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABrlbpRogn/8QAGRABAQEAAwAAAAAAAAAAAAAAAQARAgMi/9oACAEBAAEFAh99xvLMhZtb/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAgEFAAAAAAAAAAAAAAAAAAFRAhARYYH/2gAIAQEABj8CdMGJEtHb/wD/xAAaEAACAgMAAAAAAAAAAAAAAAAAARFRITFB/9oACAEBAAE/IXPg3fBM7IcaIaUC9vIsO4//2gAMAwEAAgADAAAAEPgv/8QAFREBAQAAAAAAAAAAAAAAAAAAERD/2gAIAQMBAT8QSf/EABURAQEAAAAAAAAAAAAAAAAAABEA/9oACAECAQE/EBi//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFRYXGB/9oACAEBAAE/EKoUDjSZxogWj5EWggiF1KCX1fJya1r3ANGPU//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"no\" title=\"\" src=\"/static/5fafe421bec63ab1a86624ca4488daf0/c08c5/no.jpg\" srcset=\"/static/5fafe421bec63ab1a86624ca4488daf0/0913d/no.jpg 160w,\n/static/5fafe421bec63ab1a86624ca4488daf0/cb69c/no.jpg 320w,\n/static/5fafe421bec63ab1a86624ca4488daf0/c08c5/no.jpg 640w,\n/static/5fafe421bec63ab1a86624ca4488daf0/6a068/no.jpg 960w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Nope. That's not user #2's resource!</small>\n</center>\n<p>The JSON the server sent isn‚Äôt the original resource ‚Äî it‚Äôs merely a representation of user #2‚Äôs data resource stored in the database. The server received the client‚Äôs request, looked up user #2‚Äôs information in the database, and represented it using the <code class=\"language-text\">application/json</code> format specified in the request header.</p>\n<p>Think about it ‚Äî the actual original resource the server accesses is just a row in a database or data written to a file. Sure, the server might store resources as JSON files in its local system, but the point is that the JSON the server sent is not the original resource.</p>\n<p>The JSON the server sent is simply the current state of the original data resource stored in the database, represented in a particular format.</p>\n<h3 id=\"what-represented-state-of-a-resource-means\" style=\"position:relative;\">What ‚ÄúRepresented State of a Resource‚Äù Means<a href=\"#what-represented-state-of-a-resource-means\" aria-label=\"what represented state of a resource means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As I mentioned, REST‚Äôs ‚ÄúRepresentational State‚Äù means the state of an original resource as represented in some format. The original resource exists as a row stored in a database, but since you can‚Äôt just hand that raw data to the client, the server reads the original resource and represents it in an appropriate format.</p>\n<p>And the hints about this ‚Äúappropriate format‚Äù are all there in the HTTP request and response headers.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET https://iamserver.com/api/users/2\n<span class=\"token header\"><span class=\"token header-name keyword\">Host</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">iamserver.com</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/json</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In our earlier example, the client requested user #2‚Äôs resource and included <code class=\"language-text\">application/json</code> as the value of the <code class=\"language-text\">Accept</code> header. The client was telling the server: ‚Äúrepresent user #2‚Äôs state in JSON format.‚Äù If the client had sent <code class=\"language-text\">application/xml</code> instead and the server supported XML format representation, user #2‚Äôs resource would have come back represented in XML.</p>\n<p>The server then uses response headers like <code class=\"language-text\">Content-Type</code> and <code class=\"language-text\">Content-Language</code> to tell the client how the resource is represented, and the client reads this information to parse the content according to each content type.</p>\n<p>In other words, the client didn‚Äôt receive user #2‚Äôs resource. It received the current state of user #2‚Äôs resource, represented in JSON. This is what REST focuses on ‚Äî enabling clients and servers to freely and clearly represent resources using content types, languages, and other mechanisms.</p>\n<h2 id=\"restful-api\" style=\"position:relative;\">RESTful API<a href=\"#restful-api\" aria-label=\"restful api permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>As I discussed, REST is ultimately an architectural style focused on how to clearly represent resources. But when using HTTP APIs, the represented state of a resource alone isn‚Äôt enough for clients to know exactly what will happen on the server when they call an API.</p>\n<p>REST only talks about the represented state of resources ‚Äî it says nothing about ‚Äúactions.‚Äù But what clients actually want when using a server‚Äôs API is clearly some action ‚Äî creating, deleting, or modifying resources.</p>\n<p>That‚Äôs why RESTful APIs leverage HTTP methods and URIs alongside REST architecture to specify both the represented resource and the intended action. Here‚Äôs what each element expresses:</p>\n<hr>\n<ol>\n<li>How is the resource represented? ‚Äî <strong>REST</strong></li>\n<li>Which resource? ‚Äî <strong>URI</strong></li>\n<li>What action? ‚Äî <strong>HTTP Method</strong></li>\n</ol>\n<hr>\n<p>With these elements clearly defined, a client can look at an endpoint like <code class=\"language-text\">GET /users/2</code> and immediately infer ‚Äúah, this API fetches user #2‚Äôs information‚Äù ‚Äî no lengthy documentation needed.</p>\n<p>Since I‚Äôve already covered REST (how resources are represented), let‚Äôs now look at URIs (which resource) and HTTP methods (what action).</p>\n<h3 id=\"using-uris-to-express-which-resource\" style=\"position:relative;\">Using URIs to Express Which Resource<a href=\"#using-uris-to-express-which-resource\" aria-label=\"using uris to express which resource permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A RESTful API‚Äôs URI indicates which resource the API deals with. For example, imagine an API that fetches the list of users in a service. The resource the client wants to access is ‚Äúusers,‚Äù and the URI should clearly represent that.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET /users</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Honestly, this URI is clear enough that even a random middle schooler could tell it‚Äôs related to users. But why do we express the user resource as <code class=\"language-text\">users</code> in plural form rather than <code class=\"language-text\">user</code> in singular?</p>\n<p>Because the user resource isn‚Äôt one specific object. It‚Äôs the same logic as saying ‚ÄúI love <strong>cats</strong>‚Äù instead of ‚ÄúI love <strong>a cat</strong>‚Äù in English.</p>\n<p>I don‚Äôt love one particular cat ‚Äî I love cats as a species, and the word ‚Äúcats‚Äù here encompasses an abstract resource that includes the stray rummaging through trash cans in front of your apartment, someone‚Äôs pampered cat on Instagram, and every random cat you pass on the street.</p>\n<p>Now, let‚Äôs get one level more specific from this abstract ‚Äúusers‚Äù resource. The next level of specificity from the abstract ‚Äúusers‚Äù is ‚Äúa specific user.‚Äù</p>\n<h4 id=\"expressing-resource-hierarchy\" style=\"position:relative;\">Expressing Resource Hierarchy<a href=\"#expressing-resource-hierarchy\" aria-label=\"expressing resource hierarchy permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Since users typically have unique IDs, we can use those IDs to represent a specific user with a URI like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET /users/2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>As you‚Äôve probably noticed, this URI takes the <code class=\"language-text\">/users</code> URI that represents users in general and appends a unique ID to identify a specific user.</p>\n<p>This ‚Äúuser #2‚Äù resource is a subset of the ‚Äúusers‚Äù resource, and RESTful APIs recommend using <code class=\"language-text\">/</code> to express hierarchical relationships between resources.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b57aa2a5b2149437f1bfe0021e65f2f7/5bb8b/resource_layer.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+klEQVR42p2U7U4TQRSGeysmXoHxF5LS7m63xSCUtNtSW6C0hbYg1sIfo0BsKSY0oR9sheWjH6DEbNEYqoJGuADvwttQxryeWSiW0kThx5OZnHnPe85MZsa0sbHRRehEvRPr6+v1Ukmtq6pK87Ur65qm6cQ7mlc3Nzdvmcrl8uf9/X3UajW2s7ODViiGg4MGjo6+4vDwC3S9bsTadcQp96hUKssmcj6uVqug8SfBWlnXNLb3psY+HbxljQ97bKdWYdQNa9fxXF6IOlQNQ15ldXWVEWjnlVrAlpbHplZASS2ik4bn7u7ugoqppu3t7ZNsNotIJMKi0ShamZiYQDw+ienpBKampikWQ7uGMz4+zkqlEuj4VH6GJ6lUCmNjY4wb0KIBn4dCIczMJKGqJeRyecRjMV74QtPU8dyVlRXQ0Z0ZptNpnszi8ThilNRkcjKOF/NJLC/OIkXj/LOEEWvVcLhhLpf7a7i4uIhgMMh8Ph+GhoYMFEWB2+2Gh0av5wyPx2PEvV7vhc7v9181zGQyIDNmtVohCCIsFgucTidcLheZKhgYGDDo7+83sNlspBMM+Hx4eJjl8/mrhqIoQiaBKApchGQygYWFOSQSCSSfPMbc86d4uZSB4naBF5ckCbIsIxAIdDIcMjq875ARCysYDw7C7+1DZNSJaMiFYKDfiI36nZiaUDD7yIde0kqSrbMhnQfjW+Bd8m3zkXfAuWfuQY9VMOLW8zXZJhkj3/I/DZsI3JSYGbRhzGGBwAs0186Nr20omrvwY3cJH9NT6O7uMjpu1VzPkLYpKlF8b7yHXn2Nu3YfbCLXSP9neHZtzq6DKFhhFh14kNSwXG5gfq2BOw+X0KppXpt2w2N+semCMofDgXZkyQKLuRvWnm70ysKlNbvdjr6+PoyMjBgX23jL5PqNd0gv5Vc4HP5NT/Ay4cjvcISgMRSKXFnnOTz34qXQ13Wo6zoKhQIrFou4CfR9nZ5/0lkT/WFm+hjr1O6NoF9aJ/bJo7a1tXX7Dyntkgi4sEC8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"resource layer\" title=\"\" src=\"/static/b57aa2a5b2149437f1bfe0021e65f2f7/6af66/resource_layer.png\" srcset=\"/static/b57aa2a5b2149437f1bfe0021e65f2f7/69538/resource_layer.png 160w,\n/static/b57aa2a5b2149437f1bfe0021e65f2f7/72799/resource_layer.png 320w,\n/static/b57aa2a5b2149437f1bfe0021e65f2f7/6af66/resource_layer.png 640w,\n/static/b57aa2a5b2149437f1bfe0021e65f2f7/5bb8b/resource_layer.png 749w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A hierarchy flowing from users &gt; specific user &gt; specific user's profile image<small>\n</small></small></center>\n<p>Resource hierarchy is an extremely important and sensitive element in API design because it‚Äôs about how you define relationships between your application‚Äôs resources. And like most design patterns, there‚Äôs no single right answer ‚Äî you‚Äôre bound to wrestle with it.</p>\n<p>Having no single right answer means that representing a profile image resource as <code class=\"language-text\">/profile-images/users/2</code> instead of <code class=\"language-text\">/users/2/profile-image</code> is perfectly valid from a logical standpoint. The only difference is what meaning the profile image resource carries.</p>\n<hr>\n<center>\n<code class=\"language-text\">/users/2/profile-image</code><br />\n<small>The profile image of user #2 among users</small>\n</center>\n<br />\n<center>\n<code class=\"language-text\">/profile-images/users/2</code><br />\n<small>User #2's profile image among user profile images among all profile images</small>\n</center>\n<hr>\n<p>As you can see, the same profile image takes on completely different meanings depending on how you design the resource hierarchy. In this case, if no other resource besides users can have profile images, <code class=\"language-text\">/users/2/profile-image</code> makes sense. But if various resources need profile images, <code class=\"language-text\">/profile-images/users/2</code> becomes worth considering.</p>\n<p>Ultimately, the question we need to ask is: for the resource ‚Äúa specific user‚Äôs profile image,‚Äù is ‚Äúusers‚Äù or ‚Äúprofile images‚Äù the more appropriate parent in the hierarchy?</p>\n<p>As I said, there‚Äôs no right answer ‚Äî so always discuss with your team and design URIs that can flexibly adapt to rapidly changing business requirements.</p>\n<h4 id=\"uris-should-not-express-actions\" style=\"position:relative;\">URIs Should Not Express Actions<a href=\"#uris-should-not-express-actions\" aria-label=\"uris should not express actions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Another important rule when designing RESTful API URIs is that URIs should never include expressions that imply an action. For example, imagine an endpoint that deletes a user. If you‚Äôre not familiar with HTTP methods, you might design something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">POST /users/2/delete</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This URI includes <code class=\"language-text\">delete</code>, which implies a deletion action. Sure, you can still tell what this API does, but RESTful API guidelines recommend against expressing actions in URIs. A URI‚Äôs meaning should be strictly about which resource and the resource‚Äôs hierarchical structure ‚Äî nothing more.</p>\n<p>Actions should be expressed using the appropriate HTTP methods. This isn‚Äôt just because RESTful API guidelines say so ‚Äî it‚Äôs also because you never know what side effects might occur when your application (built without following RESTful guidelines) communicates with other applications that do follow them. <small>(Web browsers alone are heavily designed around HTTP methods and status codes.)</small></p>\n<p>So the properly designed endpoint would use the <code class=\"language-text\">DELETE</code> HTTP method, which represents deletion:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">DELETE /users/2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now that we‚Äôve covered how to represent resources using URIs, let‚Äôs look at how to express API actions.</p>\n<h3 id=\"using-http-methods-to-express-actions\" style=\"position:relative;\">Using HTTP Methods to Express Actions<a href=\"#using-http-methods-to-express-actions\" aria-label=\"using http methods to express actions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>RESTful APIs recommend using HTTP methods to express the actions an API performs. HTTP methods are a standard defined in <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html\" target=\"_blank\" rel=\"nofollow\">RFC-2616</a>, so remember that using a method that doesn‚Äôt match the situation can cause your application to behave unexpectedly.</p>\n<p>In practice, most API actions boil down to ‚ÄúCRUD (Create, Read, Update, Delete),‚Äù so aside from a few special cases, just 5 HTTP methods can define the vast majority of APIs:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>Read a resource</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>Replace a resource</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>Delete a resource</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>Create a resource</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>Partially modify a resource</td>\n</tr>\n</tbody>\n</table>\n<p>Methods like <code class=\"language-text\">HEAD</code>, <code class=\"language-text\">OPTIONS</code>, and <code class=\"language-text\">TRACE</code> also exist, but knowing just these five and their roles is more than enough for expressing correct actions and designing RESTful APIs.</p>\n<p>One potentially confusing pair here is <code class=\"language-text\">PUT</code> and <code class=\"language-text\">PATCH</code>. Both are often interpreted as ‚Äúmodify a resource,‚Äù making it hard to know when to use which.</p>\n<h4 id=\"whats-the-difference-between-put-and-patch\" style=\"position:relative;\">What‚Äôs the Difference Between PUT and PATCH?<a href=\"#whats-the-difference-between-put-and-patch\" aria-label=\"whats the difference between put and patch permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>People commonly describe <code class=\"language-text\">PUT</code> as ‚Äúmodifying a resource,‚Äù but what <code class=\"language-text\">PUT</code> actually means is replacing a resource with whatever is in the request body ‚Äî not modifying it.</p>\n<p>Let‚Äôs say we need to change the name of a user resource <code class=\"language-text\">{ id: 1, name: 'evan' }</code> to <code class=\"language-text\">ethan</code>. If we use <code class=\"language-text\">PUT</code>, we must include the entire user resource in the request body.</p>\n<p>In other words, we have to send not just the changed fields, but the unchanged ones too.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">PUT /users/1\n{ id: 1, name: 'ethan' }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/01507d03747ddad000635c4cc253c959/1d499/put_method.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVR42o2S30taYRjHXdvFYFCbwQKLXexy4KWMlI7TNdOjHdO06dLjOeYmDcGlSO0qkBpa7kJYN8u04Vmixxt/JPgfiJfe9ResgUQFeqGn99l7YsZYEb3w8PyA98P3+SGR3PLsdvt9hUIxKpfLn4yNjT2VSqXDYu22PxK1Wv1QJpONTky8kI6MjDw2Go3j2Ww2yR3kOO5nbp/juGyxWOTK5XKuXKlky9XqfrVa5Q4PD5O1Wm1YZADAvSugRqNJ6XS6LrZfWq32N0VRbafTiWjXW2BoJ9hsNgiHw5BK7UFq9ztkf2RQJpMBnuc7rVbr+V/g0BVQr9eX3G432BfmBbOFAoZhYHr6tWAmCcE6qxHUakKgaVqIx+PC1+0vwt7ut34ymUTpdPq82WxeAtfX14f+bVmvUqk+K5XK0OTLySBWGg0Ggz3aw4LH40Usw0IoFIJEIgGx2DZsbsZQLBYDDOzcCBy8QRHLH19bW+sa9HqwWOeQwWgAq9UKJEkCZXoDFmoG4Q7g08pK5/j4+DpQTMTNYf9AzE9OTp6trq52Z02zeAx2ZKJMWKkH5vEsnQs4XjQjkjRAJBK5Gfi/wna7PY7b63q9XvD5fMj/wQ8sy4ox+N77YWnJj8R4a2urc3R0dLeWA4HAOUEQF3jjPUJL9LHvU+a5Pjnzqm82aXpTU1MXy8sfz05PT+8G3NjY6DocDlEZcrkWQVQrqqTd74BlFpHD4YRoNNq5FTg4znq9/qhUKu0UCgUe2wHPF3P5fP7SxLhQKOJaga9UKjuNRuPaYf8B+eZOndX+TzwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"put method\" title=\"\" src=\"/static/01507d03747ddad000635c4cc253c959/6af66/put_method.png\" srcset=\"/static/01507d03747ddad000635c4cc253c959/69538/put_method.png 160w,\n/static/01507d03747ddad000635c4cc253c959/72799/put_method.png 320w,\n/static/01507d03747ddad000635c4cc253c959/6af66/put_method.png 640w,\n/static/01507d03747ddad000635c4cc253c959/d9199/put_method.png 960w,\n/static/01507d03747ddad000635c4cc253c959/21b4d/put_method.png 1280w,\n/static/01507d03747ddad000635c4cc253c959/1d499/put_method.png 1632w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>PUT doesn't modify a resource ‚Äî it replaces it</small>\n</center>\n<p>Because <code class=\"language-text\">PUT</code> replaces the entire resource, if you accidentally send something like <code class=\"language-text\">{ id: null, name: 'ethan' }</code>, this user permanently loses their ID ‚Äî a tragic fate. <small>(Admittedly, most developers handle this edge case.)</small></p>\n<p>On the flip side, the simplicity of ‚Äújust receive a resource and replace it‚Äù means neither the sender nor the receiver has to think too hard about it ‚Äî which is convenient.</p>\n<p>Now, what if we used <code class=\"language-text\">PATCH</code> for the same operation?</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">PATCH /users/1\n{ name: 'ethan' }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f42966e7e24473577e61e2dda4f7aa09/c1b63/patch_method.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFUlEQVR42n1Uz0sbQRSO2GJpD9ba0kObQsEIWvBkrEKycbPJRhOTTSKJWoxRYxrEisYoVjw1MaUFEX8galRE9ORJ/IGgiCfFgwqlXkpz6K1/Qqnbzdc3i4otTQc+vrfvvflm3puZ1WiyjKKiorySkpIXZWVlxaWlpQ/I1hUXFz/X6XRPfD5fbrZ5GgA5a2trasLe3t6zk5OTytPT03Lil9vb2+adnZ3qg4MDw9bWFs+wu7trOjs701/mVFLs6aVUjuamQcK5m5ubpwuLi5ienpZnZmZ+ES7m5uYuUqmUPD8/f8HA7LlUSqGYvLS0hI2NjUO2qWuthoYGbVNTkzsajdYnEvHvklQHe21NRhAEWCwWmEwmVFVVoqKigqBXWa/Xg+OMit1ux+zs7DkJ3r6qVhMMBkP9/f0YHHz7ozPSnhmMBvGmMwiXyw2b3QqD0QCtVovCwoe4n5+Px48KUHD/HhNW6urqMDEx8flKUN0hOe+Wl5drBwYGdGNjY9/8Ph/ckjvj8Xjg9XrgdrvhdDppAdclE4glSVIaGxuxsLBw/ofgVf3EeXQ46aGhIfT09CrUAsT6Yujr64Nqx2KIUSXRKPPF0NvbqwwPD4PmZBW8Mz4+nmZ9s1qtis1mA1dthCCYwXolCBaYeQ6OWh41ogk8b1Jzpqamsu+QSk6zyVSu4vf7YRarIbklvA6Hqfx61Np4RII1CDRYIIqC4nS6WA+zCy4vL6fDNDkQCCgtLS1oa20D4+bmZpVbW1vRHAgi0BJk30okEsHKykp2QQqmu7q6EAqFlI6ODjCEw69VJh9xGCFCBy3a3t6udHd3Y3V19f8lsx6Koqh4vV6INVaYLTy8Hi/ouUG0CqiXzHA5eLXPlIfJycnsgnQoXziOo4bzPx0Oh8ybeZnjOZmui0zXRDYaDbLDZpBtVoPMmap/Uh47lE//FMxkMnnr6+tfR0dHMTIyoiQSCSRHkkgmk2B2PB5H8j2zkxR/r+ZQRezpsYt96+/3rI79/f1XR0dHHw4PD98Rx69wfHys4qaP5RA+0s/Cf/3sNBrNbw2AJbS7KLM6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"patch method\" title=\"\" src=\"/static/f42966e7e24473577e61e2dda4f7aa09/6af66/patch_method.png\" srcset=\"/static/f42966e7e24473577e61e2dda4f7aa09/69538/patch_method.png 160w,\n/static/f42966e7e24473577e61e2dda4f7aa09/72799/patch_method.png 320w,\n/static/f42966e7e24473577e61e2dda4f7aa09/6af66/patch_method.png 640w,\n/static/f42966e7e24473577e61e2dda4f7aa09/d9199/patch_method.png 960w,\n/static/f42966e7e24473577e61e2dda4f7aa09/c1b63/patch_method.png 1200w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>PATCH modifies part of a resource</small>\n</center>\n<p>Unlike <code class=\"language-text\">PUT</code>, <code class=\"language-text\">PATCH</code> truly means modifying the currently stored resource, so there‚Äôs no need to include unchanged fields in the request body.</p>\n<p>Since <code class=\"language-text\">PATCH</code> only requires sending what you actually want to change ‚Äî unlike <code class=\"language-text\">PUT</code> which demands the full resource ‚Äî you avoid unnecessarily large request bodies.</p>\n<p>In practice, when performing update operations through APIs, people often think of it as equivalent to SQL‚Äôs <code class=\"language-text\">UPDATE</code>. In that sense, <code class=\"language-text\">PATCH</code> (which modifies part of a resource) is arguably a better semantic fit for ‚Äúupdating‚Äù than <code class=\"language-text\">PUT</code> (which replaces the entire resource).</p>\n<p>While <code class=\"language-text\">PUT</code> is still more commonly used for update operations, the semantic difference between <code class=\"language-text\">PUT</code> and <code class=\"language-text\">PATCH</code> clearly exists, so I recommend choosing the method that matches your intended action ‚Äî ‚Äúreplace a resource‚Äù or ‚Äúmodify a resource‚Äù ‚Äî when designing endpoints.</p>\n<p>However, the truly important difference between <code class=\"language-text\">PUT</code> and <code class=\"language-text\">PATCH</code> isn‚Äôt the semantic distinction ‚Äî it‚Äôs that <code class=\"language-text\">PUT</code> always guarantees idempotency while <code class=\"language-text\">PATCH</code> may not.</p>\n<h4 id=\"does-the-method-guarantee-idempotency\" style=\"position:relative;\">Does the Method Guarantee Idempotency?<a href=\"#does-the-method-guarantee-idempotency\" aria-label=\"does the method guarantee idempotency permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Idempotency, in mathematics and computer science, is the property that applying the same operation multiple times to a subject produces the same result. This isn‚Äôt specific to HTTP methods ‚Äî it applies to all computer operations including reading and writing to databases or files.</p>\n<p>The most classic example of an idempotent operation is multiplying a number by 1. A function like <code class=\"language-text\">x => x * 1</code> returns <code class=\"language-text\">x</code> whether you apply it once or 10,000 times.</p>\n<p>But a function that adds or subtracts 1 instead of multiplying would increase or decrease the given value with each call, so it doesn‚Äôt always return the same result. This is the textbook example of a non-idempotent operation.</p>\n<p>Since HTTP methods represent CRUD operations on resources, understanding which operations are idempotent helps prevent applications from behaving unexpectedly. An error from calling <code class=\"language-text\">GET</code> multiple times and an error from calling <code class=\"language-text\">POST</code> multiple times can have completely different contexts.</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Idempotent</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>No</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>No</td>\n</tr>\n</tbody>\n</table>\n<p>Let‚Äôs look at this table without overthinking it. <code class=\"language-text\">GET</code> simply reads a resource, so no matter how many times you call it, the result won‚Äôt change. Similarly, <code class=\"language-text\">PUT</code> replaces an existing resource with whatever is in the request ‚Äî as long as the request body doesn‚Äôt change, the result stays the same no matter how many times you call it.</p>\n<p>In other words, operations that read or replace resources are idempotent. So what about non-idempotent cases?</p>\n<p><code class=\"language-text\">POST</code> creates a new resource, so calling it multiple times creates a new resource each time ‚Äî meaning the result of the operation changes with every call. Non-idempotent operations like <code class=\"language-text\">POST</code> can change the application‚Äôs state in completely different ways with each invocation.</p>\n<p>Knowledge of HTTP method idempotency is also useful when debugging with limited error information. Even though both errors occur after network communication, an error from calling <code class=\"language-text\">GET</code> multiple times and an error from calling <code class=\"language-text\">POST</code> multiple times may have entirely different contexts.</p>\n<h4 id=\"why-is-patch-considered-non-idempotent\" style=\"position:relative;\">Why Is PATCH Considered Non-Idempotent?<a href=\"#why-is-patch-considered-non-idempotent\" aria-label=\"why is patch considered non idempotent permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>In the table above, <code class=\"language-text\">PATCH</code> is marked as non-idempotent just like <code class=\"language-text\">POST</code>. But to be precise, <code class=\"language-text\">PATCH</code> can be idempotent like <code class=\"language-text\">PUT</code> or non-idempotent ‚Äî depending on how it‚Äôs implemented.</p>\n<p>Since <code class=\"language-text\">PATCH</code> doesn‚Äôt replace a resource like <code class=\"language-text\">PUT</code>, there are no strict constraints on how the request should be structured. Per the RFC spec, <code class=\"language-text\">PATCH</code> simply means ‚Äúmodify part of a resource‚Äù ‚Äî nothing more.</p>\n<p>For example, when you use <code class=\"language-text\">PATCH</code> the way I described earlier ‚Äî sending only the fields you want to modify ‚Äî it‚Äôs naturally idempotent:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Original resource</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'evan'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">PATCH users/1\n{ age: 31 }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Updated resource</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'evan'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Changed!</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This <code class=\"language-text\">PATCH</code> request clearly means ‚Äúset the <code class=\"language-text\">age</code> field to <code class=\"language-text\">31</code>,‚Äù so no matter how many times you call it, <code class=\"language-text\">age</code> will always be <code class=\"language-text\">31</code>. This is a very common implementation of <code class=\"language-text\">PATCH</code>, and it‚Äôs how I personally implement it too.</p>\n<p>So why do people say <code class=\"language-text\">PATCH</code> might not be idempotent?</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/aaf02eaa6cd79f5891d97861cc8e7338/6a068/hm.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAIBAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAXv5u6LgYmv/xAAaEAADAAMBAAAAAAAAAAAAAAABAgMAERIT/9oACAEBAAEFApTCnme/GZzeSbpWoFP/xAAWEQEBAQAAAAAAAAAAAAAAAAABABL/2gAIAQMBAT8BCyX/xAAYEQEAAwEAAAAAAAAAAAAAAAABAAISUf/aAAgBAgEBPwG6hN37P//EABwQAAICAgMAAAAAAAAAAAAAAAARAQIQIRJRcf/aAAgBAQAGPwJ3mPDdWx8IjC6Fs//EABkQAQEBAAMAAAAAAAAAAAAAAAEAETFBYf/aAAgBAQABPyG0DY4icl5Jc6dpqgr/2gAMAwEAAgADAAAAEOwv/8QAFxEBAAMAAAAAAAAAAAAAAAAAABExYf/aAAgBAwEBPxCa2D//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFR/9oACAECAQE/ELhGLH//xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMUFxwf/aAAgBAQABPxDSDeDbjuyMtSm+cMLVquhPPvApXeOWgSj3ACiW9+5//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hm\" title=\"\" src=\"/static/aaf02eaa6cd79f5891d97861cc8e7338/c08c5/hm.jpg\" srcset=\"/static/aaf02eaa6cd79f5891d97861cc8e7338/0913d/hm.jpg 160w,\n/static/aaf02eaa6cd79f5891d97861cc8e7338/cb69c/hm.jpg 320w,\n/static/aaf02eaa6cd79f5891d97861cc8e7338/c08c5/hm.jpg 640w,\n/static/aaf02eaa6cd79f5891d97861cc8e7338/6a068/hm.jpg 960w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The nagging suspicion that maybe this isn't the only way to implement PATCH</small>\n</center>\n<p>Origins matter, so let‚Äôs crack open <a href=\"https://tools.ietf.org/html/rfc5789\" target=\"_blank\" rel=\"nofollow\">RFC-5789</a> ‚Äî the document that first defined the <code class=\"language-text\">PATCH</code> method. RFC documents usually include explanations and brief examples, so it should show the ‚Äúcorrect‚Äù way to implement <code class=\"language-text\">PATCH</code>.</p>\n<center>\n.<br />\n.<br />\n.<br />\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ddc05d3c7f7b2e1d49eedd8538eb835e/d43b4/patch_example.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaElEQVR42m2S547CQAyEef/3yV8ECIQiqiih915EB1EEc/osLdzlsGQ2rJ2ZsSeR8Xisdrut6/UqnqvVqhKJhGWj0VAQBPI8T/F4XOVy2c5oNCrf97Xb7US8Xi+5iNxuNwPj8n6/63K5WON6vRY19/9wOFjf8XjUYrHQfr/X4/FQOCL8PJ9P1et11Wo1zWYzbbdbe2m5XGqz2Wi1Wmk+n5va0Whk9dPpZCLCaYAwpVIpZbNZU8bYpVJJ3W5XmUzGstlsGmmhUDDFvPN71D8KKdJYqVTU6/XU6XRsXxAAClA6ndZgMDAielCMWupMBiHTvEfmslgsKp/Pq9VqaTKZmFnOmFgs9iZlBW4dnAAPh0Odz+ePQphRxXgAwNzv95XL5YyM52QyaaaEnf03MkUWTbIfmJwZJE7jOLUw0FdTiOl0amNiCk47MMA5IeA7pYcRv4G/FRLsgN25ZUPgPhFIAHBrwDTuvwH+AC4t69xt49FhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"patch example\" title=\"\" src=\"/static/ddc05d3c7f7b2e1d49eedd8538eb835e/6af66/patch_example.png\" srcset=\"/static/ddc05d3c7f7b2e1d49eedd8538eb835e/69538/patch_example.png 160w,\n/static/ddc05d3c7f7b2e1d49eedd8538eb835e/72799/patch_example.png 320w,\n/static/ddc05d3c7f7b2e1d49eedd8538eb835e/6af66/patch_example.png 640w,\n/static/ddc05d3c7f7b2e1d49eedd8538eb835e/d9199/patch_example.png 960w,\n/static/ddc05d3c7f7b2e1d49eedd8538eb835e/d43b4/patch_example.png 1202w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>...nope, nothing there</small>\n</center>\n<p>Surprisingly, the example request body in <a href=\"https://tools.ietf.org/html/rfc5789\" target=\"_blank\" rel=\"nofollow\">RFC-5789</a> simply says <code class=\"language-text\">description of changes</code> ‚Äî no constraints whatsoever. This means developers are free to define the API interface however they want, making implementations like this perfectly valid:</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">PATCH users/1\n{\n  $increase: 'age',\n  value: 1,\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, the <code class=\"language-text\">$increase</code> field specifies which property to increment, and <code class=\"language-text\">value</code> specifies by how much. In this case, Evan‚Äôs age increases by 1 every time the API is called <small><strike>(‚Ä¶sad)</strike></small>, so this API is not idempotent.</p>\n<p>I‚Äôve personally never seen <code class=\"language-text\">PATCH</code> used this way in practice, but as I mentioned, <a href=\"https://tools.ietf.org/html/rfc5789\" target=\"_blank\" rel=\"nofollow\">RFC-5789</a> places no constraints on how to implement <code class=\"language-text\">PATCH</code>, so using it this way doesn‚Äôt violate any standard.</p>\n<p>In short, because the spec places no constraints on implementation details, <code class=\"language-text\">PATCH</code> may or may not be idempotent depending on how the API is built.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>REST is really a guideline for designing network architecture, so the ‚Äúrepresentational state‚Äù I discussed is just one piece of it. But since this post aimed to explain RESTful APIs specifically, I didn‚Äôt dive into the deeper details. If you‚Äôre curious about REST beyond what I‚Äôve covered, I recommend reading the <a href=\"https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm\" target=\"_blank\" rel=\"nofollow\">REST chapter</a> from Roy Fielding‚Äôs dissertation.</p>\n<p>RESTful APIs have been the topic I‚Äôve discussed most frequently with backend developers throughout my career as a frontend developer. Those discussions stemmed partly from a desire to define clear APIs, and partly from wanting to make APIs so clear that new developers joining the team could get up to speed immediately. <small>(I was having this exact conversation at the office today, in fact.)</small></p>\n<p>Personally, I believe the best API isn‚Äôt one with the most features or one that‚Äôs free to use ‚Äî it‚Äôs one so clear that someone with zero context can look at an endpoint and immediately understand what it does, without any additional explanation.</p>\n<p>Sure, learning and following architectural guidelines like RESTful APIs can feel tedious. But the purpose of these standards and guidelines is to create a unified traffic system that millions of developers worldwide can communicate through. Perhaps it‚Äôs these small individual efforts to follow the guidelines that, collectively, keep the vast web architecture running smoothly.</p>\n<p>That wraps up this post on RESTful APIs ‚Äî the endpoint where frontend and backend communicate.</p>","fields":{"slug":"20200407-about-restful-api-en","path":"/2020/04/07/about-restful-api/en/","lang":"en"},"frontmatter":{"title":"RESTful APIs: Where Frontend Meets Backend","subTitle":"Understanding the philosophy of REST ‚Äî between representation and action","date":"Apr 07, 2020","categories":["Programming","Network","Architecture"],"tags":["REST","REST API","RESTful API","HTTP Method","HTTP Status"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/eba52764a4c3657fcab1149679dc258c/d803c/thumbnail.png","srcSet":"/static/eba52764a4c3657fcab1149679dc258c/d803c/thumbnail.png 320w,\n/static/eba52764a4c3657fcab1149679dc258c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/eba52764a4c3657fcab1149679dc258c/fc5c5/thumbnail.webp 320w,\n/static/eba52764a4c3657fcab1149679dc258c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/eba52764a4c3657fcab1149679dc258c/01fb2/thumbnail.png","srcSet":"/static/eba52764a4c3657fcab1149679dc258c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/eba52764a4c3657fcab1149679dc258c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"ef2a0def-88af-5483-99b3-c9a812e43ff7","tableOfContents":"<ul>\n<li>\n<p><a href=\"#do-we-really-need-to-follow-these-guidelines\">Do We Really Need to Follow These Guidelines?</a></p>\n<ul>\n<li><a href=\"#think-about-why-standard-interfaces-exist\">Think About Why Standard Interfaces Exist</a></li>\n<li><a href=\"#the-frontends-sad-story-that-backend-devs-dont-know-about\">The Frontend‚Äôs Sad Story That Backend Devs Don‚Äôt Know About</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#http-status-codes-reporting-the-result-of-your-work\">HTTP Status Codes: Reporting the Result of Your Work</a></p>\n<ul>\n<li><a href=\"#100-level\">100-Level</a></li>\n<li><a href=\"#200-level\">200-Level</a></li>\n<li><a href=\"#300-level\">300-Level</a></li>\n<li><a href=\"#400-level\">400-Level</a></li>\n<li><a href=\"#500-level\">500-Level</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"Modern applications are practically programs that run entirely on the network ‚Äî communication makes up a huge portion of a program‚Äôs business logic. Client applications communicate with backend servers to fetch logged-in user information, create new posts, and sometimes subscribe to server events through WebSockets to implement features like push notifications or chat.","html":"<p>Modern applications are practically programs that run entirely on the network ‚Äî communication makes up a huge portion of a program‚Äôs business logic. Client applications communicate with backend servers to fetch logged-in user information, create new posts, and sometimes subscribe to server events through WebSockets to implement features like push notifications or chat.</p>\n<!-- more -->\n<p>In this process, the frontend and backend need to define many rules ‚Äî from how they‚Äôll communicate, to how resource creation and deletion are defined, to how the success or failure of backend operations requested by the frontend should be reported.</p>\n<p>Several guidelines exist to help define these rules, and that‚Äôs where things like HTTP methods, status codes, and REST come in.</p>\n<p>In this post, I want to dive into HTTP status codes ‚Äî one of the essential elements for clearer communication between frontend and backend.</p>\n<h2 id=\"do-we-really-need-to-follow-these-guidelines\" style=\"position:relative;\">Do We Really Need to Follow These Guidelines?<a href=\"#do-we-really-need-to-follow-these-guidelines\" aria-label=\"do we really need to follow these guidelines permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Honestly, HTTP methods, status codes, and REST are just guidelines. Not following them won‚Äôt break your program or cause runtime errors for users.</p>\n<p>In other words, you can write programs just fine without them.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5ab263e405da8a4381a5fe32c5581820/41099/ebichu.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAdFHeGZyL//EABwQAAEDBQAAAAAAAAAAAAAAAAACAxIBEyIjM//aAAgBAQABBQK4ZUVMbVsc5SP/xAAXEQADAQAAAAAAAAAAAAAAAAAAARIh/9oACAEDAQE/AXjJP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQEBAQAAAAAAAAAAAAAAAAEAECL/2gAIAQEABj8ClXnCc//EABsQAAICAwEAAAAAAAAAAAAAAAABESExQVFh/9oACAEBAAE/IUje34sl0GmCI6npJS8JH//aAAwDAQACAAMAAAAQHO//xAAXEQEAAwAAAAAAAAAAAAAAAAAAETFR/9oACAEDAQE/EKGoP//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxABLb//xAAdEAEAAwACAwEAAAAAAAAAAAABABExcZEhUWGx/9oACAEBAAE/EKiWem1wSj+FUKG39MhTp3PLbaTkdjZ2W37AjTqf/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ebichu\" title=\"\" src=\"/static/5ab263e405da8a4381a5fe32c5581820/41099/ebichu.jpg\" srcset=\"/static/5ab263e405da8a4381a5fe32c5581820/0913d/ebichu.jpg 160w,\n/static/5ab263e405da8a4381a5fe32c5581820/cb69c/ebichu.jpg 320w,\n/static/5ab263e405da8a4381a5fe32c5581820/41099/ebichu.jpg 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>So it doesn't matter if we don't follow them, right?</small>\n</center>\n<p>Well, not following these rules is your choice, but considering the side effects that can result, I‚Äôd recommend following them whenever possible.</p>\n<h3 id=\"think-about-why-standard-interfaces-exist\" style=\"position:relative;\">Think About Why Standard Interfaces Exist<a href=\"#think-about-why-standard-interfaces-exist\" aria-label=\"think about why standard interfaces exist permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Industry standards are established to ensure compatibility among products made by countless different producers and to facilitate communication between them. The set of standard specifications we define to make different entities compatible is what we call an ‚Äúinterface.‚Äù</p>\n<p>The concept of an interface is quite broad ‚Äî if it connects things, it‚Äôs an interface. HDMI connecting monitors to computers, SATA used in storage devices, USB ‚Äî they‚Äôre all interfaces. UI (User Interface) even extends the concept to connecting humans with machines.</p>\n<p>Among these, the interface most familiar to developers is the API (Application Programming Interface). An API provides the functionality needed to build applications as a set of interfaces.</p>\n<p>The convenience of APIs is that users only need to know how to use them ‚Äî they can completely ignore whatever massive logic lies beneath. A classic example is the Windows OS API provided through C:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Windows.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;tchar.h></span></span>\n\n<span class=\"token keyword\">int</span> APIENTRY <span class=\"token function\">_tWinMain</span><span class=\"token punctuation\">(</span>\n  HINSTANCE hInstance<span class=\"token punctuation\">,</span>\n  HINSTANCE hPrevInstance<span class=\"token punctuation\">,</span>\n  LPTSTR lpCmdLine<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">int</span> nCmdShow\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">MessageBox</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token function\">TEXT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, Windows!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">TEXT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> MB_OK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Developers can display a message box simply by calling the <code class=\"language-text\">MessageBox</code> API function without knowing how the Windows OS renders it. And this interaction is communication between two entirely different programs ‚Äî a C application and the operating system.</p>\n<p>In other words, an API is an interface for communication between programs. Similarly, when a client requests something from a server, it uses an API defined by specific rules to access server resources. In most modern applications that communicate via HTTP, these APIs are defined using specific URLs called endpoints, and the server must respond to client requests through these endpoints in a consistent manner.</p>\n<p>HTTP status codes are a kind of agreement that conveys the result of the client‚Äôs request ‚Äî and they‚Äôre a crucial component of an API.</p>\n<h3 id=\"the-frontends-sad-story-that-backend-devs-dont-know-about\" style=\"position:relative;\">The Frontend‚Äôs Sad Story That Backend Devs Don‚Äôt Know About<a href=\"#the-frontends-sad-story-that-backend-devs-dont-know-about\" aria-label=\"the frontends sad story that backend devs dont know about permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In this section, I want to briefly talk about something that frontend developers working with poorly designed APIs have likely experienced at least once. Backend developers rarely look at frontend application source code, so they might not even know this situation exists.</p>\n<p>It‚Äôs the case where HTTP status codes are used incorrectly ‚Äî the classic example being a server that returns <code class=\"language-text\">200 OK</code> even when a request fails.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET /api/users/123</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\"><span class=\"token response-status\"><span class=\"token http-version property\">HTTP/1.1</span> <span class=\"token status-code number\">200</span> <span class=\"token reason-phrase string\">OK</span></span>\n{ \"success\": false }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>APIs designed this way typically include success/failure status and failure reasons in the HTTP response body, which creates an awkward situation for the frontend application.</p>\n<p>Frontends handle these async requests through Promises, and the problem is that most HTTP communication libraries and APIs determine success or failure based on the status code from the backend, throwing errors only when requests fail.</p>\n<p>So normally, frontend communication code looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchUsers</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/users/123'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The request failed!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If a request to the server fails, the server should send a 400 or 500-level status code, which causes <code class=\"language-text\">fetch</code> to throw an error. With that, a simple <code class=\"language-text\">try/catch</code> around <code class=\"language-text\">fetch</code> is all you need to handle communication errors.</p>\n<p>But when the backend returns a 200-level code even for failed requests, the frontend ends up in this sad situation:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchUsers</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/users/123'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> success <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The request failed!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Notice the <code class=\"language-text\">if (!success)</code> that didn‚Äôt exist before. An unnecessary extra layer of error handling that hurts code readability, but the frontend has no choice. You can‚Äôt just ignore server errors and skip handling them.</p>\n<p>On top of that, if the backend encounters an unhandled error or the server dies entirely, the response will come back with a 500 or 502 error code anyway ‚Äî so you can‚Äôt skip <code class=\"language-text\">try/catch</code> either.</p>\n<p>Every HTTP communication library on the client side is designed assuming correct HTTP status code usage. If the server uses incorrect status codes, these sad situations arise. And honestly, returning the correct status code for each situation isn‚Äôt even that hard on the backend side. <small>(Just a bit tedious.)</small></p>\n<p>Like client libraries, most server frameworks also provide HTTP status codes for every situation, so I recommend using the appropriate codes whenever possible.</p>\n<p>Now let‚Äôs dive into what each of these HTTP status codes actually means.</p>\n<h2 id=\"http-status-codes-reporting-the-result-of-your-work\" style=\"position:relative;\">HTTP Status Codes: Reporting the Result of Your Work<a href=\"#http-status-codes-reporting-the-result-of-your-work\" aria-label=\"http status codes reporting the result of your work permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When a client requests work from a server, the server performs the work and sends back the result as a response. It uses HTTP status codes to indicate whether the work succeeded or failed, and if it failed, why. As we saw in the bad example above, some servers include failure information in the response body, but the better approach is to use the correct HTTP status codes.</p>\n<p>HTTP status codes have standardized numbers for each situation ‚Äî ‚Äú200 = success,‚Äù ‚Äú400 = client screwed up,‚Äù ‚Äú500 = server screwed up.‚Äù Basic web program behavior and frontend/backend frameworks are all designed around these standards, so it‚Äôs best to follow them.</p>\n<p>Web browsers ‚Äî the quintessential HTTP programs ‚Äî strictly follow these status code standards. Browsers actually distinguish between success and failure of their requests based on the status code the server returns, and they display this visually.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/581d5098769863da7581ecc2a09a19ed/d7ab4/browser-response.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABO0lEQVR42o1S7XKDIBD0VRJj4kc1ioqCCJh+vP8bbe8uaaadJtP+2Dk4cbndJbHWIoSAGAOMsRj1hLZTUvthxEw9Y5d71dMsfaV6WQ+jRkdrrue2RTJNE9Z1FVhv6EeDqqqw3+8FacpI7zgcDnd87b/3k3me4ZzDYh0632JajNyWFwXqusHxeLwRp8iy7AfhIyQsOcaIQJK3sEH1vcgbtYZbA+0H1E0jYFIhv13wkNCQRPbQey9yeTr2zy4O02zg44bL2wfi9gpDPfaPz1Qv9UNS8ZAls4duuZpelpVIZZxOuSDPcxRkA9c8L5DRt6cT8nRu9XjvFSzJ7SWxTlJjibvdTvAsnF8ebtt29ZGmHMeRnoeDprDWEIWUAyrK8s9AhFApBU0BMNEwXAPoqNecW7Q0JYfCnnJY/0n5E8S6FKangsPMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser response\" title=\"\" src=\"/static/581d5098769863da7581ecc2a09a19ed/6af66/browser-response.png\" srcset=\"/static/581d5098769863da7581ecc2a09a19ed/69538/browser-response.png 160w,\n/static/581d5098769863da7581ecc2a09a19ed/72799/browser-response.png 320w,\n/static/581d5098769863da7581ecc2a09a19ed/6af66/browser-response.png 640w,\n/static/581d5098769863da7581ecc2a09a19ed/d9199/browser-response.png 960w,\n/static/581d5098769863da7581ecc2a09a19ed/d7ab4/browser-response.png 1014w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Browsers treat 200-level status codes very differently from 400 and 500-level ones</small>\n</center>\n<p>If a server returns status code 200 but expresses the error only in the response body, the browser thinks the request succeeded while it actually failed ‚Äî a bizarre situation.</p>\n<p>If the server returns a code like 301, the browser will automatically redirect the user to another page. So if the server doesn‚Äôt return proper status codes, the browser could exhibit unexpected behavior.</p>\n<p>Now let‚Äôs look at what each HTTP status code means. Status codes range from 100 to 500-level and can define quite a variety of states, but you don‚Äôt need to know them all. I‚Äôll cover just the ones I‚Äôve personally used at least once.</p>\n<h3 id=\"100-level\" style=\"position:relative;\">100-Level<a href=\"#100-level\" aria-label=\"100 level permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>100-level codes carry informational states like ‚Äúyou may switch protocols‚Äù or ‚Äúcontinue sending requests.‚Äù I‚Äôve never actually encountered these in application development, so I‚Äôll skip them.</p>\n<h3 id=\"200-level\" style=\"position:relative;\">200-Level<a href=\"#200-level\" aria-label=\"200 level permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>200-level codes indicate that the server successfully performed the work the client requested. Browsers display these with a clean green color in the network tab.</p>\n<p>While ‚Äúrequest succeeded‚Äù alone is often enough, if you need more detailed states, you can actively use 200-level codes to give the client more specific information.</p>\n<p><strong>200 OK</strong></p>\n<p>Status code <code class=\"language-text\">200</code> simply means the work succeeded. In most cases, the client knows exactly what it requested, so just knowing ‚Äúyour request succeeded‚Äù is sufficient ‚Äî no additional detail needed. That‚Äôs why this single code is used for all successful API responses in the vast majority of cases.</p>\n<p><strong>201 Created</strong></p>\n<p>Status code <code class=\"language-text\">201</code> means the request was processed normally and a new resource was created as a result. Creating new resources through client requests is extremely common ‚Äî the most representative case I‚Äôve experienced is user registration. A registration request creates a new user row in the database, making it a perfect fit for <code class=\"language-text\">201</code>.</p>\n<p><strong>204 No Content</strong></p>\n<p>Status code <code class=\"language-text\">204</code> means the request was processed normally and the content associated with this request no longer cleanly exists. This code can be used as a response to deletion requests. My experience with it was a post deletion API.</p>\n<p>Note that whether the deletion is a soft delete or hard delete is completely irrelevant here. However the server represents resource deletion internally, the only information the client needs is ‚Äúthis resource has been deleted and is no longer available.‚Äù</p>\n<h3 id=\"300-level\" style=\"position:relative;\">300-Level<a href=\"#300-level\" aria-label=\"300 level permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>300-level codes relate to redirection. When a requested resource has been moved or deleted and can no longer be accessed normally, the server can tell the client ‚Äúgo here to find the resource you‚Äôre looking for‚Äù ‚Äî and that‚Äôs what 300-level codes are for.</p>\n<p><strong>301 Moved Permanently</strong></p>\n<p>Status code <code class=\"language-text\">301</code> is also known as ‚Äú301 Redirect‚Äù ‚Äî the most commonly used redirection code. When a browser receives <code class=\"language-text\">301</code> in response, it checks the <code class=\"language-text\">Location</code> field in the HTTP header and automatically redirects to the URL specified there.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\"><span class=\"token response-status\"><span class=\"token http-version property\">HTTP/1.1</span> <span class=\"token status-code number\">301</span> <span class=\"token reason-phrase string\">Moved Permanently</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Location</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">https://evan/moved-contents/1234</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Search engine bots like Google‚Äôs also automatically update page information when they receive a <code class=\"language-text\">301</code> response, making correct use of this status code very important from an SEO (Search Engine Optimization) perspective.</p>\n<p>Redirection settings can typically be configured in the server engine‚Äôs configuration files or directly in the backend application. A common use case is redirecting users who connected via HTTP to the HTTPS-only port.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">listen</span>         <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">server_name</span>    evan.com</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">return</span>         <span class=\"token number\">301</span> https://<span class=\"token variable\">$host</span><span class=\"token variable\">$request_uri</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">listen</span>         <span class=\"token number\">443</span> ssl</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">server_name</span>    evan.com</span><span class=\"token punctuation\">;</span>\n    ...\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In this case, when Nginx detects a user connecting to port <code class=\"language-text\">80</code>, it redirects them to port <code class=\"language-text\">443</code> (which requires HTTPS), enforcing the secure protocol.</p>\n<p><strong>304 Not Modified</strong></p>\n<p>Status code <code class=\"language-text\">304</code> means the requested resource hasn‚Äôt changed at all compared to the previous request. Literally: Not Modified.</p>\n<p>When the server responds with this code, the client doesn‚Äôt need the server to retransmit the resource ‚Äî it uses its cached version instead, reducing unnecessary communication payload.</p>\n<p>Since the client uses its cached resource rather than one received from the server, this is considered a redirection to the cached resource. That‚Äôs why <code class=\"language-text\">304</code> is sometimes called an implicit redirect.</p>\n<p>Browsers have their own caching mechanisms for this response. If a <code class=\"language-text\">304</code> response is received but there‚Äôs no cached resource, a blank screen or error page appears. So if you encounter this situation, you might want to check whether the browser actually has a cached resource.</p>\n<h3 id=\"400-level\" style=\"position:relative;\">400-Level<a href=\"#400-level\" aria-label=\"400 level permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>400-level codes mean something was wrong with the client‚Äôs request. If you spot one, there‚Äôs a high probability the frontend developer didn‚Äôt handle edge cases properly or sent bad data with the request. <small><strike>(There‚Äôs a small chance it‚Äôs the backend‚Äôs fault too‚Ä¶)</strike></small></p>\n<p><strong>400 Bad Request</strong></p>\n<p>Status code <code class=\"language-text\">400</code> is one of the most common 400-level codes, and it bluntly means ‚Äúthe client sent a bad request.‚Äù What exactly went wrong is sometimes included in the response body, but when it‚Äôs not, you might need to dig into the backend application logs.</p>\n<p><strong>401 Unauthorized</strong></p>\n<p>Status code <code class=\"language-text\">401</code> tells an unauthenticated user requesting a protected resource ‚Äúyou need to authenticate.‚Äù It‚Äôs commonly used when a non-logged-in user calls an API that requires login.</p>\n<p>When the client receives <code class=\"language-text\">401</code>, it often interprets this as ‚Äúlogin required‚Äù and redirects the user to the login page.</p>\n<p><strong>403 Forbidden</strong></p>\n<p>Status code <code class=\"language-text\">403</code> means the client requested a forbidden resource. This code is sometimes confused with <code class=\"language-text\">401 Unauthorized</code> ‚Äî the meanings seem ambiguous, but there‚Äôs one clear difference.</p>\n<p><code class=\"language-text\">401</code> literally means unauthenticated ‚Äî the backend can‚Äôt identify who the current requester is. The server is saying ‚Äúidentify yourself!‚Äù</p>\n<p>With <code class=\"language-text\">403</code>, however, the backend doesn‚Äôt care at all who the requester is. Whether the client identified themselves or not, authenticated or not ‚Äî accessing this resource is unconditionally forbidden.</p>\n<p>Servers may also return <code class=\"language-text\">403</code> when a resource requiring HTTPS is accessed via HTTP.</p>\n<p><strong>404 Not Found</strong></p>\n<p>Status code <code class=\"language-text\">404</code> simply means the requested resource doesn‚Äôt exist.</p>\n<p><strong>405 Method Not Allowed</strong></p>\n<p>Status code <code class=\"language-text\">405</code> means the wrong HTTP method was used for the current resource. Many backend frameworks automatically return <code class=\"language-text\">405</code> when a controller doesn‚Äôt have logic for the requested method.</p>\n<p><strong>406 Not Acceptable</strong></p>\n<p>Status code <code class=\"language-text\">406</code> means that even after <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation#server-driven_content_negotiation\" target=\"_blank\" rel=\"nofollow\">server-driven content negotiation</a>, no suitable content type was found.</p>\n<p>When a client requests a resource, it uses the <code class=\"language-text\">Accept</code> header field to specify what content types it wants. If this field isn‚Äôt explicitly set, browsers typically fill in a few default types like <code class=\"language-text\">text/html</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-http line-numbers\"><code class=\"language-http\">GET http://evan.com/\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">text/html,application/xhtml+xml,application/xml,*/*</span></span>\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The server checks the <code class=\"language-text\">Accept</code> field from left to right, looking for a content type that matches the requested resource. If found, it specifies that type in the response‚Äôs <code class=\"language-text\">Content-Type</code> header.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">HTTP/1.1 200 OK\nContent-Type: text/html</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Since the server decides which content type to return, this process is called ‚Äúserver-driven content negotiation.‚Äù In the example above, the first-priority <code class=\"language-text\">text/html</code> was returned. If <code class=\"language-text\">text/html</code> doesn‚Äôt exist, the server tries <code class=\"language-text\">application/xhtml+xml</code>, then <code class=\"language-text\">application/xml</code>, and so on.</p>\n<p>If none of the listed types are available, the wildcard <code class=\"language-text\">*/*</code> at the end catches everything, and the server responds with whatever content type it has. But if even after checking all requested types no matching resource exists, the server returns <code class=\"language-text\">406</code>: ‚Äúno resource matching your requested content types.‚Äù</p>\n<p><strong>408 Request Timeout</strong></p>\n<p>Status code <code class=\"language-text\">408</code> means the connection between client and server was established, but the request body never arrived.</p>\n<p>HTTP communication first establishes a connection, then transmits the request body data. <code class=\"language-text\">408</code> occurs when the connection was properly established but the server never receives the request body no matter how long it waits.</p>\n<p><strong>429 Too Many Requests</strong></p>\n<p>Status code <code class=\"language-text\">429</code> occurs when the client sends too many requests to the server. ‚ÄúToo many‚Äù could mean firing off requests so rapidly that the server says ‚Äúwhoa, calm down.‚Äù For paid APIs, it can also mean ‚Äúyou‚Äôve exceeded your allowed request count ‚Äî pay more.‚Äù</p>\n<p>The server can include a <code class=\"language-text\">Retry-After</code> header with the <code class=\"language-text\">429</code> response to tell the client ‚Äútry again after this amount of time.‚Äù</p>\n<h3 id=\"500-level\" style=\"position:relative;\">500-Level<a href=\"#500-level\" aria-label=\"500 level permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>500-level codes mean something went wrong on the server side. If you spot one, something is broken on the server ‚Äî time to have a word with the backend developer.</p>\n<p><strong>500 Internal Server Error</strong></p>\n<p>Status code <code class=\"language-text\">500</code> means some unknown error occurred in the backend application. It‚Äôs usually an unhandled error, which is why the error cause isn‚Äôt communicated to the client. <small><strike>(More like it can‚Äôt be communicated in most cases.)</strike></small></p>\n<p>Exposing unhandled error details to the client also poses a significant security risk, so <code class=\"language-text\">500</code> typically just signals that an error occurred. If you encounter this, I recommend checking server logs or leveraging error monitoring solutions like <a href=\"https://sentry.io/welcome/\" target=\"_blank\" rel=\"nofollow\">Sentry</a> or <a href=\"https://www.bugsnag.com/\" target=\"_blank\" rel=\"nofollow\">Bugsnag</a>.</p>\n<p><strong>502 Bad Gateway</strong></p>\n<p>The most common scenario for status code <code class=\"language-text\">502</code> is when the backend application has died. But why does it say ‚ÄúBad Gateway‚Äù instead of something more direct like ‚ÄúServer Died‚Äù?</p>\n<p>Because no matter how simple a backend architecture is, it‚Äôs never just a single application. The ‚Äúgateway‚Äù here refers to an abstract connection point between applications, and as the name implies, backend architectures are typically composed of at least two or more applications.</p>\n<p>In typical setups, client requests don‚Äôt go directly to the backend application. There‚Äôs usually a server engine like Apache or Nginx, or a load balancer, sitting in front to receive requests and forward them to the backend application.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token directive\"><span class=\"token keyword\">server_name</span> evan.com</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://127.0.0.1:3000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_http_version</span> 1.1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> Upgrade <span class=\"token variable\">$http_upgrade</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> Connection <span class=\"token string\">'upgrade'</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> Host <span class=\"token variable\">$host</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_cache_bypass</span> <span class=\"token variable\">$http_upgrade</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With a typical Nginx setup like this, Nginx listens on port 80, receives HTTP requests, and forwards them to the backend application running on port 3000.</p>\n<p>This architecture exists for security and processing efficiency. Backend applications aren‚Äôt bulletproof, so you can‚Äôt blindly feed them all requests. And expecting clients to always send safe requests is equally unrealistic.</p>\n<p>Plus, simple requests that just need to locate and serve files don‚Äôt need to bother the already-busy backend application ‚Äî the server engine can handle those directly.</p>\n<p>So the backend places a proxy server at the front to act as a gatekeeper. The abstract passage connecting this proxy server to the backend application is called the ‚Äúgateway.‚Äù When the backend application dies, the gatekeeper proxy receives no response and sends <code class=\"language-text\">502 Bad Gateway</code> to the client.</p>\n<p><strong>503 Service Unavailable</strong></p>\n<p>Status code <code class=\"language-text\">503</code> means the server isn‚Äôt ready to handle requests. It‚Äôs sometimes used similarly to <code class=\"language-text\">502 Bad Gateway</code>, but <code class=\"language-text\">503</code> implies a <strong>temporary</strong> situation ‚Äî typically when the server is under heavy load and doesn‚Äôt have the capacity to handle the current request.</p>\n<p>In AWS Lambda, this can occur when processing a request requires more resources than the concurrent container execution limit, or when a task‚Äôs processing time exceeds the container‚Äôs maximum lifespan setting.</p>\n<p>Since <code class=\"language-text\">503</code> indicates a temporary situation, it can also use the <code class=\"language-text\">Retry-After</code> response header ‚Äî same as <code class=\"language-text\">429 Too Many Requests</code> ‚Äî to tell the client ‚Äútry again after this amount of time.‚Äù</p>\n<p><strong>504 Gateway Timeout</strong></p>\n<p>Status code <code class=\"language-text\">504</code>, like <code class=\"language-text\">408</code>, indicates a request timeout. However, <code class=\"language-text\">504</code> isn‚Äôt caused by the client‚Äôs request timing out ‚Äî it occurs within the backend architecture, between servers communicating with each other.</p>\n<p>As I mentioned, backend architecture isn‚Äôt just a single application. Even after a client‚Äôs request reaches the server, internal communication between backend applications continues. If Nginx (acting as a proxy) forwards a client request to the backend application but receives no response within a set time, Nginx returns <code class=\"language-text\">504 Gateway Timeout</code> to the client.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I originally planned to cover RESTful APIs alongside HTTP status codes in this post, but once again I failed spectacularly at controlling the length and had to split it into separate posts. <small>(This is happening more and more frequently‚Ä¶)</small></p>\n<p>As I mentioned, not following standards like status codes won‚Äôt cause program errors, so they‚Äôre easy to brush off. But defining clearer interfaces makes program behavior more predictable and greatly helps communication between frontend and backend developers ‚Äî so I recommend following the standards whenever possible.</p>\n<p>That wraps up this post on HTTP status codes ‚Äî the server‚Äôs way of talking back.</p>","fields":{"slug":"20200315-about-http-status-code-en","path":"/2020/03/15/about-http-status-code/en/","lang":"en"},"frontmatter":{"title":"HTTP Status Codes: The Server's Way of Talking Back","subTitle":"The small numbers that keep the internet in order","date":"Mar 15, 2020","categories":["Programming","Network","Architecture"],"tags":["HTTP","HTTP Status Code","RESTful","Axios","HTTP Status"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/14576b0c5dc2ed40f94b7160f16c1e06/d803c/thumbnail.png","srcSet":"/static/14576b0c5dc2ed40f94b7160f16c1e06/d803c/thumbnail.png 320w,\n/static/14576b0c5dc2ed40f94b7160f16c1e06/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/14576b0c5dc2ed40f94b7160f16c1e06/fc5c5/thumbnail.webp 320w,\n/static/14576b0c5dc2ed40f94b7160f16c1e06/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/14576b0c5dc2ed40f94b7160f16c1e06/01fb2/thumbnail.png","srcSet":"/static/14576b0c5dc2ed40f94b7160f16c1e06/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/14576b0c5dc2ed40f94b7160f16c1e06/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"fab189b7-7e6c-5c9e-b403-8ee13807fe24","tableOfContents":"<ul>\n<li>\n<p><a href=\"#congestion-window-cwnd\">Congestion Window (CWND)</a></p>\n<ul>\n<li><a href=\"#initializing-the-congestion-window-size\">Initializing the Congestion Window Size</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#congestion-avoidance-methods\">Congestion Avoidance Methods</a></p>\n<ul>\n<li><a href=\"#aimd\">AIMD</a></li>\n<li><a href=\"#slow-start\">Slow Start</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#congestion-control-policies\">Congestion Control Policies</a></p>\n<ul>\n<li><a href=\"#3-ack-duplicated-timeout\">3 ACK Duplicated, Timeout</a></li>\n<li><a href=\"#slow-start-threshold-ssthresh\">Slow Start Threshold (ssthresh)</a></li>\n<li><a href=\"#tcp-tahoe\">TCP Tahoe</a></li>\n<li><a href=\"#tcp-reno\">TCP Reno</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"Congestion control is exactly what it sounds like ‚Äî detecting network congestion and controlling data transmission to resolve it. The network is such a vast black box that it‚Äôs hard to pinpoint exactly where or why transmission is slowing down. But each endpoint can at least detect ‚Äúthings are getting slow.‚Äù If you send data and the response from the other party comes late or doesn‚Äôt come at all, something is clearly wrong.","html":"<p>Congestion control is exactly what it sounds like ‚Äî detecting network congestion and controlling data transmission to resolve it.</p>\n<p>The network is such a vast black box that it‚Äôs hard to pinpoint exactly where or why transmission is slowing down. But each endpoint can at least detect ‚Äúthings are getting slow.‚Äù If you send data and the response from the other party comes late or doesn‚Äôt come at all, something is clearly wrong.</p>\n<!-- more -->\n<p>When using only the flow control and error control techniques discussed earlier, retransmission inevitably keeps happening.</p>\n<p>If just one or two hosts are doing this, it might not be a big deal. But since the network is a shared space used by all sorts of participants, once things start going wrong, everyone starts shouting ‚ÄúI‚Äôm retransmitting too!‚Äù ‚Äî making the problem progressively worse. This is called congestion collapse.</p>\n<p>So when network congestion is detected, the sender forcibly reduces its data transmission volume by adjusting its window size, in order to avoid this worst-case scenario. This is congestion control.</p>\n<h2 id=\"congestion-window-cwnd\" style=\"position:relative;\">Congestion Window (CWND)<a href=\"#congestion-window-cwnd\" aria-label=\"congestion window cwnd permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In my post <a href=\"/2019/11/22/tcp-flow-control-error-control/\">TCP‚Äôs Flow Control and Error Control</a>, I mentioned that the sender‚Äôs window size is determined by considering both the receiver‚Äôs reported window size and the current network conditions.</p>\n<p>When determining its final window size, the sender uses the smaller of two values: the receiver window (RWND) ‚Äî the window size reported by the receiver ‚Äî and the congestion window (CWND) ‚Äî the window size the sender determined based on network conditions.</p>\n<p>In other words, the window size that the congestion control techniques below increase and decrease is not the send window itself, but the sender‚Äôs ‚Äúcongestion window size.‚Äù</p>\n<p>Note that since both RWND and CWND have ‚Äúwindow‚Äù in their names, you might think they‚Äôre the same as the window used in sliding window. But they‚Äôre just numbers representing the receiver‚Äôs window size and the congestion window size, respectively.</p>\n<p>So while the congestion window size can be flexibly adjusted based on network congestion during communication, how is it initialized before communication even starts?</p>\n<h3 id=\"initializing-the-congestion-window-size\" style=\"position:relative;\">Initializing the Congestion Window Size<a href=\"#initializing-the-congestion-window-size\" aria-label=\"initializing the congestion window size permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>During communication, information like lost ACKs or timeouts can be used to infer network congestion. But before communication begins, none of that information exists, making it tricky to set the congestion window size. This is where MSS (Maximum Segment Size) comes in.</p>\n<p>MSS represents the maximum amount of data that can be sent in a single segment, and can be roughly calculated as:</p>\n<blockquote>\n<p><strong>MSS</strong> = MTU - (IP header length + IP option length) - (TCP header length + TCP option length)</p>\n</blockquote>\n<p>MTU (Maximum Transmission Unit) represents the maximum unit that can be sent in a single transmission.</p>\n<p>In other words, MSS tells you how much space is left for actual data after stripping away all the non-data parts like IP and TCP headers from the maximum transmission unit.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5b899382aa98f56f7c00f116ac55322e/d4b10/mtu-setting.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 79.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABsUlEQVR42u2UTWvbQBCG/UsM/pZlrVa7UqwoFlFqJ/ZBliyToIZeGsgtl5IcShqb9tyfbFh4OyPZJZdS0XMPDzPD7j6aRcy2xuNxaLveq22LZ8uyXobDYSOsYafGotyy+Owru1qTyWQvog8IowujtYJSNb7vQ2td8T6v92gIdQHhx7AdCRIZxxEc963RaLSTroQQ4hBFkdlutybLMlMURRWz9dps8tzklDNFnpl0Uxo/35mg/GnsMDWuYx1c6YFdLNzzlz3PMwSklJwjSRLMb24QX17iaj7HgvKr+QL+2Rkkd6gDuJ6q9vJZvhW7KiEXJ2EFSYPpFJ9W13hYLfDt8TPeiC/3d3i63RA57vNHBPqcGnD/LlSEQ9IH38FTco79XY4fHwt8Lzf4mi3xkl7jeXWLRAVwPNmgw5OYpNqlDoSAOsJ1jaA9suGV3yGrqI54f6K5sCH/hf8g5AFw6W8fY3X2JNyxkBYOvNAEGlOae23CMDzFw5QGoRo9fhy4sG3bEGgCvSyYzWYoyxJxHCNNU7NcLusOu93ugJ6jYjAYpP1+f92UTqfzm3a7nfZ6vYJdvwDAltCnclfZvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mtu setting\" title=\"\" src=\"/static/5b899382aa98f56f7c00f116ac55322e/6af66/mtu-setting.png\" srcset=\"/static/5b899382aa98f56f7c00f116ac55322e/69538/mtu-setting.png 160w,\n/static/5b899382aa98f56f7c00f116ac55322e/72799/mtu-setting.png 320w,\n/static/5b899382aa98f56f7c00f116ac55322e/6af66/mtu-setting.png 640w,\n/static/5b899382aa98f56f7c00f116ac55322e/d9199/mtu-setting.png 960w,\n/static/5b899382aa98f56f7c00f116ac55322e/21b4d/mtu-setting.png 1280w,\n/static/5b899382aa98f56f7c00f116ac55322e/d4b10/mtu-setting.png 1394w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If you dig around in system preferences, you can find a setting to change the default MTU</small>\n</center>\n<p>On macOS, the default MTU is set to the Ethernet standard of <code class=\"language-text\">1500 bytes</code>. If the TCP and IP headers are each 20 bytes, then MSS is <code class=\"language-text\">1500 - 40 = 1460 bytes</code>.</p>\n<p>The sender initializes the congestion window size to <code class=\"language-text\">1 MSS</code> when first starting communication. From there, it increases or decreases the congestion window size based on network congestion as communication proceeds.</p>\n<h2 id=\"congestion-avoidance-methods\" style=\"position:relative;\">Congestion Avoidance Methods<a href=\"#congestion-avoidance-methods\" aria-label=\"congestion avoidance methods permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP, the grandpa protocol, has accumulated a diverse set of congestion control policies over the past 50 years.</p>\n<p>Each policy has evolved by improving how to identify congestion and how to increase or decrease the congestion window size. But the most fundamental congestion control approach combines two avoidance methods ‚Äî AIMD and Slow Start ‚Äî as the situation demands.</p>\n<p>So in this post, I‚Äôll first explain AIMD and Slow Start, then discuss the representative congestion control policies Tahoe and Reno.</p>\n<h3 id=\"aimd\" style=\"position:relative;\">AIMD<a href=\"#aimd\" aria-label=\"aimd permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>AIMD (Additive Increase / Multiplicative Decrease) means exactly what it says. When the network seems fine and you want to speed up transmission, you increase the congestion window size by 1. But when congestion is detected ‚Äî data loss, missing responses ‚Äî you cut the congestion window size in half.</p>\n<p>Increase: <code class=\"language-text\">ws + 1</code>. Decrease: <code class=\"language-text\">ws * 0.5</code>. Literally additive increase, multiplicative decrease. Because of this characteristic ‚Äî linear growth and sharp halving ‚Äî graphing the congestion window size of a connection using AIMD produces a sawtooth pattern.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 571px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFElEQVR42oVRi26DMAzk/3+xUmkF0rpAV5oEJ3ZiZw70RTdtkWXsC3ecjkamqYjgPAdrS0qF6P9CLHratikxWueGYcAVKkXK+5G3QZZn1zV0vSJRAFjJshT/FNiI3cn9bjcDpJRijOvVnGVEfv3UGQVyHcOq+iCPXaeejTEnX8k+i0+i3S5dEZfkQkxcVxMrLyS+kU/7vdoWEeOCy/VVxUeUz8iqomtkQa5e5kXxmoQyP22P57OdLh8u2lQeztXhgMqsK/LNxRdW/GnbHA7W+9l7iPgWbJbfM3+S2Xsdcs6PwP7+WxuyAKxkH0JUCY39XoHIAWh/BSuOCMyl75viXNEpJdmW6hFA17ao6jlvbolqFMfjN/U+hHTP2SsOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"aimd\" title=\"\" src=\"/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png\" srcset=\"/static/1f8521aeeab86f9056a053a93f69adb1/69538/aimd.png 160w,\n/static/1f8521aeeab86f9056a053a93f69adb1/72799/aimd.png 320w,\n/static/1f8521aeeab86f9056a053a93f69adb1/17d73/aimd.png 571w\" sizes=\"(max-width: 571px) 100vw, 571px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Gradual increase, sharp decrease</small>\n</center>\n<p>This approach is remarkably simple, yet surprisingly fair. Imagine several hosts are already occupying the network when a latecomer joins.</p>\n<p>Naturally, the latecomer starts with a smaller congestion window and is at a disadvantage. But when congestion hits, the host with the larger window is more likely to lose data from trying to push too much through. That host then reduces its window size to resolve the congestion, freeing up bandwidth for the latecomers to grow their windows.</p>\n<p>Over time, regardless of when each host joined the network, all hosts‚Äô window sizes converge to an equilibrium.</p>\n<p>However, AIMD‚Äôs weakness is that even when bandwidth is plentiful, it increases the window size too slowly. It takes time to reach full network utilization.</p>\n<h4 id=\"window-sizes-really-converge\" style=\"position:relative;\">Window Sizes Really Converge?<a href=\"#window-sizes-really-converge\" aria-label=\"window sizes really converge permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>AIMD is simple enough that you can simulate the network behavior with a basic example. Doing so lets you actually see what ‚Äúwindow sizes converging to equilibrium‚Äù means.</p>\n<p>I was going to include the code in this post, but trying to simulate something close to real network conditions made it longer than expected, so I‚Äôll just share the results. Here‚Äôs my experimental setup:</p>\n<blockquote>\n<ol>\n<li>Maximum network congestion is <code class=\"language-text\">50</code>, determined by the sum of all hosts‚Äô congestion window sizes.</li>\n<li>A new host is added to the network every <code class=\"language-text\">300ms</code>.</li>\n<li>Each host calculates current network congestion every <code class=\"language-text\">100-200ms</code> and adjusts its window size.</li>\n<li>Each host performs 300 window size adjustments before leaving the network.</li>\n</ol>\n</blockquote>\n<p>A small caveat: I used <code class=\"language-text\">setInterval</code> for concurrency, but since <code class=\"language-text\">setInterval</code> callbacks go through the event loop and execute on the call stack, true parallelism isn‚Äôt guaranteed like in a real network. But this doesn‚Äôt affect the test‚Äôs purpose ‚Äî verifying that latecomers can achieve adequate congestion window sizes.</p>\n<p>For more on this concept, check out my post <a href=\"/2019/08/01/nodejs-event-loop-workflow/\">A Low-Level Look at the Node.js Event Loop</a>.</p>\n<p>Here‚Äôs the time-series visualization of the test data. First, let‚Äôs look at each host‚Äôs congestion window size changes:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/019ed4a2768805580d59e27bb7099b7a/42267/cwnd-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwElEQVR42q2PC27EIAxEuf8lGyUbIKRhtyp/Q2Yn6RG2lkbPRuMPylqLGCOuOM8Tn4YSEfxbjBNqjPHxdec9i3OkQ5WSIU2oDpHGwQODm6R3tCHMBa1X1o2efHtqqehkbxUxBJRLKdw+Zc0DevmCNQs5YdMP7FbDmRVW803P5AyzLuQEw1zPE9w6Y2ePf37fSikjlAR1bSulIOeEWiuZ8fMb8Do2+MPBbzv5ZO3JF7x3cP5AiH9+aQ2Zv6zt6i14AwNI1E8L97aCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cwnd chart\" title=\"\" src=\"/static/019ed4a2768805580d59e27bb7099b7a/6af66/cwnd-chart.png\" srcset=\"/static/019ed4a2768805580d59e27bb7099b7a/69538/cwnd-chart.png 160w,\n/static/019ed4a2768805580d59e27bb7099b7a/72799/cwnd-chart.png 320w,\n/static/019ed4a2768805580d59e27bb7099b7a/6af66/cwnd-chart.png 640w,\n/static/019ed4a2768805580d59e27bb7099b7a/d9199/cwnd-chart.png 960w,\n/static/019ed4a2768805580d59e27bb7099b7a/21b4d/cwnd-chart.png 1280w,\n/static/019ed4a2768805580d59e27bb7099b7a/42267/cwnd-chart.png 2670w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The graph shows that early arrivals and latecomers don‚Äôt have dramatically different congestion window sizes. The lone spike at the end is from the last host having the network all to itself after everyone else left.</p>\n<p>This visualization confirms that each host‚Äôs congestion window size converges to roughly the same range. What about the total window size of all hosts in the network?</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/1192d/total-cwnd-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLUlEQVR42p2Qy3KjMBBF+f9/SxYm2OIlAQI9MA8Bg+MpV3JGk+Usp6vOpvv2qa5OnHWEEOD7m/+qf/aSM9w5TMfsNfPYck6Oc/bss+WxTjy2Kc5atr/9yfK53HmOltd58PXr5HfT8YpHvab5h0T3NXn2TpWlCCkQuqHsFaK7cpEZuUjJ8pSyEBTygiw/EJFS3TDVhSF/RxdvTDHzTK8kk8qZpGZRI1vZcHSOpb0zSEMrO7y44a6Ce11jqwot2yhqcXqgUJI8HnCzksJdWUVGImKwURWqiUT50Hzg2iIKFabJaLqM1tzoBoEtUroyo68UoS4ZlaIeN3y/YgeHVClJOB5sx8G6B8Kx/+CXBeM0xg+YGLR+xjpPH39lxh7tLcsaOPaNz/3kuUWiJ+wrfwA1Vr7W2+QK4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"total cwnd chart\" title=\"\" src=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/6af66/total-cwnd-chart.png\" srcset=\"/static/cf2d9c677da47dfd6436a1e7c31ef13d/69538/total-cwnd-chart.png 160w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/72799/total-cwnd-chart.png 320w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/6af66/total-cwnd-chart.png 640w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/d9199/total-cwnd-chart.png 960w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/21b4d/total-cwnd-chart.png 1280w,\n/static/cf2d9c677da47dfd6436a1e7c31ef13d/1192d/total-cwnd-chart.png 2662w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The total congestion window sizes across all hosts clearly stay below the congestion threshold of <code class=\"language-text\">50</code> I set, with hosts jockeying back and forth to adjust their window sizes.</p>\n<p>Excluding the early and late phases when hosts are joining and leaving, the middle portion shows that individual congestion window sizes don‚Äôt vary significantly.</p>\n<p>Running this simulation and seeing the data made the abstract concept of ‚Äúwindow sizes converging to equilibrium‚Äù much more tangible.</p>\n<p>If you‚Äôd like to run the code yourself and observe the entire process, you can clone it from my <a href=\"https://github.com/evan-moon/tcp-congestion-test\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>.</p>\n<h3 id=\"slow-start\" style=\"position:relative;\">Slow Start<a href=\"#slow-start\" aria-label=\"slow start permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, AIMD increases window size linearly, so it takes a while to reach proper speed.</p>\n<p>These days, with generous network bandwidth and excellent infrastructure, congestion occurs far less frequently than before. This has made AIMD‚Äôs drawback ‚Äî taking too long to reach full speed even when no congestion exists ‚Äî increasingly prominent.</p>\n<p>Slow Start shares the same basic principle as AIMD, but increases the window size exponentially. When congestion is detected, it drops the window size to <code class=\"language-text\">1</code>.</p>\n<p>This approach increases window size each time an ACK arrives, so it may start slowly, but the window grows progressively faster over time.</p>\n<p>Since the only difference from AIMD is how the window size increases and decreases, adjusting the window-sizing logic in the earlier example produces a Slow Start chart:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/88ad13152143dd8acea98a68b149d91e/963fa/slow-start-chart.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVR42lWRi27DIAxF+///uE1qt5BACoSEBMLjzM20SUNcXWzZx5a4aa3x3lHLCb3L/dHr/Hrr7Z/31mmt/dVUiXutl27btpFSoJ6RnjOlV0orV3E5s3RArlmsX37l08lxHAJr5FwJqZD9ShHdjnQQD097AY+dVE9ySxco7dJUMnuKAknEUwbXfgFfizTZKO6FReLsN8oiwBhXpvGNyXyyzhPKGmyYWZcNqw1BK+xz5qnu3Md3zKAIUjd8Kpy8H4Pmy1jMx4M4W25JVvfeYkVhDSxhwYeA1iPmqdFKYQSsJ8WoRskPMlzjnCc4J25x8gfWOpYl8A3H6YItahN4cgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow start chart\" title=\"\" src=\"/static/88ad13152143dd8acea98a68b149d91e/6af66/slow-start-chart.png\" srcset=\"/static/88ad13152143dd8acea98a68b149d91e/69538/slow-start-chart.png 160w,\n/static/88ad13152143dd8acea98a68b149d91e/72799/slow-start-chart.png 320w,\n/static/88ad13152143dd8acea98a68b149d91e/6af66/slow-start-chart.png 640w,\n/static/88ad13152143dd8acea98a68b149d91e/d9199/slow-start-chart.png 960w,\n/static/88ad13152143dd8acea98a68b149d91e/21b4d/slow-start-chart.png 1280w,\n/static/88ad13152143dd8acea98a68b149d91e/963fa/slow-start-chart.png 2666w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>You‚Äôll notice cases where hosts‚Äô congestion windows exceed the maximum congestion threshold of <code class=\"language-text\">50</code> I set. This is an artifact of how JavaScript processes <code class=\"language-text\">setInterval</code> callbacks and wouldn‚Äôt happen in a real network. (The congestion calculation is also far more complex in reality.)</p>\n<p>The biggest difference between the AIMD and Slow Start graphs is the time to reach peak network congestion.</p>\n<p>AIMD grows window size linearly, so it can‚Äôt claim much bandwidth when new hosts join. Slow Start grows slowly at first but then ramps up exponentially when there‚Äôs still headroom, ultimately growing the window size faster than AIMD.</p>\n<p>Modern TCP policies like Tahoe and Reno blend AIMD and Slow Start, differing primarily in how they respond when congestion occurs.</p>\n<h2 id=\"congestion-control-policies\" style=\"position:relative;\">Congestion Control Policies<a href=\"#congestion-control-policies\" aria-label=\"congestion control policies permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP has a dizzying array of congestion control policies ‚Äî Tahoe, Reno, New Reno, CUBIC, and even the recent Elastic-TCP, to name just a few.</p>\n<p>These policies all share the premise that when congestion occurs, you reduce (or stop increasing) the window size to avoid it. Newer methods detect congestion more intelligently and utilize network bandwidth more quickly and safely.</p>\n<p>Covering all of them here would be impractical, so I‚Äôll focus on the most representative and well-known policies ‚Äî Tahoe and Reno ‚Äî to explain the fundamentals of congestion control.</p>\n<p>Both Tahoe and Reno start with Slow Start, then switch to AIMD when the network feels congested.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8ee0d539b474748716d8e1199b313356/1ac29/taheo_reno.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTUlEQVR42jWR2W7cMAxF/f+/0y8IigB9aoAm89RinIkXWV4lUQu1l/a050UUyQuKV42/SClFIl3EmFMqpeRc2G7bSd4nYTE8W2I8g5wzRU0IgcRn50VMOZUK2nDOJz6//Ly9vN1+3DpwodZycR61VmpuhBDGmKcy5PL66/Ht+/vrR6+0WI/BovRJk4zmLPM8jmM3PCxSptITm/u9lVJRzVqLQsiB8aE9YMGgaUJyqJbRewQFSstDcbGOARRqbYxt2rYFpRQAa1u9rrXUADJEF0OEiblt1+vk0Gz7ssxfou/stjtjNBwAuiGhQ0zOeSlzrWSap4zW7M/v/vPT+eD0Ifd5490x9HxkI2Nkx3PNJuWMAG5bYwhkMl291noYOGNCStrNGnns3eNx/+r68t804p/baIxHxOvP8MIAhBjdCRWNc/YQgta2F5Q9N1XqL8UGx+8sa/crAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"taheo reno\" title=\"\" src=\"/static/8ee0d539b474748716d8e1199b313356/6af66/taheo_reno.png\" srcset=\"/static/8ee0d539b474748716d8e1199b313356/69538/taheo_reno.png 160w,\n/static/8ee0d539b474748716d8e1199b313356/72799/taheo_reno.png 320w,\n/static/8ee0d539b474748716d8e1199b313356/6af66/taheo_reno.png 640w,\n/static/8ee0d539b474748716d8e1199b313356/d9199/taheo_reno.png 960w,\n/static/8ee0d539b474748716d8e1199b313356/1ac29/taheo_reno.png 1022w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Red represents Tahoe, green represents Reno's window size</small>\n</center>\n<p>The Y-axis shows the congestion window and the X-axis shows time. Before diving into Tahoe and Reno, let me quickly cover a few terms to help you understand what this graph is showing.</p>\n<p>Let‚Äôs look at the ‚Äú3 ACK Duplicated‚Äù and ‚ÄúTimeout‚Äù labels where the graph bends, and the ‚ÄúThreshold‚Äù where the growth rate changes. (The spelling in the diagram looks off because it‚Äôs Italian, not English ‚Äî don‚Äôt worry about it.)</p>\n<h3 id=\"3-ack-duplicated-timeout\" style=\"position:relative;\">3 ACK Duplicated, Timeout<a href=\"#3-ack-duplicated-timeout\" aria-label=\"3 ack duplicated timeout permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Both methods reduce the window size when two scenarios occur: 3 ACK Duplicated and Timeout. These are the fundamental situations that congestion control policies use to detect congestion.</p>\n<p>Timeout means the sender‚Äôs data was lost or the receiver‚Äôs ACK was lost due to various factors.</p>\n<p>3 ACK Duplicated ‚Äî receiving the same acknowledgment number three or more times ‚Äî is also abnormal. Since the receiver only sends ACKs for data it successfully processed, receiving the same acknowledgment number three times suggests the receiver couldn‚Äôt properly process data after a certain sequence number.</p>\n<p>However, since TCP uses packet-based transmission where arrival order isn‚Äôt guaranteed, one or two duplicate acknowledgment numbers don‚Äôt immediately indicate congestion.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/41dd4882153e87b8f1db9ae7f6353451/813c1/fast-transmit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.12499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42o1T223CQBAcx287NsGghIBBSWpASgtpIQ3wTy9UQXNpIXt4VlkdtnMrjVl79+ZmHwBAhMEWgqPgA+Omee+CT8EbAuxZ8Ch4ECQTOS7WmAtm7UlQCmpBQb8geWyU1iFkOAPdF9CegAoD3MGcqgtz2ZJ+Mkv4DawvcvhHlF7/SlfilhW07N+eF81a7/ooj7IbDqqyVJDRd/17EaxCSneJa6pQwoa/NUkTxhIi5/fYnxyYWNDX5NIQuriIx5YbsaG/YezOdAixUaDEOii3rwcS9eznjvvrqrkp0jV5ZeMjEqVmZSx0YLEXv1Xamdu2fG/MMMb+MWF76O1WZtRXfE9JWP1HFI0Q+vGcaNizIMv98U+QTyr8BdWrC5EqySd2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"fast transmit\" title=\"\" src=\"/static/41dd4882153e87b8f1db9ae7f6353451/6af66/fast-transmit.png\" srcset=\"/static/41dd4882153e87b8f1db9ae7f6353451/69538/fast-transmit.png 160w,\n/static/41dd4882153e87b8f1db9ae7f6353451/72799/fast-transmit.png 320w,\n/static/41dd4882153e87b8f1db9ae7f6353451/6af66/fast-transmit.png 640w,\n/static/41dd4882153e87b8f1db9ae7f6353451/d9199/fast-transmit.png 960w,\n/static/41dd4882153e87b8f1db9ae7f6353451/21b4d/fast-transmit.png 1280w,\n/static/41dd4882153e87b8f1db9ae7f6353451/813c1/fast-transmit.png 2004w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>TCP uses cumulative acknowledgment ‚Äî it sends the acknowledgment number for the last correctly received data in sequence. So if the sender keeps receiving the same acknowledgment number, it knows that data up to that point was transmitted successfully, but something went wrong after that.</p>\n<p>When 3 duplicate ACKs trigger immediate retransmission of the corresponding data, the receiver then uses its error control method (Go Back N or Selective Repeat) to tell the sender which packets to send next.</p>\n<p>In this situation, the sender can retransmit the packet immediately without waiting for its timeout ‚Äî a technique called <a href=\"https://www.isi.edu/websites/nsnam/DIRECTED_RESEARCH/DR_HYUNAH/D-Research/fast-retransmit.html\" target=\"_blank\" rel=\"nofollow\">Fast Retransmit</a>.</p>\n<p>Without Fast Retransmit, the sender would have to wait until its timeout expires before responding, wasting time before retransmitting the errored data.</p>\n<h3 id=\"slow-start-threshold-ssthresh\" style=\"position:relative;\">Slow Start Threshold (ssthresh)<a href=\"#slow-start-threshold-ssthresh\" aria-label=\"slow start threshold ssthresh permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Looking at the Tahoe vs. Reno graph, you‚Äôll notice the word ‚ÄúThreshold‚Äù appearing frequently. This refers to the Slow Start Threshold (ssthresh), meaning ‚ÄúI‚Äôll only use Slow Start up to this point.‚Äù</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 539px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFUlEQVR42pWSSW6FQAxEuf/N2HABJMQkJiEQ8/zJC/VFfkhvUouW2+6yXW1b53nWde37fhRF4zie/4HV932WZWVZ7vt+HMf+G/Ks64phIA/DUBRF0zT7H2zbNs/zeAG+gTxNUxAESZJsH4ApGsbrAk4DmZR03rYtLz4DMJdlkW0k47RkUedBRg5ljWT1RVUrDMM4jpHNRToV67oOj64YqLsNOtL/fX8YHfKUu+TxgrDEy0NIEjjJ+6P5Vnh/r97pw2+ypkXoU50lSYyqvUAW8dXRdAGDEP7HLN+VqSnN92IoxXFBHUmOQMaqqt5klUI5q4pXw8vzvLigLXgMMk1T6x4GJ0vK53ueh6GddxzHtm3XdY27/QXAbvf3UeGvvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ssthresh\" title=\"\" src=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png\" srcset=\"/static/4dd1f6d8c7b9d31ff90f21619da03947/69538/ssthresh.png 160w,\n/static/4dd1f6d8c7b9d31ff90f21619da03947/72799/ssthresh.png 320w,\n/static/4dd1f6d8c7b9d31ff90f21619da03947/10f9a/ssthresh.png 539w\" sizes=\"(max-width: 539px) 100vw, 539px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The reason for this threshold is that exponentially increasing window size with Slow Start eventually leads to uncontrollable growth. When congestion seems imminent, it‚Äôs much safer to increase cautiously and incrementally rather than aggressively.</p>\n<p>Think of it simply: if the current window size is <code class=\"language-text\">10</code> and the remaining network capacity is <code class=\"language-text\">15</code>, Slow Start would blow past <code class=\"language-text\">20</code>, but additive increase gives you about 5 more rounds of safe growth.</p>\n<p>So a threshold is set, and once exceeded, AIMD‚Äôs linear increase is used instead. That‚Äôs why it‚Äôs called the Slow Start Threshold.</p>\n<p>The sender initializes ssthresh to half its congestion window ‚Äî <code class=\"language-text\">0.5 MSS</code> ‚Äî before communication begins, then responds differently depending on which congestion control method is being used.</p>\n<h3 id=\"tcp-tahoe\" style=\"position:relative;\">TCP Tahoe<a href=\"#tcp-tahoe\" aria-label=\"tcp tahoe permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP Tahoe is an early congestion control policy using Slow Start, and the first to introduce the Fast Retransmit technique. Policies developed after Tahoe use Fast Retransmit as a baseline, adding refinements for efficiency.</p>\n<p>Fun fact: TCP Tahoe is named after Lake Tahoe in Nevada. So it‚Äôs pronounced ‚ÄúTah-ho.‚Äù (Not ‚ÄúTah-ho-ay‚Äù!)</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/672252932977a8df688679a0e462d3c2/01ab0/lake_tahoe.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABds1gbSUt/8QAGhABAQACAwAAAAAAAAAAAAAAAQIAAwQRIf/aAAgBAQABBQKd9mOyXHkyM0invQZ//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AbGP/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEDERP/2gAIAQIBAT8BUlGjP//EABoQAAICAwAAAAAAAAAAAAAAAAAREDEhMqH/2gAIAQEABj8CpmWzXpc//8QAGBABAQEBAQAAAAAAAAAAAAAAAQARIXH/2gAIAQEAAT8h4i4gJ9EkBucKiJWxoAwv/9oADAMBAAIAAwAAABCIH//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxClZf/EABcRAQADAAAAAAAAAAAAAAAAAAABEUH/2gAIAQIBAT8Q0puf/8QAGhABAQADAQEAAAAAAAAAAAAAAREAITGRgf/aAAgBAQABPxDQakEYn2byleO1e5XKjFlvmIg5Ig9Mhy8zWEPDP//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"lake tahoe\" title=\"\" src=\"/static/672252932977a8df688679a0e462d3c2/c08c5/lake_tahoe.jpg\" srcset=\"/static/672252932977a8df688679a0e462d3c2/0913d/lake_tahoe.jpg 160w,\n/static/672252932977a8df688679a0e462d3c2/cb69c/lake_tahoe.jpg 320w,\n/static/672252932977a8df688679a0e462d3c2/c08c5/lake_tahoe.jpg 640w,\n/static/672252932977a8df688679a0e462d3c2/6a068/lake_tahoe.jpg 960w,\n/static/672252932977a8df688679a0e462d3c2/eea4a/lake_tahoe.jpg 1280w,\n/static/672252932977a8df688679a0e462d3c2/01ab0/lake_tahoe.jpg 1300w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>I'm not sure why they named it after this lake, but it is beautiful</small>\n</center>\n<p>Tahoe starts with Slow Start, exponentially increasing its window size until hitting the Slow Start Threshold, then switches to AIMD‚Äôs additive increase for linear growth.</p>\n<p>When 3 ACK Duplicated or Timeout occurs, it determines that congestion has happened and modifies both the Slow Start Threshold and its window size. Let‚Äôs look at Tahoe‚Äôs congestion window graph for a clearer picture:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/ccf0c/tahoe-ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACf0lEQVR42mNgYGBgB2JWIGb4//8/Iwgz4AAweXwYpE5IREREEshhrq+vZwNilpvLl9teXb0y7Nrq5UHX168Jvr5iafCN1cv91/f3C4SuWgVTxzZz5kxWdDbIQG4gEAOZDjIMJHB37Zq1F5Yv/XF1xfIn55Ysen184fwPV1ateHJ//nwFkDxQHRMIh4aGMq8CYaAloVAaJC/BxcUlATMwLS2NdX98PcexR8c45zTWWh7zdLWe+f8/64mJE/kubVkq+P/YMaH/u3cL71y0iBtqMAsyBhkoIyoqKrF//36QABvIlvj18wUSVs3TTVs6U6Nw3mRdkKLz69cLPNy04fKpJYuenFu25NvLbVuaQOLz58/ngAUVzMsy4uLiYmABBgYmVQsLM7/qEpesKVN4coGuyly9QA+kCOhdjpcH97lfbWlovDtrevLNzZv1gcJMIAcUL+rmzp07V7Te3h7sQnk+Pj4hECMNGLDxs3uMXWNiuIFcFvv4eIGY6b36wsLCvIJSgrIiNXmqSY0lloW99UKwmM9et1A4e/Uck4y1i8RgYlIgL4NiGeSijNULDf8zMDDWr1rFBgrobKDX4+vrOcwiAp0svV11EidOFI1uazQF6hMMqK0wzloyy6B+5kwuUOTAvMwrIiciCWKkz5+ukLlwtibIQJAhYBesWGyUtXqBdvnu9br/gd4r2rRUJHZGv6VJsI+nXUK06f96BibkpAPSw8nDwyNSvWO9bPbaeUYzz5xhBbqWCZYE8jYuE89ZM1+jHhiG4JQAdHnOzlWKnQ/PSoH4oHS5CpI24Xp45GxMlDxrynUFlZT4QXwgBtF8UJoLiEFe4YXyQTQnFMPUwTAvAI+yOQfWAhMfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tahoe ssthresh\" title=\"\" src=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/6af66/tahoe-ssthresh.png\" srcset=\"/static/1a6a5314e2aa526f2fa7a406638af3ac/69538/tahoe-ssthresh.png 160w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/72799/tahoe-ssthresh.png 320w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/6af66/tahoe-ssthresh.png 640w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/d9199/tahoe-ssthresh.png 960w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/21b4d/tahoe-ssthresh.png 1280w,\n/static/1a6a5314e2aa526f2fa7a406638af3ac/ccf0c/tahoe-ssthresh.png 1428w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The teal line shows the sender‚Äôs congestion window size, and the bold black line shows ssthresh. In this scenario, the initial congestion window is <code class=\"language-text\">8</code>, so ssthresh is set to <code class=\"language-text\">8 * 0.5 = 4</code>.</p>\n<p>The sender exponentially increases its window size using Slow Start until hitting ssthresh, then switches to linear increase. What happens when congestion (3 ACK Duplicated or Timeout) occurs?</p>\n<p>At the first congestion event, the congestion window is <code class=\"language-text\">6</code>. The sender sets ssthresh to half of that ‚Äî <code class=\"language-text\">3</code> ‚Äî and resets its congestion window to <code class=\"language-text\">1</code>. Then it starts Slow Start again, switching to additive increase upon reaching the threshold. Rinse and repeat.</p>\n<p>In essence, it remembers where it got hit last time and starts being cautious as it approaches that point. A reasonable approach.</p>\n<p>But there‚Äôs no silver bullet. Tahoe‚Äôs weakness is that the initial Slow Start phase takes too long to grow the window. While exponential growth is faster than additive growth overall, resetting the window to <code class=\"language-text\">1</code> after every congestion event is arguably wasteful.</p>\n<p>This led to TCP Reno, which uses the Fast Recovery approach.</p>\n<h3 id=\"tcp-reno\" style=\"position:relative;\">TCP Reno<a href=\"#tcp-reno\" aria-label=\"tcp reno permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP Reno was developed after Tahoe. Like Tahoe, it starts with Slow Start and switches to additive increase after the threshold.</p>\n<p>But Reno has a clear difference: it distinguishes between 3 ACK Duplicated and Timeout. When 3 duplicate ACKs occur, Reno doesn‚Äôt drop the window to 1 ‚Äî it halves it (like AIMD) and sets ssthresh to the reduced window value.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/ccf0c/reno-ssthresh.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVR42mNgYGBgB2JWIGb4//8/Iwgz4AAweXwYpE5IREREEshhrq+vZwNilpvLl9teXb0y7Nrq5UHX168Ivr5iafCN1cv9N3R28oJNDg1ltgeqmzlzJisIg/TBaJA0NxCIgUwHGQYSuLt2zdoLy5f+uLpi+ZNzSxa9PrFowfsrK1c8uzFnjvPLVatU3q1fr3tp9mxxoFLGVatWMYMwSC+IBumX4OLikoAZmJaWxro/vp7j2KNjnHMaay2P+3jYAP3KdH3ZHKnnO7bfurR2zavL69f8f7V7eztI87Zt29hB+v7X1zPBHCQjKioqsX//fhaQk0G2xK+fLxC3bLZe4tyJWpkLJuiBFM00Blq0Zb3BvoyU7DOlpbbXtq+VtLe3BxtUOHu2UO7iWTJwA8XFxcVAnHoGBiZVCwsz7+oSl6Q5c3hnnpnJmr1+ie78/fs5yrevVwjYtk65ZMksg4pp7YIgjatA4b5/m0zB6oUmIENDgWELEpfn4+MTAjHSgAEbP7vH2DUmhtvY2BgU8yLuxdkOgS1V3nZpCbpAPr95fLiCR3GmKZDN61FdZOOSm2IhaSzJBdIPdBQTiJYCeRkUy7kTJ/JlrF5o+B8Y2DPPnGFVUVHh4xPlU+YVEVEFqpMDYkVlCwsj41AfGx13Z0s9UPgCfaimpiZSDwqy0FBwLPOKyIlIghjp86crZC6crQkyMDc3lx0cQUCFIAy0kAUccTtWCZXtWWdWvnu97kRghIAcAkoyILWwZMPJw8MjUr1jvWz22nlGIJcBFTFBkwKYBoUNCIP4II3pS+epAoOHH2QxSBxZLchAHjkbEyXPmnJdQSUlfhAfFFZAzIcHc0DVoYvzAgAyVDLF8aGvfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"reno ssthresh\" title=\"\" src=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/6af66/reno-ssthresh.png\" srcset=\"/static/9ab8c0fb62bc0bfe27f965026b6a01d5/69538/reno-ssthresh.png 160w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/72799/reno-ssthresh.png 320w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/6af66/reno-ssthresh.png 640w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/d9199/reno-ssthresh.png 960w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/21b4d/reno-ssthresh.png 1280w,\n/static/9ab8c0fb62bc0bfe27f965026b6a01d5/ccf0c/reno-ssthresh.png 1428w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The graph above uses the same notation ‚Äî teal for the congestion window, bold black for ssthresh.</p>\n<p>Unlike Tahoe, when 3 duplicate ACKs occur, Reno halves the congestion window and proceeds with additive increase from there. Since this avoids resetting to 1 and starting from scratch like Tahoe, it reaches the previous window size much faster ‚Äî hence the name Fast Recovery.</p>\n<p>The ssthresh is set equal to the reduced window size. In the graph, when congestion occurs, the window drops from <code class=\"language-text\">6</code> to <code class=\"language-text\">3</code>, and ssthresh is also set to <code class=\"language-text\">3</code>.</p>\n<p>However, if data is lost due to a timeout, Reno drops the window to 1 just like Tahoe and proceeds with Slow Start ‚Äî without changing ssthresh.</p>\n<p>In other words, it differentiates between duplicate ACKs and timeouts, responding differently to each. By assuming duplicate ACKs indicate less severe congestion than timeouts and not dropping the window to <code class=\"language-text\">1</code>, Reno effectively weighs the severity of congestion situations.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This post covered TCP‚Äôs congestion control policies. Honestly, Tahoe and Reno are somewhat dated ‚Äî they‚Äôre not widely used in modern networks.</p>\n<p>Being designed for the network conditions of their era, they don‚Äôt quite fit today‚Äôs high-bandwidth networks.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACbklEQVR42oWSzW7TQBCA3QYhWiEhcWlTiVDuPAHPkEsRUg/QoB7KAcRrIPomNBbqAZWUQzGKFFFU4kaImJBfx47b+i+xE+en9nqH2bhGKRQx0mhmZzXfzswOl81mExyKKIoPOpqzpyjaTq32k6/X63ytVuNt2+Ydx/lLbdvhTdPhXdfhe73eG9d1c7IsP+YEQbiGvJv5fH4TUNyeSxRVgU6nA4qigO/7MCuURtbzAAwj8sMwDJg1DGObS6fTiwhMFIvFJywYBP5kNBoFk8kk8DwvYMLCsYZhZLtdCFqtyCcExiwXu3nFLS0trSLweqlU2oheoySu4iqJ72wboFq9XKFlWa+5ZDKZQuAizjATA1Evkuk/gaxdVb0CuLy8fHe2QkIomTb5nwoZUJIA+v0pcppxcoLAlZWVOwxYLEbAXo+Sw8PLyczGijMETQNwHIBKBUCWIyC7UxQE4gzvIXAhBppGSI6OosRZUAxnIFGM/DF+ha6zjwzZZ+EdAlOpVBKB88fH36a/bJqEWFYIPyQKdDpLCq5LwdApWCbFdaIwGkZx9kpbpqB1SBA9hkC0bLETX0TxKQvq6rlPKJAzHUhThnA0BlKpAvkuAanWgJg2hGzUiCPMnhlA2iqc/16bCyAntpsZ6Bjgfm0Q6Dtw3h2ALnlglIcwUF3sCzfZHwKMBlgKngcDNnDs24NwPIgW27K2GXCOAXO53OrpqbF+sPduq1QobDTL5fX8x93nk7629unD+2eFA2HzTNHWdrPZlyeNxqPPgrAp7O9v6S314dsd/kVTkjJ1SbrPXSFzM/78jL/A9vWPeyY3UG+j3mLb8gt3bCsK4xoUeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cubic vs tahoe\" title=\"\" src=\"/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png\" srcset=\"/static/dec2a168ed319557e87c6c34fa3afc85/69538/cubic_vs_tahoe.png 160w,\n/static/dec2a168ed319557e87c6c34fa3afc85/72799/cubic_vs_tahoe.png 320w,\n/static/dec2a168ed319557e87c6c34fa3afc85/692d4/cubic_vs_tahoe.png 398w\" sizes=\"(max-width: 398px) 100vw, 398px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The efficiency gap between Tahoe and CUBIC at high bandwidth is staggering</small>\n</center>\n<p>Compared to when Tahoe and Reno were developed, today‚Äôs network bandwidth is probably at least 1,000 times more generous.</p>\n<p>This means the probability of problems when a sender aggressively grows its congestion window is much lower than before. So modern congestion control policies focus on how to grow the congestion window faster and how to detect congestion more intelligently.</p>\n<center>\n  <img src=\"/2eb82cf5c7758194f2ec3b424cd04b32/cubic_function.gif\" width=\"100%\">\n  <small>\n    TCP CUBIC, which leverages cubic function properties, barely increases window size while avoiding congestion, then explosively ramps up once congestion clears\n  </small>\n  <br>\n  <br>\n</center>\n<p>The reason I introduced the older Tahoe and Reno is that as early TCP congestion control methods, their principles are straightforward, and later methods don‚Äôt fundamentally deviate from the same mechanisms.</p>\n<p>This post aimed to understand how the congestion control mechanism works as a whole, not to catalog every policy. So I intentionally left out other congestion control approaches.</p>\n<p>If you‚Äôre curious about modern congestion control policies, check out these links:</p>\n<blockquote>\n<ul>\n<li><a href=\"http://squidarth.com/rc/programming/networking/2018/08/01/congestion-cubic.html\" target=\"_blank\" rel=\"nofollow\">CUBIC</a></li>\n<li><a href=\"http://squidarth.com/rc/programming/networking/2018/08/01/congestion-red.html\" target=\"_blank\" rel=\"nofollow\">RED</a></li>\n<li><a href=\"https://ieeexplore.ieee.org/document/8642512\" target=\"_blank\" rel=\"nofollow\">Elastic TCP</a></li>\n</ul>\n</blockquote>\n<p>That concludes this post on sharing the network nicely with TCP‚Äôs congestion control.</p>","fields":{"slug":"20191126-tcp-congestion-control-en","path":"/2019/11/26/tcp-congestion-control/en/","lang":"en"},"frontmatter":{"title":"Sharing the Network Nicely: TCP's Congestion Control","subTitle":"How TCP adjusts window sizes to keep the network in harmony","date":"Nov 26, 2019","categories":["Programming","Network"],"tags":["TCP","Congestion Control","AIMD","Slow Start","CWND","TCP Tahoe","TCP Reno"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/45252c4560c0c973b1e5157d6a3c19ce/d803c/thumbnail.png","srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/d803c/thumbnail.png 320w,\n/static/45252c4560c0c973b1e5157d6a3c19ce/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/fc5c5/thumbnail.webp 320w,\n/static/45252c4560c0c973b1e5157d6a3c19ce/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/45252c4560c0c973b1e5157d6a3c19ce/01fb2/thumbnail.png","srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/45252c4560c0c973b1e5157d6a3c19ce/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"9dad4008-64b7-56a7-b07c-f8346a92a048","tableOfContents":"<ul>\n<li>\n<p><a href=\"#tcps-flow-control\">TCP‚Äôs Flow Control</a></p>\n<ul>\n<li><a href=\"#stop-and-wait\">Stop and Wait</a></li>\n<li><a href=\"#sliding-window\">Sliding Window</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tcps-error-control\">TCP‚Äôs Error Control</a></p>\n<ul>\n<li><a href=\"#how-do-we-know-an-error-occurred\">How Do We Know an Error Occurred?</a></li>\n<li><a href=\"#stop-and-wait-1\">Stop and Wait</a></li>\n<li><a href=\"#go-back-n\">Go Back N</a></li>\n<li><a href=\"#selective-repeat\">Selective Repeat</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"TCP (Transmission Control Protocol) has built-in features for controlling the flow of transmitted data and detecting and responding to network congestion. If TCP didn‚Äôt provide these features, developers would have to manually define what units to send data in, and handle exceptions when packets are lost. Thanks to TCP handling all of this, we can focus entirely on application-layer behavior.","html":"<p>TCP (Transmission Control Protocol) has built-in features for controlling the flow of transmitted data and detecting and responding to network congestion.</p>\n<p>If TCP didn‚Äôt provide these features, developers would have to manually define what units to send data in, and handle exceptions when packets are lost. Thanks to TCP handling all of this, we can focus entirely on application-layer behavior.</p>\n<!-- more -->\n<p>TCP‚Äôs transmission control methods are generally divided into three categories: flow control (regulating the amount of data being transmitted), error control (handling lost or corrupted data during communication), and congestion control (responding to network congestion).</p>\n<p>Of course, application-layer developers rarely need to touch transport-layer protocols like TCP directly. But if something goes wrong at this level, not understanding how TCP works means you won‚Äôt even be able to identify the cause, let alone fix it. (And overtime will inevitably follow.)</p>\n<p>With that in mind, this post covers TCP‚Äôs flow control and error control techniques.</p>\n<h2 id=\"tcps-flow-control\" style=\"position:relative;\">TCP‚Äôs Flow Control<a href=\"#tcps-flow-control\" aria-label=\"tcps flow control permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When a sender and receiver exchange data, various factors can cause their processing speeds to differ. If the receiver processes data faster than the sender transmits it, there‚Äôs really no problem.</p>\n<p>It handles everything as fast as it comes in. The issue arises when the sender is faster than the receiver.</p>\n<p>Both the sender and receiver have buffers for storing data. If the sender transmits data faster than the receiver can process what‚Äôs in its buffer, the receiver‚Äôs buffer will eventually fill up.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/79384/overflow.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAEDBAUC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAe9PPk3qhnsK9iP/xAAcEAEAAgEFAAAAAAAAAAAAAAABAgMAEBESITP/2gAIAQEAAQUCdUk2cJuV7kHq5XKvP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAMAAwAAAAAAAAAAAAAAAAABEBEhIv/aAAgBAQAGPwKvc6eWOI//xAAeEAEAAwAABwAAAAAAAAAAAAABABEhEDFBUWFxsf/aAAgBAQABPyHZLO/Dne3C6qJsz2wkKDrNkzCCI7R8/Z//2gAMAwEAAgADAAAAECvPPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABcRAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8Qys//xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhYRAxQZGh0f/aAAgBAQABPxAAi0WQToPPGZREFg7HH2ICj7UYl4WIg3Bb1NlOiXgcxHFqr2n/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"overflow\" title=\"\" src=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/c08c5/overflow.jpg\" srcset=\"/static/ffb20ecdb68523bcd2bca1b47ccabf1c/0913d/overflow.jpg 160w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/cb69c/overflow.jpg 320w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/c08c5/overflow.jpg 640w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/6a068/overflow.jpg 960w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/eea4a/overflow.jpg 1280w,\n/static/ffb20ecdb68523bcd2bca1b47ccabf1c/79384/overflow.jpg 3488w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>It's like pouring water into an already full glass</small>\n</center>\n<p>Data that arrives when the receiver‚Äôs buffer is full gets discarded ‚Äî there‚Äôs simply no room left. The sender would of course resend the data, but since data transmission is highly variable depending on network conditions, it‚Äôs best to minimize this kind of retransmission whenever possible.</p>\n<p>So the sender needs to gauge the receiver‚Äôs processing speed and decide how fast and how much data to transmit. This is TCP‚Äôs flow control.</p>\n<p>The receiver includes its window size ‚Äî representing how much data it can handle ‚Äî in its response header and sends it to the sender. The sender then references this window size and current network conditions to send an appropriate amount of data, thereby controlling the overall flow.</p>\n<h3 id=\"stop-and-wait\" style=\"position:relative;\">Stop and Wait<a href=\"#stop-and-wait\" aria-label=\"stop and wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Stop and Wait is a general term for any approach where, after sending data, you wait for a confirmation response before sending more. The receiver can reply with things like ‚Äúgot it!‚Äù or ‚Äúdidn‚Äôt get it‚Ä¶‚Äù ‚Äî and the type of response determines which error control methods can be used.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/65ff8e861f0894835574fb210cb11888/e9d87/stop-and-wait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC1klEQVR42pVVz2saYRDdXdfEqGuSJhtsaWpNraCFQistQewP2ksPpZS0QkqhQkshl+Cf4D3kkmNyzCnouSKJv6KgxhSxaKtUq1L0JuToTTtjZ2Gz0Y1ZeHzL7rfzzZt585ZhGOYV4AngJWCW+X+xjPolvdcDXgCeAp4DXPhwGWAH3AZMKT4aYjAYjDtAA1gCOABWgFl6sQgQADxgmla17FgFC8zUIN80Tw+Q8hxhXhCEBVhnwuHwo729vZu4cUy2FwLOKbNyuVzazc1NzJYJBoMft7e3sT56u92ObK4BTFQirSyhcwG1CkqXUZ4iRhjogayh5zOUKDWbTUe73d6oVCqf4/H4F1xPTk6+FovFdb/fP0cBp2UZCvKAFuq2xul0GvHB6enph1ar9aNer2eSyWQuk8lkDw8Pv0ej0W+BQABpM16vV0PfG5WUl2QncAgVqTCTNAVTngHoSFtD6hKoMRrIjEeMkI5BGVCkzgmSZBCiKCIVPhKJ2I6OjtSmyKgmG1ai7Xa78QBtKBTa2NnZceNHZrNZpAA6YjWWsnbCOWYokECBcX08VjZXuDgCT+Uyyl8uSLO8uro6pFEul980Go1mrVb7eXx8XMnn879Aj79TqVQepgbNhLNYLDpiNqukfIvchrHZbChWDoJYu93u+06n8xaa8i6dTq/FYrG1RCLxen9/3zDCxi50WaBC6yaso6ps5mVpGyWn8Xg8IrnNs93d3Tu4ETLkRxx4qduwIGAOgPPKHxwceLe2tu4jCyiJSPulINOjanhV2bAkHT2V6KGabFgaPaHX662Au1ihIStnZ2dWMAsrONCyz+fT0X6eRtWklM0Nkg4HDjKUTaFQ+ASy+Qu2hXKp5nK5CrjNH7hPQynw38GSIjSU3bmAaF3XZZu4arW6CFne6/f7jlKp5Mhmsw44xAm4SwahKpurTgqrWC/IxjSihmhdGgRaF0K6HzPbQ6P4B8hy+YLbIMmSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"stop and wait\" title=\"\" src=\"/static/65ff8e861f0894835574fb210cb11888/6af66/stop-and-wait.png\" srcset=\"/static/65ff8e861f0894835574fb210cb11888/69538/stop-and-wait.png 160w,\n/static/65ff8e861f0894835574fb210cb11888/72799/stop-and-wait.png 320w,\n/static/65ff8e861f0894835574fb210cb11888/6af66/stop-and-wait.png 640w,\n/static/65ff8e861f0894835574fb210cb11888/d9199/stop-and-wait.png 960w,\n/static/65ff8e861f0894835574fb210cb11888/e9d87/stop-and-wait.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <br>\n</center>\n<p>The core principle of Stop and Wait flow control is simply ‚Äúsend data when the other party responds,‚Äù making it straightforward to implement and easy for developers to understand.</p>\n<p>If you think about implementing basic ARQ (Automatic Repeat Request), you could set the receiver‚Äôs window size to 1 byte and use something like <code class=\"language-text\">can process = 1</code>, <code class=\"language-text\">cannot process = 0</code> ‚Äî a rough implementation that would still work.</p>\n<p>But an approach that only exchanges ‚Äúcan process‚Äù or ‚Äúcannot process‚Äù signals is as inefficient as it is simple. The sender can only find out whether the receiver can handle data by actually sending it. In other words, this basic Stop and Wait approach essentially amounts to just keep sending until it works.</p>\n<p>For this reason, when using Stop and Wait for flow control, various error control methods are introduced alongside it to compensate for this inefficiency.</p>\n<h3 id=\"sliding-window\" style=\"position:relative;\">Sliding Window<a href=\"#sliding-window\" aria-label=\"sliding window permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As we just saw, Stop and Wait has efficiency issues, so modern TCP uses the sliding window approach in almost all cases unless there are special circumstances.</p>\n<p>Sliding window works by having the receiver define how much data it can process at once, and continuously informing the sender of its current processing status to control the data flow.</p>\n<p>While there are many differences from Stop and Wait, the biggest one is that the sender knows how much data the receiver can handle. With this information, the sender can roughly predict whether data will be processed without the receiver having to explicitly respond ‚Äúcan process‚Äù to each piece.</p>\n<p>Both the sender and receiver have buffers for storing data, plus a separate masking tool called a window. The sender can continuously transmit data within this window without waiting for the receiver‚Äôs response.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1b3989f922769714854cd9b45b5bd9ca/11f9c/window.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVR42hXM2UoCYQCGYe8qiIpKCbyacBmXGBV3Z0YdQ/GgTgrSNLcRKXGBkBxs1Nx+JZfUEekg6Rb0yw5eeI5eBZ2YFp3P35leNF1aUI7mF81KawsrjSm3NDN7pLWVk6ZmRpJN7sZLslEwZVc5Z2YuxMVfwZqeC7b0vzeCMydnLal5UXEaGEAdHu4K3hhaWjfeDRyIPYy2I4q2LYw+zUOkOHT1XgRCFRzzBGq+B0N6BWWgi4u9tckl1Nf97Tk/guKQ6UHJD3Z5TwxNjQsNigVxRPDhu0XXe4OBJYS6jkFX5wEbLOOAG0Dl7+wnMk7YDs64Di4fF1AFe9sjP4FC/zB5o4V1qRVJilPKPpzQDFlaGDKinGRs9BDZypLPKx9ZmFz9fEx81TwtK3RyVr2vbarGxKxq2ndX+6nSqUXZEJ/W/wAfQdwulAraEgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"window\" title=\"\" src=\"/static/1b3989f922769714854cd9b45b5bd9ca/6af66/window.png\" srcset=\"/static/1b3989f922769714854cd9b45b5bd9ca/69538/window.png 160w,\n/static/1b3989f922769714854cd9b45b5bd9ca/72799/window.png 320w,\n/static/1b3989f922769714854cd9b45b5bd9ca/6af66/window.png 640w,\n/static/1b3989f922769714854cd9b45b5bd9ca/d9199/window.png 960w,\n/static/1b3989f922769714854cd9b45b5bd9ca/21b4d/window.png 1280w,\n/static/1b3989f922769714854cd9b45b5bd9ca/11f9c/window.png 1707w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Frames within the window can be sent continuously without waiting for the receiver's response</small>\n</center>\n<p>The sender‚Äôs window size is determined during the 3-way handshake when the TCP connection is first established. During this process, both sides inform each other of their current buffer sizes, and the sender uses the receiver‚Äôs buffer size to determine its own window size through a process of ‚Äúhmm, they can probably handle about this much.‚Äù</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1487079775</span>, win <span class=\"token number\">65535</span>\nlocalhost.receiver <span class=\"token operator\">></span> localhost.initiator: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3886578796</span>, ack <span class=\"token number\">1487079776</span>, win <span class=\"token number\">65535</span>\nlocalhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">1</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Observing the 3-way handshake via <code class=\"language-text\">tcpdump</code>, you can see that the initial <code class=\"language-text\">SYN</code> and <code class=\"language-text\">SYN+ACK</code> packets each report their own buffer sizes, and in the final <code class=\"language-text\">ACK</code> packet the sender announces its chosen window size.</p>\n<p>Both sides reported their buffer size as <code class=\"language-text\">65535</code>, but the sender‚Äôs final window size is <code class=\"language-text\">6379</code>. Why did the sender set its window to one-tenth of the receiver‚Äôs buffer?</p>\n<p>The sender‚Äôs window size isn‚Äôt determined by the receiver‚Äôs buffer size alone ‚Äî it considers various other factors as well. The network is too unpredictable to simply trust the buffer size the other party reported. A key value used here is RTT (Round Trip Time), representing the round-trip time of packets.</p>\n<p>The sender measures the time between sending its initial <code class=\"language-text\">SYN</code> packet and receiving the <code class=\"language-text\">SYN+ACK</code> response, using this to infer the current network conditions. If this value is too large, it means the round trip is slow, suggesting poor network conditions, so the sender reduces its window size.</p>\n<p>This window size isn‚Äôt fixed ‚Äî it can change dynamically throughout the communication based on network congestion and the window sizes the receiver reports. By adjusting the window size (the amount of data sent continuously), TCP can flexibly control the flow.</p>\n<p>Now that you have a general understanding of windows, let‚Äôs see why this technique is called <strong>sliding</strong> window.</p>\n<p>Imagine the sender wants to transmit data with sequence numbers <code class=\"language-text\">0 through 6</code>. The sender‚Äôs buffer would contain the data to be transmitted like this:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/232f15946f1a7d8a42025e582ef6400f/8d9a9/sw-0.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.375000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVR42n2OOwpEIRAE3/2vZeodRDAwUFHxi2gvMyC83WCzoqfpqaeUgpwzvPf45ZTSF4cQUGtFjJGZcmLnHM45EELgUUqh9445J5fGGGitQWvNTLc3G2O4S2OUr7X4mbUWUko8bysa+md4+RpeWzLce7PhB0qX47bPh+fNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 0\" title=\"\" src=\"/static/232f15946f1a7d8a42025e582ef6400f/6af66/sw-0.png\" srcset=\"/static/232f15946f1a7d8a42025e582ef6400f/69538/sw-0.png 160w,\n/static/232f15946f1a7d8a42025e582ef6400f/72799/sw-0.png 320w,\n/static/232f15946f1a7d8a42025e582ef6400f/6af66/sw-0.png 640w,\n/static/232f15946f1a7d8a42025e582ef6400f/d9199/sw-0.png 960w,\n/static/232f15946f1a7d8a42025e582ef6400f/21b4d/sw-0.png 1280w,\n/static/232f15946f1a7d8a42025e582ef6400f/8d9a9/sw-0.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The sender considers the receiver‚Äôs window size and current network conditions, sets its window size to 3, and starts transmitting the data within the window.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/16d1ae2726a8f3f4e63bad71de5db069/8d9a9/sw-1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.624999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVR42q2OzUrDQBDHt2A9qBXfoAiFQl/CqydveYW8hg/mB7T5aLJBSrHVqyTEEMk2m91kUyGZcRssKHhQcODH/ze7MDOEfK9jzTn5h+p95oHm6Mtb78+TjMnk5HI0Ot3nxXB4djUeD3bs/NowDk3T7P8WImbTYEt9Xzm2r7y5r93bu3KtgK1WVCpFpRA0yzJa1zUVP3jTNDSKIkq2iwd8ubvB9nGJ78sFbjwX8XmNIqAY398iJK/IOMe3NMW2bTHVWZYl6gEYxzFWVYVKKUySpPsjwp4Bd22QjgXl3AHpuVDqXmgX1hQ2T2vgUkKe5x36IuCcd14URQdjDPQSCMMQPgC0vexT2sGI+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 1\" title=\"\" src=\"/static/16d1ae2726a8f3f4e63bad71de5db069/6af66/sw-1.png\" srcset=\"/static/16d1ae2726a8f3f4e63bad71de5db069/69538/sw-1.png 160w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/72799/sw-1.png 320w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/6af66/sw-1.png 640w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/d9199/sw-1.png 960w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/21b4d/sw-1.png 1280w,\n/static/16d1ae2726a8f3f4e63bad71de5db069/8d9a9/sw-1.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>What state is the data in the window? It‚Äôs been sent, but the sender hasn‚Äôt yet received confirmation from the receiver.</p>\n<p>In other words, data in the window is always in a state of ‚Äúsent, but don‚Äôt know if the other party has processed it.‚Äù There could also be situations where data is placed in the window but blocked and can‚Äôt be processed, but let‚Äôs keep things simple and not worry about those cases.</p>\n<p>The receiver then processes data at its own speed and responds with the amount of remaining space in its buffer. If the receiver sends back <code class=\"language-text\">Window Size: 1</code>, it means ‚ÄúI have 1 byte of buffer space left, so only send that much more.‚Äù</p>\n<p>Now the sender knows it can send one more piece of data, so it slides its window one position over and transmits the newly included data (number 3) to the receiver.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ad1acdaf42325f81a805f9972417f525/8d9a9/sw-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42q2OP0vDQBiHA+pmwUmjDo6VgoObk5MO9SP0E4iL36MiCkIdHALiFChtIZN/6FC99pq01GKtOFQNgSO0plySS5NGeb0Uqh07+MLDPdy9v+MntNvtWMRBKrW2sxlfuTg73VURunxttaTHWu0qc3KU3EskxOT21kYul1swTXN+nJmk2+3G8vl8TGCMEce2iadVjUG1YvhqRffQQ8fFqMPKqDOoIN1XscHqmm71esTzPNLv94llWb/e4/cAQEqlEhF0XYfA9wFenuET3cOw2YBvzvvdDYT8/OJ83F5D8NSEAWNACIEgCIAXAcMwIAxDoJQCbwiapoHAHyn/kHp1jXoqHsEwom71zx1ctp2aSh2eDIZDyptR13VplI3ctm3KG1KMMRUURRFlWRbfJEl0ZUk0IyJX5JFDNruYOdyPo/Pj1UKhsDTej5j0YrEoptNpUZhyljmzwj/NDGedMzfN9g/YBTGIBWRq1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 2\" title=\"\" src=\"/static/ad1acdaf42325f81a805f9972417f525/6af66/sw-2.png\" srcset=\"/static/ad1acdaf42325f81a805f9972417f525/69538/sw-2.png 160w,\n/static/ad1acdaf42325f81a805f9972417f525/72799/sw-2.png 320w,\n/static/ad1acdaf42325f81a805f9972417f525/6af66/sw-2.png 640w,\n/static/ad1acdaf42325f81a805f9972417f525/d9199/sw-2.png 960w,\n/static/ad1acdaf42325f81a805f9972417f525/21b4d/sw-2.png 1280w,\n/static/ad1acdaf42325f81a805f9972417f525/8d9a9/sw-2.png 2244w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>Because the window moves sideways to include new data for transmission, it‚Äôs called a <strong>sliding</strong> window. If the receiver had sent a window size larger than 1, the sender would slide its window further and send more data continuously.</p>\n<p>However, since the sender‚Äôs window size is 3, even if the receiver reports 4, it won‚Äôt slide 4 positions ‚Äî only up to its own window size of 3. But in this case, the sender would recognize that the receiver‚Äôs performance has improved and could respond by increasing its own window size.</p>\n<p>The sender‚Äôs buffer can be roughly divided into three states:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/db7ce/sw-3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVR42oWOz0vCYBzG56VuXfph/0AheZDqP+jQOf+A/hPFk9fasUsQSBdh+OMgghNzc7nZnFIyECEp0BGibu/GtndTvr2Oea0HPjwPvC/P96GorQAiG8tms1GGZZNcr3dTFUSCEJArFpOZTOYo/B2h/hKeNW7B6jys58Kd/lK/B0lK23wjBVI7wOWbKVDk9KLF3f9oGm3bNj2dTmmEEK3repDX6zU9Ho/pcNzweYVV8GzV90cqWOoA4OsTrMEH4R3gewxLpQt4NAQTGWAgBL7vAykE0zTB8zwwDAM0TYOg0F8KuZUuAZ61bSS2PEN8xXZHxPMWR+Cx8ybhGdfEiDgpdDHGDsEkSyeO40xItlzXdUihGy6UjvGingAkxKDfPwVZjmmlUhzX6wGbDDwfRyx7VigULqvVaqJcLl93u90nWZYfGYa5qtVq58QvNn1RwgHhMGSfsEf9o0qlstsnxxVFOcnn8zvbh1+TxRfeE68QWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sw 3\" title=\"\" src=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/6af66/sw-3.png\" srcset=\"/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/69538/sw-3.png 160w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/72799/sw-3.png 320w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/6af66/sw-3.png 640w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/d9199/sw-3.png 960w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/21b4d/sw-3.png 1280w,\n/static/a04bfa93161e2a1c8ef37a6f19e1b0dc/db7ce/sw-3.png 2404w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>In short, the sliding window approach repeats the cycle of ‚Äúsend ‚Üí receive response ‚Üí slide window,‚Äù continuously transmitting as much data as currently possible.</p>\n<p>This simplified diagram with only numbers <code class=\"language-text\">0 through 6</code> might not seem impressive, but TCP‚Äôs maximum window size without any options is 65,535 bytes, and with the WSCALE option maxed out, it can be set to 1 GB.</p>\n<p>Plus, the data sent continuously in one batch isn‚Äôt just one or two pieces ‚Äî it‚Äôs often hundreds of bytes at a time. In real-world environments, this delivers significantly better efficiency compared to Stop and Wait flow control. Theoretically, up to 1 GB can be transmitted continuously without a single ACK response from the receiver.</p>\n<p>Because the sliding window approach is clearly faster in terms of transmission speed compared to Stop and Wait‚Äôs one-at-a-time send-and-wait cycle, and because the window size can be flexibly adjusted through ongoing communication between sender and receiver, modern TCP uses sliding window for flow control by default.</p>\n<h2 id=\"tcps-error-control\" style=\"position:relative;\">TCP‚Äôs Error Control<a href=\"#tcps-error-control\" aria-label=\"tcps error control permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP fundamentally uses ARQ (Automatic Repeat Request) ‚Äî retransmission-based error control. In plain terms, if something goes wrong during communication, the sender must retransmit the affected data to the receiver.</p>\n<p>But since retransmission means redoing work that‚Äôs already been done, various methods are used to minimize this retransmission overhead.</p>\n<h3 id=\"how-do-we-know-an-error-occurred\" style=\"position:relative;\">How Do We Know an Error Occurred?<a href=\"#how-do-we-know-an-error-occurred\" aria-label=\"how do we know an error occurred permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There are broadly two ways for TCP endpoints to detect errors.</p>\n<p>The first is the receiver explicitly sending a <code class=\"language-text\">NACK (negative acknowledgment)</code> to the sender. The second is inferring an error when the sender doesn‚Äôt receive an <code class=\"language-text\">ACK (positive acknowledgment)</code>, or keeps receiving duplicate ACKs.</p>\n<p>At first glance, NACK might seem more straightforward, but using NACK requires additional logic on the receiver‚Äôs side to decide whether to send an ACK or NACK. So in practice, inferring errors using only ACKs is the more common approach.</p>\n<p>A timeout occurs when data sent by the sender is lost in transit (so the receiver never received it and therefore never sent an ACK), or when the receiver responded correctly but the ACK packet itself was lost.</p>\n<p>In both cases, from the sender‚Äôs perspective, it sent data and the receiver didn‚Äôt respond within a certain time period.</p>\n<p>The second method ‚Äî detecting errors through duplicate ACKs ‚Äî works roughly like this:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/9ac09/duplicated-ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVR42o2SSQrCQBBFv2ZOHHBC4wQO4M6NIF7E87h24U29g/42P9BmICl4dFJJ/ZoaADrIbEKuOmH5UfjnQvZoaWMSE5d0C6K5xfrWWjAhoXWGVgJjUU2isr0o+KDAnUFHIFA1kcT7yHwbMmsleqPgk4EfCryBgSoLLEHj25ElcdoUuVZQbwuMrJY9iTtazKBpjnn5K1Vkgn38t50va6gkUQWlMSQ1rTgSD9WySZyShdqf6/0XawY8lSNVFa7Vple4QnHTQg7kRM569isutm2RlaAIvrJoCfc06g3RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"duplicated ack\" title=\"\" src=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/6af66/duplicated-ack.png\" srcset=\"/static/02ea09db0f12e0cdfcf4b209c00ccf68/69538/duplicated-ack.png 160w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/72799/duplicated-ack.png 320w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/6af66/duplicated-ack.png 640w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/d9199/duplicated-ack.png 960w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/21b4d/duplicated-ack.png 1280w,\n/static/02ea09db0f12e0cdfcf4b209c00ccf68/9ac09/duplicated-ack.png 2204w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>To put this more simply: the sender has already sent <code class=\"language-text\">SEQ 2</code>, but the receiver keeps saying ‚Äúhey, it‚Äôs time to send me number 2.‚Äù The sender can then infer that something went wrong with its data number 2.</p>\n<p>However, since TCP uses packet-based transmission where arrival order isn‚Äôt guaranteed, receiving one or two duplicate ACKs doesn‚Äôt immediately trigger an error determination. Typically, it takes three duplicate ACKs before an error is declared.</p>\n<h3 id=\"stop-and-wait-1\" style=\"position:relative;\">Stop and Wait<a href=\"#stop-and-wait-1\" aria-label=\"stop and wait 1 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Stop and Wait is the same approach we looked at in flow control ‚Äî send data, wait for a positive response, then send the next piece.</p>\n<p>It appears again in error control because it inherently provides basic error control. Two birds with one stone, if you will. Since data keeps being retransmitted until a positive response arrives, it handles both flow control and error control.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8beaea3d1aff1e971396525f6b9fbd36/eb2ef/stop-and-wait-error.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVR42pWUPWxSURTH3ydfbYEHWIVGnxqsg8FEqYbEuJgY2ZyYuzUm2r1TWRrTicSFgXTo4lIYWBz4SGiHpkBIKg0BUvkKJjAwsLhfz8Hz4pPywvMmv/Aeue/cc+7/fw7H/V0R4C3wBrBwyxdPv0+BKPAaeKnfsAKowC3dZjPLCviBDcA9f5oCOIE1QgYkhDHGIwZBZdp/YznpRFHb5HK58FQ5lUq9SyQSr/A6gsGgVTvITEBp0V01Gg1PuVx20n822ovYgYfAnaUBscTRaKTW6/XH/X7//ng8ftBsNjcvLy83aItEAdcBzyLF8JT1cDiMJci7u7vOwWDwrdfrtSC7erVa/X56evojn88fU5kyfWuZL1kLiAq76FlAhsOhHTJ15HK5lVqt5sD36+tr6zJR5lXWRBFNetFQFMzOAaxq1lEUBf+zHR0dbWUymUe4ia7EtG30KvPb29uoKJfNZrcg6DM8MBQKaZVoCSiEKdsYLZEQzNpG2NnZkbvd7kewzOH5+fnB1dXVQalUOgQ+kbmtpLCdvr1xudiTdzVRotGotdPpxH8Oh8dgmxQCtjkuFov78XhcoOx4CnxT5Rcc5/0MMOxdCMbAKibL/0eUAPnvNqbNVNUGAe1sb2+TZbMfZs+RiOeXz+dvxGKWOGMC+5OdYcB7wHPgCbWPqLUdK5UkCCgAPOBhxoIZGttNQTVLrJBI4hfojhpjskFAi14Uni5Xr7KgCaOqKh4ipdPp98lkcjbNyeyyrpv+a3zNFlhFOjk5EXUeXNONr6Dp8TWdTt3tdtsHHlTgXalUKl4YDk6qTD8DFo4vH95dLBbDDCw4vsDUBTB3/+Liog3BWpDpsFAofKUyNWPbjEQJkH1m94rmBWOvTyaTAAxW/9nZmb/VagUgoNfscFg1MbKMbDNrgt+w9OsqEzQqSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"stop and wait error\" title=\"\" src=\"/static/8beaea3d1aff1e971396525f6b9fbd36/6af66/stop-and-wait-error.png\" srcset=\"/static/8beaea3d1aff1e971396525f6b9fbd36/69538/stop-and-wait-error.png 160w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/72799/stop-and-wait-error.png 320w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/6af66/stop-and-wait-error.png 640w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/d9199/stop-and-wait-error.png 960w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/21b4d/stop-and-wait-error.png 1280w,\n/static/8beaea3d1aff1e971396525f6b9fbd36/eb2ef/stop-and-wait-error.png 1324w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>However, when using sliding window for flow control, data within the window needs to be sent continuously. Using Stop and Wait for error control would negate the benefits of sliding window.</p>\n<p>For this reason, more efficient and smarter ARQ methods are generally used instead.</p>\n<h3 id=\"go-back-n\" style=\"position:relative;\">Go Back N<a href=\"#go-back-n\" aria-label=\"go back n permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Go Back N sends data continuously and then checks which piece of data first caused an error.</p>\n<p>As mentioned above, detecting errors through ACK anomalies is more commonly used in practice, but assuming the receiver uses NACK makes the diagrams easier to follow. So for explaining error control techniques, I‚Äôll assume the receiver uses NACK.</p>\n<p>Since this section focuses on explaining error control techniques, let‚Äôs concentrate on how errors are controlled rather than how they‚Äôre detected.</p>\n<p>With Go Back N, after sending data continuously, a single ACK or NACK is enough to understand the receiver‚Äôs processing status, which makes it a great fit with sliding window flow control.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1bc040f7f4090114bb5b65db8e769d5b/e9d87/go-back-n.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 133.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD10lEQVR42o1VSUtbURR+0ZjEmLyYxLk1FomhjVpL01hX2i5aui3FTaEoLVRLV/0FQldC3QhWiFAiVLAVjG4c4ggOcUAjOIBWs2iwFDW6EGoWpr5+JzmhLxrFCx/33dx7vzPc75wIgiA8BaqBx0CGEBsK4XpDzfdqgEdAJf14C7jNc5rssCIOSZIuM5AC5AB2oAQoiG9kAxogla0qr/BKIUN80F29/BARZgJGQGQYMGitHh4ernC5XPlXGLlAmMMklEMdkdHa4XBoyevu7u63ra2tDnyrYCSTjes4RUo+n0CYy94ZeYMsihaLhdYpCwsL9UtLS/fJW6PRSJfT+ZwJIKNlgFlOaJblUMceiEVFRTQrh4aGGjs7O8lDgQkNsmiIvBTIkhMa+cUSRm1trYrm/v7+6paWFhuRkBEmFdkRIrayt0kJr6vBVM6fOlnICR5ub29bp6enq3Z2dh4EAgHn+vp6pd/vd25ubjqDwaBza2urcnR0lAjSrFarmkMX5YQ3KQc1NTWUR2FiYuLL4ODg8erq6s+1tbXd2dnZXa/Xuzs/P787MzMTHBkZCQ0MDDyhs01NTcoLhDBRzF5GQz47O1OjOjIA7d7enk6OyclJHTzWMdGlOsyKi5mtpTAU16iYi4TPBSG/B6/UhI3X2LDHXkxkEau/9fW9+NjcTNIQniFnjsSav0iImspyQ3sSPAQyGDoJwp7ES657vfUT7e2kQ61MMgbWKwk7j78TKiWTrYh4IVMtLnzKzSWNpUl9fa+krq5yGFFKZrOeDC8BiEjrAtBi7iWVDUhSEa6K9ZXBpZf63eNp/OxyOcmbl2gYH1AdX2FYikWlAWxvzgnbxEJNOn74/dlBny+dlyoOU8NzOkKr0MU6VgKhgqVSCNncPDk5KVxcXCyEgC1utztvf38/H4K+cXBwUIAzUfwKBCzuujoNN9b/ObTZbNHCjkQiDSDDWenP8fFx2OfzhdFlwuPj4+GNjY0wDIRBGsb+ySkGzv+GNqmOVdxI2D2TiVq4HlXxDuUm4fIpBPx3ZWUlAhFHUHKR5eXlyNjYWHRGtZxOTU1Jc3NzIVRREUXHrx8bWq2WurG+t7c3/+joqOLw8LAUNVuG73JCKBS6g3U5vKsggOwuzTBYCsPxBiGe79gGWU9Uyh8JoafzxcuGNlnHzqTK0Ov15lzoD2kQi4uLyZASjeF9R0dHFb0o5cput1PONNxpktaySfZvp2FvDSCkWdnT09PQ1tb2kHJFhvi8KOvc5Vf2w/hAR4n+5vF4KtGxC+kyJ1/PhPHqKjnfsQ3nCBXX6DRpMtjj7e8fXQh0aZiMba4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"go back n\" title=\"\" src=\"/static/1bc040f7f4090114bb5b65db8e769d5b/6af66/go-back-n.png\" srcset=\"/static/1bc040f7f4090114bb5b65db8e769d5b/69538/go-back-n.png 160w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/72799/go-back-n.png 320w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/6af66/go-back-n.png 640w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/d9199/go-back-n.png 960w,\n/static/1bc040f7f4090114bb5b65db8e769d5b/e9d87/go-back-n.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>In the diagram above, the receiver detects an error starting from data number 4 and tells the sender ‚Äúresend everything from number 4.‚Äù</p>\n<p>In Go Back N, when the receiver detects an error in data number 4, it discards all data it received after number 4 and sends a NACK to the sender.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/393dda4bf3efb487525f9567f2d08f12/b88bf/go-back-n-example.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVR42p2KSShEcRzHnywlOWiuzhwcmTJlSZpQ8zRIWU5qsmTLkiVN2ZeQJWGs72BpJs00svaII8+8mf/M65kZxgENN7yiJHw9cVAc8KtP38/v9/tS1B9GrVaHpSSqklKVSsXnKeBbCUCgTPAvCJEJSNA1ReV+eNAPnUBqYO3SrJsRRP2Kz9FqPiO6aRfpWzsndYseUjYvkn7ZyxmRVC35yCHrJGfLZuFkhyNt635SOOcm3Rt+0mI5txcxXu/g1jVDlS6cXMV12aAZcb5qxwTEdhwg3yAipZ+HqptDnuEYyb0cEoZF8OPLQKced6PjqOrZAV1hQrWcxe3bL9rGTeinbQ6q0ei7yBh2QDcrvpYwbqQNHqFm6RR5E05kjthRK3v2qB05Bjc40y4kwyT8RivqGQEFzdaXZsaFyin7c+6QDe1GD0+xLkllsd1qWeFes00k2sLd0PvCA73BS/Qq/+4fuSrvnFuieeFazptM9gLprq65kr3jR41VxuR4yGI9T0rqv6OIVoQ3RITFxEdGhn59vAEdrBxc2iz0dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"go back n example\" title=\"\" src=\"/static/393dda4bf3efb487525f9567f2d08f12/6af66/go-back-n-example.png\" srcset=\"/static/393dda4bf3efb487525f9567f2d08f12/69538/go-back-n-example.png 160w,\n/static/393dda4bf3efb487525f9567f2d08f12/72799/go-back-n-example.png 320w,\n/static/393dda4bf3efb487525f9567f2d08f12/6af66/go-back-n-example.png 640w,\n/static/393dda4bf3efb487525f9567f2d08f12/d9199/go-back-n-example.png 960w,\n/static/393dda4bf3efb487525f9567f2d08f12/21b4d/go-back-n-example.png 1280w,\n/static/393dda4bf3efb487525f9567f2d08f12/b88bf/go-back-n-example.png 1702w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A ruthlessly cool approach ‚Äî when an error occurs, perfectly good data after it gets tossed too</small>\n</center>\n<p>This means the sender, upon receiving the NACK, must retransmit the errored data number 4 and everything it sent after it. Even though the sender had transmitted up to number 5, it has to go back to number 4 and retransmit from there ‚Äî hence the name Go Back N.</p>\n<h3 id=\"selective-repeat\" style=\"position:relative;\">Selective Repeat<a href=\"#selective-repeat\" aria-label=\"selective repeat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Selective Repeat means exactly what it sounds like ‚Äî selective retransmission. While Go Back N is much more efficient than Stop and Wait, it still has the inefficiency of discarding and retransmitting data that was successfully delivered after the error point.</p>\n<p>So the approach of ‚Äújust retransmit the errored data‚Äù was born.</p>\n<center>\n  <div style=\"width: 300px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/e9d87/selective-repeat.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 153.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEaElEQVR42p1WTUxjZRR9pYWWtvT1h06nRqnDMAOCKQqBQKJ0ZjayYFsTN6MbG01kYeJCk6ksjInMwmBgFoQIU0mGyIRpIuU/gK/8g/yEv0AxSHAoC5WN45REST23vWUehRJmvuTkvdLvO/d+955ziyAIwjtAFXALyBLiSyFcbGmAm4ALuAGU0R9fAfIBB5Au26xIIBqNpgqQBliBAiAXuJz4gv6oBZSAGlCdk5VChsTKBPTyTdmAiWFgiFj0Wd3d3V3c3NxsPyfIKcJLRMBZ6vlddDqdOipDR0eHp7GxsYTeEcSIp5H3ZfBtTGcRyjOkiIacnBz6nDY3N3d7dXX1DcrWZDKJie8BCyfxOp89XhbuGNVQxxkYcnNz6bCqr6/vo9bWVuqggjMUeZ+eyYsAs5zQxGQnlsfjiXW9s7Pzrfr6+mtE4HA4jJxlIkMdq8SYivCiGlTKVFF4HqGwsbFRIEnSrc3NzbeBqsXFxRuzs7OutbW1qu3t7ar19XVXb28vSU2Vl5enZkNkyQlfBmwul4vqKIyMjDTjwD/Ly8u/oxnhycnJ8ODgYHh6ejo8Pj7+eGho6K9AIHCTy6HkWj4jRIgrsqKmySORSxJ4Hh1auHNGjqRiKC/gmNOEbnhwEhmOQjrfoXsV8WyzuJuaBw8fvvf13btO2utyODSFcUGnzhBv2Z+jMVFkCegAPZAVhbDxVP0aCHww0dBAOtSazeaENY3cTB33QEx2SuK6Inaby3HIY7eTCzL+6+q6Hb1/30nkURBS4D/xfScy+wlBrgpCSbJTYrLBRoU7XjdqjJatp3zw6NGHDffuxTJ0wSkoSeY38dsYAQ1w/f0zdKiSdVYJpCU6Gw6FrJCRgZxTXl5ueKmgwCLCMXx1LezkNJxhPZXwnKsON+Eb2Zn8GSFEHSPE3Mvu6en5Hk75AWL2Qdg+iNkHsftGR0d98/PzbXj+iO8+odKwU/TJTslXq9U0woX29vZ8WK1rZWXFPzU15afnzMyMHwFiT7ima2Jiog/Ed2TnTxGaamtr1Vy/j4+Ojv7G4cfw7z5I92HBfdhtH+T0Ht7d3f0D+zaQ6auUJY+0E1e+ZrPZyH7CwMDAp9gYxeEnQAQDIYJsDoeHh59i0D5Fpk+Af1GG35qammI/Sva4vE5Yz8Y6VCC6eWxsrIgmzuHhYQyRSCQPU+e1nZ2dQgyIwq2trSJMnOt1dXWJRp4itDKhyLXQyLsOEgOuqErh5zMJj+eh2+1W0kiqqKjILCsro6GR4ff7P2tpaSmlOhUXFxtLS0u1/AOmSjVtTNiUHgqF1ASIWA25ZCCrdMrs4OBARF31bW1tGgQUKysrL1VXV1shtcsc9M1zJ/YLLGtyl3W45hVkJaEZEjKU0BgJ4pWCwaAEqUhogrSwsIAGS0FIKLi0tPQzxP5Lf3//t1QWHnXH62pNTU3J3t7eF+jklzjkhQ5jAJEXZYgBJF7o0gtheyGhOwj2FQK/S7W0WCwnhC2+iJeT/gujTgv/Ayrd38q3b/JAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"selective repeat\" title=\"\" src=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/6af66/selective-repeat.png\" srcset=\"/static/a16fa4ea93d682445ee5ce78e4673ab5/69538/selective-repeat.png 160w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/72799/selective-repeat.png 320w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/6af66/selective-repeat.png 640w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/d9199/selective-repeat.png 960w,\n/static/a16fa4ea93d682445ee5ce78e4673ab5/e9d87/selective-repeat.png 1176w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <br>\n  </div>\n</center>\n<p>At first glance this seems nothing but efficient and wonderful, but unlike Stop and Wait and Go Back N, there‚Äôs a drawback: the data in the receiver‚Äôs buffer is no longer sequential.</p>\n<p>Looking at the example above, the receiver‚Äôs buffer wouldn‚Äôt contain <code class=\"language-text\">0, 1, 2, 3, 4, 5</code> in order ‚Äî it would have <code class=\"language-text\">0, 1, 2, 3, 5</code> with the discarded 4 missing. When the sender retransmits 4, the receiver needs to insert it somewhere in the middle of the buffer and sort the data.</p>\n<p>Since you can‚Äôt sort data in place within the same buffer, a separate buffer is needed.</p>\n<p>In the end, the retransmission step was eliminated but a reordering step was added. When retransmission is more advantageous, use Go Back N; when reordering is more advantageous, use Selective Repeat.</p>\n<p>If you want to use Selective Repeat in TCP communication, set the <code class=\"language-text\">SACK</code> option to 1 ‚Äî though in practice it‚Äôs usually enabled by default.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sysctl</span> net.inet.tcp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> sack:\nnet.inet.tcp.sack: <span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On macOS, using the <code class=\"language-text\">sysctl</code> command to check TCP-related kernel variables shows <code class=\"language-text\">net.inet.tcp.sack</code> set to 1.</p>\n<p>Given that in most cases it‚Äôs more beneficial for the receiver to handle reordering than to traverse the jungle of the network again, it makes sense that Selective Repeat is the default.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The hardest part about studying TCP recently has been how many different concepts are intertwined within this single topic.</p>\n<p>Being a nearly 50-year-old protocol, TCP has accumulated a massive number of improvements and options compared to its early versions. So whenever you try to dig into any single TCP behavior, everything else comes along for the ride like a chain of sausages.</p>\n<p>For example, the window size discussed in the sliding window section isn‚Äôt simply set to whatever the receiver reported. It‚Äôs determined by comprehensively considering various network-related variables like RTT, MTU, and MSS. To be precise, the sender‚Äôs final window size is the smaller of two values: the window size reported by the receiver and the window size the sender determined based on network congestion.</p>\n<p>Additionally, the error detection techniques discussed in the error control section are also an important part of congestion control. They feed into the logic that resets the sender‚Äôs window size, followed by retransmission using whichever error control technique both sides agreed upon.</p>\n<p>In other words, even though this post didn‚Äôt cover it, congestion control content is mixed into the topic of flow control.</p>\n<p>Personally, I feel like splitting things into topics like flow, congestion, and error sometimes makes it more confusing. I considered writing a post that ignored these distinctions, but since everyone is used to this categorization, I decided to go along with it.</p>\n<p>I actually intended to include congestion control in this post, but when the line count exceeded 500, I decided to split it out. Long posts are exhausting for readers.</p>\n<p>In the next post, I‚Äôll cover TCP‚Äôs congestion control.</p>\n<p>That concludes this post on TCP‚Äôs flow control and error control.</p>","fields":{"slug":"20191122-tcp-flow-control-error-control-en","path":"/2019/11/22/tcp-flow-control-error-control/en/","lang":"en"},"frontmatter":{"title":"TCP's Flow Control and Error Control","subTitle":"How TCP delivers packets safely ‚Äî a guide to flow control and error control","date":"Nov 22, 2019","categories":["Programming","Network"],"tags":["TCP","Flow Control","Error Control","Stop and Wait","Go Back N","Selective Repeat","Sliding Window"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/2ebbc07e03d747e529b6345b51c1196d/d803c/thumbnail.png","srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/d803c/thumbnail.png 320w,\n/static/2ebbc07e03d747e529b6345b51c1196d/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/fc5c5/thumbnail.webp 320w,\n/static/2ebbc07e03d747e529b6345b51c1196d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/2ebbc07e03d747e529b6345b51c1196d/01fb2/thumbnail.png","srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/2ebbc07e03d747e529b6345b51c1196d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"8f450265-eb42-5be8-97a8-0080169e7b57","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-connection-oriented-really-means\">What ‚ÄúConnection-Oriented‚Äù Really Means</a></p>\n</li>\n<li>\n<p><a href=\"#3-way-handshake\">3-Way Handshake</a></p>\n<ul>\n<li><a href=\"#closed\">CLOSED</a></li>\n<li><a href=\"#listen\">LISTEN</a></li>\n<li><a href=\"#syn_sent\">SYN_SENT</a></li>\n<li><a href=\"#syn_recv\">SYN_RECV</a></li>\n<li><a href=\"#established-initiator\">ESTABLISHED (Initiator)</a></li>\n<li><a href=\"#established-receiver\">ESTABLISHED (Receiver)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#4-way-handshake\">4-Way Handshake</a></p>\n<ul>\n<li><a href=\"#fin_wait_1\">FIN_WAIT_1</a></li>\n<li><a href=\"#close_wait\">CLOSE_WAIT</a></li>\n<li><a href=\"#fin_wait_2\">FIN_WAIT_2</a></li>\n<li><a href=\"#last_ack\">LAST_ACK</a></li>\n<li><a href=\"#time_wait\">TIME_WAIT</a></li>\n<li><a href=\"#closed-receiver\">CLOSED (Receiver)</a></li>\n<li><a href=\"#closed-initiator\">CLOSED (Initiator)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"Following up on my previous post, What Information Is Stored in TCP‚Äôs Header?, this time I want to explore TCP‚Äôs handshake process and the TCP states that change throughout it. Because TCP pursues reliable connections, it goes through a special process called a handshake even when creating and terminating connections ‚Äî all in the name of ensuring reliability. The endpoints communicating via TCP use this handshake to exchange information needed for communication, such as which TCP options to use and synchronization of packet sequence numbers.","html":"<p>Following up on my previous post, <a href=\"/2019/11/10/header-of-tcp/\">What Information Is Stored in TCP‚Äôs Header?</a>, this time I want to explore TCP‚Äôs handshake process and the TCP states that change throughout it.</p>\n<p>Because TCP pursues reliable connections, it goes through a special process called a handshake even when creating and terminating connections ‚Äî all in the name of ensuring reliability. The endpoints communicating via TCP use this handshake to exchange information needed for communication, such as which TCP options to use and synchronization of packet sequence numbers.</p>\n<!-- more -->\n<p>But explaining with words alone isn‚Äôt much fun, so I wrote a simple client and server in C, and I‚Äôll include snippets of the packets they exchange during the handshake ‚Äî captured by secretly eavesdropping on them.</p>\n<h2 id=\"what-connection-oriented-really-means\" style=\"position:relative;\">What ‚ÄúConnection-Oriented‚Äù Really Means<a href=\"#what-connection-oriented-really-means\" aria-label=\"what connection oriented really means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Before discussing handshakes, I want to talk about the concept of a ‚Äúconnection‚Äù that TCP creates and terminates. If you‚Äôve studied TCP, you‚Äôve probably heard of one of its key characteristics: being connection-oriented.</p>\n<p>Connection-oriented literally means it aims to maintain a connected state. ‚ÄúConnected‚Äù and ‚Äúconnectionless‚Äù are terms you encounter repeatedly when studying networking. Personally, I found these terms a bit confusing at first.</p>\n<p>Common sense tells you that two devices need some kind of connection ‚Äî whether a cable or otherwise ‚Äî to communicate. So I didn‚Äôt understand why they bothered distinguishing between connection-oriented and connectionless.</p>\n<p>The confusion arises from the difference between physical connections and logical connections.</p>\n<p>When we normally think of connecting one device to another, we picture scenarios like connecting a computer to a monitor or plugging a USB into a computer. That is, physical connections between devices.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 19.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42mNggIL//xkY/9czMIHwqlAGZh93JyMvN0crd3dnS2dnZ0MnJyc9L1cHcw8XextvN0d9kBqY+v8MDIwMcIPO+wv8v5US8v9SpiDMYLgkQygziFxVaMG5KsueB8KvZ4JgBPh3K5f9383MoH+3UmQY/j8pKvr/f/n/n5dSJtwp1jB+Ptna4Vm/pd2rSWa2LyeY27ydbGr5dIJF4ItJlpFvp1pagcTeTTG3AakBqX1YoWH87Xhsxf//a///f1E+jeH/3RK9/3fLF/w6l2l6RYuB7c1ED77XnVa8yPhpvTHX//n2HOjiILX34+U5fhyPVP1/v3HO/ztFzgCVcHv231n+BwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"physical connection\" title=\"\" src=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png\" srcset=\"/static/bc0e263eb63d5f0929e13c98fe3ced73/69538/physical-connection.png 160w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/72799/physical-connection.png 320w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/6af66/physical-connection.png 640w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/d9199/physical-connection.png 960w,\n/static/bc0e263eb63d5f0929e13c98fe3ced73/91608/physical-connection.png 1251w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Using a cable to physically connect two devices</small>\n</center>\n<p>In contrast, the ‚Äúconnection‚Äù in ‚Äúconnection-oriented‚Äù refers to a logical connection. Of course, devices still need physical connections to communicate with each other.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVR42mNgwA4YtbVtZR0cHKzdHB2tjH18NExdXQ1c7O1N7O3tLXR17WUYcIH//xkYQRhV7D/j55Mp2uv74wVA/Pf8/IrPxfkVQOwzM9P4P13O1MRqDgOSOf/rGZggdD3L+/X1Av8vpmX//79Q7r+rq9h/AZ6s/4I8af8DAoT/v5yi8v9ietb/VVN4QGpBhsD0Qgy6ECj2/3KgPtRlLEDMAWLf/3+f47u5usJ/EQG7/1PqgZpDef6L8zv8M1ORAclB1XMAMTOYfTXW8P+1WGGG/w8qd/5/3/f/f69T8n8GfsP/3Kx6QFt1//NyF/1XlfO+te0f+//rJcH/b1X43J9/n+O/smTAP17OAqAa7f9crPo/GbgM/8z0z/r/Y/b//w+qljP8v1vZ9P9B/Yn/qyP0Ptl4iH5w0xICKub6Jy1m8Xl2nvjT/0+5fl4o1vl/qUgD6BrO/1OyJEByQDWc/wNMhT/Z24v83xpr8v9hy7n/t8tKGJDDABQZ//+f4QLSrP//nxf4dGOmyJf9UyT+X5om+P9MB/+Xk1MkPj5ZKPz//13+K///s0HVMsLiABwp/xmAhoAwVAIseayX89+NjILvF5oVwfxbuSH/b+T6Q8K8Xu3/1fT8/2dmssLVI5kBAOyQ/gHAEaq2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logical connection\" title=\"\" src=\"/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png\" srcset=\"/static/025135c6a12488fad9c15e904f065386/69538/logical-connection.png 160w,\n/static/025135c6a12488fad9c15e904f065386/72799/logical-connection.png 320w,\n/static/025135c6a12488fad9c15e904f065386/6af66/logical-connection.png 640w,\n/static/025135c6a12488fad9c15e904f065386/d9199/logical-connection.png 960w,\n/static/025135c6a12488fad9c15e904f065386/690c6/logical-connection.png 1201w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>To put it more simply, it means two devices maintain an ongoing state of being connected to each other.</p>\n<p>Using a phone as an example: the phone being connected to the phone line is a physical connection, while actually being on a call with another phone is a logical connection ‚Äî a connected state.</p>\n<p>So why does TCP maintain this connected state? The reason is simple: to ensure the reliability of continuous data transmission.</p>\n<p>TCP uses packet switching, so it splits data into multiple packets before sending them. Rather than blasting all the data through the network at once, it bundles them into units and streams them to the other party.</p>\n<p>Now think from the receiver‚Äôs perspective. One advantage of packet switching is that it doesn‚Äôt monopolize the circuit ‚Äî multiple simultaneous communications can happen over limited bandwidth.</p>\n<p>This means each endpoint is simultaneously exchanging packets with multiple devices. Without information like ‚Äúwho sent this‚Äù and ‚Äúwhich packet number is this,‚Äù the receiver would be extremely confused.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVR42n2Sz08TQRTHB/HCvyGJwYuJ/wAxqZqQGPWg0Xgw8Vc8QeLJRCMcNEYTgUp/7lZol1ZKS0lpqYBCbSnsj/6g7Xa7RbZ0u21QoxjAA4FY6fi2VNMDMMnb75s3M5/35s0iml+VEUJNi2nJG0kt345EeQ2dWU1ADPX04GOoYbgxblaV4aVhOvX5UYhOtDFZmYfQ8VkmtRwVChcRzedrQCaTd4bZZD+bK4ucqERrQHw4MBwTH8/QdBsjyLxe2/diKsTi5W+bZxGXW9uNxIQbADal5XVM89ICk5bmDqoQ14GcUCQt1Ig08SHYPj0fw7oBrTjHpOSYWOxATEb+yQryF04s7XC50rPalfl89EhgVtG6vQFstVHlySCzfr1DczKWKwUjCfEKZJOF+cXEhbj0dY/jpatRfqWdE4vxfWDPgVdmswUqLZW7X73uo8LxnKLGolmZ5fj8ZcRkFXb/GiUS+niNTktnGEGZOqpCNiP3cxn5QWB24QSc/7SfRJlgMoVzKKVsagNOy6nYSrmXXsrcWWDj55Plre6DHgXX50l542myuHFTkEqtaWXLWospv0xL8o92FP+8hmNCvposfK8uraxV42IRHmZ12+/3axoh4DWp397ehy2jHu/OiHs8ZHeM6HxTHzFlpTrHfe/xu1G3HXkmJrHbN7035p/GY/4Z7PIGKl5fADscjvu1vrndzfUCm+rzFqPBsGsyGsNms1k3+NaCCcLSRRBmbDIZ7UgNGHQDewb9AFbNqNdVbFYrJkny7mFAgiB2Yb0GpCgKgETX4OCQqnY0NAQOSVYIgqyqBht/U9QwZDMdBdwGWBD0jXoeznSCqUAKuVwubLVa/6gLoKpVPB4Pttls9xqB0Mv/QGjHjt1uD0N1epir7elyOp2q2hFQRyEbDZoBS4MfAjWBtTaC/g3134S1J3CDW7BXA/rSYrGcBv85xC/9BYcvGjU7koP9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pipes\" title=\"\" src=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png\" srcset=\"/static/3ba48da98f25bb75ddd3da9a66e171e0/69538/pipes.png 160w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/72799/pipes.png 320w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/6af66/pipes.png 640w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/d9199/pipes.png 960w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/21b4d/pipes.png 1280w,\n/static/3ba48da98f25bb75ddd3da9a66e171e0/f2331/pipes.png 1427w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Trying to distinguish connectionless packets is like trying to tell apart water mixed in a single bucket</small>\n</center>\n<p>In the diagram above, think of the pipes as physical connections, the openings at the end of each pipe as ports, and the bucket as the process that handles packets. Trying to distinguish packets without connection state is like trying to identify which pipe opening a particular bit of water in the bucket came from.</p>\n<p>That‚Äôs why TCP maintains separate connection states ‚Äî A‚Äôs connection with B, A‚Äôs connection with C, and so on. To create or release these connection states, TCP goes through a special process called a handshake.</p>\n<h2 id=\"3-way-handshake\" style=\"position:relative;\">3-Way Handshake<a href=\"#3-way-handshake\" aria-label=\"3 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Let‚Äôs start by looking at how connections are created. The handshake for creating a connection is called the 3-Way Handshake ‚Äî as the name suggests, it involves exactly 3 rounds of communication.</p>\n<p>Through this process, both endpoints exchange information like who they‚Äôre communicating with and what sequence number to expect for incoming data, establishing the connection state.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVR42nVUS0sbYRRNa9VYo1GTmBptm7bWRdqdTVtQkFqlUCK48Q+40EILgn/ArRvFjSt1o0hQioLvB4ggogZJIE3MS5OYd2JM1GDQwjg99+vE+mgG7sydjzPnu+fc+43I5/NxJycnXCKR4KLRKLe2tsatr69zR0dHbC2ZTHKxWIwLBAIsJ+z+/j7DbWxscMFgkOFSqRRns9k40fT09Ge32/3BbrdrDQaDdnBwkIXRaNTSmtPp/Li1tVU/Nzf3iXAWi+U9NrzGbW5uamkNG70bGBjQiXBJ6NbQ0PBod3c3l+d5FpTTmujvRc/CbLja2tpcAVdBtwKTyVQCiQmSc3BwcLm3t3eJnEeEu7q6SgRC8c7Ojgy4OElHtQyHnHChyclJKkxJhGJ4JwHQAS/CkOmHF34AIwCa29vbi4B5iMinjeGnjXAul4vhkEeBNYOwABjFteSRkRFFJBJRLi4uqvV6fU04HC6nNUFKbkYyPlSYzWbl8vLyC8KhQeVDQ0PKm5LFML74+Pg4BpILSD63Wq3nqOTy7OzMD8/kmQpBVBqPxyPpdPoCFaYhOY3u/j49PfXNzMw8zlTIJIPADsIwCElKAO8RSPmlUqlqGhsbK5uamqRogBRYC22EyjwUwAQh23hPck9PjxhdEw8PDxd1d3fLPR6PuK+vj0Ci+fn5b+Pj452Uw5IKzG7lysrKa5Bo4L0K36huSpYILw/ujkhmbWFhIR+PIoxHM0QkUWUa1THJ8J1JHh0dLbxVYRZCRgZ/5K2tra90Ol09CFywIwpCmghyKQ7J1nuS8WExJEvHxsYqent7nyEvbWtry8FJ+rq9va3HMfu5tLTUnNmE7Ojo6JACl6PRaPJudRmNkGLnFIaVdzgcV+jgldfr5bH7uVqt/lJVVVWAbkvwcUbFrVESpuAfIXU5FArZQRyCDB/GyAfyENatIHvb0tKipEbdsSYr4bWHVMGdYMDZ2dkfExMT3ylfXV2VYV0GK5729/e/RF42NTUl+x9h1gsjRR6V1NXVNUPJhd/v56HmigK/LzrLcZyce13Oegmm51F16KgJpO7Dw0Mn5tEBQi9Oi4HmFphywj9HlCHkWYLkPBFw9OeRV1dXK26GQFSMePMHzD+L1nW+DwIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way handshake\" title=\"\" src=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png\" srcset=\"/static/39c2c760f38c6bd21705f9e01d1aa41c/69538/3way-handshake.png 160w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/72799/3way-handshake.png 320w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/6af66/3way-handshake.png 640w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/d9199/3way-handshake.png 960w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/21b4d/3way-handshake.png 1280w,\n/static/39c2c760f38c6bd21705f9e01d1aa41c/7575b/3way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Here, the initiator is the side that sends the connection request first, and the receiver is the side that receives it. I use these terms because either the client or the server can freely initiate the connection request.</p>\n<p>Let‚Äôs examine what each state means and what the <code class=\"language-text\">SYN</code> and <code class=\"language-text\">ACK</code> being exchanged represent.</p>\n<h3 id=\"closed\" style=\"position:relative;\">CLOSED<a href=\"#closed\" aria-label=\"closed permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADl0lEQVR42nVU3U9SYRymDxMLRRMlycrKvLDuiGqzjWW6tqabN/4L1FZX/gPe2oUfN1647CKdOVmT/AA/2ERFwjmnG6KAHEBBOQckD0iQth1Pz4sHE4t3+3He8/Kc5/09v9/zviK/38+xLMvt7+9zDMNwMzMz3OzsLLe3t5daI/+Fw2FuZ2cnNY9GoxxFUSmc2Wzmdnd3U7h4PM45HA5OpNPpXnq93qdOp1O1tLKi6u7pUXV1d6tW1tZUa1jb3Nx8ZrVan4+Pj78gOLvL9cRosaQwBGtZWlKRNWz0uKurq0GEISE/vFp9mddocniePwkyx5roZJDntROc6DLf05OBW1YqcwRcGfnJY02mwp8W8z5rMXNew/iR85vuKGox8wnrd3q1s7NQIBTHjMZi4CIE55vQHzlOcZYgbzeRxOSEUMzb7ZKfC3Mudn6OpkZHAq4RXSC6MM8krQs2x4cP+cBcROTyZOOFeQdrnqM9Y8B9Gw6w87OhhMVs4/3+PGBKTiUbtNoSnmHkqyZThXFwsIqn6VKD9lOJICUnLZngGJtNvjgyclf/+XNVnKJKv3z8KD8rWYzCF0R+/AgHafrQ4/Um7OvriVA4fBQ7OAio1WpZOkObzVa0F4kwyV+/Dt0UldzY2EgexOO/o7GYf3R09Go6Q3EoFJLAGk4aw+PxBND+HbwzsMmaQqGoqq2tvVlXVyddXl6WAms/wEawjo8EMLuwzYpWq82U3NraKkbXxL29vfktLS0yn88nbm9vJyCRXq9/OzAw8IbMJyYmyuDdm9PT0w9AUg2/KvCN4qxkifBy4bxF0msGgyEXj3ylUlkPESyyTFKCZByG3zFI7uvru5aRYRbCFBnqI2tqarrf0NDwHARulCMEQhqHgVQpAsnr/0jGhwWQLO3v7y9ra2u7jXlRc3PzJZyk14uLi4M4Zl8nJyfr05uQcmg0Gilwl6qrq69kdBmNkGLnOI4W73K5jt1u9/HW1hacQycqKipelZeX56HbEnycVpFhJcEFfwlJl4PBoBPEQcjww0Z+kAexvg6yR42NjXLSqHOlyUp4WkOSwblIAcfGxt4PDQ29I3Mjjh/Wi1GKWx0dHfcwvz48PFz8P8KsA5YiNSqsqamph5LDQCDAQ80xCVxfPG6ayNTU1D9dzjqEol8h2aGjqyD1bm9vb8KPLhBu4S5cIr4FppTg7yCuI2RZgsi5IeDIzSOrrKwsORsCUQHi4R/sy4j4AHHV7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way closed\" title=\"\" src=\"/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png\" srcset=\"/static/b234afd5db4ad276398327e6c8e1a562/69538/3way-closed.png 160w,\n/static/b234afd5db4ad276398327e6c8e1a562/72799/3way-closed.png 320w,\n/static/b234afd5db4ad276398327e6c8e1a562/6af66/3way-closed.png 640w,\n/static/b234afd5db4ad276398327e6c8e1a562/d9199/3way-closed.png 960w,\n/static/b234afd5db4ad276398327e6c8e1a562/21b4d/3way-closed.png 1280w,\n/static/b234afd5db4ad276398327e6c8e1a562/7575b/3way-closed.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>No connection request has been initiated yet, so there‚Äôs no connection at all.</p>\n<h3 id=\"listen\" style=\"position:relative;\">LISTEN<a href=\"#listen\" aria-label=\"listen permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADfklEQVR42nVUTU8TURStIloUKEqhUlFRkQW6Q9QEEyJKTAwkbPgDLNBEExL+AFs2kG7YGNhAkNAY0LZ8WUOQQgukKUbpFy0tTGln+kELrW3AZBjPHVsEtC+5nTu3Z8675977noRhGD4Wi/HRaJTnOI6fnZ3l5+bm+HA4LMbov1AoxG9vb4v+7u4u73a7RZzBYOD9fr+ISyQSvN1u5yXj4+PPPB7PI4fDUbuyslLb19cnmsViqaXY+vr6Y5PJ9ESn0z0l3Nra2kNseIRbXFyspRg2eqBSqZokWPn0U19ff85sNucKgiAa+RST/Fn0vJQNV1NTk5vGldFP3urqahEkRknOxsbGgc1mO4AvwNiOjo6iNKF0eXm5GLgISUe2Ig4+4QJqtZoSUxChNBgM5gPoRC1YyPShFj4AOQC/t7W1FQBzFnaBNg5FIvZoLMa6XC6fHVj4wRhwIMwDpuRI8sDAQAmaopiamqoYGRmpYlm2lGJpKbkZyfOEM5kUS58+3Zp4964q8e1b6XuVSnFcshSFL9zZ2QmBZB+Sk1arNYnOHsTjcR9qJs9kKBgMl38uzHPJZdO+W6dJ2T+OpeLGhV8/jQuM4DdfzGQoSgaBA4QsCEnyNt45yP6hVCqrGhoartU8fy4T9HpZfP7rWsK44PPoNN4Nnda7uzjvTxoNFoExnpTc1dUlRdek/f39BZ2dnXKv1yvt6ekhkGRiYuL18PDwK/LNX6fKBIa5ZvmsvftFra4WwmHl5/f9yuOS89MvZ06PSCY2OTl5AY8CjEcjy3KxYDCUcrndKavNluK44K+9vTgzODh46USGWQhFMo1GI29pabnT1NT0BI1zoRxBnBaaCKpSBNNh/afL+LAQkmVDQ0Nl3d3dN+Bfbm1tzcFJerm0tDSCY/Zhenq6MbMJlaO9vV0GXE51dfX5E11GI2TYOYFhFZxO5yFm7HBzc1PA7smKiooX5eXleeh2Pj7OqDgxSukp+EtIXQ4EAg4QByCDwRgxIA8gbgXZ/ebmZgU16lRpshIe1ZAyOGUiUKvVvh0dHX1Dvl6vL0a8GKW43tvbexv+lbGxseL/EWZdGCmqUVFdXV0jlOz7fD4Bag7JcH3RWY7MzMz80+WsK13085QdOroKUs/W1tY67lInCDdxF67Q3AJTSvibsCsweRYjOVfTOLp55JWVlSXHLU1UCLv3G5OfidZiiQDBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way listen\" title=\"\" src=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png\" srcset=\"/static/3c45f32dfd1bd86fe51fd1d639070fc7/69538/3way-listen.png 160w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/72799/3way-listen.png 320w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/6af66/3way-listen.png 640w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/d9199/3way-listen.png 960w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/21b4d/3way-listen.png 1280w,\n/static/3c45f32dfd1bd86fe51fd1d639070fc7/7575b/3way-listen.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The receiver is waiting for a connection request from the initiator.</p>\n<p>The receiver stays in this state until the initiator sends a request. Since it doesn‚Äôt actively reach out, this state is called Passive Open, and the receiver is also known as the Passive Opener.</p>\n<p>In socket programming, after socket binding, calling the <code class=\"language-text\">listen</code> function puts the receiver into the LISTEN state.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Listen failed...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server listening..\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Once the receiver detects a connection request from the initiator, it calls the <code class=\"language-text\">accept</code> function to proceed to the next step.</p>\n<h3 id=\"syn_sent\" style=\"position:relative;\">SYN_SENT<a href=\"#syn_sent\" aria-label=\"syn_sent permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiElEQVR42nVUS08TURSuD7RooTxakIeKisSgu4oaISEixMRA4oaFWxbVRA0Jf6BbXEBwwUIpCyGGQJTGUsujvKQChTQ0qZU+KC10aGdaalvANsVkGL87tsjD3uRMT89897vnO/ecEXg8HjYcDrOhUIhlGIadnJxkp6en2c3NTT5G3gUCAXZjY4P3I5EI63Q6eZxer2e9Xi+P29nZYa1WKytQqVQPXS7XXZvNVrG4uFjR2dnJ29LSUgWJORyOe/Pz81UajeYBwVksljs4cB83OztbQWI46HZHR0e9AEtEHtXV1aeNRmMax3G8EZ/EBH8X+T2fCieTydISuALySDeZTFmQGCJyVldXd5eXl3fhczC6ubk5K0EoXFhYyAUuSKQjWx4Hn+B8AwMDJLF8Qij0+/0iAO2hcJi22e2U1WajwpEIAzM3NTVlAHMSdpYcjHpaUTN6ZWWFQs0o+H6QmkGYDox0X/JMd7eUM5vzTSpVie79uzLO6czTdr+RJqSkJSVjo9QM3Ojo6JW+vr4yXFBeV1dX/kHJwj2DITM69y3gG9fFXVpNdHnwYzQwNbEbn5+lvE+fSpIZgig7GAwysVgsjgxjkBzD7f7e2tryqNXqc8kMhZzFIvqln7ExE+O0e1hDOT6rNgLTk0x0Tv89fuNG2VBNTdHV2lrxqtEoRnks29vbFDJzE4NcL2QvHZM8pVAIObdbaFUqM97K5RLiz7W1EZBg7suX518/fHhG/E/DwwXo3aKxsbHrIClH7QuVSmXhQcmixJ8TR1skGXul1Z59LRBkeGWyup80Hab9/hiy4yVjGHjJPT095w9lmIJQoAXZlFotuf/kybWW+vqqTYZZ8QcCfhDSaHwaKwjJP45JxsZMNKq4t7e3oLW19RL87MbGxlOYpMcGg6EPY/ZxZGSkLnlIG8ohl8vFwJ0qLy8/c+iW0cxipL6DZuXsdvsebnBvbW2Nw+nRkpKSR8XFxemYEBE2J1UcaqVEF/wjJI3t8/lsIPZBhgfz6wG5D/EfILvV0NCQ39LSIjlSmpSE+zUkGRwxHjg0NPSyv7//BfF1Ol0u4rkoxcX29var8HMGBwdz/0eYcikUClKjrMrKyjooiVMUxUHNHjF8vsgsBzE5x2455UoU/QzJDjdqAqlrfX3dgX60g3AN07LoRt8Ck0fwl2E5MEkKI3IuJHDkyyMpLS2VHrQEUSbs5h+zi4w8rnD0PAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synsent\" title=\"\" src=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png\" srcset=\"/static/f1c7fdb63dd76b25c40467801dcd2d5a/69538/3way-synsent.png 160w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/72799/3way-synsent.png 320w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/6af66/3way-synsent.png 640w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/d9199/3way-synsent.png 960w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/21b4d/3way-synsent.png 1280w,\n/static/f1c7fdb63dd76b25c40467801dcd2d5a/7575b/3way-synsent.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator sends a connection request to the receiver, generating a random sequence number and including it in the <code class=\"language-text\">SYN</code> packet. From this point on, both sides will use this sequence number to create new values, verifying the connection state and packet order through mutual confirmation.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [S], seq 3414207244, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Capturing this with <code class=\"language-text\">tcpdump</code> ‚Äî a utility that can capture TCP segments ‚Äî we can see the initiator setting the packet flag to <code class=\"language-text\">S</code> (meaning SYN) and sending the sequence number <code class=\"language-text\">3414207244</code> to the receiver.</p>\n<p>Since the initiator is actively reaching out to create a connection, this state is called Active Open, and the initiator is also known as the Active Opener.</p>\n<h3 id=\"syn_recv\" style=\"position:relative;\">SYN_RECV<a href=\"#syn_recv\" aria-label=\"syn_recv permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADg0lEQVR42nVUTU8TYRCuH0hRoCAtlYqKih6QG6ImmDQiRGLkSLhzQBNNSPgDvXKBQAwn6IkQhCA1BYqINtXaIKRpSaX0kwJb6Lal0NJKAybL+szaIh/2TWZ3dvbZZ+eZmfcVMQzDRaNRbnt7mwsGg5xer+cMBgO3ubkpxOhdOBzm1tfXBT8Wi3Fer1fAGY1GbmNjQ8AlEgnO4XBwIo1G89Tn8z10Op3V8/Pz1b29vYJZLJZqirnd7kezs7OPJyYmnhBucXHxAX54iDOZTNUUw4/ud3d3vxBh5dJFqVSeN5vNWTzPC0Y+xUR/F90vZcJVVVVlpXAldMmxWq0FkLhNcpaXl/eXlpb24fMwtq2trSBFKJ6bmysCLkLSka2Ag0+4wMjICCUmJ0JxKBTKBdCFWrCQ6Uct/AAGAbS1tLTkAXMWlk0/Rj0dhPN4PAIOfghYGwhzgJEdSlar1TI0RT41NVU2NDR0l2XZYoqlpGSlJeNDmc1mk09PT98kHBpU3NfXJz8qWYzC529tbYVBsgfJu3a7fReZ7MfjcT9qJk1nCKLCSCQSTCaTe8gwCclJdPf3zs4Oo9VqL6YzFCSDwAlCFoQkZR3PQUj5qVAo7tbW1l6tq6uToAGSUDi8GE8k/B6vd4UsGottoPiWU5JVKpUYXRP39/fntbe3S1dWVsSdnZ0EEk1OTr56Nzj4knzz+/clu1brVcvo6J3PanUF73AoPr19qzgqOTf1cObkiKRjup6ebNzymior62Nf9dGg/nPSO6FNOj6MJdkvM79/zZoYfmHh0rEMMxCK3Dpdtkqrleqam2+bGxoex78ZPGGDPuTTjbMe7QcW5JGEyWjnGea4ZJ1Olw/JkoGBgZKOjo7r8AtFTU3nvms0zx0/fgxZjMZR48eP9YTl3e5sBuXoaG2VAHdOVVFx4ViX0QgJRiaBYeVdLtcBOnjgW13loyy7+7Os7BlfWpojUypz8XFaxbFRSk3BP0LqciAQcII4gMFmMEbMss8X2AyF7PWlpZW1jY1yatSJ0mQkPKwhZXDCBOD4+Pib4eHh1+TPzMwUIV6EQ+VaV1fXLfiXx8bGiv5HmHFhpKhGBTU1NfVQsuf3+3moOSDD8UV7OYKdc6rLGVfF36JfoOywd60g9a2trblxlrpAuIrdMk9zC0wx4W/ALsOkGYzkXEnh6OSRlpeXy45aiigfdu8PYW6M66s3vdgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way synrecv\" title=\"\" src=\"/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png\" srcset=\"/static/5bd44caabf2f0d8fa07c3974a108337d/69538/3way-synrecv.png 160w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/72799/3way-synrecv.png 320w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/6af66/3way-synrecv.png 640w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/d9199/3way-synrecv.png 960w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/21b4d/3way-synrecv.png 1280w,\n/static/5bd44caabf2f0d8fa07c3974a108337d/7575b/3way-synrecv.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p><code class=\"language-text\">SYN_RECV</code> means the receiver has properly received the initiator‚Äôs SYN packet.</p>\n<p>The receiver then creates an acknowledgment number ‚Äî confirming it received a valid sequence number ‚Äî and sends it back to the initiator. This acknowledgment number is <code class=\"language-text\">initiator's sequence number + 1</code>.</p>\n<p>Creating this acknowledgment number isn‚Äôt complicated. As I discussed in the previous post, when actually exchanging data over TCP, the acknowledgment number is calculated as <code class=\"language-text\">peer's sequence number + bytes of data sent by peer</code>. It‚Äôs essentially a marker saying ‚ÄúI‚Äôve received up to here, so send from here next time.‚Äù</p>\n<p>But during the handshake, no actual data is being exchanged yet, so there‚Äôs nothing to add to the sequence number. However, using the same sequence number back and forth would make it impossible to distinguish packet order. So they simply add 1.</p>\n<p>We can verify this with tcpdump as well:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.receiver > localhost.initiator: Flags [S.], seq 435597555, ack 3414207245, win 65535</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The receiver‚Äôs packet has the flag set to <code class=\"language-text\">S.</code>. The <code class=\"language-text\">.</code> means the <code class=\"language-text\">ACK</code> flag field in the header is set to 1, indicating this packet contains a valid acknowledgment number.</p>\n<p>The receiver is sending the acknowledgment number <code class=\"language-text\">3414207245</code> ‚Äî which is the initiator‚Äôs sequence number <code class=\"language-text\">3414207244</code> plus 1.</p>\n<p>We can also see the receiver generating its own random sequence number, <code class=\"language-text\">435597555</code>, and sending it along to the initiator.</p>\n<h3 id=\"established-initiator\" style=\"position:relative;\">ESTABLISHED (Initiator)<a href=\"#established-initiator\" aria-label=\"established initiator permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADgklEQVR42n1US0sbURQea6OJxvcjVgVLKy4CUtGmLaUQGumituAqG3+AiK0b/QFZiSC4EHQhVgSfVVDUJDagrYnRaK1Ym0ajSTSaTN4m8UFjsxin302TEKX2wpk5995vzj3fd84dym63X56enl4FAgHG5/Mxi4uLzPLyMuN2u5lgMBgxr9fL0DQd8YFlDg8PmaWlJUaj0TD4PrJ+cXHB7O3tMdTMzMxLAJ4aDIYnW1tbot7e3ohtbGyIABCZTKZna2trLxQKRRynVqvjuNXVVRFZw0GPMX9DYfDJQywW3+3r6+OwLBuxzc1NDlmj/g7yTo/hyF4irqamhhPFCcgjbX19PRN0PYQ6sgjv7u6GIcHV2dmZp729vQCYZBhPq9XmAOcCxTgOPgvzqFSqXGAIluJtb2+nQycDgrjNZrPdaDTa/X6/GwcYOjo6coBJgnGxngGcnuD29/cjOOIjoGF+fj4TmLw45YGBgQIUQgCx709PT1dA5MKhoaHCKBVOjDLB6fX6CG58fLzCYrEU9vf3CxIpcyEqHyfRLpcrfHBw8GtnZyeE4L8R1NHc3FwUzTAVemWdnJzYQqFQGExCoBwCJgxpaByQHcswTtnj8bgRkFChMXeB8k5VVZVQIpGU1NfXZ6+srBDK38/Pz2lkZiUGujTk+UH2rlGWyWRcq9XKRRtltLa25hMfa2lkT6lUNo2MjDQRf2pq6p7NZitBRuWTk5NCFKl4bGysOJEyPzpJutkisbXu7u5UvDIqKytrnU6nD0wuY5QhTZhknEj5fwGpwcFB7sLCQl5DQ8ODurq65whgBG0vpHGi0i7MfdDfSFrvWkDT8HAmywayvvb0FH1oaytD02azUmny3Nzca51O9xHXcQq99opg0SKpXV1dvMbGxizgkoVCYcq1KrMQ9EyrDhyp5lmTfPbKDLPC935euGyorn5LUaU8qVjMx8cxFtdaCeNOYkAeiyoHNeqfR5+ULot81maRz9msKqUzoPlitIoeVeklEoG0paXghjS3BoxrSDJINFSRXDlKI5e/105MvCO+SqfLxV4eaJd2dnY+hJ87Ojqa/6+Atw6pTJbSSFFZlyJRrd/huLDRNIuiXBFzOBwsqhwg9/xmlW8d0b9JCqtQ5AT9/m9oncPj42MT+nEfvhW3ZZPc81jAMhj5U+TfYgRUFMVFeq28vLwg0aJ/GdI2wj/W6IuG9QJJxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established client\" title=\"\" src=\"/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png\" srcset=\"/static/71081fa52243d495fece15995bd54306/69538/3way-established-client.png 160w,\n/static/71081fa52243d495fece15995bd54306/72799/3way-established-client.png 320w,\n/static/71081fa52243d495fece15995bd54306/6af66/3way-established-client.png 640w,\n/static/71081fa52243d495fece15995bd54306/d9199/3way-established-client.png 960w,\n/static/71081fa52243d495fece15995bd54306/21b4d/3way-established-client.png 1280w,\n/static/71081fa52243d495fece15995bd54306/7575b/3way-established-client.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator can verify the connection was properly established by comparing its original sequence number with the acknowledgment number from the receiver (<code class=\"language-text\">my sequence number + 1</code>). If the difference between its sent sequence number and the received acknowledgment number is 1, it confirms the connection is valid.</p>\n<p>The initiator then enters the <code class=\"language-text\">ESTABLISHED</code> state. It takes the receiver‚Äôs newly generated sequence number, adds 1, uses that as its acknowledgment number, and sends it back to the receiver.</p>\n<p>So the initiator‚Äôs acknowledgment number should be <code class=\"language-text\">435597555 + 1 = 435597556</code>‚Ä¶ but tcpdump showed something different from what I expected.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [.], ack 1, win 6379</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCBQb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABWi/YjmxwZ//EABoQAAMAAwEAAAAAAAAAAAAAAAECAwAEExL/2gAIAQEAAQUCWY881M+a5rKGCzQZtzVa/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BiP/EABsQAAICAwEAAAAAAAAAAAAAAAABESECEEEi/9oACAEBAAY/Asr5ro5Uj8opRR//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMUHw/9oACAEBAAE/IacrYwEBHs+TEgqPsUrwgQrNsn//2gAMAwEAAgADAAAAEGAf/8QAFhEBAQEAAAAAAAAAAAAAAAAAACEB/9oACAEDAQE/ENRX/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQBx/9oACAECAQE/EELbv//EABsQAQEAAwEBAQAAAAAAAAAAAAERACFBMVHw/9oACAEBAAE/ECaIzaEBEwiQHmL93iWhk/OY5kgRZj8a+ZTd5g8g2JC15n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"why\" title=\"\" src=\"/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg\" srcset=\"/static/0d802ed236b13cf140bc5d184c65e2a3/0913d/why.jpg 160w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/cb69c/why.jpg 320w,\n/static/0d802ed236b13cf140bc5d184c65e2a3/d7854/why.jpg 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Why is it showing 1...?</small>\n</center>\n<p>The initiator‚Äôs final acknowledgment number, which should have been <code class=\"language-text\">435597556</code>, somehow became <code class=\"language-text\">1</code>. <em>(Confused‚Ä¶)</em></p>\n<p>This is actually not TCP‚Äôs own behavior but a <code class=\"language-text\">tcpdump</code> feature. <code class=\"language-text\">tcpdump</code> shows sequence numbers as ‚Äúrelative positions‚Äù to make them easier to read. Capturing data exchanged between the two endpoints afterward makes this clearer:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [P.], seq 1:81, ack 1, win 6379, length 80: HTTP</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The real acknowledgment number would be <code class=\"language-text\">435597556</code>, so the first data packet‚Äôs sequence range should be <code class=\"language-text\">435597556:435597637</code>.</p>\n<p>But since it‚Äôs hard for humans to keep analyzing such large numbers, tcpdump shows the acknowledgment as <code class=\"language-text\">1</code> and starts subsequent sequence numbers from 1 for readability. <code class=\"language-text\">1:81</code> is certainly easier to read than <code class=\"language-text\">435597556:435597637</code>.</p>\n<p>But this is just tcpdump being helpful ‚Äî the actual values haven‚Äôt changed. Using tcpdump‚Äôs <code class=\"language-text\">-S</code> option disables this feature and shows the original numbers:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> tcpdump <span class=\"token parameter variable\">-S</span>\nlocalhost.initiator <span class=\"token operator\">></span> localhost.receiver: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">435597556</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"established-receiver\" style=\"position:relative;\">ESTABLISHED (Receiver)<a href=\"#established-receiver\" aria-label=\"established receiver permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYUlEQVR42nVU3U9ScRimTMX8QAUk0crKvKAu3Izqws1lWlvTzRv/AS+srTY3/wEu88bNG67UC3WOyVpuighYjM3hB3OwESj4AQz5FlEkSduOp+c9gfkRv+095z0/nvP83ud53wPP7/czBwcHTCKRYCKRCGM0GhmTycTs7e1xe/RbLBZjAoEAlx8eHjLb29scbnFxkQkGgxwulUoxGxsbDG96evq1x+N54XK55BaLRa5UKrmwWq1y2tvc3Hy5vLzcrNFoXhHO4XA8x4HnOLPZLKc9HPRsaGiog4dVQpeWlpZba2tr+SzLckE57fH+LroX58I1NTXlZ3DVdCmy2WzlkJggOTs7O6fr6+unyFlEuK+vrzxDyF9dXRUCFyfpqJbDISdcSK1WU2ESIuRHo9ESAN3wIgyZu/BiF8AIgPaenp5SYG4iCulg+LlBuK2tLQ6HPAqsHYRFwIjPJY+OjorRFMn8/HydSqVqCIfDVbSXkZKflYwXxXa7XaLX6x8QDg2qGh4ellyUzIfxZfv7+zGQnEDysdPpPEYlp0dHR7vwTJStEEQV8Xg8kk6nT1BhGpLT6O7vZDLpn5mZuZ2tkJMMAhcIwyAkKQE8RyDlh1QqbWhtba1pa2sToAECYB10ECrzUgAThGzrNckKhYKPrvFHRkZK+/v7RV6vlz84OEgg3tzc3IfJycn3lMOSasxujcFgeAwSGbyX4h3pRcklmYcbV0cku6fVagtxK8V4tEPEAapMozpOMnznJI+PjxdfqjAHIUcGf0RdXV2POjo6mkGwBTuiIKSJIJfikOy8JhkvlkGyYGJionpgYOAe8oru7u48fEnvVlZWVPjMvuh0uvbsIWRHb2+vALg8mUxWcKnLaIQAJ6cwrKzb7T5DB898Ph+L04/r6ure1tbWFqHbJXg5q+LSKGWm4B8hdTkUCrlAHIIMP8bID/IQ9p0ge9rZ2SmhRl2xJifhuYdUwZXggLOzs5+mpqY+Uh5Y+CpkkwGhRam8O/lZ8ZBlDyvXx8aE/yPMudQKBXlU/gZdTpiMJ36DjvVoNWcUwW8G9ueSOQ5/rnU558qYXkCV/FpZskW+L3gCet1m0KB3R4wLvpPVZQvNMDBVhL+PqESIcgTJuZPB0T+PqLm+XsxFY6O4EfcMURniyR8gPYl1Eyx9hwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way established server\" title=\"\" src=\"/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png\" srcset=\"/static/be47dca10f68741755f229c81dba5895/69538/3way-established-server.png 160w,\n/static/be47dca10f68741755f229c81dba5895/72799/3way-established-server.png 320w,\n/static/be47dca10f68741755f229c81dba5895/6af66/3way-established-server.png 640w,\n/static/be47dca10f68741755f229c81dba5895/d9199/3way-established-server.png 960w,\n/static/be47dca10f68741755f229c81dba5895/21b4d/3way-established-server.png 1280w,\n/static/be47dca10f68741755f229c81dba5895/7575b/3way-established-server.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Just like the initiator, the receiver checks that the difference between its sent sequence number and the received acknowledgment number is 1. If so, it considers the connection properly established and enters the <code class=\"language-text\">ESTABLISHED</code> state. At this point, both sides consider the connection safe and reliable, and full communication can begin.</p>\n<h2 id=\"4-way-handshake\" style=\"position:relative;\">4-Way Handshake<a href=\"#4-way-handshake\" aria-label=\"4 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Just as creating a connection requires a special process, terminating one does too.</p>\n<p>You might ask ‚Äúcan‚Äôt we just cut the connection?‚Äù ‚Äî but if one side unilaterally disconnects, the other side has no way of knowing whether the connection was terminated or is still alive.</p>\n<p>There might also be unprocessed data before the connection is terminated, so a process is needed to confirm both sides are ready to properly close the connection.</p>\n<p>This process involves 4 rounds of communication, which is why it‚Äôs called the 4-Way Handshake.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEFElEQVR42pVUSUtbURSObaMxxiimMYNtBbHQZldstAsXLYoItW6KqxakpQjFghURdOUv0I1uxAkRxAFxFkVExVnEBquJcYqkMYnGOMShPvHl9TuvLzZxKO2Fm3tyc3Lu/YZzRVarld3f3+enzWZjh4eH2ZGREXZ3d5fd29vj93d2dvjfKD44OGDX19fZoaEhdnR0lN+nvOPjY9ZoNLKi9vb2lI2NjaTFxcXE2dlZfVNTk762tlY/Pz+vX15e1q+srLyYmppK7unpeeXLm5iY0Dc0NPB5FBsMhiQc9LysrOyNCCOcPkpKSu5xHCf2n7Qn+j1oDbstLycnRyzkaelDCggRDodj12QyeZeWlhjcjDGbzZzb7Xbm5eVFCgUlgKRAnht5BI/BygAB5W11dXVJkaOmgqHb29syJBo3Nzcda2trP2gidoKb74WFhYTgDmaIxWKJtNvta1hdyHGsrq46ELtdLtdSX19fCHJUl5Db2to0uH7M5ORkfEtLiw6xlvYEKGIf5Lq6Ogl+k4BDeVFRkQJxSH5+fqg/5FBcPRynOKD4GSCc4PsJSGYwbRkZGfcpSalUyoQ/BV09REDwpyCUkzmdTjOg70BJO6YDFnGBG1NsbOwTlUoVnZWVFfGvBcP9N0kxnU7H3wbQ79La0dHxrqqq6j3FMzMzBFMBuz2ETeIQR9XX1ytuKhh01SK+PVglmPISExNfQ5RzCMjBGV4I4gUqDqZ24XDiMfqfCiJZJpVK1SkpKc9Q0Ayut6AyUbOF4QQ1BtAWHKByf39/FEGBsg8ICgSJGhwc5KHAY4Uo+sGfBoFDqRDfDRAFysrhuUP0LEcwcLr39PSUDHsCQV7Gx8fL09PT5cKfROh3CdqxAOvXK+h+FwQnYVDZCD7sKGiFqa1kIzwQi8nJycorthHhAiG9vb2fmpubP95U0Mfh38alRQYGBqI9Ho+yoqJClpubqzg6OopubGxU/VdB2IgIF5eXl2tR4ASDw7PlBTKeGoZhXKWlpddUvmnwUKqrq8M1Gs2j1NTUp+D5O+ghWixQ2QKabOB67prKaG4lkjTwlJomXhMN3jr+xNbW1o94J99SDCfwDZCQkOCvckCnSKanp+WHh4ceMikpjFfEi+8clP8JMdKQEwy1w4SCQX4FfW9kYC/DnFJAGQMnCyj4DdMAhRcwx9RqtS4zM1NbXFysvKGXpbf2MnpVRTBh5jg8UU8ohon5B7Ozs/ML4s8Uj4+Pa9EpMd3d3Y9ramp0sJcWva4NgEzGhnoelmU5JPOQKT4/P9/Lzs6OFG4VgV5OAw3MxcXFZR4o4M7OzgJ6mYcM/ibxZBmh3AIafwGxCXOsoKAgzPdiV1ZW3kfeNIr65y1D5dG5uTmxT2W5cIPbJl9MoOZvOTzkX+JaE9Cfxie/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way handshake\" title=\"\" src=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png\" srcset=\"/static/0801c4db6e47a4d1aed92a4a4424bf16/69538/4way-handshake.png 160w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/72799/4way-handshake.png 320w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/6af66/4way-handshake.png 640w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/d9199/4way-handshake.png 960w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/21b4d/4way-handshake.png 1280w,\n/static/0801c4db6e47a4d1aed92a4a4424bf16/7575b/4way-handshake.png 1608w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Again I‚Äôm using the terms initiator and receiver ‚Äî just like with the 3-Way Handshake, either the client or server can initiate the disconnection.</p>\n<p>The side that originally requested the connection might initiate the termination, or the side that originally received the connection request might be the one to initiate termination this time.</p>\n<p>Developers tend to be more sensitive about the 4-Way Handshake than the 3-Way Handshake. If something goes wrong during connection creation, you can just retry. But if something goes wrong during the 4-Way Handshake ‚Äî which terminates an already-established connection ‚Äî the connection remains stuck.</p>\n<p>Moreover, unlike the sequential back-and-forth of the 3-Way Handshake, the 4-Way Handshake includes waiting periods where one side waits for the other to respond. If anything goes wrong in between, both sides can end up just waiting for each other ‚Äî a deadlock.</p>\n<p>Of course, depending on configuration, a timeout might kick in after a certain period, forcing the connection closed or advancing to the next step. But during that time, the process is still occupying memory and a port, so for high-traffic servers, this can always cause bottlenecks.</p>\n<h3 id=\"fin_wait_1\" style=\"position:relative;\">FIN_WAIT_1<a href=\"#fin_wait_1\" aria-label=\"fin_wait_1 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEWklEQVR42pVV3U9aZxw+XSfSARpkioy0yVy6rmb2xuGMmTE28WYzbF6QLE22XdUba3bVxO3G/8BE442hkRjiF1anxTHNqqCi25zR1Vik8iHfB1FRURGmh7PnPT0YdGxzb/LC77w85/d7n+f3AeX3+5m9vT1uE3t6epqxWCzMzs4OE41GufOtrS0mEAhw9sHBAeN0OpmpqSlmdnaWCQaDzP7+/unR0RG7vb3tpcbGxu673e6P7Xa7an5+XjUwMKDq7u5WLS8vq8jZxsZGpdVqrR4fH68luLW1tQoEVOn1eg5H3iG49fX1qsXFRRWFJSYfra2tb7Ism5O5yRn1euVgi4jR2NiYcxlXU1OTxnHfQpvNJqNpeh9RGNhJREziZuzu7m5ArVZLysvLicNcl8slJzhgOBzwCdAnuE2NRkMudp04zIVW+SGadrjcbtrhdPkdTqd/0+PZ2o1GV+rr69/igQLoKAuFQptYEYfDEcamYUeh9wqCEty1c8pLer2CPT5WvjQ+vW3Rau+yvlfK33S64gzK5AVKp9MJQVMIDfNaWlpkxIY0wkzKuezcnDQ2N7PjnfwpsfFsNG4f/eF4zzr759GC1bv/4DMpiSznNUzfIjNIxhnvcGkp/2DO4g5PP494TD/SvgkTvTc/tx2bn11LKJW3h0tKiso1mvyrOhTzD29w1Lu6curu3eNuozEYOJF/NRq/ft7V9SWxn5nNb4OmzGAw3Oro6HgXdgFKSprNYWaUC/TgWPCYoiTe6urPd8Lhs2AoxLpdrpTH42EikQgbj8cDdXV1ogtJ+TeHo0+eSPBV/L1a/REdDDpRAUGUUAiFDt+hLXTQYmVl5Y0LDicmJgoIlf7+/pttbW0lpETIGfkN3fTdU4PhK2IbeBmIhgqFIntSvF6vFLUYR8+yqKsUijV1cnLCgs6hWCz+pKKiIo8UOP8StbCwcAP78czMzCPq4nrtENfPD4fDG9ikan0I4EWx0mj2F2VlZVL+BmkZKGCESETj0NDQN9kciqn/Xue9DPryWCxW2NnZKW5qapIdHh4WQYZCHnf9Sg5LS0sFJHpPT88tjKkEnLDQOIW+ZhKJBHt6ehoARnw5y9kWB2hvb8+TSqU3GxoaPoSuNkjjRclsIsub0D0I/Rf+luXh4eEigBS4QTHZmCaKycnJIvIbtHrY29v7BbFRCVwD8BMoe5YxNAugSxyRWSQohdGVIrSQlGORSHSfTBq5XC7iHV677DB9dj4P8aIEVH6BJi/gcAVl8wdorCLTFoFAcAezTtnc3Fz4v3pZq9XKCWWTyfQeRtQHhLKOH19Go/HbwcHBh3wNKn0+n3JkZOR9JOkuLvOO2WwuzswyRxkUT87OzliAUxicKSw2mUxGqqqqJJh3RLe82traT8kfEhaLUiUNwIAuwQXwN3CeZY4ysrUImjZkbhW0V9GfdjybARSmJ3ZfX58cuN9x/jID9wrPP/M4LmES3vM/bQLKvSJO8BeWZwg1dMYKUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait1\" title=\"\" src=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png\" srcset=\"/static/b07b2ad2c9241e70aa0b8c9de86237af/69538/4way-finwait1.png 160w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/72799/4way-finwait1.png 320w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/6af66/4way-finwait1.png 640w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/d9199/4way-finwait1.png 960w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/21b4d/4way-finwait1.png 1280w,\n/static/b07b2ad2c9241e70aa0b8c9de86237af/5eb90/4way-finwait1.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The initiator ‚Äî the side wanting to terminate the connection ‚Äî sends a FIN packet to the other side and enters the <code class=\"language-text\">FIN_WAIT1</code> state.</p>\n<p>The FIN packet does include a sequence number, but this time it‚Äôs not randomly generated. The 3-Way Handshake needed random initialization because there was no existing sequence number. This time, since sequence numbers already exist, the initiator simply uses whatever sequence number is next in order.</p>\n<blockquote>\n<ul>\n<li>Initiator ---<strong>SEQ: 1</strong>---> Receiver</li>\n<li>Initiator &#x3C;---<strong>ACK: 2</strong>--- Receiver</li>\n<li>Initiator ---<strong>FIN: 2</strong>---> Receiver</li>\n</ul>\n</blockquote>\n<p>Think of it as just changing the FIN flag to 1 and sending. The meaning of this flag is basically: ‚ÄúI have nothing more to say.‚Äù</p>\n<p>Since the initiator is actively initiating the disconnection, it‚Äôs called the Active Closer, and this state is called Active Close.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">localhost.initiator > localhost.receiver: Flags [F.], seq 701384376, ack 4101704148, win 6378</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>But when I captured the initiator‚Äôs termination request, the flag wasn‚Äôt <code class=\"language-text\">F</code> but <code class=\"language-text\">F.</code> ‚Äî meaning <code class=\"language-text\">FIN+ACK</code>. Looking at other blogs that captured packets with tcpdump, I could see most people encountered the same situation.</p>\n<p>Theoretically it should be a <code class=\"language-text\">FIN</code> packet, so why is it being sent as <code class=\"language-text\">FIN+ACK</code> with an acknowledgment number bundled in?</p>\n<h4 id=\"the-half-close-technique\" style=\"position:relative;\">The Half-Close Technique<a href=\"#the-half-close-technique\" aria-label=\"the half close technique permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The reason the initiator sends a <code class=\"language-text\">FIN+ACK</code> packet is the Half-Close technique. As the name suggests, instead of fully closing the connection when terminating, you only close half of it.</p>\n<p>When using Half-Close, the initiator includes an acknowledgment number in its initial <code class=\"language-text\">FIN</code> packet. The meaning is: ‚ÄúI‚Äôm going to close the connection, but I‚Äôll keep my ears open. I‚Äôve processed up to this acknowledgment number, so if you still have data to send, go ahead.‚Äù</p>\n<p>In other words, ‚Äúclosing half‚Äù means closing only one of the two streams ‚Äî the send stream ‚Äî while keeping the receive stream alive.</p>\n<p>The receiver can then send any remaining data, and the initiator can process it using its still-alive receive stream and respond with <code class=\"language-text\">ACK</code> packets. Once the receiver finishes sending all data, it sends a FIN packet back to the initiator, signaling that all data has been processed.</p>\n<p>Then the initiator closes the remaining half, terminating the connection more safely.</p>\n<p>In socket programming, you can use <code class=\"language-text\">close()</code> or <code class=\"language-text\">shutdown()</code> to terminate a connection. Using <code class=\"language-text\">shutdown()</code> enables Half-Close.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span>sockfd<span class=\"token punctuation\">,</span> SHUT_WR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If the initiator uses <code class=\"language-text\">close()</code>, all streams are destroyed immediately as the socket‚Äôs resources are returned to the OS. So even if the receiver belatedly sends unsent data after receiving the FIN packet, there‚Äôs no way to process it.</p>\n<p>In the example above, passing <code class=\"language-text\">SHUT_WR</code> as the second argument declares that only the send stream will be closed first.</p>\n<p>For more details, search for ‚ÄúHalf-Close‚Äù or ‚Äúgraceful shutdown‚Äù ‚Äî there‚Äôs plenty of material available.</p>\n<h3 id=\"close_wait\" style=\"position:relative;\">CLOSE_WAIT<a href=\"#close_wait\" aria-label=\"close_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAESElEQVR42pVVXUhbZxg+rjXGJVFipkkWWpijayvTG5dMZEMsvRri5oWwm3W7qTdOSikFd+VF76WCDIqiiMSfiEJmlkWcJrpouxS0FRf/8/9jEo1RE02qJ2fPd3q0x5Bt7oMv58uX57zf9zzP+76hvF4vvbe3x06ynp6epi0WC72zs0NHo1F2PxQK0T6fj13v7+/Tm5ub9NTUFD07O0v7/X46FoudxONxJhKJuCm9Xn/H4XB8vrq6qp6bm1MPDQ2pe3p61AsLC2qyt76+XmW1Wr80GAy1BLe8vKzBger+/n4WR94huJWVlWqbzaamMMTko62t7SrDMLn8SfaotyMXU0QWTU1NuZm4mpqaMxz7FNrtdlkwGIzhFBrrFE5M4WbM7u6ur76+XlJZWUkC5m1tbckJDhgWB3wS9AnO2djYSC52hQTMg1aFgUBgA5SCAHg3Nja8LpcrBOBiXV3d+xxQAB1lwDkxwsBsYwaxjkLvRRxKcDnnlEdHR5W4vgr63BgbG7udSCRUOp1OwaNMXqB6e3uFwAmhYUFra6uMrCGNkE85z+12S8Ph8A6eybW1tSNQScC5N3DVXV5eLuVOFnEv5WQewtt7GxDaFCI1HNvb22Gsg4Q6AkZAZVkikdwoLS0tgUaFlw0o5r68d+ZiRUUFextQZkUeHx+/1/3s2bdk7f9F+wEDLSefPr2ue/LkIyYWK1rSaqXZAvJPuUAPgQV4SH7QaL6OzVhO/b9PMg6jIe0yGenIjJl58/JP36tHj0QXTPm3gI+7uyW9FKVw3737WdQyvekxGf1OoyHg+u1Xf2BqMhR/brV5Hj7MvxDQZDIVwTHZ4ODgtfb29tJ90NJhj/z2h17/06xO9x1fBqKhUqnMbgpxGbl4BGMY5FUauZhOHB8z8XD4cEss/sKo0RTcRIJzL1HzHk++9cWLx+aZmR+pi+Ody3B4HZNkrQcHuOFwcC8Sef0zlzbydzJQwAhR200jIyPfZwsopv5jVPJqGc1EfnBwUNzZ2Slubm6WHR4elkCGYg565VIBy8rKiMtX+/r6rqNNJREEmeNLo67pZDLJnJyc+IARZ7qcbbCAjo6OAqlUeq2hoeFTVJQd0rhR604UgBO6+6H/fFVVVX5mLZcApMQNFGSimygnJiZKyG/Q6r5Wq/2GrJEJbAFwHSi7y2iaRdDlCCczMCiN1pUmtNCBEyKR6A7pNHK5XMQFzMkMeLZ33g/xogRUnkOT1wi4iLR5BRpLcNoiEAhuoo5VLS0txf+rlru6uuSEstFo/Bgt6hahjKeCq+UHw8PD99kcnJ9XeTweFVrcJzDpNi7zodlsVvBdZimD4vHp6SkDcBqNM43BpFKpcHV1tQT9juhWUFtb+xX5Q8JgkKqkAGjQJTgf/gbOXWYpwy0baNrh3BJoL6EXruK7GUDhWcceGBiQA/cS+3/xcGv4PsnhWMMkXOR/mgSUd0mc4G+aEgkbh9qDcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closewait\" title=\"\" src=\"/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png\" srcset=\"/static/f08ce32e213678f2016221fe117de99c/69538/4way-closewait.png 160w,\n/static/f08ce32e213678f2016221fe117de99c/72799/4way-closewait.png 320w,\n/static/f08ce32e213678f2016221fe117de99c/6af66/4way-closewait.png 640w,\n/static/f08ce32e213678f2016221fe117de99c/d9199/4way-closewait.png 960w,\n/static/f08ce32e213678f2016221fe117de99c/21b4d/4way-closewait.png 1280w,\n/static/f08ce32e213678f2016221fe117de99c/5eb90/4way-closewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After receiving the <code class=\"language-text\">FIN</code> packet from the initiator, the receiver creates an acknowledgment number using <code class=\"language-text\">initiator's sequence number + 1</code> and responds to the initiator, entering the <code class=\"language-text\">CLOSE_WAIT</code> state.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.receiver <span class=\"token operator\">></span> localhost.initiator: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">701384377</span>, win <span class=\"token number\">6378</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Since the initiator sent <code class=\"language-text\">701384376</code> as the FIN packet‚Äôs sequence number, the receiver‚Äôs acknowledgment number becomes <code class=\"language-text\">701384377</code>.</p>\n<p>The receiver will then continue sending any remaining data, and once everything is sent, it explicitly calls <code class=\"language-text\">close()</code> or <code class=\"language-text\">shutdown()</code> to proceed to the next step.</p>\n<p>This means the initiator doesn‚Äôt know when the receiver will finish processing data, so it must wait until the receiver completes its work and sends back a <code class=\"language-text\">FIN</code> packet signaling agreement to close.</p>\n<p>If the receiver finishes processing data but the termination function isn‚Äôt explicitly called at this stage, the connection can‚Äôt advance to the next state ‚Äî creating the potential for deadlock.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVR42q2T2wrDIBBE+///GHKD3Bujxkg0yXTXktKXQohdmAdBjruz48N7DykliqJAmqboug5cx3FckhACShrMywbrdjyc37AsFsPwxDRJeDrTvctyzpE8/HaQGEgHpRTqukbTNNBa427t+xewbdswNoPPkW8DtZ5p5CEAGfwHoA7ALMtQVVU8UBGQOyvLkhYzxXvIHfJC2L88z9H3ffxSGMhKkgTGmBigCx1yoM8u7/j3AVprQ6AZeEaHH+Af9A7tb63rinEUQew9s15AXl7Gmc11bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"deadlock\" title=\"\" src=\"/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png\" srcset=\"/static/0bd0fc4fa229c60f0980e590aafde785/69538/deadlock.png 160w,\n/static/0bd0fc4fa229c60f0980e590aafde785/72799/deadlock.png 320w,\n/static/0bd0fc4fa229c60f0980e590aafde785/6af66/deadlock.png 640w,\n/static/0bd0fc4fa229c60f0980e590aafde785/d9199/deadlock.png 960w,\n/static/0bd0fc4fa229c60f0980e590aafde785/21b4d/deadlock.png 1280w,\n/static/0bd0fc4fa229c60f0980e590aafde785/229ad/deadlock.png 1356w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Google's autocomplete suggestions speak to the pain of developers caught in deadlocks</small>\n</center>\n<p>Since the receiver only passively prepares to close after receiving a termination request, it‚Äôs called the Passive Closer, and this state is called Passive Close.</p>\n<h3 id=\"fin_wait_2\" style=\"position:relative;\">FIN_WAIT_2<a href=\"#fin_wait_2\" aria-label=\"fin_wait_2 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEPElEQVR42pVVTUxjVRR+OEPp2D5IqaWtzUwizowOETZYJERCmISNQ1AWJG7U1bBhiCsTXHXpGsIsCARCCARKICEwIFHoj4XROgGnwfL/0/8foJSfdlrh9fmdNw8sWBVvcvtO7/vuufc73znnMR6Phzs4OBAm2bOzs5zZbOb29va4SCQirIdCIc7r9Qr24eEht7Gxwc3MzHBWq5Xz+XxcNBo9PTk54Xd3d13M2NjYw62trY9WVlb0c3Nz+sHBQX13d7d+YWFBT2tra2vlNputcmJioppwS0tLZThQ39fXJ+BoD+GWl5cr7Ha7nsGQ04/BYLjJ83x2+qQ15vXIxpSR0djYmH0VV1VVdY4TnlKn06kMBAJRnMLBTuLEJG7G7+/ve+vq6tjS0lJymLO5uakmHDACDvgE6BNuu6GhgS52gxzmIFZ5fr9/HZQCAHjW19c9Ozs7IQAXa2tr3xSBEsRRCdw2RhiYIGYAdgTxXsShhMu6oDwyMqLF9XWIz73R0dEHsVhMZzQaNWmUaQPT09MjBU6KGOa2tLQoyUZopOmUc1wulyIcDu/hmVhdXY2DSgzK/QFVXcXFxQrxZJm4KevqIWlrrx0iNnlIja1gMBiGHSDqcLgLKkssy94rLCwsQIzyrutQLv5541zFkpIS4TagLAR5fHz8y46Ojs/JNplMb4GmEu/utLW1vQM7HymlyOQw/ZRL9LBZggdbWVn5KVicQRgeTFIQjkOo+Hg87q2pqZFdEuXfHHZ1dbF4aJBCH6IyNuDIB4d+hMYH5yHE2l5eXn7rkkO3sTOf9zqVlqdPb/cbDIW88xel+3tjPr1DNX2LW36RHgaKoVarzSwK73AoYs9t8aBpht+ZmkxtPhtPvbL/zEes5uP7KtXHd8vKcinBxU3M/Pz8LcxvLBbLE+byEB2+eJEX/cmyFpz90e+aeuZ2T0+59q3mwKHN8vK7R4+EtFH/FQYGySyFEI3Dw8NfZXIoZ/57XNQy6KuPjo5U7e3t8qamJuXx8XEBwqAScTeu5bCoqIhUvtnb23sHbSoBJzzKMIW65hKJBH96euoFRn5V5UxDALS2tuYqFIrb9fX1HyBNnEgdF5TehsrbKAgfesH831RGLRcApMUNNDTRTbTT09MF9A6xetzf3/8Z2UhkoQDEDpRZZTTNfMQljpOFhEXrShEtdOCYTCZ7SJ1GrVbLRIdZVx2er130Q2xkQeU5YvISDhfRwn4DDQdq2SyRSN5DHeuam5tV/6uWOzs71UR5cnLyXbSo94kynhqxlr8eGhp6LOagzu1269Di7kOkB7jM26hvTbrKAmVQfHV2dsYDnELjTGHwyWQyXFFRwaLfUdxyq6urP6EPEgaPVpeijxXoEs6Lz8CFygJlqGUHTSeUc4C2A/W5gv8mAKXnHXtgYEAN3K9Y/z0Nt4r/P4g4QTBW9PxPk0A518RJ/gTqwAStpoJTXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way finwait2\" title=\"\" src=\"/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png\" srcset=\"/static/608e421d25ac8fa76021750f0110bed6/69538/4way-finwait2.png 160w,\n/static/608e421d25ac8fa76021750f0110bed6/72799/4way-finwait2.png 320w,\n/static/608e421d25ac8fa76021750f0110bed6/6af66/4way-finwait2.png 640w,\n/static/608e421d25ac8fa76021750f0110bed6/d9199/4way-finwait2.png 960w,\n/static/608e421d25ac8fa76021750f0110bed6/21b4d/4way-finwait2.png 1280w,\n/static/608e421d25ac8fa76021750f0110bed6/5eb90/4way-finwait2.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>The initiator receives the acknowledgment number from the receiver and verifies that the difference between its sent sequence number and the acknowledgment is 1. But since the receiver might not have finished sending all its data, the initiator enters <code class=\"language-text\">FIN_WAIT2</code> and waits for the receiver to send a <code class=\"language-text\">FIN</code> packet granting permission to close.</p>\n<p>As I explained in the <code class=\"language-text\">CLOSE_WAIT</code> section, from this point on the initiator keeps waiting until the receiver sends a <code class=\"language-text\">FIN</code> packet.</p>\n<p>Unlike <code class=\"language-text\">CLOSE_WAIT</code>, however, it doesn‚Äôt wait indefinitely. If a timeout is configured via kernel parameters, the connection can automatically advance to the next step after a certain period.</p>\n<h3 id=\"last_ack\" style=\"position:relative;\">LAST_ACK<a href=\"#last_ack\" aria-label=\"last_ack permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEQElEQVR42pVV30+aVxj+ulbEARpkCoy0yVy6rWZ6Q7HGzBibeLMa543JbrZd1YtmZunFEnvlf2Bal10YrcaY+jOaGC3RrQIaoClmao1DBRT5JfJDRRGQjY/T53x+WrS2cyc5nPc73/O95zzv874vjMfjYff29rhJbZ1OxxoMBjYcDrO7u7vcfiAQYL1eL2fv7++zDoeDnZ6eZmdnZ1mfz8dGIpF/Dw8PSSgUcjFjY2N3NzY27qyurmpMJpNmYGBA09XVpZmfn9fQPZvNVm40GisnJiaqKW55ebkMB2p6e3s5HP2G4lZWViosFouGwRDTn5aWlmuEkKzMSfeY45GFKaJGY2Nj1nlcVVXVCY5bhVarVeb3+yM4hYWdxIlJ3Izs7Ox46+rqJGq1mjrMXl9fl1McMBwO+CPQpzhnQ0MDvdhV6jAbscrb2tqyg5IfAI/dbvdsbm4GAFyora39mAcKEEcZcE6MIDDbmH7Yu4j3Ag6luCunlEdGRpS4vgrxuTk6OnorFouphoaGFBmU6QdMd3e3EDghYpjb3NwsozZCI8yknO1yuaTBYDCM9WhtbS0OKjEo9w9UdZWUlEj5k0X8R1fOH5Kxd+wQsclDamxsb28HYfspdTgMgcqyRCK5WVRUVIgY5V3WoZh/+OhExdLSUu42oMwFeXx8/Mf29vbvqa3X6z8BTRne3Whra/sMdj5SSnqRw8xTztDDxwIsksrKyu/AIgVhCJikIRyLUJF4PO6tqakRnRHlQw47OzslWBRIoduoDAcc+eBwC6HxwXkAsbaUl5fnnHE4OTmZT6n09/dfb21tLaIpQvfoO1TTI9zyh8ww0BgqlcqLRaEqIxfjEIYgr9LIxXQikSCgExWLxd+UlZXl0gTnP2LMZnMO5q8zMzM/M2fHW5URGxsmzVo3DnBBYT+K/fUFacPonU7hmFbbODg8/NNFDsXMf4/TWl7q65AT23yBHqX2W329jDgWC21DTwt43NVLOSwuLqYqXyOPH99Izb06OnhpIr4Xf6T9uhdsYu4VIYt/efUPHojPq/zOIDyg6cmT3N+l0uvk3r2vo8ZZa0A/7XJPPXe6Jp87wwad79BsMpsfPsw5X8uFSAclGqWCTnQT5cjUVCF9Zxwevq9/9qyea3OEcAWgVn9AZTTN/IODgzhE4RLWbrOlI9EoiYVCMZNIdBc3FTByORdDpNa7pfd277gfQk0JUuQlet1rOFxA2iwijZb2wmHDbYHgS9Sx6lFTU8H/quWOjg45pazVaj9Hi/qKUsaq4Gv5l8HBwft8DqrcbrcKLe6Lnp6eW7jMp6hvRabKHOVoNJpIpVIE4DQaZxqDJJPJYEVFhQT9jsYtt7q6+lv6h4RBkKq0AFiEgOK8+Bs4VZmjjCqxgKYV9bkE2kuoz1U86wEUnnTsvr4+OXBz2P87A7eG5z95HCeYhPf8vklB2ZfECd4A2pIHyYStE2kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way lastack\" title=\"\" src=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png\" srcset=\"/static/4450fb7c2d129c97c1c1b5c1d9910fd4/69538/4way-lastack.png 160w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/72799/4way-lastack.png 320w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/6af66/4way-lastack.png 640w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/d9199/4way-lastack.png 960w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/21b4d/4way-lastack.png 1280w,\n/static/4450fb7c2d129c97c1c1b5c1d9910fd4/5eb90/4way-lastack.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Once the receiver has no more data to process, it explicitly calls a termination function and sends another <code class=\"language-text\">FIN</code> packet to the initiator ‚Äî signaling agreement to the initiator‚Äôs earlier termination request.</p>\n<p>The sequence number in this <code class=\"language-text\">FIN</code> packet uses whatever sequence number the receiver is supposed to send next, and the acknowledgment number reuses the last one it responded with.</p>\n<p>The receiver then enters the <code class=\"language-text\">LAST_ACK</code> state and waits for the initiator to send back an acknowledgment number.</p>\n<h3 id=\"time_wait\" style=\"position:relative;\">TIME_WAIT<a href=\"#time_wait\" aria-label=\"time_wait permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERklEQVR42pVV309aVxy/tlXo5GrwTpGRNplL19VMXxzOmBljE18W4+YDyZJl21N9sc2elrgn/wMTjS8mRmMN1co0odDMbSI/hnRhja6GgQqCCIjgbwWE4eXsc27RoWObO8nhfjn3c77f8/18vt9zmUAgwO/v7wuT2nNzc7zJZOJ3dnb4vb09YT0SifDBYFCwDw8PeY/HwxsMBt5isfChUIg/ODhIx2Ixsr297We0Wu19r9f74fLysnJ+fl45MTGhHB4eVi4sLCjp2urqaoPVam3S6/UtFOdwOOoRUDk2Nibg6B6Kc7lcjXa7XclgSOhPT0/PDUJIYe6ka8zrUYhZTI3Ozs7Cy7jm5uYznPAUO51OLhwOHyAKDzuFiCmcjOzu7gbb29vZuro66lC0trYmozhgBBzwSaRPcT6VSkUPdp06FIGr0s3NTTdSCgMQcLvdgfX19QiAi21tbW9kgUXgkQPOhxEFZgszDHsPfC8iKMUVnKc8NTUlx/EV4OfO9PT0vXg8rpicnKzMSZluYEZGRsTAicFhSXd3N0dtUCPOTVnk9/ul0Wh0B8/kyspKAqnEodwfUNVfU1MjzUYuzm4quBwkZ+21Q3BTitLwbm1tRWGHaepwuI1UHCzL3qmqqqoAR6VXdSjJ/rl2pmJtba1wGqQskKzT6b4cHBz8jNpGo/FNpMnh3e3+/v63YZehpKT5HOZGuZAeNhfhwTY1NX2CLE4hDEEmGQjHgyqSSCSCra2txRdE+TeHQ0NDLB6VKKEP0BkeOArB4SaoCcF5BFzbGxoabl5wODMzU0ZTGR8fv9Xb21tFS4Su0Xfopm9xyi9yaaAcyuXy/KJQlVGLCQhDUFcZ1GLm5OSEIJ1jiUTyUX19fQkt8Owmxmaz3cT8xmw2P2Qujr9UBjermLRqNxDAD4XDaPZXecqGAUYMITo1Gs1X+RxKmP8e572M9GVHR0flAwMDkq6uLu74+LgCNJRncdev5LC6upqqfGN0dPQ2rqkknBBwnEFf88lkkqTT6SAwkssq5xsCoK+vr0Qqld7q6Oh4H7w6QY0fSvugsg+8h8C/7W8qex4/riAvX8qJw1EpTPP38vAPUxX03bRG80CtVn9KbVSC0ADZGyi/ygTlkbL/kgjPGYj3uS7j1j/LHL2wkUOLKd7CcffpTSOTyYqzDgsuOzxbO78PicvKxqzmFxHDj6/Wnz9b9Om1v+1bjEuxn00mF8fdXVSpFKpHj8r/Vy9rZ2dlsWhUbjUY3vlOrX4PXMlRGsL1ZdLpvrY+ffqA2rM2m2JjY0OBK+5diHQPpfUW+rsyV2URvhNlUO7k9PSUAJzBxZnBIKlUKtre2Mji+3Dtc4YpibW0fBzDBymVThOUKm0AHulSXBCfgXOVxYjCQi071HJCuSUU+hL6cxn/jQCKz27srSdPZNFI5Fes/56DW8H/n7I4QTA26/mfJgWJuKvhiv4EPZUHkwvVy94AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way timewait\" title=\"\" src=\"/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png\" srcset=\"/static/9d3cabeb3e6e66223cb4475d42aba133/69538/4way-timewait.png 160w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/72799/4way-timewait.png 320w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/6af66/4way-timewait.png 640w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/d9199/4way-timewait.png 960w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/21b4d/4way-timewait.png 1280w,\n/static/9d3cabeb3e6e66223cb4475d42aba133/5eb90/4way-timewait.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Upon receiving the receiver‚Äôs <code class=\"language-text\">FIN</code> packet, the initiator creates an acknowledgment number using <code class=\"language-text\">receiver's sequence number + 1</code> and responds with an <code class=\"language-text\">ACK</code> packet. The initiator then enters <code class=\"language-text\">TIME_WAIT</code>, beginning the actual connection termination process. The role of <code class=\"language-text\">TIME_WAIT</code> is to prevent the connection from falling into deadlock due to unintended errors.</p>\n<p>The wait time in <code class=\"language-text\">TIME_WAIT</code> is defined as 2MSL (Maximum Segment Lifetime), and the exact MSL value is defined by kernel parameters.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sysctl</span> net.inet.tcp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> msl\nnet.inet.tcp.msl: <span class=\"token number\">15000</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On my machine (macOS), MSL is set to 15 seconds. So my computer waits about 30 seconds in <code class=\"language-text\">TIME_WAIT</code>. Note that this value cannot be changed, so the time spent in <code class=\"language-text\">TIME_WAIT</code> is fixed.</p>\n<p>The commonly mentioned TCP timeout parameter <code class=\"language-text\">net.ipv4.tcp_fin_timeout</code> controls the <code class=\"language-text\">FIN_WAIT2</code> timeout and doesn‚Äôt apply to <code class=\"language-text\">TIME_WAIT</code>.</p>\n<p>But just like <code class=\"language-text\">CLOSE_WAIT</code>, deadlocks can occur here too. That‚Äôs why many network engineers use various methods ‚Äî like adjusting the <code class=\"language-text\">tcp_tw_reuse</code> kernel parameter ‚Äî to reduce time spent here or eliminate deadlocks caused by bad luck. <em>(A state designed to prevent deadlocks that itself causes deadlocks ‚Äî the irony.)</em></p>\n<p>But as they say, leaving it alone is usually the best approach.</p>\n<h3 id=\"closed-receiver\" style=\"position:relative;\">CLOSED (Receiver)<a href=\"#closed-receiver\" aria-label=\"closed receiver permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAERElEQVR42pVVS09bRxg1TTBObYOMC7ZrJVKp0jSosKGmyCpCjcSmRbQskLpJuwqLUJRVJbriH5CA2BAQCCHESyAhuwTagjExTuUUSCxq3viNsTFgHn7VXN+e73KhhrptOtIw47lnvplzzjcfArfbzRwcHHCd5tPT08zMzAwTDAaZ/f19bt3v9zMej4ebHx4eMhsbG8zU1BQzOzvLeL1eJhQKJU5OTtjd3V2nYGxs7N7W1tYnKysrmrm5Oc3AwICmq6tLs7CwoKG1tbW1MpPJVK7X6z8j3NLSUikO1PT29nI42kO45eVlrcVi0QjQJPSnqanpOsuymamd1gRnLRNdTJO6urrMq7iKiopzHDeKbDab3OfzhXAKg3kcJ8ZxM3Zvb89TXV0tLSkpoYBZm5ubCsIBw+GAj4E+4ey1tbV0sWsUMAta5Wxvb6+Dkg8A9/r6utvhcPgBXKyqqnqbBwqhoxw4O1oAmB10H+b70HsRhxIu44LyyMiICtdXQ5/bo6Ojd8PhsHpoaEiZQpk2CLq7u0XAiaBhdmNjo5zmkEaUSjnL6XTKAoFAEGNsdXU1AiphOPcHXHUWFRXJ+JPF/KaMq4ekrJ0FhDY5SI2tnZ2dAOY+oo6Au6CyJJVKbxcUFORDo5w3DSjhf7x17mJxcTF3G1DmRNbpdN+0t7d/TXODwfAOaMrx7VZra+t7mOcipWTpAqaecokeNgsxSMvLy78Ei1MYw4JJEsYxkIqNRCKeyspK8SVT/i1gZ2enFIMSKfQxXsYGAnkRcBvSeBHcD60tZWVlNy4FnJiYyCUq/f39N5ubmwsoRWiNvuE1/YBb3k+VgTRUqVTpTSGXkYsRGMMir5LIxWQ0GmVB51gikXxaWlqaTQnObxKYzeYb6N8bjcbvBJfbXy5DmzV0yloXDnDCYR8e++s0aSMARgQj6oaHh79NF1Ai+O928ZZBX3F0dJTX1tYmqa+vlx8fH+dDhjwed+2NAhYWFpLL13t6em6hTMUQhIXGSbxrJhaLsYlEwgOM5KrL6RoHaGlpyZbJZDdramo+gq42SOOE03a4bIfuXuhv/pvLeMv5AKlwAyV1VBPV5ORkPn2DVg/6+vq+ojkygXsAfAVK7zKKZi50ieBkLmFRupJEC6aExWLxPao0CoVCzAfMuBrwfO2iHmKjFFReQJPXCLiItHkFGlY4PSMUCu/gHasbGhry/tdb7ujoUBDl8fHx91GiPiTKGJX8W340ODj4gOZBnU7Nms3q2adPP/jp8eO77Pz8u369XpnqMkcZFKOnp6esy+VKonAm0dh4PB7QarVS1DvSLfsLrfbz6K/mRHz+JeuafJbc/FHPsNZXLLPwm8fw8OGFyxxluGUBTRucs4K2Fe9zBb8N+H8hOq/Yvzx5ojh6bnwZMhl/dzzTWx3jemto7vlq+IXpZ/tZkeUMk/KR/6kTKCsVx1KHEbwZqTjhn+PqDKvbZq2WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed server\" title=\"\" src=\"/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png\" srcset=\"/static/7d21721d413da9a3d6803c77909963be/69538/4way-closed-server.png 160w,\n/static/7d21721d413da9a3d6803c77909963be/72799/4way-closed-server.png 320w,\n/static/7d21721d413da9a3d6803c77909963be/6af66/4way-closed-server.png 640w,\n/static/7d21721d413da9a3d6803c77909963be/d9199/4way-closed-server.png 960w,\n/static/7d21721d413da9a3d6803c77909963be/21b4d/4way-closed-server.png 1280w,\n/static/7d21721d413da9a3d6803c77909963be/5eb90/4way-closed-server.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After receiving the initiator‚Äôs <code class=\"language-text\">ACK</code> packet, the receiver enters the <code class=\"language-text\">CLOSED</code> state and fully terminates the connection.</p>\n<h3 id=\"closed-initiator\" style=\"position:relative;\">CLOSED (Initiator)<a href=\"#closed-initiator\" aria-label=\"closed initiator permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 119.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEUElEQVR42pVVTUxiVxTGzghMAQ1SBUpmktpMp2OqG4s1TY1xEjeNsXVh0k3bpMm4cUxXk9iVKzeTxkTjxsRojfE/mlpJ1TaKEmAaamUkFlT+5E/kT1AEYejj9bvPh0VL2+lNLu9w33fPvef7zjmP4/F4qGg0ykxir6+vUxsbG1Q4HKZOTk6Y9UAgQHm9XsY+PT2lbDYbtba2Rmk0Gsrn81GxWCxzfn5Oh0IhF2dxcfGRw+H4YG9vT6nT6ZTT09PKkZER5fb2tpKsHRwc1Gu12gaVStVEcLu7u3U4UDk+Ps7gyB6Cs1gsHxoMBiUHQ0h+enp6btM0XZw/yRrnchRjCojR0dFRfBPX2NiYwzFPvtlslvj9/hhOoWCncWIaN6MjkYi3tbVVVFtbSxzy7Ha7lOCAYXDApxA+wTnb29vJxW4RhzxwVXp0dGRFSH4APFar1XN4eBgA0NjS0vI6C+SCRwlwTowgMMeYftgn4NuIQwmu6Crk+fl5Oa6vAD/3FxYWHiYSCcXs7KwsL2SygTM6OsoHjg8OS7q7uyXEBjX8/JB5LpdLHAwGw3im9vf3kwglAeVeQlVXdXW1mD1ZwG4qunlI3tqlQ3BTitRwHB8fB2H7SehwGEIouyKR6H5lZWUFOCp9VYdC9s9rORVramqY2yBkhuSlpaUvhoaGPiO2Wq1+A2FK8O7ewMDAW7DLkFLiQg7zT7kWHjZz8RA1NDR8gij+gDA0IslCOApU0clk0tvc3Cy4Jsq/ORweHhbhIUMKvY/KsMGRDw6PQI0PzgPg2lBfX3/nmsOVlZUyEsrU1NTdvr6+SpIiZI28QzV9g1t+nk8D4VAulxcWhaiMXExCGBp5lUUuZi8uLmiEExcKhR/V1dWVkARnN3H0ev0dzKebm5tPONfHXyqDmwNMkrVuHOCCwn4U+06BtOEAw4cQHXNzc18Wcijk/Pe4qmWELz07OysfHBwUdnZ2SuLxeAVoKGdxt17JYVVVFVH59tjY2D20qRSc0OA4i7qmUqkUnclkvMAIb6pcaDCA/v7+ErFYfLetre098GoGNS4o7YTKTvDuA//6v6mMWq4ASI4byMhEN5Gvrq5WkHfg6vHExMSnxEYmMAXAdqDCKqNploGXJE5mEhatK0vCgigJgUDwiHQaqVQqYB0W3XSYW7vqh9goCoZCz/2BwI7N4TBa7fYX4WjUFI5ENrhc7gPUsaKrq6v8f9Xy895eKb28LN/6bujtH77tffcctvrZMxlby1/PzMw8ZnNQ4Xa7FWhx70Ckh7jMm6hvWb7KPFqvL8tsGS5eGn+j3T+tZG2qpWx2x0hTxq3g90+/EuH7QHgraWpq+ph8kDBopCopAArh0ul02ovPwJXKfNpiEcW1GkNUqzEfLqtMzh9VpphOs5f4Rad2XjZPpmNPTk5KoeqvUPV3KGwC3ybU8T7+/wyH/FzHErGei2gyQTBLcm4SEC8f9w+T4Lh/AhK1DBDx/1/XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"4way closed client\" title=\"\" src=\"/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png\" srcset=\"/static/dc94254134e7f891452d785d1de2120f/69538/4way-closed-client.png 160w,\n/static/dc94254134e7f891452d785d1de2120f/72799/4way-closed-client.png 320w,\n/static/dc94254134e7f891452d785d1de2120f/6af66/4way-closed-client.png 640w,\n/static/dc94254134e7f891452d785d1de2120f/d9199/4way-closed-client.png 960w,\n/static/dc94254134e7f891452d785d1de2120f/21b4d/4way-closed-client.png 1280w,\n/static/dc94254134e7f891452d785d1de2120f/5eb90/4way-closed-client.png 1612w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After 2MSL has elapsed in <code class=\"language-text\">TIME_WAIT</code>, the initiator also transitions to <code class=\"language-text\">CLOSED</code>. As mentioned, this time is fixed by kernel parameters ‚Äî about 30 seconds on my macOS machine.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>And that wraps up my second TCP topic: the handshake. I studied TCP in school, but I‚Äôd never examined each state in this much detail, so it was a fresh experience.</p>\n<p>Writing this post, I could see just how much work TCP does to ensure reliability even for the simple acts of creating and terminating connections. <em>(Which also made it clear why Google chose UDP for HTTP/3‚Ä¶)</em></p>\n<p>Originally I tried capturing the handshake between my blog‚Äôs local server and the browser, but they don‚Äôt just exchange a few simple messages ‚Äî they transfer massive amounts of data, making it difficult to track the specific parts I wanted.</p>\n<p>So I ended up doing some socket programming for the first time in a while. Using C after so long was a bit rough on the hands, but it was fun in its own way. C is the kind of thing that‚Äôs fun precisely because you only do it occasionally.</p>\n<p>If you‚Äôd like to try running the example application I used, you can clone it from my <a href=\"https://github.com/evan-moon/simple-tcp-example\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>. It‚Äôs a simple app that just exchanges messages, so it should be easy to peek at packets using <code class=\"language-text\">tcpdump</code>.</p>\n<p>This concludes my post: How TCP Creates and Terminates Connections ‚Äî The Handshake.</p>","fields":{"slug":"20191117-tcp-handshake-en","path":"/2019/11/17/tcp-handshake/en/","lang":"en"},"frontmatter":{"title":"How TCP Creates and Terminates Connections: The Handshake","subTitle":"How does TCP guarantee reliable connections?","date":"Nov 17, 2019","categories":["Programming","Network"],"tags":["TCP","SYN","ACK","FIN","TCP Handshake","3 Way Handshake","4 Way Handshake","TCP Flags","CLOSE_WAIT"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/d803c/thumbnail.png 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/fc5c5/thumbnail.webp 320w,\n/static/9b35e703a61bc05176f93cfe0d8e390c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png","srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/9b35e703a61bc05176f93cfe0d8e390c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"fb52a67f-beac-5f82-a8b4-3dde37245e63","tableOfContents":"<ul>\n<li>\n<p><a href=\"#tcp-transmission-control-protocol\">TCP, Transmission Control Protocol</a></p>\n</li>\n<li>\n<p><a href=\"#why-was-tcp-created\">Why Was TCP Created?</a></p>\n<ul>\n<li><a href=\"#a-network-that-survives-nuclear-war\">A Network That Survives Nuclear War</a></li>\n<li><a href=\"#problems-with-packet-switching\">Problems with Packet Switching</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lets-crack-open-tcps-header\">Let‚Äôs Crack Open TCP‚Äôs Header</a></p>\n<ul>\n<li><a href=\"#source-port--destination-port\">Source Port / Destination Port</a></li>\n<li><a href=\"#sequence-number\">Sequence Number</a></li>\n<li><a href=\"#acknowledgment-number\">Acknowledgment Number</a></li>\n<li><a href=\"#data-offset\">Data Offset</a></li>\n<li><a href=\"#reserved-3-bits\">Reserved (3 bits)</a></li>\n<li><a href=\"#flags-ns-through-fin\">Flags (NS through FIN)</a></li>\n<li><a href=\"#window-size\">Window Size</a></li>\n<li><a href=\"#checksum\">Checksum</a></li>\n<li><a href=\"#urgent-pointer\">Urgent Pointer</a></li>\n<li><a href=\"#options\">Options</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In my previous post, Why Did HTTP/3 Choose UDP?, I briefly touched on TCP, but that post focused on what problems TCP had that led HTTP to move away from it. This time, I want to focus more on TCP itself. I originally planned to cover all of TCP in a single post, but the sheer volume of material forced me to split it into several posts. (This grandpa protocol just never ends no matter how deep you dig‚Ä¶)","html":"<p>In my previous post, <a href=\"/2019/10/08/what-is-http3/\">Why Did HTTP/3 Choose UDP?</a>, I briefly touched on TCP, but that post focused on what problems TCP had that led HTTP to move away from it. This time, I want to focus more on TCP itself.</p>\n<p>I originally planned to cover all of TCP in a single post, but the sheer volume of material forced me to split it into several posts. (This grandpa protocol just never ends no matter how deep you dig‚Ä¶)</p>\n<!-- more -->\n<p>So in this post, I‚Äôll focus exclusively on the fields inside TCP‚Äôs header and what they mean.</p>\n<h2 id=\"tcp-transmission-control-protocol\" style=\"position:relative;\">TCP, Transmission Control Protocol<a href=\"#tcp-transmission-control-protocol\" aria-label=\"tcp transmission control protocol permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TCP (Transmission Control Protocol) is a protocol used at the transport layer of the OSI 7-layer model. Its purpose is to ensure that information is exchanged reliably, in order, and without errors between devices.</p>\n<p>In computer science, things closer to the machine are described as ‚Äúlower‚Äù or ‚Äúbehind,‚Äù while things closer to humans are ‚Äúhigher‚Äù or ‚Äúin front.‚Äù The OSI model works the same way ‚Äî lower layers are closer to the hardware, and higher layers are closer to people.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d3f96/osi.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD1UlEQVR42mPgNbHt5DW13c1tbLNJws51i5KrzxYFIFZy890i4+i5RdbJc4skUJzb2Hozj4nNDh5j20VyNjaC9QwMTFpaWmzGxsasQMzl5uYm5OHhwcfAZeRwkNvI8T+brs1XJbeg73ZxWd9Nw5K+W0Smftf2jfxuFp78XdUz5DuHvt1XLkOHP9yGDo+ULexV/KyseC0sLIRsgIa7uLjIOTo66gOxMoOSp+xUBXfZi4qessfVfFVOqvgon1T2Ujqp7Kl0UslD/qSSpwJQTOmkoofsCUV32XMKnjKbtEJFeRgggJEBHah7Cx5W9xH8r+Yl8M0t1ehHQJ7Nj+AChx+hRY4/3NNMfvjn2Pzwy7b6oebF/03dW+CvupfAI0UnbnGodiaooYxQNhODUYbUZKN0yfOG6ZJHDdIkjptmyR03zpQC0rIotEG65DGjdKkzQPUb9IrFuXG60LRU6rhFlcx/IP3XokL2f3S/y//4SZ7/o/qc/4d02/6PnuD637pSASxvXglW98I8TwziwnoUF0JA8CSr/tDJVidDJlnuD51kdTB8svXBECAdMsniYMRkm4NAuYPBQDZQ7kDoJMtjQHp1TLceuguZgDHM/v//f0aGnDUBJwo2hfzPWu3/t2Bd2P+O3YX/u/aW/G8H0o3bs/737q/4X7ox5n/mar+/+RuC/+esDngZXeOubqbiwecc4Czs7OwsDEwyssCYNrG3txdgqN6S3F+zNeUkEO8H4oONOzIPtu7OPdiyKxvIzgCz67alHwSqOwCUPwakV2etCuXB4mUIe+qxuuMzTzf9B9K/pxyp/du0ouBv0/KCvy2rCv92bCj927K68O+kA9V/px1v+D39ROP/KUfqXpT2Z6irCJnxBQQECHt7ewsC0586KC2CLZl3qqtv3qnuk/NOdu0Hsg/OO9FzcO5xEA3EQBrMBomf7DoAVHcMSK+es6GTF6Q3dFUoc319PRMot4SGhjKDDdx2beXRXbfX/N9+Y8XPTZeW/p67bfLvxQdm/F5ycObvZYdn/Z6/c8rvDecX/d5xc9XPHTdW/t9+fcWTnRcWiYH0giMBHey5vb5vz631x/bc3rBn1811+7ZdXLVv55W1+3ZeW7tvO5DeCuTvurFu3+5b6/cC1R0G0iv3X1nFg9PAe+9vHnvx69H/Bx9v/b377vr/E9cO/z998ygYn7936v/pW8f+33l7DSz/9Nv9/0D1z289OyeK08AbLy+13nh5eevN11fW3Hh1ed3p20fXHbmyf93x64fA+Mjl/euuP7+47sarS2tvvrq06ebrS3Ouvz7Ci8tAAAaq+RhRBRVjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"osi\" title=\"\" src=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/6af66/osi.png\" srcset=\"/static/eaf99e668d4cb90c964bcff2ad9bcb9e/69538/osi.png 160w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/72799/osi.png 320w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/6af66/osi.png 640w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d9199/osi.png 960w,\n/static/eaf99e668d4cb90c964bcff2ad9bcb9e/d3f96/osi.png 1093w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Protocols we‚Äôre familiar with ‚Äî like HTTP (Hypertext Transfer Protocol), SMTP (Simple Mail Transfer Protocol), and FTP (File Transfer Protocol) ‚Äî sit at the highest layer, the application layer. In contrast, lower-layer protocols like TCP, UDP, and IP are ones we encounter far less often.</p>\n<p>That‚Äôs because the OS handles most of these for us. Developers programming at higher layers don‚Äôt need to worry about every detail of what happens down below.</p>\n<p>This is one of the reasons the layered model exists in the first place. Networking is a convergence of countless technologies, and no single developer can know everything. Through strict separation of responsibilities between layers, the scope of what you need to worry about for any given task is narrowed down.</p>\n<p>Thanks to this, when using HTTP, we don‚Äôt need to simultaneously think about which DNS server to use or how to process packets.</p>\n<p>That said, even with these clear layer boundaries, if you have zero knowledge of what happens in the lower layers, you might encounter situations where everything looks fine at the application layer but a lower-layer issue leaves you completely helpless.</p>\n<p>For this reason, I think it‚Äôs worth knowing at least the general workings and overview of the protocols you use. So with this post, I want to crack open TCP ‚Äî a protocol I previously only knew through a handful of high-level characteristics.</p>\n<h2 id=\"why-was-tcp-created\" style=\"position:relative;\">Why Was TCP Created?<a href=\"#why-was-tcp-created\" aria-label=\"why was tcp created permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Personally, when studying any technology, I find it far more effective to understand <em>why</em> it was needed and empathize with that reasoning, rather than just memorizing facts.</p>\n<p>TCP is old enough that it‚Äôs hard to fully relate to the circumstances of its creation, but looking at why this protocol was developed reveals the struggles engineers faced back then.</p>\n<h3 id=\"a-network-that-survives-nuclear-war\" style=\"position:relative;\">A Network That Survives Nuclear War<a href=\"#a-network-that-survives-nuclear-war\" aria-label=\"a network that survives nuclear war permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As I just mentioned, TCP was developed as part of ARPANET, a project by the U.S. Department of Defense during the Cold War in the 1970s. One of the key topics of interest during ARPANET research was ‚Äúa network that survives even nuclear war.‚Äù (The opponent in said nuclear war being, of course, Mother Russia‚Ä¶)</p>\n<p>The reason was that 1970s networks used circuit switching. If a relay station took a direct hit and was destroyed, or if a single connecting line was cut, communication would be severed entirely.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/872ac67a7c6196542ca4a5ece19b54b5/b17f8/old-telephone.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFTc92ECoH/xAAaEAEBAQADAQAAAAAAAAAAAAACAQMAERIh/9oACAEBAAEFAjCplj1xGlevmegp0Qt//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgEEAwAAAAAAAAAAAAAAAAERAgMhMRAiQf/aAAgBAQAGPwLWRq5T5uCGo4SqeTspP//EABoQAQADAAMAAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hblDo9XAam4UPrzxnOewigEzdgO1hzP/aAAwDAQACAAMAAAAQHz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhQWFRcf/aAAgBAQABPxB40ewW5Foq+MIw3qjFsL/SKiPfDifSCePKeSoMJR403SJNZQNZbU//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"old telephone\" title=\"\" src=\"/static/872ac67a7c6196542ca4a5ece19b54b5/c08c5/old-telephone.jpg\" srcset=\"/static/872ac67a7c6196542ca4a5ece19b54b5/0913d/old-telephone.jpg 160w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/cb69c/old-telephone.jpg 320w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/c08c5/old-telephone.jpg 640w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/6a068/old-telephone.jpg 960w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/eea4a/old-telephone.jpg 1280w,\n/static/872ac67a7c6196542ca4a5ece19b54b5/b17f8/old-telephone.jpg 1600w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>I wasn't there personally, but I imagine it looked something like this...?</small>\n</center>\n<p>What relay stations did back then was essentially this: when A asked the station to ‚Äúconnect me to B,‚Äù the operator would find the jacks labeled A and B on a patch panel full of cables (like the photo above) and physically connect them with a cable.</p>\n<p>Literally switching circuits. If A then wanted to talk to C instead, you‚Äôd unplug the cable from B‚Äôs jack and plug it into C‚Äôs.</p>\n<p>With circuit switching, you physically hold one dedicated line for communicating with your counterpart, which means circuit utilization is inherently low. It‚Äôs the same principle as getting a ‚Äúthe person you‚Äôre calling is currently on another call‚Äù message when you try to phone someone.</p>\n<p>Of course, monopolizing a circuit has advantages ‚Äî like being able to stream large amounts of data at high speed. But what mattered to the U.S. at the time was a connection that wouldn‚Äôt break even if a nuke went off, so depending entirely on a single circuit was a major drawback.</p>\n<p>This led to the idea of packet switching. Instead of sending data through a single circuit ‚Äî where a destroyed line or relay station means losing the data forever ‚Äî the idea was to split data into small pieces and send them through multiple circuits. A kind of diversified investment, if you will.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/200a4648f12fe0e8e32c2a9308df4465/0d98f/packets.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 29.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42mPw9vZWsnXXkGQAgv//GRhDQ0OZgSymX6fTrX/dyMkCiX861yr653Jm9f/96QpgdQ9SUtf196fGuB5UhOirZ2KAgSS/hUnxnkum/d/PwALit6SvMqtMWp8LYu/ff5/jye7Jwk/WVQjv3/+f5cm6NuHGjDXB9fVX2KrTNztMLlhmAjPn/yZJrv/zGTgYurLqJdZOXvXi+an2m/8veOv8X5opWBK/1mN1zzSf/w8ynJ7v7Ob+/38R9+/rBb7HdqwSas7YGP90b2nk//+hQsWBi8Q6s5bH/t8bpv//Qced/w8adkFMf1Sx5v/9xhufdkRq/H9kwVmRsMkUbODXBNPijKM6U8vmBf2/n+Vx+PAWQZD671eLnP8/zJaqj1kkVpu13f/D4USl/w/brv170LQNYuAVLbZ/2xjYwexVhZz/z6Rx/f//nxEYpkyza1dYV2ducAHJXdh5gfvIkeu8Z86cYb1y5QobiAapA8n926bC/v8MAys8LP8zMIAMYITxf57MMvh/PSsdKMP48uUUnl/X8/IfXZktBJL7cyMn+d/NMk0Qu76+nglZHwDNUtCZl2fElwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"packets\" title=\"\" src=\"/static/200a4648f12fe0e8e32c2a9308df4465/6af66/packets.png\" srcset=\"/static/200a4648f12fe0e8e32c2a9308df4465/69538/packets.png 160w,\n/static/200a4648f12fe0e8e32c2a9308df4465/72799/packets.png 320w,\n/static/200a4648f12fe0e8e32c2a9308df4465/6af66/packets.png 640w,\n/static/200a4648f12fe0e8e32c2a9308df4465/d9199/packets.png 960w,\n/static/200a4648f12fe0e8e32c2a9308df4465/0d98f/packets.png 1276w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>This way, even if one node is destroyed, not all data is lost</small>\n</center>\n<p>In the worst case, a destroyed circuit or relay station might cause some data loss, but as long as the entire network isn‚Äôt hit at once, the chance of losing all data is low. And since you‚Äôre not holding a dedicated circuit open ‚Äî you just mark a destination on each packet and send it off ‚Äî circuit utilization improves as well.</p>\n<p>For these reasons, the Department of Defense adopted this idea for ARPANET. Early tests were a massive success, proving the practicality of packet switching.</p>\n<p>ARPANET, initially used only by a handful of universities and military installations, was eventually opened to the public and grew into what we now know as the internet. Along the way, TCP ‚Äî ARPANET‚Äôs communication protocol ‚Äî rose to prominence with it.</p>\n<h3 id=\"problems-with-packet-switching\" style=\"position:relative;\">Problems with Packet Switching<a href=\"#problems-with-packet-switching\" aria-label=\"problems with packet switching permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>But packet switching wasn‚Äôt a silver bullet either; it had several problems. The concepts that always come along when studying TCP ‚Äî ARQ, SYN, ACK, and so on ‚Äî are the result of past engineers racking their brains to solve these very problems.</p>\n<blockquote>\n<p>Q: What if a packet silently disappears or gets corrupted mid-transmission?<br />\nA: <strong>Then ask for just that packet to be resent! (ARQ)</strong></p>\n<p>Q: The receiver needs to know the order the sender split the packets in to reassemble them, right?<br />\nA: <strong>Then send a sequence number along with each packet! (Sequence Number)</strong></p>\n<p>Q: What if the sender sends packets faster than the receiver can process them?<br />\nA: <strong>Then have the receiver tell the sender how much it can handle and only send that much! (Sliding Window)</strong></p>\n</blockquote>\n<p>The many features and concepts TCP has might look complex and memorization-heavy on paper, but when you consider the situation at the time, you can see they were all absolutely necessary.</p>\n<p>And since these features work by reading information in the header of the segments the other party sends, before examining each feature individually, I want to look at what information TCP‚Äôs header contains and what it all means.</p>\n<h2 id=\"lets-crack-open-tcps-header\" style=\"position:relative;\">Let‚Äôs Crack Open TCP‚Äôs Header<a href=\"#lets-crack-open-tcps-header\" aria-label=\"lets crack open tcps header permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Protocols like HTTP, TCP, and IP each have their own roles, and they attach their own headers to the data being sent to represent information about that data.</p>\n<p>Since TCP is responsible for transmission reliability, flow control, congestion control, and similar concerns, the TCP header contains various values needed to support these functions.</p>\n<p>In other words, looking at the header gives you a quick overview of TCP‚Äôs features ‚Äî which is why I chose header dissection as the first step in this TCP series.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42j2P147CMBRE8/9/x4IQkEKq4zi9YofA7NjS7sOR43jKvV6YSMh2xbJs6PoR47Rg5vc0rxjGGbKq8fADVKpx/5q2d5o/rKbtBvTDhO2l4V0fCcK0gpAKWSGRCYkozvBMcqR5ibQoIVWLsmrce5wWjuvNx+0RIMkEYmr9KEHbD/ByoVz7/j6gzU4M20ZOucLsb9cqK4W8ENTVWLeXo6N5GCfnsTpNzL7DS3PJ9hrLurmQhUyzXWfGwDWSNEMYPSFK6mQFVTeuxIZuRGuDF9mIYbib0K7UsLHuejwZkNEsaVRtB9W06DiJOQ4c3y/eZKXZvlv9y05ntyOGeGFcoMwKHFxTM0A3HaoogopjTJxoYvggSow8F65uTxGEKMOIuif6vIC2wSw23MwTNSdIUnx9H0cQ4BOG2Pk9ns+O6XJx9KfT/338OaPjXd/v+LLcej7WrxR+AYjFDnQh+N9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp header\" title=\"\" src=\"/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png\" srcset=\"/static/ac69210c44cd473bcb737665d590b124/69538/tcp-header.png 160w,\n/static/ac69210c44cd473bcb737665d590b124/72799/tcp-header.png 320w,\n/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png 640w,\n/static/ac69210c44cd473bcb737665d590b124/d9199/tcp-header.png 960w,\n/static/ac69210c44cd473bcb737665d590b124/21b4d/tcp-header.png 1280w,\n/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>TCP uses a 20-byte (160-bit) header divided into multiple fields. Each field‚Äôs bits are set to 0 or 1 to represent information about the segment being transmitted.</p>\n<p>However, 20 bytes is the size of a basic header with no options. When using TCP‚Äôs various options, additional option fields are appended to the end of the header, which can add up to 40 more bytes for a maximum of 60 bytes.</p>\n<p>Let‚Äôs go through each field in the order shown in the diagram.</p>\n<h3 id=\"source-port--destination-port\" style=\"position:relative;\">Source Port / Destination Port<a href=\"#source-port--destination-port\" aria-label=\"source port  destination port permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/c7bb6/header-source-destination.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABgUlEQVR42j2Q2ZKiQBBF+f+PmiUmpqft1VZ7WlRAFNl3QYpFziQ8zMOJqsy6N5fSDNvHzxuuqiO53shvilL1FE1HViu8JEO3bPy0kFxLXFTkkp90+a0VTUNS1qRVQ931aJ+Gg7XcELwucN9e8AT78YHT4oHLyxOuEK+WhMt33Ndnzk+PM7sf39j9/I7zvJD4D9bvX+T6F5oTJETbL+5Hg/5k0dkm5faT+qAznC3a44Fo9SbNpPD6ncbco6w9xXbDdfdXPObs68XXOzbayfHw4pRKxp3WnihltUJWyqobtutjnBzcKBZdQpjl3PphXq/uBpphFO4zStAcN8QPY+I0I0pSLPuE43qSiwglDqVImhe0UmQYR/r7SK3U/D7pm7ZDSfGJdvpD43jBO18YxKREoGTawDQJj0dKP6D0fHJpUMhZBeF8ugcDzzBFZ5E5F5QM00jj9lqhuZFMIFON+z3D4cDdMOjkXqzXM+VmM5N9fPyPi9WaVGKl64zSfPLcJ38Y8g/pAAhNJ6xOXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header source destination\" title=\"\" src=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/6af66/header-source-destination.png\" srcset=\"/static/ebf97ac44242ba7ca213c1611c94dc7c/69538/header-source-destination.png 160w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/72799/header-source-destination.png 320w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/6af66/header-source-destination.png 640w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/d9199/header-source-destination.png 960w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/21b4d/header-source-destination.png 1280w,\n/static/ebf97ac44242ba7ca213c1611c94dc7c/c7bb6/header-source-destination.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>These fields indicate the source and destination of the segment, with 16 bits allocated to each. To identify the source and destination addresses, you need both an IP address and a port number.</p>\n<p>Since the IP address naturally belongs in the IP header one layer below (the network layer), the TCP header doesn‚Äôt have an IP address field ‚Äî only port fields.</p>\n<h3 id=\"sequence-number\" style=\"position:relative;\">Sequence Number<a href=\"#sequence-number\" aria-label=\"sequence number permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/98943a4651928dcb5ab4fb58fc381649/c7bb6/header-sequence.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42j2R23abMBBF+f+v6kPzkrQrJXaIbe5gg7gJEGDjGHt3TNfqw16aOZozGkmWHytUMzFOF3Rn6IeJQWIznunMiCprDl5AUTWrVute9Gmte9KZgaY1tP3AeZ6xHDfBjxRZmpHGR47JicALCf2QJEpES1F5QXbK1zgKIiHG2TrsnB1xmKyau/doGo11LDW1/ZvHl83iOiz7LcOfN87bd+7uJ9+7D+rXn+QvP2jeXpgdm6tg3l8Z7V9r/f3w+W91v7DiU4FKj0x1xVjXK0NVYcqCTimSw4HA+SQPAlQUUqUJl1Zz1g0XrZm7TmiZRbuaXibMSlQlU8r7VW1PKM1TJYfUDaXuKOUaujdclzsLcHvAdL2t+1XbcbktzMtj5Vlj+dGJPD2xdD2zmGcpLPyAMoww0tjkiu6U0Wc5o+R9npN5PrlQBCGtDPD0XapaJhywMvk9HSc8XJfF87j7Pt8S95vNitluV1rb/p/3Hxu05PN+z0Oe4um5P/1lyV++PwgKyWhZIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header sequence\" title=\"\" src=\"/static/98943a4651928dcb5ab4fb58fc381649/6af66/header-sequence.png\" srcset=\"/static/98943a4651928dcb5ab4fb58fc381649/69538/header-sequence.png 160w,\n/static/98943a4651928dcb5ab4fb58fc381649/72799/header-sequence.png 320w,\n/static/98943a4651928dcb5ab4fb58fc381649/6af66/header-sequence.png 640w,\n/static/98943a4651928dcb5ab4fb58fc381649/d9199/header-sequence.png 960w,\n/static/98943a4651928dcb5ab4fb58fc381649/21b4d/header-sequence.png 1280w,\n/static/98943a4651928dcb5ab4fb58fc381649/c7bb6/header-sequence.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The sequence number indicates the order of the data being transmitted and is allocated 32 bits. It can represent values up to 4,294,967,296, so sequence numbers don‚Äôt duplicate easily.</p>\n<p>Thanks to this sequence number, the receiver can determine the order of split segments and reassemble the data correctly.</p>\n<p>When the sender transmits data for the first time, it initializes this number to a random value. After that, it increments the sequence number by 1 for each byte of data it sends. When the maximum value of 4,294,967,296 is exceeded, it wraps around back to 0.</p>\n<h3 id=\"acknowledgment-number\" style=\"position:relative;\">Acknowledgment Number<a href=\"#acknowledgment-number\" aria-label=\"acknowledgment number permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/39c82afd470e6193a6a529065650699b/c7bb6/header-ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR42j2QWZOTQBSF+f8/ywetUkudJBMTwhqgabrDTtiSmc87WPpw6q7nLsfxY40uB4b+TlW1tG1PL37XDTRNh9YG1/UoCrvlyrLeev6haVrKqqGuW8Zxwjm6MX5qUaYkyS2JtgRXRZgorqrgmhv0rUbZSuqGKM0FmqPrc/JC4qwgSnK8KKGUA5xU3zBhyLNQrEXOohVN6NMnMQ+jmfMMcz6Sve6w7okxS5hUsvV0cSicv7xVeOvN4MRylTnsmM4H7v6Z0Ttxv/xmcI90p1fSr5+Jvnyi+PEN8+s75f4nS3hh8l3m4MIa+SyRt+UeAidV8pLoc7MWawxhEJAmCTrPsYXB6IK6rFiXhefjwXNdGYf7Vr9J/zSOLNPEIvajx/GjjFz0eorAs4g7VzU6jCjiK50samVok2taGdwbu1nlB+RBSBHF1JlirhsmWbr0A46yJZWQ3y8Xnp7Hm++zit/u9xu6w2FD/fLyP253eyqJ5/OZd/nog/P2wTeGP93kCAjG+USDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header ack\" title=\"\" src=\"/static/39c82afd470e6193a6a529065650699b/6af66/header-ack.png\" srcset=\"/static/39c82afd470e6193a6a529065650699b/69538/header-ack.png 160w,\n/static/39c82afd470e6193a6a529065650699b/72799/header-ack.png 320w,\n/static/39c82afd470e6193a6a529065650699b/6af66/header-ack.png 640w,\n/static/39c82afd470e6193a6a529065650699b/d9199/header-ack.png 960w,\n/static/39c82afd470e6193a6a529065650699b/21b4d/header-ack.png 1280w,\n/static/39c82afd470e6193a6a529065650699b/c7bb6/header-ack.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The acknowledgment number represents the next sequence number that the receiver expects, and is allocated 32 bits.</p>\n<p>During the handshake process for connection setup and teardown, each side creates its acknowledgment number as <code class=\"language-text\">the other party's sequence number + 1</code>. But during actual data exchange, the acknowledgment number is calculated as <code class=\"language-text\">the other party's sequence number + the number of bytes received</code>.</p>\n<p>For example, imagine sending 1 MB of data. Since you can‚Äôt send such a large amount in one go, the sender must split it into multiple segments and transmit them incrementally. The amount of data the sender can transmit at once varies depending on the network and receiver‚Äôs state, but let‚Äôs assume it‚Äôs 100 bytes.</p>\n<p>The sender transmits 100 bytes in the first transmission and initializes the sequence number to 0. Since the sequence number increments by 1 per byte, the first byte chunk gets 0, the second gets 1, the third gets 2, and so on.</p>\n<p>So in this transmission, the receiver received 100 byte chunks numbered 0 through 99, and the sequence number it should expect in the next transmission is not 2, but 100.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4c5dc85683ae837d23500d773f219316/05244/ack.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVR42mOor69nCg0NFY2JiRED4fisLAkYziguFvPw8FCW1NS0XWZoaDLPxUXVo7JSNC0tTTI+PksCpgeEfX19xUFmMSRlZ0tFJyZqgTi5Hh7s/xkYGBmIACD19fb2HCAcumoVc3h8vEJMcTE3Q9Gi1deKF62+Wbps/bz9//+zHL/5s2H/5V9L913+Me/A1d/z913+Nf/ojR8LTt/+MR+E91/+MffglR8rT936mQQy+P///4ylSzcsKFq0BmjO2isM7Vv2/m/fduB/zYpN926n1Ghfv//u8Z27l/5fv3723+3bl/7fuH7y/7WH7/9ffvr//xUgvnr9wp+Hz57+v/Lk/xagbzTf8/M71W/ac69j6/7/bUCzGLq27vvfs/PQ/5pl6x7cCcgzvv/4/pOfL1b8//x46b8vj5f9//547v97j+//P3n33/9zD///f/9k058fH479v3jv/3aggUZfeHk9Gzbuut+74+D/7m37/zMULlpzs2jxmtslS9YuA3n57K3PrZfvvVp98c7LJUB66dV7L5eevftp6YmbP5aeuP1j6cU7bxZfvPt2/Ymbv9JgXi5ZvG5F0aK1t0AYAHD8D+xKjCj6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ack\" title=\"\" src=\"/static/4c5dc85683ae837d23500d773f219316/6af66/ack.png\" srcset=\"/static/4c5dc85683ae837d23500d773f219316/69538/ack.png 160w,\n/static/4c5dc85683ae837d23500d773f219316/72799/ack.png 320w,\n/static/4c5dc85683ae837d23500d773f219316/6af66/ack.png 640w,\n/static/4c5dc85683ae837d23500d773f219316/d9199/ack.png 960w,\n/static/4c5dc85683ae837d23500d773f219316/21b4d/ack.png 1280w,\n/static/4c5dc85683ae837d23500d773f219316/05244/ack.png 1752w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>100 bytes are bundled into a single segment for transmission</small>\n</center>\n<p>If you capture packets using <code class=\"language-text\">tcpdump</code>, you can actually see the receiver‚Äôs acknowledgment number increasing by the length of data the sender transmitted.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">localhost.http-alt <span class=\"token operator\">></span> localhost.49680: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">160</span>:240, ack <span class=\"token number\">161</span>, win <span class=\"token number\">6374</span>, length <span class=\"token number\">80</span>\nlocalhost.49680 <span class=\"token operator\">></span> localhost.http-alt: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">240</span>, win <span class=\"token number\">6374</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Looking at the sender‚Äôs segment, the sequence number shows <code class=\"language-text\">seq 160:240</code>, and the receiver uses the value after the colon as its acknowledgment number.</p>\n<p>Here, the sequence number format represents a range of <code class=\"language-text\">n inclusive : m exclusive</code>. Since the number after the colon is not included in the sender‚Äôs sequence range, the receiver can use it directly.</p>\n<p>In other words, the acknowledgment number indicates the starting point of the data that should be sent next.</p>\n<h3 id=\"data-offset\" style=\"position:relative;\">Data Offset<a href=\"#data-offset\" aria-label=\"data offset permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e1e371de646e3735c414e9a897af2db6/c7bb6/header-data-offset.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42j1Q6ZKiMBjk/Z9uRmenVATDnQQIEM4g0ttQtfujK1dfX7wgkpD1iGGYYJoOnR3Qc2/7EW3XQ6oSD/8Jpavzrqqbk/MPB6c2LZrWYpoXeL9+hCBWyKVCkhVIM4VQJHhFKeK0QMw7qWsUquK7hIizE783H7fHE1GSQ5DrhxHqpoWX5RqyMnA7sLw3LM4xrWPLEW59n6lSaQblbFlinOYThuK2s+SvJ28h3LrCi/IS6n7DLAKMscDQD7A062yPlmNEcYIgfCEvJApOocvqDDlMJ2JZHGZiIhzNvVQZlJcv1CJE/eeCVxAioVBSqGsDXdUwbOK2Ddu+402MFB/vpWkwH+2OyQhHeEHMP7rfsT8fcJHAQhMVhtBCwNLYslmbF+i4Dhz9WPNngILBis2bNMNyGDPYcTov54ebJMXnJbCRsAcBVt9Hd72esD8/J5rv7//n7nKF4Xk5ijD8Q82Hmk1r/AVxsA1M+2D96gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header data offset\" title=\"\" src=\"/static/e1e371de646e3735c414e9a897af2db6/6af66/header-data-offset.png\" srcset=\"/static/e1e371de646e3735c414e9a897af2db6/69538/header-data-offset.png 160w,\n/static/e1e371de646e3735c414e9a897af2db6/72799/header-data-offset.png 320w,\n/static/e1e371de646e3735c414e9a897af2db6/6af66/header-data-offset.png 640w,\n/static/e1e371de646e3735c414e9a897af2db6/d9199/header-data-offset.png 960w,\n/static/e1e371de646e3735c414e9a897af2db6/21b4d/header-data-offset.png 1280w,\n/static/e1e371de646e3735c414e9a897af2db6/c7bb6/header-data-offset.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The data offset field indicates where the actual data (as opposed to the header) begins within the segment.</p>\n<p>This offset is expressed in 32-bit word units, where <code class=\"language-text\">1 word = 4 bytes</code> in a 32-bit system. Multiplying this field‚Äôs value by 4 gives you the starting position of the actual data after the header.</p>\n<p>The 4 bits allocated to this field can represent values from 0000 to 1111, meaning 0 to 15 words, which translates to 0 to 60 bytes. However, since all fields except options are mandatory, the minimum value is fixed at 20 bytes (5 words).</p>\n<p>This field is needed because the Options field, described below, has a variable length.</p>\n<h3 id=\"reserved-3-bits\" style=\"position:relative;\">Reserved (3 bits)<a href=\"#reserved-3-bits\" aria-label=\"reserved 3 bits permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0349ac9a4c277a5a0090feab26782143/c7bb6/header-reserved.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABZ0lEQVR42j2RyZKjMBBE+f8v65hbtx0OYwy2WCWxil0YOztRzMzhhSjIqkwVXigkZD1hHGc0rYHpRwx87ocJnRkgVYlbcIfSlXtX1a3T/OPQ1E2HtusxLyu8y00gjBVyqZFkBVISPRI8RIo4LRCzlrpGoSp+l3jGmeNyDXC93SGSHE9qg0igbjt4aa6d+/basZJlf6Ol6zCMsNvLuUqlaZRTV2KaF0fD5s70WO3mdCux2wYvTiUKWWJcLKZUYA59jErCjLxyZyDiBGH0QF4cOgVdVs7kGDqTdbVYyEwsh7uEkgnLnru4nCH+fCE7/0ByL7pqSI2GSey+Y/988CITmyUHl02L5Uj393aWeOEzQ5Fk2DnQJjGsf4Hyr9BCoGeinsm6vIDhOfLqx5nfQxRhBMXkbZphPQbT2HJNXl4ygYjxCQLsUYT3U2DjXzWnk6M/nx3t9/f/2vyc0LBefR+foycM8T76tcYvjnYNZW+98D0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header reserved\" title=\"\" src=\"/static/0349ac9a4c277a5a0090feab26782143/6af66/header-reserved.png\" srcset=\"/static/0349ac9a4c277a5a0090feab26782143/69538/header-reserved.png 160w,\n/static/0349ac9a4c277a5a0090feab26782143/72799/header-reserved.png 320w,\n/static/0349ac9a4c277a5a0090feab26782143/6af66/header-reserved.png 640w,\n/static/0349ac9a4c277a5a0090feab26782143/d9199/header-reserved.png 960w,\n/static/0349ac9a4c277a5a0090feab26782143/21b4d/header-reserved.png 1280w,\n/static/0349ac9a4c277a5a0090feab26782143/c7bb6/header-reserved.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>A field reserved for future use ‚Äî all bits must be set to 0. You can see it marked as <code class=\"language-text\">0 0 0</code> in the header diagram above.</p>\n<h3 id=\"flags-ns-through-fin\" style=\"position:relative;\">Flags (NS through FIN)<a href=\"#flags-ns-through-fin\" aria-label=\"flags ns through fin permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/c7bb6/header-flags.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVR42jWQ527jMBAG9f4PdocEAQLHjousYhVLlKjerGJ7biXgfgxIkPsNd2nYnkLlPV03UJQ1ddPRyr5pe6q6RSUa82qRpNl2luXlVvOftSYvKsqqYXiMGEfTw/YTIpUS3NWG4/q4XoAfRgRhLNKMWOnt7uaF3Pw7x/OVs2nhBdF2dnU88rLCCKN0e31enozTzDjPFGuX/YPp+WaYFlRWEMaKNNX0w2OjkHBVN1tmmhfJLbLOGH6oiGWsrh9EMtBVNb11pvVcatci+Pnm9vGH2LwQi3CVrqOt0kEYx4mHMAiTyLcOVZqTlSVaZK5pEn/+JQl8Ms9DBwGliJc4ZAGW15tewkpn6KLksXa3TidMgmHf7sTBnafIRvnwUWv01wfZ9xfd6Zf2dKA57Gi8G618TS2jR5ZNbDskjksZ3hlXcZYztR1GpHMKz+dtXXlaFi/HYZbi6ve40RxP1EK531MLzeFA/bOn2O0YLxfeUv+ybV5Xyacp/wCQHgwqbb+AcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header flags\" title=\"\" src=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/6af66/header-flags.png\" srcset=\"/static/3697f03f06af5fe2bce48b43a1d9ee56/69538/header-flags.png 160w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/72799/header-flags.png 320w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/6af66/header-flags.png 640w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/d9199/header-flags.png 960w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/21b4d/header-flags.png 1280w,\n/static/3697f03f06af5fe2bce48b43a1d9ee56/c7bb6/header-flags.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Nine bit flags that indicate the properties of the current segment. Originally there were only 6 flags, but <code class=\"language-text\">NS</code>, <code class=\"language-text\">CWR</code>, and <code class=\"language-text\">ECE</code> were added using bits from the <code class=\"language-text\">Reserved</code> field to improve congestion control.</p>\n<p>Here are the original flags and their meanings:</p>\n<table>\n<thead>\n<tr>\n<th>Field</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>URG</td>\n<td>Indicates that the Urgent Pointer field contains a valid value. Data pointed to by this pointer is given high priority and processed first. Rarely used today.</td>\n</tr>\n<tr>\n<td>ACK</td>\n<td>Indicates that the Acknowledgment Number field contains a valid value. If this flag is 0, the acknowledgment number field is ignored entirely.</td>\n</tr>\n<tr>\n<td>PSH</td>\n<td>Push flag. Requests that the receiver deliver this data to the application as quickly as possible. If this flag is 0, the receiver waits until its buffer is full. When this flag is 1, it also implies there are no more segments connected after this one.</td>\n</tr>\n<tr>\n<td>RST</td>\n<td>Reset flag. A request to forcefully reset the connection with a counterpart that is already in <code class=\"language-text\">ESTABLISHED</code> state.</td>\n</tr>\n<tr>\n<td>SYN</td>\n<td>Synchronize flag. Indicates this segment is for synchronizing sequence numbers when establishing a connection with the other party.</td>\n</tr>\n<tr>\n<td>FIN</td>\n<td>Finish flag. Indicates this segment is a request to terminate the connection with the other party.</td>\n</tr>\n</tbody>\n</table>\n<p>The newly added <code class=\"language-text\">NS</code>, <code class=\"language-text\">CWR</code>, and <code class=\"language-text\">ECE</code> flags (carved out of the former Reserved field) are used for Explicit Congestion Notification (ECN).</p>\n<p>Before ECN, the conventional method for detecting network congestion relied on timeouts. But for latency-sensitive applications, even that waiting time was too costly, so a special mechanism was needed to explicitly notify senders and receivers of congestion ‚Äî and that‚Äôs ECN.</p>\n<p>The <code class=\"language-text\">CWR</code>, <code class=\"language-text\">ECE</code>, <code class=\"language-text\">ECT</code>, and <code class=\"language-text\">CE</code> flags are used to inform the other party about congestion. Of these, <code class=\"language-text\">CWR</code> and <code class=\"language-text\">ECE</code> reside in the TCP header, while <code class=\"language-text\">ECT</code> and <code class=\"language-text\">CE</code> are in the IP header.</p>\n<table>\n<thead>\n<tr>\n<th>Field</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NS</td>\n<td>A field added in RFC 3540 to guard against the CWR and ECE fields being accidentally or maliciously concealed.</td>\n</tr>\n<tr>\n<td>ECE</td>\n<td>ECN Echo flag. When this field is 1 and the SYN flag is also 1, it signals to the other party that ECN is supported. If the SYN flag is 0, it‚Äôs a request to reduce the segment window size because the network is congested.</td>\n</tr>\n<tr>\n<td>CWR</td>\n<td>Indicates that an ECE flag has already been received and the sender has reduced its segment window size.</td>\n</tr>\n</tbody>\n</table>\n<p>ECN is a separate topic from this post, so if you‚Äôre curious, I recommend looking into the details through other resources.</p>\n<h3 id=\"window-size\" style=\"position:relative;\">Window Size<a href=\"#window-size\" aria-label=\"window size permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/c7bb6/header-window-size.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVR42k2Q646bQAxGef8na7VttVUS2CWBAMNlhvs1AUL21KGq1B9H47Hsz/5seaFGVxPjeKNuOrp+ZJC4HybabkCbAvd8weTlniurZq/5x6umqluatud2n7FsN8SLDKnOUYlGpRo/UFzDmCjOiJIMnVekWYGSfyD5IIqxHZePzwuhSiSnOHvBLmzFab5PXx8b87IKi0zrZMuJZX3sU3UuYjLQVDXjvDJJXd0PtFJz354s/2FFsSYTW+N020VGoR9edqRBbIQqxj+f0b9/YZwT5afDnCjucSRvxJLFLKkguTVVfzd8WSqblqJuuEYKlcldi5JcNspf9zGGLfLZbje2vuNelZjAp1Qi2tQsbcPctTwCD8sLEjK5wyY2ZxGYyxrj++RBQK/NThsnDB8nJmGwD+i3b5gf3yl+vtEd3lk9l9V1WLMEKy0q6jDiS2xtlwtPz2OVuDscdvrjcac5nuhsm95x6E429eHIfPH4CkKe10D6xEFZ8gfP2wrLCGEJRgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header window size\" title=\"\" src=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/6af66/header-window-size.png\" srcset=\"/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/69538/header-window-size.png 160w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/72799/header-window-size.png 320w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/6af66/header-window-size.png 640w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/d9199/header-window-size.png 960w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/21b4d/header-window-size.png 1280w,\n/static/e52f571cc6bb5aef8d85fb2f7f95d1e9/c7bb6/header-window-size.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The window size field contains a value representing the amount of data that can be transmitted at once. It can express values up to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>=</mo><mn>65535</mn></mrow><annotation encoding=\"application/x-tex\">2^{16} = 65535</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">16</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">65535</span></span></span></span></span>, and since the unit is bytes, the maximum window size is <code class=\"language-text\">64KB</code>.</p>\n<p>However, this maximum was set long ago and doesn‚Äôt always fit today‚Äôs high-capacity, high-speed communication environments. So a method of left-shifting the bits to increase the maximum window size is also used, with the number of shifts specified using the <code class=\"language-text\">WSCALE</code> field in the options.</p>\n<h3 id=\"checksum\" style=\"position:relative;\">Checksum<a href=\"#checksum\" aria-label=\"checksum permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/c7bb6/header-checksum.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVR42jWP2WrbQBhG9f7PU0qhpSm0pstVHJvUsSzZ2kf7LmtxdPproBcHZqRvG8NyFCrv6bqBoqypm45Wzk3bU9UtKk45mxfiJNPfsrzUmv9smryoKKuG4T5ivJ4dLDcmVAleoPBChX3zuDo+rh/hBhEqyYniTP+/uYHm9WRyOl9wvJCbaE3bIS8rDD9MdPu8PBinWZikrZaVPdO86FYVJ/hBKLqUfrhrCjFXdaM9m24UpnnGcH2l2zsRtf2gaSSsbjttcDwf6+oQRqJTMUma6ZItdBDGceIuDMIk4bIwRUUxWZqSClf7ii8hSgJSWZTIujIvmKX9scKyrvRiVhKcFiX3bd32OmESjIsvrb9+wM9vLH92LL+/k3/+QP7lI8PuK/3uie7pE+3fI21WUIcR4cUismxiKS/9gHELznImeZURpjnF9cb69sa7eWY1TebTifr5WdO+7GmEcr+nPhxojkfqlwOF3EfxrLbNu2WJ1+SRJPwD5hELaAgKsR8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header checksum\" title=\"\" src=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/6af66/header-checksum.png\" srcset=\"/static/6bfb87b2db56498f2d05a0b7d8ae7525/69538/header-checksum.png 160w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/72799/header-checksum.png 320w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/6af66/header-checksum.png 640w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/d9199/header-checksum.png 960w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/21b4d/header-checksum.png 1280w,\n/static/6bfb87b2db56498f2d05a0b7d8ae7525/c7bb6/header-checksum.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The checksum is a value used to detect errors that may occur during data transmission.</p>\n<p>TCP‚Äôs checksum is generated by dividing the data to be transmitted into 16-bit chunks and adding them sequentially. The method is simple, but since looking at 16-bit additions would make the numbers painfully long, let me demonstrate with a simpler 8-bit example.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  11010101\n+ 10110100\n-----------\n 110001001</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Oops ‚Äî adding two 8-bit numbers produced a 9-bit result with an extra digit. This overflow can‚Äôt fit in the checksum field.</p>\n<p>This extra digit that appears when adding two numbers is called a carry. Just take that carry bit, detach it from the result, and add it back:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  10001001\n+        1 (the overflowed bit)\n-----------\n  10001010</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This technique is called wrap-around. Now take the one‚Äôs complement of the final result, and you have the checksum. ‚ÄúOne‚Äôs complement‚Äù might sound fancy, but it just means flipping all the bits.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">10001010\n01110101 (after taking one's complement)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Now <code class=\"language-text\">01110101</code> is the checksum for this data. In this example I used 8 bits, so an 8-bit checksum came out. In practice, the data is split into 16-bit chunks for this process, producing a value that fits perfectly into the 16-bit checksum field.</p>\n<p>The receiver, upon receiving the data, goes through the same process but stops before taking the one‚Äôs complement ‚Äî at the value <code class=\"language-text\">10001010</code>. It then adds this value to the checksum sent by the sender. If all bits are 1, the data is considered valid.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  10001010\n+ 01110101\n-----------\n  11111111</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If even a single bit is 0, it indicates that something was altered in the data the sender transmitted.</p>\n<h3 id=\"urgent-pointer\" style=\"position:relative;\">Urgent Pointer<a href=\"#urgent-pointer\" aria-label=\"urgent pointer permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/555aeadb010efbf3bcfcac8043546218/c7bb6/header-urgent.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42jWPW2vcMBSE/f//TUMfmlBKIJRCCElzIdmu7V3LV1m25Kts2WtnciTow4eENGdmjhcyDi41xnGCajp0/YiB7v2g0XYDeFnh6AcoRe3eatk4zX+sRqoWTdtjmg289yNDGJfIuUCScSQ5xylKcGYp4rRAnBXgQqIoa/cfxZnj/eDjcAzAkhwRaf0Tg2xaeGkuXPp62WCWlVgoraOWGst6cam8FEiznHQV9DQ7FA23Xe9mrM4Qy7rCi1NO6RVGPTmTkegHu86AltZgcYLwHCEvrE5A1BKTWcjUuDBrOBP2zRq7hnalmhIr1eBMBgkN86qGkIoMFBQ1Xo3BRltcLtRaa3DSVNR4praG/iwL4YVRhiLJsNGQIQNDBuXpBBFF6HmJnlp1jEHfXmP+/Qv67ifEj2+orq8gb75joPft/g7bn1vsLw/w8kpCsRifvo8tCLCHIVa6d6+vjv7tzdE8PaF//ovh5RkdnerxEcvHBz4DH7t/xP7vgJ1zfAE0ggsWfcStyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header urgent\" title=\"\" src=\"/static/555aeadb010efbf3bcfcac8043546218/6af66/header-urgent.png\" srcset=\"/static/555aeadb010efbf3bcfcac8043546218/69538/header-urgent.png 160w,\n/static/555aeadb010efbf3bcfcac8043546218/72799/header-urgent.png 320w,\n/static/555aeadb010efbf3bcfcac8043546218/6af66/header-urgent.png 640w,\n/static/555aeadb010efbf3bcfcac8043546218/d9199/header-urgent.png 960w,\n/static/555aeadb010efbf3bcfcac8043546218/21b4d/header-urgent.png 1280w,\n/static/555aeadb010efbf3bcfcac8043546218/c7bb6/header-urgent.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>As the name suggests, this is an urgent pointer. If the URG flag is 1, the receiver prioritizes the data that this pointer references.</p>\n<h3 id=\"options\" style=\"position:relative;\">Options<a href=\"#options\" aria-label=\"options permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d6d70f7f103f663d79397716f4598afb/c7bb6/header-options.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfElEQVR42jWRbW/TQBCE/f//D7QqUFSoQJQUitQaN67T+P1sx+92YjtxHtYHfBjN6nZ2du7OcFyFynu6bk9R1tRNRyt10/ZUdYtKMtb2C0m602e7vNSa/1g0eVFRVg37w4Bhrl0cLyFSKX6o8CPFZuvz6gZ4QYwXxqg0J052ur/1Qg3TsrHWL7h+xFa09sYlLyuMIEr19ul4YhgnwSjbaknZM05HvVUlKUEYiS6j3x80Chmu6kbPLLpBME4ThhcoYpXJlXvattPcCNcirsTY83wcZ0MUxcSxIhXT/WLa7zUPw8hBli71KGF0QrUr2IlBKgavQYgv14/zglRSJEVJ0TSM88wJOAp6SaOkn4n+cJoZ5rPGKLXhePJGpsl5YzMtcNakP1ZkD/d0lklrPdGYj7S/n+ifTc1qdUdy/53s54r68dffOdtiCj2MqJCf/XYLN1ecv36CLzecbj/Svr+gEXQfLjWad2+FL+ivL3WvunrD9Pka/s0gM/PDHX8A7lcIgtr6L4IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"header options\" title=\"\" src=\"/static/d6d70f7f103f663d79397716f4598afb/6af66/header-options.png\" srcset=\"/static/d6d70f7f103f663d79397716f4598afb/69538/header-options.png 160w,\n/static/d6d70f7f103f663d79397716f4598afb/72799/header-options.png 320w,\n/static/d6d70f7f103f663d79397716f4598afb/6af66/header-options.png 640w,\n/static/d6d70f7f103f663d79397716f4598afb/d9199/header-options.png 960w,\n/static/d6d70f7f103f663d79397716f4598afb/21b4d/header-options.png 1280w,\n/static/d6d70f7f103f663d79397716f4598afb/c7bb6/header-options.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The options field contains fields used to extend TCP‚Äôs functionality, and its length is variable rather than fixed. This is why the data offset field described above is needed ‚Äî so the receiver can tell where the header ends and the data begins.</p>\n<p>I mentioned that the data offset field can represent values from 20 to 60 bytes. The header without any options ‚Äî from Source Port through Urgent Pointer ‚Äî is 20 bytes, and the maximum length of the options field is 40 bytes.</p>\n<p>If the data offset field‚Äôs value is greater than 5 (20 bytes) but no TCP options are being used, the excess bytes must be filled with zeros so the receiver can correctly determine the header size.</p>\n<p>Notable options include <code class=\"language-text\">WSCALE</code> for extending the maximum window size, <code class=\"language-text\">SACK</code> for using the Selective Repeat method, and roughly 30 other options ‚Äî far too many to explain one by one here.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>That covers a brief TCP overview and its header structure. Admittedly, this only scratches the surface of TCP, but given that this is a nearly 50-year-old protocol, there‚Äôs far too much content to fit into a single post.</p>\n<p>As I mentioned at the start, protocols like TCP and IP are ones you rarely interact with directly unless you‚Äôre doing socket programming.</p>\n<p>But even without direct interaction, as a web developer who uses HTTP every day, I think it‚Äôs worth knowing how the protocols underlying your daily work actually operate.</p>\n<p>If you want to see how TCP is implemented in the kernel, you can check out the implementations in <a href=\"https://github.com/torvalds/linux/tree/master/net/ipv4\" target=\"_blank\" rel=\"nofollow\">linux/net/ipv4</a> in the Linux source on GitHub. (Fair warning ‚Äî the Linux source itself is so massive that cloning it takes ages.)</p>\n<p>If you‚Äôd like to observe TCP communication firsthand, you can use a simple <a href=\"https://github.com/evan-moon/simple-tcp-example\" target=\"_blank\" rel=\"nofollow\">TCP example program</a> along with utilities like <code class=\"language-text\">tcpdump</code> and <code class=\"language-text\">netstat</code>. Use <code class=\"language-text\">tcpdump</code> to inspect the content of packets exchanged between client and server, and <code class=\"language-text\">netstat</code> to check the TCP states of the client and server.</p>\n<p>In the next post, I‚Äôll cover TCP‚Äôs handshake process, flow control, and congestion control mechanisms.</p>\n<p>That concludes this post on what information is stored in TCP‚Äôs header.</p>","fields":{"slug":"20191110-header-of-tcp-en","path":"/2019/11/10/header-of-tcp/en/","lang":"en"},"frontmatter":{"title":"What Information Is Stored in TCP's Header?","subTitle":"From packet switching to checksums ‚Äî everything about the TCP header","date":"Nov 10, 2019","categories":["Programming","Network"],"tags":["TCP","Header","ECN","TCP Flags","SYN","ACK","TCP Header","Packet Switching","TCP Checksum"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/08849868fcdd6a15a88abb391dccacf7/d803c/thumbnail.png","srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/d803c/thumbnail.png 320w,\n/static/08849868fcdd6a15a88abb391dccacf7/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/fc5c5/thumbnail.webp 320w,\n/static/08849868fcdd6a15a88abb391dccacf7/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/08849868fcdd6a15a88abb391dccacf7/01fb2/thumbnail.png","srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/08849868fcdd6a15a88abb391dccacf7/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"aa2d548e-4eb6-5e1b-804f-7cb6a2a8c809","tableOfContents":"<ul>\n<li>\n<p><a href=\"#a-brief-introduction-to-http3\">A Brief Introduction to HTTP/3</a></p>\n</li>\n<li>\n<p><a href=\"#why-is-tcp-considered-slow\">Why Is TCP Considered Slow?</a></p>\n<ul>\n<li><a href=\"#3-way-handshake\">3-Way Handshake</a></li>\n<li><a href=\"#holb-head-of-line-blocking\">HOLB (Head-of-Line Blocking)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#why-http3-uses-udp\">Why HTTP/3 Uses UDP</a></p>\n<ul>\n<li><a href=\"#udp-is-a-blank-canvas\">UDP Is a Blank Canvas</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-http3-improves-over-previous-protocols-by-using-udp\">How HTTP/3 Improves Over Previous Protocols by Using UDP</a></p>\n<ul>\n<li><a href=\"#reduced-latency-in-connection-setup\">Reduced Latency in Connection Setup</a></li>\n<li><a href=\"#faster-packet-loss-detection\">Faster Packet Loss Detection</a></li>\n<li><a href=\"#multiplexing-support\">Multiplexing Support</a></li>\n<li><a href=\"#connections-survive-ip-changes\">Connections Survive IP Changes</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n<li>\n<p><a href=\"#references\">References</a></p>\n</li>\n</ul>","excerpt":"HTTP/3 is the third major version of HTTP (Hypertext Transfer Protocol). Unlike HTTP/1 and HTTP/2, it communicates using QUIC, a UDP-based protocol. The biggest difference between HTTP/3 and its predecessors is that it runs on UDP instead of TCP. I first learned about HTTP/3 after reading a post someone shared: HTTP/3: the past, the present, and the future. My honest first reaction when I saw the title was:","html":"<p>HTTP/3 is the third major version of HTTP (Hypertext Transfer Protocol). Unlike HTTP/1 and HTTP/2, it communicates using QUIC, a UDP-based protocol. The biggest difference between HTTP/3 and its predecessors is that it runs on UDP instead of TCP.</p>\n<p>I first learned about HTTP/3 after reading a post someone shared: <a href=\"https://blog.cloudflare.com/http3-the-past-present-and-future/\" target=\"_blank\" rel=\"nofollow\">HTTP/3: the past, the present, and the future</a>. My honest first reaction when I saw the title was:</p>\n<!-- more -->\n<blockquote>\n<p>Wait, HTTP/2 was only released about 4 years ago. HTTP/3 already? Isn‚Äôt it just in the design phase?</p>\n</blockquote>\n<p>But after reading the post, I was surprised to learn that Google Chrome had already shipped a Canary build with HTTP/3 support ‚Äî it was at the point where you could actually try it. It took roughly 15 years to go from HTTP/1 to HTTP/2, yet just 4 years later, the next major version was already usable.</p>\n<p>On top of that, the global adoption rate of HTTP/2 was still only around 40% at the time. That‚Äôs how recent HTTP/2 still was.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABKklEQVR42pWS2W6DMBBF+f8vzAPYHryUBLyw2NikD70JqJGatErR0WgYrrnjsatt287nZO2ntdc3ce46DGVZSjVNM2OjUkXK/BKlnil1HYchVuM4CTEZs2ldjHmBlIXogLHSNIVzLEazsQph5DxApHVu20z0gLFc14gr5ysiaNtVylUpJNH7m/N8OoWmge5QfEN0SLU+QL6/ChGdi9U8L2h73wzMn3neM4pEaXeeOB/3X8LnHaA8nLGYsXAf7P8XL0vkfHp1Hr/yaBt7xrT3tt8EAyO6O6eEwY445D+sftwZiOHsXKq893X9IYQlsm3rhBiI3B0rZUCCT1L6HaVQgcByPvS9h3OKMeacQ/BCcK0VkUBUSgohLpczcmN0132g3nWm7/t8e9aU0hd/j8r0CkmYvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ce http2\" title=\"\" src=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png\" srcset=\"/static/8a0a69c0fbc05eba2198cd4f552845d4/69538/ce-http2.png 160w,\n/static/8a0a69c0fbc05eba2198cd4f552845d4/72799/ce-http2.png 320w,\n/static/8a0a69c0fbc05eba2198cd4f552845d4/0a47e/ce-http2.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>HTTP/2 adoption rate as of August 2019, surveyed by W3Techs.com</small>\n</center>\n<p>With programming languages and frameworks, the publisher pushes an update and users upgrade ‚Äî done. But protocols are agreements, requiring coordination between software vendors, so I assumed such rapid changes wouldn‚Äôt happen often.</p>\n<p>Technology moves fast, sure, but HTTP is a foundational web protocol. The fact that such a dramatic change happened in just 4 years was genuinely surprising. (Web developers who had just adopted HTTP/2 a few months earlier were in tears.)</p>\n<p>The other thing that surprised me was that HTTP/3 uses UDP instead of TCP. There‚Äôs no rule saying web protocols <em>must</em> use TCP, but from what we learn in school to what we use in practice, HTTP being defined on top of TCP was so deeply ingrained that using UDP felt novel. I couldn‚Äôt help but wonder: ‚ÄúWhy abandon TCP when it works perfectly fine?‚Äù</p>\n<p>Technically, HTTP/3 hadn‚Äôt been formally released yet ‚Äî it was still in the testing phase. But as mentioned above, Chrome already had a Canary build with HTTP/3 support, Mozilla Firefox was planning to support it in Nightly builds soon, and cURL was offering HTTP/3 as an experimental feature. It seemed very likely that HTTP/3 would become the main protocol in the near future.</p>\n<p>If you want to try HTTP/3 in Google Chrome, you can launch it from the terminal with the <code class=\"language-text\">--enable-quic</code> and <code class=\"language-text\">--quic-version=h3-23</code> flags:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">open</span> <span class=\"token parameter variable\">-a</span> Google<span class=\"token punctuation\">\\</span> Chrome <span class=\"token parameter variable\">--args</span> --enable-quic --quic-version<span class=\"token operator\">=</span>h3-23</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1d6e0c652510ca8a97827fff1fad7575/5a6dd/http3-demo.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACTElEQVR42lWRSXPTQBCF/QcgS0EVBwriRIvtaLVkS9Y20mixExNClkMqcQrHCVVw4sbff/S0i5AcXnVP98yn162elBK1rDB2bXiO9azAsxH6ziupWlNLnH1ZIokmnC+Xp8jSGXzXwjTw0Gtuf8NabPA5u4Em7qCVK+jVPd6Fl3jrfsWOd44d95zyc7yxz6i3woFYYZd6ZvMdo24DjWqmvMf7yRV6d7/+IOxuYJfXcOU1jotv+OgI7Bsz7GgRdrUYe5Tvmwl29RjD9Ayf/BZ7lFviAra4hFVcwKmu8MEq0fv5Y4OTroHIE8iygMgSBGQ/Ivtx6CEi+fYQI6PPytOYeyovixRS5BS3bz17gN7m8RGyaZHmAhmplA1yUUFUNeft/BRJlkM3DOi6jiTNEYRTOuvIihJFKSkK5GWFY8sm4GaDum7pYkbAAgXBFFhBgzBEOJnC98cM0zSN76m6rmtIs//3CwJaloXeIzmcL04IULKqmsanr6oLChaEEziuC88bwzBMBoZUM8hxzg4rioLfWDY5fHh4QNvNnyHxLEUQhPB8nx2ocSbTiOoJQ1R/HITsWPUKMrGNNPIxOVyv12jajoGy6Rg2Go34wdHREUuNqpMUMKV9KuemaTKEjRBU7dx2nC2wJtAsyXjctltgfrKE47gMeKntDnNeg/qgWpH4N3Iltzt8enqiP7lgoLqsonIxjWIMBoNXYof049QKTNNgSEnOlFNlRpngHfKBFt/vH+Dw8JBin0dVLl5KOZzQuK7rcT6NY96tihHF4XCEv+fijBWB+5EDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"http3 demo\" title=\"\" src=\"/static/1d6e0c652510ca8a97827fff1fad7575/6af66/http3-demo.png\" srcset=\"/static/1d6e0c652510ca8a97827fff1fad7575/69538/http3-demo.png 160w,\n/static/1d6e0c652510ca8a97827fff1fad7575/72799/http3-demo.png 320w,\n/static/1d6e0c652510ca8a97827fff1fad7575/6af66/http3-demo.png 640w,\n/static/1d6e0c652510ca8a97827fff1fad7575/5a6dd/http3-demo.png 802w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The entries showing http/2+quic/46 are connections using the HTTP/3 protocol</small>\n</center>\n<p>As a web developer, I couldn‚Äôt just ignore the fact that HTTP was getting a major update. I was also curious about what using UDP actually meant. So I dug into HTTP/3, and this post is a summary of what I found.</p>\n<h2 id=\"a-brief-introduction-to-http3\" style=\"position:relative;\">A Brief Introduction to HTTP/3<a href=\"#a-brief-introduction-to-http3\" aria-label=\"a brief introduction to http3 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>HTTP/3 was originally called ‚ÄúHTTP-over-QUIC.‚Äù Mark Nottingham, chair of both the HTTP and QUIC working groups within the IETF (Internet Engineering Task Force), proposed renaming the protocol to HTTP/3. The proposal was accepted in November 2018, and the name changed from HTTP-over-QUIC to HTTP/3.</p>\n<p>In other words, HTTP/3 is HTTP running on top of a protocol called QUIC. QUIC stands for ‚ÄúQuick UDP Internet Connection‚Äù ‚Äî literally, a protocol that establishes internet connections using UDP. (It‚Äôs pronounced just like ‚Äúquick,‚Äù by the way.)</p>\n<p>HTTP/3 uses QUIC, and QUIC uses UDP, so we can say HTTP/3 uses UDP.</p>\n<p>So what exactly is QUIC, and why can it achieve faster transmission speeds than TCP? To understand that, we first need to know why TCP is considered slow and what advantages UDP offers.</p>\n<h2 id=\"why-is-tcp-considered-slow\" style=\"position:relative;\">Why Is TCP Considered Slow?<a href=\"#why-is-tcp-considered-slow\" aria-label=\"why is tcp considered slow permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When I first learned about the differences between TCP and UDP in a networking class, my professor said it would definitely be on the exam, so I memorized this table:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Connection</td>\n<td>Connection-oriented</td>\n<td>Connectionless</td>\n</tr>\n<tr>\n<td>Packet exchange</td>\n<td>Virtual circuit</td>\n<td>Datagram</td>\n</tr>\n<tr>\n<td>Order guarantee</td>\n<td>Guaranteed</td>\n<td>Not guaranteed</td>\n</tr>\n<tr>\n<td>Reliability</td>\n<td>High</td>\n<td>Low</td>\n</tr>\n<tr>\n<td>Speed</td>\n<td>Slow</td>\n<td>Fast</td>\n</tr>\n</tbody>\n</table>\n<p>From this table, the takeaway is roughly ‚ÄúTCP is reliable but slow‚Äù and ‚ÄúUDP is unreliable but fast.‚Äù The ‚Äúreliability‚Äù here refers to whether all data sent by the sender arrives intact at the receiver ‚Äî by checking packet ordering, detecting packet loss, and so on.</p>\n<p>TCP uses several mechanisms to ensure reliable communication between client and server. But these mechanisms are themselves communications between client and server, so they inevitably add latency. And since these processes have been part of the TCP standard since its inception, you can‚Äôt just skip them.</p>\n<p>To reduce latency, you‚Äôd need to touch things outside of TCP‚Äôs defined features ‚Äî but there are many constraints. No matter how much you increase bandwidth, the data we need to transmit keeps growing with advancing technology, so things will eventually get slow again. And even if you increase the raw transmission speed, you can‚Äôt go faster than the speed of light.</p>\n<p>This is exactly why HTTP/3 chose QUIC, a UDP-based protocol ‚Äî it opted to modify the protocol itself to overcome these constraints. But TCP is such an old protocol, deeply defined at the low level down to the kernel, that overhauling it would be a massive undertaking. So they chose UDP instead.</p>\n<p>Let‚Äôs look at why the mechanisms TCP uses for reliable communication are considered slow.</p>\n<h3 id=\"3-way-handshake\" style=\"position:relative;\">3-Way Handshake<a href=\"#3-way-handshake\" aria-label=\"3 way handshake permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP is an extremely polite protocol. Before starting or ending communication, it always asks whether both sides are ready, establishes packet ordering, and only then begins the actual data transfer.</p>\n<p>The process at the start of communication is called the 3-Way Handshake, and the process at the end is called the 4-Way Handshake. Since the purpose of this post isn‚Äôt to cover these in detail, I‚Äôll only explain how the 3-Way Handshake works.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA9gAAAPYAF6eEWNAAACX0lEQVR42k1S227aQBD1//9EH/LQqhSpJNCE2IAvwXfWxvLd611fARHRgBSJW7A7wEvnYTS7O2fm7JlhTqdz27bb7Ycyldfr9fl8Ph6OTdO0/9nlcjkcDvCUpqltWbvdDhLgyCiKMpnwgiAihBzHCYIA/HK5BExzMwjKspzP557n2bataxrPC7wgTmWZEUW+8/MHxw0JwUmSYJwAvijKe8M7OM/zoijquoaiGGOOe+12O5I0YTx3riqS50Fpa2bOLAuZpllV9b0zwCEAtsPhkGVfx+NxHMfI1gWB8/w5A5TCMABKPM8PBgOWZf88PyfJtfNqtd5sPiAghMg3myGUxFhjPfaXYk19JooSWdaCIPZ93zCN668MI4qK/b5FqAj81R2sqSo8aRpkhqHrz3QjDkOGZdHDw/CpP03iCKGZaRqSJOVZBpjPz/3m7+fHtuUnCc9PBFBVkqIoTlLsuE61qJk0jZGlJ0kI5YG8YRij0SjPr+C5EUQOaY+thzA34uAevmZb9nOH6357El5Epi7r0I/LvAIlQBhCKQTEq067dk3279m+OYPaWYpxlmWQQAn1HM9UjSgIGNVRBmJ/oo+kN1EUhF7vd78/sJTqcmqrugbNrmpj/PjYAy0ty8rynGTE9d2yKpmRMey9dYbqE6UpMAflXc+lWXk8tba9CIJ3AGNMQSdCKDSnlBa0DNxgUS2YZb1c1Svwt03Iq6oCbuAB8/XVnE7NdttOp1TTVF3XLdvGBI8MtjvuyPM3BrZihkzQ2brZdVS6fgffFqy5jYrK8hTmZJowI7037na57y/C4z+QeJZeh7viqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"3way handshake\" title=\"\" src=\"/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png\" srcset=\"/static/dd7f29fecd14fe5feebc6cf562123c48/69538/3way-handshake.png 160w,\n/static/dd7f29fecd14fe5feebc6cf562123c48/72799/3way-handshake.png 320w,\n/static/dd7f29fecd14fe5feebc6cf562123c48/dd45a/3way-handshake.png 550w\" sizes=\"(max-width: 550px) 100vw, 550px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The 3-Way Handshake process when starting communication</small>\n</center>\n<p>As shown above, when a client first creates a TCP connection to a server, they exchange <code class=\"language-text\">SYN</code> and <code class=\"language-text\">ACK</code> packets. The values inside these packets allow client and server to verify packet ordering and confirm that packets were properly received.</p>\n<p>This process requires 3 round trips of communication. If you‚Äôre on macOS or Linux, you can observe this process directly using the <code class=\"language-text\">tcpdump</code> utility in your terminal.</p>\n<p>Note that running <code class=\"language-text\">tcpdump</code> without options will monitor all packets on the device, making it hard to find what you want. So I captured only the communication with a blog server running on loopback:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> tcpdump <span class=\"token function\">host</span> localhost <span class=\"token parameter variable\">-i</span> lo0\nIP localhost.53920 <span class=\"token operator\">></span> localhost.terabase: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1260460927</span>, win <span class=\"token number\">65535</span>\nIP localhost.terabase <span class=\"token operator\">></span> localhost.53920: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3009967847</span>, ack <span class=\"token number\">1260460928</span>, win <span class=\"token number\">65535</span>\nIP localhost.53920 <span class=\"token operator\">></span> localhost.terabase: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">3009967848</span>, win <span class=\"token number\">6379</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>sender > receiver: Flags [flag type], header values</p>\n</blockquote>\n<p>The original output contains more information, but I‚Äôve trimmed it to what‚Äôs needed for the explanation. The key fields here are <code class=\"language-text\">Flag</code>, <code class=\"language-text\">seq</code>, and <code class=\"language-text\">ack</code>. Let‚Äôs break them down.</p>\n<p><code class=\"language-text\">localhost.53920</code> is the client, and <code class=\"language-text\">localhost.terabase</code> is the server. Each line‚Äôs first field shows <code class=\"language-text\">sender > receiver</code>, so the first packet is from client to server, the second from server to client. Each line also has a <code class=\"language-text\">Flag</code> that indicates what type of packet it is:</p>\n<table>\n<thead>\n<tr>\n<th>Flag</th>\n<th>Name</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>S</td>\n<td>SYN</td>\n<td>Client sends a sequence number to the server to initiate connection</td>\n</tr>\n<tr>\n<td>S.</td>\n<td>SYN-ACK</td>\n<td>Server generates an ACK value and responds to the client</td>\n</tr>\n<tr>\n<td>.</td>\n<td>ACK</td>\n<td>Response using the ACK value</td>\n</tr>\n</tbody>\n</table>\n<p>After this communication, client and server can establish a reliable TCP connection. Since it takes 3 exchanges, it‚Äôs called a 3-Way Handshake.</p>\n<p>What happens during this process that creates a reliable connection? Looking more closely, the client and server go through roughly this flow:</p>\n<blockquote>\n<p>Line 1: Client sends a sequence number in the <code class=\"language-text\">seq</code> field to the server<br />\nLine 2: Server increments the client‚Äôs sequence number by 1 and sends it back in the <code class=\"language-text\">ack</code> field<br />\nLine 3: Client increments the server‚Äôs sequence number by 1 and sends it back in its own <code class=\"language-text\">ack</code> field<br /></p>\n</blockquote>\n<p>The 3-Way Handshake begins when a client sends a random sequence number to the server to create a new TCP connection. This sequence number later serves as the ordering guide when the receiver reassembles packets from the sender.</p>\n<p>Both client and server increment the received <code class=\"language-text\">seq</code> (sequence number) by 1 and place it in their own <code class=\"language-text\">ack</code> (acknowledgment number) field, essentially saying: ‚ÄúThis packet follows the sequence number you sent earlier.‚Äù</p>\n<p>These 3 exchanges are the 3-Way Handshake. Through this process, client and server inform each other that they‚Äôre ready to exchange data and establish the sequence numbers needed for subsequent data transfer. Ending a connection goes through a similar 4-Way Handshake process, requiring 4 exchanges.</p>\n<p>In short, as long as you‚Äôre using TCP, you must go through this tedious process before any real communication can begin.</p>\n<p>HTTP/1 processed only one request per TCP connection and then closed it, so this handshake had to happen with every single request. HTTP/2 changed this by maintaining a single TCP connection and handling multiple requests over it, minimizing handshakes.</p>\n<p>Even in the transition from HTTP/1 to HTTP/2, the handshake process itself was left untouched ‚Äî they only minimized how often it occurred to reduce latency. This is because handshaking is mandatory as long as TCP is in use.</p>\n<p>HTTP/3, however, chose UDP, eliminating the handshake process entirely and securing connection reliability through other means.</p>\n<h3 id=\"holb-head-of-line-blocking\" style=\"position:relative;\">HOLB (Head-of-Line Blocking)<a href=\"#holb-head-of-line-blocking\" aria-label=\"holb head of line blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>There‚Äôs another problem with HTTP over TCP: Head-of-Line Blocking (HOLB). While HTTP-level HOLB and TCP-level HOLB technically mean different things, they share the same essence ‚Äî a bottleneck in one request increases overall latency.</p>\n<p>In TCP communication, packets must be processed in exact order. The receiver must reassemble packets using the sequence numbers exchanged with the sender.</p>\n<p>If a packet is lost mid-transmission, the data can‚Äôt be fully reassembled, so it‚Äôs never ignored. The sender must confirm that the receiver got every packet, and if any packet wasn‚Äôt received, it must be retransmitted.</p>\n<p>Since packets must be processed in order, subsequent packets can‚Äôt be processed until previous ones are parsed. When a packet is lost or the receiver‚Äôs parsing speed is slow, this bottleneck is called ‚ÄúHOLB.‚Äù This is a fundamental TCP issue affecting not just HTTP/1 but HTTP/2 as well.</p>\n<p>To solve these problems, HTTP/3 chose to run on QUIC, a protocol built on UDP. Let‚Äôs now look at what QUIC actually is and what advantages UDP offers over TCP.</p>\n<h2 id=\"why-http3-uses-udp\" style=\"position:relative;\">Why HTTP/3 Uses UDP<a href=\"#why-http3-uses-udp\" aria-label=\"why http3 uses udp permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Since HTTP/3 runs on QUIC, understanding HTTP/3 means focusing on QUIC. QUIC is a UDP-based protocol developed by Google to solve TCP‚Äôs problems and break through latency limitations.</p>\n<p>QUIC was designed from the start with a focus on optimizing TCP‚Äôs handshake process, and it achieved this by using UDP.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/e8950/quic.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 87.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3klEQVR42o1U/UuTURT2H4gI+iGTgqB+S5McFqlJZDaz0LK0NHSpSYkmlbNiH1okiC00h6SULjQykrWK/MyVpqFoUzIlNXP4rdkHfmzpdren+95t2mxbXTjcc+8553mfe597XjcAC86MEOJy/YfNUTNTq3eDk2E2m9k8O69DQ1sX5nR6u/1VucTqNrs5A1oyGFHV1IYD0Slw38lHcEwq6lo6/spzCWhL0v1axCNVDbb5H8WWM2Lwyt9ia4IEG31CEHvxBj4OaO3yHQISk4nNlbWNOJYsQux1OQIq3oHXoIVPqRretYPg0dmDL8Am/wg8a2hZrnMMSCyAIlkx1vidgG/TGHaUqBEnkiFbdhfh6TnwftCIXXTf/aAA4tvF1jriGlCadx/r/I5jj6oLPGUnAkUFEOYWoVjxGOICBUIVdVgbEIVMmucS0GQ98vuefuyLuYANu8OwXVIEn5p+eKk+4EihElLKPrdQAQkF0/QMWOvM/xZlnj6RgjIlPPdHwSM4Dl6Z97CeHtPrsACvWjv/X2X2RZpoYzsyNYNLN+XwDDoJYbYco5Nfl0/DMXMKaDQa6bszMDMaLTFuNlkUxMTMj+VXwOXY2Blo3aKlzjnD1VdgY8sxMjnoEocMa5vbkZyVTy0P1bQ7uPHpyzCKKl4wv6SyCh3dfcyXlz/F1Mx35iuUNUgQ3YL0jmIFUE+7IiA6FWWqOjx8Xg/fiHMs8rpVg9CzV5gfmZbFYtwIPJ0G7dgkej9rWZ2qvhnqVs0K4NyCHv6nUjAyMY3x6W8IElxmkTf0h8BPyGB3GU47p+Klmu3z44VMHE1vP0ISM8ARon1vd2STJL+U0CA5lHSVbN4bSdq7+8jP2XkSK8wmYedFJCJVSgaHx4mRvuL4azmEMiQLOj1JFOWS4Ph0kiSWLVlFb2R3aLaagXZLS2cPhkYnV0Qxc7Nz4bg4FcyO4RDVcQirjJKxW1O1Xa0HqXEsnvwGZ3Pl7+F/khcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"quic\" title=\"\" src=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/6af66/quic.png\" srcset=\"/static/8e3e92afbd86fb0b85dcbb6ef055c169/69538/quic.png 160w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/72799/quic.png 320w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/6af66/quic.png 640w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/d9199/quic.png 960w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/21b4d/quic.png 1280w,\n/static/8e3e92afbd86fb0b85dcbb6ef055c169/e8950/quic.png 2000w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<p>As the name ‚ÄúUser Datagram Protocol‚Äù suggests, UDP uses a datagram approach with independent packets that have no inherent ordering. Since datagrams only need a destination ‚Äî they don‚Äôt care about the intermediate path ‚Äî there‚Äôs no end-to-end connection setup either. In other words, no handshake is needed.</p>\n<p>The bottom line is that UDP is faster because it skips the many steps TCP takes to ensure reliability. But does using UDP mean we lose the reliability and data integrity that TCP provided?</p>\n<p>No. Even with UDP, you can implement all the features TCP has. UDP‚Äôs real advantage is that it‚Äôs highly customizable.</p>\n<h3 id=\"udp-is-a-blank-canvas\" style=\"position:relative;\">UDP Is a Blank Canvas<a href=\"#udp-is-a-blank-canvas\" aria-label=\"udp is a blank canvas permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In school, I was taught that the biggest difference between UDP and TCP is ‚ÄúUDP is faster but less reliable than TCP.‚Äù This is half right and half wrong.</p>\n<p>UDP has no features defined beyond data transmission itself, so it‚Äôs true that the protocol doesn‚Äôt guarantee reliability on its own. But put differently, it‚Äôs a blank-slate protocol with nothing but data transmission capability. To get a sense of how many features TCP packs in for reliability and congestion control, just look at its header:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42j2P147CMBRE8/9/x4IQkEKq4zi9YofA7NjS7sOR43jKvV6YSMh2xbJs6PoR47Rg5vc0rxjGGbKq8fADVKpx/5q2d5o/rKbtBvTDhO2l4V0fCcK0gpAKWSGRCYkozvBMcqR5ibQoIVWLsmrce5wWjuvNx+0RIMkEYmr9KEHbD/ByoVz7/j6gzU4M20ZOucLsb9cqK4W8ENTVWLeXo6N5GCfnsTpNzL7DS3PJ9hrLurmQhUyzXWfGwDWSNEMYPSFK6mQFVTeuxIZuRGuDF9mIYbib0K7UsLHuejwZkNEsaVRtB9W06DiJOQ4c3y/eZKXZvlv9y05ntyOGeGFcoMwKHFxTM0A3HaoogopjTJxoYvggSow8F65uTxGEKMOIuif6vIC2wSw23MwTNSdIUnx9H0cQ4BOG2Pk9ns+O6XJx9KfT/338OaPjXd/v+LLcej7WrxR+AYjFDnQh+N9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp header\" title=\"\" src=\"/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png\" srcset=\"/static/ac69210c44cd473bcb737665d590b124/69538/tcp-header.png 160w,\n/static/ac69210c44cd473bcb737665d590b124/72799/tcp-header.png 320w,\n/static/ac69210c44cd473bcb737665d590b124/6af66/tcp-header.png 640w,\n/static/ac69210c44cd473bcb737665d590b124/d9199/tcp-header.png 960w,\n/static/ac69210c44cd473bcb737665d590b124/21b4d/tcp-header.png 1280w,\n/static/ac69210c44cd473bcb737665d590b124/c7bb6/tcp-header.png 1986w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>TCP's header, already packed with information</small>\n</center>\n<p>TCP was designed a long time ago and includes so many features that its header is nearly full. If you want to implement custom features beyond TCP‚Äôs built-in ones, you‚Äôd use the <code class=\"language-text\">Options</code> field at the bottom, but since it can‚Äôt grow infinitely, it‚Äôs capped at <code class=\"language-text\">320 bits</code>.</p>\n<p>And the later-defined options like <code class=\"language-text\">MSS (Maximum Segment Size)</code>, <code class=\"language-text\">WSCALE (Window Scale Factor)</code>, and <code class=\"language-text\">SACK (Selective ACK)</code> already take up most of that options space, leaving barely any room for custom features.</p>\n<p>UDP, on the other hand, was designed with a sole focus on data transmission, so its header is practically empty:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/73dae/udp-header.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.750000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAq0lEQVR42j2O226DMBAF+f/P60vTkNoO2GAuBoxNopJEky1S+zDSzh7tpVCVx0+ZdLszxcSSNtbtfhDzjXlN6KpGXesjiykTpoW4Zqm3gzmuTHNkkfnio3Qo7QjW4U1Nf7U0yqBOZ5pvg9cVvfQ7wTUdVqidp7Ytn6eS8qKxbU8l/kvRjYEwjOxy5WeJPOSjLN5q8+9/2T6OPIVXCOz9QPt1Zjbm8KfseQwDb9HI4QyOb6OzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"udp header\" title=\"\" src=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/6af66/udp-header.png\" srcset=\"/static/f9ccf1094e8f9f057d72c004d4f0e0e8/69538/udp-header.png 160w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/72799/udp-header.png 320w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/6af66/udp-header.png 640w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/d9199/udp-header.png 960w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/21b4d/udp-header.png 1280w,\n/static/f9ccf1094e8f9f057d72c004d4f0e0e8/73dae/udp-header.png 2122w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Compared to TCP, UDP's header is noticeably bare</small>\n</center>\n<p>UDP‚Äôs header contains only source port, destination port, packet length, and checksum. The checksum is used for verifying packet integrity, but unlike TCP‚Äôs mandatory checksum, UDP‚Äôs checksum is optional.</p>\n<p>In other words, while the UDP protocol itself is less reliable than TCP and lacks flow control, depending on how a developer implements the application layer, it can achieve TCP-like functionality.</p>\n<p>Sure, it‚Äôs convenient that TCP provides all those reliability features out of the box. But the unfortunate part is that these features are mandatory processes defined in the protocol itself ‚Äî developers can‚Äôt customize them. This makes it nearly impossible to even attempt reducing the latency they introduce.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e0bf6f0a79b033925a91b04e4653d7af/e2310/tcp-tls.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 102.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADtklEQVR42s2TbUxTVxjHsWwuRMbclmWGKZoN3USigsFJ1A9kWZZJsixmbPHLFr84i2lLaUtf0uaEVpcimkDGQjYVBTK23ESBZnTicLp0AtG2lL5cyu1tb+9tb6G0lHaoHVR6dm4DRnRu9sOSneRJ7n2ec375n/P8n5yc/3IJBIICoVC4VSqVviWRSDbX1dW9WV9fvwnlihoaGjbKZLJCPp+/icuLRKL1y7XX0dE1q0AYBnO5UCi+elUuB1sAABuXgeUItEOr1W7V6XSb1Wr1dg4gFovfUCj4LwOgL5LJQCGEMBfFc6uhN0C+sllZqmxVvsb9Awh5T7sJBA9rPK1Wv0MJwDurNty5M9kyMkzYzL/jt1wW0jwViQ5csAY+PKb/9iUPjpcHg8GjDMMcpWm6hts/KLlcCnJq1vqmUx8RzPwEPX3PNhVJVj0Edl2yD7WfGoEXVFdT174zw5nYQqSfjB/JqEkmtyDYCYIgakmSPIYxWF5Pbc+7bvsUFp39M3U/uZRegjAdu5uC1vEZUQbonIgPOYgktDHzKR99D17rsET7iOgn3cbRAjYQEPn9/hORSIQfDoWlOIl/0S3o3nf7FiO1k3+kTWb2wc1RJm3xJhZ/tYU/yABn5lP6u6kl08JS2hhL3L9uHqaw86OB6isDv2xDykQul+szpPJjpPBIcDpY2av6abegWPDCb65Eo2ViDjqJWMpiC9X//YNDmLGA6opzby1oy08kIm+zLNuAVMpCodCXXK1H3ldmbDUWcN9zc3D3/AIs5c4hd/BWIJm2c2E2w+e5nOZHR8U57OorLEsfQCA+RVHHUVOOOwlnyQ+NvQe7JF3rHhPC+0eFwnOWnSMWx3afz/cNUncKx3Hd+Ph4u5/xSzvVxrK2Wiz/ETG5T52WFaCmw1oRjieLY+Hwrng8vndxcbECXf2g1z9Z/XO36dOaErD2mcZv5R1Of2+vnJ6Jtnk9nkuoGc1ut/uM3W4/zYYCHe7bDHhi3P5NoeKMaU9np6Fo0uU6xCmbnZ3dj6xTheobWoT9O8/L+l7MCqhqGiqn6UghgjUiy+i9Xq+OcBOtoXDg8681hspmyeC6rIBy7c0yg8FUhOPOk6jDOnRlDUGQzYEQdbhJZihvAzfyswJqNIN7jEaigKI8VUhdNTL3IYfNcdiOW99vaex976x4OC8roFp+fZfTSpSQpAfzeDw9KNopyt8ZYOm6JtXQsytEyAwQKAa2XbyIbRgbG1u/bHreit+Aor/4rBjLy/k/rDXZnvgLm+tNcqo265oAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"tcp tls\" title=\"\" src=\"/static/e0bf6f0a79b033925a91b04e4653d7af/6af66/tcp-tls.png\" srcset=\"/static/e0bf6f0a79b033925a91b04e4653d7af/69538/tcp-tls.png 160w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/72799/tcp-tls.png 320w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/6af66/tcp-tls.png 640w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/d9199/tcp-tls.png 960w,\n/static/e0bf6f0a79b033925a91b04e4653d7af/e2310/tcp-tls.png 968w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If you add TLS on top of TCP, you have to go through all of this before communication even begins</small>\n</center>\n<p>To reduce latency, you‚Äôd need to modify things outside the protocol. But as I mentioned, the areas a typical developer can touch in the communication process are limited. (We just have to wait for the telecom giants to lay down the infrastructure.)</p>\n<p>If the difference between TCP and UDP still isn‚Äôt clicking, think of it as ‚Äúa heavy, full-featured library‚Äù versus ‚Äúa lightweight library with only the essentials.‚Äù</p>\n<p>For example, <a href=\"https://lodash.com/\" target=\"_blank\" rel=\"nofollow\">lodash</a> in the JavaScript world is incredibly feature-rich and convenient, but most people don‚Äôt use every single method. It‚Äôs handy, but you‚Äôre bundling features you‚Äôll never use.</p>\n<p>A small library with a single purpose has fewer features than lodash, but you can pick exactly what you need. The tradeoff is that anything the library doesn‚Äôt support, you have to implement yourself. In this analogy, lodash is TCP and the small single-purpose library is UDP.</p>\n<p>This is why Google chose UDP when building QUIC: TCP was too difficult to modify, and the blank-slate nature of UDP made it easy to extend QUIC‚Äôs capabilities.</p>\n<h2 id=\"how-http3-improves-over-previous-protocols-by-using-udp\" style=\"position:relative;\">How HTTP/3 Improves Over Previous Protocols by Using UDP<a href=\"#how-http3-improves-over-previous-protocols-by-using-udp\" aria-label=\"how http3 improves over previous protocols by using udp permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>So far we‚Äôve briefly covered why QUIC, the backbone of HTTP/3, chose UDP over TCP. What concrete benefits does using UDP actually bring? Is HTTP/3 truly better than the old HTTP + TCP + TLS approach?</p>\n<p>The answer can be found in the Chromium Projects‚Äô <a href=\"https://docs.google.com/document/d/1gY9-YNDNAB1eip-RTPbqphgySwSNSDHLq9D5Bty4FSU/edit\" target=\"_blank\" rel=\"nofollow\">QUIC Overview</a> document. Let‚Äôs look at the advantages Google describes.</p>\n<h3 id=\"reduced-latency-in-connection-setup\" style=\"position:relative;\">Reduced Latency in Connection Setup<a href=\"#reduced-latency-in-connection-setup\" aria-label=\"reduced latency in connection setup permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since QUIC doesn‚Äôt use TCP, it doesn‚Äôt need the tedious 3-Way Handshake to start communication. A cycle where the client sends a request and the server processes and responds is called an ‚ÄúRTT (Round Trip Time).‚Äù TCP requires at least 1 RTT to create a connection, and if you add TLS encryption, the TLS handshake adds up to a total of 3 RTTs.</p>\n<p>QUIC, on the other hand, requires only 1 RTT for the initial connection setup. The client sends a signal to the server, the server responds, and real communication begins immediately. The connection setup time is roughly halved.</p>\n<center>\n  <img src=\"/95f5c7e411d0b7f96d182abe284be551/gcp-cloud-cdn-performance.gif\" width=\"100%\">\n  <br>\n</center>\n<p>How is this possible? The reason is simpler than you‚Äôd expect. During the first handshake, QUIC sends the data along with the connection setup information. TCP + TLS exchanges all the information needed for a reliable connection and encryption, validates it, and <em>then</em> exchanges data. QUIC just fires off the data immediately.</p>\n<p>This process is explained in detail in the session ‚Äù<a href=\"https://youtu.be/vXgbPZ-1-us\" target=\"_blank\" rel=\"nofollow\">How Secure and Quick is QUIC?</a>‚Äù presented at the 2015 IEEE Symposium.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe title=\"\" src=\"https://www.youtube.com/embed/vXgbPZ-1-us?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" loading=\"eager\" allowfullscreen=\"\" sandbox=\"allow-same-origin allow-scripts allow-popups\"></iframe> </div> </div></p>\n<center>\n  <small>Start watching from 3:33.<br />The presenter's swagger, hand in pocket, is hard to miss.</small>\n  <br />\n  <br />\n</center>\n<p>The key point of the video is this: TCP + TLS must exchange session keys and establish an encrypted connection before data can be exchanged with those session keys. QUIC can exchange data <em>before</em> session keys are even exchanged, which is why connection setup is faster.</p>\n<p>However, when a client sends its first request to the server, it doesn‚Äôt yet know the server‚Äôs session key. So it encrypts the communication using an Initial Key generated from the destination server‚Äôs Connection ID. For a detailed explanation, see the QUIC working group‚Äôs <a href=\"https://quicwg.org/base-drafts/draft-ietf-quic-tls.html#rfc.section.5.2\" target=\"_blank\" rel=\"nofollow\">Using TLS to Secure QUIC</a> document.</p>\n<p>Once a connection succeeds, the server caches the configuration and uses it for the next connection, enabling communication to start with 0 RTT. This is how QUIC achieves lower latency compared to TCP + TLS.</p>\n<p>Note that this session was presented before TLS 1.3 was released, so it wasn‚Äôt mentioned. Today, using TCP Fast Open with TLS 1.3, you can achieve a similar connection setup process, giving TCP some of the same benefits.</p>\n<p>However, TCP SYN packets are limited to about <code class=\"language-text\">1460 bytes</code> per packet, while QUIC can include all the data in the first round trip. So for large payloads, QUIC still has the advantage.</p>\n<h3 id=\"faster-packet-loss-detection\" style=\"position:relative;\">Faster Packet Loss Detection<a href=\"#faster-packet-loss-detection\" aria-label=\"faster packet loss detection permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Like TCP, QUIC also needs flow control for transmitted packets. Both QUIC and TCP are fundamentally ARQ-based protocols ‚Äî ARQ (Automatic Repeat Request) means recovering from errors through retransmission.</p>\n<p>TCP uses ‚ÄúStop and Wait ARQ‚Äù: after sending a packet, the sender starts a timer, and if the receiver doesn‚Äôt respond within a certain time, the packet is considered lost and retransmitted.</p>\n<p>According to Google‚Äôs 2017 <a href=\"https://datatracker.ietf.org/doc/draft-ietf-quic-recovery/?include_text=1\" target=\"_blank\" rel=\"nofollow\">QUIC Loss Detection and Congestion Control</a>, QUIC detects packet loss similarly to TCP but with several improvements.</p>\n<p>A major issue with TCP‚Äôs packet loss detection is dynamically calculating how long to wait after sending a packet ‚Äî when to trigger a timeout. This timeout is called the RTO (Retransmission Time Out), and the data it needs is a collection of RTT (Round Trip Time) samples.</p>\n<p>You measure how long it takes to receive an acknowledgment after sending a packet, then dynamically determine the timeout. To measure RTT samples, you must receive an ACK from the sender. Under normal conditions this isn‚Äôt a problem, but when a timeout occurs and a packet is retransmitted, the RTT calculation becomes ambiguous:</p>\n<blockquote>\n<p>Send packet ‚Üí Timeout ‚Üí Retransmit packet ‚Üí ACK received!<br />\n(But is this ACK for the first packet or the second one?)</p>\n</blockquote>\n<p>To determine which packet the ACK corresponds to, you need additional methods like timestamps on packets, plus extra packet inspection. This is called Retransmission Ambiguity.</p>\n<p>To solve this, QUIC assigns a separate packet number space in its header. This packet number represents only the transmission order itself. Unlike sequence numbers (which remain the same on retransmission), packet numbers increase monotonically with each transmission, making it possible to clearly identify packet ordering.</p>\n<p>With TCP, if timestamps are available, you can determine transmission order through them. If not, you‚Äôre left implicitly inferring order from sequence numbers. QUIC eliminates this unnecessary ambiguity through unique per-packet numbers, reducing the time needed for packet loss detection.</p>\n<p>QUIC uses roughly 5 additional techniques to speed up packet loss detection. For details, I recommend reading Chapter ‚Äú3.1 Relevant Differences Between QUIC and TCP‚Äù in <a href=\"https://datatracker.ietf.org/doc/draft-ietf-quic-recovery/?include_text=1\" target=\"_blank\" rel=\"nofollow\">QUIC Loss Detection and Congestion Control</a>.</p>\n<h3 id=\"multiplexing-support\" style=\"position:relative;\">Multiplexing Support<a href=\"#multiplexing-support\" aria-label=\"multiplexing support permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Multiplexing is crucial because it prevents the HOLB problem mentioned earlier as a TCP drawback. With multiple streams, even if packets are lost in one stream, only that stream is affected ‚Äî the others continue running fine.</p>\n<p>Note that multiplexing doesn‚Äôt mean creating multiple TCP connections. It‚Äôs a technique for sending multiple data flows without mixing them up within a single connection. Each individual data flow is called a stream.</p>\n<p>HTTP/1 used only one stream per TCP connection, so it couldn‚Äôt escape the HOLB problem. And since the connection closed after each transfer, you had to go through the handshake all over again.</p>\n<p>The <code class=\"language-text\">keep-alive</code> option could maintain a connection for a certain time, but if there was no access within that window, the connection would still close.</p>\n<p>HTTP/2 introduced multiplexing ‚Äî handling multiple streams within a single TCP connection ‚Äî to boost performance. With a single TCP connection carrying multiple data transfers, the number of handshakes dropped and data transfer became more efficient.</p>\n<center>\n  <img src=\"/40cb0bc1d62eba25c2e351d213d1700d/multiplexing.svg\">\n  <br>\n  <small>HTTP/3 supports the same multiplexing as HTTP/2.</small>\n  <br>\n  <br>\n</center>\n<p>QUIC also supports multiplexing like HTTP/2, carrying over these benefits. Even if one stream encounters a problem, the other streams are unaffected.</p>\n<h3 id=\"connections-survive-ip-changes\" style=\"position:relative;\">Connections Survive IP Changes<a href=\"#connections-survive-ip-changes\" aria-label=\"connections survive ip changes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>TCP identifies connections using the source IP and port plus the destination IP and port. If the client‚Äôs IP changes, the connection breaks. A broken connection means going through the tearful 3-Way Handshake all over again, adding more latency.</p>\n<p>This is especially noticeable today because people frequently use mobile internet ‚Äî switching from Wi-Fi to cellular, or moving between different Wi-Fi networks, all of which change the client‚Äôs IP.</p>\n<p>QUIC, on the other hand, uses a Connection ID to establish connections with the server. A Connection ID is just a random value completely unrelated to the client‚Äôs IP, so even if the client‚Äôs IP changes, the existing connection is maintained. This means you can skip the handshake that would otherwise be needed to create a new connection.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>To properly explain HTTP/3 and QUIC, foundational networking knowledge is essential, so there were parts that were hard to cover in depth in this single post. I tried to be as detailed as possible, but the post was getting quite long, so I had to trim things down.</p>\n<p>After studying HTTP/3 and digging through various resources, my main takeaway was: ‚ÄúHow did so much change?‚Äù Granted, once you throw out TCP, a lot is bound to change. But as someone who had only adopted HTTP/2 a few months earlier, it was a bit overwhelming. (The fact that they built HTTP but threw out TCP still blows my mind.)</p>\n<p>Honestly, whether developers use HTTP/2 or HTTP/3, users in countries with excellent internet infrastructure might not notice much difference. The small geographic size and strong infrastructure can cover up handshake latency and then some. But in countries with weaker infrastructure, the difference could be quite significant.</p>\n<p>In this post, I only talked about the advantages of HTTP/3 and UDP. Many people are concerned about abandoning TCP for UDP, and of course no technology is perfect ‚Äî there will be issues.</p>\n<p>But as an attempt to break through the limitations of existing HTTP and TCP, it seems like a great move.</p>\n<p>That concludes this post on why HTTP/3 chose UDP.</p>\n<h2 id=\"references\" style=\"position:relative;\">References<a href=\"#references\" aria-label=\"references permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><a href=\"https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46403.pdf\" target=\"_blank\" rel=\"nofollow\">The QUIC Transport Protocol: Design and Internet-Scale Deployment</a></li>\n<li><a href=\"https://medium.com/codavel-blog/quic-vs-tcp-tls-and-why-quic-is-not-the-next-big-thing-d4ef59143efd\" target=\"_blank\" rel=\"nofollow\">QUIC vs TCP+TLS - and why QUIC is not the next big thing</a></li>\n<li><a href=\"https://blog.cloudflare.com/http3-the-past-present-and-future/\" target=\"_blank\" rel=\"nofollow\">HTTP/3: the past, the present, and the future</a></li>\n<li><a href=\"https://www.saturnsoft.net/network/2019/03/21/quic-http3-1/\" target=\"_blank\" rel=\"nofollow\">QUICÍ≥º HTTP/3 - 1.UDPÍ∏∞Î∞ò Ï†ÑÏÜ° ÌîÑÎ°úÌÜ†ÏΩúÏùò ÎåÄÎëê</a></li>\n<li><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"nofollow\">QUIC, a multiplexed stream transport over UDP</a></li>\n<li><a href=\"https://quicwg.org/base-drafts/draft-ietf-quic-tls.html#rfc.section.5.2\" target=\"_blank\" rel=\"nofollow\">Using TLS to Secure QUIC</a></li>\n<li><a href=\"https://blog.cloudflare.com/the-road-to-quic/\" target=\"_blank\" rel=\"nofollow\">The Road to QUIC</a></li>\n</ul>","fields":{"slug":"20191008-what-is-http3-en","path":"/2019/10/08/what-is-http3/en/","lang":"en"},"frontmatter":{"title":"Why Did HTTP/3 Choose UDP?","subTitle":"The web standard is changing. HTTP/3 picks UDP for speed.","date":"Oct 08, 2019","categories":["Programming","Network"],"tags":["HTTP3","TCP","UDP","Network"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/3a812/thumbnail.jpg","srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/3a812/thumbnail.jpg 320w,\n/static/70cbe98ca5682a8f70aa5afe9a5533ed/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/fc5c5/thumbnail.webp 320w,\n/static/70cbe98ca5682a8f70aa5afe9a5533ed/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/2d839/thumbnail.jpg","srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/70cbe98ca5682a8f70aa5afe9a5533ed/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"845389d6-35af-55eb-a63b-05226262e130","tableOfContents":"<ul>\n<li>\n<p><a href=\"#ip-internet-protocol\">IP, Internet Protocol</a></p>\n<ul>\n<li><a href=\"#ipv4-structure\">IPv4 Structure</a></li>\n<li><a href=\"#ipv4-classes\">IPv4 Classes</a></li>\n<li><a href=\"#special-purpose-ipv4-addresses\">Special Purpose IPv4 Addresses</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lets-look-at-the-path-from-my-home-to-google\">Let‚Äôs Look at the Path from My Home to Google</a></p>\n<ul>\n<li><a href=\"#using-traceroute\">Using traceroute</a></li>\n<li><a href=\"#lets-learn-more-detail\">Let‚Äôs Learn More Detail!</a></li>\n</ul>\n</li>\n</ul>","excerpt":"In this post I want to briefly talk about what process our home goes through to communicate with Google. Among things I learned at university that I thought were interesting, one representative thing was the fact that all computers connected to the internet are actually connected through cables. Some might think this fact obvious, but it seemed quite amazing back then. Though I use internet daily, it‚Äôs an element so naturally melted into life that I didn‚Äôt care much about its principles.","html":"<p>In this post I want to briefly talk about what process our home goes through to communicate with Google. Among things I learned at university that I thought were interesting, one representative thing was the fact that all computers connected to the internet are actually connected through cables.</p>\n<p>Some might think this fact obvious, but it seemed quite amazing back then. Though I use internet daily, it‚Äôs an element so naturally melted into life that I didn‚Äôt care much about its principles.</p>\n<!-- more -->\n<p>Then as I learned more detail about networks at school, I realized ‚Äúthese benefits I‚Äôm using matter-of-factly are actually a very systematic and complex system.‚Äù</p>\n<p>So in this post I want to simply unpack that system through the process of accessing Google servers from my home. Of course, since I‚Äôm making rough estimates based on IP addresses, it won‚Äôt be exact information, but I‚Äôll focus on roughly what processes enable accessing servers overseas.</p>\n<h2 id=\"ip-internet-protocol\" style=\"position:relative;\">IP, Internet Protocol<a href=\"#ip-internet-protocol\" aria-label=\"ip internet protocol permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, to know the path from my home to Google, let‚Äôs briefly learn about IP, inseparable from internet. The term IP address is a very familiar term even for non-computer majors.</p>\n<p>In typical environments, you can think of this IP address playing our home address‚Äôs role when we access internet. Likewise, points along the path from my home to Google all have IP addresses, and we can roughly guess where these points are based on those IP addresses.</p>\n<p>I‚Äôll explain very basic content about IP, so those who already know can just skip.</p>\n<h3 id=\"ipv4-structure\" style=\"position:relative;\">IPv4 Structure<a href=\"#ipv4-structure\" aria-label=\"ipv4 structure permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Generally the form we can encounter like <code class=\"language-text\">192.168.0.1</code> is IPv4. IPv4 consists of four fields composed of 8 bits, and each of these fields is called an octet. <small>(By the way, terms starting with Oct often mean 8)</small>.</p>\n<p>For example, <code class=\"language-text\">192.168.0.1</code> can be represented in binary like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Decimal: 192.168.0.1\nBinary: 11000000.10101000.00000000.00000001</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Since one octet can only have 8 bits, octets have <code class=\"language-text\">00000000-11111111</code>, i.e. <code class=\"language-text\">0-255</code> in decimal. So the number of addresses IPv4 can create is <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup><mo>=</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>294</mn><mo separator=\"true\">,</mo><mn>967</mn><mo separator=\"true\">,</mo><mn>296</mn></mrow><annotation encoding=\"application/x-tex\">2^{32} = 4,294,967,296</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">294</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">967</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">296</span></span></span></span></span>, about 4.3 billion. 4.3 billion‚Ä¶ seems like quite a big number. When first making this address system, they probably thought:</p>\n<blockquote>\n<p><em>Eh, 4.3 billion should last somewhat, right?</em></p>\n</blockquote>\n<center>\n<br />\n.<br />\n.<br />\n.<br />\n<br />\n</center>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/de8631a2bb9ad577fae2ba57e8801a22/41099/unexpected-result.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAABAD/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAExEHKPUj//xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIDEiEz/9oACAEBAAEFAqkXdB6lbJ5n/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BZ//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ASf/xAAWEAEBAQAAAAAAAAAAAAAAAAAQESH/2gAIAQEABj8Cjj//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQIaFh/9oACAEBAAE/IRF6j2fDCWtUsN8x/9oADAMBAAIAAwAAABBcD//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxA4v//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAECAQE/ELP/xAAdEAEBAAEEAwAAAAAAAAAAAAABEQAQITFBUXGh/9oACAEBAAE/EKbSNjkylivZv19zluOSJXj3iajcCx40/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"unexpected result\" title=\"\" src=\"/static/de8631a2bb9ad577fae2ba57e8801a22/41099/unexpected-result.jpg\" srcset=\"/static/de8631a2bb9ad577fae2ba57e8801a22/0913d/unexpected-result.jpg 160w,\n/static/de8631a2bb9ad577fae2ba57e8801a22/cb69c/unexpected-result.jpg 320w,\n/static/de8631a2bb9ad577fae2ba57e8801a22/41099/unexpected-result.jpg 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>As worldwide internet users grew faster than expected, all addresses were ultimately exhausted as of February 4, 2011, and currently IPv4 allocation is stopped. Fortunately they weren‚Äôt just sitting idle during that time, and smart people worldwide already prepared countermeasures, so don‚Äôt worry too much.</p>\n<h3 id=\"ipv4-classes\" style=\"position:relative;\">IPv4 Classes<a href=\"#ipv4-classes\" aria-label=\"ipv4 classes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Like this, IP addresses aren‚Äôt resources you can just freely distribute but finite resources, so they manage by dividing usage by specific ranges. These divided ranges are called classes, managing by dividing into total 5 classes A-E.</p>\n<p>Each class creates restrictions on the 8 bits in the first field of IPv4 expressed in binary <code class=\"language-text\">00000000.00000000.00000000.00000000</code>, so just looking at the first field‚Äôs number, you can know which class that IPv4 address belongs to.</p>\n<p>This restriction forces the first field‚Äôs most significant bits. For example, A class must always start with bit <code class=\"language-text\">0</code>, so can use first fields between <code class=\"language-text\">00000000(0)</code> and <code class=\"language-text\">01111111(127)</code>, and C class must always start with bits <code class=\"language-text\">110</code>, so can use first fields from <code class=\"language-text\">11000000(192)</code> to <code class=\"language-text\">11011111(223)</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Class</th>\n<th>First Field</th>\n<th>Address Range</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td>0xxxxxxx</td>\n<td>0.0.0.0 ~ 127.255.255.255</td>\n<td>Large-scale networks</td>\n</tr>\n<tr>\n<td>B</td>\n<td>10xxxxxx</td>\n<td>128.0.0.0 ~ 191.255.255.255</td>\n<td>Medium-scale networks</td>\n</tr>\n<tr>\n<td>C</td>\n<td>110xxxxx</td>\n<td>192.0.0.0 ~ 223.255.255.255</td>\n<td>Small-scale networks</td>\n</tr>\n<tr>\n<td>D</td>\n<td>1110xxxx</td>\n<td>224.0.0.0 ~ 239.255.255.255</td>\n<td>Multicast</td>\n</tr>\n<tr>\n<td>E</td>\n<td>1111xxxx</td>\n<td>240.0.0.0 ~ 255.255.255.255</td>\n<td>Reserved for research/development or future</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"special-purpose-ipv4-addresses\" style=\"position:relative;\">Special Purpose IPv4 Addresses<a href=\"#special-purpose-ipv4-addresses\" aria-label=\"special purpose ipv4 addresses permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Like this, dividing classes and even within those classes, there are IPv4 addresses pre-reserved for special purposes. These reserved addresses are defined by <a href=\"https://tools.ietf.org/html/rfc5735\" target=\"_blank\" rel=\"nofollow\">RFC 5735</a> and cannot be allocated for purposes beyond their intended use. In this post I‚Äôll briefly explain just some representative ones.</p>\n<table>\n<thead>\n<tr>\n<th>Class</th>\n<th>Address</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td>0.0.0.0 ~ 0.255.255.255</td>\n<td>Unallocated meta addresses</td>\n</tr>\n<tr>\n<td>A</td>\n<td>10.0.0.0 ~ 10.255.255.255</td>\n<td>Large-scale private networks</td>\n</tr>\n<tr>\n<td>A</td>\n<td>100.64.0.0 ~ 100.127.255.255</td>\n<td>Addresses for Carrier-grade NAT</td>\n</tr>\n<tr>\n<td>A</td>\n<td>127.0.0.0 ~ 127.255.255.255</td>\n<td>Self. A.k.a. Loopback</td>\n</tr>\n<tr>\n<td>C</td>\n<td>192.168.0.0 ~ 192.168.255.255</td>\n<td>Small-scale private networks. Often seen using routers.</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"lets-look-at-the-path-from-my-home-to-google\" style=\"position:relative;\">Let‚Äôs Look at the Path from My Home to Google<a href=\"#lets-look-at-the-path-from-my-home-to-google\" aria-label=\"lets look at the path from my home to google permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Okay, finally I can start this post‚Äôs main content.</p>\n<p>Opening MacBook at home and entering <code class=\"language-text\">google.com</code> in web browser, the web browser will send a request to Google servers somewhere in the world to send pages. But my MacBook isn‚Äôt directly connected to Google servers.</p>\n<p>So the request I sent goes through a rough journey, stopping here and there to reach Google servers. So now let‚Äôs find out where my request sent from home stops before reaching Google servers.</p>\n<h3 id=\"using-traceroute\" style=\"position:relative;\">Using traceroute<a href=\"#using-traceroute\" aria-label=\"using traceroute permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since I use Unix-based MacOS, I‚Äôll explain based on MacOS. Using the <code class=\"language-text\">traceroute</code> utility, I can find out what path packets I sent take to reach Google servers.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">traceroute</span> <span class=\"token parameter variable\">-q</span> <span class=\"token number\">1</span> google.com\n<span class=\"token function\">traceroute</span> to google.com <span class=\"token punctuation\">(</span><span class=\"token number\">172.217</span>.25.196<span class=\"token punctuation\">)</span>, <span class=\"token number\">64</span> hops max, <span class=\"token number\">52</span> byte packets\n <span class=\"token number\">1</span>  <span class=\"token number\">192.168</span>.25.1 <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.25.1<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.077</span> ms\n <span class=\"token number\">2</span>  <span class=\"token number\">211.0</span>.0.0 <span class=\"token punctuation\">(</span><span class=\"token number\">211.0</span>.0.0<span class=\"token punctuation\">)</span>  <span class=\"token number\">5.928</span> ms\n <span class=\"token number\">3</span>  <span class=\"token number\">100.71</span>.51.17 <span class=\"token punctuation\">(</span><span class=\"token number\">100.71</span>.51.17<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.693</span> ms\n <span class=\"token number\">4</span>  <span class=\"token number\">10.44</span>.255.240 <span class=\"token punctuation\">(</span><span class=\"token number\">10.44</span>.255.240<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.328</span> ms\n <span class=\"token number\">5</span>  <span class=\"token number\">10.222</span>.18.10 <span class=\"token punctuation\">(</span><span class=\"token number\">10.222</span>.18.10<span class=\"token punctuation\">)</span>  <span class=\"token number\">7.319</span> ms\n <span class=\"token number\">6</span>  <span class=\"token number\">10.222</span>.16.201 <span class=\"token punctuation\">(</span><span class=\"token number\">10.222</span>.16.201<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.883</span> ms\n <span class=\"token number\">7</span>  <span class=\"token number\">10.222</span>.16.41 <span class=\"token punctuation\">(</span><span class=\"token number\">10.222</span>.16.41<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.853</span> ms\n <span class=\"token number\">8</span>  <span class=\"token number\">72.14</span>.204.124 <span class=\"token punctuation\">(</span><span class=\"token number\">72.14</span>.204.124<span class=\"token punctuation\">)</span>  <span class=\"token number\">34.784</span> ms\n <span class=\"token number\">9</span>  <span class=\"token number\">108.170</span>.242.193 <span class=\"token punctuation\">(</span><span class=\"token number\">108.170</span>.242.193<span class=\"token punctuation\">)</span>  <span class=\"token number\">37.751</span> ms\n<span class=\"token number\">10</span>  <span class=\"token number\">108.170</span>.233.79 <span class=\"token punctuation\">(</span><span class=\"token number\">108.170</span>.233.79<span class=\"token punctuation\">)</span>  <span class=\"token number\">36.643</span> ms\n<span class=\"token number\">11</span>  nrt13s50-in-f4.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">172.217</span>.25.68<span class=\"token punctuation\">)</span>  <span class=\"token number\">35.416</span> ms</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The second hop outputs public IP that could expose my detailed location, so I masked it for security. Actually the ISP (Internet Service Provider) I use, SK Broadband, has IP address lease period within managed areas of 1 hour, and I reside in a high population density area, so even if that IP address is exposed, location isn‚Äôt easy to know, but I‚Äôll cover it because I‚Äôm still anxious.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 420px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6d8c691361160ceec51f9bdd1c9b19f0/65f94/meme.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHj2K8ubVZWbTBGD//EABwQAAEFAAMAAAAAAAAAAAAAAAIAAQMQERIiMf/aAAgBAQABBQIe0k4MNZiMuSdqPxf/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAABAwUAAAAAAAAAAAAAAAABABARAiBhcYH/2gAIAQEABj8CGShE9abKNN//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMRBhQVHw/9oACAEBAAE/IamoDQQdcQdb35xC3XrEofcJ8vbDU//aAAwDAQACAAMAAAAQHP8Agv/EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPxAkcf/EABcRAAMBAAAAAAAAAAAAAAAAAAEgITH/2gAIAQIBAT8Q0xP/xAAeEAEAAQMFAQAAAAAAAAAAAAABEQAhQRAxUXGh8P/aAAgBAQABPxALIqgsdFTohYWA+aOgUIJbZpMtYnYh+zScBuJWHRXk6F//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme\" title=\"\" src=\"/static/6d8c691361160ceec51f9bdd1c9b19f0/65f94/meme.jpg\" srcset=\"/static/6d8c691361160ceec51f9bdd1c9b19f0/0913d/meme.jpg 160w,\n/static/6d8c691361160ceec51f9bdd1c9b19f0/cb69c/meme.jpg 320w,\n/static/6d8c691361160ceec51f9bdd1c9b19f0/65f94/meme.jpg 420w\" sizes=\"(max-width: 420px) 100vw, 420px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>What if someone finds my home...</small>\n</center>\n<p>One row output from <code class=\"language-text\">traceroute</code> results is called a hop, meaning the path my packets went through from my home to Google servers. The time output to the right of the hop‚Äôs IP address means the time the hop responded. Interestingly, from hop 8 the response time suddenly jumps from single digits to double digits - from here packets left the country and went overseas.</p>\n<p>So what do these IP addresses mean?</p>\n<h3 id=\"lets-learn-more-detail\" style=\"position:relative;\">Let‚Äôs Learn More Detail!<a href=\"#lets-learn-more-detail\" aria-label=\"lets learn more detail permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Now I want to learn more detail about what each of these IP addresses means, what company owns what device. A simple method is using the <code class=\"language-text\">whois</code> utility.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ whois <span class=\"token number\">172.217</span>.25.68\nNetRange:       <span class=\"token number\">172.217</span>.0.0 - <span class=\"token number\">172.217</span>.255.255\nCIDR:           <span class=\"token number\">172.217</span>.0.0/16\nNetName:        GOOGLE\nNetHandle:      NET-172-217-0-0-1\nParent:         NET172 <span class=\"token punctuation\">(</span>NET-172-0-0-0-0<span class=\"token punctuation\">)</span>\nNetType:        Direct Allocation</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>MacOS‚Äôs <code class=\"language-text\">whois</code> utility sends requests to 5 <code class=\"language-text\">whois</code> services and outputs received results. By the way, South Korea‚Äôs <code class=\"language-text\">whois</code> service is provided at KISA‚Äôs (Korea Internet &#x26; Security Agency) <a href=\"https://xn--c79as89aj0e29b77z.xn--3e0b707e/kor/main.jsp\" target=\"_blank\" rel=\"nofollow\">Whois Search</a>.</p>\n<table>\n<thead>\n<tr>\n<th>whois Domain</th>\n<th>Responsible Area</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>whois.arin.net</td>\n<td>Americas</td>\n</tr>\n<tr>\n<td>whois.nic.mil</td>\n<td>USA (currently not working)</td>\n</tr>\n<tr>\n<td>whois.ripe.net</td>\n<td>Europe</td>\n</tr>\n<tr>\n<td>whois.apnic.net</td>\n<td>Asia Pacific</td>\n</tr>\n<tr>\n<td>whois.jprs.jp</td>\n<td>Japan</td>\n</tr>\n</tbody>\n</table>\n<p>However, <code class=\"language-text\">whois</code> service basically shows information about owners of IP addresses where domains are registered, so information about gateways or routers without registered domains doesn‚Äôt appear. So I‚Äôll try searching using a site called <a href=\"https://www.ip2location.com/demo\" target=\"_blank\" rel=\"nofollow\">IP2Location</a>. <small><strike>(But this also doesn‚Äôt seem likely to show well)</strike></small></p>\n<p>First, the first hop <code class=\"language-text\">192.168.25.*</code> is private IP allocated by my home router, and the second hop is public IP the ISP gave me but masked for security, so let‚Äôs start examining from the third hop <code class=\"language-text\">100.71.51.17</code>.</p>\n<h4 id=\"100715117\" style=\"position:relative;\">100.71.51.17<a href=\"#100715117\" aria-label=\"100715117 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<img src=\"https://images.ip2location.com/18399031.png\">\n<p>Ah, indeed not much information came out. Instead it output information that that IP address is used for Carrier Grade NAT. As explained above, A class <code class=\"language-text\">100.64.0.0 - 100.127.255.255</code> range being used for Carrier Grade NAT is already defined as standard, so it actually output an obvious result. So what is Carrier Grade NAT that my packets stopped by?</p>\n<p>First, NAT is abbreviation for Network Address Translation, technology mainly for multiple hosts belonging to private networks to access internet using one public IP.</p>\n<p>I‚Äôm using multiple SK Broadband services like IPTV and Wi-Fi. But giving separate IP addresses per subscribed service is very insufficient, so SK Broadband allocated me just one public IP address and installed a router with NAT function at home, building a Private Network at my home.</p>\n<p>Carrier Grade NAT (CGN) can be thought of as NAT‚Äôs large-scale version. The router installed at my home only configures private network inside my home, but CGN is NAT configured on backbone network. Simply put, like a giant router‚Ä¶?</p>\n<p>As I know, originally they operate CGN on backbone networks to manage wireless internet devices directly connected to mobile networks like smartphone LTE with NAT, but I don‚Äôt quite understand why my packets using home router are riding CGN. SK Broadband doesn‚Äôt have many IPv4‚Ä¶ are they so lacking they attached CGN even to wired internet‚Ä¶? <small>(If anyone knows, please tell me‚Ä¶I‚Äôm curious‚Ä¶)</small></p>\n<h4 id=\"1044255240--102221641\" style=\"position:relative;\">10.44.255.240 ~ 10.222.16.41<a href=\"#1044255240--102221641\" aria-label=\"1044255240  102221641 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>From here it‚Äôs IP allocated to A class private network, so guessing, it seems inside SK Broadband‚Äôs backbone network. Since ISPs don‚Äôt detail their network structure, I can‚Äôt know exactly where the node is located, but it seems roughly around here in SK Broadband‚Äôs network structure.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/40e14dfe7f089d802c42a2c0fcca55dc/82158/skb-network.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 97.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7zAAAO8wEcU5k6AAAC4UlEQVR42o1U2VLbMBT1T7b9hvITnfaxfEOf+sBMH2CmdPrQklAYIA2BAA5LiB07i5PYsS1blhdJ1lI5CWmZ0uXOtcf23HN1dO6RNcaY7wcQJiiJOOfy9xBCXT9z9VqFFgLQ0dv+xMrjAc6CZfkat34WT3SVmut6EIaCFZxRRpCg+UO1WCYjmSwKSZnEWFI86RuXZy3f9yvweDTs9y1C6BLCiyjPEsYq/iWnQTRAs36ZRuNRo4CeJOS+3TLPmmmWCSE0lMQ3ndMkiSSJBEWszFA845xhUtiT66l7J7MsRtHXky0XjBX5JIHpzDFMs6RUM00zgYoDXyixFKhattvT68efQGzzOHKC7jTolpSAyI8A2P+48+zF893dXc2zmpPhLaalwJDnkeCl5ET1gvOmcbNt2b3Mcw7Pt+/63+dgWGtshX4wvb/d3tkJgkBLAzPyTSlKxVmQhONY8lzyAheOM+0MBl0KgsncHrqXOYYzd9Y3jMvDb283Ny8u2lrnWnecYcWWKXyqZFoozQQnC9GoTBHK01rjveMZBDOKcau+93Jj4+DgQLu9aiDPkFJVF2osqwlyrPBVx7KUaUIZHU1vUAowydVABARZXk1UQ9C3jOssRZyxlWB8SWERrJQIqsYgmWcF8oDD1ZckXugqtL5lX1x1ur1727bYAi9o9ggcBVk8B54dzYcq4XzEQ285Fa2nt6am3jqqda+vOF9MS+BHdsQFQ5AkgCaAwFDd1ZeVPSfW1ah7enZUv9XblRsrk8yXDhPiSUf/4u3poNM7369/3mk3TyqlCMigu6KwwAuxtvlDrk9V4I2RP7Z7N4O+Ueax2jFOQ8u8j+LYdd1/rIzAIOwdH2+/M/UmKwuc50r52t6XN69f1eq18XicpumftqDpescP4/ZFq9v+oErUOUm9oedYp82GYfTyvHj6D7EEO47jujPfdVDoCFpItrLH/4S2EqYkPA1Z4qnkGCmKf1lwDf4BBWRoCVFWkuUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"skb network\" title=\"\" src=\"/static/40e14dfe7f089d802c42a2c0fcca55dc/6af66/skb-network.png\" srcset=\"/static/40e14dfe7f089d802c42a2c0fcca55dc/69538/skb-network.png 160w,\n/static/40e14dfe7f089d802c42a2c0fcca55dc/72799/skb-network.png 320w,\n/static/40e14dfe7f089d802c42a2c0fcca55dc/6af66/skb-network.png 640w,\n/static/40e14dfe7f089d802c42a2c0fcca55dc/82158/skb-network.png 696w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>From here connects to other domestic ISPs or overseas networks</small>\n</center>\n<h4 id=\"7214204124--10817023379\" style=\"position:relative;\">72.14.204.124 ~ 108.170.233.79<a href=\"#7214204124--10817023379\" aria-label=\"7214204124  10817023379 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<img src=\"https://images.ip2location.com/60603511.png\">\n<p>Finally devices Google owns appeared! But the location is Amsterdam, Netherlands. Google is a company in California, USA, but I don‚Äôt understand why Amsterdam suddenly appeared. Something seems strange, so I should ask <code class=\"language-text\">whois.ripe.net</code>, the <code class=\"language-text\">whois</code> service responsible for Europe.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">whois <span class=\"token parameter variable\">-h</span> whois.ripe.net <span class=\"token number\">72.14</span>.204.124\n\ninetnum:        <span class=\"token number\">69.194</span>.128.0 - <span class=\"token number\">76.255</span>.255.255\nnetname:        NON-RIPE-NCC-MANAGED-ADDRESS-BLOCK\ndescr:          IPv4 address block not managed by the RIPE NCC</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Indeed they say it‚Äôs not an address managed here. Then let‚Äôs ask <code class=\"language-text\">whois.arin.net</code> responsible for Americas.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">whois <span class=\"token parameter variable\">-h</span> whois.arin.net <span class=\"token number\">72.14</span>.204.124\n\nNetRange:       <span class=\"token number\">72.14</span>.192.0 - <span class=\"token number\">72.14</span>.255.255\nCIDR:           <span class=\"token number\">72.14</span>.192.0/18\nNetName:        GOOGLE\nNetHandle:      NET-72-14-192-0-1\nParent:         NET72 <span class=\"token punctuation\">(</span>NET-72-0-0-0-0<span class=\"token punctuation\">)</span>\nNetType:        Direct Allocation\nOriginAS:\nOrganization:   Google LLC <span class=\"token punctuation\">(</span>GOGL<span class=\"token punctuation\">)</span>\nRegDate:        <span class=\"token number\">2004</span>-11-10\nUpdated:        <span class=\"token number\">2012</span>-02-24\nRef:            https://rdap.arin.net/registry/ip/72.14.192.0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Oh, proper information came out this time. The device with address <code class=\"language-text\">72.14.204.124</code> seems to be something Google owns. Since IP2Location lost my trust now, I‚Äôll ruthlessly discard it and use a new solution called <a href=\"https://db-ip.com\" target=\"_blank\" rel=\"nofollow\">DB IP</a>.</p>\n<p>Searching using DB IP, the location shows as <code class=\"language-text\">Ashburn, Loudoun, Virginia, United States</code> and Connection Type is <code class=\"language-text\">Hosting</code>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6aa63397ba4132502a4856ab76647df1/a6d66/db-ip-result.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVR42p1UiW7bMAz1/3/RPmEYVgzoiqJJ3DSJj/iWLcm35TeSbgK0w4BiAmjrIJ/J9yh7tu2Q5QXqpsG0LJhmtvlu4zRhcQ4t+aVZDvbn9XZOvtPmN1PsQmtvGEcBa7ueHBfwel4c1tXBkXGwW1c0VYUiDqGyK+osRl0msCpHkV/RkOWHHarrBZ7WGkmSYCQgDsz0hLIDzABoMrdCRtso6DyWoCI8IvD3CN5ekQc0Px3hv/xCHO/g9X0vYDwcRavGoOtHLAQ0O0Dw6NHVBVQZUaYJmiTA8fWAlx8PODz+RhQH+Lk/4PvxzIAD8jyHUgoL8aCp/Jk4+TyMLhClPqLIp7ID6PSM2H/Cw2GPMDrDP+7x7SWEt1KZjnlyzNsqZTN32/563+87jdZUMGUGU6VEQYGkyPCc5NhfU/hhiMcghVdWNVJSOUkzaNOK0uM0i7GK/GYFOWsWj8F5dBOgiKk6pcrojHf5TDI0jYUlMN4c2gHzuAiIKhWdGQEYhhGXS4Asy2StDcW0PVaq4vYRrs7jya56RWQS2XwuD7i2W9BTsUNi8y0jEo+5rustS2MZ0H7geb0BRjZF2SvZDEwMNTT3ednXMudO0NpQI0+ytgTIgv4FaK1Boxo09OWyKqVE3WjibpR28auTZL9SDx3f3nA6n4VPY4x0Rtu20h13QKU75EpTCYacLHGjxbnrOnnbrhVnziwl4RhAMqS3UrUItdDNugPOROr8Tuy/7AYYhJGII6JQ+UVRygfYbn4evjj4J8BXlG+WiCQVWPl5rM59FOUrg0WJouguBItSlFuG7n8A+dZw2bfSlvdm/6zyH6Vx13b7DHTLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"db ip result\" title=\"\" src=\"/static/6aa63397ba4132502a4856ab76647df1/6af66/db-ip-result.png\" srcset=\"/static/6aa63397ba4132502a4856ab76647df1/69538/db-ip-result.png 160w,\n/static/6aa63397ba4132502a4856ab76647df1/72799/db-ip-result.png 320w,\n/static/6aa63397ba4132502a4856ab76647df1/6af66/db-ip-result.png 640w,\n/static/6aa63397ba4132502a4856ab76647df1/d9199/db-ip-result.png 960w,\n/static/6aa63397ba4132502a4856ab76647df1/21b4d/db-ip-result.png 1280w,\n/static/6aa63397ba4132502a4856ab76647df1/a6d66/db-ip-result.png 2070w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>After that, hop 9 <code class=\"language-text\">108.170.242.193</code> and hop 10 <code class=\"language-text\">108.170.233.79</code> also displayed as hosting servers located in Virginia. What on earth is there that they‚Äôre all gathered cozily here‚Ä¶?</p>\n<p>Googling a bit, I found announcements of Google hiring people to work in Ashburn. Also many job postings uploaded to neighboring towns Sterling and Reston in the same Virginia state.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/fa825b93f209cad6a735204a4c4504b1/6d2da/google-hiring.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42pVTa4/aMBDM//9bfOJaaGlVroU8DkggJI4d8g6JPd11G3ToDl270mhtxxmPd9aOAWC6DmhqtJSLoiCU6NoaGCuYK0GPMMb8Exzig3ie4dviJxKZY/3jO758XUGle6D2oQsf0D2mMHgcN8K4PuJZCjQkNCutZkjKSW4wauLtDCKh0Q0G/UD7pbZ73lVY1zUu6oKWcpZlUOWAS20oa2SFRl5rmms7z2ld0lrd9CznXZVOR3UTmYBSCkKkyKuBYFA0TGpuYyZTNOZDOpZJ0fe9xfV6BfOM4whHa22lTjUwd3P9Som5Yboek7Rta3PTNBiGAU6appjNZlitVlgul3h6+mTxebGAHwSYz+fw/QBaxBjb5o8p5rE1TlVV2Gw2cF0PnfLQn5do0l8Iwwj7/R673Q7n8/mhq28I2RTXdXE4HMBqw/CAKAwhpbQ/cElel+WjcLiop9PJqhBCWNKMyKZxkiT225QZURTheDwijmNrJh94p3C73cLzPAvfcy1eXgK7HlAdeX29XlsSPpzVMzETshF3Ctly7j8pFfKcWkdViEWF/FIip9O5xuxgWZa2RT68MsudbO+oBSp6LYqecc+v4m9v/U/8BqA969jZ9pErAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"google hiring\" title=\"\" src=\"/static/fa825b93f209cad6a735204a4c4504b1/6af66/google-hiring.png\" srcset=\"/static/fa825b93f209cad6a735204a4c4504b1/69538/google-hiring.png 160w,\n/static/fa825b93f209cad6a735204a4c4504b1/72799/google-hiring.png 320w,\n/static/fa825b93f209cad6a735204a4c4504b1/6af66/google-hiring.png 640w,\n/static/fa825b93f209cad6a735204a4c4504b1/6d2da/google-hiring.png 936w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Hire me...sob</small>\n</center>\n<p>Scanning the announcements, keywords like Network Engineer, Administrative Business Partner, Data Center, Google Cloud appear a lot, so it seems there‚Äôs a Google data center here. Searching more information, an <a href=\"https://wtop.com/business-finance/2019/02/google-to-double-its-virginia-workforce/\" target=\"_blank\" rel=\"nofollow\">article about Google doubling its Virginia workforce</a> was also written in February this year.</p>\n<p>It seems certain there‚Äôs a Google data center here.</p>\n<h4 id=\"1722172568googlecom\" style=\"position:relative;\">172.217.25.68(google.com)<a href=\"#1722172568googlecom\" aria-label=\"1722172568googlecom permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0d61b84bb06d96dea7054db728e40209/6f175/final.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACRElEQVR42l1TaW/TQBD1//8bCIpA8IVSKqRyiCI1JE3cxCaU1Hadqz7i+r7Wx2NmkxTESOPdbHbfvDdvV0nzHJ6/Q5QkaNoWoqEUDWpK0dDYCLRdh4T2bR0PYZKiEi2qWqCsa0rxlBWdUfKiwPbBQZKm6PoOWVGhanpwdH2Pltb4l+nu8F638EEzcaEZWBg6luYMFz8tnP5a4d3cxldzC6UoS7ieR6yEBImJQZxkSJIYNTE4xnjt47lq4ouqQtd/QLu5wmQywtvJLU5mFv1n4Ox2BSXLMnBKRl2PXVJTCgRZg7DoiOUecGZa+DZRcTe/xtYYYjq6wqfvI7yZmXitWXh5Y+L895ok5wVy6k9D/eqoV49hhLKqpcyWPn2/RzSMBaaDS6jE6uNYw9m1jlfjBV4Q0AnlM2J4ygxZahRFiONYAhbUUx6PcSCIpetgbi8xWTn4fO/j0nAwXO8wolZwDmwX+taHUhOgTHKJXWVG7Cpnd5jzyAp8P5B7OchoMrAhGS3+Vu+hhFFMLrsyM2LH1+FYpCgrkl9JUDbowXFITSzP8j428F8VHAp/2JSS3JZz6icfZtm7IKBDiVznAildreagglsVhiH+Dwl47Wu4i225MPSmsJKVnA9cFXa6OTCqYC+XMK17WbAlqZ7nyyLHWyIBpSlZTC8hhSAZUR4jLTL0xDCvSwRFiFwUEsBxXKQHmfyaguBRmsmsnwAZPaSrwr0J2W0aE9ok6MmBzLbjDTapI+eO66Kinu4BBV2xUAIeHwW34g91epBEkzIrowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"final\" title=\"\" src=\"/static/0d61b84bb06d96dea7054db728e40209/6af66/final.png\" srcset=\"/static/0d61b84bb06d96dea7054db728e40209/69538/final.png 160w,\n/static/0d61b84bb06d96dea7054db728e40209/72799/final.png 320w,\n/static/0d61b84bb06d96dea7054db728e40209/6af66/final.png 640w,\n/static/0d61b84bb06d96dea7054db728e40209/d9199/final.png 960w,\n/static/0d61b84bb06d96dea7054db728e40209/21b4d/final.png 1280w,\n/static/0d61b84bb06d96dea7054db728e40209/6f175/final.png 2036w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Okay, finally the server with address <code class=\"language-text\">172.217.25.68</code>, the final destination of <code class=\"language-text\">google.com</code> domain. Searching this address through DB IP also says it‚Äôs a server in Japan.</p>\n<p>Actually, it‚Äôs obviously much faster for me in Korea to receive information from servers in nearby Japan rather than continuously receiving information from servers in America. My packets were drawing a strange route crossing the Pacific to America then crossing again to Japan‚Ä¶</p>\n<p>Digging deeper I could know why it draws such a route, but the post seems too long so I‚Äôll dig only up to here. <small>(Dig deeper next time‚Ä¶)</small> Even Google I always accessed without thought, looking closely, gets delivered to me through such various paths. It‚Äôs a newly amazing fact.</p>\n<p>That‚Äôs all for this post on the path from my home to Google.</p>","fields":{"slug":"20190622-my-home-to-google-en","path":"/2019/06/22/my-home-to-google/en/","lang":"en"},"frontmatter":{"title":"The Path from My Home to Google","subTitle":"Let's look inside the internet we use daily","date":"Jun 22, 2019","categories":["Programming","Network"],"tags":["Network","Network","IP","TCP","IP Classes","traceroute","Internet","Network Basics","Technical Interview"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/b9d22b130aacc561550df26f133f469d/d803c/network-structure.png","srcSet":"/static/b9d22b130aacc561550df26f133f469d/d803c/network-structure.png 320w,\n/static/b9d22b130aacc561550df26f133f469d/2a1fd/network-structure.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/b9d22b130aacc561550df26f133f469d/fc5c5/network-structure.webp 320w,\n/static/b9d22b130aacc561550df26f133f469d/e9225/network-structure.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/b9d22b130aacc561550df26f133f469d/01fb2/network-structure.png","srcSet":"/static/b9d22b130aacc561550df26f133f469d/01fb2/network-structure.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/b9d22b130aacc561550df26f133f469d/b384d/network-structure.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"1ef48e61-d388-54a1-8259-a4686dd755c2","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-http2\">What is HTTP/2?</a></p>\n</li>\n<li>\n<p><a href=\"#using-http2-in-aws-cloud-front\">Using HTTP/2 in AWS Cloud Front</a></p>\n<ul>\n<li><a href=\"#modifying-cloudfront-distributions\">Modifying CloudFront Distributions</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#using-http2-in-elastic-beanstalk\">Using HTTP/2 in Elastic Beanstalk</a></p>\n<ul>\n<li><a href=\"#what-is-application-load-balancer\">What is Application Load Balancer?</a></li>\n<li><a href=\"#configuration\">Configuration</a></li>\n<li><a href=\"#didnt-do-separate-server-settings\">Didn‚Äôt do separate server settings?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#http2-did-it-apply-well\">HTTP/2, Did It Apply Well?</a></p>\n</li>\n<li>\n<p><a href=\"#lets-compare-with-waterfall\">Let‚Äôs Compare with Waterfall</a></p>\n</li>\n</ul>","excerpt":"In this post I want to explain how to apply HTTP/2 protocol in AWS (Amazon Web Service) environments. Since AWS‚Äôs CloudFront and Application Load Balancer provide features that can natively use HTTP/2 protocol, you can simply apply HTTP/2 protocol without separate work.","html":"<p>In this post I want to explain how to apply HTTP/2 protocol in AWS (Amazon Web Service) environments. Since AWS‚Äôs CloudFront and Application Load Balancer provide features that can natively use HTTP/2 protocol, you can simply apply HTTP/2 protocol without separate work.</p>\n<!-- more -->\n<h2 id=\"what-is-http2\" style=\"position:relative;\">What is HTTP/2?<a href=\"#what-is-http2\" aria-label=\"what is http2 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>HTTP/1 is a protocol that‚Äôs almost 30 years old, and since it was designed as a protocol for documents rather than web applications, in environments like modern web applications with heavy payloads and frequent communication, there are many inefficient aspects.</p>\n<p>So HTTP/2 was devised with the following goals to support modern communication:</p>\n<hr>\n<ul>\n<li>Reduce latency through multiplexing full requests and responses</li>\n<li>Minimize protocol overhead through efficient compression of bloated HTTP header fields</li>\n<li>Support request prioritization</li>\n<li>Support server push</li>\n</ul>\n<hr>\n<p>HTTP/2 was designed to share all core concepts (methods, status codes, URIs and header fields) without modifying applications using existing HTTP/1 protocol. Instead, HTTP/2 improved communication efficiency by modifying data frames and transmission methods between clients and servers.</p>\n<p>Also, what has the biggest effect in client-server communication is that response multiplexing is officially supported. This means you can send and receive multiple resources with just one connection.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cd17700751cbce62e857b08574923f45/9c177/multiplexing.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 97.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADeUlEQVR42p2U/U9TVxjH+08tWChCaaGlvbcUmagzCiuzbqAD0Y3o3BCVQSl9oS1liCUWYWTJiJuEqJsvGUucUfe+yUtfLy1QzP6Hz869JUxQt+kPT07Oued87vPyfR6d5E9hG0xxcCTLiak87ZM5jsQUmi8p1A+lqRlIiv0KrssKFm8S9X5rPMfJz/O0ifW9Kys0RjLUCobkS6KT/Eks4tGp6VUCNzfovV6g+1qBs1+usT+aodojgOMrtKhAca8umMY7t0HPtXUG5gr0zxZwjSnajzeBGeyDCey+lLAksjCnbwlZeKKa6tU7OzxUI6rdtOK71NZ7na3/d6ShvIAuYxrMYTr3C66uGSy+rPbwRcDtkB1AvamO2t4fcUQK9Ez9xsy9JT6bXeBEfImmkcSrA8vsTegrrZTu6eBgyzGGZrO4x0SuAqq92EPp34BquMYjAQzy25i771PRr2D2pLH50trjbcCBhIAltJzLfhVeLIS6/gMURZHDG1oeLT4FaXCRhuACDv+yBt0GFN/rImvIoTymgRzVXgWrOKv2ZgQ0rdVBV/5mO3axcYqLJ68q3LoR5+G9i/RO3uHAcBarNyGACi2xPDXnH1DXPoH71GW6J+9ycfoB7f5beCfmMQl5ycEVdCVlRgxSE+VHRznWeYaZ71KcnlzkQCRBfTClaU8Vumt8HfvHN7GYjDirSuhyV3H2+F66OtzEwn1UuTzYL/wgZOP5k/I9x9m1u5rKji8wehR2f5re0pgastYpY1ks/hx7vY9o6LnBvgvfEpmeJxodRWo+jfP9MHpDZTGHUmgNyfMHpsBT9nl/ZmTqNlZ/dgv4bFHsAQV7cFVYDnuogKP/J0pth3nDYKaq9ZKQjdSM3btIffQpnVcW+Xp+gUxigdbYMoeiCZHDHbJRq+pLaKtaBBWsNof13PeaYzq9UaK0poGyw324WzuYuJ2hbTzF/rBoweAzIb9U2OqZiHIoV6yyuql46yP0JifGD+eoFDm0+IWEvOnnQ35ppyS3TGfr+xV5+C9NqLWhDeTBJ3QOf0NjaFmcpZ8P+b9ab1eFBWvPfRzhNT6JP+b6ncdcjUX5IP6EQyPJVwcanO8KyZgpkY/S2NSG5ysxXMdWcQR2yOb/AuXQuij3qNBiG+bzj4QOM2JYFuej5H+N8aVVSZRbDhdE6yibTV+cKK8D/BtyUDBzrCWA+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"multiplexing\" title=\"\" src=\"/static/cd17700751cbce62e857b08574923f45/6af66/multiplexing.png\" srcset=\"/static/cd17700751cbce62e857b08574923f45/69538/multiplexing.png 160w,\n/static/cd17700751cbce62e857b08574923f45/72799/multiplexing.png 320w,\n/static/cd17700751cbce62e857b08574923f45/6af66/multiplexing.png 640w,\n/static/cd17700751cbce62e857b08574923f45/9c177/multiplexing.png 880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>[Source] csstrick.com<small>\n</small></small></center>\n<p>In HTTP/1, protocol-level response multiplexing wasn‚Äôt supported and browsers were responsible for parallel processing of responses. Therefore, the number of requests that could be processed in parallel differed depending on browser policy.</p>\n<hr>\n<ul>\n<li>Internet Explorer: 10-11 per origin</li>\n<li>Chrome: 6 per origin</li>\n<li>Firefox: 6 per origin</li>\n<li>Opera: 6 per origin</li>\n</ul>\n<hr>\n<p>So frontend developers bundled all JavaScript and CSS files into one bundle to make files like <code class=\"language-text\">index.js</code> or <code class=\"language-text\">style.css</code> to reduce resource requests as much as possible during application initialization, used techniques like Minify or Uglify to reduce capacity as much as possible, and used sprite methods of downloading one large image and masking it to avoid requesting multiple images.</p>\n<p>But HTTP/2 can process up to 128 parallel requests per origin, so now we can create possibilities for performance improvements we couldn‚Äôt do in HTTP/1.1, like dividing into multiple small files instead of one large file and requesting and receiving them simultaneously.</p>\n<h2 id=\"using-http2-in-aws-cloud-front\" style=\"position:relative;\">Using HTTP/2 in AWS Cloud Front<a href=\"#using-http2-in-aws-cloud-front\" aria-label=\"using http2 in aws cloud front permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>AWS started supporting HTTP/2 in Cloud Front from September 2016. You can change from HTTP/1.1 to HTTP/2 with just simple settings. It also has the feature of changing protocol to HTTP/1.1 and responding if receiving requests from lower version browsers that don‚Äôt support HTTP/2.</p>\n<p>The <a href=\"https://aws.amazon.com/blogs/aws/new-http2-support-for-cloudfront/\" target=\"_blank\" rel=\"nofollow\">AWS CloudFront HTTP/2 setup manual</a> explains in detail how to set up HTTP/2, so there was no difficulty at all in the process of changing protocols.</p>\n<h3 id=\"modifying-cloudfront-distributions\" style=\"position:relative;\">Modifying CloudFront Distributions<a href=\"#modifying-cloudfront-distributions\" aria-label=\"modifying cloudfront distributions permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>First, moving to the Cloud Front dashboard shows a list of currently registered distributions. Select the distribution you want to apply HTTP/2 protocol to, then select <code class=\"language-text\">Distribution Settings</code> at the top.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 634px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e1216e67d70cafeea2556e898cbfef79/374ac/cloudfront1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 16.249999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAs0lEQVR42k2OXQqCQBSF3XD02Eu7aAf1Ei2hVVSazBSVaGlC4Pivo/g1CUUHDufjXjgc6xk+kOKIc9jjXS+cTgLbObDb7zjaDrZxEAR8NAzDL//5qw9b/qvE9RPkXXEOFW6gSPKKNDWZJCilSFVK27b0fU/TNHRdN7qu69+tKAq07rAWW5/pymW2Fsw3gslSIB4ZoX8za894noeUkjCKxtI4jseiqip5GtZaE5mfFIIsy3kDCJDel9x/7mwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cloudfront1\" title=\"\" src=\"/static/e1216e67d70cafeea2556e898cbfef79/374ac/cloudfront1.png\" srcset=\"/static/e1216e67d70cafeea2556e898cbfef79/69538/cloudfront1.png 160w,\n/static/e1216e67d70cafeea2556e898cbfef79/72799/cloudfront1.png 320w,\n/static/e1216e67d70cafeea2556e898cbfef79/374ac/cloudfront1.png 634w\" sizes=\"(max-width: 634px) 100vw, 634px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Clicking <code class=\"language-text\">Distribution Settings</code> and entering the distribution settings screen shows a screen with various information about the current distribution. This information also contains information about protocols this distribution supports.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9590e8009282b8ca9e49b979a697dc38/636c2/cloudfront2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABY0lEQVR42oWS63KDIBCFff9Xa2baRsd410RRVMQUvIKXrpq0SSZNvx87wOxhzy4oJWsDRL7qluRZli7wipfnsiiKpmnyPId1SSnGSVVXOMGEFHVdF5T2fa8UhFQVn+cZNkKItm0Z513XNXUN66qqhmGYxgki5Eg5jOM4TRNkQlS2zXxFSpli7PvB8Xg0DcOyrCzL6Ap4gUgIAUdbsjLfwxkHjaaqjPHt0mEYhxV5Beo9irfU8BR+frxrmhbHcUlL0AgphRQ/glvuKkMGdOs6zsEwCMkRijHG4cpm9bbBXzEMgC+wKIpQFBmmyRiDEc4vuYi7roVJgABeS93vVU0LgsAyTdu2YWae5yGE4BWfV14GI2VBizhJ3nY7sI3TNCfwyGc4hEvHlT97HoTAgR+6jqvrnn4IHZcmSQ+yXvxj+6Lve4wi2zR1dY9OYRxG8Eu6tn1w+1y84fme47pdvwCf7MXYvgFuGrA4CzbmowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cloudfront2\" title=\"\" src=\"/static/9590e8009282b8ca9e49b979a697dc38/6af66/cloudfront2.png\" srcset=\"/static/9590e8009282b8ca9e49b979a697dc38/69538/cloudfront2.png 160w,\n/static/9590e8009282b8ca9e49b979a697dc38/72799/cloudfront2.png 320w,\n/static/9590e8009282b8ca9e49b979a697dc38/6af66/cloudfront2.png 640w,\n/static/9590e8009282b8ca9e49b979a697dc38/636c2/cloudfront2.png 911w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Now let‚Äôs click the <code class=\"language-text\">Edit</code> button at the top to change the distribution‚Äôs settings. Scrolling down, there‚Äôs an item called <code class=\"language-text\">Supported HTTP Versions</code>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5246325f1e672822f3bab327f1bf4566/0c69d/cloudfront3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 12.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAgElEQVR42m1O0QrCMAzc//+iY0qXKjZZHybrbGl7pkVhqAchueMuyYA3Ss4opeCIWmuvz9y7er59RwzjeALRjJkI1lqcpwnO3RFCwMUYGNWZGXS9QdhBRMDC2ML2c7wvjDEipdSvZv2y8dabxhqWZcFjXeG9h1e+788WV3/9++EL7pvpWv+Z2GQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Supported HTTP Versions\" title=\"\" src=\"/static/5246325f1e672822f3bab327f1bf4566/0c69d/cloudfront3.png\" srcset=\"/static/5246325f1e672822f3bab327f1bf4566/69538/cloudfront3.png 160w,\n/static/5246325f1e672822f3bab327f1bf4566/72799/cloudfront3.png 320w,\n/static/5246325f1e672822f3bab327f1bf4566/0c69d/cloudfront3.png 598w\" sizes=\"(max-width: 598px) 100vw, 598px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Now just select the first item <code class=\"language-text\">HTTP/2, HTTP/1.1, HTTP/1.0</code>.</p>\n<h2 id=\"using-http2-in-elastic-beanstalk\" style=\"position:relative;\">Using HTTP/2 in Elastic Beanstalk<a href=\"#using-http2-in-elastic-beanstalk\" aria-label=\"using http2 in elastic beanstalk permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Elastic Beanstalk is a service that can easily deploy or control familiar web applications or services like Web servers or Workers. When creating environments in Elastic Beanstalk, if you set the language or server engine to use, you can copy that configuration to other environments, and troublesome tasks like Auto Scaling or Load Balancing that need annoying settings are done automatically by just touching a few simple settings, so it‚Äôs honey.</p>\n<p>Also, if you create a <code class=\"language-text\">.ebextensions</code> directory in the project root and put shell script files inside, you can execute those scripts every deployment according to file sort order, making it very flexible. <small><del>(Very useful when node-sass causes trouble and needs rebuilding)</del></small></p>\n<p>When creating environments, you can choose one load balancer between Classic Load Balancer and Application Load Balancer - Classic Load Balancer means the existing ELB. If you want to use HTTP/2 in Elastic Beanstalk, choose Application Load Balancer. Of course there‚Äôs a method of choosing ELB and setting it up directly, but I didn‚Äôt choose the difficult path on purpose.</p>\n<h3 id=\"what-is-application-load-balancer\" style=\"position:relative;\">What is Application Load Balancer?<a href=\"#what-is-application-load-balancer\" aria-label=\"what is application load balancer permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>AWS announced <a href=\"https://aws.amazon.com/ko/blogs/korea/new-aws-application-load-balancer/\" target=\"_blank\" rel=\"nofollow\">Application Load Balancer (ALB)</a> operating at L7 (Application) layer in 2016.</p>\n<p>The existing load balancer Elastic Load Balancer (ELB) operates at L4 (Network) layer, so it couldn‚Äôt recognize protocols used in Application Layer like HTTP or HTTPS and couldn‚Äôt flexibly handle them accordingly, but since ALB operates at Application layer, the advantage is it can directly examine HTTP headers and do flexible load distribution accordingly.</p>\n<p>For example, even sending requests to the same host, flexible routing is possible like sending to server a if sending requests to <code class=\"language-text\">/a</code> path, sending to server b if sending requests to <code class=\"language-text\">/b</code> path.</p>\n<p>But what‚Äôs best of all, as I explained above, is that it natively supports <code class=\"language-text\">HTTP/2</code> protocol and <code class=\"language-text\">WebSocket</code>. If you want to use HTTP/2 protocol in environments that were using existing ELB, i.e. Classic Load Balancer, you must set it up directly or migrate to ALB.</p>\n<p>But even migrating load balancers doesn‚Äôt automatically connect with instances connected to existing ELB, so if you‚Äôre using Elastic Beanstalk, just recreating the environment is good for mental health. <small><del>(Person who was disappointed after trying to go easy at first)</del></small></p>\n<h3 id=\"configuration\" style=\"position:relative;\">Configuration<a href=\"#configuration\" aria-label=\"configuration permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>First, access Elastic Beanstalk environment and create a new environment.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/2c4c368507f2816bfd6aea8f30a79582/ad12c/eb1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdUlEQVR42p1UyVLbQBDVP5HAjQSuWciv5pLKJbkEMCaEhNiSLVu2FmvxItuSF8laX7rHyAUGLumqV7Oo5/Xrnh5JR6dnODr9hMOTM7x++xEHx+/x6s0HMa/AewfH74TfPg5Ptj58nteS0mpBlhW02ir6ugFVVXFdr6N2cU7jFeq1Gv78vkWn3YbaJt9GA4oso0mjTKPW60E3THQ1TfBIWrcrSHq6DrunYVL/AeP6ElrtAr2rS/SvahjLDfhKE9bN9Xavdk77hO9fMVBkON4QpmGg0+lAKssSAgCyMEDq2GArww4QtICwLeZFsEU5a6BIV1v/yQjFdIycVkWeCR4pjmNsNhskWY546iNu/kLkakj1BhL9L1JDRmYqyKwWcltFaVMAz0Lpj5CoTcSTCVIiT7ICm7SAZJDUCnpfx9DWcNf5DJtKYGk9GJSGQ7W16dtyOkUexShJBJIIi3mArruAPl7DnEToeqttyjuj6TpZ4M76BtfzYNk2DMuCOxzCdh04rgt/Otu5Z3mOXcnuIWHP1psQt/0vsJlMqO7DcRzoep/WOlarFdI0Eb75PeFDe0xI36LNCpr3E77vYzQawSOlPOcATOySyvF4vFWYZft6HtwygSMyiqLAfD5HGIYCPN9Xwus0TQVpdY7xLCE7WVS76rJY1ZQuZLlcPiJm34cBnqTMyhhMqNMtm6YpiHnU6CXwXpIkO/8gCETAwWAgSsKQnkuD+3I2m4lU+dCEeo0VMqIoEkoZvOa6MhEH5vmTW67Sf2nNNqQ2Eh1Aivm5teh/wBkoCr1ljviSVUT7hJVxJlwOJueRA0nr9Rr/Y1waJuDWqlqMCf8BnQCWST/aBEoAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Creating Elastic Beanstalk environment\" title=\"\" src=\"/static/2c4c368507f2816bfd6aea8f30a79582/6af66/eb1.png\" srcset=\"/static/2c4c368507f2816bfd6aea8f30a79582/69538/eb1.png 160w,\n/static/2c4c368507f2816bfd6aea8f30a79582/72799/eb1.png 320w,\n/static/2c4c368507f2816bfd6aea8f30a79582/6af66/eb1.png 640w,\n/static/2c4c368507f2816bfd6aea8f30a79582/ad12c/eb1.png 856w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After that, selecting <code class=\"language-text\">Web server environment</code> moves to a screen where you can do simple settings like environment name or language to use.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 518px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ce0af85cf4b6cc034de1f43536f7c668/6b9fd/eb2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJElEQVR42p1Uaa+bQAx8//9PtVK/tVLvg1cSBXISwrEXEM6pbUJe2qRN1EijZWF37PHYeXLOYrfbwRiNumngnIOzFlobFIWjVdFa4NHf07GqkCQHWOvQti3SNMF+v0cURbSOSNNUAjFxWZYvz0VJ9yy6rnsh/DOCLWpkykGZArl2yGlVtpR3mS6gbUXfaK9H0puEwzCcX6SqRLjaIlhuEIRr+LMFtlFCxG4McEKUGFxcu5Xh+PXZX+DV6zd4++4DPn35hvcfP+Prdw/ezxm8Z1/WH54Pf768XcPLTd8PsK5EsJhLDYe+Fzlt29DaUka9gFNrmu5ehqcaEuEyDBEEgSBJMzHKkhFj0DFIVbePSVbaYjabwfdJnudJpkpppFkmbjNaIjzeJxwp+eDhEEtrGGOg8hyaCLldJnT/IgyCEJv1RjIpy4qkVdKHaZIgo6yyPJMMu64XuZPkvxJOh3opOKQ2q9VyNOXUUj2BSS7xkGR2uTo2WK9XIpcD8fQw/ouwrmsibGm2t+RuenZVsjxJncCBp2BN056H46ptNE1EGAaYz+fIyRDnCqklZ8x1ZDImdzTHcXxAnqXYx7E4f5PQ2EL6j9smoH40xpLrdFGp37IUyfcmhbPmgzG5zEM/GcZyhivJrZjFzTZcUF/V0NCkRPsDDmmO8lijrGoJUtOoXaKqu3P3DueEhhuSqVZZlssfrCKZPBnjXsuezVL0PO0ZXGsGN/0vveJ2udRNtk4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Elastic Beanstalk Platform settings\" title=\"\" src=\"/static/ce0af85cf4b6cc034de1f43536f7c668/6b9fd/eb2.png\" srcset=\"/static/ce0af85cf4b6cc034de1f43536f7c668/69538/eb2.png 160w,\n/static/ce0af85cf4b6cc034de1f43536f7c668/72799/eb2.png 320w,\n/static/ce0af85cf4b6cc034de1f43536f7c668/6b9fd/eb2.png 518w\" sizes=\"(max-width: 518px) 100vw, 518px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Elastic Beanstalk provides various languages, so pick and choose to taste. After doing basic settings like this and clicking <code class=\"language-text\">Configure more options</code> at the bottom, you can move to a screen where you can do more detailed settings.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c58be6012821f6a5d25c879335789b05/302a4/eb3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.624999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVR42q2QzWrCUBSEfcTiVoqvpBRKUFz4DgUXre6Emmhs1IRKSDGEQDUgUfAnN73386ZZCbUrBz7mrIY5U+HOqtw9UEpJgdIUUrlAHQ+QnUrOBUd9n+GkXWR/Bimlrhtm4ocozdlFMcnSxTPf+bRG+NMxvj3GNUesZxaN7pDqs8ejMadmLKi3XB6aDgNvex0ockmcCvbfG9JgyZcOCiYmoTP9xbctkoXNy+sHT28hncEKo7+irb3RC5hH+xsbFtWV5MZfJf9seAGDucj3Hwwz8wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Configure more option\" title=\"\" src=\"/static/c58be6012821f6a5d25c879335789b05/6af66/eb3.png\" srcset=\"/static/c58be6012821f6a5d25c879335789b05/69538/eb3.png 160w,\n/static/c58be6012821f6a5d25c879335789b05/72799/eb3.png 320w,\n/static/c58be6012821f6a5d25c879335789b05/6af66/eb3.png 640w,\n/static/c58be6012821f6a5d25c879335789b05/d9199/eb3.png 960w,\n/static/c58be6012821f6a5d25c879335789b05/302a4/eb3.png 1080w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>If your hand slips and you click <code class=\"language-text\">Create environment</code>, you‚Äôll waste about 10 minutes while the environment is being created, so click with eyes wide open.</p>\n<p>If you clicked properly, you‚Äôll move to the detail settings screen. Checking <code class=\"language-text\">Configuration presets</code> at the top, probably <code class=\"language-text\">Low cost</code> is selected as the default value. In this option you can‚Äôt use load balancers, so we need to select <code class=\"language-text\">Custom configuration</code>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b3ef6724a1eb0a47401fbd6ffdac9c27/27b8e/eb4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABO0lEQVR42o1Ry3KCQBDk//8rFzl40VJEQAXR+AJU3o+O3amlTA6pbFUzOzs9vUOv1fc9fN/HarXCfD7HbDZDEATwPA+O44xg7rqu6rZtKx4OByyXS0WzrGEYcDweJbrb7TCdTiW82WwQhqFECO4nk4mEKWLOeBn7R0F+rtcrLpeLkKap4vl8xul0QpIk2pPDfZZlAs8YTZ1cTirB+/2O5/OJPM8VSTRnxO1200WPx2MEc8M3XPZJkD6+k4miKEYibem6DlVVoSxL1UwkzDDkSbBpGnmzWCz0OAT9pD/b7VZi2UucnsVxLH/p+X6/V04/oygSz8K/1oCqLBC+mugXm3kRJ1P1NdmPRzGHv9H3g8TcT+DDKRCHPjw/GKfiX63Xa1lhNKy/5/peeQ0keY+ubVDXNdq2Hf1k/j7hF1cmq2XFWr3rAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Configuration presets\" title=\"\" src=\"/static/b3ef6724a1eb0a47401fbd6ffdac9c27/6af66/eb4.png\" srcset=\"/static/b3ef6724a1eb0a47401fbd6ffdac9c27/69538/eb4.png 160w,\n/static/b3ef6724a1eb0a47401fbd6ffdac9c27/72799/eb4.png 320w,\n/static/b3ef6724a1eb0a47401fbd6ffdac9c27/6af66/eb4.png 640w,\n/static/b3ef6724a1eb0a47401fbd6ffdac9c27/27b8e/eb4.png 836w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Selecting the <code class=\"language-text\">Custom configuration</code> option, the <code class=\"language-text\">Modify</code> button on the Load balancer card at the bottom should be activated. Clicking that button, finally a screen appears where you can select a load balancer.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1a3b213065692e5e6e9300b99e424245/d2782/eb5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrElEQVR42o1Ue0/CMBzs9/9c/mmMxoARwQljbOzhXt37cfaqxQrE0OTyW9txvbv+hgjDENvtFp7nYb/fw3Vd+L6PcRwxz/MJ18a1PZE3PeKyUWiRyBZhXiNtBsgBqBSydkZSjfqAruvQ9z3attXzc+JpmiD8VOJh+Ybntw88vb7j8WWDjRfCCRI4foxtLBFWilxK7YQO6IbOiqJAWZYnlayCipbvLnZhBu+zxEEdsE9KuHGu1yLZKZUT5ulXhalUyWorFaV6uVAo+1nblMOMopv1nMjVXl6rPH+IbNJzy5qQuaRpijzPEccxsiz7Y4FE0zTi1iEYsM4kipAkiSZnNiRmPua2byYcBnWjKnBWo8rkY8gmy+55u1y0DduAtom6rnVLXOu3mxXS2uFwQKQss6FZm6a5AA8j7Pn5O3QpmBd7iiAZL+Z4PCIIAl3NM/d5IOd85hp/S2JGJqtauxTMibbJboNrdhwmU7PPXEnMz5UOX18WSkz0rdBxHH26Ubnb7bBarfQa63q9PimzodfoQOHufgHPDyB4EpXYwRt1//0x2GNUX9G9I5FVPb4A9Co8/w8ketwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Load balancer selection screen\" title=\"\" src=\"/static/1a3b213065692e5e6e9300b99e424245/6af66/eb5.png\" srcset=\"/static/1a3b213065692e5e6e9300b99e424245/69538/eb5.png 160w,\n/static/1a3b213065692e5e6e9300b99e424245/72799/eb5.png 320w,\n/static/1a3b213065692e5e6e9300b99e424245/6af66/eb5.png 640w,\n/static/1a3b213065692e5e6e9300b99e424245/d9199/eb5.png 960w,\n/static/1a3b213065692e5e6e9300b99e424245/21b4d/eb5.png 1280w,\n/static/1a3b213065692e5e6e9300b99e424245/d2782/eb5.png 1864w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>All 3 look delicious but you can only eat one at a time, so don‚Äôt be greedy and select Application Load Balancer. And scrolling down a bit, you‚Äôll see load balancer setting menus.</p>\n<p>Among these, we need to create a <code class=\"language-text\">Listener</code>. You can think of ALB‚Äôs listener as a process that confirms requests using configured protocols or ports. Since default settings only have a listener for requests coming to port 80 using HTTP protocol, we just need to make a listener for requests coming to port 443 using HTTPS protocol.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/2447dd384b41d2fe99a736d917073cae/3a1b1/eb6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVR42p1Sy07CUBDlV12TmJC4UNC9gARYiFIgwY1LkMcvuFJCXLlQEzUQEyhBWqCE9vZ4Z2RK8REfNzmZmfs4c2bmRqLRKLLZLFKpFNLpNJLJZGAzmQxyuRwjn89/CzovFAqIx+OINBoN0JrNZlgsFpjP53Ach2PP8/CbpZRi2+12EWk2mxzQY9d1Yds2k5FPkP2vYvGXyyVzdDodTdhqBYSkjBROp1P2JfOfFDZCComI1I3HY4xGI1iWxTHty5lA4nBiJrxY9ZAORLpawfsA5fucWEBEgoCwVqtxmf1+H71eD44ejD94gXq8g//8sMbTPTzb0qSb5fqrJAFha9XDV10mwaYS6mdQhztQuQOo7L5GAupoF87tDZbvLD9Pmb6MaZrcG1c/oIcb0HsL3RJSRARiCTTpgLDdbnMg4yc70UrNwYAxMocwh0P2J5MJD4JaFB6QZdlwddlX1521QiKjbNQP+eDyyQV0JzwUGcyGwlboH/5nTXU/xjMX510HxfolIrFYDNVqFcViEYZhoFQqsRVfUC6XUalUPuHUKOP4xMDWXh5b2wm8ARletbTJSXtIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Load balancer listener creation screen\" title=\"\" src=\"/static/2447dd384b41d2fe99a736d917073cae/6af66/eb6.png\" srcset=\"/static/2447dd384b41d2fe99a736d917073cae/69538/eb6.png 160w,\n/static/2447dd384b41d2fe99a736d917073cae/72799/eb6.png 320w,\n/static/2447dd384b41d2fe99a736d917073cae/6af66/eb6.png 640w,\n/static/2447dd384b41d2fe99a736d917073cae/d9199/eb6.png 960w,\n/static/2447dd384b41d2fe99a736d917073cae/21b4d/eb6.png 1280w,\n/static/2447dd384b41d2fe99a736d917073cae/3a1b1/eb6.png 1686w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>If you created a listener, click the <code class=\"language-text\">Save</code> button at the bottom to save load balancer settings, configure other settings to taste, then click <code class=\"language-text\">Create environment</code> and finally the environment starts going up. By the way, it takes quite a while.</p>\n<h3 id=\"didnt-do-separate-server-settings\" style=\"position:relative;\">Didn‚Äôt do separate server settings?<a href=\"#didnt-do-separate-server-settings\" aria-label=\"didnt do separate server settings permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>You don‚Äôt need to. If ALB has an HTTPS listener, this listener handles it automatically. If the browser is a browser that supports HTTP/2, the listener will also respond with HTTP/2, and if it‚Äôs a browser that only supports HTTP/1.1 <small><del>Internet Explorer</del></small>, the listener will also respond with HTTP/1.1 protocol.</p>\n<p>And even if the HTTPS listener receives HTTP/2 requests, it communicates with instances connected to the load balancer using respective HTTP/1.1 protocols, so on the server you just handle HTTP/1.1 as usual.</p>\n<p>For details, read <a href=\"https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#http-connections\" target=\"_blank\" rel=\"nofollow\">HTTP Connections in the Elastic Load Balancing User Guide</a>.</p>\n<h2 id=\"http2-did-it-apply-well\" style=\"position:relative;\">HTTP/2, Did It Apply Well?<a href=\"#http2-did-it-apply-well\" aria-label=\"http2 did it apply well permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>If you created an environment, that‚Äôs the end. The simplest way to test is using <code class=\"language-text\">curl</code>. You can request the environment you created or just poke anywhere. More services than you think use HTTP/2.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">--http2</span> <span class=\"token parameter variable\">-I</span> https://www.naver.com/\n\nHTTP/2 <span class=\"token number\">200</span>\nserver: NWS\ndate: Thu, <span class=\"token number\">13</span> Jun <span class=\"token number\">2019</span> <span class=\"token number\">14</span>:59:09 GMT\ncontent-type: text/html<span class=\"token punctuation\">;</span> <span class=\"token assign-left variable\">charset</span><span class=\"token operator\">=</span>UTF-8\ncache-control: no-cache, no-store, must-revalidate\npragma: no-cache</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you use Chrome browser, there‚Äôs also the method of installing the <a href=\"https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin?utm_source=chrome-ntp-icon\" target=\"_blank\" rel=\"nofollow\">HTTP/2 and SPDY indicator Chrome extension</a>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 98px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ea713cc7adcbac869f0ddc1c27f52939/a4837/http2-plugin.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 96.93877551020407%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVR42q2TsW7bMBCGOfUVOmTs1FcoMsSGPbW2swbJ2AxFMgdeMmVwAqSFDXSIA8Qo4MKWbImSKEs2EmTOY/25o3I2rSpDAQ8fRIrkf/8dj6rZbGKXqEajgV2idu5w54K1Wg1V1Ot1izuuonxOdTodlGm32/+FnPnWakHFcQwmiiJorddszyOEoSZCSxAEa+yciGn/U5ZDLRYLZFmGPM8hYyFNUxiT0v+E1mMkiSESy9pIHCFPF/jre/hxfQXFTpj5fI7BYIDxeGzn4kbrANNpSGuGHPmYzWZ274zwfB8RZTCl7+fTY3z4ug/Fh1hgOByi1+uh3++/CWkS0FguA1xcPOLg4IXcBltpTz0PS3J3OfiJvZNDnP2+LRwaYzAajdDtdq1LTqVIzWC1SnB3t8LNzRONjS0Bl4LXgyBETmX6403w8aiFT6dHUO5FTCYTG3nzr3ATx5pEikwkmHmrJbOiy/j1cI8v59+hfH9TFxaRlORwGam52wkhBc7I+XO+3FyKiLmiLm6ruC3D+zlQIayhuH6pMbaOjKThjrfaxDFQ7lceKznsUvSfwXtNX4UEUlUpbr0C+nJ9be9RrQWey75/BN0oblrvUeVQzCh3o4hJquUSMPw83XmZV3Oj5CsAxn8kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"HTTP/2 and SPDY indicator\" title=\"\" src=\"/static/ea713cc7adcbac869f0ddc1c27f52939/a4837/http2-plugin.png\" srcset=\"/static/ea713cc7adcbac869f0ddc1c27f52939/a4837/http2-plugin.png 98w\" sizes=\"(max-width: 98px) 100vw, 98px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>This cute icon will tell you whether HTTP/2 or SPDY protocol is being used. But I don‚Äôt think I‚Äôve seen anywhere besides Google use SPDY yet‚Ä¶?</p>\n<p>Or you can activate the <code class=\"language-text\">Protocol</code> column by right-clicking on the table head in Chrome browser‚Äôs developer tools <code class=\"language-text\">Network</code> tab.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 362px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b4034d3ba3d49737892b8eeb0dc3101d/10600/network.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFQ0lEQVR42nWV2U8bVxTG5/+oEohtzGKMWQwYYkiIjfeNkiZNorYPbV/aNFUWKgFJCgYHbLPEhtiAN8A7pmmz0EppCk1e+md9/c4EpEhVHz7dc2fm/uY759w7o3zi/wrnnFfRZJtEk9mK1r5RaHotMHQYoW/RQavToaW1FbqWFugYi1r+JxYp50a9aBq8DE33AJrbjWhvM0Fn7IRB3wq9Vgut9r+LRFre+xio0WhUKYZOIzrb22Fs06OjowOmdgOMpi6YDB3qg61018b7rW1t6lxieU6v16uws7Grqws9PT1QjD3d6GRg7O2FUUaqgzcHhoYQmZ7B9J0fMfX9bUz9cAfzs7OIL0WxEo0jPBfGo0ePMTc3jwdTU3B6fQhevQbFRbqHcsqoa4GXo+PCBdwc7Mffu2nsRx6jEPkZh5tr+OdFDe9/reCEOmb8J3X8uoFGrQB7dzeGJWWBuakAJXAbUwhqmuExDeDGVAnfzdfx9WwJ9+NH+PbJ7/hi/jW+XHiNW9SN8CvcXPwDn87WMWLswYhOC0WcuVgbHyWxnUAPgeNdFljvvsWNxXf4Jv4etyInsP50AvPdY/TfO0Yf1XvvL/TdfwfT7ZewGHpxUYAegrwids3NMUC5m5txzdyHk9wW8nOPsT71AJuPZvG2vIs31T0cVffxorKLXzj/rV5Ens85TCZYJeVJuhJNUD6681MB3rje3483mSzyCwvYnp9HPhZFY3sb5a0tlDIZ1Pb3UdrbQ7VcRmpnB+Ns5iXZhy46c1J2QvyUQ+KmJgT6+nCUTiNLWCYcRm55GRscVzlPRKMqsKwCS0jzRZe4MyxspuKQmlHuU3eiK4TeMptRj8eQjyxii1vjaHcXR8UiXpRKOOSoAilxmD51OCIOx6VuBATpLiQuOffT4efcl9XVVWQXF/F0Zga5WAyvCHhONagaoQKsnKYsNRwVh58JkPXzU0EZZdvwxjXW8GU2i52lJaw+fIgka/mcKYq7A6pKlT5yOMaUh9lMxUJI/6kGKDOPWj+BNgIbLH6CDjdZv9XwApbn5rDHxQeVCiolOhQw4zQbZb9ohbXPDEVDR9pTqTGB55l6/8AA0mtriBKSSSbRkMV0WGMNa3RV4ViSa9UqUs+eweXzw+0PQWnjoRe1n4mHXz5VFgJT62tYZ0fX6bBBSJ2qlcpqmlK7UrFEhwSmUnC63Bh3uAikK1ErIaJ2xno6tDDlcqGARCyOKOuX4aLnBwc4rNVQk5TPgNUPQLvDiSs2B0/K6T6cJERiOTET58/hOk+KpLexsoqVJ0uIRZ4gwa4n19exV9hFjaAzh+mdDMbZ5RE5KV5vAD5fAH5/EC6XBx6Pj/MgQqEJ1JleiYtFe/kCdnN55LM5AgvYZz2L7HKRdUyyxk46tNvFIUG2cdrlxO5007pLnfuDIRwwvbX4CmLL/AYy9Q0ufEqHEXY+kUigwtSz3FrLrLGHTZH1itvrh9PtxeUxG0cf5AUuugxNTKJeqyPxNIFoNIYYgblcDvV6HWU6L+4XVXcZbq0oG+fyeFUjyqDFgkHLEAYGLRgavgjL0DDM7LB93IEagVmmKAsbjUNVB2yMXK/RvTSkyDqLWwE6WDJFYAaDASZTN4xG/ktYXIOhE1brCLa3dxBeWERyYxP7dJRKpbHDL9AWrwskmdxAPB7HzPQ0s/PAQSluNkRSPpOLaXu5QW10OHbFzjgIKYuk08kf2uilMQzzVFzgMZOflvyktFqNmp30QRGbKoh1czKW0eH8MApYrgVZT4GK5CXWkVH1TyeHQA5FC8FjNjt8gRD+BcIaJTG18gx0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Activating Protocol column in Network tab\" title=\"\" src=\"/static/b4034d3ba3d49737892b8eeb0dc3101d/10600/network.png\" srcset=\"/static/b4034d3ba3d49737892b8eeb0dc3101d/69538/network.png 160w,\n/static/b4034d3ba3d49737892b8eeb0dc3101d/72799/network.png 320w,\n/static/b4034d3ba3d49737892b8eeb0dc3101d/10600/network.png 362w\" sizes=\"(max-width: 362px) 100vw, 362px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Then resources received by communicating with HTTP/2 protocol in the network tab are marked as <code class=\"language-text\">h2</code>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 165px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/64a2efd14eb3ccf3c692e6d32ed99f81/04c57/http2-check.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVR42oWRa0vDMBiF808a2ia9pde13brZ2d2cojKGIvgLREFhgozJmOi++K+PSWAw3NAPDyFv3pyc84Z4ngff9zUOd8A5/xfXdfXKGIdpmggCofeO44CMJlMs159YvL2j7jeghiEbGWzbPkDVKaWoeid4Xa7x+LzAw9MLbu7uoXS6vRokTTP0mwEGwzFEGOoXj4ntsCwLgRDoVF1Mpue4ms0RRTHyopApA5AwjNDKC2RZS1oPtG0V6S+EFEzSVAtTaoBL54zZ8i4Hubi8xmb7jdXmC6PxGZh0oeapZvsbVVfn9WmD1ccWs/mtnt3uD1QPSZIEZdlGu1MhlJGVg2Ni+6gkeVEijpOD/h++CLzRmVvtPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Protocol column appearance in Network tab\" title=\"\" src=\"/static/64a2efd14eb3ccf3c692e6d32ed99f81/04c57/http2-check.png\" srcset=\"/static/64a2efd14eb3ccf3c692e6d32ed99f81/69538/http2-check.png 160w,\n/static/64a2efd14eb3ccf3c692e6d32ed99f81/04c57/http2-check.png 165w\" sizes=\"(max-width: 165px) 100vw, 165px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<h2 id=\"lets-compare-with-waterfall\" style=\"position:relative;\">Let‚Äôs Compare with Waterfall<a href=\"#lets-compare-with-waterfall\" aria-label=\"lets compare with waterfall permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Left is <code class=\"language-text\">HTTP/1.1</code>, right is <code class=\"language-text\">HTTP/2</code>. The red line on the HTTP/2 side is an image request error, but it‚Äôs a 403 error occurring due to resource origin issues in the staging environment, so you can ignore it.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/10f6fcafbe60f0c9d6f5291aabf79d51/9cab2/result.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 183.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAABYlAAAWJQFJUiTwAAAGhklEQVR42oWWy3Pb1hXG/ad305lsmukuXbgzTTtdtEnaNI2sie1YsSXVlmSRlPgm8SIJEiAA4o0LgHp8/e4FJUtyZrLAXIo8+t3z+M45eGaaJnTdgGla6Pf7eP3za5ycnMAwDH6vQ9M0zGYzLBYL9Z1lzZTdwcEBzs7OIP9ffm8YujqfxUmCpb3AxvcQBhGcpQPP9RCHMaJNhE0QI8syJEkK254/svPXPu0i/h0i3CS0SfBMiAqTaQ9RtEJdXaGqKlRl85SiRBLXuL6+5ucKI62LKHawraVdqWzLskSRC6RJjdvbGwksMZn0CXT4Y4U8z2lQKFhRFLy1aoD8bTztIwwdgmr1mxBCPVlWIE0r3NxcN0BNHyFOPZTSUBTKWN38CFhiqtEu9pRnCsjvBO2zLFd29x5q0yGiYIk8SpDFMfJCGkpvBQENUP6tTQkMA8KvUcQZnxwiKwmsCNx+Aup6D4F2jsQaIt/YvDmiFxEhGxpmBN4QUmCqn8IdvUZsHiGxT5G758iTIYET2vkEQgIz6OYBQ36H7fYMZc2n/IC6PuF5zNxoBEIBR1obYWygLleMYglROUzRisAFgRGBtxIomJsuwsRiZUOG6TM/MqwNT1/Jpakyi2dMMOjMEPmyGDVEUavzs5DH4xbsWRdF5hHCWwuXwLX6LG+WIcuLNWuCk3cdjM4t/i52lf6sKEIBZ0YPebqmh656hJCfHRalATYeDjG+HCP0EyWvh7K5B5YiZ7J/gb16wxBaNDhXT1W16MUpDQ0Cb++Bc7ZjXW9pW/w6sCgEjNkY2miEwI2Y5Iy3ZyoUecZxeZ9DYzFFr9PHpDNnUQijHgU7JqPMkrT+BNStMSyKO3Q3Sth34chTAdkBQl6s9dA97eDwxQUWfRN1tIHwfcpnjTTImipLoMZQ/MDGyloryK8CKXJtconeWQf/e3mJtW6j3gQQnofccZH6KW5x21R5qg+RFB60jonxxxkcM1CJl1W8C1kUTcjddhfvf7qEbXkMVajQc/Eg5KaXh4jzNTw7gDW0kaXZYw93QN0aodfq4ni/g/5HjUMkV0+WZE96mSFHKbVXV1joMxYnYCWrByFTh6ykcXaI3uEHvH/dZdjsmtM26l4X+XkbqblkwNj1sslezJgPcaV61xo7yNn0opQdUH/ykGrotnsqh6cHXcQcqlVF2aQPhS2rbHaQFjql4dMzD+6cE9xboqrXHLBx4yGLYow66NGrY+bw/C09s1eoXF6+WCL1kk9F0YxLJPmMQuaEYf/maQTfcehx0PSyAjLkQQv9k5YCdo/6qG0b1XKJwpojpYYbYCGBYwJ9ArbNLOTg3PDGPBNNyBJIsPXyB/R/eoOjN0N0/3uE8pt/od57ger7/yBvD3Cjclg0VU6yNaS3TZdwR3CAxmGiRrsCcvha//gag+/3cPR2guG3r1D/4UuUX/0J5Zd/RPbmeAfcVTnhpGmmNEXNSZKEKbcegVlTFLmINCWbHnV4gdbhAJa2gmyMR70sPVTCzh8ARVO5YB0pwd5VWTMZ6vkl3rPK7191ML0wOUPFEx0q4OAeWBT5/ZLa+NH9krqTjRT2h1eXLEwLk66Fels9kY0KeURhy4Ha5PAubGfBFtwItR7vdXjexRE75d3eR+iDOaVVMs/55yHHT4Alx5Lvhnxy3NCwAXIFXHQxauvQR3OVY7lSH0/soilKnD0BlvJtIOOrSEEPb9T4kivA0saw9TXzG6scy3Cznbx+E5hEKQK/2HnIjpoNORP7sC6H8FZrrPmk3Dl5HhMofiNkCYwJ9PLGQ64KbXGMqDjBYn6G5fwt1st32IQfkdcXbF0H5DXAiTb4DHg3vnwCpbBLjjT9aB/Fhx+RHbxE++AYHfa1ubcP77tvkAxGu2kjk80qx4mrxNsAM7WE5Om7fHPgaC+5/fS950i//T3E119gfPgKo8FbhPvPUf3td0hPf2k6pVkBo10vy5cl7ltKqZQLiFpMooJAhsypo7/4J7J//wX5X59j/MM+uhdjBC9+RP33PyM7azXA7faaiV8gXg9RbPiKwd2S+XMUoYuE54Y7o6kyi6exo0IPGyfArKdhtfAQOCH/N0IalU1R5BJPU95uDrBwDNiujpkzhb3m6/Cyj4W3YLJvVQqmZlvNze01h3HtIFgZcI0ZXNPgDvKbHMq2utpeMUTu2bpQTynPLQuzLVBfNa1X8611udTgLnv02uS81HjKdWHAcyhyP6C8bvF/+fnTvqnZQYkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"\" src=\"/static/10f6fcafbe60f0c9d6f5291aabf79d51/6af66/result.png\" srcset=\"/static/10f6fcafbe60f0c9d6f5291aabf79d51/69538/result.png 160w,\n/static/10f6fcafbe60f0c9d6f5291aabf79d51/72799/result.png 320w,\n/static/10f6fcafbe60f0c9d6f5291aabf79d51/6af66/result.png 640w,\n/static/10f6fcafbe60f0c9d6f5291aabf79d51/9cab2/result.png 864w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>You can confirm that the HTTP/2 side‚Äôs Waterfall is processing a considerable number of requests simultaneously. Using HTTP/2‚Äôs characteristics like this, you can reduce file capacity by chunking JavaScript files that were being bundled into one into multiple pieces, or shorten loading speed a bit more by receiving images that were being used as sprites simultaneously through individual requests.</p>\n<p>That‚Äôs all for this post on simply applying HTTP/2 with AWS.</p>","fields":{"slug":"20190613-http2-with-aws-en","path":"/2019/06/13/http2-with-aws/en/","lang":"en"},"frontmatter":{"title":"Simply Applying HTTP/2 with AWS","subTitle":"Advantages of HTTP/2 and How to Easily Enable It on AWS","date":"Jun 13, 2019","categories":["Programming","Network"],"tags":["Amazon Web Service","AWS","HTTP","HTTP/2","HTTP2","Network","ALB","Application Load Balancer","ELB","Elastic Load Balancer","Cloud Front","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/be9e83d603d0e671bc285680c3aa165f/d803c/aws.png","srcSet":"/static/be9e83d603d0e671bc285680c3aa165f/d803c/aws.png 320w,\n/static/be9e83d603d0e671bc285680c3aa165f/2a1fd/aws.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/be9e83d603d0e671bc285680c3aa165f/fc5c5/aws.webp 320w,\n/static/be9e83d603d0e671bc285680c3aa165f/e9225/aws.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/be9e83d603d0e671bc285680c3aa165f/01fb2/aws.png","srcSet":"/static/be9e83d603d0e671bc285680c3aa165f/01fb2/aws.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/be9e83d603d0e671bc285680c3aa165f/b384d/aws.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"category":"Network","lang":"en"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}