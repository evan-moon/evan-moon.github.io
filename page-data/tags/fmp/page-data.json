{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/fmp/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"97f54ac6-9589-5faa-b2f2-5e105e19bc0c","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%B5%9C%EC%A0%81%ED%99%94%EB%A5%BC-%EC%A7%84%ED%96%89%ED%95%98%EA%B2%8C-%EB%90%9C-%EC%9D%B4%EC%9C%A0\">최적화를 진행하게 된 이유?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90-%ED%8C%8C%EC%95%85\">문제점 파악</a></p>\n<ul>\n<li><a href=\"#text-%EC%95%95%EC%B6%95-%EB%AF%B8%EC%82%AC%EC%9A%A9\">Text 압축 미사용</a></li>\n<li><a href=\"#%EC%98%A4%ED%94%84%EC%8A%A4%ED%81%AC%EB%A6%B0-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A7%80%EC%97%B0%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A8\">오프스크린 이미지 지연이 필요함</a></li>\n<li><a href=\"#%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%ED%8E%98%EC%9D%B4%EB%A1%9C%EB%93%9C-%ED%81%AC%EA%B8%B0%EA%B0%80-%EB%84%88%EB%AC%B4-%ED%81%AC%EB%8B%A4\">네트워크 페이로드 크기가 너무 크다</a></li>\n<li><a href=\"#%EA%B8%B0%EB%B3%B8-%EC%8A%A4%EB%A0%88%EB%93%9C-%EC%9E%91%EC%97%85-%EC%B5%9C%EC%86%8C%ED%99%94-%ED%95%98%EA%B8%B0\">기본 스레드 작업 최소화 하기</a></li>\n<li><a href=\"#%EC%9B%B9%ED%8F%B0%ED%8A%B8%EA%B0%80-%EB%A1%9C%EB%93%9C%EB%90%98%EB%8A%94-%EB%8F%99%EC%95%88-%ED%85%8D%EC%8A%A4%ED%8A%B8%EA%B0%80-%EA%B3%84%EC%86%8D-%ED%91%9C%EC%8B%9C%EB%90%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">웹폰트가 로드되는 동안 텍스트가 계속 표시되는지 확인하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A1%B0%EC%B9%98\">조치</a></p>\n<ul>\n<li><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9\">이미지 지연 로딩</a></li>\n<li><a href=\"#%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9\">컴포넌트 지연 로딩</a></li>\n<li><a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%BB%A8%ED%85%90%EC%B8%A0-gzip-%EC%95%95%EC%B6%95-%EC%A0%81%EC%9A%A9\">텍스트 컨텐츠 gzip 압축 적용</a></li>\n<li><a href=\"#js\">JS</a></li>\n<li><a href=\"#css\">CSS</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EA%B3%BC\">결과</a></p>\n</li>\n</ul>","excerpt":"이번 포스팅에서는 필자의 현직장에서 진행했던 클라이언트 사이드 렌더링 최적화에 대해서 적어보려고 한다. 크롬 브라우저의 Audits 탭에서 현재 페이지의 퍼포먼스나 SEO 점수와 같은 지표를 확인해볼 수 있다. 이 지표는 Google Chrome 팀에서 제공하는 Lighthouse라는 툴을 사용하여 측정된다. 또한 측정된 지표를 JSON 포맷으로 Export하여 저장하고 Lighthouse의 Report Viewer 페이지에서 다시 확인해볼수도 있다. 아래 링크들을 살펴보면 Lighthouse에 대해서 더 잘 알 수 있을 것이다.","html":"<p>이번 포스팅에서는 필자의 현직장에서 진행했던 클라이언트 사이드 렌더링 최적화에 대해서 적어보려고 한다. 크롬 브라우저의 Audits 탭에서 현재 페이지의 퍼포먼스나 SEO 점수와 같은 지표를 확인해볼 수 있다.</p>\n<p>이 지표는 Google Chrome 팀에서 제공하는 Lighthouse라는 툴을 사용하여 측정된다. 또한 측정된 지표를 JSON 포맷으로 Export하여 저장하고 Lighthouse의 Report Viewer 페이지에서 다시 확인해볼수도 있다. 아래 링크들을 살펴보면 Lighthouse에 대해서 더 잘 알 수 있을 것이다.</p>\n<!-- more -->\n<hr>\n<p><a href=\"https://github.com/GoogleChrome/lighthouse\" target=\"_blank\" rel=\"nofollow\">Lighthouse Github 레파지토리</a><br />\n<a href=\"https://developers.google.com/web/tools/lighthouse/?hl=ko\" target=\"_blank\" rel=\"nofollow\">Google Devloper의 Lighthouse 문서</a><br />\n<a href=\"https://googlechrome.github.io/lighthouse/viewer/\" target=\"_blank\" rel=\"nofollow\">Lighthouse Report Viewer</a></p>\n<hr>\n<h2 id=\"최적화를-진행하게-된-이유\" style=\"position:relative;\">최적화를 진행하게 된 이유?<a href=\"#%EC%B5%9C%EC%A0%81%ED%99%94%EB%A5%BC-%EC%A7%84%ED%96%89%ED%95%98%EA%B2%8C-%EB%90%9C-%EC%9D%B4%EC%9C%A0\" aria-label=\"최적화를 진행하게 된 이유 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>필자는 회사에서 <a href=\"https://soomgo.com\" target=\"_blank\" rel=\"nofollow\"><strong>숨고</strong></a>라는 서비스를 개발하고 있다. 숨고에서는 1주 단위의 스프린트로 업무를 진행하고 있는데, 마침 이번 주에 다른 이슈에 의해 필자가 진행할 이슈가 병목에 걸려버려서 시간이 붕 떴다.그래서 뭘 할까 찾아보다가 숨고의 <a href=\"https://soomgo.com/search/pro\" target=\"_blank\" rel=\"nofollow\">고수 찾기</a> 페이지에서 Audits를 한번 돌렸는데 FMP(First Meaningful Paint) 항목이 거의 2초가 걸리는 것을 확인했다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/d30ee/result_before.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrElEQVR42pVSXY/TMBDM//9DPPEEh073gITUcgIdrURDmu/UcRLHn8Ouc4U2FXfHSCtvEnsm450EzzDB4W78gYdpv7wYaa0+Lr38Rv2H2H4an3A/7mJfFiXyPMclknNjrcWm2OF7fYCzHm2xR5s9YlIGXbZFk24QPLATx1iMNE1xOBwQQrgl9N7DzgZWGzjnMM8aip6NMXHl4j2OhL118UxRFLH4/Q3hDUhVDwPUJKEngX4cIJTE6XTCS0he+hhIOYRFnU156i//hq1e2n2VkKGDxVZl2Kg0Du41/JMwYFHOjcA7scH7/hGZOV19+2/LjEnP+Nzv8UX+hPFv/EOe6vouzujaDsdfGXIqsRrI+UQlgKZfxBJHl5zlR8xKxSwy+do6izlQrJyNe7iegxBxtw14+MpingjpQD0KNHWDtm0xTdOf6XFZEpB6QjNLlGWJuq4hpYzT/jvlgMHMMQWRsJQtEdYYx/HGMjsYjEKvBKqqQtd10Fpfxcf7QGf7GLGEdNANPXohojqTsqXznXoOOFn1moJNe4ZhWa+uhvZ4NXBwl6Gw4rrWQwp4G34DwP5Io3v8J0IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result before\" title=\"\" src=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/6af66/result_before.png\" srcset=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/69538/result_before.png 160w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/72799/result_before.png 320w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/6af66/result_before.png 640w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/d9199/result_before.png 960w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/d30ee/result_before.png 980w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>숨고의 고수 찾기 페이지를 분석한 결과</small>\n</center>\n<p>해당 페이지는 SEO 최적화 대상 페이지 중 하나이기 때문에 이 참에 FMP를 1초 아래까지 줄여보자라는 목표를 가지고 최적화를 진행하게 되었다.</p>\n<p>사실 해당 페이지는 이 작업 이전에도 동료들과 함께 여러 차례에 걸쳐 최적화 작업을 진행해왔기 때문에 페이지 자체의 로딩 속도는 나쁜 편은 아니다. 그러나 이전의 최적화는 클라이언트보다는 렌더 서버에 초점을 맞춰서 진행해왔기 때문에 클라이언트 렌더링의 병목 지점을 확인한 것은 사실 이번이 처음이다.</p>\n<h2 id=\"문제점-파악\" style=\"position:relative;\">문제점 파악<a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90-%ED%8C%8C%EC%95%85\" aria-label=\"문제점 파악 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>일단 Lighthouse에서 감사 결과로 지목했던 다양한 문제점 중 지금 당장 짧은 시간 안에 해결할 수 있는 문제들을 중심으로 파악했다. 애초에 이 이슈는 스프린트에 들어갔던 이슈가 아니라 우연히 시간이 남아서 하게 된 일이기 때문에 자칫 <a href=\"https://www.lesstif.com/pages/viewpage.action?pageId=29590364\" target=\"_blank\" rel=\"nofollow\">야크 털깎기</a>에 빠지거나 욕심을 부려서 너무 오랜 시간을 끌게되면 정작 중요한 비지니스 이슈를 처리하지 못하기 때문이다. 그 중 필자가 생각하기에 짧은 시간안에 우선 개선할 수 있는 부분은 다음과 같았다.</p>\n<h3 id=\"text-압축-미사용\" style=\"position:relative;\">Text 압축 미사용<a href=\"#text-%EC%95%95%EC%B6%95-%EB%AF%B8%EC%82%AC%EC%9A%A9\" aria-label=\"text 압축 미사용 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>보통 <code class=\"language-text\">text/html</code>이나 <code class=\"language-text\">application/javascript</code> 등 텍스트나 코드로 취급되는 리소스들은 gzip 압축을 사용한다. 하지만 현재 렌더 서버는 <code class=\"language-text\">text/html</code> 타입만 gzip 압축을 수행하고 있었다.</p>\n<h3 id=\"오프스크린-이미지-지연이-필요함\" style=\"position:relative;\">오프스크린 이미지 지연이 필요함<a href=\"#%EC%98%A4%ED%94%84%EC%8A%A4%ED%81%AC%EB%A6%B0-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A7%80%EC%97%B0%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A8\" aria-label=\"오프스크린 이미지 지연이 필요함 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>오프스크린 이미지란 코드 상에는 존재하지만 화면 밖에 있거나 CSS 스타일로 인해 감춰져 있는 등 실제로 유저에게는 보여지고 있지 않은 이미지를 의미한다. 이런 이미지는 당연히 지연 로딩(Lazy Loading)을 하는 것이 좋을 거라 생각했다.</p>\n<h3 id=\"네트워크-페이로드-크기가-너무-크다\" style=\"position:relative;\">네트워크 페이로드 크기가 너무 크다<a href=\"#%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%ED%8E%98%EC%9D%B4%EB%A1%9C%EB%93%9C-%ED%81%AC%EA%B8%B0%EA%B0%80-%EB%84%88%EB%AC%B4-%ED%81%AC%EB%8B%A4\" aria-label=\"네트워크 페이로드 크기가 너무 크다 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이 문제는 상기한 Text 압축 미사용과 관련있다. 말 그대로 리소스를 한번 요청했을 때 받아와야하는 데이터의 크기가 너무 크다는 것을 의미한다. 이 이슈는 gzip 압축과 Code Chunking 등으로 해결할 수 있다.</p>\n<h3 id=\"기본-스레드-작업-최소화-하기\" style=\"position:relative;\">기본 스레드 작업 최소화 하기<a href=\"#%EA%B8%B0%EB%B3%B8-%EC%8A%A4%EB%A0%88%EB%93%9C-%EC%9E%91%EC%97%85-%EC%B5%9C%EC%86%8C%ED%99%94-%ED%95%98%EA%B8%B0\" aria-label=\"기본 스레드 작업 최소화 하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>브라우저에서 웹 애플리케이션을 초기화 할 때 JavaScript를 실행하는 시간이 너무 오래 걸려서 화면에 요소를 렌더링하는 행위에 병목이 발생한 것을 의미한다. 이 문제를 해결하기 위한 방법은 진짜 마이너한 최적화부터 조금만 손봐도 큰 효과를 볼 수 있는 방법까지 여러가지 방법이 떠올랐는데, 마이너한 최적화는 사실 하나마나므로 최소 비용으로 최대의 효과를 얻을 수 있는 방법을 골라야 했다.</p>\n<h3 id=\"웹폰트가-로드되는-동안-텍스트가-계속-표시되는지-확인하기\" style=\"position:relative;\">웹폰트가 로드되는 동안 텍스트가 계속 표시되는지 확인하기<a href=\"#%EC%9B%B9%ED%8F%B0%ED%8A%B8%EA%B0%80-%EB%A1%9C%EB%93%9C%EB%90%98%EB%8A%94-%EB%8F%99%EC%95%88-%ED%85%8D%EC%8A%A4%ED%8A%B8%EA%B0%80-%EA%B3%84%EC%86%8D-%ED%91%9C%EC%8B%9C%EB%90%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"웹폰트가 로드되는 동안 텍스트가 계속 표시되는지 확인하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>아무런 조치도 취하지 않았을 경우 브라우저들은 각각의 정책에 따라 웹폰트를 렌더하는 방법이 다르다. Chrome, Firefox, Safari, Opera 같은 Webkit 진영의 브라우저들은 웹폰트의 다운로드가 완료될 때 까지 폰트가 적용된 텍스트를 보여주지 않는 FOIT(Flash of Invisible Text) 방식으로, IE / Edge는 웹폰트의 다운로드가 완료될 때 까지 텍스트를 기본 폰트가 적용된 상태로 노출시키는 FOUT(Flash of Unstyled Text) 방식으로 웹폰트를 렌더한다.</p>\n<p>그렇기 때문에 Lighthouse는 사용자가 웹폰트 다운로드 완료 여부와 상관없이 페이지의 내용을 확인할 수 있는 FOUT 방식을 사용할 것을 권고하였다.</p>\n<h2 id=\"조치\" style=\"position:relative;\">조치<a href=\"#%EC%A1%B0%EC%B9%98\" aria-label=\"조치 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"이미지-지연-로딩\" style=\"position:relative;\">이미지 지연 로딩<a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9\" aria-label=\"이미지 지연 로딩 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이미지 지연 로딩은 HTML5의 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\" target=\"_blank\" rel=\"nofollow\">IntersectionObserver</a>를 사용하면 간단하게 구현할 수 있다. 그러나 한가지 걱정되었던 것은 “지연 로딩을 하면 구글의 Search Engine Bot이 이미지를 긁어가지 못하는 것이 아닌가?”라는 것이다.</p>\n<p>그래서 다른 사람들은 어떤 방식으로 생각하는 지 알고 싶어 리서치를 조금 해봤는데 <code class=\"language-text\">&lt;noscript></code> 태그를 사용하는 방법, XML을 사용하여 이미지 사이트맵을 만드는 방법 등 몇가지 방법이 있었고 혹자는 구글의 Search Engine Bot이 지연 로딩을 사용하여 불러오는 이미지도 전부 인덱싱하기 때문에 신경쓰지 않아도 된다는 얘기도 있었다.</p>\n<p>그래서 이 문제에 관해 PO(Product Owner)와 토의해보았다. 그 결과 어차피 고수 찾기 페이기에 있는 이미지는 유저 프로필 이미지 밖에 없고, 이 이미지들은 인덱싱이 되든 안되든 SEO에 큰 영향이 없을 것으로 판단되어 별도의 조치 없이 그냥 지연 로딩을 적용하기로 하였다.</p>\n<p>숨고 프론트엔드는 Vue를 사용하고 있기 때문에 Vue에서 제공해주는 <code class=\"language-text\">Directive</code>와 HTML5의 <code class=\"language-text\">IntersectionObserver</code> API를 사용하여 이미지 지연 로딩 기능을 구현하였다. 일단 유저의 프로필 이미지를 렌더하고 있는 컴포넌트 내부에서 유저 프로필을 <code class=\"language-text\">img</code> 태그가 아니라 CSS의 <code class=\"language-text\">background-image</code> 속성을 사용하여 렌더하고 있기 때문에 필자가 생각했던 이 디렉티브의 인터페이스는 대충 이랬다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-lazy-background-image</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- 디렉티브 바인딩 후 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n  <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">v-lazy-background-image</span>\n  <span class=\"token attr-name\">data-lazy-background-image</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>스타일에서는 이미지 URL을 지우고 여기다가 이미지 URL을 담아놓자<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-css line-numbers\"><code class=\"language-css\"><span class=\"token selector\">.test</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>https://assets.soomgo.com/user/example.jpeg<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/* 디렉티브 바인딩 후 */</span>\n<span class=\"token selector\">.test</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이런 엘리먼트가 있을 때 <code class=\"language-text\">lazy-background-image</code> 디렉티브는 바인딩된 엘리먼트의 <code class=\"language-text\">style</code> 속성에 접근해서 <code class=\"language-text\">background-image</code> 속성이 있으면 해당 URL을 별도의 속성에 저장해놨다가 엘리먼트가 뷰포트에 진입했을 때 해당 이미지를 지연 로딩해주면 될 것 같았다.</p>\n<p>여기까지 구상이 됐으면 Observer를 간단히 구현하면 된다. 그러나 한 가지 간과해선 안되는 점이 있는데, <code class=\"language-text\">IntersectionObserver</code> API를 아직 지원하지않는 브라우저들이 많다는 것이다. 때문에 반드시 이런 브라우저들에 대해서 예외처리를 해줘야한다. <code class=\"language-text\">IntersectionObserver</code> API의 지원 현황에 대해서는 <a href=\"https://caniuse.com/#feat=intersectionobserver\" target=\"_blank\" rel=\"nofollow\">Can I Use IntersectionObserver</a>를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> isSupportIntersectionObserver <span class=\"token operator\">=</span> <span class=\"token string\">'IntersectionObserver'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> intersectionObserver<span class=\"token operator\">:</span> IntersectionObserver<span class=\"token operator\">|</span><span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> isSupportIntersectionObserver\n  <span class=\"token operator\">?</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entries<span class=\"token operator\">:</span> IntersectionObserverEntry<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> observer<span class=\"token operator\">:</span> IntersectionObserver<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>entry <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageURL<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-lazy-background-image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageURL<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        entry<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundImage <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span>\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">IntersectionObserver</code>의 <code class=\"language-text\">constructor</code>는 요소가 뷰포트로 들어오거나 벗어나는 등 행위가 발생했을 때 Observer가 호출할 콜백 함수를 전달 인자로 받는다. 과거 scroll 이벤트로 비슷한 행동을 처리했지만 이벤트는 동기적으로 반응하기 때문에 메인 스레드의 응답성, 간단하게 말하면 퍼포먼스에 영향을 준다.</p>\n<p>scroll 이벤트는 워낙 빈번하게 호출되기 때문에 scroll 이벤트 핸들러에서 조금만 많은 처리를 해도 화면이 뚝뚝 끊기는 등 문제가 발생하는 모습을 볼 수 있다.<small>(이벤트 옵션 중 <code class=\"language-text\">passive</code> 옵션을 사용하면 어느 정도 이 현상을 방어할 수는 있다.)</small></p>\n<p>그러나 Observer는 비동기적으로 동작하기 때문에 메인 스레드의 처리 스택과 독립적으로 실행된다. 브라우저 지원률이 90%가 안된다는 점만 해결된다면 진짜 좋을 텐데…</p>\n<p>이제 Observer를 구현했으니 디렉티브를 뚝딱 만들면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Vue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue-property-decorator'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VNode<span class=\"token punctuation\">,</span> VNodeDirective <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n\nVue<span class=\"token punctuation\">.</span><span class=\"token function\">directive</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lazy-background-image'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">bind</span> <span class=\"token punctuation\">(</span>el<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> binding<span class=\"token operator\">:</span> VNodeDirective<span class=\"token punctuation\">,</span> vnode<span class=\"token operator\">:</span> VNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSupportIntersectionObserver<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundImage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      el<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-lazy-background-image'</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundImage <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n      intersectionObserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">unbind</span> <span class=\"token punctuation\">(</span>el<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSupportIntersectionObserver<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      intersectionObserver<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 디렉티브를 사용하여 이미지 지연 로딩을 한 결과 최초 요청하는 이미지 개수를 60개에서 39개로 대폭 줄일 수 있었다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b33633acabe6a266e9450fbc6f66f3e7/1fbe8/lazy_load_before.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 3.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARUlEQVR42h2LwQnAMAwDO01b6ARx7MiOU+j+C6k4j0Nw6A6D0wbYmjBy0WcSHtshJrvqdsWoL8BqRISPLp728daXV60kf2FFIkf4fCJ0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"lazy_load_before\" title=\"\" src=\"/static/b33633acabe6a266e9450fbc6f66f3e7/6af66/lazy_load_before.png\" srcset=\"/static/b33633acabe6a266e9450fbc6f66f3e7/69538/lazy_load_before.png 160w,\n/static/b33633acabe6a266e9450fbc6f66f3e7/72799/lazy_load_before.png 320w,\n/static/b33633acabe6a266e9450fbc6f66f3e7/6af66/lazy_load_before.png 640w,\n/static/b33633acabe6a266e9450fbc6f66f3e7/1fbe8/lazy_load_before.png 757w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9679061b1081b27be82c72d16f8d1807/cab8c/lazy_load_after.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 3.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARElEQVR42j3Ixw2AMBTAUKaBjED5NQll/4VMxIGDZelNZoFHcoiS2Wj9RM2/zAMZz9qIrL/78HUXZntY9KJIp+hN2YIXZGEiTJmDtyMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"lazy_load_after\" title=\"\" src=\"/static/9679061b1081b27be82c72d16f8d1807/6af66/lazy_load_after.png\" srcset=\"/static/9679061b1081b27be82c72d16f8d1807/69538/lazy_load_after.png 160w,\n/static/9679061b1081b27be82c72d16f8d1807/72799/lazy_load_after.png 320w,\n/static/9679061b1081b27be82c72d16f8d1807/6af66/lazy_load_after.png 640w,\n/static/9679061b1081b27be82c72d16f8d1807/cab8c/lazy_load_after.png 744w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<h3 id=\"컴포넌트-지연-로딩\" style=\"position:relative;\">컴포넌트 지연 로딩<a href=\"#%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9\" aria-label=\"컴포넌트 지연 로딩 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>숨고 프론트엔드는 SEO를 위해 첫 요청은 SSR을 하지만 그 외에는 일반적인 SPA와 동일한 방식으로 작동한다. 그렇기 때문에 처음 애플리케이션이 초기화될 때 애플리케이션 내에서 사용될 모든 JavaScript와 CSS를 받아온다.</p>\n<p>이 방식은 애플리케이션이 작을 때는 딱히 문제가 되지 않지만 애플리케이션이 커질수록 번들의 용량도 비례하여 늘어나므로 점점 부담이 되기 마련이다. 그래서 Webpack에서 제공하는 기능인 Dynamic Import를 사용하여 해당 페이지에서 사용하는 코드만을 비동기적으로 로드하여 사용하도록 변경하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token comment\">// Sync</span>\n<span class=\"token keyword\">import</span> SearchPro <span class=\"token keyword\">from</span> <span class=\"token string\">'@/pages/Search/SearchPro'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Async</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SearchPro</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"search\" */</span> <span class=\"token string\">'src/pages/Search/SearchPro'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">webpackChunkName</code> 주석을 사용하면 일정 단위의 모듈들을 하나의 청크로 묶어줄 수 있다. 숨고는 현재 HTTP/1.1 프로토콜을 사용하고 있으므로 한번에 요청할 수 있는 리소스의 개수가 6개 정도로 한정되어있다.<small>(이 개수는 브라우저의 정책에 따라 조금씩 다르다)</small></p>\n<p>청크의 개수가 너무 많아지면 오히려 로딩 속도가 느려질 수 있으므로 관련있는 모듈을 묶어주어 청크의 개수가 너무 많아지지 않도록 조절하였다.</p>\n<p>여기까지는 솔직히 별로 어려울 것도 없고 순조로웠는데 CSS를 별도의 번들로 분리하기 위해 사용하는 <code class=\"language-text\">mini-css-extract-plugin</code>에서 문제가 발생했다. 이 플러그인이 Dynamic import로 불러온 CSS 모듈을 처리하는 방식 때문에 SSR 사이클에서 <code class=\"language-text\">ReferenceError: document is not defined</code>라는 참조 에러가 발생했던 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> linkTag <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ReferenceError: document is not defined</span>\nlinkTag<span class=\"token punctuation\">.</span>rel <span class=\"token operator\">=</span> <span class=\"token string\">\"stylesheet\"</span><span class=\"token punctuation\">;</span>\nlinkTag<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"text/css\"</span><span class=\"token punctuation\">;</span>\nlinkTag<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> resolve<span class=\"token punctuation\">;</span>\nlinkTag<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> fullhref<span class=\"token punctuation\">;</span>\nhead<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>linkTag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>원래 코드는 엄청 거대하지만 간단하게 한번 추려보자면 여기가 문제가 발생한 부분이다. SSR 사이클은 NodeJS 프로세스에서 실행되므로 당연히 document고 나발이고 없기 때문에 참조 에러가 발생한 것이다.</p>\n<p>다행히 빌드 설정은 <code class=\"language-text\">client.config</code>와 <code class=\"language-text\">server.config</code>로 나눠서 관리되고 있기 때문에 적절한 조치를 취해줄 수 있었다. 클라이언트 사이드 렌더링 사이클은 문제 없으므로 최초 요청 시 Express가 Vue를 컴파일할때만 손봐주면 된다.</p>\n<p>역시 StackOverflow에 필자와 같은 삽질을 했었던 전 세계의 개발랭이들이 이미 열띤 토론을 통해 <a href=\"https://github.com/webpack-contrib/mini-css-extract-plugin/issues/90\" target=\"_blank\" rel=\"nofollow\">mini-css-extract-plugin의 SSR 관련 이슈</a>에 대해 어느 정도 결론을 내놓은 것을 발견했다. 위아 더 월드.</p>\n<p>다양한 방법들이 논의되었지만 필자는 <code class=\"language-text\">css-loader</code>의 <code class=\"language-text\">exportOnlyLocals</code> 옵션을 사용하는 방법을 선택했다. 해당 이슈에는 <code class=\"language-text\">css-loader/locals</code>로 사용하라고 되어있지만 이 이슈가 논의된 이후에 css-loader가 업데이트 되었기 때문에 이제는 옵션 객체를 사용해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>baseConfig<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.scss$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">exportOnlyLocals</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'postcss-loader'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'sass-loader'</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 문제는 해결했지만 일단 이 기술의 안정성이 프론트엔드 챕터 내에서 충분히 확인되지 않았다고 판단되어 일단 원래 목표였던 고수 찾기 페이지에 관련된 컴포넌트들만 지연 로딩하고 있는 중이다. 향후 안정성이 검증되면 점진적으로 커버리지를 넓혀 적용할 예정이다.</p>\n<h3 id=\"텍스트-컨텐츠-gzip-압축-적용\" style=\"position:relative;\">텍스트 컨텐츠 gzip 압축 적용<a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%BB%A8%ED%85%90%EC%B8%A0-gzip-%EC%95%95%EC%B6%95-%EC%A0%81%EC%9A%A9\" aria-label=\"텍스트 컨텐츠 gzip 압축 적용 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이건 그냥 Nginx 설정에 gzip 관련 설정들을 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip</span> <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_disable</span> <span class=\"token string\">\"msie6\"</span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_proxied</span> any</span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_comp_level</span> <span class=\"token number\">6</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_buffers</span> <span class=\"token number\">16</span> <span class=\"token number\">8k</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_http_version</span> 1.1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml text/javascript</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>사실 숨고는 IE6를 지원하지는 않지만 유저가 아예 페이지를 못보는 상황보다는 망가진 페이지라도 보는게 낫다고 생각하여 혹시 몰라 추가해두었다. 컴포넌트 지연 로딩과 텍스트 컨텐츠 gzip 압축 적용을 마치고 나서 한번 번들의 크기와 로딩 속도를 확인해 보았다.</p>\n<h3 id=\"js\" style=\"position:relative;\">JS<a href=\"#js\" aria-label=\"js permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Before</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/446d2f429821f64174ce24370cbc4073/97655/js_before.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 11.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAe0lEQVR42h2MSQ6DMBRDOUyULDKhkpA5IEq7oPT+x3F/s7CsZ1lvuq4PcqmoraFvO1rfiQvWNSDlgseyYKPd+xWZ2Dk//lprWGsHx5gQQhw93fcXpXYc54vyxvE8h9TOM4wxkFLCk1yRwHk/RP+dMQbOOYQQCClBKT36B/UcQYQJiowhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"js before\" title=\"\" src=\"/static/446d2f429821f64174ce24370cbc4073/6af66/js_before.png\" srcset=\"/static/446d2f429821f64174ce24370cbc4073/69538/js_before.png 160w,\n/static/446d2f429821f64174ce24370cbc4073/72799/js_before.png 320w,\n/static/446d2f429821f64174ce24370cbc4073/6af66/js_before.png 640w,\n/static/446d2f429821f64174ce24370cbc4073/97655/js_before.png 819w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/304a1bba295c3ca47857b488eeb5e320/98314/js_after.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.375000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVR42k2O2xKDIAxE/Rh1xspFBaqCYGu9Tv//e7YxT33YSUg2Z8m6roMhWWthnYMxBm3bIqaZ6xQT+mHAMHp0tPPew1OvtWbvSO//ms3vBft5YTtO1rLuZG7gXI+yLBEIKJWigwDdNDDWoaoq5HnOeyEkhwshODyL6YV1O0kHjuuLDwGlVHDPHkVREDBCSMk/vMH33IeJA5TSeNQ1wpQYeHt+Silh6J36HtcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"js after\" title=\"\" src=\"/static/304a1bba295c3ca47857b488eeb5e320/6af66/js_after.png\" srcset=\"/static/304a1bba295c3ca47857b488eeb5e320/69538/js_after.png 160w,\n/static/304a1bba295c3ca47857b488eeb5e320/72799/js_after.png 320w,\n/static/304a1bba295c3ca47857b488eeb5e320/6af66/js_after.png 640w,\n/static/304a1bba295c3ca47857b488eeb5e320/98314/js_after.png 817w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<h3 id=\"css\" style=\"position:relative;\">CSS<a href=\"#css\" aria-label=\"css permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Before\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0d95259dcfc5faeb6f9d49528cec626a/7e509/css_before.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgUlEQVR42h2NQQ6DMAwE+QsgVCSSkjgE0kKoKPRI//+ZqenBWh9md4q8vvBecM7pefreYYyh6zqmlIhxREJgyRkRIT2ef3ZesvY81hrCMCgXEd0pzvPLnFfe+4dtP7gExlqqssRLoG1bLd2J48RN/025QSVex+u6pmkazYpeJZfsB3TsQMdFJuj8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"css before\" title=\"\" src=\"/static/0d95259dcfc5faeb6f9d49528cec626a/6af66/css_before.png\" srcset=\"/static/0d95259dcfc5faeb6f9d49528cec626a/69538/css_before.png 160w,\n/static/0d95259dcfc5faeb6f9d49528cec626a/72799/css_before.png 320w,\n/static/0d95259dcfc5faeb6f9d49528cec626a/6af66/css_before.png 640w,\n/static/0d95259dcfc5faeb6f9d49528cec626a/7e509/css_before.png 745w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<p>After\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c6bb77b3c748d7b4195f941433773374/ef916/css_after.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 11.249999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVR42h2NSw6DIABEvYytCSDWFEHA+jdd9OP9L/NKWcxiknnzitf7wzCMPMYpx7keJSXGdIQYaduWaV5TN8zLSt97fIgIIVBK0VmL9yFzPgSK73kyLRv78WRL8WHgUpbUtaZpbhn8j0WSLOuOsS6dOO5JqLWmqq7pMCKlyqIfAepCJR87pa8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"css after\" title=\"\" src=\"/static/c6bb77b3c748d7b4195f941433773374/6af66/css_after.png\" srcset=\"/static/c6bb77b3c748d7b4195f941433773374/69538/css_after.png 160w,\n/static/c6bb77b3c748d7b4195f941433773374/72799/css_after.png 320w,\n/static/c6bb77b3c748d7b4195f941433773374/6af66/css_after.png 640w,\n/static/c6bb77b3c748d7b4195f941433773374/ef916/css_after.png 815w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<p>JS before의 제일 상단에 있는 변태같은 <code class=\"language-text\">1.2MB</code> 크기의 번들이 <code class=\"language-text\">node_modules</code> 라이브러리를 묶어놓은 vendor이다. 항상 이 놈을 볼때마다 눈물이 나고 마음이 아팠는데 이렇게 간단하게 끝낼 수 있는 걸 왜 이리 시간을 끌었나 싶었다.</p>\n<h4 id=\"seo가-필요한-페이지는-인증-과정을-기다리지-않고-바로-페이지를-렌더하도록-변경\" style=\"position:relative;\">SEO가 필요한 페이지는 인증 과정을 기다리지 않고 바로 페이지를 렌더하도록 변경<a href=\"#seo%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C-%ED%8E%98%EC%9D%B4%EC%A7%80%EB%8A%94-%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95%EC%9D%84-%EA%B8%B0%EB%8B%A4%EB%A6%AC%EC%A7%80-%EC%95%8A%EA%B3%A0-%EB%B0%94%EB%A1%9C-%ED%8E%98%EC%9D%B4%EC%A7%80%EB%A5%BC-%EB%A0%8C%EB%8D%94%ED%95%98%EB%8F%84%EB%A1%9D-%EB%B3%80%EA%B2%BD\" aria-label=\"seo가 필요한 페이지는 인증 과정을 기다리지 않고 바로 페이지를 렌더하도록 변경 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>사실 이건 숨고의 기술 부채와도 관련이 있는 내용이다. 현재 로그인한 사용자의 정보를 받아오는 API가 엄청 느리다. 보통 때는 응답 시간이 1.5초 정도이고 트래픽 피크 타임때는 2초에 가까워 지는 경우도 있다. 이건 DB 스키마와도 관련있는 깊은 기술 부채이기 때문에 짧은 시간 안에 해결하기에는 조금 힘든 문제다.</p>\n<p>그렇다 하더라도 외부 네트워크 요인 때문에 사용자가 화면을 볼 수 있는 시간이 2초씩이나 딜레이된다는 것은 너무 아깝다. 근데 생각을 해보자.</p>\n<blockquote>\n<p>SEO가 필요한 페이지는 무조건 비로그인 유저도 볼 수 있는 페이지이다.</p>\n</blockquote>\n<p>응? 사실 너무나 당연한 사실인데 놓치고 있었다. 그럼 이런 의식의 흐름이 생긴다.</p>\n<hr>\n<ol>\n<li>SEO가 중요한 페이지의 로딩 시간을 단축시키는 것이 목표였다.</li>\n<li>SEO가 되고 있는 페이지는 애초에 비로그인 유저도 접근 가능한 페이지다.</li>\n<li>인증 API를 기다릴 필요가 없다…?</li>\n</ol>\n<hr>\n<p>그렇다면 그냥</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isAllowGuestPage</span><span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 바로 질러버린다. 라우터 퍼미션을 검사해서 비회원 유저도 접근 가능한 페이지는 <code class=\"language-text\">init</code>의 프로미스를 기다리지 않고 다음 초기화 로직을 실행하도록 변경하였다. 그 결과 비회원 접근 가능 페이지들의 로딩 속도가 1초 정도 더 빨라진 것을 확인할 수 있었다.</p>\n<table>\n<thead>\n<tr>\n<th>Before</th>\n<th>After</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2513.9ms</td>\n<td>1111.5ms</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"결과\" style=\"position:relative;\">결과<a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이렇게 이것 저것 열심히 했더니 그래도 조금 빨라지긴 했다.</p>\n<p>Before\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/d30ee/result_before.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrElEQVR42pVSXY/TMBDM//9DPPEEh073gITUcgIdrURDmu/UcRLHn8Ouc4U2FXfHSCtvEnsm450EzzDB4W78gYdpv7wYaa0+Lr38Rv2H2H4an3A/7mJfFiXyPMclknNjrcWm2OF7fYCzHm2xR5s9YlIGXbZFk24QPLATx1iMNE1xOBwQQrgl9N7DzgZWGzjnMM8aip6NMXHl4j2OhL118UxRFLH4/Q3hDUhVDwPUJKEngX4cIJTE6XTCS0he+hhIOYRFnU156i//hq1e2n2VkKGDxVZl2Kg0Du41/JMwYFHOjcA7scH7/hGZOV19+2/LjEnP+Nzv8UX+hPFv/EOe6vouzujaDsdfGXIqsRrI+UQlgKZfxBJHl5zlR8xKxSwy+do6izlQrJyNe7iegxBxtw14+MpingjpQD0KNHWDtm0xTdOf6XFZEpB6QjNLlGWJuq4hpYzT/jvlgMHMMQWRsJQtEdYYx/HGMjsYjEKvBKqqQtd10Fpfxcf7QGf7GLGEdNANPXohojqTsqXznXoOOFn1moJNe4ZhWa+uhvZ4NXBwl6Gw4rrWQwp4G34DwP5Io3v8J0IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result before\" title=\"\" src=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/6af66/result_before.png\" srcset=\"/static/43dfafa71e415d44ece6e7d72b2e6cdf/69538/result_before.png 160w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/72799/result_before.png 320w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/6af66/result_before.png 640w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/d9199/result_before.png 960w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/d30ee/result_before.png 980w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<p>After\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/df18d626e5c0332c33645fbe4842674f/91b29/result_after.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 71.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVR42o1TyW7bQAz1/39QT70EOaTooSgSoE7cIrDhWHJkaxvNvr1yBlKg2EpaAoTIEfn4OOSsMJOdOeOXPCCSHR1H7J/IIM8Jsh+B4HF0DL/VEZ6iBBeo63oOgdXc+Sn3uBmeEJJD4KhuCcQiij1idQN4hXsqeMs20HBgXY+yLKlmvAaMIaI8vWJfFTDaoKlPeC13EFKjOZU4HXd0bjEogaKtck5RFNhut7DWLjNMoDGEXDGQOmNgSZ01UASmncnFUkwSxlhuOYz+FWAGndleCkjB4fQASfc1WIm+7+FnAJeywn+Iii5riPF9cfLjxdmHgFOY9AZ3wx98ae9RWTb+i58zXKo0JbGg8E0+4+uwxsG2i4ApdbqFf7asuMS6eMaPwwZd1721+iHD9LOhSWma5pIYmnAaiBokhBBXzJJsXoDva3oI0WNFS4KG92A0va7v8ipMVzCp9hbc6wyYWCZ13o9MIw7niIctp+mPgC2tRX0+ZzBPgZeT5EahNhxt26JpGpiFboTT8DGMgGqgtpu8pFPwnGECVJLnoikm7aLW+i0uLbbtWlp4YphISyXBOc+B6auUesc0A1NSOnPO5acWLpfb+XypfwGA+EehSp4aMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result after\" title=\"\" src=\"/static/df18d626e5c0332c33645fbe4842674f/6af66/result_after.png\" srcset=\"/static/df18d626e5c0332c33645fbe4842674f/69538/result_after.png 160w,\n/static/df18d626e5c0332c33645fbe4842674f/72799/result_after.png 320w,\n/static/df18d626e5c0332c33645fbe4842674f/6af66/result_after.png 640w,\n/static/df18d626e5c0332c33645fbe4842674f/d9199/result_after.png 960w,\n/static/df18d626e5c0332c33645fbe4842674f/91b29/result_after.png 983w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<p>원래 목표였던 FMP를 1초 아래로 떨어트리는 목표는 달성했지만 다른 수치가 이 정도로 영향을 안받을 줄은 몰랐다. 퍼포먼스 점수도 꼴랑 2점 올라갔다. 다른 팀원들은 “그래도 2점이 어디야~“라고 해주셨지만 뭔가 마음 한켠이 찜찜하다…</p>\n<p>다음에는 다른 점수를 좀 더 올려보는 걸 목표로 삼아봐야겠다. PWA 세팅해놓으면 Accessibility 점수는 좀 더 올라갈 것 같기도 한데 생각해놓은 다른 이슈들은 백엔드 개발자 분들의 도움이 필요한 것들이 꽤 있어서 혼자서는 힘들 듯하다.</p>\n<p>이상으로 클라이언트 사이드 렌더링 최적화 포스팅을 마친다.</p>","fields":{"slug":"20190603-client-render-optimizing","path":"/2019/06/03/client-render-optimizing/","lang":"ko"},"frontmatter":{"title":"클라이언트 사이드 렌더링 최적화","subTitle":"SEO와 사용자 경험을 개선하는 렌더링 최적화 전략","date":"Jun 03, 2019","categories":["프로그래밍","웹"],"tags":["SEO","렌더 최적화","Render Optimizing","JavaScript","자바스크립트","FMP","First Meaningful Paint","Google SEO","프론트엔드","Frontend"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/d803c/result_before.png","srcSet":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/d803c/result_before.png 320w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/2a1fd/result_before.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/fc5c5/result_before.webp 320w,\n/static/43dfafa71e415d44ece6e7d72b2e6cdf/e9225/result_before.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/01fb2/result_before.png","srcSet":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/01fb2/result_before.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/43dfafa71e415d44ece6e7d72b2e6cdf/b384d/result_before.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"FMP","lang":"ko"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}