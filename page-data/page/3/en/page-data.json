{"componentChunkName":"component---src-templates-posts-page-template-tsx","path":"/page/3/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"f08092c0-752e-5a85-b744-a8fbd1d140b6","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-does-synchronous-actually-mean\">What Does Synchronous Actually Mean?</a></p>\n<ul>\n<li><a href=\"#understanding-the-nuance-of-the-word\">Understanding the Nuance of the Word</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#synchronous-in-computer-science\">Synchronous in Computer Science</a></p>\n<ul>\n<li><a href=\"#synchronous--blocking\">Synchronous + Blocking</a></li>\n<li><a href=\"#synchronous--non-blocking\">Synchronous + Non-Blocking</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#asynchronous-in-computer-science\">Asynchronous in Computer Science</a></p>\n<ul>\n<li><a href=\"#asynchronous--non-blocking\">Asynchronous + Non-Blocking</a></li>\n<li><a href=\"#asynchronous--blocking\">Asynchronous + Blocking</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about what synchronous — a concept used across various models including I/O and networking — actually means, and explore the difference between synchronous and asynchronous approaches. I’ll also briefly touch on blocking and non-blocking, two concepts that are frequentl…","html":"<p>In this post, I want to talk about what synchronous — a concept used across various models including I/O and networking — actually means, and explore the difference between synchronous and asynchronous approaches. I’ll also briefly touch on blocking and non-blocking, two concepts that are frequently confused with sync and async.</p>\n<p>Before diving in, I want to make one thing absolutely clear: synchronous and asynchronous are mechanisms concerning the guaranteed order of process execution, while blocking and non-blocking are concepts about the idle state of a process. They are entirely separate ideas.</p>\n<p>Because the mechanics of synchronous + blocking and asynchronous + non-blocking feel more intuitive, many people mistakenly treat these pairs as identical or similar. But as I just mentioned, they focus on completely different things and have almost no direct relationship. They are simply combined in use.</p>\n<center>\n  <img src=\"/62da0c7a07594deebfee5e538995fe34/4elements.gif\" width=\"100%\">\n  <small>Source - Boost application performance using asynchronous I/O, IBM</small>\n</center>\n<p>There are already plenty of excellent posts on this topic by talented writers, but most of them bundle these concepts together, which makes it easy for newcomers or those unfamiliar with computer science to assume they’re related. The reason so many posts cover them together is simply that in actual implementations, these concepts are used in combination — making it harder to explain them separately.</p>\n<p>So I’ll inevitably be explaining them together as well, but rather than focusing on the more intuitive blocking &#x26; non-blocking concepts, I’ll center the discussion on the more abstract synchronous &#x26; asynchronous.</p>\n<h2 id=\"what-does-synchronous-actually-mean\" style=\"position:relative;\">What Does Synchronous Actually Mean?<a href=\"#what-does-synchronous-actually-mean\" aria-label=\"what does synchronous actually mean permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>If you read posts about synchronous programming, you’ll find that people interpret the word differently. Some say it means things happening at the same time, others describe it as communicating on a specific clock cycle, and still others define it as making states identical. With so many uses of the word, there are equally many interpretations. It’s hard to know which one is right.</p>\n<p>I too was confused when I first learned the concept — the word “synchronous” and its mechanism just didn’t click. Terms like “blocking” are easier to grasp because they come up in everyday contexts like sports, and the meaning of “to block something” is immediately intuitive. But “synchronous”? Not so much.</p>\n<p>The most common everyday usage of the word is probably <strong>synchronization</strong>. Think of the sync feature in iTunes when transferring music to an iPhone. In that context, synchronization means “making two different states identical.”</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54ef639a4f73e6df84f47163440f0557/66465/itunes.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGklEQVR42lVSyXLTQBTUzcibbMuS5b1iybaUyAuSvMUbgeAlTsCOHYcEgkucKE78CsWNA7/azJsgSA5dT5p506+7Z4Rxp4Nhv4PjugHLrKBe02GaJsrlMnK5HPL5PAqFwj/QWjab5TXYD1AsFiGcff0F9+En7A8/4Pi/YYzukVVlZFmzJEmIRCIIh8McoihCURRkMhkkEgm+T+vxeByxWAzpdBrC9vAdq9tvGM4/YnL5BSfOGFI8xpuj0SgnJCJCKBTi6mzbhmEYHKSKhlA/J9zf+1jvPmFydoHJqyUajZd8YgBqJDWBIk3TYFkWt6/rj/EQESlUVRXC+voOi4sNev0pBoMpm95CtWo8y+1pTpQbWSalRE4kzzJ8d3WN8/MlOt4Ave6QXYrFDmn8EOVDtgOQfVmWUSqVOAGpTqVSSCaT/Jtb3qxvMJ+v0O2cosdQr5lQtDyOKhVukQ4QiIj+SYXrupyUFNKg4NKoR5i9ZdmN38B1+kzhCGbdgqzkYFRrzJbGpxOINMiQnhStkaJAHWVIPYLjDNjER3jeKWrMsii+4FmRCok1x6X/lxM8o6dREES2xglb7S5a7R6otlk1TRuFYoGFnYGmsCzp3clpyH+tkypC8E1PRlVZj5JGnokQGk0XjaYHqq1WF3qtjqU3w35/ielhBH31GvpmhvcPd/A/H7DdbbHb7eD7PuaLBcveQ5PFVe3f4Kh6jD/2YjO/1wA8TwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"itunes\" title=\"\" src=\"/static/54ef639a4f73e6df84f47163440f0557/6af66/itunes.png\" srcset=\"/static/54ef639a4f73e6df84f47163440f0557/69538/itunes.png 160w,\n/static/54ef639a4f73e6df84f47163440f0557/72799/itunes.png 320w,\n/static/54ef639a4f73e6df84f47163440f0557/6af66/itunes.png 640w,\n/static/54ef639a4f73e6df84f47163440f0557/d9199/itunes.png 960w,\n/static/54ef639a4f73e6df84f47163440f0557/66465/itunes.png 1097w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>We've all had the experience of losing all our iPhone music after a bad sync, right?</small>\n</center>\n<p>But in computer science, “synchronous” is mostly explained as “happening at the same time,” which feels different. Of course, there are cases like database synchronization where it carries the same meaning, but since many posts discuss I/O and networking, the former interpretation tends to dominate.</p>\n<p>Between the words synchronous and asynchronous, “asynchronous” simply means “not synchronous” — so we should focus on understanding what synchronous precisely means.</p>\n<h3 id=\"understanding-the-nuance-of-the-word\" style=\"position:relative;\">Understanding the Nuance of the Word<a href=\"#understanding-the-nuance-of-the-word\" aria-label=\"understanding the nuance of the word permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In high school, you might have heard the advice “the answer is in the passage” when studying language or foreign language sections. In engineering and science, terminology is often derived from English, and the translation process can sometimes produce words that are harder to understand than the originals. That’s why grasping the original English word’s meaning matters.</p>\n<p>It might feel like we’ve suddenly switched to a language lesson, but I personally think this process is important. It helps us understand why the word “synchronous” can carry different meanings in different contexts.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9094539313df482f1f1f54d153a73b83/15ec7/memorize.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9hMR2QMktEf/xAAZEAADAQEBAAAAAAAAAAAAAAAAARESAhD/2gAIAQEAAQUChDI+qcvJuDSMpef/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAABBAMAAAAAAAAAAAAAAAAAARAhMRFBUf/aAAgBAQAGPwKjrUYk20Fqf//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExEEFRkbH/2gAIAQEAAT8hMwrnuNK6eeGp9QKA0uoEAnpFbLghRUph/9oADAMBAAIAAwAAABBf/wBD/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEDAQE/ECML/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxCjqcrv/8QAHhABAAICAgMBAAAAAAAAAAAAAQARITFRYUFxgcH/2gAIAQEAAT8QyMNFZrG+YOJVOH56lHJFI2LdV5V39lgJwAHgsr7uFRIQPRjsl8ClNeSK6LoQn//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"memorize\" title=\"\" src=\"/static/9094539313df482f1f1f54d153a73b83/c08c5/memorize.jpg\" srcset=\"/static/9094539313df482f1f1f54d153a73b83/0913d/memorize.jpg 160w,\n/static/9094539313df482f1f1f54d153a73b83/cb69c/memorize.jpg 320w,\n/static/9094539313df482f1f1f54d153a73b83/c08c5/memorize.jpg 640w,\n/static/9094539313df482f1f1f54d153a73b83/15ec7/memorize.jpg 690w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Don't memorize — understand</small>\n</center>\n<p>Looking at the Korean translation “동기(同期),” it uses the characters for “same” (同) and “period” (期), literally meaning “same period” or “same cycle.” It’s the same word used when Koreans refer to colleagues who joined a company or military service at the same time. But this literal meaning doesn’t quite match what we mean by “synchronization.”</p>\n<p>After all, syncing an iPhone with iTunes isn’t about aligning their periods or cycles, is it?</p>\n<p>But the English word “Synchronous” actually carries a slightly different nuance:</p>\n<blockquote>\n<p><strong>synchronous</strong> <small>[adjective]</small><br />\n: happening, existing, or arising at precisely the same time</p>\n<p><strong><a href=\"https://www.merriam-webster.com/dictionary/synchronous\" target=\"_blank\" rel=\"nofollow\">- Source: Webster</a></strong></p>\n</blockquote>\n<p>First, note that “synchronous” is an adjective. And its meaning is “happening or existing at precisely the same time.” Since it’s an adjective, it doesn’t specify <em>what</em> is happening at the same time. Now let’s look at the noun “synchronization”:</p>\n<blockquote>\n<p><strong>synchronization</strong><br />\n: the state of being synchronous</p>\n<p><strong><a href=\"https://www.merriam-webster.com/dictionary/synchronization\" target=\"_blank\" rel=\"nofollow\">- Source: Webster</a></strong></p>\n</blockquote>\n<p>Synchronization is “the state of being synchronous.” In other words, synchronous and synchronization are fundamentally the same concept.</p>\n<p>Moreover, all words derived from “Synchro” — <strong>Synchro</strong>nize, <strong>Synchro</strong>nization, <strong>Synchro</strong>nous — share a common nuance: <strong>the feeling of things progressing identically at the same time.</strong> Whether it’s states, actions, or events, they all evoke the sense of things moving in unison.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/edf9c97710f3443a11147da87d5eb3e8/01ab0/synchronized-swimming.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAME/9oADAMBAAIQAxAAAAGdM20qIEH/xAAWEAEBAQAAAAAAAAAAAAAAAAABABD/2gAIAQEAAQUCNJm//8QAFxEBAAMAAAAAAAAAAAAAAAAAAgEQUf/aAAgBAwEBPwEycr//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8BNX//xAAWEAADAAAAAAAAAAAAAAAAAAABECD/2gAIAQEABj8CgL//xAAYEAEBAQEBAAAAAAAAAAAAAAABABEhcf/aAAgBAQABPyEE5k4TufUnb//aAAwDAQACAAMAAAAQFM//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QyMW//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAgEBPxA67Bf/xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMUFh/9oACAEBAAE/EBBbrvILwNHQHHgA8hFsMktMX7Gtz//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"synchronized swimming\" title=\"\" src=\"/static/edf9c97710f3443a11147da87d5eb3e8/c08c5/synchronized-swimming.jpg\" srcset=\"/static/edf9c97710f3443a11147da87d5eb3e8/0913d/synchronized-swimming.jpg 160w,\n/static/edf9c97710f3443a11147da87d5eb3e8/cb69c/synchronized-swimming.jpg 320w,\n/static/edf9c97710f3443a11147da87d5eb3e8/c08c5/synchronized-swimming.jpg 640w,\n/static/edf9c97710f3443a11147da87d5eb3e8/6a068/synchronized-swimming.jpg 960w,\n/static/edf9c97710f3443a11147da87d5eb3e8/eea4a/synchronized-swimming.jpg 1280w,\n/static/edf9c97710f3443a11147da87d5eb3e8/01ab0/synchronized-swimming.jpg 1300w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>A classic example of \"synchro\"</small>\n</center>\n<p>So, making an iPhone and iTunes share the same state is synchronous because once the operation completes, both simultaneously arrive at an identical state. And what computer science calls synchronous — events happening at the same time — is also a synchronous event. Both interpretations share the same underlying nuance.</p>\n<p>Even the etymological root “Syn-” simply carries the meaning of “together,” which is why it works in contexts like:</p>\n<blockquote>\n<p>He and I are <strong>out of sync</strong> in everything<br /></p>\n</blockquote>\n<p>For words that are difficult to translate literally, it’s better to understand them through their nuance. To sum up: words using “Synchro-” all share the nuance of <strong>“things progressing identically at the same time.”</strong> Whether it’s state unification (synchronization) or simultaneous events (synchronous processing in CS), the underlying nuance is the same.</p>\n<h2 id=\"synchronous-in-computer-science\" style=\"position:relative;\">Synchronous in Computer Science<a href=\"#synchronous-in-computer-science\" aria-label=\"synchronous in computer science permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Many posts explain synchronous as “the request and response of the current task happening at the same time,” but I’ve always felt a contradiction there — the word “simultaneous” suggests no time gap, yet there’s inevitably some duration between a request and its response.</p>\n<p>Technically, “simultaneous” doesn’t strictly mean an instantaneous moment (just as “simultaneous outbreaks” don’t happen in a single instant), but given how we commonly use the word, it doesn’t feel intuitive.</p>\n<p>That’s why I think it’s more accurate to say what happens simultaneously is not “the current task’s request and response,” but rather <strong>“the current task’s response and the next task’s request.”</strong> (After all, “synchronous” is an adjective with no subject.)</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c9b31/sync.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 24.375000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd0RRX//xAAWEAADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQEAAQUCVP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABsQAAEEAwAAAAAAAAAAAAAAAAEAEBExQWGR/9oACAEBAAE/IY2erNln/9oADAMBAAIAAwAAABAMD//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QgX//xAAZEAEAAgMAAAAAAAAAAAAAAAABABEhQXH/2gAIAQEAAT8QcIgSyz2o01P/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync\" title=\"\" src=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c08c5/sync.jpg\" srcset=\"/static/8aae3ca6cff4ddbe364a411fd31cf7d0/0913d/sync.jpg 160w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/cb69c/sync.jpg 320w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c08c5/sync.jpg 640w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/6a068/sync.jpg 960w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/eea4a/sync.jpg 1280w,\n/static/8aae3ca6cff4ddbe364a411fd31cf7d0/c9b31/sync.jpg 1853w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Synchronous: the response of the current task and the request of the next task are timed together</small>\n</center>\n<p>In other words, saying the current task’s response triggers the next task’s request simultaneously means that tasks proceed <strong>in a definite order.</strong> And “response” here is flexible — in a network model, it could be a server’s response; in an I/O model, it could be the return of process control.</p>\n<p>Let’s look at the most common example of a synchronous approach.</p>\n<h3 id=\"synchronous--blocking\" style=\"position:relative;\">Synchronous + Blocking<a href=\"#synchronous--blocking\" aria-label=\"synchronous  blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The most common synchronous pattern we encounter is the synchronous &#x26; blocking approach. Because it’s synchronous, the sequential flow of tasks is guaranteed. Because it’s blocking, no other task can proceed while one is in progress.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">101</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nEmployee: Attaching doll eye #1\nEmployee: Attaching doll eye #2\n...\nEmployee: Attaching doll eye #100\nBoss: Leaves work</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Looking at this code, we naturally know these tasks will execute in order. Internally, it’s because tasks are pushed onto a single call stack and processed LIFO (Last In First Out), but let’s just focus on the fact that tasks proceed sequentially.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/fe251be8bc28c901b166ea3f99eb1302/0f98f/sync-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFRABAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAIDAAAAAAAAAAAAAAAAAAABIDFB/9oACAEBAAE/IRgqh//aAAwDAQACAAMAAAAQcM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABExQRAhcf/aAAgBAQABPxCi7uo9oceQAAxN8//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync block\" title=\"\" src=\"/static/fe251be8bc28c901b166ea3f99eb1302/c08c5/sync-block.jpg\" srcset=\"/static/fe251be8bc28c901b166ea3f99eb1302/0913d/sync-block.jpg 160w,\n/static/fe251be8bc28c901b166ea3f99eb1302/cb69c/sync-block.jpg 320w,\n/static/fe251be8bc28c901b166ea3f99eb1302/c08c5/sync-block.jpg 640w,\n/static/fe251be8bc28c901b166ea3f99eb1302/6a068/sync-block.jpg 960w,\n/static/fe251be8bc28c901b166ea3f99eb1302/eea4a/sync-block.jpg 1280w,\n/static/fe251be8bc28c901b166ea3f99eb1302/0f98f/sync-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>No going home until all the doll eyes are attached</small>\n</center>\n<p>The parent process <code class=\"language-text\">boss</code> performs its “arrive at work” task, then requests the child process <code class=\"language-text\">employee</code> to attach doll eyes. Only after this task completes can <code class=\"language-text\">boss</code> perform its “leave work” task.</p>\n<p>Simply put, the parent process — the one giving orders — cannot leave until the child process finishes. This synchronous + blocking mechanism is what most people picture when they think of “synchronous,” and it’s intuitively easy to understand.</p>\n<p>But can the <code class=\"language-text\">boss</code> function do other things while <code class=\"language-text\">employee</code> is attaching doll eyes, while still maintaining a synchronous flow?</p>\n<h3 id=\"synchronous--non-blocking\" style=\"position:relative;\">Synchronous + Non-Blocking<a href=\"#synchronous--non-blocking\" aria-label=\"synchronous  non blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Absolutely. Whatever the case, synchronous means tasks have a sequential flow — as long as this premise holds, everything else is fair game. This is precisely why we can’t say <code class=\"language-text\">synchronous === blocking</code>.</p>\n<p>Using JavaScript generators, we can maintain task order while letting the parent process do its own work:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">101</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">yield</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> generator <span class=\"token operator\">=</span> <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">=</span> generator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Boss: Watching YouTube...</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nEmployee: Attaching doll eye #1\nBoss: Watching YouTube...\nEmployee: Attaching doll eye #2\nBoss: Watching YouTube...\n...\nEmployee: Attaching doll eye #100\nBoss: Watching YouTube...\nBoss: Leaves work</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, the parent process <code class=\"language-text\">boss</code> arrives at work, calls the child process <code class=\"language-text\">employee</code> to attach doll eyes, and periodically checks whether the work is done.</p>\n<p>If the task isn’t finished yet, <code class=\"language-text\">boss</code> also diligently performs its own task of <code class=\"language-text\">Watching YouTube</code>. This code clearly follows a synchronous flow, but since <code class=\"language-text\">boss</code> is also doing its own work in between, it’s using a non-blocking approach.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/0f98f/sync-non-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFRABAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAABESEQMVH/2gAIAQEAAT8h6NoVIiyMf//aAAwDAQACAAMAAAAQEM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFx/9oACAEBAAE/EK2O1NQdPkAAclNVsp4QKKJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sync non block\" title=\"\" src=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/c08c5/sync-non-block.jpg\" srcset=\"/static/6395f57fdd8a1d9b8bdbb83621f2157c/0913d/sync-non-block.jpg 160w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/cb69c/sync-non-block.jpg 320w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/c08c5/sync-non-block.jpg 640w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/6a068/sync-non-block.jpg 960w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/eea4a/sync-non-block.jpg 1280w,\n/static/6395f57fdd8a1d9b8bdbb83621f2157c/0f98f/sync-non-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>While you work, I'll sneak in some YouTube</small>\n</center>\n<p>In this example, just like in the synchronous &#x26; blocking approach, <code class=\"language-text\">boss</code> absolutely cannot leave work until <code class=\"language-text\">employee</code> finishes. The order of tasks is preserved. In other words, as long as the sequential flow is maintained, synchronous doesn’t care whether it’s blocking or non-blocking.</p>\n<h2 id=\"asynchronous-in-computer-science\" style=\"position:relative;\">Asynchronous in Computer Science<a href=\"#asynchronous-in-computer-science\" aria-label=\"asynchronous in computer science permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I described synchronous as the timing of the current task’s response and the next task’s request being aligned. Asynchronous literally means “not synchronous,” so think of it as the opposite: the current task’s response and the next task’s request don’t have to be aligned.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/6ca16/async.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHbkiwr/8QAFxABAAMAAAAAAAAAAAAAAAAAAQAQEv/aAAgBAQABBQLIwAr/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAh/9oACAEBAAY/AjFP/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERMXH/2gAIAQEAAT8hehUwBcKf/9oADAMBAAIAAwAAABCMD//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxClf//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxCBf//EABkQAQADAQEAAAAAAAAAAAAAAAEAEZFRcf/aAAgBAQABPxCifMqmR/BVFnJ//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"async\" title=\"\" src=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/c08c5/async.jpg\" srcset=\"/static/ec1da404358cadaa685c34ecb3f1fb8a/0913d/async.jpg 160w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/cb69c/async.jpg 320w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/c08c5/async.jpg 640w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/6a068/async.jpg 960w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/eea4a/async.jpg 1280w,\n/static/ec1da404358cadaa685c34ecb3f1fb8a/6ca16/async.jpg 1855w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Once you assign the task, you don't care when it finishes</small>\n</center>\n<p>In a synchronous approach, the parent process must be aware of when the child process’s task ends. Whether the child has produced a result or is still working, the parent is always keeping track of the completion point.</p>\n<p>But in an asynchronous approach, once the parent process assigns a task, it doesn’t care whether the task is in progress or finished. Just as with synchronous, whether the parent can do its own work or not is a separate question.</p>\n<p>Also, since the parent process doesn’t care about the child’s completion status, there’s no guarantee that tasks will finish in sequential order. Let’s start with the familiar async &#x26; non-blocking pattern.</p>\n<h3 id=\"asynchronous--non-blocking\" style=\"position:relative;\">Asynchronous + Non-Blocking<a href=\"#asynchronous--non-blocking\" aria-label=\"asynchronous  non blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The combination of asynchronous and non-blocking is a pattern we’re very familiar with. Since it’s asynchronous, the parent process doesn’t bother tracking the child’s completion. When the child finishes, it will either report back to the parent on its own or delegate to another process.</p>\n<p>And since it’s non-blocking, the parent can continue with its own work after assigning the task.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">employee</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">maxDollCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> dollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> interval <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dollCount <span class=\"token operator\">></span> maxDollCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    dollCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Employee: Attaching doll eye #</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dollCount<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">boss</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Arrives at work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">employee</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Employee: Eye count final report'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Boss: Leaves work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">boss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Boss: Arrives at work\nBoss: Leaves work\nEmployee: Attaching doll eye #1\nEmployee: Attaching doll eye #2\n...\nEmployee: Attaching doll eye #100\nEmployee: Eye count final report</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, <code class=\"language-text\">boss</code> tells <code class=\"language-text\">employee</code> to attach <code class=\"language-text\">100</code> doll eyes and immediately leaves work.</p>\n<p>The parent process <code class=\"language-text\">boss</code> doesn’t care when <code class=\"language-text\">employee</code> finishes. The completion signal is handled by the <code class=\"language-text\">Eye count final report</code> task passed in as a callback.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/576918463dddd506e08ef5a97177dd7e/0f98f/async-non-block.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd6LAD//xAAVEAEBAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQABBQKn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAAIDAAAAAAAAAAAAAAAAEQABIDFB/9oACAEBAAE/ITaFBzH/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhMRAR/9oACAEBAAE/ENsVH3obXbAAAw44wyf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"async non block\" title=\"\" src=\"/static/576918463dddd506e08ef5a97177dd7e/c08c5/async-non-block.jpg\" srcset=\"/static/576918463dddd506e08ef5a97177dd7e/0913d/async-non-block.jpg 160w,\n/static/576918463dddd506e08ef5a97177dd7e/cb69c/async-non-block.jpg 320w,\n/static/576918463dddd506e08ef5a97177dd7e/c08c5/async-non-block.jpg 640w,\n/static/576918463dddd506e08ef5a97177dd7e/6a068/async-non-block.jpg 960w,\n/static/576918463dddd506e08ef5a97177dd7e/eea4a/async-non-block.jpg 1280w,\n/static/576918463dddd506e08ef5a97177dd7e/0f98f/async-non-block.jpg 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The boss gives orders and heads straight home</small>\n</center>\n<p>The async &#x26; non-blocking approach is efficient because it can handle multiple tasks simultaneously. However, overly tangled asynchronous processing can make it difficult for developers to follow the application’s flow. This is exactly why JavaScript introduced syntax like <code class=\"language-text\">Promise</code> and <code class=\"language-text\">async/await</code> — to make asynchronous flows clearer and more explicit.</p>\n<p>Also, even asynchronous approaches like Node.js’s event loop contain synchronous patterns under the hood, so overusing async can create bottlenecks somewhere.</p>\n<h3 id=\"asynchronous--blocking\" style=\"position:relative;\">Asynchronous + Blocking<a href=\"#asynchronous--blocking\" aria-label=\"asynchronous  blocking permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Finally, let’s look at the less common concept of asynchronous &#x26; blocking. This pattern isn’t commonly used at the application layer — it appears in low-level contexts like I/O multiplexing models in Linux and Unix operating systems. So let’s let our boss and employee go home and continue the explanation without them.</p>\n<p>At first glance, this combination might seem purely inefficient. The advantage of async is that by not waiting for child processes to finish, you can handle multiple tasks simultaneously. If the process is blocked and sits idle, it can’t process anything.</p>\n<p>But this concept emerged for good reasons:</p>\n<blockquote>\n<ol>\n<li>Synchronous &#x26; blocking I/O is intuitive but can’t handle multiple I/O operations simultaneously.</li>\n<li>Non-blocking I/O makes controlling processes tricky. (Most of these low-level programs are written in C — don’t think in terms of JS or Python.)</li>\n<li>Combining synchronous &#x26; blocking I/O with multi-processing or threading introduces resource issues and complex inter-process/thread communication and synchronization.</li>\n</ol>\n</blockquote>\n<p>So the idea was: “What if we just block the process and asynchronously multiplex multiple I/O operations into a single handler?” In other words, maintain an intuitive code flow while processing tasks concurrently.</p>\n<p>For reference, this is also covered in IBM’s 2006 post <a href=\"https://developer.ibm.com/articles/l-async/\" target=\"_blank\" rel=\"nofollow\">Boost application performance using asynchronous I/O</a>.</p>\n<center>\n  <img src=\"/0855a1508418e6ca6cb4b933f2dc3e61/async-block.gif\" width=\"100%\">\n  <br>\n  <small>Async + blocking workflow</small>\n  <br>\n  <br>\n</center>\n<p>In the diagram above, you’ll notice a <code class=\"language-text\">select()</code> function in the middle — this is the one that blocks the process while simultaneously handling multiple I/O operations. It’s provided as a C API; you can simply <code class=\"language-text\">include &lt;sys/select.h></code> and use it.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">select</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> nfds<span class=\"token punctuation\">,</span> fd_set <span class=\"token operator\">*</span>readfds<span class=\"token punctuation\">,</span> fd_set <span class=\"token operator\">*</span>writefds<span class=\"token punctuation\">,</span>\n    fd_set <span class=\"token operator\">*</span>exceptfds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> <span class=\"token operator\">*</span>timeout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Here, <code class=\"language-text\">nfds</code> is the number of files to monitor, and the <code class=\"language-text\">fd_set</code> structs represent file lists to watch for read data, written data, and exceptions respectively. “fd” stands for File Descriptor. When a monitored file triggers I/O, the corresponding value in its bit array structure is set to <code class=\"language-text\">1</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// If the 3rd file in the list has changes, the FD bit array structure is updated</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">timeout</code> argument (a timeval struct) specifies how long to monitor. In other words, <code class=\"language-text\">select</code> blocks the parent process for the duration specified in <code class=\"language-text\">timeout</code> while continuously watching its file list. During monitoring, if reads, writes, or exceptions occur on any files, <code class=\"language-text\">select</code> returns the number of files that need processing when it terminates.</p>\n<p>That’s roughly how <code class=\"language-text\">select</code> — the quintessential example of async &#x26; blocking — works. To summarize: it halts the process for a set duration, watches its monitored files for I/O, and when time is up, returns the I/O results and unblocks the process.</p>\n<p>This approach is intuitive for developers because it’s blocking, and because it’s asynchronous, it can monitor and handle multiple I/O operations simultaneously. However, the performance isn’t great, so IBM recommends avoiding it for high-performance applications.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I first learned about synchronous concepts in a networking course in college, but back then, my understanding was pretty shallow — just the idea that two devices communicate by aligning their clocks and frame sizes.</p>\n<p>But as I kept studying and working as a developer, I encountered the concept in different contexts — synchronous I/O, synchronous programming, and more. As I mentioned at the beginning, everyone had different interpretations: some said it means things happen at the same time, others said it’s about communicating on a clock, and still others described it as waiting for the previous task to finish. The inconsistency was confusing.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 86.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAL/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHXfVybGcIAD//EABoQAAEFAQAAAAAAAAAAAAAAAAEAAhAREiH/2gAIAQEAAQUC31jiVdRS0TIX/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGhAAAQUBAAAAAAAAAAAAAAAAEAERICExYf/aAAgBAQAGPwJeDHFR/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPyEbfzV15OuAl2zx+lzq672YDGJrLTYFcyPI8nqf/9oADAMBAAIAAwAAABCDxwD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEBAAMAAgMBAAAAAAAAAAABEQAhMVGxQXGB4f/aAAgBAQABPxAqlmUwUPb+PjBbeRb1yaxcBhKD+MQQojb5nDLghRBoDdYy7KV0S6h5XPfnb6c9mf/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dont know\" title=\"\" src=\"/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg\" srcset=\"/static/1ac47e8dbaafebf35dc0419285bce15f/0913d/dont-know.jpg 160w,\n/static/1ac47e8dbaafebf35dc0419285bce15f/cb69c/dont-know.jpg 320w,\n/static/1ac47e8dbaafebf35dc0419285bce15f/066f9/dont-know.jpg 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Why does everyone explain it differently...?</small>\n</center>\n<p>So while writing this post, I went back to studying what the word “Synchronous” actually means. Once I understood the nuance of the word, it became somewhat clear why all these different interpretations exist. Since the word itself carries an inherent meaning, it really does come down to interpretation.</p>\n<p>In any case, setting everything else aside, I think the biggest takeaway from this post is understanding that the word “Synchronous” carries the nuance of <strong>“things progressing identically at the same time.”</strong></p>\n<p>And with that, I’ll close this post on what synchronous really means.</p>","fields":{"slug":"20190919-sync-async-blocking-non-blockingen","path":"/2019/09/19/sync-async-blocking-non-blocking/en/","lang":"en"},"frontmatter":{"title":"What Does Synchronous Really Mean?","subTitle":"Clarifying the often-confused concepts of sync, async, blocking, and non-blocking","date":"Sep 19, 2019","categories":["Programming"],"tags":["Synchronous","Asynchronous","Blocking","Non Blocking","Asynchronous Programming"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/3a812/thumbnail.jpg","srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/3a812/thumbnail.jpg 320w,\n/static/e075bee6dfcc71a33568cd0ef7b6f61c/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/fc5c5/thumbnail.webp 320w,\n/static/e075bee6dfcc71a33568cd0ef7b6f61c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/2d839/thumbnail.jpg","srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/e075bee6dfcc71a33568cd0ef7b6f61c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"b5cefc10-4818-50e4-bcd7-5e5ea2dd30cd","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-randomness\">What Is Randomness?</a></p>\n</li>\n<li>\n<p><a href=\"#randomness-in-computers\">Randomness in Computers</a></p>\n<ul>\n<li><a href=\"#mid-square-method\">Mid-Square Method</a></li>\n<li><a href=\"#linear-congruential-method\">Linear Congruential Method</a></li>\n<li><a href=\"#mersenne-twister\">Mersenne Twister</a></li>\n<li><a href=\"#xor-shift\">XOR Shift</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about randomness. Randomness refers to a pattern where, when events occur, there’s no discernible regularity between one event and the next — a truly arbitrary sequence. The computers we use also need to generate random patterns from time to time, and they do. But a com…","html":"<p>In this post, I want to talk about randomness. Randomness refers to a pattern where, when events occur, there’s no discernible regularity between one event and the next — a truly arbitrary sequence. The computers we use also need to generate random patterns from time to time, and they do.</p>\n<p>But a computer is really just a fancy calculator. A calculator takes input values, juggles them around, and spits out a result. So how can such a machine produce random outcomes? Before we answer that question, we need to think about what randomness fundamentally is. Does true randomness even exist?</p>\n<h2 id=\"what-is-randomness\" style=\"position:relative;\">What Is Randomness?<a href=\"#what-is-randomness\" aria-label=\"what is randomness permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>As I mentioned above, randomness is a pattern that occurs without any discernible order.</p>\n<p>People may have different associations, but the first thing that comes to my mind is gambling. The most dangerous thing about gambling is the hope that “sure, I lost this round, but I could win the next one!” — and that hope stems from the belief that gambling games are fundamentally based on randomness. In other words, there has to be a significant element of luck involved.</p>\n<p>The thing is, I don’t know much about actual gambling games, so let me use something lighter as an example — a coin-flipping game. Imagine placing coins on a thick book, then slapping the book to try to flip them. The idea is that whoever flips all the coins to show the same face wins the pot. It’s hard to calculate exactly how many of the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> coins will flip when you slap the book, which makes it a game with a reasonable degree of randomness — and that’s what gives it the element of chance essential to gambling.</p>\n<p>So let me throw out that opening question again:</p>\n<blockquote>\n<p>Is this truly random?</p>\n</blockquote>\n<p>Even though it seems random, if you think about it, the game still operates within the laws of physics. If you knew the weight of each coin, the force of the slap, and the elasticity of the book, you could theoretically calculate which coins would flip. Of course, that kind of calculation isn’t easy — so even though it’s not random in the purest sense, we just say “close enough, let’s call it random.”</p>\n<p>In other words, true randomness is surprisingly rare even in our everyday lives. We just think things are random.</p>\n<h2 id=\"randomness-in-computers\" style=\"position:relative;\">Randomness in Computers<a href=\"#randomness-in-computers\" aria-label=\"randomness in computers permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Just as we label things “random” in daily life when they have a reasonable degree of unpredictability, computers don’t generate true randomness either — they produce a convincing enough level of unpredictability and call it random. On top of that, creating something on a computer requires defining rules, and the very idea of using rules to generate rule-less randomness is a contradiction.</p>\n<p>That’s why all we can really create is pseudo-random — something that’s not truly random but close enough. And since computers are fundamentally number-crunching calculators, generating random events requires the ability to produce random numbers.</p>\n<p>So how do computers actually generate these random numbers?</p>\n<h3 id=\"mid-square-method\" style=\"position:relative;\">Mid-Square Method<a href=\"#mid-square-method\" aria-label=\"mid square method permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The Mid-Square Method is a pseudo-random number generation technique devised by John von Neumann in 1949. The idea is simple: take a number, square it, then extract a portion from the middle of the result to use as the next random number.</p>\n<p>Let’s say we want to generate 4-digit random numbers, starting with <code class=\"language-text\">1234</code>:</p>\n<table>\n<thead>\n<tr>\n<th>Phase</th>\n<th>Input</th>\n<th>Squared</th>\n<th>Random Number</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>1234</td>\n<td>1522756</td>\n<td>1<strong>5227</strong>56</td>\n</tr>\n<tr>\n<td>1</td>\n<td>5227</td>\n<td>27321529</td>\n<td>27<strong>3215</strong>29</td>\n</tr>\n<tr>\n<td>2</td>\n<td>3215</td>\n<td>10336225</td>\n<td>10<strong>3362</strong>25</td>\n</tr>\n</tbody>\n</table>\n<p>You keep extracting the middle digits and squaring them to generate the next random number. It’s pretty obviously predictable, right? Well, this was developed in the 1950s when von Neumann was active, and computers of that era were painfully underpowered, so the simplest possible approach was necessary. That’s why this method is rarely used today.</p>\n<h3 id=\"linear-congruential-method\" style=\"position:relative;\">Linear Congruential Method<a href=\"#linear-congruential-method\" aria-label=\"linear congruential method permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The Linear Congruential Method is the algorithm used by C’s <code class=\"language-text\">rand</code> function. It’s defined by the following recurrence relation and returns a sequence of random numbers:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>X</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mo stretchy=\"false\">(</mo><mi>a</mi><msub><mi>X</mi><mi>n</mi></msub><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"></mspace><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">X_{n+1} = (aX_n + c) \\mod m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span></span></div>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span> is the sequence of random numbers and the rest are just arbitrary integers. For reference, the ANSI C standard specifies <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><msup><mn>2</mn><mn>31</mn></msup><mo separator=\"true\">,</mo><mi>a</mi><mo>=</mo><mn>1103515245</mn><mo separator=\"true\">,</mo><mi>c</mi><mo>=</mo><mn>12345</mn></mrow><annotation encoding=\"application/x-tex\">m = 2^{31}, a = 1103515245, c = 12345</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">31</span></span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1103515245</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">12345</span></span></span></span></span>. Let’s implement this in JavaScript:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> m <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">**</span> <span class=\"token number\">31</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1103515245</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">rand</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">*</span> a<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> c<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getRandomNumbers</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">randCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Use the current time as the initial seed.</span>\n  <span class=\"token keyword\">const</span> initial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> randomNumbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>initial<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> randCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    randomNumbers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span>randomNumbers<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  randomNumbers<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> randomNumbers<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">getRandomNumbers</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Paste this into your browser console and run it — you’ll get an array of random numbers with the length you specified as the argument.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1163074432</span><span class=\"token punctuation\">,</span> <span class=\"token number\">465823232</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1719475776</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1744670976</span><span class=\"token punctuation\">,</span> <span class=\"token number\">790949120</span><span class=\"token punctuation\">,</span> <span class=\"token number\">552540416</span><span class=\"token punctuation\">,</span> <span class=\"token number\">896259328</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1473241344</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1074855168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">575793408</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>A key characteristic of the Linear Congruential Method is that it uses the previously generated random number to produce the next one, and since it has at most <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span></span> possible values, it has a maximum period of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span></span> before repeating. That’s why I declared the <code class=\"language-text\">m</code> variable with <code class=\"language-text\">let</code>. Try assigning a small number to <code class=\"language-text\">m</code> in your browser console and calling <code class=\"language-text\">getRandomNumbers</code> again — you’ll notice duplicate values appearing much more frequently.</p>\n<p>The Linear Congruential Method has been widely used in computers since the early days because the computation is extremely simple and fast. However, it has a periodic cycle and correlations exist between generated numbers, meaning that if you know the last generated number and the other variables, you can predict all subsequent numbers.</p>\n<p>The problem is that those variables are defined by the ANSI C standard, so anyone can look them up. In other words, anyone with a bit of knowledge can observe the output of <code class=\"language-text\">rand</code> and predict the next random number.</p>\n<p>That’s why this algorithm is mainly used in situations where it doesn’t matter if the random numbers are predicted, or in constrained environments like embedded systems where memory is limited.</p>\n<h3 id=\"mersenne-twister\" style=\"position:relative;\">Mersenne Twister<a href=\"#mersenne-twister\" aria-label=\"mersenne twister permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The Mersenne Twister is a random number generation algorithm used in Excel, MATLAB, PHP, Python, R, C++, and many others. It was developed in 1997 by Makoto Matsumoto and Takuji Nishimura. The name comes from the fact that the algorithm’s period is a Mersenne prime.</p>\n<p>“Mersenne prime” might sound fancy, but it’s actually straightforward. A Mersenne number is <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>n</mi></msub><mo>=</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">M_n = 2^{n} - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7477em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span> — just 2 to the power of n, minus 1. A Mersenne prime is simply a Mersenne number that happens to be prime.</p>\n<p>The most commonly used variant is “MT19937,” which has a period of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>19937</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{19937} - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">19937</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>. C++ also uses this algorithm. Here’s a simplified overview of how it works:</p>\n<blockquote>\n<ol>\n<li>Use a seed to generate a vector of length 624. The seed is usually derived from hardware noise or the current date.</li>\n<li>Use this vector to produce 624 pseudo-random numbers.</li>\n<li>Apply noise to the vector and repeat step 2. This noise application is called “twisting.”</li>\n</ol>\n</blockquote>\n<p>The twisting step uses a technique called GFSR (Generalized Feedback Shift Register). There isn’t much accessible material on GFSR — most of it is academic papers — so I wasn’t able to dig into it deeply. But after some extensive Googling and poring over papers, I found that it appears to be a variation of LFSR (Linear Feedback Shift Register). <small>(Information was so limited that I’m not 100% certain it’s LFSR-based.)</small></p>\n<p>LFSR takes previous state values, runs them through a linear function, and uses the result to generate the next value. The function typically used is XOR, and the initial value is called the seed.</p>\n<img src=\"/ad9106cf75abf61d96aea27d0f40cef7/lfsr.gif\" width=\"100%\">\n<p>Here’s a brief explanation of LFSR: you designate a few memory addresses and push an initialized input (the seed) into the register. The bits shift one position to the right, and you get one bit popping out at the end as output. Then you access the pre-designated memory addresses, extract their values, and pass them through three XOR gates in sequence to produce the next input, which you push back into the register. Repeat.</p>\n<p>Since the Mersenne Twister uses GFSR — a slight variation of LFSR — to generate random numbers, it also requires an initial seed.</p>\n<p>For the detailed algorithm, check the Wikipedia article on <a href=\"https://en.wikipedia.org/wiki/Mersenne_Twister#Algorithmic_detail\" target=\"_blank\" rel=\"nofollow\">Mersenne Twister - Algorithmic detail</a>. I ported the C implementation of MT19937 — which Matsumoto and Nishimura revised and improved in 2002 — to JavaScript. This code is designed for 32-bit random numbers. There’s a separate 64-bit version called MT19937-64.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">N</span> <span class=\"token operator\">=</span> <span class=\"token number\">624</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">M</span> <span class=\"token operator\">=</span> <span class=\"token number\">397</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">F</span> <span class=\"token operator\">=</span> <span class=\"token number\">1812433253</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">UPPER_MASK</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">**</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0x80000000</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">LOWER_MASK</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UPPER_MASK</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0x7fffffff</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">MATRIX_A</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x9908b0df</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MersenneTwister</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> initSeed <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token constant\">N</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token constant\">N</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">seedMt</span><span class=\"token punctuation\">(</span>initSeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">seedMt</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">seed</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> s<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> seed <span class=\"token operator\">>>></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">F</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>>></span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xffffffff</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">int</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> y<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> mag01 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MATRIX_A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">>=</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> kk<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">===</span> <span class=\"token constant\">N</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">seedMt</span><span class=\"token punctuation\">(</span><span class=\"token number\">5489</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>kk <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> kk <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span> <span class=\"token operator\">-</span> <span class=\"token constant\">M</span><span class=\"token punctuation\">;</span> kk<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">UPPER_MASK</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">LOWER_MASK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk <span class=\"token operator\">+</span> <span class=\"token constant\">M</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">>>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> mag01<span class=\"token punctuation\">[</span>y <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span> kk <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> kk<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">UPPER_MASK</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">LOWER_MASK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span>kk <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">M</span> <span class=\"token operator\">-</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">>>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> mag01<span class=\"token punctuation\">[</span>y <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token constant\">N</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">UPPER_MASK</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token constant\">LOWER_MASK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token constant\">N</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token constant\">M</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">>>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> mag01<span class=\"token punctuation\">[</span>y <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    y <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mt<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    y <span class=\"token operator\">^=</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">>>></span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    y <span class=\"token operator\">^=</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x9d2c5680</span><span class=\"token punctuation\">;</span>\n    y <span class=\"token operator\">^=</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xefc60000</span><span class=\"token punctuation\">;</span>\n    y <span class=\"token operator\">^=</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">>>></span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> y <span class=\"token operator\">>>></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The constants used in the code — <code class=\"language-text\">F = 1812433253</code>, <code class=\"language-text\">MATRIX_A = 0x9908b0df</code>, <code class=\"language-text\">this.seedMt(5489)</code> — aren’t numbers I chose arbitrarily. They’re standard coefficients defined in the MT19937 specification.</p>\n<p>Honestly, the algorithm is so complex that I don’t fully understand all of it myself. <small>(The price of not studying harder in college…)</small> Still, writing it out as code gives you a much better grasp than just reading about it, which is why I ported the original C code to JavaScript. The C library code I referenced can be found <a href=\"http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/CODES/mt19937ar.c\" target=\"_blank\" rel=\"nofollow\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> rand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MersenneTwister</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rand<span class=\"token punctuation\">.</span><span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2145258025</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Running the code, it seems to generate random numbers just fine. To properly verify randomness you’d need to visualize the results and examine the distribution, but I’ll skip that for now. By the way, if you visit the homepage of <a href=\"http://www.math.sci.hiroshima-u.ac.jp/~m-mat/eindex.html\" target=\"_blank\" rel=\"nofollow\">Makoto Matsumoto</a>, who created this algorithm, you can find the story behind how it got its name:</p>\n<blockquote>\n<p><strong>Makoto</strong>: Professor Knuth says it’s too hard to pronounce the name.<br />\n<strong>Takuji</strong>: …</p>\n<p>[A few days later]</p>\n<p><strong>Makoto</strong>: Hey Takun, how about Mersenne Twister? It uses Mersenne primes, and the original is a Twisted GFSR (Generalized Feedback Shift Register).<br />\n<strong>Takuji</strong>: Hmm…?<br />\n<strong>Makoto</strong>: Doesn’t it sound like a roller coaster? It sounds fast, it’s easy to remember, and easy to pronounce. And here’s a secret — our initials are hidden in the name! (Makoto, Takuji)<br />\n<strong>Takuji</strong>: …<br />\n<strong>Makoto</strong>: Come on, let’s go with MT!<br />\n<strong>Takuji</strong>: …Fine.</p>\n<p>Later, we received a letter from Professor Knuth saying “it seems like a good name.”</p>\n</blockquote>\n<p>You can really feel the dynamic between the bubbly Makoto and the deadpan Takuji. It’s nice to see that even the creators of such a brilliant algorithm have this very human side to them.</p>\n<h3 id=\"xor-shift\" style=\"position:relative;\">XOR Shift<a href=\"#xor-shift\" aria-label=\"xor shift permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>XOR Shift, like the Mersenne Twister, is a pseudo-random number algorithm based on LFSR. You could think of it as a lighter alternative to the Mersenne Twister — the principle is similar, but the implementation is much simpler and faster, so it sees plenty of use.</p>\n<p>There are several variants of the XOR Shift algorithm, using 32-bit, 64-bit, or 128-bit numbers, with periods of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{32} -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>64</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{64} - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">64</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>128</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{128} - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">128</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span> (all Mersenne numbers) respectively.</p>\n<p>The problem was that it couldn’t pass TestU01, a random number quality testing framework. Passing TestU01 is a requirement for becoming an ANSI C standard.</p>\n<p>This led to several variant algorithms, one of which is XOR Shift 128+ — an improvement on the 128-bit XOR Shift 128. <small>(Sounds like a video game sequel title…)</small></p>\n<p>As it happens, XOR Shift 128+ is the random number generation algorithm adopted by major JavaScript engines including V8, SpiderMonkey, and JavaScriptCore. This algorithm was presented by Sebastiano Vigna at a conference in November 2016. The paper can be found <a href=\"http://vigna.di.unimi.it/ftp/papers/xorshiftplus.pdf\" target=\"_blank\" rel=\"nofollow\">here</a>.</p>\n<p>The overall principle is similar to the LFSR I explained above, so let’s look at how V8 implements <code class=\"language-text\">Math.random</code>. The original code is written in C++, but I’ve ported the same logic to JavaScript so you can easily run it in your browser.</p>\n<p>V8’s XOR Shift 128+ algorithm can be found in <a href=\"https://github.com/v8/v8/blob/main/src/base/utils/random-number-generator.h#L119C71-L120C1\" target=\"_blank\" rel=\"nofollow\">v8/src/base/utils/random-number-generator.h</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// xorshift128plus.js</span>\n<span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1827981275</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1295982171</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">xorshift128plus</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> s1 <span class=\"token operator\">=</span> state<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> s0 <span class=\"token operator\">=</span> state<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  state<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> s0<span class=\"token punctuation\">;</span>\n  s1 <span class=\"token operator\">^=</span> s1 <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">23</span><span class=\"token punctuation\">;</span>\n  s1 <span class=\"token operator\">^=</span> s1 <span class=\"token operator\">>></span> <span class=\"token number\">17</span><span class=\"token punctuation\">;</span>\n  s1 <span class=\"token operator\">^=</span> s0<span class=\"token punctuation\">;</span>\n  state<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> s1<span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Current register state -> '</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> state<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Initial register state -> '</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Random number -> '</span><span class=\"token punctuation\">,</span> <span class=\"token function\">xorshift128plus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Initial register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">1827981275</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1295982171</span> <span class=\"token punctuation\">]</span>\nCurrent register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">1295982171</span><span class=\"token punctuation\">,</span> <span class=\"token number\">867440954</span> <span class=\"token punctuation\">]</span>\nRandom number <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token number\">2163423125</span>\nCurrent register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">867440954</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1393243966</span> <span class=\"token punctuation\">]</span>\nRandom number <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token number\">2260684920</span>\nCurrent register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">1393243966</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37812574</span> <span class=\"token punctuation\">]</span>\nRandom number <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token number\">1431056540</span>\nCurrent register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">37812574</span><span class=\"token punctuation\">,</span> <span class=\"token number\">833890405</span> <span class=\"token punctuation\">]</span>\nRandom number <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token number\">871702979</span>\nCurrent register state <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token punctuation\">[</span> <span class=\"token number\">833890405</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1661667227</span> <span class=\"token punctuation\">]</span>\nRandom number <span class=\"token operator\">-</span><span class=\"token operator\">></span>  <span class=\"token number\">2495557632</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Looking at the output, you can see how the register state changes over time.</p>\n<p>The value at index <code class=\"language-text\">[1]</code> moves to index <code class=\"language-text\">[0]</code>, a new random number is placed at index <code class=\"language-text\">[1]</code>, and the two elements are added together for the output.</p>\n<p>When inserting the new value at index <code class=\"language-text\">[1]</code>, it uses the shifted-out value from index <code class=\"language-text\">[0]</code> to perform XOR shifting, then places the result back at index <code class=\"language-text\">[1]</code>.</p>\n<p>The shifting constants <code class=\"language-text\">23</code> and <code class=\"language-text\">17</code> were discovered through research during the development of the XOR Shift 128+ algorithm — they’re the optimal constants found through testing. The paper includes detailed tables comparing the results of various different constants they tried.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>I originally started this post thinking it would be a light discussion about randomness, but it ended up being heavier on the math than I expected.</p>\n<p>The truth is, generating truly random numbers with a computer — which is just a calculator — is virtually impossible. Recently, researchers in the US reportedly succeeded in generating true random numbers using a quantum computer, but quantum computing is still a distant reality for most of us, so I’ll leave that aside.</p>\n<p>I’m not exactly a math enthusiast myself. But seeing the many people who have taken on the challenge of creating orderless random numbers through mathematical research, I feel genuinely grateful as someone who comfortably codes at higher abstraction layers. <small>(I could never do what they do…)</small></p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/4b190/thanks.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 86.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAQBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFtswTKxRyQpB//xAAeEAACAgAHAAAAAAAAAAAAAAABAgADBBESEzEyM//aAAgBAQABBQIVFpUldj6QGXhSFbZGZmI9E6//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAeEAACAgICAwAAAAAAAAAAAAABAgAxESEDECKBof/aAAgBAQAGPwJnY4UGeNCwYwrcbjKnA+zQ2YTmzDE99f/EAB0QAAMAAgIDAAAAAAAAAAAAAAABESExEHFRgbH/2gAIAQEAAT8hyA5S4ZvuPgSOeGnpF7nHWhKs6BUT2h8OG1n/2gAMAwEAAgADAAAAEBMPAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQEAAwACAwAAAAAAAAAAAAERACExYfAQceH/2gAIAQEAAT8QNdEUtY7mbrYqXbUJ5xNgnKwwIEwQz1dAt/MCsCFCQliW4ZAU7NWa74zj278B7PrP/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"thanks\" title=\"\" src=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/c08c5/thanks.jpg\" srcset=\"/static/4ac69e39a60e61a01bddd4634b5d04ee/0913d/thanks.jpg 160w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/cb69c/thanks.jpg 320w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/c08c5/thanks.jpg 640w,\n/static/4ac69e39a60e61a01bddd4634b5d04ee/4b190/thanks.jpg 800w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>If the researchers build the foundational algorithms, I'll put them to good use in production applications...!!!</small>\n</center>\n<p>While writing this post, I spent a lot of time staring at papers and Wikipedia — my brain is overloaded from too much English and too many formulas. And the Mersenne Twister in particular… seriously, it’s insanely complex.</p>\n<p>By the way, Makoto Matsumoto, who created it, is currently an associate professor at Hiroshima University’s mathematics graduate school. It makes me wonder just how brilliant you have to be to stand at that podium. A completely different level…</p>\n<p>That wraps up this post on whether the randomness computers create is actually random.</p>\n<hr>\n<p>References</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Xorshift#xorshift+\" target=\"_blank\" rel=\"nofollow\">XorShift - Wikipedia</a><br />\n<a href=\"https://v8.dev/blog/math-random\" target=\"_blank\" rel=\"nofollow\">There’s Math.random(), and then There’s Math.random() - V8 Dev</a><br />\n<a href=\"http://vigna.di.unimi.it/ftp/papers/xorshiftplus.pdf\" target=\"_blank\" rel=\"nofollow\">Further scramblings of Marsaglia’s xorshift generators - Sebastiano Vigna</a><br />\n<a href=\"https://lemire.me/blog/2017/09/08/the-xorshift128-random-number-generator-fails-bigcrush/\" target=\"_blank\" rel=\"nofollow\">The Xorshit128+ random number generator fails BigCrush - Daniel Lemire</a></p>","fields":{"slug":"20190714-what-is-random-en","path":"/2019/07/14/what-is-random/en/","lang":"en"},"frontmatter":{"title":"Is the Randomness Your Computer Creates Actually Random?","subTitle":"Mid-Square Method, Linear Congruential Method, Mersenne Twister — the secrets behind random number generation algorithms","date":"Jul 14, 2019","categories":["Programming","Algorithm"],"tags":["Algorithm","Random Number Generation","Mersenne Twister","Real Random","JavaScript","Math","Cryptography"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/a801f480d325ee0f4ce6bccd0622d392/3a812/thumbnail.jpg","srcSet":"/static/a801f480d325ee0f4ce6bccd0622d392/3a812/thumbnail.jpg 320w,\n/static/a801f480d325ee0f4ce6bccd0622d392/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/a801f480d325ee0f4ce6bccd0622d392/fc5c5/thumbnail.webp 320w,\n/static/a801f480d325ee0f4ce6bccd0622d392/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/a801f480d325ee0f4ce6bccd0622d392/2d839/thumbnail.jpg","srcSet":"/static/a801f480d325ee0f4ce6bccd0622d392/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/a801f480d325ee0f4ce6bccd0622d392/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"903e28d3-c3a1-5cde-90da-2d3a97bb77cf","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-the-v8-engine\">What Is the V8 Engine?</a></p>\n</li>\n<li>\n<p><a href=\"#how-the-v8-engine-works\">How the V8 Engine Works</a></p>\n<ul>\n<li><a href=\"#parsing-understanding-what-the-code-means\">Parsing: Understanding What the Code Means</a></li>\n<li><a href=\"#generating-bytecode-with-ignition\">Generating Bytecode with Ignition</a></li>\n<li><a href=\"#cooling-down-hot-code-with-turbofan\">Cooling Down Hot Code with TurboFan</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V…","html":"<p>In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V8’s actual source code.</p>\n<h2 id=\"what-is-the-v8-engine\" style=\"position:relative;\">What Is the V8 Engine?<a href=\"#what-is-the-v8-engine\" aria-label=\"what is the v8 engine permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The V8 engine is a high-performance JavaScript &#x26; WebAssembly engine written in C++, led by Google. It’s also open source, so you can clone it from the <a href=\"https://github.com/v8/v8\" target=\"_blank\" rel=\"nofollow\">V8 engine GitHub repository</a>. It’s currently used in Google Chrome and Node.js, and implements the ECMAScript and WebAssembly standards.</p>\n<p>As of June 28, 2019, if you check the <a href=\"https://compat-table.github.io/compat-table/es2016plus/\" target=\"_blank\" rel=\"nofollow\">Kangax Table</a>, you can see that CH (Chromium) and Node — both powered by V8 — have implemented nearly all ES2016+ features, while Microsoft’s Chakra and Mozilla’s SpiderMonkey still have noticeable gaps marked in red.</p>\n<blockquote>\n<p>To improve compatibility with other platforms and reduce mutual risk, Microsoft Edge will now use the V8 engine as part of this change. We still have a lot to learn, but we’re excited to become part of the V8 community and to contribute to this project.</p>\n<p><strong>ChakraCore team</strong> <em><a href=\"https://github.com/Microsoft/ChakraCore/issues/5865\" target=\"_blank\" rel=\"nofollow\">ChakraCore Github Issue</a></em></p>\n</blockquote>\n<p>As it happens, the Edge browser — which had been using the Chakra engine — has announced it will adopt V8 as part of joining the Chromium open-source project. Whether this is good or bad… I’m not quite sure yet.</p>\n<p>If you want to build V8 yourself and actually debug it, you can’t just clone it with git. If you want to go that far, check out the V8 official site’s <a href=\"https://v8.dev/docs/source-code\" target=\"_blank\" rel=\"nofollow\">Checking out the V8 source code</a>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAWqmWguiFRl//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIABBETIf/aAAgBAQABBQLYGCvstkqh9Sqx5//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/Aaf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEJ/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAESMRARQVH/2gAIAQEABj8CJuV4TXpt2X0//8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFRQfH/2gAIAQEAAT8hoZUK3AiejiFgexiaXKdd9QbNCP/aAAwDAQACAAMAAAAQIz//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAwEBPxCD/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/ENFj/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBYbHR/9oACAEBAAE/EKLyBDy1bKKN9MM0wCZHUVaOyn5NGIgL516gUVkB2iif/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme1\" title=\"\" src=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg\" srcset=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/0913d/meme1.jpg 160w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/cb69c/meme1.jpg 320w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg 640w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg 743w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Chromium is such a massive project that just the installation process for building is quite demanding</small>\n</center>\n<p>I’ve set it up once before, and as you might expect, it didn’t go smoothly — so I recommend attempting it on a weekend when you have plenty of time. Since I’ll only be analyzing the source code this time, I simply cloned it using git.</p>\n<h2 id=\"how-the-v8-engine-works\" style=\"position:relative;\">How the V8 Engine Works<a href=\"#how-the-v8-engine-works\" aria-label=\"how the v8 engine works permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In general, when using JavaScript, you don’t need to think deeply about low-level details like how the engine works. After all, the whole point of using an engine is so developers don’t have to worry about such things. But if you truly want to squeeze the best possible performance out of JavaScript, you need at least some understanding of how your code is executed.</p>\n<p>Let’s start with a simple diagram showing how V8 interprets and executes our JavaScript source code. I’ll explain the details below, so for now, just get a general feel for the flow.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVR42nVSO27cMBT04XIJH8MHSJHWvoNLH8BFgJQBUqQIDBd2s81+tZBISqT4E0VSVIbSOrEE7NsnAsvH4ZsZvpvxevR97xwW37nedh12hmFI45imwN+ba0iUWylZXe/3+6Io2lbO+yGOMd8wLsAhBGMsWjnnpJTH47EsS8YYIaQihHOBMz++P989Hr8+vv75/XMBBhJ4HNVaNzxHHKKxFsS7zlmbab+8vn35tru9fy+L/QKMQ9paqRTA2hhQLasKRIRo9bQ1H3t4bp5+qaw/pYXm7EdK8wqj6roB7c1mg4uUUpce2UO/1rwKyihjtZpYYEVmF+e8+PUBRivI673P5MH5VPCaj/PxqYqnQmnS36W0dBtWCSG22y1M5g2n+Hl+NmckdVRYYbQ5nU6ogor3YQGOMUIVyU/Cjbbaa+XVPAzCC2oo2BOKOpVSodOadohRtC3edvIrrQYGLgKJmYlTeUU72s5hpOqmgbphWIBxL+zAmyHxCqC5AHvvIQaytVLGdgPn2Bo/JHkoYmy32x0OB0opOl3Acw+AIQYziJDaDE0zns+XLMsgVYkRJQS0q4r812xN3zIKJR4XxojP/+v5STOKuRQCFIMjnFdK/QX7NF/0AdGOjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"v8compiler pipeline\" title=\"\" src=\"/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png\" srcset=\"/static/27979b3d2674a00f5b68af5f303fb27c/69538/v8compiler-pipeline.png 160w,\n/static/27979b3d2674a00f5b68af5f303fb27c/72799/v8compiler-pipeline.png 320w,\n/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png 640w,\n/static/27979b3d2674a00f5b68af5f303fb27c/d9199/v8compiler-pipeline.png 960w,\n/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png 1019w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Slides from Franziska Hinkelmann's presentation at JSConf EU 2017</small>\n</center>\n<p>V8 takes our source code and first hands it to the <code class=\"language-text\">Parser</code>. The parser analyzes the source code and transforms it into an <code class=\"language-text\">AST (Abstract Syntax Tree)</code>.</p>\n<p>Next, this AST is passed to <code class=\"language-text\">Ignition</code>, which is an interpreter that converts JavaScript into bytecode. By converting the original source into bytecode — a form much easier for the computer to interpret — V8 avoids the overhead of re-parsing the original code, reduces the amount of code, and saves memory during execution.</p>\n<p>The bytecode is then executed, making our source code actually run. Among the executed code, frequently used portions are sent to <code class=\"language-text\">TurboFan</code>, where they’re recompiled into <code class=\"language-text\">Optimized Machine Code</code>. If that code later becomes less frequently used, it gets deoptimized.</p>\n<p>An interesting detail is that many of V8’s components are named after real engine parts. The V8 engine is actually a type of engine commonly found in high-performance cars — named because eight pistons are arranged in a V shape, driving a single crankshaft.</p>\n<p><code class=\"language-text\">Ignition</code> refers to the igniter used to start an engine. Your source code is revving up and running. And when it gets called too many times and your code starts running hot, <code class=\"language-text\">TurboFan</code> optimizes it — cooling things down so it doesn’t overheat.</p>\n<p>If you’ve read other V8 analysis posts, you may have also seen components called <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. The name <code class=\"language-text\">Crankshaft</code> also comes from real engines — it’s the core component connected to the pistons that converts their reciprocating motion into rotational motion. But as of June 19, 2019, these components can no longer be found in V8.</p>\n<blockquote>\n<p>Starting with V8 v5.9, Ignition and TurboFan are used across the board for JavaScript execution. Additionally, starting with V8 v5.9, Full-codegen and Crankshaft — technologies that have served V8 well — are no longer used in V8, as they were unable to keep up with new JavaScript features and the optimizations those features demand. We plan to remove them entirely soon, which means V8 will have a much simpler and more maintainable architecture going forward.</p>\n<p><strong>V8 team</strong> <em><a href=\"https://v8.dev/blog/launching-ignition-and-turbofan\" target=\"_blank\" rel=\"nofollow\">Launching Ignition and TurboFan</a></em></p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 509px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAADBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFx+lmwZkn/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQMREiH/2gAIAQEAAQUCcVmDI+Ipn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwG6r//EABcQAQEBAQAAAAAAAAAAAAAAAAAxECH/2gAIAQEABj8C4irv/8QAHBAAAwABBQAAAAAAAAAAAAAAAAERUSFhgbHw/9oACAEBAAE/IUV2LyKz5QugmW5Lcnmn/9oADAMBAAIAAwAAABBjP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCYj//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EAp//8QAGxABAQEBAAMBAAAAAAAAAAAAAREhADFBYZH/2gAIAQEAAT8QQrJ6HKlMVGY/nSyHzTmGgRR5Y15drE3PXQyD9x3/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bye\" title=\"\" src=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" srcset=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/0913d/bye.jpg 160w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/cb69c/bye.jpg 320w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg 509w\" sizes=\"(max-width: 509px) 100vw, 509px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Yep. They were replaced starting from V8 v5.9.</small>\n</center>\n<p>Before v5.9, <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> coexisted alongside the newer components — but this wasn’t by choice. Early versions of <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> didn’t perform as well as expected, and there were issues where optimized code couldn’t be directly deoptimized back to bytecode, so the V8 team had no choice but to keep <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> around as fallbacks.</p>\n<p>The V8 team’s original goal was always to use only <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code>, freely moving between <code class=\"language-text\">bytecode ↔ optimized code</code>.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe title=\"\" src=\"https://www.youtube.com/embed/r5OWCtuKiAk?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" loading=\"eager\" allowfullscreen=\"\" sandbox=\"allow-same-origin allow-scripts allow-popups\"></iframe> </div> </div>\n<br /></p>\n<p>This video is from BlinkOn 2016, where <strong>Ross McIlroy</strong> of the Chrome Mobile Performance London Team introduces <code class=\"language-text\">Ignition</code>. The 9:47–11:14 segment explains the unfortunate reasons they couldn’t remove the legacy <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. He seems to find it funny himself while explaining.</p>\n<p>Now let’s take a brief look at how V8 actually parses and executes JavaScript.</p>\n<h3 id=\"parsing-understanding-what-the-code-means\" style=\"position:relative;\">Parsing: Understanding What the Code Means<a href=\"#parsing-understanding-what-the-code-means\" aria-label=\"parsing understanding what the code means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Parsing is the process of loading source code and transforming it into an AST (Abstract Syntax Tree). The AST is a data structure widely used in compilers — think of it as restructuring the source code we write into a form that’s easy for the computer to understand.</p>\n<p>For example, if we were to parse JavaScript with JavaScript, it would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// The code above can be roughly structured like this:</span>\n\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'FunctionDeclaration'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'hello'</span>\n  <span class=\"token literal-property property\">arguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'Variable'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'name'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Laid out like this, it’s simpler than you might expect. But this is just one example — the parser also has to interpret and parse syntax like <code class=\"language-text\">for</code>, <code class=\"language-text\">if</code>, <code class=\"language-text\">a = 1 + 2</code>, <code class=\"language-text\">function () {}</code>, and so on. That’s why the parser’s internals are surprisingly large. V8’s <code class=\"language-text\">parser.cc</code> file alone exceeds 3,000 lines.</p>\n<p>In any case, just remember that parsing is the process of converting code into an AST — a form that’s easy for the computer to analyze. The V8 engine does exactly what we just illustrated in JavaScript, but using C++.</p>\n<p>Let’s take a look at the method in V8’s parsing code that handles literal arithmetic expressions like <code class=\"language-text\">1 + 2</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token keyword\">bool</span> <span class=\"token class-name\">Parser</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShortcutNumericLiteralBinaryExpression</span><span class=\"token punctuation\">(</span>Expression<span class=\"token operator\">*</span><span class=\"token operator\">*</span> x<span class=\"token punctuation\">,</span> Expression<span class=\"token operator\">*</span> y<span class=\"token punctuation\">,</span> Token<span class=\"token double-colon punctuation\">::</span>Value op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> y<span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">double</span> x_val <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">double</span> y_val <span class=\"token operator\">=</span> y<span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>op<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>ADD<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">+</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>SUB<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">-</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is a static method called <code class=\"language-text\">ShortcutNumericLiteralBinaryExpression</code> <em>(what a mouthful…)</em> on the <code class=\"language-text\">Parser</code> class, declared in V8’s <code class=\"language-text\">parser.cc</code>.</p>\n<p>Looking at the parameters: <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> are <code class=\"language-text\">Expression</code> objects representing the values used in the expression. <code class=\"language-text\">op</code> represents the actual operation — whether the expression means <code class=\"language-text\">x + y</code> or <code class=\"language-text\">x - y</code> — along with its type. <code class=\"language-text\">pos</code> indicates the position of the code currently being parsed within the overall source.</p>\n<p>As explained above, this method is called when it encounters source code like <code class=\"language-text\">1 + 2</code>. You can see it inspecting the expression against conditions like <code class=\"language-text\">Token::ADD</code> and <code class=\"language-text\">Token::SUB</code> and parsing accordingly. The “tokens” here are string fragments produced by lexically analyzing the source code according to JavaScript’s grammar rules.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Tokens look roughly like this</span>\n<span class=\"token punctuation\">[</span><span class=\"token string\">'const'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>After the calculation, the resulting value is turned into an AST node using the <code class=\"language-text\">AstNodeFactory</code> class’s <code class=\"language-text\">NewNumberLiteral</code> static method.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/ast/ast.cc</span>\nLiteral<span class=\"token operator\">*</span> <span class=\"token class-name\">AstNodeFactory</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> number<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> int_value<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DoubleToSmiInteger</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>int_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">NewSmiLiteral</span><span class=\"token punctuation\">(</span>int_value<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>zone_<span class=\"token punctuation\">)</span> <span class=\"token function\">Literal</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>During this process, V8 identifies the meaning of code elements like variables, functions, and conditionals. JavaScript’s scoping — something we’re all familiar with — is also established during this phase. For more details on variable declarations, see <a href=\"/2019/06/18/javascript-let-const\">JavaScript’s let and const, and TDZ</a>.</p>\n<h3 id=\"generating-bytecode-with-ignition\" style=\"position:relative;\">Generating Bytecode with Ignition<a href=\"#generating-bytecode-with-ignition\" aria-label=\"generating bytecode with ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/3ef804b01e47419b1954df82e079ed32/ignition.svg\" width=\"300\">\n  <br>\n</center>\n<p>Bytecode is an intermediate representation produced by compiling high-level source code into a form that a virtual machine can understand more easily. In V8, <code class=\"language-text\">Ignition</code> is responsible for this.</p>\n<h4 id=\"what-is-ignition\" style=\"position:relative;\">What Is Ignition?<a href=\"#what-is-ignition\" aria-label=\"what is ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">Ignition</code> is an interpreter that completely replaces the legacy <code class=\"language-text\">Full-codegen</code>. The old <code class=\"language-text\">Full-codegen</code> compiled the entire source code at once. As mentioned earlier, the V8 team recognized that <code class=\"language-text\">Full-codegen</code>’s approach of compiling all source code at once consumed a significant amount of memory.</p>\n<p>Additionally, since JavaScript is a dynamically typed language — unlike statically typed languages like C++ — there were too many unknowns before runtime, making optimization with this approach extremely difficult.</p>\n<p>So when developing <code class=\"language-text\">Ignition</code>, they opted for an interpreter-based approach that processes code line by line as it executes, rather than compiling everything at once, aiming for three key benefits:</p>\n<blockquote>\n<ol>\n<li><strong>Reduced memory usage.</strong> Compiling JavaScript to bytecode is more efficient than compiling directly to machine code.</li>\n<li><strong>Reduced parsing overhead.</strong> Bytecode is concise, making it easier to re-parse.</li>\n<li><strong>Reduced compilation pipeline complexity.</strong> Both optimization and deoptimization only need to deal with bytecode, simplifying everything.</li>\n</ol>\n<p><strong>Ross McIlroy</strong> <em>Ignition - an interpreter for V8</em></p>\n</blockquote>\n<p>Just remember that <code class=\"language-text\">Ignition</code> is the component that converts code to bytecode line by line as it executes.</p>\n<p>So what does bytecode actually look like, and why is it easier for the computer to interpret? Let’s take the <code class=\"language-text\">hello</code> function from earlier and see what bytecode it generates.</p>\n<h4 id=\"viewing-the-bytecode-yourself\" style=\"position:relative;\">Viewing the Bytecode Yourself<a href=\"#viewing-the-bytecode-yourself\" aria-label=\"viewing the bytecode yourself permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// If the code isn't used, it won't be interpreted to bytecode, so we need to call it.</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you’re using Node.js v8.3+, you can add the <code class=\"language-text\">--print-bytecode</code> flag to see how your source code was interpreted into bytecode. Alternatively, you could use V8’s D8 debugging tool, but that requires building V8 — and as I mentioned, the build setup isn’t exactly smooth. So I just used <code class=\"language-text\">--print-bytecode</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --print-bytecode add.js\n<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span>generated bytecode <span class=\"token keyword\">for</span> function: hello<span class=\"token punctuation\">]</span>\nParameter count <span class=\"token number\">2</span>\nFrame size <span class=\"token number\">8</span>\n   <span class=\"token number\">15</span> E<span class=\"token operator\">></span> 0x2ac4000d47b2 @    <span class=\"token number\">0</span> <span class=\"token builtin class-name\">:</span> a0                StackCheck\n   <span class=\"token number\">30</span> S<span class=\"token operator\">></span> 0x2ac4000d47b3 @    <span class=\"token number\">1</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">12</span> 00             LdaConstant <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n         0x2ac4000d47b5 @    <span class=\"token number\">3</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">26</span> fb             Star r0\n         0x2ac4000d47b7 @    <span class=\"token number\">5</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             Ldar a0\n   <span class=\"token number\">46</span> E<span class=\"token operator\">></span> 0x2ac4000d47b9 @    <span class=\"token number\">7</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">32</span> fb 00          Add r0, <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">53</span> S<span class=\"token operator\">></span> 0x2ac4000d47bc @   <span class=\"token number\">10</span> <span class=\"token builtin class-name\">:</span> a4                Return\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is what the <code class=\"language-text\">hello</code> function looks like after being converted to bytecode. Wait — I only used one parameter, <code class=\"language-text\">name</code>, but the <code class=\"language-text\">Parameter count</code> says <code class=\"language-text\">2</code>.</p>\n<p>One of them is the implicit receiver, <code class=\"language-text\">this</code>. If you use <code class=\"language-text\">this</code> inside a function to refer to the function itself — yes, it’s that <code class=\"language-text\">this</code>. Below that, you can see values being assigned to registers. Let me explain briefly.</p>\n<p>For those who might not be familiar: a register is high-speed memory built into the CPU, and an accumulator is a register used to store intermediate calculation results.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">StackCheck</code>: Checks the upper limit of the stack pointer. If the stack exceeds the threshold, a Stack Overflow occurs and function execution is halted.</li>\n<li><code class=\"language-text\">LdaConstant [0]</code>: <code class=\"language-text\">Ld</code> stands for <code class=\"language-text\">Load</code>. It loads a constant into the accumulator. This constant is <code class=\"language-text\">Hello,</code>.</li>\n<li><code class=\"language-text\">Star r0</code>: Moves the value in the accumulator to register <code class=\"language-text\">r0</code>. <code class=\"language-text\">r0</code> is a register for local variables.</li>\n<li><code class=\"language-text\">Ldar a0</code>: Loads the value from register <code class=\"language-text\">a0</code> into the accumulator. In this case, <code class=\"language-text\">a0</code> holds the argument <code class=\"language-text\">name</code>.</li>\n<li><code class=\"language-text\">Add r0, [0]</code>: Adds <code class=\"language-text\">Hello,</code> from <code class=\"language-text\">r0</code> and <code class=\"language-text\">0</code>, storing the result in the accumulator. The constant <code class=\"language-text\">0</code> is mapped to the argument <code class=\"language-text\">name</code> at runtime.</li>\n<li><code class=\"language-text\">Return</code>: Returns the value in the accumulator.</li>\n</ol>\n<hr>\n<p>The <code class=\"language-text\">hello</code> function is something you’d declare without a second thought when writing JavaScript, but internally it goes through 6 steps to return a value.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 204px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEu0lEQVR42l2VWUhXXRTFb2Rv9ZA+CQUGBtFzYIIviUJUZmRhNpelmBOhaKiVRWWDaWJig5qalJhmZE6lVGSllZQTFFhWqIlDlj2EZq6P34778l04/M+955x11l577f13Xr9+raqqKvX39ysnJ0ebNm1SbGysNm/erB07digqKkpXr15VZWWlLl26pIiICKWkpOj79+/Kzs5Wamqqtm/fbuPEiRNyOjs71dzcrKKiIgMJDQ010ISEBIWFhen8+fMqLy/X7t27FRMToytXrmhgYMDAIiMjlZ6ernXr1unw4cM6evSonJKSEtXW1qqsrEw7d+5UYmKibYTd/v37DWDv3r3GuqenR79+/dLFixeNEd/27dtn63Fxcaqvr5eTkZGhO3fu2Dhw4IABrly5UqtWrdLq1asVFBRkF23ZskW3bt3S5cuXtWfPHrsoOTnZJGFtw4YNqqurk9Pd3a0HDx7o2LFjpg+Ly5Yt08aNG7V06VIFBwfbJchw8uRJY0R4Z86c0fHjxy0SZILhs2fP5HR0dKirq8sWd+3apfj4eFtEz4ULF2rFihXy9fXV/Pnz5efnZ1GcPXvWLti2bZtCQkJ07tw5S1pLS8s/hgA2NDRYIk6fPm0b29vblZeXp+XLl2vBggVasmSJhZ6fn28XMo+Ojja9KyoqbG4achCxGYRDIrDH0NCQHj9+rNu3b9tFJIIEoh8JAYhMY6mtW7eafZ4/fy5nZGREL1++tMOtra1Gm6epqUlHjhzRqVOnLBmAkYi1a9eabnixuLjYrMX6z58/1dbWJoeDhN3b22sfebAGNoIpicD4jIMHD2r9+vXmTdiFh4frzZs3dgamyOZ8+fLF9AIQLXl3GVI5169ft3lhYaHWrFmjmzdvCqsdOnRIExMTevHihTkDGYjSoUoIkw1uiY2Pjxvox48fTWjeMTGVQNhkmcvT0tIs21x67949PXnyRM61a9f08OFDM2hNTY2VGQadnp7W7OysZmZmDJzQ0Y1wL1y4YJ7l2/379y3LuANypiEDdiwwqAZkePfunaj1Hz9+2GEqAx1hSFREg8HJME6AmAGSXUAQHkCy52o3NTWlt2/fGms0JQkMIoMxg6YBY2OIHRobGw0AH1HTJIBQCBtd7t69aw6gPeXm5hpDwAmfkqU0qTIIOAUFBaYJmWNzZmamsrKy7BDf8SGZ//37t96/fy/6J2Xq6ekpb29v+fv7W/lR+waIKalf+trTp0+VlJRkWiEBgOjC8+jRI1H3X79+tQtYxypeXl5yHEc+Pj4WqcMBQGBCqITCZtii5+TkpBkfz5H1ubk5u8D9HRwcVEBAgDw8PP7V8qtXr6znUQHoWVpaauYlMZQlCQHUfVw7/f37V3/+/LFv9AE6kvVD6o/WtGjRIqtR/goYNAdC6+vrs0P8YiGaBToC6A6cQN+k85tt0GDevHk26H8YHDBs9O3bNwMcHR21yvnw4YM+ffpk3nRNz3famwESHoD0PJgyp4PzwMTtPjD5/+PqSEkuXrz4X8j0OZchtzDHSq5ebMLIY2NjGh4e1ufPn409czwbGBhonR3bmLHpEPiOdkT4JAMjkwwY8ss7wGSxurragNhLo4Adnr1x44b9p/wHGUBrDK6MFtQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow\" title=\"\" src=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" srcset=\"/static/e75c06934a527f059c1754c33f12e6ff/69538/slow.png 160w,\n/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png 204w\" sizes=\"(max-width: 204px) 100vw, 204px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>It does this much work under the hood, so let's not complain too much when it's occasionally slow</small>\n</center>\n<p>Bytecode is essentially a set of instructions telling the CPU exactly how to use its registers and accumulator. It’s mind-bending for humans, but much easier for the computer to understand.</p>\n<p>Since the V8 engine converts all of our JavaScript code into bytecode like this internally, the first time a line of code runs there’s a slight delay — but from then on, it can achieve performance close to a compiled language.</p>\n<h3 id=\"cooling-down-hot-code-with-turbofan\" style=\"position:relative;\">Cooling Down Hot Code with TurboFan<a href=\"#cooling-down-hot-code-with-turbofan\" aria-label=\"cooling down hot code with turbofan permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/69868eb577b0cc588456498aa200170b/turbofan.svg\" width=\"300\">\n  <br>\n</center>\n<p><code class=\"language-text\">TurboFan</code> is the optimizing compiler that completely replaced the legacy <code class=\"language-text\">Crankshaft</code> starting with V8 v5.9. So why did <code class=\"language-text\">Crankshaft</code> get retired?</p>\n<p>Since V8 first came into the world, new computer architectures emerged and JavaScript continued to evolve, so V8 had to keep up. The V8 team kept patching things to accommodate new specifications, but eventually they determined that <code class=\"language-text\">Crankshaft</code>’s architecture couldn’t sustain continued expansion. So they built <code class=\"language-text\">TurboFan</code> — designed with multiple layers for more flexible extensibility.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADp0lEQVR42j2SWVNiVxSF+WN570ollUpix6HbsXFqTeyYGByAy8wFZJ4RUUCmCzKpOLUoKnZrnvN7vuz4kIdVtc+9+6y91tpHd1OIcnkY5mrfz+d8kC9FP/1Siq/NDC8HLp4OgrxoSe4qcW61FP2aoBThsRjjpRjm+ThNt5xm32/CvPIe3U0xwW0hxk0+wrUQP5cCDMsRHg68fM2YeTx0MdRiPNeSPAnpsJ6UOsFLNcawEOBrKcQ/J0KasGJbm0X3WE3Q3/fRSar0ckHuiyGGrTQPorQXNtPMqtzL+UsjxW0+zH01zmM9zY2oPM/tciv3/25naMYUlNVJdINylLtihFZC5SznY1AMiL0kzT2VesjIVcHLw1GQpyMZVA1xURI34qSb8XAZt3Mj/Q+lKFrQjHlpHF0/o3KzJz9zfq4O/QyqQa6qSc4Pd2mGNjlNO7mrRXkQq/c1IZMch6JqKMNv91VuyyGejrMUAxaMi6PortNuumkXFykbVxErg4KPa7lwtuflJLrJWUqRYW76OY/EINnK4gZ5H/18QJbo404cDkVAN2hkS/+LLCVh5yxmpRG1o0VtDGQZxzE7Oe8m5cAWvbTC54SRRthIO2OnHTfRTdroSc9RVKGSkozrCbmv8Nfcz+guMy5p9FCPuzmVTFohM+dxMxdit+U10PILqW9DlDpoin0t7eV0z0knZKLo3qAl2XUk74JvWyyPoWv4d16XUYqpYlGhIdLb8q21a6AXMFD3GGhHrTJIFhSz0BVFvQNB3MGxDK5Jby1sIRsw4vhdnk0zbKPgtxATFSeS4YWo7ckT0oIKnbiF+u4mWeUTQeMnMrZ1TlNOulGnWHfSEtUF7xZnhZCQ23F/lIftjk7zp/cHdiIjaEU3tawVj38Bj3dasrRyKQPUPxYZGx1BPztGXtS2JaZO1k1HllU5UOgeeMipa6xv/IjOWpvgPxjzb7HkR/GWZliPfs9q6A1qZo5IfgWjf4rFrbes+UZwZ2dR89PY8uNsp3/iY+QNa/5vWfN8x6TrG3SW6iRWbRpnc+EVjoYep8BcncVYncFYmcNUnkOpfmC7NMX20RTG8iSbxXFMFekpTWLRZgRTwjOFzqHN46zrhWhJGmew1eZxaMtyXn6tTUcfsFSWhXSBnaNZwQxbxWkMhYn/iSyanp3Se5TaO3SG/IRMnsQkapSaHmt9GXtjEVdrCbW9gqu5jFvg6fwqWJV6BbX1Gz6pbSLEeSyu6vNCOCWD3vEv/fEw1QLEp/4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"legacy\" title=\"\" src=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" srcset=\"/static/0b92cf561c8d37d00ae81e4db81baadb/69538/legacy.png 160w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/72799/legacy.png 320w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Running Crankshaft and TurboFan simultaneously probably felt something like this...</small>\n</center>\n<p>When supporting 7 architectures, what took 13,000–16,000 lines of code in <code class=\"language-text\">Crankshaft</code> could be covered in under 3,000 lines with <code class=\"language-text\">TurboFan</code>.</p>\n<p>During runtime, V8 has a component called the <code class=\"language-text\">Profiler</code> that collects data such as how frequently functions and variables are called. When this data is brought to TurboFan, it picks out the code that meets its criteria and optimizes it.</p>\n<p>The optimization techniques include Hidden Classes, Inline Caching, and various others, but I’ll cover those in more detail in a future post.</p>\n<p>To briefly explain: Hidden Classes involve classifying similar objects together for reuse. Inline Caching means that if a frequently used piece of code is a function call like <code class=\"language-text\">hello()</code>, it gets replaced with the function’s actual body <code class=\"language-text\">function hello () { ... }</code>. It’s literally caching.</p>\n<h4 id=\"what-conditions-trigger-optimization\" style=\"position:relative;\">What Conditions Trigger Optimization?<a href=\"#what-conditions-trigger-optimization\" aria-label=\"what conditions trigger optimization permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>So what exact conditions does <code class=\"language-text\">TurboFan</code> use to determine which code to optimize? Let’s look at <code class=\"language-text\">RuntimeProfiler</code>’s <code class=\"language-text\">ShouldOptimize</code> method, which determines whether a function should be optimized.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/execution/runtime-profiler.cc</span>\nOptimizationReason <span class=\"token class-name\">RuntimeProfiler</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShouldOptimize</span><span class=\"token punctuation\">(</span>JSFunction function<span class=\"token punctuation\">,</span> BytecodeArray bytecode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// int ticks = how many times this function has been called</span>\n  <span class=\"token keyword\">int</span> ticks <span class=\"token operator\">=</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">feedback_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">profiler_ticks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> ticks_for_optimization <span class=\"token operator\">=</span>\n      kProfilerTicksBeforeOptimization <span class=\"token operator\">+</span>\n      <span class=\"token punctuation\">(</span>bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> kBytecodeSizeAllowancePerTick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ticks <span class=\"token operator\">>=</span> ticks_for_optimization<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If the call count exceeds the threshold, consider it \"hot\"</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kHotAndStable<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>any_ic_changed_ <span class=\"token operator\">&amp;&amp;</span> bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> kMaxBytecodeSizeForEarlyOpt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If not inline-cached and bytecode length is small, consider it a small function</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kSmallFunction<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// If none of the above apply, don't optimize</span>\n  <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kDoNotOptimize<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I was a bit surprised by how few conditions there are. Of course, there are more granular conditions handled elsewhere, but this method captures the big picture.</p>\n<p><code class=\"language-text\">kHotAndStable</code> means the code is hot and stable — in plain terms, it’s called frequently (hot) and doesn’t change (stable). Code inside loops that repeatedly performs the same operation is a prime candidate for this.</p>\n<p><code class=\"language-text\">kSmallFunction</code> means that based on the length of the interpreted bytecode, if it doesn’t exceed a certain threshold, the function is considered small and gets optimized. Small, simple functions are likely to have very abstract or limited behavior, which makes them stable.</p>\n<h4 id=\"peeking-at-turbofan-in-action\" style=\"position:relative;\">Peeking at TurboFan in Action<a href=\"#peeking-at-turbofan-in-action\" aria-label=\"peeking at turbofan in action permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Let’s see how optimization works with a simple code example. I’ll declare a small function and call it repeatedly in a loop.</p>\n<p>My goal is for the function to hit the <code class=\"language-text\">ticks >= ticks_for_optimization</code> condition and reach <code class=\"language-text\">kHotAndStable</code> status. I figure if I declare any function, use the same argument types, and call it rapidly and repeatedly, it should hit <code class=\"language-text\">ShouldOptimize</code>’s threshold and get optimized as <code class=\"language-text\">kHotAndStable</code>.</p>\n<p>When running Node.js with the <code class=\"language-text\">--trace-opt</code> flag, you can observe code being optimized at runtime.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> d <span class=\"token operator\">=</span> c <span class=\"token operator\">-</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> d <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>marking 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan OSR<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.132</span>, <span class=\"token number\">0.453</span>, <span class=\"token number\">0.027</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.850</span>, <span class=\"token number\">0.549</span>, <span class=\"token number\">0.012</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>completed optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It did get optimized. The <code class=\"language-text\">ICs with typeinfo: 3/3 (100%)</code> tells us inline caching was applied.</p>\n<p>But the optimization reason says <code class=\"language-text\">small function</code>. Since I wanted the <code class=\"language-text\">kHotAndStable</code> condition, I need to tweak the code and try again. My function was too simple — <code class=\"language-text\">TurboFan</code> didn’t take it seriously.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>arguments<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Please provide arguments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> array\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">*</span> el<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I made it moderately more complex — though the logic itself is meaningless. The <code class=\"language-text\">sample</code> function simply takes arguments, transforms them, filters them, reverses the order, and returns the result. The optimization targets <code class=\"language-text\">TurboFan</code> would be watching are functions like <code class=\"language-text\">sample</code>, <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, <code class=\"language-text\">reverse</code>, and <code class=\"language-text\">Array.from</code>.</p>\n<p>Since there are many targets, the log output is enormous, so I’ll just show the parts where <code class=\"language-text\">TurboFan</code> marks functions for optimization.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc51 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa9611 <span class=\"token operator\">&lt;</span>JSFunction array.map.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d46f9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa96a1 <span class=\"token operator\">&lt;</span>JSFunction array.map.filter.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4761<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc11 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">10</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">90</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4785c01 <span class=\"token operator\">&lt;</span>JSFunction UseSparseVariant <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36660866d9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">20</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4786fc1 <span class=\"token operator\">&lt;</span>JSFunction reverse <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a3666086f21<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">4</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">80</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>There it is — <code class=\"language-text\">reason: hot and stable</code>. Since the output includes the function name in the format <code class=\"language-text\">&lt;JSFunction function_name></code>, we can see that <code class=\"language-text\">sample</code> and <code class=\"language-text\">reverse</code> were the ones marked for optimization. This shows how <code class=\"language-text\">TurboFan</code> profiles multiple data points — not just one — to determine whether to optimize a piece of code.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>They say that well-written JavaScript can achieve performance approaching C++. When I first heard this, I thought “How can an interpreted language match a compiled language’s performance?” — but after examining V8’s internals, I was surprised by just how many optimization techniques are packed in.</p>\n<p>Tearing apart the JavaScript engine piece by piece and deepening my understanding of a language I love was genuinely fun. <em>(I wish I’d used C++ more back in school…)</em></p>\n<p>There are actually many optimization techniques inside V8 that’ll make you go “Whoa, that’s brilliant…” — and I wanted to introduce them all. But as I wrote, the content kept getting longer and started going off on tangents…</p>\n<p>So for now, I’ll stop at explaining the overall flow. In the next post, I’ll dive deeper into how <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> work in more detail.</p>\n<p>Understanding TurboFan’s workflow in particular is a shortcut to optimizing your own JavaScript code, so it should come in handy.</p>\n<p>This concludes my post: How Does the V8 Engine Execute My Code?</p>","fields":{"slug":"20190628-v8-analysisen","path":"/2019/06/28/v8-analysis/en/","lang":"en"},"frontmatter":{"title":"How Does the V8 Engine Execute My Code?","subTitle":"From bytecode to optimized compilation: a look inside V8's execution pipeline","date":"Jun 28, 2019","categories":["Programming","JavaScript"],"tags":["NodeJS","V8","JavaScript","JavaScript Fundamentals","JavaScript Engine"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/fc5c5/thumbnail.webp 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"242399b1-5837-5746-abe2-dcfa60792881","tableOfContents":"<ul>\n<li>\n<p><a href=\"#checking-the-keplerian-element-data\">Checking the Keplerian Element Data</a></p>\n<ul>\n<li><a href=\"#examining-the-orbital-element-data\">Examining the Orbital Element Data</a></li>\n<li><a href=\"#orbital-elements-measured-at-the-j2000-epoch\">Orbital Elements Measured at the J2000 Epoch</a></li>\n<li><a href=\"#rate-of-change-per-century\">Rate of Change Per Century</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#finding-earths-current-orbit-and-position\">Finding Earth’s Current Orbit and Position</a></p>\n<ul>\n<li><a href=\"#calculating-earths-current-orbital-elements\">Calculating Earth’s Current Orbital Elements</a></li>\n<li><a href=\"#where-is-earth-in-its-orbit\">Where Is Earth in Its Orbit?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, continuing from the previous post, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it. Checking the Keplerian Element Data The method for calculating an orbit using Keplerian elements is the same regardless of the celestial bod…","html":"<p>In this post, continuing from the <a href=\"/2017/05/03/calculate-orbit-1/en\">previous post</a>, I’ll define the actual shape, size, position, and orientation of an orbit and write the code to implement it.</p>\n<h2 id=\"checking-the-keplerian-element-data\" style=\"position:relative;\">Checking the Keplerian Element Data<a href=\"#checking-the-keplerian-element-data\" aria-label=\"checking the keplerian element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The method for calculating an orbit using Keplerian elements is the same regardless of the celestial body, so in this post let’s calculate the orbit of the planet most familiar to us — Earth.</p>\n<p>NASA’s <a href=\"https://ssd.jpl.nasa.gov/planets/approx_pos.html\" target=\"_blank\" rel=\"nofollow\">Jet Propulsion Laboratory (JPL)</a> provides Keplerian element data for planets in the solar system, and I’ll use this data directly to calculate Earth’s orbit.</p>\n<p>JPL provides three sets of orbital data, each serving different purposes depending on the calculation goal and required precision:</p>\n<hr>\n<ul>\n<li>Table 1: Keplerian elements and their rates of change, referenced to the mean ecliptic and equinox. Valid for predictions between 1800 AD and 2050 AD. Ignores long-term orbital element variations but is simple and fast to compute.</li>\n<li>Table 2a: Measured using the same reference as Table 1, but valid for predictions between 3000 BC and 3000 AD. Because it covers a wider time range, additional correction terms from Table 2b must be applied for orbital calculations from Jupiter through Neptune.</li>\n<li>Table 2b: Correction terms for the mean anomaly calculations of Jupiter, Saturn, Uranus, and Neptune in Table 2a. These terms account for gravitational perturbations, interplanetary interactions, and general relativistic effects.</li>\n</ul>\n<hr>\n<p>Tables 2a and 2b are for high-precision calculations needed for things like space exploration. Massive planets like Jupiter have significant gravitational effects on other bodies, requiring separate correction values for better precision.</p>\n<p>Since my goal is just a simple simulation rather than high-precision calculation, the elements from Table 1 are more than sufficient.</p>\n<h3 id=\"examining-the-orbital-element-data\" style=\"position:relative;\">Examining the Orbital Element Data<a href=\"#examining-the-orbital-element-data\" aria-label=\"examining the orbital element data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Table 1 provides Keplerian element values measured at the epoch J2000 — January 1, 2000, at noon (Julian calendar) — along with the rate of change per century. The orbital element data given in this table is as follows:</p>\n<hr>\n<ol>\n<li>Semi-major axis (<code class=\"language-text\">a</code>): In AU.</li>\n<li>Eccentricity (<code class=\"language-text\">e</code>): In radians.</li>\n<li>Inclination (<code class=\"language-text\">I</code>): In degrees.</li>\n<li>Mean longitude (<code class=\"language-text\">L</code>): In degrees.</li>\n<li>Longitude of perihelion (<code class=\"language-text\">long.peri.</code>): In degrees.</li>\n<li>Longitude of the ascending node (<code class=\"language-text\">long.node</code>): In degrees.</li>\n</ol>\n<hr>\n<p>JPL provides data for all solar system planets, but since this post aims to explain the orbital calculation process simply, we only need to look at the row labeled EM Bary, which is Earth’s orbital element. <small>(EM Bary stands for Earth/Moon Barycenter — the center of mass between Earth and the Moon.)</small></p>\n<p>Let’s look at Earth’s orbital elements from Table 1. The data is divided into values measured at the J2000 epoch and the rate of change per century.</p>\n<h3 id=\"orbital-elements-measured-at-the-j2000-epoch\" style=\"position:relative;\">Orbital Elements Measured at the J2000 Epoch<a href=\"#orbital-elements-measured-at-the-j2000-epoch\" aria-label=\"orbital elements measured at the j2000 epoch permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>J2000 refers to noon on January 1, 2000, in the Julian calendar. The time at which the reference observation for planetary orbital elements was made is called the epoch.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.00000261</td>\n<td>0.01671123</td>\n<td>-0.00001531</td>\n<td>100.46457166</td>\n<td>102.93768193</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"rate-of-change-per-century\" style=\"position:relative;\">Rate of Change Per Century<a href=\"#rate-of-change-per-century\" aria-label=\"rate of change per century permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>These values represent how much the orbital elements have changed over one century. Using these, we can calculate what Earth’s orbital elements look like at the time of writing this post — May 3, 2017, at 10:27 PM.</p>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>e</th>\n<th>I</th>\n<th>L</th>\n<th>long.peri.</th>\n<th>long.node</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0.00000562</td>\n<td>-0.00004392</td>\n<td>-0.01294668</td>\n<td>35999.37244981</td>\n<td>0.32327364</td>\n<td>0.0</td>\n</tr>\n</tbody>\n</table>\n<p>Now let’s use these values to calculate where Earth is currently positioned in its orbit.</p>\n<h2 id=\"finding-earths-current-orbit-and-position\" style=\"position:relative;\">Finding Earth’s Current Orbit and Position<a href=\"#finding-earths-current-orbit-and-position\" aria-label=\"finding earths current orbit and position permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Looking at the data above, you’ll notice that two of the Keplerian elements explained in the previous post are missing: the argument of periapsis and the time of periapsis passage. But this isn’t a problem.</p>\n<p>For the argument of periapsis — since it simply means how far the perihelion is from the ascending node — it can be calculated from the longitude of perihelion and longitude of the ascending node that we already have. However, in this post we’ll only be finding the planet’s position on the 2D orbital plane, so we don’t actually need to calculate the argument of periapsis (which is used for determining the orbit’s orientation in 3D space).</p>\n<p>As for the time of periapsis passage, it’s essentially a time reference for finding where a planet is located at a given moment. Since the JPL data provides both values measured at J2000 and the rate of change per century, the evolution of orbital elements over time is already accounted for.</p>\n<p>The key to calculating a planet’s position in its orbit around the Sun is: compute the <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>)</a> and the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>)</a> from the orbital elements, then derive the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates on the orbital plane.</p>\n<p>We don’t need the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span></span> coordinate at this stage because once we find the planet’s position on the orbital plane, applying the inclination (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span></span>), longitude of the ascending node (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Ω</mi></mrow><annotation encoding=\"application/x-tex\">\\Omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Ω</span></span></span></span></span>), and argument of periapsis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) to place the orbit in 3D space will naturally yield the planet’s 3D position.</p>\n<p>The important question is whether we can derive the mean anomaly and eccentric anomaly from the given data — and as mentioned, the values we have are more than sufficient.</p>\n<p>Let’s get started with the calculations.</p>\n<h3 id=\"calculating-earths-current-orbital-elements\" style=\"position:relative;\">Calculating Earth’s Current Orbital Elements<a href=\"#calculating-earths-current-orbital-elements\" aria-label=\"calculating earths current orbital elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the JPL data consists of orbital element values measured at J2000 and the rate of change per century.</p>\n<p>So to find the current orbital element values, we need to determine how many centuries have passed since J2000, then multiply the rate of change per century by that value to adjust the final orbital elements.</p>\n<p>To make calculations easier, let’s first declare some functions for converting between time units:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">DAY</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">YEAR</span> <span class=\"token operator\">=</span> <span class=\"token number\">365.25</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The Julian calendar defines 1 year as 365.25 days</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertMillisecondsToSeconds</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>milliseconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> milliseconds <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertSecondsToDays</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>seconds<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> seconds <span class=\"token operator\">/</span> <span class=\"token constant\">DAY</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDaysToYears</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>days<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> days <span class=\"token operator\">/</span> <span class=\"token constant\">YEAR</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertYearsToCenturies</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>years<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> years <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now let’s figure out how many centuries have passed since the J2000 epoch:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">J2000</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2000-01-01T12:00:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2017-05-03T22:27:00-00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> epochTime <span class=\"token operator\">=</span> <span class=\"token function\">convertMillisecondsToSeconds</span><span class=\"token punctuation\">(</span>\n    now<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token constant\">J2000</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Date arithmetic returns milliseconds, so divide by 1000 to get seconds</span>\n<span class=\"token comment\">// Result: 547,122,420 seconds</span>\n\n<span class=\"token keyword\">const</span> centuries <span class=\"token operator\">=</span>\n  <span class=\"token function\">convertYearsToCenturies</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">convertDaysToYears</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">convertSecondsToDays</span><span class=\"token punctuation\">(</span>epochTime<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Result: 0.17337263289984028 centuries</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>So approximately <code class=\"language-text\">6,332.43</code> days have passed since J2000, which converts to about <code class=\"language-text\">0.1734</code> centuries. Now that we know how many centuries have elapsed since the epoch, let’s declare the JPL orbital elements and calculate Earth’s current orbital elements.</p>\n<p>For easier downstream calculations, I’ll convert all AU units to kilometers. 1 AU is the mean distance between the Sun and Earth, approximately 149,597,870 km.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">KeplerOrbitElement</span> <span class=\"token punctuation\">{</span>\n  semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  inclination<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  meanLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">JPLOrbitElementData</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n  ratePerCentury<span class=\"token operator\">:</span> KeplerOrbitElement<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AU</span> <span class=\"token operator\">=</span> <span class=\"token number\">149597870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertAUtoKM</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>au<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> au <span class=\"token operator\">*</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> earthOrbitElements<span class=\"token operator\">:</span> JPLOrbitElementData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">J2000</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.00000261</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 149598260.45044068 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token number\">0.01671123</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00001531</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">100.46457166</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">102.93768193</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  ratePerCentury<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    semiMajorAxis<span class=\"token operator\">:</span> <span class=\"token function\">convertAUtoKM</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.00000562</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 840.7400294 km</span>\n    eccentricity<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00004392</span><span class=\"token punctuation\">,</span>\n    inclination<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.01294668</span><span class=\"token punctuation\">,</span>\n    ascendingNodeLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n    meanLongitude<span class=\"token operator\">:</span> <span class=\"token number\">35999.37244981</span><span class=\"token punctuation\">,</span>\n    perihelionLongitude<span class=\"token operator\">:</span> <span class=\"token number\">0.32327364</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>With the orbital elements declared, it’s time to calculate. Using an abstracted <a href=\"https://es-toolkit.slash.page/reference/object/mapValues.html\" target=\"_blank\" rel=\"nofollow\">mapValues</a> function to easily map over object properties, we can express this concisely:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> currentElements <span class=\"token operator\">=</span> <span class=\"token function\">mapValues</span><span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span><span class=\"token constant\">J2000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> element <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>earthOrbitElements<span class=\"token punctuation\">.</span>ratePerCentury<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> centuries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/**\n  {\n    semiMajorAxis: 149598406.21175316,\n    eccentricity: 0.01670361547396304,\n    inclination: -0.0022599099989117043,\n    ascendingNodeLongitude: 0,\n    meanLongitude: 6341.770556025533,\n    perihelionLongitude: 102.99372873211391\n  }\n */</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this simple process, we’ve calculated the state of Earth’s orbital elements at May 3, 2017, 10:27 PM. Now let’s use these values to find where Earth is actually positioned in its orbit.</p>\n<h3 id=\"where-is-earth-in-its-orbit\" style=\"position:relative;\">Where Is Earth in Its Orbit?<a href=\"#where-is-earth-in-its-orbit\" aria-label=\"where is earth in its orbit permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the key to orbital calculation using Keplerian elements is computing the mean anomaly and eccentric anomaly, then expressing the planet’s position on the orbital plane as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. Let’s calculate these values and see why they’re necessary for orbital computation.</p>\n<h4 id=\"calculating-the-mean-anomaly\" style=\"position:relative;\">Calculating the Mean Anomaly<a href=\"#calculating-the-mean-anomaly\" aria-label=\"calculating the mean anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The <a href=\"https://en.wikipedia.org/wiki/Mean_anomaly\" target=\"_blank\" rel=\"nofollow\">mean anomaly</a> is an angle used to calculate the position of a body on an elliptical orbit in the classical two-body problem.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 98.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMCAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAfdjaLVnCbyJoH//xAAaEAEAAgMBAAAAAAAAAAAAAAABAAISICEx/9oACAEBAAEFAlmXTyNYVNP/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPwEj/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAACEw/9oACAEBAAY/AhQ//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARECEx/9oACAEBAAE/IRJouo2l9jdajKKqsAYWsf/aAAwDAQACAAMAAAAQ88g8/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QwOp//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGhAAAwEBAQEAAAAAAAAAAAAAAAERITFREP/aAAgBAQABPxBCn2uYOerv3q+KpPir0wEA8sIpWDSY6Jmi4j//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mean anomaly ko\" title=\"\" src=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg\" srcset=\"/static/a7b4621e50eb2b0ac7db1f5d349d81e7/0913d/mean-anomaly-ko.jpg 160w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/cb69c/mean-anomaly-ko.jpg 320w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/c08c5/mean-anomaly-ko.jpg 640w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/6a068/mean-anomaly-ko.jpg 960w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/eea4a/mean-anomaly-ko.jpg 1280w,\n/static/a7b4621e50eb2b0ac7db1f5d349d81e7/f56c3/mean-anomaly-ko.jpg 2128w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small></small>\n</center>\n<p>The diagram above shows the areas swept by a planet as it moves along its orbit over equal time intervals. Notice that the gray orbital areas are slightly different from each other, while the pink orbital areas are all equal.</p>\n<p>A planet in an elliptical orbit exhibits nonlinear motion according to Kepler’s second law — the <a href=\"https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion\" target=\"_blank\" rel=\"nofollow\">law of equal areas</a>. That is, the planet moves faster near perihelion and slower near aphelion.</p>\n<p>The mean anomaly represents the angular distance between a body and the perihelion, assuming the body were transferred to a perfect circular orbit while maintaining its orbital speed and period. By simplifying the orbit to a near-circular shape, the angle representing the planet’s position increases linearly with time, making calculations simpler.</p>\n<p>Of course, if a planet’s orbital eccentricity were 0 (a perfect circle), the planet would actually move this way. But since most orbits are elliptical, the mean anomaly and eccentricity are used to correct the calculation and determine the planet’s actual motion.</p>\n<p>The mean anomaly serves as the most fundamental ingredient for calculating a planet’s position in its orbit. There are several ways to compute it, but since I already have the mean longitude and longitude of perihelion, I’ll use those.</p>\n<p>The formula for calculating the mean anomaly from mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) and longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>M</mi><mo>=</mo><mi>l</mi><mo>−</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">M = l - \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 6238.776827293419 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>To understand the principle behind this, we need a bit more context on what mean longitude is. The mean longitude used in this calculation represents, on average, how far a planet has progressed in its orbit, measured from the vernal equinox. Mean longitude (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span>) can be expressed as:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>l</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>ϖ</mi></mrow><annotation encoding=\"application/x-tex\">l = \\frac{2\\pi}{P}(t - T_0) + \\varpi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">ϖ</span></span></span></span></span></div>\n<hr>\n<ul>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>: Mean motion (the time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> for a planet to complete one orbit). This is the total angle of 360°, or <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span> radians, divided by the planet’s orbital period.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>: Time elapsed since the reference time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>. Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the J2000 epoch.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>: Longitude of perihelion.</li>\n</ul>\n<hr>\n<p>Looking at this formula, when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">t - T_0 = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, we get <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo>=</mo><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">l = \\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span> — mean longitude equals longitude of perihelion. This tells us that <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>P</mi></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\pi}{P}(t - T_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> represents the average angle the planet has traveled from the perihelion.</p>\n<p>The final addition of the longitude of perihelion (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi></mrow><annotation encoding=\"application/x-tex\">\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span>) shifts the reference point of the mean longitude to an angle measured from the vernal equinox.</p>\n<p>But what we need is the mean anomaly, which — as its name suggests — uses the perihelion as its reference, not the vernal equinox. So by subtracting the longitude of perihelion from the mean longitude, we shift the reference back to the perihelion.</p>\n<h4 id=\"calculating-the-eccentric-anomaly\" style=\"position:relative;\">Calculating the Eccentric Anomaly<a href=\"#calculating-the-eccentric-anomaly\" aria-label=\"calculating the eccentric anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now that we’ve used the mean anomaly to find how far the planet has traveled from perihelion, it’s time to calculate the <a href=\"https://en.wikipedia.org/wiki/Eccentric_anomaly\" target=\"_blank\" rel=\"nofollow\">eccentric anomaly</a>.</p>\n<p>The mean anomaly we calculated is like a clock ticking at a constant rate — it simply assumes that since time <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span></span> has passed, the planet must have moved through angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>.</p>\n<p>But in reality, a planet in an elliptical orbit moves at nonlinear speeds depending on its distance from the central body. So we need to use the mean anomaly and eccentricity to compute the eccentric anomaly, which accounts for the planet’s nonlinear motion — speeding up and slowing down — to find the actual position.</p>\n<p>The eccentric anomaly is an angle defined to simplify the actual position of a planet on an elliptical orbit. It represents the central angle when the planet’s position is projected onto an imaginary circular orbit whose radius equals the semi-major axis of the actual elliptical orbit. A diagram makes this more intuitive:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>In the diagram, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> represents the planet’s position on the orbit, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> represents the planet’s position projected onto an imaginary circular orbit with radius <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> (the semi-major axis of the actual orbit).</p>\n<p>The center of the actual elliptical orbit is <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> is one of the ellipse’s foci. The focus represents the gravitational center of the orbit — in the solar system, this would be the Sun. The eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the angle from the ellipse’s center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span> to the projected position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>P</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">P'</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span> on the imaginary circular orbit.</p>\n<p>Like the mean anomaly, the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit. However, because the eccentricity is factored into the calculation, the eccentric anomaly — unlike the mean anomaly — reflects the geometric characteristics of the elliptical orbit and exhibits a nonlinear rate of increase.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB7CAAAewgFu0HU+AAABcElEQVR42qVTi3KDIBDk//+yVVujAV+IqMj2ltQ0yaSxM70ZBzyX9Y7bVZDYwoq4BazrirquUVUVjDE4n89omgZd10FrjbZtU4575vkYo7EsC2kQY4SaZy8gDaNb5HkmT46iKDDP8xX0GCl3k49xlZ9ZKSgRztCmgXU+/bHve4zjiBACjiNiXkYUVYemveCV9z618pdIhX3vtyCdyVW8lQ7t8FOtItkwDIdEe2zbgla6yE8WVbNJm/dYVZZlavOQKEQMvUNVW5gu3BHd4hSn9ljhDuA6+SiTnNA3E5xbpcLnRFdCSoSyeCTqbcRHPaHWPaiEu6m+uB7lnEuEO9464P3k8Xnu4L09OP6EkGLep1ybIFMT2ThWHH5t6yXhJpcy2kGqFJcYEi34TyiqvpMpG92IhSYZkAW1yclba7FfCQ3Ald+4Ms/vxE3TlLokRl20RT0tyVLOjemdB3iYjqF3qYYsyxKGTqJ/SUAcMVQKvfwFtwj7PCL7F18AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"m vs e\" title=\"\" src=\"/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png\" srcset=\"/static/54cc99e748edcd1fc096e8849a6441d0/69538/m_vs_e.png 160w,\n/static/54cc99e748edcd1fc096e8849a6441d0/72799/m_vs_e.png 320w,\n/static/54cc99e748edcd1fc096e8849a6441d0/6af66/m_vs_e.png 640w,\n/static/54cc99e748edcd1fc096e8849a6441d0/d9199/m_vs_e.png 960w,\n/static/54cc99e748edcd1fc096e8849a6441d0/21b4d/m_vs_e.png 1280w,\n/static/54cc99e748edcd1fc096e8849a6441d0/11f9c/m_vs_e.png 1707w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    Mean anomaly vs. eccentric anomaly calculated after changing Earth's eccentricity to 0.6 in JPL's orbital elements.<br>\n    At day 0 (perihelion) the difference is small, but it grows as we approach day 180 (aphelion).\n  </small>\n</center>\n<p>Once we have the eccentric anomaly, we can finally determine the distance from the gravitational center <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> to the actual planet position <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, as well as the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> — the true anomaly.</p>\n<p>Like the mean anomaly, the eccentric anomaly can be derived from multiple definitions. Since I’ve already calculated the mean anomaly, I’ll use the formula derived from it:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mo>+</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E = \\frac{M+e \\sin M}{1-e \\cos M}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>This formula calculates the eccentric anomaly using the mean anomaly (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>) and the ellipse’s eccentricity (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span>). The nonlinear characteristics of planetary motion grow stronger with higher eccentricity, which is reflected through the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> terms.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> adjusts the mean anomaly to account for the nonlinear motion of the ellipse, while <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> acts as a normalization factor indicating whether the planet is closer to perihelion or aphelion.</p>\n<p>If <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>, the orbit would be a perfect circle and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">E = M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span>. But when <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e > 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span> (an elliptical orbit), near perihelion both <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>sin</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\sin M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mi>cos</mi><mo>⁡</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">e \\cos M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> are small so the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> is small, while near aphelion both values increase and the difference between <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span> grows.</p>\n<p>Unfortunately, the formula for the eccentric anomaly is a nonlinear equation that yields an approximation rather than an exact solution, so we need to reduce the error using the <a href=\"https://en.wikipedia.org/wiki/Newton%27s_method\" target=\"_blank\" rel=\"nofollow\">Newton-Raphson method</a>:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>E</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mfrac><mrow><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>e</mi><mi>sin</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub><mo>−</mo><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>e</mi><mi>cos</mi><mo>⁡</mo><msub><mi>E</mi><mi>n</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">E_{n+1} = E_n - \\frac{E_n - e \\sin E_n - M}{1 - e \\cos E_n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1963em;vertical-align:-0.836em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>Now that we know how to calculate the eccentric anomaly, let’s proceed with the actual computation. Since JavaScript’s trigonometric methods like <code class=\"language-text\">Math.sin</code> and <code class=\"language-text\">Math.cos</code> accept radians rather than degrees, we need to convert the mean anomaly to radians:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertDegreeToRadian</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>degree<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> degree <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> meanAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">convertDegreeToRadian</span><span class=\"token punctuation\">(</span>\n  currentElements<span class=\"token punctuation\">.</span>meanLongitude <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>perihelionLongitude\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then we declare a Newton-Raphson helper function and an eccentric anomaly function, and iterate 6 times:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">newtonRaphson</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> initialValue<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> x1 <span class=\"token operator\">=</span> initialValue<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> iterations<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    x <span class=\"token operator\">=</span> x1<span class=\"token punctuation\">;</span>\n    x1 <span class=\"token operator\">=</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> x1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>eccentricity<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> eccentricAnomaly <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>meanAnomaly <span class=\"token operator\">+</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> eccentricity <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> eccentricAnomaly <span class=\"token operator\">=</span> <span class=\"token function\">newtonRaphson</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">getEccentricAnomaly</span><span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">,</span> meanAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  meanAnomaly<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">6</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 108.9017193604219 radians</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Higher eccentricity means larger errors in the <code class=\"language-text\">getEccentricAnomaly</code> function’s output, requiring more iterations. But since Earth’s orbital eccentricity is about <code class=\"language-text\">0.02</code> — nearly circular — 6 iterations is sufficient.</p>\n<p>With the eccentric anomaly calculated, it’s time to use everything we’ve gathered to find the planet’s actual position on the orbital plane.</p>\n<h4 id=\"finding-the-planets-x-y-coordinates-on-the-orbital-plane\" style=\"position:relative;\">Finding the Planet’s x, y Coordinates on the Orbital Plane<a href=\"#finding-the-planets-x-y-coordinates-on-the-orbital-plane\" aria-label=\"finding the planets x y coordinates on the orbital plane permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Now we need to find where the planet is on the orbital plane and express it as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates. The coordinates we’re calculating are relative to the center of the ellipse, but ultimately we’ll use them to determine how far Earth is from the Sun and how many degrees it has traveled from perihelion.</p>\n<p>First, the formula for the planet’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the ellipse’s center:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x = a \\cdot (\\cos E - e)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span></span></span></span></span></div>\n<p>Since the eccentric anomaly represents the planet’s position projected onto an imaginary circular orbit (because the ellipse’s complex proportions are hard to work with directly), when using the eccentric anomaly to find the planet’s actual position on the elliptical orbit, we need to correct for the difference between the imaginary circular orbit and the actual elliptical orbit.</p>\n<p>The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi><mo>−</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E - e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> term in the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> formula performs this correction. <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\cos E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> calculates how far the planet is horizontally from the center on the imaginary circular orbit (based on the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span>). Then subtracting the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> shifts the result by the distance between the ellipse’s center and its focus.</p>\n<p>Up to this point, the calculated value is dimensionless — merely a ratio relative to the semi-major axis — so we multiply by the semi-major axis (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span>) to set the orbit’s scale.</p>\n<p>The formula for the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate follows a similar principle:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">y = a \\cdot \\sqrt{1 - e^2} \\cdot \\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.1777em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0623em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.0223em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span></div>\n<p>For the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinate, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">\\sin E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> first calculates how far the planet is vertically on the imaginary circular orbit, then corrects for the difference between the imaginary circle and the actual ellipse.</p>\n<p>The difference here is that we need vertical correction, so we must use the semi-minor axis instead of the semi-major axis. The <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>e</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">a \\cdot \\sqrt{1 - e^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span> in the formula is precisely the formula for deriving the semi-minor axis from the semi-major axis and eccentricity.</p>\n<p>Now that we understand the general principle, let’s write the code and extract Earth’s coordinates:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> positionX <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> currentElements<span class=\"token punctuation\">.</span>eccentricity\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> positionY <span class=\"token operator\">=</span> currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>eccentricity <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>eccentricAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>From this, I was able to determine that Earth is located approximately -76,411,956 km along the X-axis and approximately 130,045,428 km along the Y-axis from the center of the ellipse.</p>\n<h4 id=\"finding-the-distance-from-the-sun-and-the-true-anomaly\" style=\"position:relative;\">Finding the Distance from the Sun and the True Anomaly<a href=\"#finding-the-distance-from-the-sun-and-the-true-anomaly\" aria-label=\"finding the distance from the sun and the true anomaly permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>We’ve found Earth’s coordinates on the orbital plane, but these coordinates represent the distance from the center of the orbit itself — not from the Sun, which is the gravitational center.</p>\n<p>What I actually want to know is Earth’s position relative to the Sun, not the orbital center, so additional calculation is needed. Let’s bring back the diagram from earlier:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42qWTT2gTURDGf8k2aVK3+bebbappKzW1SWoCqRUrojmkSPHWQg8VagVBhOJBL41SyKEeBD3owZMnD4IUxIsnBRHx4Fn8Az2KggdPEUtPrvN2N3ETS1Uc+Hhvdt/7Zt7MN4AdoMOUb4d86PpPt7+T2UFBRJDwEO9CUrBHoP0Fqa0LDEG/l5G2Q7CQRyjBrg2CNfAnwnZEW6I3aCgSZ21A0G5npM6tluD2sBvkv01ledGCYlj2Kdfvsg3QJANdsPeDyeGnOaa/hZgQf3xbbj7fz9E3GabehQtjN3iUrYGUJ9er7uo0TSGNdsaE/JcE5bsVysunyWyMEv8MffI9LIi8Mui/soi5lF889sIaLX2HlWcw45bBDujYaVl72oT1MyR5TGKXZwYcBRjSNJvQpRzFJhSE8JAgK//CrgpadgtTv0q6WqVnl6YNLHjdj86SXZ9gSO2lJGOqNCnsmEvsFlGjIWQNTC4TZZlIp9Z+xFxSz1LElmoc/Joj5pUsu8lURXZ9ncpXpNcZ5Ca+zqnaON0M+MSsF0+Run+c4dapbfTCPdYKfsJfpPJ8LuBpzCl4qz5Bb40zS+/6PCOSXVwQUs17yUzVHYLfdaTxQBo1/VHk8CQDm+mu6ZFRpKe2grGVZOiTyEgRNhnJvydvqANJH1LOhVEszPwk7JMuzsmoHTE8IlW3jHN2gcy4RUmiHTgv99YIVc5CufUUP9TzlVgT3tpCzAva7/hzWH0mg2mlb7G3pIp1Yrnd5izQUV+c7quGhSU7jTqGbzi015w80SHwf7I79LLqlMCxLSLDDzk3qZyfRsqbeSrY0uAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentric anomaly 2\" title=\"\" src=\"/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png\" srcset=\"/static/c365db79e876e64320f24144048329b1/69538/eccentric-anomaly-2.png 160w,\n/static/c365db79e876e64320f24144048329b1/72799/eccentric-anomaly-2.png 320w,\n/static/c365db79e876e64320f24144048329b1/6af66/eccentric-anomaly-2.png 640w,\n/static/c365db79e876e64320f24144048329b1/d9199/eccentric-anomaly-2.png 960w,\n/static/c365db79e876e64320f24144048329b1/21b4d/eccentric-anomaly-2.png 1280w,\n/static/c365db79e876e64320f24144048329b1/d9ed5/eccentric-anomaly-2.png 2880w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Earlier, I calculated the eccentric anomaly <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> shown in the diagram, and used it to find the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates of <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span> — the planet’s position on the actual red orbit. But a planet in an elliptical orbit doesn’t orbit the center of the ellipse <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>; it orbits the gravitational center located at one of the ellipse’s foci.</p>\n<p>Since a planet orbiting a gravitational center experiences different gravitational forces depending on its distance, and its orbital speed varies accordingly, what truly matters in orbital calculations is the distance and angle from the gravitational center — not the ellipse’s center.</p>\n<p>In other words, I now need to find the distance from <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span></span> (not <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span>) to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span>, and the angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span>. This angle <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span> is called the <a href=\"https://en.wikipedia.org/wiki/True_anomaly\" target=\"_blank\" rel=\"nofollow\">true anomaly</a> — literally the “true” angle from periapsis.</p>\n<p>Let’s first calculate the distance from the Sun to Earth. Since we already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, the Euclidean distance (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span>) from the Sun to Earth can be simply calculated using the Pythagorean theorem:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>r</mi><mo>=</mo><msqrt><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>⋅</mo><mi>e</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">r = \\sqrt{(x - (a \\cdot e))^2 + y^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.2561em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9839em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9439em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2561em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> is the distance from the center of the elliptical orbit to the Sun. Since we calculated Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate relative to the orbital center, we subtract the distance between the orbital center and the Sun to shift the reference to the Sun’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> coordinate. Beyond this adjustment, the formula is just the familiar Pythagorean theorem <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">c = \\sqrt{a^2 + b^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1266em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9134em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8734em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1266em;\"><span></span></span></span></span></span></span></span></span></span>, so I’ll skip the detailed explanation.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertKMtoAU</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>km<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> km <span class=\"token operator\">/</span> <span class=\"token number\">149_597_870</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>positionY<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">convertKMtoAU</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1.0168205539250386 AU</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Running this calculation tells us that on May 3, 2017, at 10:27 PM, Earth is located approximately 1.02 AU from the Sun.</p>\n<p>Now that we have the Sun-Earth distance, let’s calculate the true anomaly to find how many degrees Earth has traveled from perihelion.</p>\n<p>While the standard approach derives the true anomaly from the eccentric anomaly, since I already have Earth’s <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates, I can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2\" target=\"_blank\" rel=\"nofollow\">Math.atan2</a> function to find the true anomaly directly.</p>\n<p>The <code class=\"language-text\">Math.atan2</code> function uses the relative positions of <code class=\"language-text\">y</code> and <code class=\"language-text\">x</code> to calculate the angle a point forms from a reference point. The result is a radian value between -180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">-\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>) and 180° (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span></span>).</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAB7CAAAewgFu0HU+AAABYUlEQVR42s1U27KDIAz0///S8cHxUu+CopCytLFQa4+epzKTEZI1LAlLZIwhHlVVURzHlKYpdV1H/vBxRVFQkiSUZRm1bRvgonmet4XWmtZ1pWVZ3JwHfEqpYA3MO84lnKZpx4RBUhoCMT+hEGaHO5VQyomaRu0Y1rVyMT7RYUIkYuv7noZh3NY42qs0xsYGh8FG/n+wSEq5scJX2Q2GpiHjmGnnBztsjDh8iI22aWoc3RwYtq81PGrK5RoiwV8JmdHppvyb4WjrgILDUE8UHMY+9gshgvWjcSEOm0bcDIyyLJ1S8jx3quGY3zQYFAKlAFfXdRALlML14+twdGQfd0kpP9plAE8k/IRzCT8ppUVDnr53pbCvs2qazyjl8aIIGuy14Mb4DFnrTORUDY3R9l4put0UoUxavxIWhbLzxT0Sl5XCBMCQrxfnOOwyjofnCQxg+BGb8JrrhyOC2Tcc8twBC4Eq2UyW6lYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"atan2 2\" title=\"\" src=\"/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png\" srcset=\"/static/aba07d7dd119d6c7cf99ca046209025f/69538/atan2_2.png 160w,\n/static/aba07d7dd119d6c7cf99ca046209025f/72799/atan2_2.png 320w,\n/static/aba07d7dd119d6c7cf99ca046209025f/6af66/atan2_2.png 640w,\n/static/aba07d7dd119d6c7cf99ca046209025f/d9199/atan2_2.png 960w,\n/static/aba07d7dd119d6c7cf99ca046209025f/21b4d/atan2_2.png 1280w,\n/static/aba07d7dd119d6c7cf99ca046209025f/c3039/atan2_2.png 1979w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The atan2 function measures angles from the origin relative to the positive x-axis</small>\n</center>\n<p>Note that this function is designed to receive the <code class=\"language-text\">y</code> coordinate first, as in <code class=\"language-text\">Math.atan2(y, x)</code>. This is because tangent is expressed as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>tan</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mi>y</mi><mi>x</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\tan(\\theta) = \\frac{y}{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">tan</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0925em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>, following the form <code class=\"language-text\">Math.tan(y / x)</code>.</p>\n<p>The coordinates that <code class=\"language-text\">Math.atan2</code> receives aren’t necessarily calculated from the origin — they represent relative coordinates from any arbitrary origin. Since the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> coordinates I calculated for Earth are relative to the Sun’s position, plugging them into <code class=\"language-text\">Math.atan2</code> directly gives us the angle of Earth’s position relative to the Sun.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">convertRadianToDegree</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>radian<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> radian <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">180</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> trueAnomaly <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">atan2</span><span class=\"token punctuation\">(</span>\n  positionY<span class=\"token punctuation\">,</span>\n  positionX <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>currentElements<span class=\"token punctuation\">.</span>semiMajorAxis <span class=\"token operator\">*</span> currentElements<span class=\"token punctuation\">.</span>eccentricity<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'True anomaly:'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">convertRadianToDegree</span><span class=\"token punctuation\">(</span>trueAnomaly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 120.4375985828049 degrees</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Through this, I was able to determine that as of May 3, 2017, at 10:27 PM, Earth is located approximately 120° from perihelion at a distance of 1.02 AU.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>This post only covered finding a planet’s position on the 2D orbital plane. However, once you place the orbit in 3D space by applying the orbital inclination and argument of periapsis, the planet will naturally exhibit three-dimensional motion.</p>\n<p>You can check out the simulator I built using these formulas <a href=\"https://evan-moon.github.io/solarsystemts/\" target=\"_blank\" rel=\"nofollow\">here</a>, and the full source code is available on the <a href=\"https://github.com/evan-moon/solarsystemts\" target=\"_blank\" rel=\"nofollow\">Solarsystem project GitHub repository</a>.</p>\n<p>That wraps up this post on calculating planetary positions.</p>","fields":{"slug":"20170503-calculate-orbit-2en","path":"/2017/05/03/calculate-orbit-2/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Implementing Planetary Motion","subTitle":"Implementing a celestial simulation using Kepler's equation","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Equation","Keplerian Elements","JavaScript","WebGL","ThreeJS","Mathematics","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"59c15557-97c3-50f1-afde-ef327112b002","tableOfContents":"<ul>\n<li>\n<p><a href=\"#coordinates-and-reference-planes\">Coordinates and Reference Planes</a></p>\n<ul>\n<li><a href=\"#the-celestial-sphere-and-the-ecliptic\">The Celestial Sphere and the Ecliptic</a></li>\n<li><a href=\"#right-ascension-and-declination\">Right Ascension and Declination</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#orbital-terminology\">Orbital Terminology</a></p>\n<ul>\n<li><a href=\"#ascending-node--descending-node\">Ascending Node / Descending Node</a></li>\n<li><a href=\"#aphelion--perihelion\">Aphelion / Perihelion</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#keplerian-elements\">Keplerian Elements</a></p>\n<ul>\n<li><a href=\"#semi-major-axis\">Semi-major Axis</a></li>\n<li><a href=\"#eccentricity\">Eccentricity</a></li>\n<li><a href=\"#inclination\">Inclination</a></li>\n<li><a href=\"#longitude-of-the-ascending-node\">Longitude of the Ascending Node</a></li>\n<li><a href=\"#argument-of-periapsis\">Argument of Periapsis</a></li>\n<li><a href=\"#time-of-periapsis-passage\">Time of Periapsis Passage</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar expe…","html":"<p>In this post, I’ll cover the orbital and position calculations of celestial bodies — the part that gave me the most trouble while developing a solar system simulation. As someone who gave up on math in high school, my goal is to explain things as simply as possible for others who had a similar experience.</p>\n<p>There are plenty of resources online about plotting orbits and estimating planetary positions, but understanding them requires familiarity with basic astronomical terminology. Apparently these are terms you learn in a high school earth science class, but since I spent most of high school sleeping, I had to look everything up from scratch.</p>\n<p>I’m not an astrophysics graduate — just a developer — so there may be inaccuracies in my explanations.</p>\n<p>Before diving into the Keplerian elements themselves, let’s cover the most fundamental terms needed to understand the explanations that follow.</p>\n<h2 id=\"coordinates-and-reference-planes\" style=\"position:relative;\">Coordinates and Reference Planes<a href=\"#coordinates-and-reference-planes\" aria-label=\"coordinates and reference planes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Celestial bodies move through an infinitely extending three-dimensional space, so a coordinate reference system is essential to describe their motion. This means deciding where to place the center of the coordinates and what to consider 0° when measuring angles.</p>\n<h3 id=\"the-celestial-sphere-and-the-ecliptic\" style=\"position:relative;\">The Celestial Sphere and the Ecliptic<a href=\"#the-celestial-sphere-and-the-ecliptic\" aria-label=\"the celestial sphere and the ecliptic permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is an imaginary sphere of infinite radius centered on the observer.</p>\n<p>Here, “the observer” doesn’t mean an actual person but the celestial body where the observer is located. Since humans haven’t yet had occasion to use these concepts from any planet other than Earth, the observer is conventionally Earth. The projection of Earth’s equator onto the celestial sphere is called <strong>the celestial equator</strong>.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 638px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADBUlEQVR42kWT21LaUBSGN2CLLaJykJNAiJwEAgkhEXIgEQinJAOEgwgosWpVbC/aaa86velMH6DP0Ufq9GG6ou10Jhd71vq/7H/v9W80WH+MV7QMb6S5UYobZfgRLDBGKyuL/vnGuPpANucJVodimhtaXX50LI6jVO/i8SuCHtrL20NlFKBQsIz8pC1Q9uebOdFgh5va4CFdHeCsnmBVe6hiaQKUI0Sjnaw0ukFs/xKYbazmxKqO6MluSmK6l7z+piBNCopZ6pgFaVpTzeb4Lkgo9kN2G+Ne4Tzyl5SzDQIpOqBexmuOQxaq1b5JNs4DhOJO1ffTkidz6joSg8U2Ic+q/bULF1CQfhE9Qd5ia/rwH7aFmYI0o9tLX64JIie4SAotY12UjB2cCxLNSmdJNaYxuhul+8hDtGbPcKC8FT3ZSdY51cQZdS8puhPc7lHNkxaiRH0/Kbhxbv+IdyWUzacrtqN6c8rTzvd/YXuEiZAdUTNDhLKfFjwZ4WWMzdR1VlvBOR2RE2+m/vjZ/PjlJlRogXPkKz3BPQu2RZgCP5CGt7685Iwzuxk5QTXnl5uHbz9duLyNieb96PevH/rqPs1o8Lsn2LJ9ATAKVw6L7dnypjsxk9WBOyWhEBMuT1KNDdHQe4txazrWzx+M+Vu83LFF2L87s5ZtyonxMVoZLK8ZadzoL9TJtazOZc2YrGbqxCiLWorql/iBqK1309LW823PAAbbvlK8ohbloTy8kI3r5njN6/Nqb7y6BZM9W4BxYbw3KxGNOUzREWGcWO0JfrYNo4pVUajiSgji4Lq3eOfPNeCSfDnFl2u9xnl/vlWQzwT9jftIsP+DFYCr6hqFaMgNlCAnnuxppbPitKtcfQphztenWXEMCeO1K+/xKQicGLedgISRbUgY2TxHewV7mLaCDTPwk1thJkJ1S40zTrOY4unskOxuha2Wle0D0gEyV7Y+vEH95ftwqYOxepzR4MMYPVbRgsVOXpooszt18XgsGIFiG4oxWgVTsnErjW7hOd19/v4HfhW6L3NhaLIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"1\" title=\"\" src=\"/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png\" srcset=\"/static/7ae3e4bed5b1240285335fdd519f6924/69538/1.png 160w,\n/static/7ae3e4bed5b1240285335fdd519f6924/72799/1.png 320w,\n/static/7ae3e4bed5b1240285335fdd519f6924/41be6/1.png 638w\" sizes=\"(max-width: 638px) 100vw, 638px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The yellow line labeled <strong>ecliptic</strong> in the diagram above represents the apparent path the Sun traces across the sky as observed from Earth.</p>\n<p>In other words, the concepts of the celestial sphere and ecliptic originate from the geocentric model. They define the positions of celestial objects in the sky relative to Earth as the observer.</p>\n<p>Because Earth’s rotational axis is tilted 23.5°, the celestial equator and the ecliptic meet at an angle of 23.5°. Due to this tilt, from Earth’s perspective the Sun appears to orbit Earth while drifting south and then north. The point where the Sun moves from south to north is called the <strong>vernal equinox</strong>, and the point where it moves from north to south is called the <strong>autumnal equinox</strong>.</p>\n<p>But living in the 21st century, we know that it’s actually Earth orbiting the Sun, not the other way around. So while the diagram above shows Earth standing upright with the Sun orbiting at a tilt, in reality the ecliptic is the reference plane and the celestial equator is the one tilted at 23.5°.</p>\n<h3 id=\"right-ascension-and-declination\" style=\"position:relative;\">Right Ascension and Declination<a href=\"#right-ascension-and-declination\" aria-label=\"right ascension and declination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The celestial sphere is ultimately a concept for expressing the positions of objects in the sky relative to Earth. The positions of celestial bodies are expressed using right ascension and declination.</p>\n<p>This is the same idea as using the geographic coordinate system with longitude and latitude to express a specific location on Earth. In the geographic coordinate system, latitude takes the equator as 0° and the poles as 90° to mark vertical position, while longitude takes the Greenwich Observatory as 0° and divides 180° east and 180° west for horizontal position.</p>\n<p>By the same principle, when looking up at the sky from Earth, any object on the celestial sphere can be located with just two values — right ascension and declination.</p>\n<p>Right ascension and declination are the longitude and latitude in the equatorial coordinate system, which uses the celestial equator as its baseline. Right ascension measures the counterclockwise angle from the vernal equinox to the target object along the celestial equator. Declination measures the angular distance from the celestial equator to the target object. In short, knowing the celestial equator, the vernal equinox, the right ascension, and the declination is enough to pinpoint any object on the celestial sphere. <small>(Of course, the equatorial coordinate system assumes objects exist on the two-dimensional surface of the celestial sphere, so it doesn’t define the distance to the object.)</small></p>\n<p>An interesting fact is that most celestial bodies — except for solar system objects and comets — barely move on the celestial sphere, so they have essentially fixed right ascension and declination values that make them easy to locate.</p>\n<p>Unlike geographic longitude, right ascension in the equatorial coordinate system is expressed in time units like hours and minutes. Since Earth rotates 360° in 24 hours, 1 hour of right ascension corresponds to 15°. Declination takes the celestial equator as 0° and defines the celestial north pole as +90° and south pole as -90°, so it always falls between -90° and +90°.</p>\n<p>For reference, the coordinate system centered on a ground-level observer on Earth (rather than the equator), using the observer’s horizon as the reference plane, is called the horizontal coordinate system.</p>\n<h2 id=\"orbital-terminology\" style=\"position:relative;\">Orbital Terminology<a href=\"#orbital-terminology\" aria-label=\"orbital terminology permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"ascending-node--descending-node\" style=\"position:relative;\">Ascending Node / Descending Node<a href=\"#ascending-node--descending-node\" aria-label=\"ascending node  descending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>A celestial body’s orbital plane is generally tilted relative to a reference plane. The reference plane can vary by definition, but for the solar system it refers to the ecliptic.</p>\n<p>Earlier, I explained that in the equatorial coordinate system, the point where the Sun moves from south to north is the vernal equinox, and where it moves from north to south is the autumnal equinox.</p>\n<p>Similarly, for any body orbiting a central object, the point where it crosses from south to north of the reference plane is called the ascending node, and the point where it crosses from north to south is the descending node. While “vernal equinox” and “autumnal equinox” are terms specific to us living on Earth, “ascending node” and “descending node” are universal terms applicable to any body orbiting along a specific trajectory.</p>\n<p>In the solar system, since the central body is the Sun, the ecliptic is used as the reference.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVR42rVSy2rDQAzUW/uy13Ycm1IKhRZyyKH//3dVHj0k0GN01M5opJkFeHUxkKIm8kJ5SlO3rij/os1tHMfsxYIgLXMxdkEhoON63I/bkhcEeuAgM2hoWMpDzdNh2VJtoIwuoHJ7QlE27T4h4B8NCd1R1Tk1b+5ODG68r8tYizOaEimhXYCD9ZSGy7g7WU01ZXCP9cqleyh1H+e3df85n9dxzpfLQVxHHxQkVCmVOzlz7m21UkmkTSM5l6GoUlwZwqfTV87u6jU1ZgER8oRyVa5ULA4yrW0ADl+U1AIBJrEuIG3b++fHd2szu0cfg4/Xg3O4XzoLI+KDeRjmauJcpDJKACICokeHQ3bu07ZvkU0YSHiLNMXQCJae8niq2LJxm1Jf8lyoZEpOxsgv/3m/zscMNxDZT98AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pluto orbit\" title=\"\" src=\"/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png\" srcset=\"/static/4693485f3e9d15673833669486a0c618/69538/pluto_orbit.png 160w,\n/static/4693485f3e9d15673833669486a0c618/72799/pluto_orbit.png 320w,\n/static/4693485f3e9d15673833669486a0c618/0a47e/pluto_orbit.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Looking at Pluto's orbit, it's easy to see what it means to rise north or descend south of the ecliptic relative to the Sun.</small>\n</center>\n<h3 id=\"aphelion--perihelion\" style=\"position:relative;\">Aphelion / Perihelion<a href=\"#aphelion--perihelion\" aria-label=\"aphelion  perihelion permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they have two foci. Typically the star occupies one of these foci. The aphelion is the point farthest from the star, and the perihelion is the closest. Parabolic orbits have an aphelion at infinity, so they only have a perihelion.</p>\n<h2 id=\"keplerian-elements\" style=\"position:relative;\">Keplerian Elements<a href=\"#keplerian-elements\" aria-label=\"keplerian elements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now that we’ve covered the basic terms, let’s look at the Keplerian elements that define the shape, size, and orientation of an orbit.</p>\n<p>The Keplerian elements consist of: the semi-major axis and eccentricity (which define the orbit’s shape and size), the inclination and longitude of the ascending node (which define the orbital plane), and finally the argument of periapsis (which defines the orbit’s orientation) along with the time of periapsis passage (which pins down the body’s position at a specific time).</p>\n<h3 id=\"semi-major-axis\" style=\"position:relative;\">Semi-major Axis<a href=\"#semi-major-axis\" aria-label=\"semi major axis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Since planetary orbits are elliptical, they’re defined not by a radius but by a semi-major axis and semi-minor axis. The semi-major axis is the point on the orbit farthest from the orbital center, while the semi-minor axis is the closest point.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35QB/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFhABAQEAAAAAAAAAAAAAAAAAAIEg/9oACAEBAAE/IUTH/9oADAMBAAIAAwAAABBgz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQADAAMAAAAAAAAAAAAAAAEAESEQMUH/2gAIAQEAAT8QG7xNqWnp2Cp2Iw4//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"semi major axis\" title=\"\" src=\"/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg\" srcset=\"/static/18c739abac106732c5daf91effd1103d/0913d/semi-major-axis.jpg 160w,\n/static/18c739abac106732c5daf91effd1103d/cb69c/semi-major-axis.jpg 320w,\n/static/18c739abac106732c5daf91effd1103d/c08c5/semi-major-axis.jpg 640w,\n/static/18c739abac106732c5daf91effd1103d/00597/semi-major-axis.jpg 678w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The difference from aphelion/perihelion is that the reference point is the center of the orbit, not the star. Parabolic and hyperbolic orbits have an infinite semi-major axis, so they only have a semi-minor axis.</p>\n<p>The Keplerian elements only deal with the semi-major axis (not the semi-minor axis) because what matters for orbital energy calculations is the average distance of the orbiting body, not the orbit’s shape. The semi-major axis represents the overall size of the orbit, while the semi-minor axis merely indicates how squashed it is — not a suitable metric for energy calculations.</p>\n<p>For this reason, celestial mechanics generally uses the semi-major axis, and Kepler’s equation does the same.</p>\n<h3 id=\"eccentricity\" style=\"position:relative;\">Eccentricity<a href=\"#eccentricity\" aria-label=\"eccentricity permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 440px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 121.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVR42qWVvYvTYBzHv2l7aZOnbZo06fW8qCDccJXqKs4OgiLcUHR0cBIcfENu6iQK4iCCi8LtB7eJuIrQyb9CEHETzz1+f3mes8nlUhN84JuXPs2H3/sDAF1qzahNdYxs4C739gZ672zH7JfJ1qyLGOAtAryAwhwNFFYSUi6qLaUvAnoCD7uI+DygWhmgBRyuL6HyXrrcvxezLMJcPCX4GfwlWCCfzwBf/mVpDmgZ6XUfDoGj1OJ0Xe4BXzcJb9WxMA9OUou7jO8IN0DgwuGP4n6jDtCwYCUGPGeM3UcYq1sQmECHtYBJ1vXlamAHG96ehECA39y6FtpUjwqNvHd891kN3QfXQ11O1S30qYhSVHOf4r1zAMS/0I0mL1m3WwtJUDsT9zzwyE3eAwGWxKj1nnuHF5ik2zdP89/esdrMW5hoS6KyWM6R1uWpBbA5vTY9h/DTRhpbTOxVwDCb5Wy2L4G1Sbc/OIi3r2xvITiIdZ/HjnHbOcllf4XLst/+McEYd3YIS/orXT6WFMmsk1HnZxrf3jCWpJz/KDG0S5NSUjYDKReRhtG9fXbOvatRSXHXKmzgue/hjYQjCYDvqlZhI5OM2QxN9VCNglfo6zFWr/XyU0eGA/uYd07sZM0MB+v/xlc6yZMm8HusoavHlyoM2N3CgG2Yqe1UGbAOs9Dgx/3ipD6qsWREqQpnCoFTAqSuHnOAFg6pFBZVhBlvfR5Ocdoytmkd14jPMzb/66E+JtdVZu8kybf9P8qYk5p9WHxjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"eccentricity\" title=\"\" src=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png\" srcset=\"/static/6f85397f2e1f0b3d470fea6c6afa5c6b/69538/eccentricity.png 160w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/72799/eccentricity.png 320w,\n/static/6f85397f2e1f0b3d470fea6c6afa5c6b/48c0e/eccentricity.png 440w\" sizes=\"(max-width: 440px) 100vw, 440px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Eccentricity is simply a measure of how squashed an ellipse is. In the geometric definition, the eccentricity <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of an ellipse is:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>−</mo><mfrac><msup><mi>b</mi><mn>2</mn></msup><msup><mi>a</mi><mn>2</mn></msup></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1-\\frac{b^2}{a^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.44em;vertical-align:-0.7406em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6994em;\"><span class=\"svg-align\" style=\"top:-4.4em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.6594em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:2.48em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"2.48em\" viewBox=\"0 0 400000 2592\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M424,2478\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl0 -0c4,-6.7,10,-10,18,-10 H400000\nv40H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M1001 80\nh400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7406em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>Here <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span> is the semi-major axis and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></span> is the semi-minor axis. However, the eccentricity used in Keplerian orbits has a slightly different formula.</p>\n<p>The standard formula for an ellipse’s eccentricity only describes the geometric squashing without considering factors like gravity or energy, so it’s not suitable for Keplerian orbits, which are based on the interaction between a body’s kinetic energy and gravitational forces.</p>\n<p>To calculate the eccentricity of a Keplerian orbit, you need to account for physical dynamics like kinetic energy and angular momentum:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>e</mi><mo>=</mo><msqrt><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>2</mn><mi>E</mi><msup><mi>L</mi><mn>2</mn></msup></mrow><mrow><msub><mi>m</mi><mtext>red</mtext></msub><msup><mi>α</mi><mn>2</mn></msup></mrow></mfrac></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">e = \\sqrt{1+\\frac{2EL^2}{m_\\text{red}\\alpha^2}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.04em;vertical-align:-1.1156em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9244em;\"><span class=\"svg-align\" style=\"top:-5em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4171em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">red</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.8844em;\"><span class=\"pstrut\" style=\"height:5em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:3.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"3.08em\" viewBox=\"0 0 400000 3240\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M473,2793\nc339.3,-1799.3,509.3,-2700,510,-2702 l0 -0\nc3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM1001 80h400000v40H1017.7z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1156em;\"><span></span></span></span></span></span></span></span></span></span></div>\n<p>The solution <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></span> of this equation is called the orbital eccentricity.</p>\n<p>Here, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span> is the total energy of the body in orbit, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span></span> is the angular momentum, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>m</mi><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">m_{red}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">re</span><span class=\"mord mathnormal mtight\">d</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> is the reduced mass, and <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span> is the coefficient for the inverse-square law central force. The inverse-square law means a force’s magnitude is inversely proportional to the square of the distance — in this case, that force is gravity.</p>\n<p>Since I’ll be using data where the eccentricity is already provided, I don’t actually need to calculate all this. Just knowing that it differs from the standard eccentricity formula is enough.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 212px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 112.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAUEAQP/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtOZTNLxEPSG0H/8QAGhAAAwEBAQEAAAAAAAAAAAAAAQIDBBETMf/aAAgBAQABBQLTUmk+rEfKpzWjPRYEtOwf3WjShjBEP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAIDAAEFAAAAAAAAAAAAAAECABEhMRBBUWGh/9oACAEBAAY/AmQFgRxUWrOd+hN+4rYBLJu4552Uusfk3zP/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMUFRYXH/2gAIAQEAAT8hXQJuz3MFK2VW3L7bl0HJV6h1uFp3M5tL88mNEeoRL0cIAHbaf//aAAwDAQACAAMAAAAQEwc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAwEBAAAAAAAAAAAAAQARITFhcYFBsf/aAAgBAQABPxAlDhY4mu8dQ1zxRYM3be4kE0th8ajEBzDwN9ahBU4WqyVwQA+xErb8RpGUFjBxmO1cgLHs56I+BEy64n//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme\" title=\"\" src=\"/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg\" srcset=\"/static/68ee7ca2b63f32445afe5c63a2526b87/0913d/skip.jpg 160w,\n/static/68ee7ca2b63f32445afe5c63a2526b87/8c7fa/skip.jpg 212w\" sizes=\"(max-width: 212px) 100vw, 212px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Keplerian orbital eccentricity takes four forms:</p>\n<hr>\n<ul>\n<li>Circular orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">e = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span></li>\n<li>Elliptical orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>&#x3C;</mo><mi>e</mi><mo>&#x3C;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0 &#x3C; e &#x3C; 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6835em;vertical-align:-0.0391em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Parabolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n<li>Hyperbolic orbit: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>></mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">e > 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></li>\n</ul>\n<hr>\n<p>Earth’s orbital eccentricity is currently about <code class=\"language-text\">0.0167</code>, making it nearly circular. Mercury, the planet with the highest eccentricity in the solar system at <code class=\"language-text\">0.2056</code>, receives roughly twice as much solar radiation at perihelion compared to aphelion.</p>\n<p>Pluto used to be the champion in this category with <code class=\"language-text\">0.248</code>, but as we all know, it’s been demoted… <small>(Adiós…)</small></p>\n<p>Comets have quite varied eccentricities. Periodic comets typically range from <code class=\"language-text\">0.2</code> to <code class=\"language-text\">0.7</code>, while some with extremely elongated orbits approach nearly <code class=\"language-text\">1</code>.</p>\n<p>For example, the well-known Halley’s Comet has an eccentricity of <code class=\"language-text\">0.967</code> and takes 76 years to complete one orbit due to its extremely elongated path. Its next approach is in 2061, by the way.</p>\n<h3 id=\"inclination\" style=\"position:relative;\">Inclination<a href=\"#inclination\" aria-label=\"inclination permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This is the angle between the star’s ecliptic plane and the orbit. If the inclination exceeds 90°, the body is orbiting in the opposite direction compared to bodies with inclinations between 0° and 90°.</p>\n<h3 id=\"longitude-of-the-ascending-node\" style=\"position:relative;\">Longitude of the Ascending Node<a href=\"#longitude-of-the-ascending-node\" aria-label=\"longitude of the ascending node permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned, the ascending node is the point where a body crosses the reference plane from south to north while following its orbit. The ascending node is expressed as a longitude — the angle measured counterclockwise from the vernal equinox along the ecliptic to the ascending node.</p>\n<p>This allows us to define the position of the ascending node in a 3D coordinate system.</p>\n<h3 id=\"argument-of-periapsis\" style=\"position:relative;\">Argument of Periapsis<a href=\"#argument-of-periapsis\" aria-label=\"argument of periapsis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The argument of periapsis is the angle from the ascending node to the periapsis, measured within the orbital plane. As the term “periapsis” suggests, this angle is measured from the gravitational focus of the orbit, not the center of the ellipse.</p>\n<p>This value indicates how much the orbital ellipse is rotated relative to the reference plane (like the ecliptic). If the argument of periapsis is 0°, the ascending node and periapsis coincide, meaning the body is closest to its star at the moment it crosses the ascending node. If it’s 90°, the body is at its closest approach when it’s at the point farthest north of the reference plane.</p>\n<h3 id=\"time-of-periapsis-passage\" style=\"position:relative;\">Time of Periapsis Passage<a href=\"#time-of-periapsis-passage\" aria-label=\"time of periapsis passage permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This marks the time when the body passes through periapsis.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In the <a href=\"/2017/05/03/calculate-orbit-2\">next post</a>, we’ll implement orbital calculations in code. That wraps up this glossary of astronomical terms and introduction to the Keplerian elements.</p>","fields":{"slug":"20170503-calculate-orbit-1en","path":"/2017/05/03/calculate-orbit-1/en/","lang":"en"},"frontmatter":{"title":"[Simulating Celestial Bodies with JavaScript] Understanding the Keplerian Elements","subTitle":"A guide to Keplerian orbital elements — no astronomy or math expertise required","date":"May 03, 2017","categories":["Programming","Graphics"],"tags":["Orbital Mechanics","Kepler's Laws","Keplerian Elements","JavaScript","WebGL","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/3a812/thumbnail.jpg 320w,\n/static/746a090a9954b09cea8d75079269697d/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/fc5c5/thumbnail.webp 320w,\n/static/746a090a9954b09cea8d75079269697d/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg","srcSet":"/static/746a090a9954b09cea8d75079269697d/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/746a090a9954b09cea8d75079269697d/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}],"pageInfo":{"currentPage":3,"pageCount":3}}},"pageContext":{"limit":15,"skip":30,"lang":"en","totalCount":35}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}