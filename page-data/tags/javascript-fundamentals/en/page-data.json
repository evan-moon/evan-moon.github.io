{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/javascript-fundamentals/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"a4fa5185-a7ee-51e2-b7db-9147ee3bced8","tableOfContents":"<ul>\n<li>\n<p><a href=\"#properties-and-methods-can-be-shared-through-the-original-object\">Properties and Methods Can Be Shared Through the Original Object</a></p>\n<ul>\n<li><a href=\"#using-this-inside-the-constructor-function\">Using this Inside the Constructor Function</a></li>\n<li><a href=\"#defining-on-the-prototype-object\">Defining on the Prototype Object</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#prototype-lookup\">Prototype Lookup</a></p>\n</li>\n<li>\n<p><a href=\"#inheritance-using-prototypes\">Inheritance Using Prototypes</a></p>\n<ul>\n<li><a href=\"#use-objectcreate\">Use Object.create</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, continuing from the previous one, I want to talk about various inheritance patterns using prototypes. JavaScript doesn’t have explicit concepts like inheritance or encapsulation, which is why developers coming from class-based languages like Java or C++ are often confused by the absence of classes in JavaScript.","html":"<p>In this post, continuing from the <a href=\"/2019/10/23/js-prototype/\">previous one</a>, I want to talk about various inheritance patterns using prototypes.</p>\n<p>JavaScript doesn’t have explicit concepts like inheritance or encapsulation, which is why developers coming from class-based languages like Java or C++ are often confused by the absence of classes in JavaScript.</p>\n<!-- more -->\n<p>In other words, inheritance and encapsulation in JavaScript are essentially design patterns — implemented by OOP-minded developers using prototypes to approximate these concepts in JavaScript.</p>\n<p>Inheritance in JavaScript is implemented using the prototype chain, and encapsulation is implemented using closures. In this post, I’ll focus on explaining inheritance patterns using prototypes.</p>\n<h2 id=\"properties-and-methods-can-be-shared-through-the-original-object\" style=\"position:relative;\">Properties and Methods Can Be Shared Through the Original Object<a href=\"#properties-and-methods-can-be-shared-through-the-original-object\" aria-label=\"properties and methods can be shared through the original object permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Before diving into object inheritance, let’s look at how to assign properties and methods when creating objects. In the <a href=\"/2019/10/23/js-prototype/\">previous post</a>, I explained that JavaScript uses functions, not classes, to create objects.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">evan</code> object created by calling <code class=\"language-text\">User</code> as a constructor is a clone of the <code class=\"language-text\">User.prototype</code> object — the original object.</p>\n<p>There are two ways to assign properties or methods to newly created objects. The first is declaring them using <code class=\"language-text\">this</code> inside the constructor function. The second is declaring them on the prototype object — the original object that new objects are cloned from.</p>\n<p>Let’s first look at defining properties and methods using <code class=\"language-text\">this</code>.</p>\n<h3 id=\"using-this-inside-the-constructor-function\" style=\"position:relative;\">Using this Inside the Constructor Function<a href=\"#using-this-inside-the-constructor-function\" aria-label=\"using this inside the constructor function permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In JavaScript, you can assign properties and methods to objects using <code class=\"language-text\">this</code> inside a constructor function, similar to other languages.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">say</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello, World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Hello, World!</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The reason I used <code class=\"language-text\">strict</code> mode inside the constructor function is to prevent <code class=\"language-text\">this</code> from being evaluated as the global object if the constructor is accidentally called without the <code class=\"language-text\">new</code> keyword. <small>(This isn’t directly related to prototypes, so I won’t go into detail.)</small></p>\n<p>This approach is intuitive because it resembles how constructors work in other languages. Since <code class=\"language-text\">this</code> inside the constructor refers to the newly created object, properties and methods defined through <code class=\"language-text\">this</code> are freshly created every time an object is instantiated using this constructor.</p>\n<p>To see what that means more concretely, let’s create two objects using the constructor and compare their methods.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> john <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>say <span class=\"token operator\">===</span> john<span class=\"token punctuation\">.</span>say<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">false</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>When the constructor was called, <code class=\"language-text\">this</code> referred to the <code class=\"language-text\">evan</code> object and the <code class=\"language-text\">john</code> object respectively, and <code class=\"language-text\">say</code> was directly assigned to each. Since JavaScript’s strict equality operator (<code class=\"language-text\">===</code>) considers objects in different memory locations as different, these two methods are completely separate functions stored in different memory.</p>\n<p>If you print the <code class=\"language-text\">evan</code> object, you can see the <code class=\"language-text\">say</code> method defined directly inside it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">User <span class=\"token punctuation\">{</span><span class=\"token function-variable function\">say</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The reason I’m emphasizing something so obvious is to clearly contrast it with the approach I’m about to describe — defining methods on the prototype object. Using the prototype object produces an entirely different result.</p>\n<h3 id=\"defining-on-the-prototype-object\" style=\"position:relative;\">Defining on the Prototype Object<a href=\"#defining-on-the-prototype-object\" aria-label=\"defining on the prototype object permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This time, let’s define a method on <code class=\"language-text\">User.prototype</code> — the prototype object of the <code class=\"language-text\">User</code> constructor. How does this differ from defining with <code class=\"language-text\">this</code>?</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">say</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello, World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Hello, World!</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>It seems to work the same as the method defined with <code class=\"language-text\">this</code>. You might think it’s identical, but there’s an important difference between the two approaches.</p>\n<p>The difference is whether all objects created through the constructor <strong>share</strong> the method or not. Let’s create two objects again and compare their methods.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> john <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>say <span class=\"token operator\">===</span> john<span class=\"token punctuation\">.</span>say<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This time, unlike before, the two objects’ methods are the same. That’s because <code class=\"language-text\">evan.say</code> and <code class=\"language-text\">john.say</code> aren’t methods defined separately on each object — they’re sharing the method from the original object.</p>\n<p>If you print the <code class=\"language-text\">evan</code> object, you can see what “sharing the original object’s properties and methods” means.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">User <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The <code class=\"language-text\">evan</code> object is completely empty — no methods or properties at all.</p>\n<p>In other words, when you define methods or properties on the original object instead of using <code class=\"language-text\">this</code> inside the constructor, the created objects don’t have those properties themselves — they reference the original object’s properties and methods.</p>\n<p>If you don’t properly understand this distinction, you can end up in situations like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>john<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Evan\nEvan</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>So if you want each object to have its own unique properties, you should define them using <code class=\"language-text\">this</code> inside the constructor, not on the original object. To repeat: <strong>properties and methods defined on the original object are shared among all created objects.</strong></p>\n<p>One curious thing is that the <code class=\"language-text\">evan</code> object had no properties or methods, yet I was able to access the <code class=\"language-text\">say</code> method through <code class=\"language-text\">evan.say</code>. How is that possible?</p>\n<h2 id=\"prototype-lookup\" style=\"position:relative;\">Prototype Lookup<a href=\"#prototype-lookup\" aria-label=\"prototype lookup permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The answer lies in prototype lookup — one of the ways JavaScript searches for properties within an object. Here’s what happened when JavaScript found the <code class=\"language-text\">say</code> method on the <code class=\"language-text\">evan</code> object:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3caa593b82cbd86bf7af67e4dff11475/a2498/prototype_lookup.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.75000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAD2EAAA9hAHVrK90AAABiUlEQVR42pVSu2oCURDdGC0sbVKE4B9YWfkLWiSF+YCkskt62TqQ3xERF0VECxE1yKKID1B84BOX9YFys07mLG5YjJJkYJh7Z86cO/fcK0knRkTXiK1W63G1WlG5XDbS6fShWCwauq4T8nbcr2YBJ5NJeDqdglBUq9XPfD4v5vM5If9fQgdiPB6PYML1em1w7sCOSIlEImLH/YXwioMjFosF2+12NpfLJTkqfN3kYrHIMmEI9SPuLIEzk8mYXiqVXEegm9114Uzk3cABb/WCB346GeJdoVB47nQ6IUsnW83Jj3LPD/TE61t77dvG47Fcr9flRqMhj0ajKPu7oiivtVrtwTrRRujiBwqnUqmXwWDwxr1R9MLB02w2ZYCINSImMEXfbDYfXq/XA50uXNmBOnDAq6pq8NRYEmtMEhfEcDgU2+12jySLXwkEAjd+v/+shsijrmlaZbfbEU+6ZxPcKmazmZD4itTr9Wi5XJoT8l49TvhDH2vv8/k83W5Xxb/kXvPD82DU7/fpC7lobzt/8ly5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"prototype lookup\" title=\"\" src=\"/static/3caa593b82cbd86bf7af67e4dff11475/6af66/prototype_lookup.png\" srcset=\"/static/3caa593b82cbd86bf7af67e4dff11475/69538/prototype_lookup.png 160w,\n/static/3caa593b82cbd86bf7af67e4dff11475/72799/prototype_lookup.png 320w,\n/static/3caa593b82cbd86bf7af67e4dff11475/6af66/prototype_lookup.png 640w,\n/static/3caa593b82cbd86bf7af67e4dff11475/d9199/prototype_lookup.png 960w,\n/static/3caa593b82cbd86bf7af67e4dff11475/21b4d/prototype_lookup.png 1280w,\n/static/3caa593b82cbd86bf7af67e4dff11475/a2498/prototype_lookup.png 1764w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<blockquote>\n<ol>\n<li>Attempt to access <code class=\"language-text\">evan.say</code></li>\n<li>Hmm, no <code class=\"language-text\">say</code> property here? Let’s follow <code class=\"language-text\">__proto__</code> up to the original object!</li>\n<li><code class=\"language-text\">User.prototype</code>, do you have a <code class=\"language-text\">say</code> property?</li>\n<li>You do? Profit!</li>\n</ol>\n</blockquote>\n<p>When you try to access a property on an object, JavaScript first checks whether that object has the property. If it doesn’t, it follows the prototype link up to the original object and checks again.</p>\n<p>This persistent search continues all the way up to <code class=\"language-text\">Object.prototype</code> — the ancestor of all objects. If the property doesn’t exist even there, only then does it return <code class=\"language-text\">undefined</code>.</p>\n<p>This means every object can access the properties and methods of all original objects in its prototype chain.</p>\n<p>Put simply, the <code class=\"language-text\">evan</code> object we just created has no properties or methods of its own, but it can use the <code class=\"language-text\">say</code> method defined on <code class=\"language-text\">User.prototype</code> (its original) as well as methods like <code class=\"language-text\">toString</code> or <code class=\"language-text\">hasOwnProperty</code> from <code class=\"language-text\">Object.prototype</code>.</p>\n<center>\n  <div style=\"width: 200px;\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7b54dda3a84203718b2412b4631d61b5/31493/prototype_lookup2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 220.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAACXBIWXMAAD2EAAA9hAHVrK90AAAGZUlEQVR42q1XW0xUVxQdrNZiqhapoQVKrJ22SGqTxsQ2fjWm6ZdJv0x/TKyNf36ppdGERBIzxqTph4kzVKdm5OEEjU9QER+8BhWfKIiACCKIKDigyEXg3svuWif3TGcQpJie5GSfOffeffbeZ611zrhc/7a41atXx8Mm5OXl7X/y5Im0tbWNoFu6t7S0WPfv37du376txg8ePFDznOvu7rZKSkqsKH+u9xcuXOiG/aGgoKBU0Gw02rGxMRoJh8NSXV0t58+fF8uyRDfnNamrq5Noh/Pi4+OTOdi7d+9PFy9e/PPSpUvbYT26h0Ihz+nTpz3nzp3zXL58OWb+xo0bHmTmccHxTPS4tLS0hAULFqRyvG3btpmu/6HNQ/9I1xOO33mbzgjLsQFlN2/erEIa1b29vZWYK0L/mJ5hZzlZTNnLy8tnuvr6+towaD1x4kR7UVFROxx3YK4GiyQ5DuOmlSfqNYN2z54989evX5/K8aFDhzIbGhpq79y5U3H37t0QIBK6d+9eCIuF+BtQCTU3N0fm6+vr1dzx48dD0b7npqSkKIc1NTU5DlwsQgYvy/Xr1wU4E2QiFRUVUllZqWDS09MTgc9rsElNTU3h4Nq1a16+gNWtjo4OaW1tFYBXEJEA1ILngggFGcjTp09lcHBQOUSkMQ7nADZLYN8DePcTuLm5uVZ2drbs3LlTCgsLBaUQlEaNvV6vAK8SCARky5YtaiEuElPP5cuXEzouANfPFfv7+y1SELQSbJQw2sePH8vz58/l2bNnKt3Ozk559OiRmKYpV69ejXWoth3typUrKuVXr15ZpNXo6CjHimK0TJFzdEI7MjKiUsamTewQlPMyAlgLVJNTp07J0aNHhePi4mJBBlJVVSXHjh1Tz06ePDlhDaMd+rg60rH4AXeY9amtrZWuri4B+AVIULvOkkB1JtzlmAhfvnzJKKzS0lK5deuW0B45ckRFg81S9sKFCzI8PBxRo/EO41asWDEX9gN8nMu6ANwW6Kg+ZJSECSNkLXVn01I23uFc6OFnsD8CCqWMEGnakCeBPElTU5McPnw4kh6d6chi9JCkprf09PTEZcuWpTlM8QEyfGEYhTeRukmLeprt7e0mvjHhRFl2RKgssGjGMCWKej6uCOxR2hX2WPwXL14omIxv4yP8FfX6Bd43oNC/4ffPqF0JHhajZv7Gxsb9SDcAUQhgPoANCgBvMR1qrZ6DSQE6VJAAmFn4MYfsPYZhpDryNWNa8gWofHX27NklAO13Pp9vJRx+AY6uzMrK+mbTpk3pW7duzWCHzGXk5ORk7Nq1S409Hk+GfrZ582Zl161blzFhDcvKyv5gvcDZAZx0BhYxwFcD6RkogYGaGpA0A/VVz8AqA3g0ICoGhXWW3uWlS5d+yTGg4nfqrbhMyLAkyCZCN8KJ2CQuJ9PD2YmJiek86JF+Hl/Ay6MQVBuObOy8Dac2eGzjuQ3w2wC8DaG14ZjbbGPD7DeqDRxa1D5SjWyhWpOCtGfOnFF6uG/fPjXHRk2c0CFW9Wn50mygWJCOLAGppqVMSxh/syyTigOdYGMsKsvAwIByRiHgx7rTGTvn2ahGMeKwatWqObBJ0LwDpB4WsPx+vzqkou84UzFFAXfx4sXz3W43xeH7/Pz8EooD2ggcmyi6iYKbEAkT0UQ4PCWXk5OTP9FcZn3wosXzgsXGCahgwvTH8zkmQrzwIcYJiOBTpPc1xrOBtd/BzSI4yAdPg8BhEA6DOEaD/I35IOoV6ZwD4IPgcpAp9+FHH7a+H4DtwxnMXOvQ3+4q8vDhw79RGz9ok4t+AM79oFjB7t27v127du2izMzMzzdu3OjG2esGh907duxQY935TD9fs2aNe8KbA8RiO+AyDI72oocxDoOzYSweRgZhcDkMHqt5/WxoaCgMIQ4ruGiHSUlJizjAOfKXU2x1WPBI5VWYxySEQ3VuEM9h4nCyQ+pdh8uJoFWe43CU92xstg19tFEanjGKwzhi1TwbnL6Zy/qyxNuXhgbphuuaHDx4UN1tcLZEwD7ZpT0iZZrLuHJYiExxFjWKHJ10rq8kfO6QYHIuA9heJyqlh/yAgkteR99pNJf/092GJx0+sng35L2G1w78bVD3QS0GU/1Pea2GlC9Gxih0vZg6052WQ0Tk5XmM6Pj3K3J7paXyMGr+1p2nJjnP+84/JJLSlavYgYkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"prototype lookup2\" title=\"\" src=\"/static/7b54dda3a84203718b2412b4631d61b5/6af66/prototype_lookup2.png\" srcset=\"/static/7b54dda3a84203718b2412b4631d61b5/69538/prototype_lookup2.png 160w,\n/static/7b54dda3a84203718b2412b4631d61b5/72799/prototype_lookup2.png 320w,\n/static/7b54dda3a84203718b2412b4631d61b5/6af66/prototype_lookup2.png 640w,\n/static/7b54dda3a84203718b2412b4631d61b5/31493/prototype_lookup2.png 664w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </div>\n  <small>The evan object inherits properties from all original objects in its prototype chain</small>\n  <br>\n  <br>\n</center>\n<p>Prototype lookup is performed every time you access a property or method, which makes it feel a bit different from inheritance in class-based languages where all inheritance relationships are evaluated when the class is defined.</p>\n<p>But abstractly speaking, since it’s inheriting the parent (original) object’s attributes, we can implement inheritance based on prototype lookup.</p>\n<h2 id=\"inheritance-using-prototypes\" style=\"position:relative;\">Inheritance Using Prototypes<a href=\"#inheritance-using-prototypes\" aria-label=\"inheritance using prototypes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>There are broadly two ways to implement inheritance using prototypes in JavaScript: using the <code class=\"language-text\">Object.create</code> method, and without it <small>(the ugly way)</small>.</p>\n<p>In practice, <code class=\"language-text\">Object.create</code> alone is more than enough for prototype-based inheritance. The reason I mention both is that <code class=\"language-text\">Object.create</code> is only supported from Internet Explorer 9 onwards.</p>\n<p>But since this post is written for my own happiness, I’d rather not go into detail about IE 8 and below environments. I’ll simply attach a <a href=\"https://gist.github.com/evan-moon/a7e5a51e20d22016ea443a03480765b7\" target=\"_blank\" rel=\"nofollow\">link to my GitHub Gist</a> with the code for the non-<code class=\"language-text\">Object.create</code> approach.</p>\n<h3 id=\"use-objectcreate\" style=\"position:relative;\">Use Object.create<a href=\"#use-objectcreate\" aria-label=\"use objectcreate permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The <code class=\"language-text\">Object.create</code> method takes as its first argument the object that will serve as the new object’s original, and as an optional second argument, properties to add to the new object.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>proto<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span> properties<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The second argument is optional, and rather than simply passing something like <code class=\"language-text\">{ test: 1 }</code>, you need to specify data descriptors and accessor descriptors, like you would with <code class=\"language-text\">Object.defineProperties</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'I am Foo!'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>For the detailed meaning of each property, check <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties\" target=\"_blank\" rel=\"nofollow\">MDN Web Docs: Object.defineProperties</a>.</p>\n<p>The key point of this method is that you can specify an object’s prototype object, which means you can manipulate the prototype chain however you want. You can even change it dynamically. <small>(This is honestly one of JS’s more wild aspects…)</small></p>\n<p>Now let’s implement inheritance using <code class=\"language-text\">Object.create</code> and prototypes.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">SuperClass</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">SuperClass</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">say</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I am </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>First, I created a <code class=\"language-text\">SuperClass</code> constructor function to serve as the parent class and defined a <code class=\"language-text\">say</code> method on its prototype object. Now let’s implement the child class constructor and define the inheritance relationship.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">SubClass</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">SuperClass</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">SubClass</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SuperClass</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">SubClass</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> SubClass<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">SubClass</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">run</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is running</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It might look like a lot, but when you break it down piece by piece, it’s fairly straightforward.</p>\n<h4 id=\"superclasscallthis\" style=\"position:relative;\">SuperClass.call(this)<a href=\"#superclasscallthis\" aria-label=\"superclasscallthis permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>The <code class=\"language-text\">Function.prototype.call</code> method changes the execution context of the called function to whatever is passed as the first argument. In other words, it changes the target of <code class=\"language-text\">this</code>.</p>\n<p>So <code class=\"language-text\">SuperClass.call(this, name)</code> means: call the parent constructor, but change the execution context to the child constructor. Think of it as the JavaScript equivalent of calling <code class=\"language-text\">super</code> in Java.</p>\n<p>I used <code class=\"language-text\">call</code> here, but anything that changes the parent constructor’s execution context works fine — <code class=\"language-text\">apply</code> or <code class=\"language-text\">bind</code> would do the job equally well.</p>\n<h4 id=\"changing-subclassprototype\" style=\"position:relative;\">Changing SubClass.prototype<a href=\"#changing-subclassprototype\" aria-label=\"changing subclassprototype permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Next, I used <code class=\"language-text\">Object.create</code> to create a new object with <code class=\"language-text\">SuperClass.prototype</code> as its original, and assigned it as <code class=\"language-text\">SubClass</code>’s prototype object. This creates a prototype chain — in other words, a parent-child relationship — between the child constructor’s prototype object and the parent constructor’s prototype object.</p>\n<h4 id=\"changing-subclassprototypeconstructor\" style=\"position:relative;\">Changing SubClass.prototype.constructor<a href=\"#changing-subclassprototypeconstructor\" aria-label=\"changing subclassprototypeconstructor permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Since we cloned the parent constructor’s prototype object verbatim, the new child constructor’s prototype object still has its <code class=\"language-text\">constructor</code> property pointing to the parent constructor <code class=\"language-text\">SuperClass</code>.</p>\n<p>But objects created through <code class=\"language-text\">SubClass</code> shouldn’t appear as if they were created using <code class=\"language-text\">SuperClass</code>, so we need to reassign the <code class=\"language-text\">constructor</code> property to <code class=\"language-text\">SubClass</code>.</p>\n<p>After all these steps, the following relationship is established:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8ad5010e348e3ea93ea8ee00b6a3a94b/a3c4c/extends.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAD2EAAA9hAHVrK90AAAB/klEQVR42qVSOYtaURR2BrKQFCkCmSappphJkTbFFCEIQggYcILKaBIdAhbpUoRMZ+ef0NZWHTQyATfEQm0EN8R9eS+uuO++d2++e3EmPyAHDufB+d453z3fpxiPx1SSJJrJZGggEGBVpojhcPjHZDKd+ny+r8gfGo3m+Wg0ut5utzSdTkvhcJjG43FaKBRkQgirSgULURRJs9kkvV6PzGYzslwuJTZwvV63bDbb00ql8qpUKp0BegDc9XQ6pYPBYAsiBN8ElePdbvdHPnCxWFC2geU+OMPNZiMqlcojl8t14fF4vgP6pFwu/8Yw2u12JfovOD4Wi73nAxuNhh5b9O12Wy8IAqu6Tqdzge8PWq32vsViuWe1Wh8ybLVafVMsFj+Bse4Wj9T1+31DMBg89vv9DxT/EyB2sK+PIpHIt0QicaWo1+tG3NGIzTxrtZoBT/rcarXOGbv9D4esovcWvUvGKJvNGnFTI+5uwBlMDofjRKVSPeY3ZAHqNBqNsspvAnFEDDwNhUIWKHplNptfzOdzD+vhyVIymaSpVIqCDMeD3TtOG7cgYEMmkwmBskRiHkLAHgKs8sxut790Op2vAT3Esl9MFCi/Q5+sVqs7V9yJAr9RbGaqcqV3ux3fCLCgVquPvF7vF/jwJ1M5l8vd5PN5iudKsizTfXL8rQ//Atnk4klMaXG1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"extends\" title=\"\" src=\"/static/8ad5010e348e3ea93ea8ee00b6a3a94b/6af66/extends.png\" srcset=\"/static/8ad5010e348e3ea93ea8ee00b6a3a94b/69538/extends.png 160w,\n/static/8ad5010e348e3ea93ea8ee00b6a3a94b/72799/extends.png 320w,\n/static/8ad5010e348e3ea93ea8ee00b6a3a94b/6af66/extends.png 640w,\n/static/8ad5010e348e3ea93ea8ee00b6a3a94b/d9199/extends.png 960w,\n/static/8ad5010e348e3ea93ea8ee00b6a3a94b/21b4d/extends.png 1280w,\n/static/8ad5010e348e3ea93ea8ee00b6a3a94b/a3c4c/extends.png 2196w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Now let’s create an object using the <code class=\"language-text\">SubClass</code> constructor and verify that it properly inherits the parent constructor’s attributes.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SubClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">SubClass <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// The evan object</span>\nSubClass <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">constructor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Function<span class=\"token operator\">:</span> SubClass<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">run</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Function<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// evan's original object</span>\nSuperClass <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">say</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Function<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// The original of evan's original object</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">evan</code> object was properly created by cloning <code class=\"language-text\">SubClass</code>’s prototype object, and the chain of original objects is correctly linked.</p>\n<p>In other words, the prototype chain <code class=\"language-text\">evan</code> → <code class=\"language-text\">SubClass.prototype</code> → <code class=\"language-text\">SuperClass.prototype</code> is complete. When you call <code class=\"language-text\">run</code> or <code class=\"language-text\">say</code> on the <code class=\"language-text\">evan</code> object, prototype lookup kicks in to find and call the method from the original objects.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Continuing from the <a href=\"/2019/10/23/js-prototype/\">previous post</a>, I’ve covered inheritance patterns using prototypes in JavaScript.</p>\n<p>Honestly, I’ve rarely had to implement inheritance using these patterns in production. ES6 came out shortly after I started working as a developer, and since I was more familiar with Java at the time, I was completely absorbed by the new <code class=\"language-text\">class</code> keyword.</p>\n<p>But after a few years on the job, I encountered these inheritance patterns fairly often in legacy code, and they sometimes came up in interviews too, so they’re definitely worth studying.</p>\n<p>Even though ES5 is rarely used these days, these inheritance patterns are still foundational to JavaScript program architecture.</p>\n<p>That wraps up this post on implementing inheritance with prototypes.</p>","fields":{"slug":"20191027-inheritance-with-prototype-en","path":"/2019/10/27/inheritance-with-prototype/en/","lang":"en"},"frontmatter":{"title":"[JS Prototypes] Implementing Inheritance with Prototypes","subTitle":"The real way to implement inheritance in JavaScript — everything about the prototype chain","date":"Oct 27, 2019","categories":["Programming","JavaScript"],"tags":["Prototype","JavaScript","JavaScript Fundamentals","Frontend Fundamentals","JavaScript Inheritance","JavaScript Class"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/ffc88c93a54f1c5d1783f61478e57588/d803c/thumbnail.png","srcSet":"/static/ffc88c93a54f1c5d1783f61478e57588/d803c/thumbnail.png 320w,\n/static/ffc88c93a54f1c5d1783f61478e57588/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/ffc88c93a54f1c5d1783f61478e57588/fc5c5/thumbnail.webp 320w,\n/static/ffc88c93a54f1c5d1783f61478e57588/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/ffc88c93a54f1c5d1783f61478e57588/01fb2/thumbnail.png","srcSet":"/static/ffc88c93a54f1c5d1783f61478e57588/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/ffc88c93a54f1c5d1783f61478e57588/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"54ec493a-2ec4-5e4d-830e-63299b15f53c","tableOfContents":"<ul>\n<li>\n<p><a href=\"#do-i-really-need-to-know-about-prototypes-when-es6-has-classes\">Do I Really Need to Know About Prototypes When ES6 Has Classes?</a></p>\n</li>\n<li>\n<p><a href=\"#prototype-is-a-design-pattern\">Prototype Is a Design Pattern</a></p>\n</li>\n<li>\n<p><a href=\"#javascripts-prototype\">JavaScript’s Prototype</a></p>\n<ul>\n<li><a href=\"#how-javascript-creates-objects\">How JavaScript Creates Objects</a></li>\n<li><a href=\"#so-what-exactly-gets-cloned\">So What Exactly Gets Cloned?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#prototype-chain\">Prototype Chain</a></p>\n</li>\n<li>\n<p><a href=\"#wrapping-up\">Wrapping Up</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to talk about prototypes — a concept you can’t ignore when discussing JavaScript. Prototypes are very familiar to those who’ve been using JavaScript since the ES5 days, but for developers who started with ES6, classes are the norm, so prototypes might feel like unfamiliar territory.","html":"<p>In this post, I want to talk about prototypes — a concept you can’t ignore when discussing JavaScript.</p>\n<p>Prototypes are very familiar to those who’ve been using JavaScript since the ES5 days, but for developers who started with ES6, classes are the norm, so prototypes might feel like unfamiliar territory.</p>\n<!-- more -->\n<p>When I first started frontend development, JavaScript was in the midst of transitioning from ES5 to ES6. Having primarily used Java before switching to frontend development, the concept that gave me the most trouble was prototypes. <small>(And it still does, to be honest.)</small></p>\n<p>Of course, JavaScript’s stature has risen significantly since then, and interest in the prototype pattern has grown with it. Still, the mainstream approach to object creation — both then and now — remains class-based, as seen in C-family languages and Java.</p>\n<p>That’s why prototype-based programming feels relatively unfamiliar to developers coming to JavaScript for the first time. This difficulty in transitioning is precisely why the <code class=\"language-text\">class</code> keyword was introduced in ES6.</p>\n<p>Honestly, I’m still more comfortable with class-based object creation myself, so I need to keep studying prototypes too.</p>\n<p>That’s why in this post, I want to focus on what the prototype pattern is and how prototypes are used within JavaScript.</p>\n<h2 id=\"do-i-really-need-to-know-about-prototypes-when-es6-has-classes\" style=\"position:relative;\">Do I Really Need to Know About Prototypes When ES6 Has Classes?<a href=\"#do-i-really-need-to-know-about-prototypes-when-es6-has-classes\" aria-label=\"do i really need to know about prototypes when es6 has classes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>JavaScript has supported classes using the <code class=\"language-text\">class</code> keyword since ES6. To be precise, it would be more accurate to say classes are implemented by mimicking them with prototypes under the hood.</p>\n<p>Many developers call JavaScript’s classes mere “syntactic sugar,” but personally, I think JavaScript’s classes impose stricter constraints than the ES5 prototype-based approach to object creation. So rather than simple syntactic sugar, I’d say they’re more of a superset.</p>\n<p>So if we can just use classes, why bother learning about prototypes?</p>\n<p>Because even though ES6 supports classes via the <code class=\"language-text\">class</code> keyword, that doesn’t mean JavaScript has become a class-based language. At the end of the day, classes in JavaScript are prototypes wearing a class costume.</p>\n<p>On top of that, a lot of legacy frontend code was written in ES5, so frontend developers still have to work with ES5 fairly often. And even if you want to migrate ES5 code to ES6 or later, you can’t do that migration if you don’t understand the prototype-based object creation and inheritance in the existing code.</p>\n<h2 id=\"prototype-is-a-design-pattern\" style=\"position:relative;\">Prototype Is a Design Pattern<a href=\"#prototype-is-a-design-pattern\" aria-label=\"prototype is a design pattern permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>When people hear “prototype,” they usually think of JavaScript, but prototypes aren’t exclusive to JavaScript — they’re simply a design pattern. Besides JavaScript, many other languages support prototype-based programming, including ActionScript, Lua, and Perl.</p>\n<p>So before diving deep into JavaScript’s prototypes, let’s first look at prototype as a design pattern.</p>\n<p>The prototype pattern is one of several patterns for efficiently creating objects, primarily used to avoid the high cost of object creation.</p>\n<p>When we say object creation is expensive, we literally mean a lot of work has to be done every time an object is created.</p>\n<p>For example, imagine you’re implementing a character for an RPG game. This character can equip various items. Since players would be unhappy starting with nothing, you want characters to spawn with some basic equipment.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// Player.java</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Weapon</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Armor</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BasicSword</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Weapon</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BasicArmor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Armor</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Player</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Weapon</span> weapon<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Armor</span> armor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>weapon <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicSword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Beginner's wooden sword</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>armor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicArmor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Beginner's armor</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here’s a rough sketch. The <code class=\"language-text\">Player</code> object has to create both a <code class=\"language-text\">BasicSword</code> and a <code class=\"language-text\">BasicArmor</code> object when it’s instantiated.</p>\n<p>In this case, the creation cost is higher than just creating a <code class=\"language-text\">Player</code> object alone. And the more items you add to the initial loadout, the higher the creation cost climbs.</p>\n<p>Hmm… but thinking about it, if every new character always starts with the same items, we could just create one expensive <code class=\"language-text\">Player</code> object and clone it from then on.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// This is too expensive...</span>\n<span class=\"token class-name\">Player</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> john <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> wilson <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// What about this approach instead?</span>\n<span class=\"token class-name\">Player</span> player <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> evan <span class=\"token operator\">=</span> player<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> john <span class=\"token operator\">=</span> player<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> wilson <span class=\"token operator\">=</span> player<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is essentially the prototype pattern. There’s a prototype — an original object — and you clone it to create new objects.</p>\n<p>In Java, classes that serve as clone targets typically implement the <code class=\"language-text\">Cloneable</code> interface. Since the Cloneable interface defines a <code class=\"language-text\">clone</code> method, any class using it must override and implement <code class=\"language-text\">clone</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Player</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Cloneable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Player</span> clone <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CloneNotSupportedException</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Player</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Once you implement <code class=\"language-text\">clone</code>, the <code class=\"language-text\">Player</code> object becomes cloneable — it now has the ability to serve as the original for other objects.</p>\n<p>From now on, whenever you need another <code class=\"language-text\">Player</code> object, you can simply clone an existing one, avoiding the high creation cost.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Player</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Player</span> evanClone <span class=\"token operator\">=</span> evan<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Also, the <code class=\"language-text\">Player</code> object is copied to a new memory location, but unless you perform a deep copy, the <code class=\"language-text\">BasicSword</code> and <code class=\"language-text\">BasicArmor</code> objects it holds aren’t newly created — they just reference the same memory where the originals are stored.</p>\n<p>In other words, used wisely, this can save memory. It’s the same principle as how JavaScript uses call by value for primitives and call by reference for everything else.</p>\n<p>As some of you might have guessed, this means if you’re not careful, you can end up in this unfortunate situation:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Player</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Player</span> evanClone <span class=\"token operator\">=</span> evan<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    evanClone<span class=\"token punctuation\">.</span>weapon<span class=\"token punctuation\">.</span>attackPoint <span class=\"token operator\">=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Evan's weapon attack -> \"</span> <span class=\"token operator\">+</span> evan<span class=\"token punctuation\">.</span>weapon<span class=\"token punctuation\">.</span>attackPoint<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Clone's weapon attack -> \"</span> <span class=\"token operator\">+</span> evanClone<span class=\"token punctuation\">.</span>weapon<span class=\"token punctuation\">.</span>attackPoint<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Evan's weapon attack -> 40\nClone's weapon attack -> 40</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cd3f0d7227b1bc002df8850727239515/14007/overtime_work.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHSsUgYAP/EABkQAAIDAQAAAAAAAAAAAAAAAAECABAREv/aAAgBAQABBQJtCg0zTrFn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAABABESFBYf/aAAgBAQAGPwLFHVcLZ//EABwQAAICAgMAAAAAAAAAAAAAAAEhABExUWFxkf/aAAgBAQABPyHMexUwArSVxCAWMJw1jtwgGn6n/9oADAMBAAIAAwAAABAwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQEBAQABBQAAAAAAAAAAAAERIQBBMVFxoeH/2gAIAQEAAT8QswKlv8uFyIWNGGx9usMy6R5Gi7WvH68u4sIfRrPrrBBnjHf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"overtime work\" title=\"\" src=\"/static/cd3f0d7227b1bc002df8850727239515/14007/overtime_work.jpg\" srcset=\"/static/cd3f0d7227b1bc002df8850727239515/0913d/overtime_work.jpg 160w,\n/static/cd3f0d7227b1bc002df8850727239515/cb69c/overtime_work.jpg 320w,\n/static/cd3f0d7227b1bc002df8850727239515/14007/overtime_work.jpg 582w\" sizes=\"(max-width: 582px) 100vw, 582px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Welcome to debugging hell...</small>\n</center>\n<p>To summarize, the prototype pattern is about creating new objects by cloning an original object.</p>\n<p>Of course, JavaScript’s prototype system isn’t just about a few objects having clone relationships — every single object in JavaScript is woven into a web of clone relationships, making it a bit more complex. But the fundamental principle still follows the prototype pattern.</p>\n<p>Now let’s look at how JavaScript actually uses the prototype pattern when creating objects.</p>\n<h2 id=\"javascripts-prototype\" style=\"position:relative;\">JavaScript’s Prototype<a href=\"#javascripts-prototype\" aria-label=\"javascripts prototype permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>As I explained earlier, the prototype pattern is used for object creation. Java, the language I used for the examples above, supports class-based programming, so you need a special pattern to use the concept of prototypes.</p>\n<p>But JavaScript natively supports prototype-based programming, meaning the prototype pattern is applied every time an object is created, automatically.</p>\n<p>For that reason, we need to understand what JavaScript means by “object” and what it means for an object to be “created.”</p>\n<h3 id=\"how-javascript-creates-objects\" style=\"position:relative;\">How JavaScript Creates Objects<a href=\"#how-javascript-creates-objects\" aria-label=\"how javascript creates objects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>In computer science, an object is “a real-world entity modeled in a program” — something with properties (characteristics) and methods (behaviors) that mimics something in the real world.</p>\n<p>In class-based languages, you create a class and then use it to create objects. But JavaScript can create objects with simple syntax:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">29</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">say</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hi, I am </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This approach is called “declaring an object with a literal.” Since a literal is essentially a shorthand for fixed values in source code, it feels like we’re creating objects with minimal syntax, but internally a whole mechanism for object creation is at work.</p>\n<p>For example, in other languages, when you create an object using literal syntax, classes are used internally. In Python, if you declare a dictionary with a literal and check its type, you’ll see the <code class=\"language-text\">dict</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">my_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'age'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">29</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>my_dict<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;class 'dict'></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>We didn’t explicitly write <code class=\"language-text\">dict({ 'name': 'Evan', 'age': 29 })</code> — we used a literal — but internally, it properly used the <code class=\"language-text\">dict</code> class to create the object.</p>\n<p>Similarly, in Java, if you declare an array using literal syntax and print it, you can see it’s ultimately creating the array object based on a class:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> array <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Evan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"29\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[Ljava.lang.String;@7852e922</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The point is, just like in other languages, JavaScript objects don’t just magically pop into existence — something is being used to create them.</p>\n<p>But JavaScript doesn’t have a concept of classes, so what is it using to create objects?</p>\n<blockquote>\n<p>The answer is functions.</p>\n</blockquote>\n<p>To dig deeper into how JavaScript creates objects, let’s declare the <code class=\"language-text\">evan</code> object from earlier using a different method:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">29</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This looks suspiciously like creating an object using a class in a class-based language. This approach is called creating an object using a constructor.</p>\n<p>In a class-based language, <code class=\"language-text\">Object</code> would be a class, but in JavaScript, it’s a function.</p>\n<p>In other words, constructors in JavaScript belong to functions. Let’s verify this by printing <code class=\"language-text\">Object</code> in the browser console:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> Object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">ƒ <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>native code<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n<span class=\"token string\">\"function\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Yep, <code class=\"language-text\">Object</code> is unmistakably a function.</p>\n<p>This was one of the hardest things for me to accept when I first started using JavaScript.</p>\n<p>Coming from class-based programming, <code class=\"language-text\">new</code> and constructors were things only classes could have. Having a function pop up out of nowhere was hard to wrap my head around. <small>(My brain gets it, but my heart…)</small></p>\n<p>Anyway, now we know that JavaScript uses functions to create objects. Let’s recap what we’ve learned so far:</p>\n<blockquote>\n<ol>\n<li>The prototype pattern creates objects by cloning an original object.</li>\n<li>JavaScript uses the prototype pattern when creating objects.</li>\n<li>JavaScript uses functions to create objects.</li>\n</ol>\n</blockquote>\n<p>This means that when JavaScript uses a function to create an object, it references and clones something. It’s time to find out what that “something” is.</p>\n<h3 id=\"so-what-exactly-gets-cloned\" style=\"position:relative;\">So What Exactly Gets Cloned?<a href=\"#so-what-exactly-gets-cloned\" aria-label=\"so what exactly gets cloned permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The prototype pattern as a design concept isn’t that complicated. It’s just about cloning an original object to create a new one.</p>\n<p>JavaScript works the same way — it clones something to create new objects. To figure out what that something is, let’s declare a simple function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> evan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">User <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">__proto__</span><span class=\"token operator\">:</span> Object <span class=\"token punctuation\">}</span>\nobject</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>As I mentioned, JavaScript uses functions to create objects, so you can create objects in a way that feels similar to using classes.</p>\n<p>So what was <code class=\"language-text\">evan</code> cloned from? You might think it was cloned from the <code class=\"language-text\">User</code> function itself, but it was actually cloned from “the prototype object of the <code class=\"language-text\">User</code> function.”</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f720bb5dac9cb6fe226a654ae54db785/fce5f/surprise.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQIE/9oADAMBAAIQAxAAAAFjUkXw3JljGf/EABwQAQEAAAcAAAAAAAAAAAAAAAECAAMREhMhMf/aAAgBAQABBQKVI5mqno3aYzfaVf/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AVf/xAAZEQADAAMAAAAAAAAAAAAAAAAAARECFGH/2gAIAQIBAT8ByVUNTp//xAAbEAACAQUAAAAAAAAAAAAAAAAAAVEQEUFh0f/aAAgBAQAGPwKyQliTtNEn/8QAGxABAAIDAQEAAAAAAAAAAAAAAQAhETFBUWH/2gAIAQEAAT8hVAo9hRosh1Dk3tgPbfsQWMK8HIpVfpZ//9oADAMBAAIAAwAAABDH/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCD/8QAGhEBAAEFAAAAAAAAAAAAAAAAAQARIVGh4f/aAAgBAgEBPxCr5xbd17P/xAAcEAEAAgMBAQEAAAAAAAAAAAABESEAMUFhgZH/2gAIAQEAAT8QnyZjiXvhjJENEh5v8yCLNaFZfPMRXWpBfwytwJBUtfcWGOrEZ//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"surprise\" title=\"\" src=\"/static/f720bb5dac9cb6fe226a654ae54db785/fce5f/surprise.jpg\" srcset=\"/static/f720bb5dac9cb6fe226a654ae54db785/0913d/surprise.jpg 160w,\n/static/f720bb5dac9cb6fe226a654ae54db785/cb69c/surprise.jpg 320w,\n/static/f720bb5dac9cb6fe226a654ae54db785/fce5f/surprise.jpg 497w\" sizes=\"(max-width: 497px) 100vw, 497px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Wait, prototype just appeared out of nowhere...?</small>\n</center>\n<p>This might seem abrupt, but think about it simply. If the function itself were cloned, wouldn’t the resulting object be of type <code class=\"language-text\">Function</code> rather than <code class=\"language-text\">Object</code>?</p>\n<p>But <code class=\"language-text\">evan</code> is of type <code class=\"language-text\">Object</code>. That means something of object type was cloned — not the function itself — and that original object is the <code class=\"language-text\">User</code> function’s prototype object.</p>\n<p>I never explicitly declared a prototype for <code class=\"language-text\">User</code>, but JavaScript automatically creates a prototype object (Prototype Object) whenever a function is created and links it to the function’s <code class=\"language-text\">prototype</code> property.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">constructor</span><span class=\"token operator\">:</span> f <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">__proto__</span><span class=\"token operator\">:</span> Object <span class=\"token punctuation\">}</span>\nobject</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>I only declared a function, yet <code class=\"language-text\">User.prototype</code> has a fully-formed object attached to it like a buy-one-get-one-free deal. The key point is: whenever a function is created, its prototype object is automatically created along with it.</p>\n<p>This prototype object serves as the original that gets cloned when you use the function to create new objects.</p>\n<p>In other words, when you use <code class=\"language-text\">new User()</code>, it doesn’t clone the <code class=\"language-text\">User</code> function itself — it clones the prototype object assigned to <code class=\"language-text\">User.prototype</code>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/038db1dd67c62b78ef0c8473d3468899/21e8f/prototype.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAD2EAAA9hAHVrK90AAABqklEQVR42qWSSWoCURCGmwwgRMgiBJNVLpBjtLucwlu4ktDdSAIhBCSriHgED+BGXCiKA+KIOKA4i5hWW7uVyl+PFsywEFLw07zqel8Nr6TFYkHz+ZzK5TLF43FKJBLU7XZJ13WTYM1m80mCZbPZdz4j1oKPYrEYRaNRgp+m0ymZpkmVSoUkxFis1WplJZNJq9VqWfjJMhgwHo9VBubz+Q8+b7dbq1gsUi6XI8QL8HA45F+EuyQxvdfr0WazoUPb7XaciBqNxisD6/X6C5JyJ2an0xEVHcSKL/ularXqR0Y/2vQPBgOh0WjkR1YN1b0VCoUHBqIdFWdKpVIzVPJpGMYCCVYAf67Xax08HaPQpWMtEAg4VVW9jUQirmAweO3xeO7cbvd9OBy+8vl8N5qmubxer0v6h51BF7+8mKGCVpR2u62USiWlVqsp/X6ffY+TyeQFI5E5Di2d/Lh6/idwP1i8nlgZfil70GLqgGt23NlRFVqw5XIpVsd+2b2MQ2AoFHLYENYp5PgTyAudTqf5Is1mM0KbQmhZrE0mk3nmOFmWL23AXk4b/s2+AN9ErkY8uSpGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"prototype\" title=\"\" src=\"/static/038db1dd67c62b78ef0c8473d3468899/6af66/prototype.png\" srcset=\"/static/038db1dd67c62b78ef0c8473d3468899/69538/prototype.png 160w,\n/static/038db1dd67c62b78ef0c8473d3468899/72799/prototype.png 320w,\n/static/038db1dd67c62b78ef0c8473d3468899/6af66/prototype.png 640w,\n/static/038db1dd67c62b78ef0c8473d3468899/d9199/prototype.png 960w,\n/static/038db1dd67c62b78ef0c8473d3468899/21b4d/prototype.png 1280w,\n/static/038db1dd67c62b78ef0c8473d3468899/21e8f/prototype.png 1684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Dear evan object, clone my prototype object, not me</small>\n</center>\n<p>This prototype object, created alongside the <code class=\"language-text\">User</code> function, is called the prototype property.</p>\n<p>So what do the <code class=\"language-text\">constructor</code> and <code class=\"language-text\">__proto__</code> properties inside this prototype object mean?</p>\n<h4 id=\"constructor\" style=\"position:relative;\">constructor<a href=\"#constructor\" aria-label=\"constructor permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Every prototype object that’s created alongside a function has a <code class=\"language-text\">constructor</code> property. This property holds a reference to the function that was declared when the prototype object was created.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">constructor</span><span class=\"token operator\">:</span> f <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">__proto__</span><span class=\"token operator\">:</span> Object\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>When you declare a function, both the function and its prototype object are created and linked to each other. The function is linked via the prototype object’s <code class=\"language-text\">constructor</code> property, and the prototype object is linked via the function’s <code class=\"language-text\">prototype</code> property.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7a8216c54a105c3b1df15c379d0cb707/2b984/prototype_connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 15.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAD2EAAA9hAHVrK90AAAA4UlEQVR42i2OvWqEUBCF7VMkVYogSbkvJQiyiLC9gTQWNoGYB/AFfARFsRBrG0FErAS18gf/ua5yZ+eGnGKGM5wzfFzf9wdTVVVHEARHURT3bdvoPM+jrusfoii+hGH45fv+pyAIT5IkXZZlue/7DnEcU9d1IYoiYL4sS+DGcQRCCJznCf+ibOCNKIpysSzrLcuyW5IkNyy/aprGI8Re1zUgBMXngP6v2DQNcHmeG2maGhgw1nU1hmH4mabpt23bb1mWn23b5h3HuXqedzVN811VVR6zBDvQdR1lIIyObUb4AEHCviv5bRQfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"prototype connection\" title=\"\" src=\"/static/7a8216c54a105c3b1df15c379d0cb707/6af66/prototype_connection.png\" srcset=\"/static/7a8216c54a105c3b1df15c379d0cb707/69538/prototype_connection.png 160w,\n/static/7a8216c54a105c3b1df15c379d0cb707/72799/prototype_connection.png 320w,\n/static/7a8216c54a105c3b1df15c379d0cb707/6af66/prototype_connection.png 640w,\n/static/7a8216c54a105c3b1df15c379d0cb707/d9199/prototype_connection.png 960w,\n/static/7a8216c54a105c3b1df15c379d0cb707/21b4d/prototype_connection.png 1280w,\n/static/7a8216c54a105c3b1df15c379d0cb707/2b984/prototype_connection.png 2164w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The function and prototype object are linked to each other</small>\n</center>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">===</span> User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>From the perspective of an object created through this function, the constructor property answers the question: “Which function was called to create me?” Without this link, a newly created object would have no way of knowing which constructor function was used.</p>\n<p>A newly created object has a link to which original object it was cloned from, but not to which constructor was called — so it accesses the original object’s <code class=\"language-text\">constructor</code> property to find out.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span><span class=\"token class-name\">__proto__</span><span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">===</span> User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The property that lets a created object access its original object is the <code class=\"language-text\">__proto__</code> property.</p>\n<h4 id=\"__proto__\" style=\"position:relative;\">__proto__<a href=\"#__proto__\" aria-label=\"__proto__ permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>When I explained the constructor, I mentioned that objects created through a function have a link to their original object. This link is called the prototype link.</p>\n<p>Every object in JavaScript — except <code class=\"language-text\">Object.prototype</code> — was created by cloning an original object, so every object has a prototype link pointing to its original. That link is stored in the <code class=\"language-text\">__proto__</code> property.</p>\n<p>I’ll explain why <code class=\"language-text\">Object.prototype.__proto__</code> doesn’t exist later. For now, just focus on the fact that objects have prototype links to their originals.</p>\n<blockquote>\n<p>This post uses the <code class=\"language-text\">__proto__</code> property for clarity.\nHowever, while it was standard in ECMAScript 2015, it is no longer standard, so using <code class=\"language-text\">Object.getPrototypeOf()</code> is recommended.</p>\n</blockquote>\n<p>Objects created using the <code class=\"language-text\">User</code> function are cloned from the <code class=\"language-text\">User.prototype</code> object, so they store <code class=\"language-text\">User.prototype</code> in their <code class=\"language-text\">__proto__</code> property.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> evan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evan<span class=\"token punctuation\">.</span>__proto__ <span class=\"token operator\">===</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token boolean\">true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>So if we keep following the prototype links to trace back to the original objects, shouldn’t we eventually find out which ultimate original object every JavaScript object was cloned from?</p>\n<h2 id=\"prototype-chain\" style=\"position:relative;\">Prototype Chain<a href=\"#prototype-chain\" aria-label=\"prototype chain permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Every object used in JavaScript is defined and created through this prototype-based approach. That means built-in objects like <code class=\"language-text\">String</code>, <code class=\"language-text\">Boolean</code>, and <code class=\"language-text\">Array</code> were all created the same way.</p>\n<p>So what prototype objects were they cloned from?</p>\n<p>Whether it’s <code class=\"language-text\">String</code>, <code class=\"language-text\">Boolean</code>, <code class=\"language-text\">Array</code>, or anything else — everything in JavaScript is cloned starting from <code class=\"language-text\">Object.prototype</code>, the prototype of the <code class=\"language-text\">Object</code> function.</p>\n<p>When I explained <code class=\"language-text\">__proto__</code> earlier, I mentioned that <code class=\"language-text\">Object.prototype</code> has no prototype link — no link to an original object. That’s because <code class=\"language-text\">Object.prototype</code> is the ancestor of all objects.</p>\n<p>To verify this, pick any object and follow its <code class=\"language-text\">__proto__</code> chain upward.</p>\n<p>Let’s use <code class=\"language-text\">String</code> since it’s an easy target. Note that depending on whether you start from the <code class=\"language-text\">String</code> constructor function or a <code class=\"language-text\">String</code> object, the path to the ancestor differs — because they obviously have different originals. I chose the <code class=\"language-text\">String</code> constructor function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> first <span class=\"token operator\">=</span> String<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> second <span class=\"token operator\">=</span> first<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'First ancestor -> '</span><span class=\"token punctuation\">,</span> first<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Second ancestor -> '</span><span class=\"token punctuation\">,</span> second<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">First ancestor -> Function\nSecond ancestor -> Object</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Every function in JavaScript has <code class=\"language-text\">Function.prototype</code> as its original. And since <code class=\"language-text\">Function.prototype</code> is itself an object, it naturally has <code class=\"language-text\">Object.prototype</code> as its original.</p>\n<p>What happens if we go one more level up?</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> third <span class=\"token operator\">=</span> second<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>third<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Uncaught TypeError: Cannot read property 'constructor' of null at &lt;anonymous>:1:28</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>A <code class=\"language-text\">TypeError</code>. The error message tells us that <code class=\"language-text\">Object.prototype.__proto__</code> is <code class=\"language-text\">null</code>.</p>\n<p>In other words, there’s nothing above <code class=\"language-text\">Object</code>. Here’s a simple diagram of this relationship:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/93b117acac7ef6b38673300c3c764241/0f96c/prototype-chain.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.87500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAD2EAAA9hAHVrK90AAACRUlEQVR42n1STWgTURDeJlVrFdSLkGO1gkLwkot4MEiPBvXkIQS9yNoqC40WPIR2L1I8leKpuYaeckhIAhVEEpKANuSH/Jl/8rO4+V02/z00m7zOrFsxFx/Mm3kz874338yjKIpaMJvNl0FT4XD4I4FVKpVOA4HA1O/3T9FGXy6Xe4s5LMsugVKDvlitVlcgfgfCy9T5SiaTtzwejxbtRqPxDi+Px2NpNBqhxqOEWyqV2sQck8l0BdQFq9V6LZ1OmyORyKder7eKMUhboDKZzA464XATbH29Xnd0u10bAB4C4OFwOLS1221HsVh8jJfsdruaml9Ysepfh0qn08kl5/P5RwB2UC6X99xu977L5doH354oigcA+FCpYu6yRqNZngPEF41G4w0FcOucMlRGBoOBbKOv0+nQCuAi3vH5fItgq/V6/VXsJ55R5AoNBoNcYTAYfAWNTvE8/xOSQyiSJP3o9/u/OI5/rgD+nzJQeRkKhV5D4nXooVYQBAvHcR9gwlsolUrlfbPZtMCU7ytTVsGDz6ANDDCinU4nE4vFNoDNejabXaei0ehTqOwF9gZovSF/lgR9JPAYmc1mMuVMTZCnzDDMJRhYEH2ValUCEFIoFMh0OiXwMJEp0zQtU4bAJnwBAhVKCvBfwN+t1gYQVutZ35IoCkeddot0RWEymZzOxicnMmCtViPy38GmKj18kEgkduPx+A58FRboo2yD/ZnjSlqL7Xjl23cv6/V6v3w9zjxxRAf3to86a5Ecf7fXa90GtqtnOODSpjeTadoAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"prototype chain\" title=\"\" src=\"/static/93b117acac7ef6b38673300c3c764241/6af66/prototype-chain.png\" srcset=\"/static/93b117acac7ef6b38673300c3c764241/69538/prototype-chain.png 160w,\n/static/93b117acac7ef6b38673300c3c764241/72799/prototype-chain.png 320w,\n/static/93b117acac7ef6b38673300c3c764241/6af66/prototype-chain.png 640w,\n/static/93b117acac7ef6b38673300c3c764241/d9199/prototype-chain.png 960w,\n/static/93b117acac7ef6b38673300c3c764241/21b4d/prototype-chain.png 1280w,\n/static/93b117acac7ef6b38673300c3c764241/0f96c/prototype-chain.png 2248w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</center>\n<p>It looks complex, but it’s straightforward. The <code class=\"language-text\">String</code> constructor function’s original object is <code class=\"language-text\">Function.prototype</code>. A <code class=\"language-text\">String</code> object declared like <code class=\"language-text\">const a = 'evan'</code> has <code class=\"language-text\">String.prototype</code> — the prototype of the <code class=\"language-text\">String</code> constructor — as its original. And since <code class=\"language-text\">String.prototype</code> is an object, it naturally has <code class=\"language-text\">Object.prototype</code> as its original.</p>\n<p>This web of prototype relationships is called the prototype chain.</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The reason I decided to write about prototypes was that I recently got a question in a job interview asking me to implement a Private Static method using JavaScript prototypes — and I couldn’t solve it.</p>\n<p>It was a problem that required combining closures and prototypes, but my fundamentals weren’t strong enough to pull it off.</p>\n<p>I originally wanted to cover various inheritance techniques using prototypes and member encapsulation with closures as well, but as always, the post got longer than planned, so those topics will have to wait for a separate post.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8d8688b810398dcf20c57de5e7c319b4/066f9/no_think.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 116.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7phJsAgUH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABUQAQEAAAAAAAAAAAAAAAAAACAh/9oACAEBAAY/AhT/AP/EABoQAQACAwEAAAAAAAAAAAAAAAEAERAxQYH/2gAIAQEAAT8hZ3CXuFnrDyJcNT//2gAMAwEAAgADAAAAEL/3w//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABwQAQEAAgMBAQAAAAAAAAAAAAERACEQMVFBcf/aAAgBAQABPxByHuCEGn6XrgkAEfcaMRdFll1s42f1kmu8KQ5//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"no think\" title=\"\" src=\"/static/8d8688b810398dcf20c57de5e7c319b4/066f9/no_think.jpg\" srcset=\"/static/8d8688b810398dcf20c57de5e7c319b4/0913d/no_think.jpg 160w,\n/static/8d8688b810398dcf20c57de5e7c319b4/cb69c/no_think.jpg 320w,\n/static/8d8688b810398dcf20c57de5e7c319b4/066f9/no_think.jpg 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Honestly, I never think about length control when I start writing</small>\n</center>\n<p>For developers like me who are used to class-based object creation, JavaScript’s prototypes feel quite complex. The prototype pattern as a design concept is simply “clone an object to create a new one,” but JavaScript’s prototype chain is far more intricately connected than that.</p>\n<p>That said, while prototype chains and various inheritance techniques can feel daunting, the core skeleton of prototypes isn’t that hard:</p>\n<blockquote>\n<ol>\n<li>Objects are created using functions, and they’re created by cloning the function’s prototype object.</li>\n<li>Every object has information about which original object it was cloned from.</li>\n</ol>\n</blockquote>\n<p>Of course, you can do wild things like dynamically changing the reference to the original object at runtime, and there are various techniques built on top of that. But at the end of the day, it comes down to those two principles. In the next post, I’ll cover inheritance techniques using prototypes and prototype lookup — the mechanism for searching an object’s properties.</p>\n<p>That wraps up this overview of JavaScript prototypes.</p>","fields":{"slug":"20191023-js-prototype-en","path":"/2019/10/23/js-prototype/en/","lang":"en"},"frontmatter":{"title":"Beyond Classes: A Complete Guide to JavaScript Prototypes","subTitle":"The real object creation mechanism hidden behind class syntax","date":"Oct 23, 2019","categories":["Programming","JavaScript"],"tags":["Prototype","JavaScript","JavaScript Fundamentals","Frontend Fundamentals"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/d803c/thumbnail.png","srcSet":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/d803c/thumbnail.png 320w,\n/static/c4c3f4bd82adfc1f6422180eedbd4fb0/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/fc5c5/thumbnail.webp 320w,\n/static/c4c3f4bd82adfc1f6422180eedbd4fb0/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/01fb2/thumbnail.png","srcSet":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/c4c3f4bd82adfc1f6422180eedbd4fb0/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"903e28d3-c3a1-5cde-90da-2d3a97bb77cf","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-the-v8-engine\">What Is the V8 Engine?</a></p>\n</li>\n<li>\n<p><a href=\"#how-the-v8-engine-works\">How the V8 Engine Works</a></p>\n<ul>\n<li><a href=\"#parsing-understanding-what-the-code-means\">Parsing: Understanding What the Code Means</a></li>\n<li><a href=\"#generating-bytecode-with-ignition\">Generating Bytecode with Ignition</a></li>\n<li><a href=\"#cooling-down-hot-code-with-turbofan\">Cooling Down Hot Code with TurboFan</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#closing-thoughts\">Closing Thoughts</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V8’s actual source code.","html":"<p>In this post, I want to explore how Google’s V8 engine interprets and executes JavaScript. V8 is written in C++, but since C++ isn’t my primary language and the codebase is massive, I won’t be doing an exhaustive analysis. Instead, I’ll try to cross-reference information available on the web with V8’s actual source code.</p>\n<!-- more -->\n<h2 id=\"what-is-the-v8-engine\" style=\"position:relative;\">What Is the V8 Engine?<a href=\"#what-is-the-v8-engine\" aria-label=\"what is the v8 engine permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The V8 engine is a high-performance JavaScript &#x26; WebAssembly engine written in C++, led by Google. It’s also open source, so you can clone it from the <a href=\"https://github.com/v8/v8\" target=\"_blank\" rel=\"nofollow\">V8 engine GitHub repository</a>. It’s currently used in Google Chrome and Node.js, and implements the ECMAScript and WebAssembly standards.</p>\n<p>As of June 28, 2019, if you check the <a href=\"https://compat-table.github.io/compat-table/es2016plus/\" target=\"_blank\" rel=\"nofollow\">Kangax Table</a>, you can see that CH (Chromium) and Node — both powered by V8 — have implemented nearly all ES2016+ features, while Microsoft’s Chakra and Mozilla’s SpiderMonkey still have noticeable gaps marked in red.</p>\n<blockquote>\n<p>To improve compatibility with other platforms and reduce mutual risk, Microsoft Edge will now use the V8 engine as part of this change. We still have a lot to learn, but we’re excited to become part of the V8 community and to contribute to this project.</p>\n<p><strong>ChakraCore team</strong> <em><a href=\"https://github.com/Microsoft/ChakraCore/issues/5865\" target=\"_blank\" rel=\"nofollow\">ChakraCore Github Issue</a></em></p>\n</blockquote>\n<p>As it happens, the Edge browser — which had been using the Chakra engine — has announced it will adopt V8 as part of joining the Chromium open-source project. Whether this is good or bad… I’m not quite sure yet.</p>\n<p>If you want to build V8 yourself and actually debug it, you can’t just clone it with git. If you want to go that far, check out the V8 official site’s <a href=\"https://v8.dev/docs/source-code\" target=\"_blank\" rel=\"nofollow\">Checking out the V8 source code</a>.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAWqmWguiFRl//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIABBETIf/aAAgBAQABBQLYGCvstkqh9Sqx5//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/Aaf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEJ/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAESMRARQVH/2gAIAQEABj8CJuV4TXpt2X0//8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFRQfH/2gAIAQEAAT8hoZUK3AiejiFgexiaXKdd9QbNCP/aAAwDAQACAAMAAAAQIz//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAwEBPxCD/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/ENFj/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBYbHR/9oACAEBAAE/EKLyBDy1bKKN9MM0wCZHUVaOyn5NGIgL516gUVkB2iif/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme1\" title=\"\" src=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg\" srcset=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/0913d/meme1.jpg 160w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/cb69c/meme1.jpg 320w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg 640w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg 743w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Chromium is such a massive project that just the installation process for building is quite demanding</small>\n</center>\n<p>I’ve set it up once before, and as you might expect, it didn’t go smoothly — so I recommend attempting it on a weekend when you have plenty of time. Since I’ll only be analyzing the source code this time, I simply cloned it using git.</p>\n<h2 id=\"how-the-v8-engine-works\" style=\"position:relative;\">How the V8 Engine Works<a href=\"#how-the-v8-engine-works\" aria-label=\"how the v8 engine works permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>In general, when using JavaScript, you don’t need to think deeply about low-level details like how the engine works. After all, the whole point of using an engine is so developers don’t have to worry about such things. But if you truly want to squeeze the best possible performance out of JavaScript, you need at least some understanding of how your code is executed.</p>\n<p>Let’s start with a simple diagram showing how V8 interprets and executes our JavaScript source code. I’ll explain the details below, so for now, just get a general feel for the flow.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVR42nVSO27cMBT04XIJH8MHSJHWvoNLH8BFgJQBUqQIDBd2s81+tZBISqT4E0VSVIbSOrEE7NsnAsvH4ZsZvpvxevR97xwW37nedh12hmFI45imwN+ba0iUWylZXe/3+6Io2lbO+yGOMd8wLsAhBGMsWjnnpJTH47EsS8YYIaQihHOBMz++P989Hr8+vv75/XMBBhJ4HNVaNzxHHKKxFsS7zlmbab+8vn35tru9fy+L/QKMQ9paqRTA2hhQLasKRIRo9bQ1H3t4bp5+qaw/pYXm7EdK8wqj6roB7c1mg4uUUpce2UO/1rwKyihjtZpYYEVmF+e8+PUBRivI673P5MH5VPCaj/PxqYqnQmnS36W0dBtWCSG22y1M5g2n+Hl+NmckdVRYYbQ5nU6ogor3YQGOMUIVyU/Cjbbaa+XVPAzCC2oo2BOKOpVSodOadohRtC3edvIrrQYGLgKJmYlTeUU72s5hpOqmgbphWIBxL+zAmyHxCqC5AHvvIQaytVLGdgPn2Bo/JHkoYmy32x0OB0opOl3Acw+AIQYziJDaDE0zns+XLMsgVYkRJQS0q4r812xN3zIKJR4XxojP/+v5STOKuRQCFIMjnFdK/QX7NF/0AdGOjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"v8compiler pipeline\" title=\"\" src=\"/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png\" srcset=\"/static/27979b3d2674a00f5b68af5f303fb27c/69538/v8compiler-pipeline.png 160w,\n/static/27979b3d2674a00f5b68af5f303fb27c/72799/v8compiler-pipeline.png 320w,\n/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png 640w,\n/static/27979b3d2674a00f5b68af5f303fb27c/d9199/v8compiler-pipeline.png 960w,\n/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png 1019w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Slides from Franziska Hinkelmann's presentation at JSConf EU 2017</small>\n</center>\n<p>V8 takes our source code and first hands it to the <code class=\"language-text\">Parser</code>. The parser analyzes the source code and transforms it into an <code class=\"language-text\">AST (Abstract Syntax Tree)</code>.</p>\n<p>Next, this AST is passed to <code class=\"language-text\">Ignition</code>, which is an interpreter that converts JavaScript into bytecode. By converting the original source into bytecode — a form much easier for the computer to interpret — V8 avoids the overhead of re-parsing the original code, reduces the amount of code, and saves memory during execution.</p>\n<p>The bytecode is then executed, making our source code actually run. Among the executed code, frequently used portions are sent to <code class=\"language-text\">TurboFan</code>, where they’re recompiled into <code class=\"language-text\">Optimized Machine Code</code>. If that code later becomes less frequently used, it gets deoptimized.</p>\n<p>An interesting detail is that many of V8’s components are named after real engine parts. The V8 engine is actually a type of engine commonly found in high-performance cars — named because eight pistons are arranged in a V shape, driving a single crankshaft.</p>\n<p><code class=\"language-text\">Ignition</code> refers to the igniter used to start an engine. Your source code is revving up and running. And when it gets called too many times and your code starts running hot, <code class=\"language-text\">TurboFan</code> optimizes it — cooling things down so it doesn’t overheat.</p>\n<p>If you’ve read other V8 analysis posts, you may have also seen components called <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. The name <code class=\"language-text\">Crankshaft</code> also comes from real engines — it’s the core component connected to the pistons that converts their reciprocating motion into rotational motion. But as of June 19, 2019, these components can no longer be found in V8.</p>\n<blockquote>\n<p>Starting with V8 v5.9, Ignition and TurboFan are used across the board for JavaScript execution. Additionally, starting with V8 v5.9, Full-codegen and Crankshaft — technologies that have served V8 well — are no longer used in V8, as they were unable to keep up with new JavaScript features and the optimizations those features demand. We plan to remove them entirely soon, which means V8 will have a much simpler and more maintainable architecture going forward.</p>\n<p><strong>V8 team</strong> <em><a href=\"https://v8.dev/blog/launching-ignition-and-turbofan\" target=\"_blank\" rel=\"nofollow\">Launching Ignition and TurboFan</a></em></p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 509px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAADBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFx+lmwZkn/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQMREiH/2gAIAQEAAQUCcVmDI+Ipn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwG6r//EABcQAQEBAQAAAAAAAAAAAAAAAAAxECH/2gAIAQEABj8C4irv/8QAHBAAAwABBQAAAAAAAAAAAAAAAAERUSFhgbHw/9oACAEBAAE/IUV2LyKz5QugmW5Lcnmn/9oADAMBAAIAAwAAABBjP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCYj//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EAp//8QAGxABAQEBAAMBAAAAAAAAAAAAAREhADFBYZH/2gAIAQEAAT8QQrJ6HKlMVGY/nSyHzTmGgRR5Y15drE3PXQyD9x3/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bye\" title=\"\" src=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" srcset=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/0913d/bye.jpg 160w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/cb69c/bye.jpg 320w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg 509w\" sizes=\"(max-width: 509px) 100vw, 509px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Yep. They were replaced starting from V8 v5.9.</small>\n</center>\n<p>Before v5.9, <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> coexisted alongside the newer components — but this wasn’t by choice. Early versions of <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> didn’t perform as well as expected, and there were issues where optimized code couldn’t be directly deoptimized back to bytecode, so the V8 team had no choice but to keep <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code> around as fallbacks.</p>\n<p>The V8 team’s original goal was always to use only <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code>, freely moving between <code class=\"language-text\">bytecode ↔ optimized code</code>.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe title=\"\" src=\"https://www.youtube.com/embed/r5OWCtuKiAk?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" loading=\"eager\" allowfullscreen=\"\" sandbox=\"allow-same-origin allow-scripts allow-popups\"></iframe> </div> </div>\n<br /></p>\n<p>This video is from BlinkOn 2016, where <strong>Ross McIlroy</strong> of the Chrome Mobile Performance London Team introduces <code class=\"language-text\">Ignition</code>. The 9:47–11:14 segment explains the unfortunate reasons they couldn’t remove the legacy <code class=\"language-text\">Full-codegen</code> and <code class=\"language-text\">Crankshaft</code>. He seems to find it funny himself while explaining.</p>\n<p>Now let’s take a brief look at how V8 actually parses and executes JavaScript.</p>\n<h3 id=\"parsing-understanding-what-the-code-means\" style=\"position:relative;\">Parsing: Understanding What the Code Means<a href=\"#parsing-understanding-what-the-code-means\" aria-label=\"parsing understanding what the code means permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Parsing is the process of loading source code and transforming it into an AST (Abstract Syntax Tree). The AST is a data structure widely used in compilers — think of it as restructuring the source code we write into a form that’s easy for the computer to understand.</p>\n<p>For example, if we were to parse JavaScript with JavaScript, it would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// The code above can be roughly structured like this:</span>\n\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'FunctionDeclaration'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'hello'</span>\n  <span class=\"token literal-property property\">arguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'Variable'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'name'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Laid out like this, it’s simpler than you might expect. But this is just one example — the parser also has to interpret and parse syntax like <code class=\"language-text\">for</code>, <code class=\"language-text\">if</code>, <code class=\"language-text\">a = 1 + 2</code>, <code class=\"language-text\">function () {}</code>, and so on. That’s why the parser’s internals are surprisingly large. V8’s <code class=\"language-text\">parser.cc</code> file alone exceeds 3,000 lines.</p>\n<p>In any case, just remember that parsing is the process of converting code into an AST — a form that’s easy for the computer to analyze. The V8 engine does exactly what we just illustrated in JavaScript, but using C++.</p>\n<p>Let’s take a look at the method in V8’s parsing code that handles literal arithmetic expressions like <code class=\"language-text\">1 + 2</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token keyword\">bool</span> <span class=\"token class-name\">Parser</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShortcutNumericLiteralBinaryExpression</span><span class=\"token punctuation\">(</span>Expression<span class=\"token operator\">*</span><span class=\"token operator\">*</span> x<span class=\"token punctuation\">,</span> Expression<span class=\"token operator\">*</span> y<span class=\"token punctuation\">,</span> Token<span class=\"token double-colon punctuation\">::</span>Value op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> y<span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">double</span> x_val <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">double</span> y_val <span class=\"token operator\">=</span> y<span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>op<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>ADD<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">+</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token double-colon punctuation\">::</span>SUB<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">-</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is a static method called <code class=\"language-text\">ShortcutNumericLiteralBinaryExpression</code> <em>(what a mouthful…)</em> on the <code class=\"language-text\">Parser</code> class, declared in V8’s <code class=\"language-text\">parser.cc</code>.</p>\n<p>Looking at the parameters: <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> are <code class=\"language-text\">Expression</code> objects representing the values used in the expression. <code class=\"language-text\">op</code> represents the actual operation — whether the expression means <code class=\"language-text\">x + y</code> or <code class=\"language-text\">x - y</code> — along with its type. <code class=\"language-text\">pos</code> indicates the position of the code currently being parsed within the overall source.</p>\n<p>As explained above, this method is called when it encounters source code like <code class=\"language-text\">1 + 2</code>. You can see it inspecting the expression against conditions like <code class=\"language-text\">Token::ADD</code> and <code class=\"language-text\">Token::SUB</code> and parsing accordingly. The “tokens” here are string fragments produced by lexically analyzing the source code according to JavaScript’s grammar rules.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Tokens look roughly like this</span>\n<span class=\"token punctuation\">[</span><span class=\"token string\">'const'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>After the calculation, the resulting value is turned into an AST node using the <code class=\"language-text\">AstNodeFactory</code> class’s <code class=\"language-text\">NewNumberLiteral</code> static method.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/ast/ast.cc</span>\nLiteral<span class=\"token operator\">*</span> <span class=\"token class-name\">AstNodeFactory</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> number<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> int_value<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DoubleToSmiInteger</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>int_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">NewSmiLiteral</span><span class=\"token punctuation\">(</span>int_value<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>zone_<span class=\"token punctuation\">)</span> <span class=\"token function\">Literal</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>During this process, V8 identifies the meaning of code elements like variables, functions, and conditionals. JavaScript’s scoping — something we’re all familiar with — is also established during this phase. For more details on variable declarations, see <a href=\"/2019/06/18/javascript-let-const\">JavaScript’s let and const, and TDZ</a>.</p>\n<h3 id=\"generating-bytecode-with-ignition\" style=\"position:relative;\">Generating Bytecode with Ignition<a href=\"#generating-bytecode-with-ignition\" aria-label=\"generating bytecode with ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/3ef804b01e47419b1954df82e079ed32/ignition.svg\" width=\"300\">\n  <br>\n</center>\n<p>Bytecode is an intermediate representation produced by compiling high-level source code into a form that a virtual machine can understand more easily. In V8, <code class=\"language-text\">Ignition</code> is responsible for this.</p>\n<h4 id=\"what-is-ignition\" style=\"position:relative;\">What Is Ignition?<a href=\"#what-is-ignition\" aria-label=\"what is ignition permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">Ignition</code> is an interpreter that completely replaces the legacy <code class=\"language-text\">Full-codegen</code>. The old <code class=\"language-text\">Full-codegen</code> compiled the entire source code at once. As mentioned earlier, the V8 team recognized that <code class=\"language-text\">Full-codegen</code>’s approach of compiling all source code at once consumed a significant amount of memory.</p>\n<p>Additionally, since JavaScript is a dynamically typed language — unlike statically typed languages like C++ — there were too many unknowns before runtime, making optimization with this approach extremely difficult.</p>\n<p>So when developing <code class=\"language-text\">Ignition</code>, they opted for an interpreter-based approach that processes code line by line as it executes, rather than compiling everything at once, aiming for three key benefits:</p>\n<blockquote>\n<ol>\n<li><strong>Reduced memory usage.</strong> Compiling JavaScript to bytecode is more efficient than compiling directly to machine code.</li>\n<li><strong>Reduced parsing overhead.</strong> Bytecode is concise, making it easier to re-parse.</li>\n<li><strong>Reduced compilation pipeline complexity.</strong> Both optimization and deoptimization only need to deal with bytecode, simplifying everything.</li>\n</ol>\n<p><strong>Ross McIlroy</strong> <em>Ignition - an interpreter for V8</em></p>\n</blockquote>\n<p>Just remember that <code class=\"language-text\">Ignition</code> is the component that converts code to bytecode line by line as it executes.</p>\n<p>So what does bytecode actually look like, and why is it easier for the computer to interpret? Let’s take the <code class=\"language-text\">hello</code> function from earlier and see what bytecode it generates.</p>\n<h4 id=\"viewing-the-bytecode-yourself\" style=\"position:relative;\">Viewing the Bytecode Yourself<a href=\"#viewing-the-bytecode-yourself\" aria-label=\"viewing the bytecode yourself permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// If the code isn't used, it won't be interpreted to bytecode, so we need to call it.</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you’re using Node.js v8.3+, you can add the <code class=\"language-text\">--print-bytecode</code> flag to see how your source code was interpreted into bytecode. Alternatively, you could use V8’s D8 debugging tool, but that requires building V8 — and as I mentioned, the build setup isn’t exactly smooth. So I just used <code class=\"language-text\">--print-bytecode</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --print-bytecode add.js\n<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span>generated bytecode <span class=\"token keyword\">for</span> function: hello<span class=\"token punctuation\">]</span>\nParameter count <span class=\"token number\">2</span>\nFrame size <span class=\"token number\">8</span>\n   <span class=\"token number\">15</span> E<span class=\"token operator\">></span> 0x2ac4000d47b2 @    <span class=\"token number\">0</span> <span class=\"token builtin class-name\">:</span> a0                StackCheck\n   <span class=\"token number\">30</span> S<span class=\"token operator\">></span> 0x2ac4000d47b3 @    <span class=\"token number\">1</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">12</span> 00             LdaConstant <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n         0x2ac4000d47b5 @    <span class=\"token number\">3</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">26</span> fb             Star r0\n         0x2ac4000d47b7 @    <span class=\"token number\">5</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             Ldar a0\n   <span class=\"token number\">46</span> E<span class=\"token operator\">></span> 0x2ac4000d47b9 @    <span class=\"token number\">7</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">32</span> fb 00          Add r0, <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">53</span> S<span class=\"token operator\">></span> 0x2ac4000d47bc @   <span class=\"token number\">10</span> <span class=\"token builtin class-name\">:</span> a4                Return\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is what the <code class=\"language-text\">hello</code> function looks like after being converted to bytecode. Wait — I only used one parameter, <code class=\"language-text\">name</code>, but the <code class=\"language-text\">Parameter count</code> says <code class=\"language-text\">2</code>.</p>\n<p>One of them is the implicit receiver, <code class=\"language-text\">this</code>. If you use <code class=\"language-text\">this</code> inside a function to refer to the function itself — yes, it’s that <code class=\"language-text\">this</code>. Below that, you can see values being assigned to registers. Let me explain briefly.</p>\n<p>For those who might not be familiar: a register is high-speed memory built into the CPU, and an accumulator is a register used to store intermediate calculation results.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">StackCheck</code>: Checks the upper limit of the stack pointer. If the stack exceeds the threshold, a Stack Overflow occurs and function execution is halted.</li>\n<li><code class=\"language-text\">LdaConstant [0]</code>: <code class=\"language-text\">Ld</code> stands for <code class=\"language-text\">Load</code>. It loads a constant into the accumulator. This constant is <code class=\"language-text\">Hello,</code>.</li>\n<li><code class=\"language-text\">Star r0</code>: Moves the value in the accumulator to register <code class=\"language-text\">r0</code>. <code class=\"language-text\">r0</code> is a register for local variables.</li>\n<li><code class=\"language-text\">Ldar a0</code>: Loads the value from register <code class=\"language-text\">a0</code> into the accumulator. In this case, <code class=\"language-text\">a0</code> holds the argument <code class=\"language-text\">name</code>.</li>\n<li><code class=\"language-text\">Add r0, [0]</code>: Adds <code class=\"language-text\">Hello,</code> from <code class=\"language-text\">r0</code> and <code class=\"language-text\">0</code>, storing the result in the accumulator. The constant <code class=\"language-text\">0</code> is mapped to the argument <code class=\"language-text\">name</code> at runtime.</li>\n<li><code class=\"language-text\">Return</code>: Returns the value in the accumulator.</li>\n</ol>\n<hr>\n<p>The <code class=\"language-text\">hello</code> function is something you’d declare without a second thought when writing JavaScript, but internally it goes through 6 steps to return a value.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 204px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEu0lEQVR42l2VWUhXXRTFb2Rv9ZA+CQUGBtFzYIIviUJUZmRhNpelmBOhaKiVRWWDaWJig5qalJhmZE6lVGSllZQTFFhWqIlDlj2EZq6P34778l04/M+955x11l577f13Xr9+raqqKvX39ysnJ0ebNm1SbGysNm/erB07digqKkpXr15VZWWlLl26pIiICKWkpOj79+/Kzs5Wamqqtm/fbuPEiRNyOjs71dzcrKKiIgMJDQ010ISEBIWFhen8+fMqLy/X7t27FRMToytXrmhgYMDAIiMjlZ6ernXr1unw4cM6evSonJKSEtXW1qqsrEw7d+5UYmKibYTd/v37DWDv3r3GuqenR79+/dLFixeNEd/27dtn63Fxcaqvr5eTkZGhO3fu2Dhw4IABrly5UqtWrdLq1asVFBRkF23ZskW3bt3S5cuXtWfPHrsoOTnZJGFtw4YNqqurk9Pd3a0HDx7o2LFjpg+Ly5Yt08aNG7V06VIFBwfbJchw8uRJY0R4Z86c0fHjxy0SZILhs2fP5HR0dKirq8sWd+3apfj4eFtEz4ULF2rFihXy9fXV/Pnz5efnZ1GcPXvWLti2bZtCQkJ07tw5S1pLS8s/hgA2NDRYIk6fPm0b29vblZeXp+XLl2vBggVasmSJhZ6fn28XMo+Ojja9KyoqbG4achCxGYRDIrDH0NCQHj9+rNu3b9tFJIIEoh8JAYhMY6mtW7eafZ4/fy5nZGREL1++tMOtra1Gm6epqUlHjhzRqVOnLBmAkYi1a9eabnixuLjYrMX6z58/1dbWJoeDhN3b22sfebAGNoIpicD4jIMHD2r9+vXmTdiFh4frzZs3dgamyOZ8+fLF9AIQLXl3GVI5169ft3lhYaHWrFmjmzdvCqsdOnRIExMTevHihTkDGYjSoUoIkw1uiY2Pjxvox48fTWjeMTGVQNhkmcvT0tIs21x67949PXnyRM61a9f08OFDM2hNTY2VGQadnp7W7OysZmZmDJzQ0Y1wL1y4YJ7l2/379y3LuANypiEDdiwwqAZkePfunaj1Hz9+2GEqAx1hSFREg8HJME6AmAGSXUAQHkCy52o3NTWlt2/fGms0JQkMIoMxg6YBY2OIHRobGw0AH1HTJIBQCBtd7t69aw6gPeXm5hpDwAmfkqU0qTIIOAUFBaYJmWNzZmamsrKy7BDf8SGZ//37t96/fy/6J2Xq6ekpb29v+fv7W/lR+waIKalf+trTp0+VlJRkWiEBgOjC8+jRI1H3X79+tQtYxypeXl5yHEc+Pj4WqcMBQGBCqITCZtii5+TkpBkfz5H1ubk5u8D9HRwcVEBAgDw8PP7V8qtXr6znUQHoWVpaauYlMZQlCQHUfVw7/f37V3/+/LFv9AE6kvVD6o/WtGjRIqtR/goYNAdC6+vrs0P8YiGaBToC6A6cQN+k85tt0GDevHk26H8YHDBs9O3bNwMcHR21yvnw4YM+ffpk3nRNz3famwESHoD0PJgyp4PzwMTtPjD5/+PqSEkuXrz4X8j0OZchtzDHSq5ebMLIY2NjGh4e1ufPn409czwbGBhonR3bmLHpEPiOdkT4JAMjkwwY8ss7wGSxurragNhLo4Adnr1x44b9p/wHGUBrDK6MFtQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow\" title=\"\" src=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" srcset=\"/static/e75c06934a527f059c1754c33f12e6ff/69538/slow.png 160w,\n/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png 204w\" sizes=\"(max-width: 204px) 100vw, 204px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>It does this much work under the hood, so let's not complain too much when it's occasionally slow</small>\n</center>\n<p>Bytecode is essentially a set of instructions telling the CPU exactly how to use its registers and accumulator. It’s mind-bending for humans, but much easier for the computer to understand.</p>\n<p>Since the V8 engine converts all of our JavaScript code into bytecode like this internally, the first time a line of code runs there’s a slight delay — but from then on, it can achieve performance close to a compiled language.</p>\n<h3 id=\"cooling-down-hot-code-with-turbofan\" style=\"position:relative;\">Cooling Down Hot Code with TurboFan<a href=\"#cooling-down-hot-code-with-turbofan\" aria-label=\"cooling down hot code with turbofan permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/69868eb577b0cc588456498aa200170b/turbofan.svg\" width=\"300\">\n  <br>\n</center>\n<p><code class=\"language-text\">TurboFan</code> is the optimizing compiler that completely replaced the legacy <code class=\"language-text\">Crankshaft</code> starting with V8 v5.9. So why did <code class=\"language-text\">Crankshaft</code> get retired?</p>\n<p>Since V8 first came into the world, new computer architectures emerged and JavaScript continued to evolve, so V8 had to keep up. The V8 team kept patching things to accommodate new specifications, but eventually they determined that <code class=\"language-text\">Crankshaft</code>’s architecture couldn’t sustain continued expansion. So they built <code class=\"language-text\">TurboFan</code> — designed with multiple layers for more flexible extensibility.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADp0lEQVR42j2SWVNiVxSF+WN570ollUpix6HbsXFqTeyYGByAy8wFZJ4RUUCmCzKpOLUoKnZrnvN7vuz4kIdVtc+9+6y91tpHd1OIcnkY5mrfz+d8kC9FP/1Siq/NDC8HLp4OgrxoSe4qcW61FP2aoBThsRjjpRjm+ThNt5xm32/CvPIe3U0xwW0hxk0+wrUQP5cCDMsRHg68fM2YeTx0MdRiPNeSPAnpsJ6UOsFLNcawEOBrKcQ/J0KasGJbm0X3WE3Q3/fRSar0ckHuiyGGrTQPorQXNtPMqtzL+UsjxW0+zH01zmM9zY2oPM/tciv3/25naMYUlNVJdINylLtihFZC5SznY1AMiL0kzT2VesjIVcHLw1GQpyMZVA1xURI34qSb8XAZt3Mj/Q+lKFrQjHlpHF0/o3KzJz9zfq4O/QyqQa6qSc4Pd2mGNjlNO7mrRXkQq/c1IZMch6JqKMNv91VuyyGejrMUAxaMi6PortNuumkXFykbVxErg4KPa7lwtuflJLrJWUqRYW76OY/EINnK4gZ5H/18QJbo404cDkVAN2hkS/+LLCVh5yxmpRG1o0VtDGQZxzE7Oe8m5cAWvbTC54SRRthIO2OnHTfRTdroSc9RVKGSkozrCbmv8Nfcz+guMy5p9FCPuzmVTFohM+dxMxdit+U10PILqW9DlDpoin0t7eV0z0knZKLo3qAl2XUk74JvWyyPoWv4d16XUYqpYlGhIdLb8q21a6AXMFD3GGhHrTJIFhSz0BVFvQNB3MGxDK5Jby1sIRsw4vhdnk0zbKPgtxATFSeS4YWo7ckT0oIKnbiF+u4mWeUTQeMnMrZ1TlNOulGnWHfSEtUF7xZnhZCQ23F/lIftjk7zp/cHdiIjaEU3tawVj38Bj3dasrRyKQPUPxYZGx1BPztGXtS2JaZO1k1HllU5UOgeeMipa6xv/IjOWpvgPxjzb7HkR/GWZliPfs9q6A1qZo5IfgWjf4rFrbes+UZwZ2dR89PY8uNsp3/iY+QNa/5vWfN8x6TrG3SW6iRWbRpnc+EVjoYep8BcncVYncFYmcNUnkOpfmC7NMX20RTG8iSbxXFMFekpTWLRZgRTwjOFzqHN46zrhWhJGmew1eZxaMtyXn6tTUcfsFSWhXSBnaNZwQxbxWkMhYn/iSyanp3Se5TaO3SG/IRMnsQkapSaHmt9GXtjEVdrCbW9gqu5jFvg6fwqWJV6BbX1Gz6pbSLEeSyu6vNCOCWD3vEv/fEw1QLEp/4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"legacy\" title=\"\" src=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" srcset=\"/static/0b92cf561c8d37d00ae81e4db81baadb/69538/legacy.png 160w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/72799/legacy.png 320w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Running Crankshaft and TurboFan simultaneously probably felt something like this...</small>\n</center>\n<p>When supporting 7 architectures, what took 13,000–16,000 lines of code in <code class=\"language-text\">Crankshaft</code> could be covered in under 3,000 lines with <code class=\"language-text\">TurboFan</code>.</p>\n<p>During runtime, V8 has a component called the <code class=\"language-text\">Profiler</code> that collects data such as how frequently functions and variables are called. When this data is brought to TurboFan, it picks out the code that meets its criteria and optimizes it.</p>\n<p>The optimization techniques include Hidden Classes, Inline Caching, and various others, but I’ll cover those in more detail in a future post.</p>\n<p>To briefly explain: Hidden Classes involve classifying similar objects together for reuse. Inline Caching means that if a frequently used piece of code is a function call like <code class=\"language-text\">hello()</code>, it gets replaced with the function’s actual body <code class=\"language-text\">function hello () { ... }</code>. It’s literally caching.</p>\n<h4 id=\"what-conditions-trigger-optimization\" style=\"position:relative;\">What Conditions Trigger Optimization?<a href=\"#what-conditions-trigger-optimization\" aria-label=\"what conditions trigger optimization permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>So what exact conditions does <code class=\"language-text\">TurboFan</code> use to determine which code to optimize? Let’s look at <code class=\"language-text\">RuntimeProfiler</code>’s <code class=\"language-text\">ShouldOptimize</code> method, which determines whether a function should be optimized.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/execution/runtime-profiler.cc</span>\nOptimizationReason <span class=\"token class-name\">RuntimeProfiler</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ShouldOptimize</span><span class=\"token punctuation\">(</span>JSFunction function<span class=\"token punctuation\">,</span> BytecodeArray bytecode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// int ticks = how many times this function has been called</span>\n  <span class=\"token keyword\">int</span> ticks <span class=\"token operator\">=</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">feedback_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">profiler_ticks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> ticks_for_optimization <span class=\"token operator\">=</span>\n      kProfilerTicksBeforeOptimization <span class=\"token operator\">+</span>\n      <span class=\"token punctuation\">(</span>bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> kBytecodeSizeAllowancePerTick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ticks <span class=\"token operator\">>=</span> ticks_for_optimization<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If the call count exceeds the threshold, consider it \"hot\"</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kHotAndStable<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>any_ic_changed_ <span class=\"token operator\">&amp;&amp;</span> bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> kMaxBytecodeSizeForEarlyOpt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If not inline-cached and bytecode length is small, consider it a small function</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kSmallFunction<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// If none of the above apply, don't optimize</span>\n  <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token double-colon punctuation\">::</span>kDoNotOptimize<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I was a bit surprised by how few conditions there are. Of course, there are more granular conditions handled elsewhere, but this method captures the big picture.</p>\n<p><code class=\"language-text\">kHotAndStable</code> means the code is hot and stable — in plain terms, it’s called frequently (hot) and doesn’t change (stable). Code inside loops that repeatedly performs the same operation is a prime candidate for this.</p>\n<p><code class=\"language-text\">kSmallFunction</code> means that based on the length of the interpreted bytecode, if it doesn’t exceed a certain threshold, the function is considered small and gets optimized. Small, simple functions are likely to have very abstract or limited behavior, which makes them stable.</p>\n<h4 id=\"peeking-at-turbofan-in-action\" style=\"position:relative;\">Peeking at TurboFan in Action<a href=\"#peeking-at-turbofan-in-action\" aria-label=\"peeking at turbofan in action permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Let’s see how optimization works with a simple code example. I’ll declare a small function and call it repeatedly in a loop.</p>\n<p>My goal is for the function to hit the <code class=\"language-text\">ticks >= ticks_for_optimization</code> condition and reach <code class=\"language-text\">kHotAndStable</code> status. I figure if I declare any function, use the same argument types, and call it rapidly and repeatedly, it should hit <code class=\"language-text\">ShouldOptimize</code>’s threshold and get optimized as <code class=\"language-text\">kHotAndStable</code>.</p>\n<p>When running Node.js with the <code class=\"language-text\">--trace-opt</code> flag, you can observe code being optimized at runtime.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> d <span class=\"token operator\">=</span> c <span class=\"token operator\">-</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> d <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>marking 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan OSR<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.132</span>, <span class=\"token number\">0.453</span>, <span class=\"token number\">0.027</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.850</span>, <span class=\"token number\">0.549</span>, <span class=\"token number\">0.012</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>completed optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It did get optimized. The <code class=\"language-text\">ICs with typeinfo: 3/3 (100%)</code> tells us inline caching was applied.</p>\n<p>But the optimization reason says <code class=\"language-text\">small function</code>. Since I wanted the <code class=\"language-text\">kHotAndStable</code> condition, I need to tweak the code and try again. My function was too simple — <code class=\"language-text\">TurboFan</code> didn’t take it seriously.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>arguments<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Please provide arguments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> array\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">*</span> el<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I made it moderately more complex — though the logic itself is meaningless. The <code class=\"language-text\">sample</code> function simply takes arguments, transforms them, filters them, reverses the order, and returns the result. The optimization targets <code class=\"language-text\">TurboFan</code> would be watching are functions like <code class=\"language-text\">sample</code>, <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, <code class=\"language-text\">reverse</code>, and <code class=\"language-text\">Array.from</code>.</p>\n<p>Since there are many targets, the log output is enormous, so I’ll just show the parts where <code class=\"language-text\">TurboFan</code> marks functions for optimization.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc51 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa9611 <span class=\"token operator\">&lt;</span>JSFunction array.map.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d46f9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa96a1 <span class=\"token operator\">&lt;</span>JSFunction array.map.filter.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4761<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc11 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">10</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">90</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4785c01 <span class=\"token operator\">&lt;</span>JSFunction UseSparseVariant <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36660866d9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">20</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4786fc1 <span class=\"token operator\">&lt;</span>JSFunction reverse <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a3666086f21<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">4</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">80</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>There it is — <code class=\"language-text\">reason: hot and stable</code>. Since the output includes the function name in the format <code class=\"language-text\">&lt;JSFunction function_name></code>, we can see that <code class=\"language-text\">sample</code> and <code class=\"language-text\">reverse</code> were the ones marked for optimization. This shows how <code class=\"language-text\">TurboFan</code> profiles multiple data points — not just one — to determine whether to optimize a piece of code.</p>\n<h2 id=\"closing-thoughts\" style=\"position:relative;\">Closing Thoughts<a href=\"#closing-thoughts\" aria-label=\"closing thoughts permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>They say that well-written JavaScript can achieve performance approaching C++. When I first heard this, I thought “How can an interpreted language match a compiled language’s performance?” — but after examining V8’s internals, I was surprised by just how many optimization techniques are packed in.</p>\n<p>Tearing apart the JavaScript engine piece by piece and deepening my understanding of a language I love was genuinely fun. <em>(I wish I’d used C++ more back in school…)</em></p>\n<p>There are actually many optimization techniques inside V8 that’ll make you go “Whoa, that’s brilliant…” — and I wanted to introduce them all. But as I wrote, the content kept getting longer and started going off on tangents…</p>\n<p>So for now, I’ll stop at explaining the overall flow. In the next post, I’ll dive deeper into how <code class=\"language-text\">Ignition</code> and <code class=\"language-text\">TurboFan</code> work in more detail.</p>\n<p>Understanding TurboFan’s workflow in particular is a shortcut to optimizing your own JavaScript code, so it should come in handy.</p>\n<p>This concludes my post: How Does the V8 Engine Execute My Code?</p>","fields":{"slug":"20190628-v8-analysis-en","path":"/2019/06/28/v8-analysis/en/","lang":"en"},"frontmatter":{"title":"How Does the V8 Engine Execute My Code?","subTitle":"From bytecode to optimized compilation: a look inside V8's execution pipeline","date":"Jun 28, 2019","categories":["Programming","JavaScript"],"tags":["NodeJS","V8","JavaScript","JavaScript Fundamentals","JavaScript Engine"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/d803c/thumbnail.png 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/fc5c5/thumbnail.webp 320w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}},{"node":{"id":"5f3e9837-570f-51b2-956c-a6307bf55512","tableOfContents":"<ul>\n<li>\n<p><a href=\"#the-var-keyword\">The var Keyword</a></p>\n<ul>\n<li><a href=\"#variables-can-be-re-declared\">Variables can be re-declared</a></li>\n<li><a href=\"#it-gets-hoisted\">It gets hoisted</a></li>\n<li><a href=\"#function-level-scope\">Function-level scope</a></li>\n<li><a href=\"#the-var-keyword-can-be-omitted\">The var keyword can be omitted</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#enter-let-and-const\">Enter let and const</a></p>\n</li>\n<li>\n<p><a href=\"#characteristics-of-let-and-const\">Characteristics of let and const</a></p>\n<ul>\n<li><a href=\"#variables-cannot-be-re-declared\">Variables cannot be re-declared</a></li>\n<li><a href=\"#hoisted\">Hoisted?</a></li>\n<li><a href=\"#block-level-scope\">Block-level scope</a></li>\n<li><a href=\"#let-and-const-keywords-cannot-be-omitted\">let and const keywords cannot be omitted</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#characteristics-specific-to-const\">Characteristics specific to const</a></p>\n<ul>\n<li><a href=\"#used-to-declare-constants\">Used to declare constants</a></li>\n<li><a href=\"#must-be-initialized-at-declaration\">Must be initialized at declaration</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#conclusion\">Conclusion</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to take a deep dive into the  and  keywords that were introduced in JavaScript ES6. I’m a bit embarrassed to admit this, but until recently, I believed that  and  weren’t hoisted. Then, during a conversation with a friend, I learned that  and  are indeed hoisted — they just use a special mechanism called the TDZ to prevent access before initialization.","html":"<p>In this post, I want to take a deep dive into the <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> keywords that were introduced in JavaScript ES6. I’m a bit embarrassed to admit this, but until recently, I believed that <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> weren’t hoisted. Then, during a conversation with a friend, I learned that <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> are indeed hoisted — they just use a special mechanism called the TDZ to prevent access before initialization.</p>\n<!-- more -->\n<hr>\n<p><strong>Someone</strong>: Why do <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> throw reference errors, unlike <code class=\"language-text\">var</code>?</p>\n<p><strong>Me</strong>: <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> don’t get hoisted.</p>\n<p><strong>Friend</strong>: They do get hoisted… The reference error happens because they’re in the TDZ.</p>\n<p><strong>Me</strong>: They do??? What’s a TDZ?</p>\n<hr>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 450px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/32cc521a6a3381f1b8091672aa70ed2c/20e5d/no-yes.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 141.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAcABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF9MajFAplbjnfJB//EAB0QAAIBBAMAAAAAAAAAAAAAAAECAwAEEhMhIiP/2gAIAQEAAQUCuThLBKWETkLq9EORL4ncgPSVhHwiKUVjHdB2Nf/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EACEQAAEDBAEFAAAAAAAAAAAAAAEAAhESITFBAxAiMlGB/9oACAEBAAY/AjS4icwi52kbb0uR7offxRr7T6UY+KCU5ojoCWzpGnVllf/EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQVFhsf/aAAgBAQABPyFSECwu4pOgof2DBfW2bhiKE1O7yDQcBsjLbPVmOaX6Q77a1KALxhtwriHl5csfXBfkE2P/2gAMAwEAAgADAAAAEJAHDP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB4QAQEAAgIDAQEAAAAAAAAAAAERACExYUFxgVGx/9oACAEBAAE/EAemkY15/swDPZIu09o4KaGQBLbfuFHoCKyE+HVxpMSGz+DNn3HidEPIB5mPkWmyXfnjr2TAvqLNajG678OLBQQqA43ciABEpEhLud5ZSrzJUys2egz/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"no yes\" title=\"\" src=\"/static/32cc521a6a3381f1b8091672aa70ed2c/20e5d/no-yes.jpg\" srcset=\"/static/32cc521a6a3381f1b8091672aa70ed2c/0913d/no-yes.jpg 160w,\n/static/32cc521a6a3381f1b8091672aa70ed2c/cb69c/no-yes.jpg 320w,\n/static/32cc521a6a3381f1b8091672aa70ed2c/20e5d/no-yes.jpg 450w\" sizes=\"(max-width: 450px) 100vw, 450px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Wait... they get hoisted...?</small>\n</center>\n<p>After this humbling experience, I decided to properly study variable declaration keywords — and that’s how this post came to be.</p>\n<h2 id=\"the-var-keyword\" style=\"position:relative;\">The var Keyword<a href=\"#the-var-keyword\" aria-label=\"the var keyword permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The <code class=\"language-text\">var</code> keyword was the only way to declare variables in JavaScript through ES5. It worked quite differently from other languages, which made it notorious for confusing developers coming from other programming backgrounds.</p>\n<p>Here are the key characteristics of the <code class=\"language-text\">var</code> keyword:</p>\n<h3 id=\"variables-can-be-re-declared\" style=\"position:relative;\">Variables can be re-declared<a href=\"#variables-can-be-re-declared\" aria-label=\"variables can be re declared permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan2'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Evan2</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In this code, the declarations are close together, so it’s easy to spot that <code class=\"language-text\">name</code> is declared twice. But imagine 500 lines of code between the first and second declaration — now you’ve got a serious problem. Allowing duplicate declarations creates real potential for unintended variable mutations.</p>\n<h3 id=\"it-gets-hoisted\" style=\"position:relative;\">It gets hoisted<a href=\"#it-gets-hoisted\" aria-label=\"it gets hoisted permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Hoisting essentially means pulling all declarations within a scope to the top of that scope. This happens because JavaScript interpreters process code in two phases: first, variable and function declarations; second, actual code execution. This behavior can be quite confusing.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>When I first started with JavaScript, I thought “why doesn’t this throw a reference error?” The thing is, hoisting causes this code to behave like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> name<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Declaration gets pulled to the top</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nname <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Of course, this is just how the JavaScript interpreter processes the code internally — the actual lines in your source file don’t move.</p>\n<p>Anyway, when you get hoisted <small><strike>(I feel like “get hoisted” fits well here — it has happened to me many times…)</strike></small>, even though JavaScript is an interpreted language, the order you read the code and the order it executes can differ. This is one of the factors that makes JavaScript confusing for beginners.</p>\n<h3 id=\"function-level-scope\" style=\"position:relative;\">Function-level scope<a href=\"#function-level-scope\" aria-label=\"function level scope permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Most programming languages use block-level scoping, but JavaScript had to be different. Variables declared with <code class=\"language-text\">var</code> are only scoped to functions. This isn’t a big issue for developers familiar with JavaScript, but it’s definitely confusing for beginners.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> local <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>local<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught ReferenceError: local is not defined</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Because only function scope is recognized, even a variable <code class=\"language-text\">i</code> declared inside a <code class=\"language-text\">for</code> loop is accessible from outside.</p>\n<h3 id=\"the-var-keyword-can-be-omitted\" style=\"position:relative;\">The var keyword can be omitted<a href=\"#the-var-keyword-can-be-omitted\" aria-label=\"the var keyword can be omitted permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>You can declare a variable with or without the <code class=\"language-text\">var</code> keyword. Typical JavaScript freedom. So much freedom that developers can never let their guard down.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> globalVariable <span class=\"token operator\">=</span> <span class=\"token string\">'global!'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>globalVariable <span class=\"token operator\">===</span> <span class=\"token string\">'global!'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  globlVariable <span class=\"token operator\">=</span> <span class=\"token string\">'global?'</span> <span class=\"token comment\">// typo</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>globalVariable<span class=\"token punctuation\">)</span> <span class=\"token comment\">// global!</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>globlVariable<span class=\"token punctuation\">)</span> <span class=\"token comment\">// global?</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I accidentally typed <code class=\"language-text\">globalVariable</code> as <code class=\"language-text\">globlVariable</code>. A naive developer would expect <code class=\"language-text\">globalVariable</code> to have the value <code class=\"language-text\">global?</code>, but unfortunately that value went to the typo’d variable name <code class=\"language-text\">globlVariable</code> instead.</p>\n<p>Cases like this are easy to debug in simple code, but once the code gets even slightly complex, you’ll be in tears.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1909feea74565c3861f0bd9dfb9951c1/72747/off-work.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdzrM1Fw/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAERIDIv/aAAgBAQABBQLIohVbJELeuts1T//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB8QAAIBAgcAAAAAAAAAAAAAAAABEQIQEiExQVFhkf/aAAgBAQAGPwLQxVboyUi4gdPUe2//xAAdEAEAAgICAwAAAAAAAAAAAAABABExQSFRYXHR/9oACAEBAAE/IQ/JiOEaoA13BLwFu1jg7UfsQXAfe0CAdE//2gAMAwEAAgADAAAAEMMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRABAQABBQEBAAAAAAAAAAAAAREAITFBYYFxkf/aAAgBAQABPxBTRdyZAkF0gNT6mAOkhN2OnLiVRPLp+sRoKpeEV+B7m82BXoz/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"off work\" title=\"\" src=\"/static/1909feea74565c3861f0bd9dfb9951c1/c08c5/off-work.jpg\" srcset=\"/static/1909feea74565c3861f0bd9dfb9951c1/0913d/off-work.jpg 160w,\n/static/1909feea74565c3861f0bd9dfb9951c1/cb69c/off-work.jpg 320w,\n/static/1909feea74565c3861f0bd9dfb9951c1/c08c5/off-work.jpg 640w,\n/static/1909feea74565c3861f0bd9dfb9951c1/72747/off-work.jpg 764w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Get caught by one of these, and you'll be working until 11pm and taking a taxi home</small>\n</center>\n<h2 id=\"enter-let-and-const\" style=\"position:relative;\">Enter let and const<a href=\"#enter-let-and-const\" aria-label=\"enter let and const permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The <code class=\"language-text\">var</code> keyword makes it easy to create global variables, and even local variables have such wide scope that tracking down where a variable was declared or how its value unexpectedly changed can be difficult.</p>\n<p>That’s why JavaScript ES6, released in 2015, introduced new variable declaration keywords: <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>.</p>\n<p>The <code class=\"language-text\">let</code> keyword is used to declare variables, just like <code class=\"language-text\">var</code>. The <code class=\"language-text\">const</code> keyword is used to declare constants — meaning you can’t reassign the literal value.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> callEvan <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Evan!'</span><span class=\"token punctuation\">;</span>\ncallEvan <span class=\"token operator\">=</span> <span class=\"token string\">'Bye, Evan!'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught TypeError: Assignment to constant variable.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>So how are these different from the old <code class=\"language-text\">var</code> keyword? The characteristics of <code class=\"language-text\">var</code> I described above were:</p>\n<hr>\n<ul>\n<li>Variables can be re-declared.</li>\n<li>It gets hoisted.</li>\n<li>It uses function-level scope, not block-level scope.</li>\n<li>The var keyword can be omitted.</li>\n</ul>\n<hr>\n<p>These four points. Now let’s look at how <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> contrast with them.</p>\n<h2 id=\"characteristics-of-let-and-const\" style=\"position:relative;\">Characteristics of let and const<a href=\"#characteristics-of-let-and-const\" aria-label=\"characteristics of let and const permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Let’s first examine the points that contrast with the <code class=\"language-text\">var</code> keyword characteristics described above.</p>\n<h3 id=\"variables-cannot-be-re-declared\" style=\"position:relative;\">Variables cannot be re-declared<a href=\"#variables-cannot-be-re-declared\" aria-label=\"variables cannot be re declared permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Unlike <code class=\"language-text\">var</code>, once you declare a variable with these keywords, you can’t re-declare it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan2'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// nothing happens...</span>\n\n<span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan2'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught SyntaxError: Identifier 'name' has already been declared</span>\n\n<span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan2'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught SyntaxError: Identifier 'name' has already been declared</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This prevents scenarios where you accidentally declare a variable twice, change its value unintentionally, and end up working overtime.</p>\n<h3 id=\"hoisted\" style=\"position:relative;\">Hoisted?<a href=\"#hoisted\" aria-label=\"hoisted permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>This is exactly why I wrote this post. I thought <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> weren’t hoisted.</p>\n<p>But as I explained above, hoisting is something that happens during the JavaScript interpreter’s code parsing phase — there’s no way <code class=\"language-text\">let</code> or <code class=\"language-text\">const</code> can escape it. So how did they solve this problem?</p>\n<h4 id=\"different-errors-depending-on-the-declaration-keyword\" style=\"position:relative;\">Different errors depending on the declaration keyword<a href=\"#different-errors-depending-on-the-declaration-keyword\" aria-label=\"different errors depending on the declaration keyword permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>aaa<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Uncaught ReferenceError: aaa is not defined</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught ReferenceError: Cannot access 'name' before initialization</span>\n<span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The first example shows accessing a variable declared with <code class=\"language-text\">var</code> that got hoisted. Naturally, no reference error — it just cleanly outputs <code class=\"language-text\">undefined</code>.</p>\n<p>The second example shows accessing a variable that was never declared at all. We get <code class=\"language-text\">Uncaught ReferenceError</code> with the message <code class=\"language-text\">aaa is not defined</code>.</p>\n<p>The third example shows accessing a variable declared with <code class=\"language-text\">let</code> before its declaration. We also get <code class=\"language-text\">Uncaught ReferenceError</code>, but the message is different: <code class=\"language-text\">Cannot access 'name' before initialization</code>.</p>\n<h4 id=\"lets-dig-into-the-v8-engine\" style=\"position:relative;\">Let’s dig into the V8 engine<a href=\"#lets-dig-into-the-v8-engine\" aria-label=\"lets dig into the v8 engine permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>These two errors are completely different, and in the V8 engine’s internal <code class=\"language-text\">MESSAGE_TEMPLATE</code>, they’re explicitly distinguished and called in different cases.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token function\">T</span><span class=\"token punctuation\">(</span>NotDefined<span class=\"token punctuation\">,</span> <span class=\"token string\">\"% is not defined\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">T</span><span class=\"token punctuation\">(</span>AccessedUninitializedVariable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cannot access '%' before initialization\"</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>After cloning <a href=\"https://github.com/v8/v8\" target=\"_blank\" rel=\"nofollow\">V8’s GitHub repository</a> and examining it, I found numerous places where the code branches based on whether a JS object was declared with <code class=\"language-text\">var</code> versus <code class=\"language-text\">let</code> or <code class=\"language-text\">const</code>. As I continued analyzing the code, I confirmed that hoisting always occurs regardless of which keyword you use to declare a value. The V8 engine’s internal hoisting flag <code class=\"language-text\">should_hoist</code> is always set to <code class=\"language-text\">true</code> when assigning to a JavaScript object, without any distinction based on the variable declaration keyword.</p>\n<p>So where does the difference between <code class=\"language-text\">var</code> and <code class=\"language-text\">let</code>/<code class=\"language-text\">const</code> come from? While they’re all treated identically when declaring variables — that is, when V8 creates variable objects — they’re handled differently during the initialization phase, when memory space is allocated for the variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token keyword\">static</span> InitializationFlag <span class=\"token function\">DefaultInitializationFlag</span><span class=\"token punctuation\">(</span>VariableMode mode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">DCHECK</span><span class=\"token punctuation\">(</span><span class=\"token function\">IsDeclaredVariableMode</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> mode <span class=\"token operator\">==</span> VariableMode<span class=\"token double-colon punctuation\">::</span>kVar <span class=\"token operator\">?</span> kCreatedInitialized\n                                    <span class=\"token operator\">:</span> kNeedsInitialization<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Looking at the subsequent logic, there’s a function called <code class=\"language-text\">DefaultInitializationFlag</code> that returns a <code class=\"language-text\">VariableKind</code> type used internally by V8. Variables declared with <code class=\"language-text\">var</code> get <code class=\"language-text\">kCreatedInitialized</code>, while variables declared with <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> get <code class=\"language-text\">kNeedsInitialization</code>.</p>\n<blockquote>\n<p>In other words, literal values declared with <code class=\"language-text\">let</code> or <code class=\"language-text\">const</code> are hoisted, but they’re managed in a “needs initialization” state for a special reason.</p>\n</blockquote>\n<h4 id=\"what-does-needs-initialization-mean\" style=\"position:relative;\">What does “needs initialization” mean?<a href=\"#what-does-needs-initialization-mean\" aria-label=\"what does needs initialization mean permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Inside the JavaScript interpreter, variables are created in three stages:</p>\n<hr>\n<ul>\n<li><code class=\"language-text\">Declaration</code>: A scope and variable object are created, and the scope references the variable object.</li>\n<li><code class=\"language-text\">Initialization</code>: Memory space is allocated for the value the variable object will hold. At this point, it’s initialized to <code class=\"language-text\">undefined</code>.</li>\n<li><code class=\"language-text\">Assignment</code>: A value is assigned to the variable object.</li>\n</ul>\n<hr>\n<p>For objects declared with <code class=\"language-text\">var</code>, declaration and initialization happen simultaneously. The moment it’s declared, it’s initialized to <code class=\"language-text\">undefined</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token comment\">// When declaring a variable in Var mode</span>\n<span class=\"token keyword\">auto</span> var <span class=\"token operator\">=</span> scope<span class=\"token operator\">-></span><span class=\"token function\">DeclareParameter</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> VariableMode<span class=\"token double-colon punctuation\">::</span>kVar<span class=\"token punctuation\">,</span> is_optional<span class=\"token punctuation\">,</span>\n                                         is_rest<span class=\"token punctuation\">,</span> <span class=\"token function\">ast_value_factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> beg_pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nvar<span class=\"token operator\">-></span><span class=\"token function\">AllocateTo</span><span class=\"token punctuation\">(</span>VariableLocation<span class=\"token double-colon punctuation\">::</span>PARAMETER<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Looking at V8’s code, after creating a variable object in <code class=\"language-text\">kVar</code> mode, the <code class=\"language-text\">AllocateTo</code> method is immediately called to allocate memory space. But variable objects created with <code class=\"language-text\">let</code> or <code class=\"language-text\">const</code> are different.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token comment\">// When declaring a variable in kLet mode</span>\nVariableProxy<span class=\"token operator\">*</span> proxy <span class=\"token operator\">=</span>\n      <span class=\"token function\">DeclareBoundVariable</span><span class=\"token punctuation\">(</span>variable_name<span class=\"token punctuation\">,</span> VariableMode<span class=\"token double-colon punctuation\">::</span>kLet<span class=\"token punctuation\">,</span> class_token_pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nproxy<span class=\"token operator\">-></span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">set_initializer_position</span><span class=\"token punctuation\">(</span>end_pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// When declaring a variable in Const mode</span>\nVariableProxy<span class=\"token operator\">*</span> proxy <span class=\"token operator\">=</span>\n          <span class=\"token function\">DeclareBoundVariable</span><span class=\"token punctuation\">(</span>local_name<span class=\"token punctuation\">,</span> VariableMode<span class=\"token double-colon punctuation\">::</span>kConst<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nproxy<span class=\"token operator\">-></span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">set_initializer_position</span><span class=\"token punctuation\">(</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Variable objects created in <code class=\"language-text\">kLet</code> or <code class=\"language-text\">kConst</code> mode don’t have <code class=\"language-text\">AllocateTo</code> called immediately. Instead, you can see they only set a <code class=\"language-text\">position</code> value indicating where the code is in the source file.</p>\n<p>This is exactly the moment when variables created with <code class=\"language-text\">let</code> or <code class=\"language-text\">const</code> enter the <code class=\"language-text\">TDZ (Temporal Dead Zone)</code>. In other words, a variable in the TDZ is “declared but not yet initialized — memory hasn’t been allocated for the value it will hold.”</p>\n<p>If you try to access such a variable, you’ll inevitably encounter the <code class=\"language-text\">Cannot access '%' before initialization</code> error message.</p>\n<h3 id=\"block-level-scope\" style=\"position:relative;\">Block-level scope<a href=\"#block-level-scope\" aria-label=\"block level scope permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Unlike <code class=\"language-text\">var</code> which uses function-level scope, <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> use block-level scope. Because <code class=\"language-text\">var</code> doesn’t use block-level scope, variables declared inside a block are treated as global variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> globalVariable <span class=\"token operator\">=</span> <span class=\"token string\">'I am global'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>globalVariable <span class=\"token operator\">===</span> <span class=\"token string\">'I am global'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> globalVariable <span class=\"token operator\">=</span> <span class=\"token string\">'am I local?'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>globalVariable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// am I local?</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>But with <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>, variables declared inside a block are treated as local variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> globalVariable <span class=\"token operator\">=</span> <span class=\"token string\">'I am global'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>globalVariable <span class=\"token operator\">===</span> <span class=\"token string\">'I am global'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> globalVariable <span class=\"token operator\">=</span> <span class=\"token string\">'am I local?'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> localVariable <span class=\"token operator\">=</span> <span class=\"token string\">'I am local'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>globalVariable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// I am global</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>localVariable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught ReferenceError: localVariable is not defined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In this case, <code class=\"language-text\">localVariable</code> declared inside the block is treated as a local variable and can’t be referenced from the global scope. Note that <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code> also get hoisted at the block level.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Global Evan'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'Global Evan'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught ReferenceError: Cannot access 'name' before initialization</span>\n  <span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Local Evan'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You might expect the <code class=\"language-text\">if</code> block to output <code class=\"language-text\">Global Evan</code> — the value of the globally declared <code class=\"language-text\">name</code> variable. But hoisting also occurs inside the <code class=\"language-text\">if</code> block, pulling the local <code class=\"language-text\">name</code> declaration to the top of the block, which causes the reference error.</p>\n<h3 id=\"let-and-const-keywords-cannot-be-omitted\" style=\"position:relative;\">let and const keywords cannot be omitted<a href=\"#let-and-const-keywords-cannot-be-omitted\" aria-label=\"let and const keywords cannot be omitted permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span>\n<span class=\"token comment\">// The above code is equivalent to</span>\n<span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Evan'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>If you don’t use a variable declaration keyword, it’s treated as if you used <code class=\"language-text\">var</code>, so you must always include the keyword.</p>\n<h2 id=\"characteristics-specific-to-const\" style=\"position:relative;\">Characteristics specific to const<a href=\"#characteristics-specific-to-const\" aria-label=\"characteristics specific to const permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Aside from the reasons explained above, the <code class=\"language-text\">let</code> keyword essentially serves the same role as <code class=\"language-text\">var</code> in that it’s used to declare variables. Now let’s look more closely at <code class=\"language-text\">const</code>, which has a different role from the traditional <code class=\"language-text\">var</code> keyword.</p>\n<h3 id=\"used-to-declare-constants\" style=\"position:relative;\">Used to declare constants<a href=\"#used-to-declare-constants\" aria-label=\"used to declare constants permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As mentioned above, <code class=\"language-text\">const</code> is a keyword for declaring constants. A constant represents an immutable value. In other words, once you declare a value with <code class=\"language-text\">const</code>, you can never change it again.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> maxCount <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\nmaxCount <span class=\"token operator\">=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught TypeError: Assignment to constant variable.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>If you try to reassign a value declared with <code class=\"language-text\">const</code>, you’ll get a friendly error message telling you it’s not allowed.</p>\n<p>But there’s an important point here. What happens when you declare a type that uses call by reference with <code class=\"language-text\">const</code>?</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'John'</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// Uncaught TypeError: Assignment to constant variable.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>In this case, we get an error because we’re trying to change the reference that <code class=\"language-text\">obj</code> points to. However, the properties inside the object aren’t affected by the <code class=\"language-text\">const</code> keyword.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evan'</span> <span class=\"token punctuation\">}</span>\nobj<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'John'</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// { name: 'John' }</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>This applies equally to <code class=\"language-text\">Array</code>, another type that uses call by reference. Even if you declared it with <code class=\"language-text\">const</code>, there’s no restriction on using <code class=\"language-text\">push</code> or <code class=\"language-text\">splice</code> to modify the elements inside the array.</p>\n<h3 id=\"must-be-initialized-at-declaration\" style=\"position:relative;\">Must be initialized at declaration<a href=\"#must-be-initialized-at-declaration\" aria-label=\"must be initialized at declaration permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>With <code class=\"language-text\">let</code>, even if you only explicitly declare a variable, the interpreter implicitly initializes it to <code class=\"language-text\">undefined</code> when it processes that line.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> hi<span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>hi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>But when using <code class=\"language-text\">const</code>, you must assign a value at the time of declaration.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> hi<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Uncaught SyntaxError: Missing initializer in const declaration</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Unless you’re in the unfortunate situation of having to write JavaScript ES5 code, I recommend never using the <code class=\"language-text\">var</code> keyword anymore.</p>\n<p>That leaves <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>, which raises the question: “how should I use these two?”</p>\n<p>Having used only <code class=\"language-text\">var</code> for so long, I hadn’t really thought about this, but there are actually not that many cases where you absolutely need to reassign a variable. I was coding one day and looked back at my code — most variables were declared with <code class=\"language-text\">const</code>, and <code class=\"language-text\">let</code> was only used in a few places.</p>\n<p>If you do need to use <code class=\"language-text\">let</code>, I recommend never using it in the global scope — keep block scopes small and use it within those.</p>\n<p>As for <code class=\"language-text\">const</code>, it immediately throws an error if you try to reassign, which prevents the sad situation of accidentally changing a variable’s value. So make good use of <code class=\"language-text\">const</code> for safe coding, and may you all leave work on time instead of staying late.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 313px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a64125e9e9cda049bccec09014083a9e/aa65c/off-work2.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 79.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAQT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGxwUFNED//xAAZEAADAQEBAAAAAAAAAAAAAAAAAhEBFCL/2gAIAQEAAQUCOVGRMiF9XT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAABIQAQEVH/2gAIAQEABj8CIBcCw9g1qsr/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFRcf/aAAgBAQABPyF8BmQJoE0O/ZSVYAvsy26zuBduS4g4z//aAAwDAQACAAMAAAAQUw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEBAAMBAAMAAAAAAAAAAAABEQAhMVFhofH/2gAIAQEAAT8QbKCtGheYh51Snb9sSnYJ0HcEtB0rzzNuAg+Qd/mLBAvCMz//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"off work2\" title=\"\" src=\"/static/a64125e9e9cda049bccec09014083a9e/aa65c/off-work2.jpg\" srcset=\"/static/a64125e9e9cda049bccec09014083a9e/0913d/off-work2.jpg 160w,\n/static/a64125e9e9cda049bccec09014083a9e/aa65c/off-work2.jpg 313w\" sizes=\"(max-width: 313px) 100vw, 313px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Time to go home, eat dinner, and watch Netflix!</small>\n</center>\n<p>That wraps up this post on JavaScript’s let, const, and the TDZ.</p>","fields":{"slug":"20190618-javascript-let-const-en","path":"/2019/06/18/javascript-let-const/en/","lang":"en"},"frontmatter":{"title":"JavaScript's let, const, and the TDZ","subTitle":"Digging into the V8 engine to understand how JavaScript variables really work","date":"Jun 18, 2019","categories":["Programming","JavaScript"],"tags":["JavaScript","Temporal Dead Zone","TDZ","Hoisting","V8","Technical Interview","JavaScript Fundamentals"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/d803c/js.001.png","srcSet":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/d803c/js.001.png 320w,\n/static/2cc989808d5cc4f4cafd05e0c479f2cc/6131a/js.001.png 734w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/fc5c5/js.001.webp 320w,\n/static/2cc989808d5cc4f4cafd05e0c479f2cc/d6c14/js.001.webp 734w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/17e8c/js.001.png","srcSet":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/17e8c/js.001.png 734w","sizes":"100vw"},"sources":[{"srcSet":"/static/2cc989808d5cc4f4cafd05e0c479f2cc/88dbe/js.001.webp 734w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"JavaScript Fundamentals","lang":"en"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}