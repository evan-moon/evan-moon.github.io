{"componentChunkName":"component---src-templates-post-tsx","path":"/2019/06/28/v8-analysis/","result":{"data":{"markdownRemark":{"id":"46469e53-3a7d-5c28-b3e2-496439b06d6f","excerpt":"이번 포스팅에서는 구글의 V8 엔진이 어떤 방식으로 자바스크립트를 해석하고 실행하는지 살펴 보는지에 대해 포스팅하려고 한다. 은 로 작성되었지만 필자의 메인 언어가 이 아니기도 하고, 워낙 소스가 방대하기 때문에 자세한 분석까지는 아니라도 최대한 웹 상에 있는 정보들과 필자가 분석한 의 소스코드를 비교해가면서 살펴보려고 한다.","html":"<p>이번 포스팅에서는 구글의 <strong>V8</strong> 엔진이 어떤 방식으로 자바스크립트를 해석하고 실행하는지 살펴 보는지에 대해 포스팅하려고 한다. <code class=\"language-text\">V8</code>은 <code class=\"language-text\">C++</code>로 작성되었지만 필자의 메인 언어가 <code class=\"language-text\">C++</code>이 아니기도 하고, 워낙 소스가 방대하기 때문에 자세한 분석까지는 아니라도 최대한 웹 상에 있는 정보들과 필자가 분석한 <code class=\"language-text\">V8</code>의 소스코드를 비교해가면서 살펴보려고 한다.</p>\n<!-- more -->\n<h2 id=\"v8-엔진이란\" style=\"position:relative;\">V8 엔진이란?<a href=\"#v8-%EC%97%94%EC%A7%84%EC%9D%B4%EB%9E%80\" aria-label=\"v8 엔진이란 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><code class=\"language-text\">V8</code> 엔진은 구글이 주도하여 <code class=\"language-text\">C++</code>로 작성된 고성능의 자바스크립트 &#x26; 웹 어셈블리 엔진이다. 또한 <code class=\"language-text\">V8</code>은 오픈 소스이기 때문에 <a href=\"https://github.com/v8/v8\" target=\"_blank\" rel=\"nofollow\">V8 엔진 깃허브 레파지토리</a>에서 클론받을 수 있다. 현재 <code class=\"language-text\">Google Chrome</code>과 <code class=\"language-text\">NodeJS</code>에서 사용되고 있으며 <code class=\"language-text\">ECMAScript</code>와 <code class=\"language-text\">Web Assembly</code>를 표준에 맞게 구현하였다.</p>\n<p><a href=\"https://kangax.github.io/compat-table/es2016plus/\" target=\"_blank\" rel=\"nofollow\">Kangax Table</a>에서 확인해보면, <code class=\"language-text\">V8</code>을 사용하고 있는 <code class=\"language-text\">CH(Google Chrome)</code>과 <code class=\"language-text\">Node</code>는 거의 대부분의 ES2016+(ES7+)의 기능을 구현해놓은 반면 MicroSoft의 <code class=\"language-text\">Chakra</code>나 Mozila의 <code class=\"language-text\">SpiderMonkey</code>의 경우 붉은 색으로 표시된 부분이 꽤 존재한다는 것을 볼 수 있다.</p>\n<blockquote>\n<p>다른 플랫폼과의 호환과 서로 간의 리스크를 줄이기 위해, 마이크로소프트 Edge는 이제 이 변경 사항의 일부분으로 인해 V8 엔진을 사용할 것 입니다. 우리가 배워야할 것들은 아직 많지만 그래도 우리는 V8 커뮤니티의 일원이 된 것과 이 프로젝트에 기여하게 된 것이 매우 기대됩니다.</p>\n<p><strong>ChakraCore team</strong> <em><a href=\"https://github.com/Microsoft/ChakraCore/issues/5865\" target=\"_blank\" rel=\"nofollow\">ChakraCore Github Issue</a></em> </p>\n</blockquote>\n<p>하지만 <code class=\"language-text\">Chakra</code> 엔진을 사용하던 <code class=\"language-text\">Microsoft Edge</code>의 경우, 이제 Chromium 오픈소스 프로젝트에 동참하면서 <code class=\"language-text\">V8</code>을 사용할 예정이라고 한다. 음… 좋은 건지 나쁜 건지 아직은 잘 모르겠다.</p>\n<p>만약 <code class=\"language-text\">V8</code>을 빌드해서 실제로 디버깅까지 해보고 싶다면 단순히 <code class=\"language-text\">git</code>을 사용하여 클론 받는 것으로는 빌드를 할 수 없다. 빌드까지 해보고 싶은 분은 <code class=\"language-text\">V8</code> 공식 홈페이지의 <a href=\"https://v8.dev/docs/source-code\" target=\"_blank\" rel=\"nofollow\">Checking out the V8 source code</a>를 읽어보자.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAWqmWguiFBl//8QAHBAAAgICAwAAAAAAAAAAAAAAAQIEEQADEyEx/9oACAEBAAEFArwMA99SyV1+pGZuP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/AQn/xAAcEAACAQUBAAAAAAAAAAAAAAAAATECEBESQVH/2gAIAQEABj8CN26psmvTLknp/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARIUFR8f/aAAgBAQABPyGhlQ7A2wOIBCbjA0tGPe9QTDAj/9oADAMBAAIAAwAAABBz/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxBJ/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/ENFj/8QAHBABAAMBAQADAAAAAAAAAAAAAQARIUFhMbHR/9oACAEBAAE/EADQN8RUTsrY3z5hJFATOR1N+HSn8m/EQF919R0tgB2sJ//Z&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"meme1\" title=\"meme1\" src=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg\" srcset=\"/static/0df8b088fb8103f7f024eb0c7acb8d7c/0913d/meme1.jpg 160w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/cb69c/meme1.jpg 320w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c08c5/meme1.jpg 640w,\n/static/0df8b088fb8103f7f024eb0c7acb8d7c/c84e8/meme1.jpg 743w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <small>Chromium&#xC774; &#xC6CC;&#xB099; &#xB300;&#xD615; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB2E4;&#xBCF4;&#xB2C8; &#xBE4C;&#xB4DC; &#xD55C;&#xBC88; &#xD558;&#xB824;&#xBA74; &#xC124;&#xCE58; &#xACFC;&#xC815;&#xBD80;&#xD130; &#xAE4C;&#xB2E4;&#xB86D;&#xB2E4;</small>\n</center>\n<p>필자는 예전에 한번 셋업해본 적이 있는데, 당연하게도 순순히 잘 설치되어주지는 않으니 시간 많은 주말에 시도하는 것을 추천한다. 이번에는 단순히 소스 코드만 분석할 예정이므로 필자는 <code class=\"language-text\">git</code>을 이용하여 직접 클론받았다.</p>\n<h2 id=\"v8-엔진의-작동원리를-살펴보자\" style=\"position:relative;\">V8 엔진의 작동원리를 살펴보자.<a href=\"#v8-%EC%97%94%EC%A7%84%EC%9D%98-%EC%9E%91%EB%8F%99%EC%9B%90%EB%A6%AC%EB%A5%BC-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\" aria-label=\"v8 엔진의 작동원리를 살펴보자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>일반적으로 우리가 자바스크립트를 사용할 때 엔진의 작동 원리와 같은 로우 레벨(Low Level)의 내용까지 깊게 신경쓸 필요는 없다. 사실 개발자들이 그런 것까지 일일히 신경쓰지 말라고 엔진을 사용하는 것이기 때문이다. 그러나 정말 자바스크립트로 뽑아낼 수 있는 최적의 성능을 사용하고 싶다면 내 코드가 어떤 식으로 실행되는 지에 대한 이해는 어느 정도 있어야한다.</p>\n<p>그럼 먼저 간단한 그림으로 <code class=\"language-text\">V8</code>이 우리의 자바스크립트 소스 코드를 어떻게 해석하고 실행하는 지 살펴보자. 자세한 설명은 밑에서 다시 할 예정이므로 그냥 한번 흝고 넘어간다는 느낌으로 보면 된다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAAB3UlEQVQoz3VTS47UMBTsu3EILsIetkjcAVZcACQkVrNAs5gFGgmxGDbp6U4yacdJHH/jT9yUne6eSQuerCjxe2VX1XvZHP8VMaantc5M02StMZMxBjvzPCMVY8QLPjfH/8fIBaXddvtYVRUbx2UzzGkt8QwOISilcQ/u4lzs9/unpqGUHnL0w4Ca79++vPm0e/vx/u72ZgVWWnvvCSFSSpQiQE9ps9DWOtH+ef/r1bvi9fvfdVmswCiSSnEhBNBK1XXdNI21ljGGLSHVMRvx4Wv/+YfI+uPmpUnJj+wKPp1zXdeD9p+Hh6oqceZSBllIXWs+uxyX167rWkoXIulmIXM+V8S1YVmets6BvFKqKquhG16cGdGq5KW12ph4Rp/A3gdoK4oCJsMq0pPBDTWEq5pOLTMjGoGGIQsizvsVGH0CsQMh8Bl2SS+545lkZI4RiRZo0rboBYT4K3BM3Z/HkcPhGOOF2IU2JqttW9p1eciuaXuIGQVHGuoWwy/hQ4AdjI1YmFnQXIGxBZ+QTT3WOmCezv2AJCcEnH/cbne7He6HQSfw6R9wDiMJq2Ablyr0/bGuT6t58lw0BxhCMOpNc3jWrJRltA1hRutxJBI4KF7/ZDGlQspCMtiVZRqbv+JcX+R/5O5UAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"v8compiler pipeline\" title=\"v8compiler pipeline\" src=\"/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png\" srcset=\"/static/27979b3d2674a00f5b68af5f303fb27c/69538/v8compiler-pipeline.png 160w,\n/static/27979b3d2674a00f5b68af5f303fb27c/72799/v8compiler-pipeline.png 320w,\n/static/27979b3d2674a00f5b68af5f303fb27c/6af66/v8compiler-pipeline.png 640w,\n/static/27979b3d2674a00f5b68af5f303fb27c/d9199/v8compiler-pipeline.png 960w,\n/static/27979b3d2674a00f5b68af5f303fb27c/159fb/v8compiler-pipeline.png 1019w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <small>JSConf EU 2017&#xC5D0;&#xC11C; &#xBC1C;&#xD45C;&#xD55C; Franziska Hinkelmann&#xB2D8;&#xC758; &#xC790;&#xB8CC;</small>\n</center>\n<p><code class=\"language-text\">V8</code>은 우리의 소스 코드를 가져와서 가장 먼저 <code class=\"language-text\">파서(Parser)</code>에게 넘긴다. 이 친구는 소스 코드를 분석한 후 <code class=\"language-text\">AST(Abstract Syntax Tree), 추상 구문 트리</code>로 변환하게 된다.\n그 다음에 이 <code class=\"language-text\">AST</code>를 그림에 나와있는 <code class=\"language-text\">Ignition</code>에게 넘기는데 이 친구는 자바스크립트를 <code class=\"language-text\">바이트 코드(Bytecode)</code>로 변환하는 인터프리터이다. 원본 소스 코드보다 컴퓨터가 해석하기 쉬운 바이트 코드로 변환함으로써 원본 코드를 다시 <code class=\"language-text\">파싱(Parsing)</code>해야하는 수고를 덜고 코드의 양도 줄이면서 코드 실행 때 차지하는 메모리 공간을 아끼려는 것이다.</p>\n<p>이후 이 바이트 코드를 실행함으로써 우리의 소스 코드가 실제로 작동하게 되고, 그 중 자주 사용되는 코드는 <code class=\"language-text\">TurboFan</code>으로 보내져서 <code class=\"language-text\">Optimized Machine Code</code>, 즉 최적화된 코드로 다시 컴파일된다. 그러다가 다시 사용이 덜 된다 싶으면 <code class=\"language-text\">Deoptimizing</code> 하기도 한다.</p>\n<p>여기서 사용되는 용어들이 굉장히 재미있는데, <code class=\"language-text\">V8</code>은 원래 8기통 엔진의 종류를 의미하는 단어다. 제네시스 G90이나 기아 K9같은 차에 들어간다고 한다.\n그럼 <code class=\"language-text\">Ignition</code>은 뭐냐. 엔진에 시동걸 때 사용하는 <code class=\"language-text\">점화기</code>이다. 내 소스 코드가 부릉부릉 실행되는 것이다. 그러다가 너무 많이 호출되서 내 코드가 뜨거워지면 <code class=\"language-text\">TurboFan</code>으로 최적화해서 너무 과열되지 않게 식혀주는 그런 느낌적인 느낌…? 분명히 다 노리고 네이밍한거다.</p>\n<p><code class=\"language-text\">V8</code> 분석 포스팅에서 컴파일 파이프라인을 설명할 때 빠지지 않던 <code class=\"language-text\">Full-codegen</code>과 <code class=\"language-text\">Crankshaft</code>는 어디로 갔냐 하면…</p>\n<blockquote>\n<p>V8 v5.9부터 처음으로 Ignition과 TurboFan은 자바스크립트 실행을 위해 전체적으로 사용됩니다. 또한 V8의 v5.9부터 V8을 잘 지탱해준 기술이었던 Full-codegen과 Crankshaft는 새로운 자바스크립트의 기능과 이러한 기능들이 요구하는 최적화 기능을 더 이상 따라갈 수 없기 때문에 V8에서 더 이상 사용되지 않습니다. 우리는 이것들을 곧 완전히 제거할 계획이며, 이는 V8이 앞으로 훨씬 더 단순하고 유지 보수 가능한 아키텍처를 갖게 된다는 것을 의미합니다.</p>\n<p><strong>V8 team</strong> <em><a href=\"https://v8.dev/blog/launching-ignition-and-turbofan\" target=\"_blank\" rel=\"nofollow\">Launching Ignition and TurboFan</a></em></p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 509px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAG1GktoSwT/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQMSIRH/2gAIAQEAAQUCcXShUeI0/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/Abqv/8QAFxAAAwEAAAAAAAAAAAAAAAAAABAxIf/aAAgBAQAGPwLFSv8A/8QAHRAAAgIBBQAAAAAAAAAAAAAAAREAUSExQaHR4f/aAAgBAQABPyEHZGo4qN7EHRR7whs3FTmf/9oADAMBAAIAAwAAABDgP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCYj//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ECX/xAAcEAEAAwADAQEAAAAAAAAAAAABABEhMUFxYYH/2gAIAQEAAT8QQbmdCNbW5HtfkpzFekdREizzztfkR2Aq6OpXlH7if//Z&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bye\" title=\"bye\" src=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg\" srcset=\"/static/843ec14e0e37c1082ef853b3b1bb2f81/0913d/bye.jpg 160w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/cb69c/bye.jpg 320w,\n/static/843ec14e0e37c1082ef853b3b1bb2f81/05852/bye.jpg 509w\" sizes=\"(max-width: 509px) 100vw, 509px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <small>&#xB124;. V8&#xC758; v5.9&#xBD80;&#xD130; &#xC138;&#xB300; &#xAD50;&#xCCB4; &#xB2F9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</small>\n</center>\n<p><code class=\"language-text\">v5.9</code> 이전까지는 <code class=\"language-text\">Full-codegen</code>과 <code class=\"language-text\">Crankshaft</code>도 공존하고 있었지만 이건 <code class=\"language-text\">V8</code> 팀이 원했던 것이 아니라 초창기의 <code class=\"language-text\">Ignition</code>과 <code class=\"language-text\">TurboFan</code>의 성능이 생각만큼 잘 나와주지 않았던 것도 있고 <code class=\"language-text\">Optimizing</code>된 코드를 다시 <code class=\"language-text\">Deoptimizing</code>할 때 바이트 코드로 바로 변환할 수 없던 이슈들이 있어서 어쩔 수 없이 중간에 <code class=\"language-text\">Full-codegen</code>과 <code class=\"language-text\">Crankshaft</code>를 살려둔 것이다.</p>\n<p><code class=\"language-text\">V8</code> 팀의 원래 목적은 처음부터 <code class=\"language-text\">Ignition</code>과 <code class=\"language-text\">TurboFan</code>만 사용하여 <code class=\"language-text\">바이트 코드 &lt;-&gt; 최적화된 코드</code> 사이를 왔다갔다 하는 것이었다.</p>\n<p><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <div class=\"embedVideo-container\"> <iframe src=\"https://www.youtube.com/embed/r5OWCtuKiAk?rel=0\" class=\"embedVideo-iframe\" style=\"border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" allowfullscreen></iframe> </div> </div>\n<br></p>\n<p>이 영상은 BlinkOn 2016에서 <code class=\"language-text\">Chrome Mobile Performance London Team</code>팀의 <strong>Ross McIlroy</strong>이 <code class=\"language-text\">Ignition</code>을 소개하는 영상인데, <code class=\"language-text\">9:47 ~ 11:14</code> 구간에서 레거시 코드인 <code class=\"language-text\">Full-codegen</code>과 <code class=\"language-text\">Crankshaft</code>를 삭제하지 못한 슬픈 사정을 설명해준다. 본인도 말하면서 웃긴듯.</p>\n<p>그럼 이제 <code class=\"language-text\">V8</code>이 자바스크립트를 어떤 식으로 파싱하고 실행시키는 지 간략하게 한번 알아보자.</p>\n<h3 id=\"parsing-코드의-의미-파악하기\" style=\"position:relative;\">Parsing, 코드의 의미 파악하기<a href=\"#parsing-%EC%BD%94%EB%93%9C%EC%9D%98-%EC%9D%98%EB%AF%B8-%ED%8C%8C%EC%95%85%ED%95%98%EA%B8%B0\" aria-label=\"parsing 코드의 의미 파악하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">파싱(Parsing)</code>이란, 소스코드를 불러온 후 <code class=\"language-text\">AST(Abstract Syntax Tree), 추상 구문 트리</code>로 변환하는 과정이다.\n<code class=\"language-text\">AST</code>는 컴파일러에서 널리 사용되는 자료 구조인데, 우리가 일반적으로 작성한 소스 코드를 컴퓨터가 알아먹기 쉽게 <code class=\"language-text\">구조화</code>한다고 생각하면 된다.</p>\n<p>예를 들어, 자바스크립트로 자바스크립트를 파싱한다고 하면 이런 느낌이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 위 코드는 대략 이렇게 구조화 할 수 있다.</span>\n\n<span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">'FunctionDeclaration'</span><span class=\"token punctuation\">,</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'hello'</span>\n  arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'Variable'</span><span class=\"token punctuation\">,</span>\n      name<span class=\"token operator\">:</span> <span class=\"token string\">'name'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 놓고 보니 생각보다 심플하다. 다만 이것은 예시 중 하나일 뿐이고 컴파일러는 <code class=\"language-text\">for</code>, <code class=\"language-text\">if</code>, <code class=\"language-text\">a = 1 + 2</code>, <code class=\"language-text\">function () {}</code>과 같은 문법도 모두 해석하여 파싱해야 하다보니 <code class=\"language-text\">파서(Parser)</code>의 내부는 생각보다 거대하다. 당장 <code class=\"language-text\">V8</code>의 <code class=\"language-text\">parser.cc</code> 파일도 3000줄이 넘는다.</p>\n<p>어쨌든 파싱이라는 개념 자체는 컴퓨터가 분석하기 쉬운 형태인 <code class=\"language-text\">추상 구문 트리</code>로 변경하는 작업이라는 것만 기억하자. <code class=\"language-text\">V8</code> 엔진은 방금 예시에서 자바스크립트로 표현했던 것을 <code class=\"language-text\">C++</code>을 사용하여 그대로 할 뿐이다.</p>\n<p>그럼 <code class=\"language-text\">V8</code> 엔진의 파싱 코드 중 <code class=\"language-text\">1 + 2</code>와 같이 <code class=\"language-text\">리터럴로 선언된 수식</code>을 담당하는 메소드를 한번 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/parsing/parser.cc</span>\n<span class=\"token keyword\">bool</span> Parser<span class=\"token operator\">::</span><span class=\"token function\">ShortcutNumericLiteralBinaryExpression</span><span class=\"token punctuation\">(</span>Expression<span class=\"token operator\">*</span><span class=\"token operator\">*</span> x<span class=\"token punctuation\">,</span> Expression<span class=\"token operator\">*</span> y<span class=\"token punctuation\">,</span> Token<span class=\"token operator\">::</span>Value op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> y<span class=\"token operator\">-></span><span class=\"token function\">IsNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">double</span> x_val <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">double</span> y_val <span class=\"token operator\">=</span> y<span class=\"token operator\">-></span><span class=\"token function\">AsLiteral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AsNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>op<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token operator\">::</span>ADD<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">+</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> Token<span class=\"token operator\">::</span>SUB<span class=\"token operator\">:</span>\n        <span class=\"token operator\">*</span>x <span class=\"token operator\">=</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span>x_val <span class=\"token operator\">-</span> y_val<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 코드는 <code class=\"language-text\">V8</code> 엔진의 <code class=\"language-text\">parser.cc</code>에 선언된 <code class=\"language-text\">Parser</code> 클래스의 <code class=\"language-text\">ShortcutNumericLiteralBinaryExpression</code><small>(이름이 더럽게 길다…)</small> 스태틱 메소드이다.</p>\n<p>인자를 한번 살펴보면 <code class=\"language-text\">Expression</code> 클래스의 객체인 <code class=\"language-text\">x</code>와 <code class=\"language-text\">y</code>는 <code class=\"language-text\">표현식</code>에 사용된 값들 의미한다. <code class=\"language-text\">op</code>는 이 표현식이 의미하는 것이 <code class=\"language-text\">x + y</code>인지 <code class=\"language-text\">x - y</code>인지와 같은 실제 구문 내용과 그 타입을 의미하고 <code class=\"language-text\">pos</code>는 전체 소스 코드 중 현재 파싱하는 소스 코드의 위치를 의미한다.</p>\n<p>이 메소드는 위에서 설명했듯이 <code class=\"language-text\">1 + 2</code>와 같은 소스 코드를 만났을 경우 호출되며, 인자로 받은 표현을 <code class=\"language-text\">Token::ADD</code>나 <code class=\"language-text\">Token::SUB</code>와 같은 조건으로 검사하여 조건에 맞게 파싱하고 있는 모습을 볼 수 있다. 여기서 말하는 <code class=\"language-text\">토큰</code>은 소스 코드를 자바스크립트의 문법 규칙에 따라 어휘 분석하여 나온 문자열 조각들이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// 토큰은 대충 이런 느낌</span>\n<span class=\"token punctuation\">[</span><span class=\"token string\">'const'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>이후 알맞게 계산되어 나온 값을 <code class=\"language-text\">AstNodeFactory</code> 클래스의 <code class=\"language-text\">NewNumberLiteral</code> 스태틱 메소드를 사용하여 <code class=\"language-text\">추상 구문 트리</code>의 노드로 만드는 모습을 볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/ast/ast.cc</span>\nLiteral<span class=\"token operator\">*</span> AstNodeFactory<span class=\"token operator\">::</span><span class=\"token function\">NewNumberLiteral</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> number<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> int_value<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DoubleToSmiInteger</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>int_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">NewSmiLiteral</span><span class=\"token punctuation\">(</span>int_value<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>zone_<span class=\"token punctuation\">)</span> <span class=\"token function\">Literal</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">V8</code>은 이 과정에서 <code class=\"language-text\">변수</code>, <code class=\"language-text\">함수</code>, <code class=\"language-text\">조건문</code>과 같은 코드의 의미를 파악하며, 우리에게 익숙한 자바스크립트의 <code class=\"language-text\">스코프</code> 또한 이 과정에서 설정된다.\n이 중 변수 선언에 관한 자세한 내용은 {% post_link javascript-let-const JavaScript의 let과 const, 그리고 TDZ %}을 참고하자.</p>\n<h3 id=\"ignition으로-바이트-코드bytecode-생성하기\" style=\"position:relative;\">Ignition으로 바이트 코드(Bytecode) 생성하기<a href=\"#ignition%EC%9C%BC%EB%A1%9C-%EB%B0%94%EC%9D%B4%ED%8A%B8-%EC%BD%94%EB%93%9Cbytecode-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"ignition으로 바이트 코드bytecode 생성하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/3ef804b01e47419b1954df82e079ed32/ignition.svg\" width=\"300\">\n  <br>\n</center>\n<p><code class=\"language-text\">바이트 코드(Bytecode)</code>는 고오급 언어로 작성된 소스 코드를 가상머신이 한결 편하게 이해할 수 있도록 중간 코드로 한번 컴파일 한 것을 의미한다. <code class=\"language-text\">V8</code>에서는 <code class=\"language-text\">Ignition</code>이 이 역할을 수행하고 있다.</p>\n<h4 id=\"ignition이란\" style=\"position:relative;\">Ignition이란?<a href=\"#ignition%EC%9D%B4%EB%9E%80\" aria-label=\"ignition이란 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">Ignition</code>은 기존의 <code class=\"language-text\">Full-codegen</code>을 완벽히 대체하는 인터프리터이다. 기존에 사용하고 있던 <code class=\"language-text\">Full-codegen</code>은 전체 소스 코드를 한번에 컴파일했는데, 위에서 설명했듯 <code class=\"language-text\">V8</code>팀은 기존의 <code class=\"language-text\">Full-codegen</code>이 모든 소스 코드를 한번에 컴파일할때 메모리 점유를 굉장히 많이 한다는 사실을 인지하고 있었다.</p>\n<p>또 자바스크립트는 <code class=\"language-text\">C++</code>과 같은 <code class=\"language-text\">정적 타이핑 언어</code>가 아닌 <code class=\"language-text\">동적 타이핑 언어</code>라서 소스 코드가 실행되기 전에는 알 수 없는 값들이 너무 많았기 때문에 이런 접근 방법으로는 최적화를 하기도 힘들었다고 한다.</p>\n<p>그래서 <code class=\"language-text\">Ignition</code>을 개발할 때는 모든 소스를 한번에 해석하는 컴파일 방식이 아닌 코드 한줄 한줄이 실행될 때마다 해석하는 인터프리트 방식을 채택하여 다음 세가지 이점을 가져가고자 하였다.</p>\n<blockquote>\n<ol>\n<li><strong>메모리 사용량 감소.</strong> 자바스크립트 코드에서 기계어로 컴파일하는 것보다 바이트 코드로 컴파일하는 것이 더 편하다.</li>\n<li><strong>파싱 시 오버헤드 감소.</strong> 바이트 코드는 간결하기 때문에 다시 파싱하기도 편하다.</li>\n<li><strong>컴파일 파이프 라인의 복잡성 감소.</strong> <code class=\"language-text\">Optimizing</code>이든 <code class=\"language-text\">Deoptimizing</code>이든 바이트 코드 하나만 생각하면 되기 때문에 편하다.</li>\n</ol>\n<p><strong>Ross McIlroy</strong> <em>Ignition - an interpreter for V8</em></p>\n</blockquote>\n<p>이렇게 <code class=\"language-text\">Ignition</code>은 코드가 한줄한줄 실행될 때마다 코드를 <code class=\"language-text\">바이트 코드</code>로 바꿔주는 친구라는 정도만 알아두면 된다.\n그럼 바이트 코드라는 게 도대체 어떻게 생겨먹었길래 컴퓨터가 해석하기 더 편하다는 걸까? 아까 위에서 사용했던 <code class=\"language-text\">hello</code> 함수를 가져와서 한번 어떤 바이트 코드가 생성되는 지 살펴보자.</p>\n<h4 id=\"바이트-코드를-직접-확인하기\" style=\"position:relative;\">바이트 코드를 직접 확인하기<a href=\"#%EB%B0%94%EC%9D%B4%ED%8A%B8-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%A7%81%EC%A0%91-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"바이트 코드를 직접 확인하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">hello</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Hello,'</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 함수를 호출해서 코드를 사용하지 않는다면 바이트 코드로 인터프리팅하지 않는다.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>만약 <code class=\"language-text\">NodeJS v8.3+</code>을 사용하고 있다면 <code class=\"language-text\">--print-bytecode</code> 옵션을 주는 것만으로 내 소스 코드가 바이트 코드로 어떻게 인터프리팅되었는지 확인할 수 있다. 혹은 <code class=\"language-text\">V8</code>이 제공하고 있는 <code class=\"language-text\">D8</code> 디버깅 도구를 사용해도 되는데 이 친구는 <code class=\"language-text\">V8</code>을 빌드해야 사용할 수 있고, 위에서 설명했듯이 빌드 환경 세팅이 순탄하지는 않기 때문에 필자는 그냥 <code class=\"language-text\">--print-bytecode</code>를 사용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ node --print-bytecode add.js\n<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span>generated bytecode <span class=\"token keyword\">for</span> function: hello<span class=\"token punctuation\">]</span>\nParameter count <span class=\"token number\">2</span>\nFrame size <span class=\"token number\">8</span>\n   <span class=\"token number\">15</span> E<span class=\"token operator\">></span> 0x2ac4000d47b2 @    <span class=\"token number\">0</span> <span class=\"token builtin class-name\">:</span> a0                StackCheck\n   <span class=\"token number\">30</span> S<span class=\"token operator\">></span> 0x2ac4000d47b3 @    <span class=\"token number\">1</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">12</span> 00             LdaConstant <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n         0x2ac4000d47b5 @    <span class=\"token number\">3</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">26</span> fb             Star r0\n         0x2ac4000d47b7 @    <span class=\"token number\">5</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             Ldar a0\n   <span class=\"token number\">46</span> E<span class=\"token operator\">></span> 0x2ac4000d47b9 @    <span class=\"token number\">7</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">32</span> fb 00          Add r0, <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">53</span> S<span class=\"token operator\">></span> 0x2ac4000d47bc @   <span class=\"token number\">10</span> <span class=\"token builtin class-name\">:</span> a4                Return\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>필자가 선언한 <code class=\"language-text\">hello</code> 함수가 바이트 코드로 변환된 모습이다. 어라? 근데 필자는 분명히 <code class=\"language-text\">name</code> 인자 한개만 사용했는데 <code class=\"language-text\">Parameter count</code>가 <code class=\"language-text\">2</code>라고 찍혀있다.\n이 중 하나는 암시적 리시버인 <code class=\"language-text\">this</code>이다. 함수 내부에서 <code class=\"language-text\">this</code>를 사용하면 함수 자신을 가리킬 수 있는 그 <code class=\"language-text\">this</code> 맞다.</p>\n<p>이제 그 밑으로는 레지스터에 값들을 할당하는 모습을 볼 수 있는데, 간단하게만 설명하고 넘어가겠다.</p>\n<p>혹시 모르실 분들을 위해 간단히 설명하자면, <code class=\"language-text\">레지스터(Register)</code>는 CPU가 가지고 있는 고속 메모리이고 <code class=\"language-text\">누산기(Accumulator)</code>는 계산한 중간 결과를 저장하기 위한 레지스터이다.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">StackCheck</code>: 스택 포인터의 상한값을 확인한 것이다. 이때 스택이 임계 값을 넘어가면 <code class=\"language-text\">Stack Overflow</code>가 발생하기 때문에 함수 실행을 중단해버린다.</li>\n<li><code class=\"language-text\">LdaConstant [0]</code>: <code class=\"language-text\">Ld</code>는 <code class=\"language-text\">Load</code>의 약자이다. 말 그대로 어떠한 상수를 <code class=\"language-text\">누산기(Accumulator)</code>에 불러온 것이다. 이 상수는 <code class=\"language-text\">Hello,</code>이다.</li>\n<li><code class=\"language-text\">Star r0</code>: 누산기에 들어있는 값을 레지스터 <code class=\"language-text\">r0</code>번으로 이동시킨다. <code class=\"language-text\">r0</code>은 지역 변수를 위한 레지스터이다.</li>\n<li><code class=\"language-text\">Ldar a0</code>: 누산기에 레지스터 <code class=\"language-text\">a0</code>번에 있는 값을 담는다. 이 경우 <code class=\"language-text\">a0</code> 레지스터의 값은 인자 <code class=\"language-text\">name</code>이다.</li>\n<li><code class=\"language-text\">Add r0, [0]</code>: <code class=\"language-text\">r0</code>에 있는 <code class=\"language-text\">Hello,</code>와 <code class=\"language-text\">0</code>을 더하고 누산기에 저장한다. 이때 상수 <code class=\"language-text\">0</code>은 코드가 실행될 때 인자 <code class=\"language-text\">name</code>으로 매핑된다.</li>\n<li><code class=\"language-text\">Return</code>: 누산기에 있는 값을 반환한다.</li>\n</ol>\n<hr>\n<p><code class=\"language-text\">hello</code> 함수는 평소에 자바스크립트를 사용할 때는 아무 생각 없이 선언할 수 있는 정도의 가벼운 함수였지만 내부적으로는 6단계를 거쳐서 값을 반환하고 있었다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 204px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAExUlEQVQ4y4WVS0hWbRSFjxRFCE3EiaMGEQRNmoQ40KCCNDW6aGpWWhFmaWl4SbuBUFHeK6VSK7PU1ExTM83sQpRiml0si5JM0Mi8BGFksOLZ8v38/JP/hcN3vnPes/faa629X+fly5dqbm7WyMiILl26pDVr1ig5OVlBQUGKjIzU9u3bVVpaanvKy8u1adMmbdu2Td++fdOVK1d04MAB+79u3TqdPn1aTldXl2pra3Xt2jXbzAuCxcbGav369Tp06JB9uGvXLm3ZskVHjhxRX1+fqqqqFBUVpaNHjyogIED79++34E5NTY0aGhp0/vx5hYSEGKIdO3Zo586dio6O1vXr1xUfH28Bnz59qqmpKUO6du1axcXF2d7Nmzfbnrq6OjmUV1lZqVu3blmQw4cPy8fHR8uWLdPKlSvtQxKFhYWpsbHRkIE0Oztbe/bssW/Cw8OtGoA5jx8/FihPnTqliIgIBQcHy9PTU6tWrdKCBQu0fPlyJSQkKDQ0VJmZmYqJidHu3buVn5+vEydOWNmBgYGW8MGDB3JevXql7u5uJSUlWSbKoFQyzp07V0uXLpW3t7fc3d3l6+tr5R0/ftxQAwARDx48aBrcv39/RpTe3l4ree/evUY6vEADwnh4eMhxHM2ZM8fKz8vLs+QbN260ckkAp2lpaUaJ8+zZM71580YvXrww+PCyb98+jY6O6vnz5yooKLBAoCAYSQmCSCQ/e/as3W/dunWmZPxHUJAC+8KFC2LxEkvk5uba84sXL5rilEipcMl/6GHfxMSEOjo65LS0tKinp8cC/Pr1y4LxW1ZWZkKlpqbah6iL11asWKH09HRLDM9Xr161bx49eqQ7d+7IGRgYMHTDw8P6/PmzxsbGbEN1dbWpWlRUpKamJl2+fFl+fn7KyspSTk6OqQpNICORv7+/AOcA8969e0pJSbGsN2/eNPP+/v1bnZ2dhu7Tp0/2EVdFRYUSExP1+vVrQ7d69WrjEgAPHz6Uc+7cOQuIWSmLNkN+13LRAE8Ig/fYg4CIcePGDesQjH737l05uJvGP3PmjMmPANzjz8HBQXPAz58/dezYMetVrESbYav6+noTDU55ZgEhsq2tzZzPVCE7fHGBeGhoyEqmdAyN17AT5YIY0WgGEFtANra2tqq4uNjsQxtCA5xMT0+rv7/f7r9+/aqMjAxLWlhYaP6jfAwNajoH8RxU4yUlUerJkyeNDxCThCBv3741Hpk2VESnLF682Fpyw4YNZmp6HeocoMMNUwfIKMgwIBElUjarvb3d7IW1UJj2XLJkibUl16JFi2YQIgocAJ9yCIL/QM2MpAXfv39vPOI5aPj3gi4vLy+5ubnNjC98yKinnfBhSUmJEY56mP7du3cmzH8XPnUFZwQyRG7fvi0HXojODEQxjEvfEuj79+/WlqwPHz7YM6zCOcT68+ePXXiVY4CjxMHEBISHWbNmWa/ixy9fvlhGSmbBHXPzyZMnNu7Gx8f/Qcj9woULzQ0OTicYw9RFMEqy8CeU/N+C63nz5hl6BwFcgWbPnm2/2MfVdqj88eNH6+8fP34YGsSZnJw03zI/58+fb0eFDVjKwkf0Jeeya5xTIrzRepgdNel5+hauGHf4laOXmciZjB5/Acd0aDAN0Gw/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"slow\" title=\"slow\" src=\"/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png\" srcset=\"/static/e75c06934a527f059c1754c33f12e6ff/69538/slow.png 160w,\n/static/e75c06934a527f059c1754c33f12e6ff/779ef/slow.png 204w\" sizes=\"(max-width: 204px) 100vw, 204px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <small>&#xC774;&#xB807;&#xAC8C; &#xC77C; &#xB9CE;&#xC774; &#xD558;&#xB2C8;&#xAE4C; &#xAC00;&#xB054; &#xB290;&#xB9AC;&#xB2E4;&#xACE0; &#xB108;&#xBB34; &#xBB50;&#xB77C; &#xD558;&#xC9C0; &#xB9D9;&#xC2DC;&#xB2E4;</small>\n</center>\n<p><code class=\"language-text\">바이트 코드</code>는 직접 CPU 내의 레지스터와 누산기를 어떤 식으로 사용하라고 명령하는 명령문이나 마찬가지기 때문에 사람 입장에서는 머리 터지겠지만 컴퓨터 입장에서는 한결 이해하기가 편한 방식이다.</p>\n<p><code class=\"language-text\">V8</code> 엔진은 우리가 작성한 자바스크립트 코드를 내부적으로는 이런 모습의 <code class=\"language-text\">바이트 코드</code>로 전부 변환해놓기 때문에 코드 라인이 처음 실행될 때는 조금 시간이 걸리겠지만 그 이후부터는 거의 컴파일 언어에 가까운 성능을 보일 수 있다.</p>\n<h3 id=\"turbofan으로-뜨거워진-코드-식히기\" style=\"position:relative;\">TurboFan으로 뜨거워진 코드 식히기<a href=\"#turbofan%EC%9C%BC%EB%A1%9C-%EB%9C%A8%EA%B1%B0%EC%9B%8C%EC%A7%84-%EC%BD%94%EB%93%9C-%EC%8B%9D%ED%9E%88%EA%B8%B0\" aria-label=\"turbofan으로 뜨거워진 코드 식히기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<center>\n  <img src=\"/69868eb577b0cc588456498aa200170b/turbofan.svg\" alt=\"v8-turbofan\" width=\"300\">\n  <br>\n</center>\n<p><code class=\"language-text\">TurboFan</code>은 <code class=\"language-text\">V8</code>의 <code class=\"language-text\">v5.9</code>부터 기존에 사용하던 <code class=\"language-text\">Crankshaft</code> 컴파일러를 완전히 대체한 최적화 담당 컴파일러이다.</p>\n<p>그럼 <code class=\"language-text\">Crankshaft</code>는 왜 사라졌을까?\n처음 <code class=\"language-text\">V8</code>이 세상에 나온 이후로 새로운 컴퓨터 아키텍처도 나오고 자바스크립트도 계속 발전했기 때문에 <code class=\"language-text\">V8</code>도 계속해서 이런 것들을 지원해줘야 했다. <code class=\"language-text\">V8</code> 팀은 이런 새로운 사양에 맞춰서 <code class=\"language-text\">V8</code>을 계속 개량했어야 했는데, 어떻게든 계속 해서 땜빵치다가 결국 <code class=\"language-text\">Crankshaft</code>의 구조로는 지속적인 확장이 어렵다고 판단했고, 여러 레이어로 계층화되어 좀 더 유연하게 확장에 용이하도록 설계한 <code class=\"language-text\">TurboFan</code>을 만들어서 사용하고 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 500px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADpklEQVQ4yx2UV1MjRxSF9cf86ir7wS6KNbuYIJFZI3uLMmhBEQnlMMrSIIRyzuSwS0ZAsY/+QZ+veOjq7umec79z7tRobooxLgpRrrJBvhXCPJdC3FZSvPT2eSu4GeaCvDVT3NUT3DTS3DRVrisxHssJXosRfnRUjmoqxagDy9oUmu+lJDdyeF2MclmI8VIJ8VyL8pAP8JqxMsw7GTZjvIrQsBZn2Erz0kjyQ8awpPBaDfPfQOVy343jixbNUyPFrVAcpjycHIS5L0UY9lSeKgrnUQvdjJubroh097gtRLgX0qeWUIr4eS4gc4K3foaTPSe2tRk0d9UY9+UYfRE8zvq5KwW5q6UYHARohk0Sh5cHEX8uR4Q8zEU1/u7mKOPnIuHgWiJ6FI1+fBfb6qRYVoVgXw4lw8t8SAgUroT6vKjQi2xxlHZwU5fM2ikeGiImdI91sZsPcpv1cCuWh50MzYQb8/JHNN/2hEx1ca46uIrtcFfw813yOT0Ichzf4iRl4SLn4fpASMtRHiWSu0KA22JImiiOalKsnuIibse4NCGESQfnCTvtuIPmSDDvZ5Bykg1sU1W2OU5buU6b6URM9DO7HCatcm7nLLlLNWajqgplM8Hxnouv8+NorqQ7gz0vraSQyqVe2MJZwsqF2O37DfRCW5z6NzhNOeipTpqqj8OMiyNpWMm9QVcxcygua/KeZeUTmnbQyEnWRzUlF6ViN2KmHxKaoIFTxUDba6Av5L1Rg+JWydTDad7H6ai4FG4pJhqKhXzEhnN9Dk0vaqei2In7N+lHhUz1cpb20lTEWsJGO7hFbmedsPkLqn2dYyE9Srjeu9qXT6Xok8blQrL24NXPovHGdWz6x9iKjFEr7tLJOgkqn3H7ZmgJ0aXEEd3WM/nxA3PaCfaFZiDf5kCiOsx5qeWsHApxOfAvG4YxNPbGJDuNPzEVPmDNTxCo6NhI/M6a8jMuVUe8oMcW0bL89Q/+9o7jyujwFXQ4ipOY98bRx3/ln9AvrPt/Y8b5ExpbY5qd1iyu3hJOGY7OPM7OItaGDlNjFlNdh7k+h62xgLE2y3Z5BlNtBkPpk8xajNUprM1ZbK2Zdx2NsyVCrUVcnVXMVR32+qLsP4voKo7mEubKPLbaKpbaMqbKHMbySFTLZmESW1MnYyS0gKk6LWv5ORgE3ViZxlLXCtUC9pYItVeEeAXP4C/cvVVc3RV8Az3ewRqe3po80+OXvUNARm5220siOCo0xf/KMC+2qq5CRAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"legacy\" title=\"legacy\" src=\"/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png\" srcset=\"/static/0b92cf561c8d37d00ae81e4db81baadb/69538/legacy.png 160w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/72799/legacy.png 320w,\n/static/0b92cf561c8d37d00ae81e4db81baadb/0b533/legacy.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <small>Crankshaft&#xC640; TurboFan&#xC744; &#xB3D9;&#xC2DC;&#xC5D0; &#xAD74;&#xB9B4; &#xB54C; &#xC660;&#xC9C0; &#xC774;&#xB7F0; &#xB290;&#xB08C;&#xC774;&#xC5C8;&#xC744; &#xAC83; &#xAC19;&#xB2E4;...</small>\n</center>\n<p>7개의 아키텍처를 지원할 때 <code class=\"language-text\">Crankshaft</code>로는 <code class=\"language-text\">13,000 ~ 16,000</code>라인의 코드로 작성했던 게 <code class=\"language-text\">TurboFan</code>에서는 <code class=\"language-text\">3,000</code>라인 미만의 코드로 커버가 가능하다고 한다.</p>\n<p><code class=\"language-text\">V8</code>은 런타임 중에 <code class=\"language-text\">Profiler</code>라는 친구에게 함수나 변수들의 호출 빈도와 같은 데이터를 모으라고 시킨다. 이렇게 모인 데이터를 들고 TurboFan에게 가져가면 TurboFan은 자기 기준에 맞는 코드를 가져와서 최적화를 하는 것이다.</p>\n<p>최적화 기법으로는 <code class=\"language-text\">히든 클래스(Hidden Class)</code>나 <code class=\"language-text\">인라인 캐싱(Inline Caching)</code> 등 여러가지 기법을 사용하지만 이 내용은 추후 다른 포스팅에서 더 자세히 다루도록 하겠다.\n간단히만 설명하자면 <code class=\"language-text\">히든 클래스</code>는 비슷한 놈들끼리 분류해놓고 가져다 쓰는 것, <code class=\"language-text\">인라인 캐싱</code>은 자주 사용되는 코드가 만약 <code class=\"language-text\">hello()</code>와 같은 함수의 호출부라면 이걸 <code class=\"language-text\">function hello () { ... }</code>와 같이 함수의 내용으로 바꿔버리는 것이다. 말 그대로 <code class=\"language-text\">캐싱(Caching)</code>이다.</p>\n<h4 id=\"어떤-조건으로-최적화-하는-걸까\" style=\"position:relative;\">어떤 조건으로 최적화 하는 걸까?<a href=\"#%EC%96%B4%EB%96%A4-%EC%A1%B0%EA%B1%B4%EC%9C%BC%EB%A1%9C-%EC%B5%9C%EC%A0%81%ED%99%94-%ED%95%98%EB%8A%94-%EA%B1%B8%EA%B9%8C\" aria-label=\"어떤 조건으로 최적화 하는 걸까 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>그렇다면 <code class=\"language-text\">TurboFan</code>은 정확히 어떤 조건으로 최적화될 코드를 구분하는 걸까?\n우선 <code class=\"language-text\">V8</code> 소스 내에서 함수를 최적화할지 말지를 판별하는 <code class=\"language-text\">RuntimeProfiler</code>의 <code class=\"language-text\">ShouldOptimize</code> 메소드를 예시로 한번 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token comment\">// v8/src/execution/rumtime-profiler.cc</span>\nOptimizationReason RuntimeProfiler<span class=\"token operator\">::</span><span class=\"token function\">ShouldOptimize</span><span class=\"token punctuation\">(</span>JSFunction function<span class=\"token punctuation\">,</span> BytecodeArray bytecode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// int ticks = 이 함수가 몇번 호출되었는지</span>\n  <span class=\"token keyword\">int</span> ticks <span class=\"token operator\">=</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">feedback_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">profiler_ticks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> ticks_for_optimization <span class=\"token operator\">=</span>\n      kProfilerTicksBeforeOptimization <span class=\"token operator\">+</span>\n      <span class=\"token punctuation\">(</span>bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> kBytecodeSizeAllowancePerTick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ticks <span class=\"token operator\">>=</span> ticks_for_optimization<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 함수가 호출된 수가 임계점인 ticks_for_optimization을 넘기면 뜨거워진 것으로 판단</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token operator\">::</span>kHotAndStable<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>any_ic_changed_ <span class=\"token operator\">&amp;&amp;</span> bytecode<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> kMaxBytecodeSizeForEarlyOpt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 이 코드가 인라인 캐싱되지 않았고 바이트 코드의 길이가 작다면 작은 함수로 판단</span>\n    <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token operator\">::</span>kSmallFunction<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 해당 사항 없다면 최적화 하지 않는다.</span>\n  <span class=\"token keyword\">return</span> OptimizationReason<span class=\"token operator\">::</span>kDoNotOptimize<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>생각보다 조건이 별로 없어서 당황했다. 물론 이 메소드에서 판별 하지않는 좀 더 디테일한 조건들도 존재하지만 일단 큰 틀은 이 메소드가 거의 다 가지고 있다.</p>\n<p><code class=\"language-text\">kHotAndStable</code>은 코드가 뜨겁고 안정적이라는 것인데, 쉽게 말하면 <code class=\"language-text\">자주 호출되고(뜨겁고) 코드가 안 변함(안정적)</code>이라는 것이다.\n매번 같은 행동을 수행하는 반복문 내에 있는 코드 같은 경우가 여기에 해당하기 쉽다.</p>\n<p><code class=\"language-text\">kSmallFunction</code>은 말 그대로 인터프리팅된 바이트 코드의 길이를 보고 특정 임계점을 넘기지 않으면 작은 함수라고 판단해서 최적화를 진행하는 것이다. 작고 단순한 함수는 크고 복잡한 함수보다 동작이 매우 추상적이거나 제한적인 확률이 높기 때문에 안정적이라고 볼 수 있다.</p>\n<h4 id=\"turbofan이-일하는-모습-훔쳐보기\" style=\"position:relative;\">TurboFan이 일하는 모습 훔쳐보기<a href=\"#turbofan%EC%9D%B4-%EC%9D%BC%ED%95%98%EB%8A%94-%EB%AA%A8%EC%8A%B5-%ED%9B%94%EC%B3%90%EB%B3%B4%EA%B8%B0\" aria-label=\"turbofan이 일하는 모습 훔쳐보기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>그럼 간단한 코드 예제를 통해 최적화가 어떤 방식으로 진행되는 지 확인해보자. 필자는 작은 함수 하나를 선언하고 반복문을 통해서 계속 호출해줄 것이다.</p>\n<p>필자의 목표는 선언한 함수가 <code class=\"language-text\">ticks &gt;= ticks_for_optimization</code> 조건에 걸려서 <code class=\"language-text\">kHotAndStable</code> 상태가 되는 것이다. 필자 생각으로는 대충 아무 함수나 선언해서 같은 타입의 인자를 사용하고 반복적으로 파바박! 호출하면 <code class=\"language-text\">ShouldOptimize</code> 메소드의 <code class=\"language-text\">ticks &gt;= ticks_for_optimization</code> 조건에 걸릴 것이고, <code class=\"language-text\">kHotAndStable</code> 상태가 되어 최적화가 진행될 거라고 생각한다.</p>\n<p><code class=\"language-text\">NodeJS</code>를 실행할 때 <code class=\"language-text\">--trace-opt</code> 옵션을 주면 런타임 때 코드가 최적화되는 것을 확인해볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> d <span class=\"token operator\">=</span> c <span class=\"token operator\">-</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> d <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ node --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>marking 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>compiling method 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> using TurboFan OSR<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b69c09 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.132</span>, <span class=\"token number\">0.453</span>, <span class=\"token number\">0.027</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> - took <span class=\"token number\">0.850</span>, <span class=\"token number\">0.549</span>, <span class=\"token number\">0.012</span> ms<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>completed optimizing 0x010e66b6a001 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x10eacdd4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>오 최적화가 되긴 했다. <code class=\"language-text\">ICs with typeinfo: 3/3 (100%)</code>라고 적혀있는걸 보니 인라인 캐싱을 했나보다. 근데 최적화를 한 이유를 보니 <code class=\"language-text\">small function</code>이라고 적혀있다. 필자가 원했던 조건은 <code class=\"language-text\">kHotAndStable</code>으로 빠지는 것이었기 때문에 코드를 조금 바꿔서 다시 해봐야겠다. 함수가 너무 간단하니까 <code class=\"language-text\">TurboFan</code>이 필자의 함수를 만만하게 봤나보다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sample</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>arguments<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'인자를 주시오'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> array<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">*</span> el<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그냥 아무 의미 없지만 적당히 더 복잡하게 만들어 보았다. <code class=\"language-text\">sample</code> 함수는 그냥 인자를 받아서 변형하고 걸러내고 순서를 뒤집어서 반환하는 역할을 수행한다. 여기서 <code class=\"language-text\">Turbofan</code>이 감시하고 있는 최적화 대상은 <code class=\"language-text\">sample</code>, <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, <code class=\"language-text\">reverse</code>, <code class=\"language-text\">Array.from</code> 같은 친구들이 될 것이다. 감시 대상이 많으므로 로그도 어마무시하게 나오기 때문에 <code class=\"language-text\">TurboFan</code>이 함수를 최적화 대상으로 <code class=\"language-text\">marking</code> 하는 부분만 가져오겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ node --trace-opt test.js\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc51 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4279<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">3</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/3 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa9611 <span class=\"token operator\">&lt;</span>JSFunction array.map.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d46f9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36bcfa96a1 <span class=\"token operator\">&lt;</span>JSFunction array.map.filter.el <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4761<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/1 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a368a90cc11 <span class=\"token operator\">&lt;</span>JSFunction sample <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36218d4371<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">10</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">90</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/11 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4785c01 <span class=\"token operator\">&lt;</span>JSFunction UseSparseVariant <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a36660866d9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: small function, ICs with typeinfo: <span class=\"token number\">1</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">20</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>marking 0x1a36e4786fc1 <span class=\"token operator\">&lt;</span>JSFunction reverse <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x1a3666086f21<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token keyword\">for</span> optimized recompilation, reason: hot and stable, ICs with typeinfo: <span class=\"token number\">4</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">80</span>%<span class=\"token punctuation\">)</span>, generic ICs: <span class=\"token number\">0</span>/5 <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>오 드디어 <code class=\"language-text\">reason: hot and stable</code>이 나왔다. <code class=\"language-text\">&lt;JSFunction 함수 이름&gt;</code>과 같은 포맷으로 함수 정보가 함께 출력되기 때문에 <code class=\"language-text\">hot and stable</code>의 이유로 최적화 대상을 찍힌 친구가 <code class=\"language-text\">sample</code>과 <code class=\"language-text\">reverse</code> 함수라는 것을 알 수 있다. 이와 같이 <code class=\"language-text\">TurboFan</code>은 한가지 데이터가 아니라 여러가지 데이터를 프로파일링하며 이 코드를 최적화할 것인지 구분한다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>최근 잘 짜여진 자바스크립트는 <code class=\"language-text\">C++</code>에 근사하는 성능을 낼 수도 있다고 한다. 처음 이 이야기를 들었을 때는 “인터프리터 언어가 어떻게 컴파일 언어 성능을 내?”라고 생각했었지만 <code class=\"language-text\">V8</code>의 작동 원리를 살펴보니 생각보다 많은 최적화 기법이 들어가 있어서 놀랐다.</p>\n<p>그리고 이렇게 자바스크립트 엔진을 하나하나 뜯어보면서 내가 좋아하는 언어에 대한 이해도를 높히는 과정은 굉장히 재밌었다.<small>(학교 다닐 때 C++ 좀 많이 써볼걸…)</small></p>\n<p>사실 <code class=\"language-text\">V8</code> 엔진 내부에는 “오…개쩌는데…?” 라는 말이 나올만한 최적화 기법이 많이 적용되어 있기 때문에 이것저것 다 소개하고 싶었지만, 포스팅을 쓰다보니 뭔가 내용이 길어지면서 점점 산으로 가고…\n그래서 이번에는 전체적인 흐름을 설명하는 선까지만 하고 다음 포스팅때 <code class=\"language-text\">Ignition</code>과 <code class=\"language-text\">TurboFan</code>의 작동에 대해서 좀 더 디테일하게 설명해보도록 하겠다.\n특히 <code class=\"language-text\">TurboFan</code>의 동작 흐름을 아는 것은 내 자바스크립트 코드를 최적화할 수 있는 지름길이기 때문에 알아두면 요긴하게 써먹을 수 있을 것 같다.</p>\n<p>이상으로 V8 엔진은 어떻게 내 코드를 실행하는 걸까? 포스팅을 마친다.</p>","tableOfContents":"<ul>\n<li><a href=\"#v8-%EC%97%94%EC%A7%84%EC%9D%B4%EB%9E%80\">V8 엔진이란?</a></li>\n<li>\n<p><a href=\"#v8-%EC%97%94%EC%A7%84%EC%9D%98-%EC%9E%91%EB%8F%99%EC%9B%90%EB%A6%AC%EB%A5%BC-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\">V8 엔진의 작동원리를 살펴보자.</a></p>\n<ul>\n<li><a href=\"#parsing-%EC%BD%94%EB%93%9C%EC%9D%98-%EC%9D%98%EB%AF%B8-%ED%8C%8C%EC%95%85%ED%95%98%EA%B8%B0\">Parsing, 코드의 의미 파악하기</a></li>\n<li><a href=\"#ignition%EC%9C%BC%EB%A1%9C-%EB%B0%94%EC%9D%B4%ED%8A%B8-%EC%BD%94%EB%93%9Cbytecode-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\">Ignition으로 바이트 코드(Bytecode) 생성하기</a></li>\n<li><a href=\"#turbofan%EC%9C%BC%EB%A1%9C-%EB%9C%A8%EA%B1%B0%EC%9B%8C%EC%A7%84-%EC%BD%94%EB%93%9C-%EC%8B%9D%ED%9E%88%EA%B8%B0\">TurboFan으로 뜨거워진 코드 식히기</a></li>\n</ul>\n</li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>","fields":{"lang":"ko"},"frontmatter":{"title":"V8 엔진은 어떻게 내 코드를 실행하는 걸까?","date":"2019-06-28","categories":["Programming","JavaScript"],"tags":["NodeJS","V8","JavaScript"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/0lEQVQoz2P4jxs8f//v2ft/eBQwwFn//oHUPXz4cPeevVcunT1w7Vf45G9hk77tvfLz4rmT27btuHfvHlwZds33798PDAwK8PcOaLqy99r/Pdf+e9acd3V2cHFxvXPnDlDB379/sWiG67946XJ8dKhr3oaK1f9LV/13yFwbFuRz9vwFNGvRNQPBH7DBG3Ycc6p7ULb8d8myX7ZV99ZsPQyXwqf5L8jof6fv/Xdq+37j2e/rT3/bNn87eRck+PfffwKaIe56/+Vv+KTPsTN+R8/4HTzhM5ALl8KnGa7owZv/4U0nwptOAhlYdWLXDA/SUyeOABFaCBPWDLIKCeECAOKUJK7wQMAfAAAAAElFTkSuQmCC","aspectRatio":2,"src":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/ee604/thumbnail.png","srcSet":"/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/69585/thumbnail.png 200w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/497c6/thumbnail.png 400w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/ee604/thumbnail.png 800w,\n/static/c89eb7ad6cf0f0ddc746a5da08d39a3e/31987/thumbnail.png 1000w","sizes":"(max-width: 800px) 100vw, 800px"}}}}},"allMarkdownRemark":{"edges":[]}},"pageContext":{"slug":"/20190628-v8-analysis/","previous":{"fields":{"slug":"/20190625-hashtable-with-js/","path":"/2019/06/25/hashtable-with-js/","lang":"ko","postGroup":"20190625-hashtable-with-js"},"frontmatter":{"title":"JavaScript와 함께 해시테이블을 파헤쳐보자"}},"next":{"fields":{"slug":"/20190702-what-is-agile/","path":"/2019/07/02/what-is-agile/","lang":"ko","postGroup":"20190702-what-is-agile"},"frontmatter":{"title":"애자일이 도대체 뭐길래?"}},"lang":"ko","postGroup":"20190628-v8-analysis"}}}