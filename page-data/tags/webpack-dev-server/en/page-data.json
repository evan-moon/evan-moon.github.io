{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/webpack-dev-server/en/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"53d4de7c-0f7b-5dbe-959b-504f6bf26bb7","tableOfContents":"<ul>\n<li><a href=\"#using-nodejs-inspector\">Using NodeJS Inspector</a></li>\n<li><a href=\"#memory-leak-cause\">Memory Leak Cause</a></li>\n<li><a href=\"#solution\">Solution</a></li>\n<li><a href=\"#wrapping-up\">Wrapping Up</a></li>\n</ul>","excerpt":"In this post, I want to briefly document a Webpack Watch feature memory leak I recently fixed. As the project I developed at work grew, running builds multiple times during Watch eventually caused  errors killing the process. This problem actually occurred quite a while ago but kept being ignored while developing business issues - I happened to get a chance to look into this issue closely.","html":"<p>In this post, I want to briefly document a Webpack Watch feature memory leak I recently fixed. As the project I developed at work grew, running builds multiple times during Watch eventually caused <code class=\"language-text\">out of memory</code> errors killing the process. This problem actually occurred quite a while ago but kept being ignored while developing business issues - I happened to get a chance to look into this issue closely.</p>\n<!-- more -->\n<p>Actually, just Googling <code class=\"language-text\">webpack watch memory leak</code> shows many comrades worldwide suffering from the same issue.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/719ca011fe26513ab9402af9feb1e870/71ee9/out-of-memory.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVR42n1U2ZKjMAzkN7ZmchAIN4Q73DBAMfP/P6R1yzEzSc3uQ5exLLfUkozmeAGFt4QcL6SLaT1BN66Mi3nd9+eL+cu5xfbDSSdtmGZaty/qhpGqpqXiXlPddlRWDSVZIfaV+K7FWUd5WdEtydknK+68V3eMq03vR0Fouz4BpuXQ8XxhnHRjB6K+H8+/4nA6C3999+EMozghiVRET/nbDyOyHI+utsNSlDQlGYF0Q9pfA2qoH9JP85LudctS73XD+zQvuL4IBPmQfksyitOMz2BTCmUCLmlwxmFWlEwM4BJscZqzk5L/LVVmpcqjVGDVkFE3TNSNE/UPYI8mSLS7Ai+IyA1CCqIbl8Z2PXL9gIneDicpGYRtP3CXx4+Z5nWjcV6o6Xq29+MHDZPEtKy8x1nd9pSKQJCN0bM9nwzLJg0ZSMKJL8Gx7UG+PC4P1IqzaV7ZDgUg+PN2eJKuwIQAMsQ89oJ02bZHpitnDazbJwcAMeSidj+HXXVca0RGy/pJpegsOoWaqM4Brh8Ku/9kwxBjbtEwwBRSsTJhnTZUlQOPDJx/Pid5wdkJLMfdiWAD8P3tK8amK3qKIzkmtsgEBLikSLC+vm81Rq+vimsYOwm5TkBZWT7ebs0DjLnEPAZRzJHl8Ep5kPYvaFUpHndRcafxU8AKEtRSyXh9Xv8j/AvgrcdZKPOTrQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"out of memory\" title=\"\" src=\"/static/719ca011fe26513ab9402af9feb1e870/6af66/out-of-memory.png\" srcset=\"/static/719ca011fe26513ab9402af9feb1e870/69538/out-of-memory.png 160w,\n/static/719ca011fe26513ab9402af9feb1e870/72799/out-of-memory.png 320w,\n/static/719ca011fe26513ab9402af9feb1e870/6af66/out-of-memory.png 640w,\n/static/719ca011fe26513ab9402af9feb1e870/d9199/out-of-memory.png 960w,\n/static/719ca011fe26513ab9402af9feb1e870/71ee9/out-of-memory.png 1081w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Sad screen you can often see when using Webpack</small>\n</center>\n<p>First, this problem’s most famous solution is using NodeJS’s <code class=\"language-text\">--max-old-space-size</code> to increase Old Space area. Originally Old Space’s default size is about 1.4GB for 64-bit, but many solutions recommend allocating 4GB or 8GB to Old Space when memory explodes like this.</p>\n<p>Actually using this method solves it reasonably well. Memory leaks generally occur when garbage that should be collected during GC (garbage collecting) doesn’t get properly collected - uncollected garbage objects all stay in Old Space. But this method isn’t a fundamental solution - it just delays when memory explodes.</p>\n<blockquote>\n<p>Allocated 4GB to Old Space and after 20 builds memory exploded so allocated 8GB to Old Space? Even so, it’ll explode again after about 40 builds eventually.</p>\n</blockquote>\n<p>That doesn’t mean solving it this way is wrong. I actually was already allocating about 4GB to Old Space through the <code class=\"language-text\">--max-old-space-size=4096</code> option. But this feels like, what should I say, painkillers rather than fundamental treatment, so I wanted to find this issue’s cause and properly fix it this time.</p>\n<h2 id=\"using-nodejs-inspector\" style=\"position:relative;\">Using NodeJS Inspector<a href=\"#using-nodejs-inspector\" aria-label=\"using nodejs inspector permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, why such memory leaks are tricky to fix is because tracing the cause is difficult. For example, <code class=\"language-text\">TypeError</code> logs very clearly tell you where and why a type error occurred, but memory leaks don’t have that.</p>\n<p>They just seem to execute smoothly then suddenly die with <code class=\"language-text\">out of memory</code> at some moment. The program does squeeze out last strength to leave a few lines of stack trace when dying, but since it feels like showing only superficial causes, it didn’t help much when fixing memory leaks.</p>\n<p>So when fixing such memory leaks, you must first tear into JavaScript’s heap. Identifying what’s gradually eating memory within the program. When running NodeJS with some options, you can use Google Chrome’s developer tools to take heap snapshots.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">node</span> <span class=\"token parameter variable\">--inspect</span> --inspect-brk server</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 556px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f8fc7cade4bf23104fdd937cddf97b42/96638/inspector.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVR42q2Ry5KaUBCGeYHJ1nUUUOQihdzvIAKCY6Uqr5Gss82b/+nu6Iw6U5VNFl3N+c/fX/dplP54RFVVmE4TsjzD959nNEONOIwxDAOmaZI8jiPSNEVZlvLd9z1OpxP2ex+LxQKmuYVhGFCiukaSJGjqBp6/x/yjQ1D4cJ0daSWO1LBtWxwOB3ieR4C9nDk6unNsC19eXghoSii/qGsSBBioa0A5CVKMNJFHE26TA3zfl6l2ux2KohCw7wekVWibGrswheXHsC0Ltm1D+Z3nSKjo9XJBFEVSfHk9EzCBU01I4hhd1yEMQwHO84wsy5BTXdtUMF0PVlwjIEZIAykOGV3XxWazkZF5D7quY7vdwjQ2km/BE/CTszTDQDs/DiOm+Uxr6XG+fMNImhIRkHezXq8FpOuawPm8vmbWNU2ThkHg00tigXX9SKsiMOWOoBzKarUSM0OyvERFP4cL/8J1WLSbujkgL0rR2atpKvnXpFWI4kR8y+VXMEuAqqrKwTD4Wc7VsMStmWVaBLZFV69+nSZnLwe/hDX2vgEFyhAKvrhpHPfwD/qT/wF46/JcqKra2x4f9Y/+T4HytH8U3se9X7kB7uP9jz9qn+nPfuW++/+IP7o1kh1aOCtnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"inspector\" title=\"\" src=\"/static/f8fc7cade4bf23104fdd937cddf97b42/96638/inspector.png\" srcset=\"/static/f8fc7cade4bf23104fdd937cddf97b42/69538/inspector.png 160w,\n/static/f8fc7cade4bf23104fdd937cddf97b42/72799/inspector.png 320w,\n/static/f8fc7cade4bf23104fdd937cddf97b42/96638/inspector.png 556w\" sizes=\"(max-width: 556px) 100vw, 556px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>After starting the application with the <code class=\"language-text\">--inspect</code> option and selecting any Google Chrome window then opening developer tools, you can see a NodeJS icon appeared in the left corner. Clicking that icon shows a new inspector that can profile NodeJS. And the <code class=\"language-text\">--inspect-brk</code> option stops execution using the Debug Pause function before executing code. Code executes when developers directly press the Resume button.</p>\n<h2 id=\"memory-leak-cause\" style=\"position:relative;\">Memory Leak Cause<a href=\"#memory-leak-cause\" aria-label=\"memory leak cause permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>What I first did was also taking heap snapshots using NodeJS’s inspector. Actually, I thought this issue was slightly different from typical memory leak situations - typical memory leaks generally follow this scenario:</p>\n<blockquote>\n<ol>\n<li>Create object!</li>\n<li>Release object reference!</li>\n<li>But no GC…? What…?</li>\n<li>Turns out another guy was referencing it</li>\n</ol>\n</blockquote>\n<p>So typical memory leaks often start with “what’s referencing the object that should be released?” So usually you allocate an object and take one heap snapshot, release the object reference and take another heap snapshot, then debug by comparing those two snapshots. I definitely released the reference but something still seems maintained? That’s probably the culprit. Finding this culprit is insanely difficult though…</p>\n<p>But Webpack’s memory leak issue didn’t seem like such complex issues. Looking at others’ cases on Stack Overflow, many said no problems when projects were small but such problems occurred as projects grew, and I was in that situation too, so from the start I set the direction as the hypothesis “are files continuously accumulating with each build?”</p>\n<p>So to verify the hypothesis, I first proceeded with <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> builds, then took heap snapshots every build to observe memory usage changes, and as a result discovered that something called <code class=\"language-text\">Memory File System</code> was gradually growing.</p>\n<table>\n<thead>\n<tr>\n<th>Build Count</th>\n<th>MFS Memory Usage (bytes)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>21,034,701</td>\n</tr>\n<tr>\n<td>2</td>\n<td>38,776,735</td>\n</tr>\n<tr>\n<td>3</td>\n<td>45,209,592</td>\n</tr>\n<tr>\n<td>4</td>\n<td>51,642,543</td>\n</tr>\n<tr>\n<td>7</td>\n<td>83,807,008</td>\n</tr>\n<tr>\n<td>10</td>\n<td>122,404,490</td>\n</tr>\n<tr>\n<td>13</td>\n<td>180,301,478</td>\n</tr>\n</tbody>\n</table>\n<p>After checking this far and cracking open the <code class=\"language-text\">Memory File System</code> object’s interior, as expected I could confirm all bundled files kept accumulating.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bc66d327ef24fa7aa752904a24cc3a4a/2e367/mfs.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 130.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABYlAAAWJQFJUiTwAAADAUlEQVR42o1V25baMAzkU8q1CcSxc4PcDAmw29PT//8eVSPb2bAL7T7oGAIMM5qRvGiODf3u/tDQjHQf3+lqb2T7M10uAzWnhtqmpbquqSzKqYqioLIsvxSeL5arJRVJSVadyewz6ipLWmuq6iOlOqUojmj3c0v43mq9lHO9XtNy+YOLn61WU+H5YrPZ0Ga7pjwpqFYNdZmlJm3JpsxSj9Qnli7pQG3S0enATPcVHVRCTdfT8VSTMZkwi+P4ERAs8eNWdfJjgF3NnQY+b3z2rACAlTpSwfLa3gpgnuei6BPgRgA7Zbl6ATynF7rqmwADEO91ZCg1miz391Q3lGWO3X6/F8nAmgEWAgSGTdIysysNKWoUyWhBFmfcV0MdmwZAsEMBEOweARVL9gy7pBe5o7mK5JHB8RkANQP29szOtxNgkiRPAA+Fk8sMcUIipF708CAZgB0DnjhOkPwaMEiWaqV3YNez1JF7iTKxEcliiO8hAA+Hw1fAUrksoldgGZjBmJt5k/ci2bDk84WathPAsiyeM8xnptRJIycA0T/pIf+REVM0m2Inl18ydLHppeAyQGEKHIb0M58mMpPLte8h6rnLHhDM4ChMwDmEXvJrM3N5nsPnDL3LnZ+UORgkg2kADDnMWO5LhmXictj7HILhXcwYJeQAzOKcJ8WZAsnoH7bMv2OjXA3eDACjwDTEprMfk1JV1SvAR1MGvxzu2buAY85hCmIzBwRDpdRzyQEQJX0Tdy9u6/BM60hPORSX/8cwSAYbgIWlgF46yR/L4XgCw+J1D8tPy8GN21XA3rJf8tyESbFzU745KRg1Z4gbwdYDYlJaHxsjOXy1HOYM/SxDLgyBMWEfhm0TJgXB/pbLltlBNhhCMv7AfN7YeTaZ8nRjB0DZNukogOFeAftTwnfK4eii4xdE7qcliqKvd8o82ABzE+ImBZ+BOS4qxderjJ+Pznz8Frvdju/dHZVpxSuKeyjVy6a5ZrypNY9g/iZnoxhQ1aQzn0XeiWCIPiLc2+2W/gL8njeHrKhC/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mfs\" title=\"\" src=\"/static/bc66d327ef24fa7aa752904a24cc3a4a/6af66/mfs.png\" srcset=\"/static/bc66d327ef24fa7aa752904a24cc3a4a/69538/mfs.png 160w,\n/static/bc66d327ef24fa7aa752904a24cc3a4a/72799/mfs.png 320w,\n/static/bc66d327ef24fa7aa752904a24cc3a4a/6af66/mfs.png 640w,\n/static/bc66d327ef24fa7aa752904a24cc3a4a/d9199/mfs.png 960w,\n/static/bc66d327ef24fa7aa752904a24cc3a4a/2e367/mfs.png 1066w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Disgusting things...</small>\n</center>\n<p>Why did this problem occur? The reason was that project’s Webpack settings had bundle file name pattern as <code class=\"language-text\">client-bundle.[chunkhash].js</code>. The <code class=\"language-text\">chunkhash</code> or <code class=\"language-text\">hash</code> option creates new filenames with every bundling, freeing you from file caching issues occurring in production. But in development environment, this option became poison instead.</p>\n<p>When Webpack starts the dev server, it stores bundled files using a library called <code class=\"language-text\">memory-fs</code>. This library just internally has a map, and file contents are arrays having each line of the file as elements. In other words, if the bundled file name is <code class=\"language-text\">main.js</code>, an object with the following structure gets created:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">MFS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'main.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'var a = 1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'console.log(a)'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>If I modify the <code class=\"language-text\">main.js</code> file or modules dependent from it, <code class=\"language-text\">main.js</code> will be rebundled and change the <code class=\"language-text\">MFS</code> object’s <code class=\"language-text\">main.js</code> key value to the newly bundled file’s contents. However, problems occur when filenames change with each build like <code class=\"language-text\">chunkhash</code> or <code class=\"language-text\">hash</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">MFS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'main.1111.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'var a = 1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Previous file</span>\n  <span class=\"token string-property property\">'main.2222.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'var a = 2'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// Newly bundled file</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">main.1111.js</code> is the bundle created in the previous build and <code class=\"language-text\">main.2222.js</code> is the bundle created in this build. <code class=\"language-text\">chunkhash</code>, <code class=\"language-text\">hash</code> change hash values when rebundling files, so bundled file names differ, and consequently previous version bundles stored in the <code class=\"language-text\">MFS</code> object remain without being replaced. In other words, files accumulate.</p>\n<p>This object itself, arrays containing file lines, and strings having lines’ values all naturally get stored in memory, and since <code class=\"language-text\">memory-fs</code> keeps referencing these guys, consequently even after moving to Old Space they kept not being collected by GC.</p>\n<h2 id=\"solution\" style=\"position:relative;\">Solution<a href=\"#solution\" aria-label=\"solution permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Actually when first encountering this problem, I thought of about 3 solution methods.</p>\n<blockquote>\n<ol>\n<li>Don’t use <code class=\"language-text\">hash</code> or <code class=\"language-text\">chunkhash</code> in filename pattern in development environment.</li>\n<li>Directly remove previous build’s bundle in Webpack’s compiler hook (method <code class=\"language-text\">HotModuleReplacement</code> uses)</li>\n<li>Just increase Old Space. <small>(Final method abandoning pride)</small></li>\n</ol>\n</blockquote>\n<p>Actually method 1 of removing chunkhash from filename pattern alone solves the problem, but just in case I thought of the next alternative. I usually don’t expect one-shot solutions when meeting such problems. <small>(Falling from high places hurts more. Let’s not expect at all)</small></p>\n<p>But fortunately solution method 1 solved it in one shot.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// webpack.client.config.js</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> isLocal <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'local'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> isLocal <span class=\"token operator\">?</span> <span class=\"token string\">'client-bundle.[name].js'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'client-bundle.[chunkhash].js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">Built at: <span class=\"token number\">2019</span>-08-06 <span class=\"token number\">10</span>:29:34\n                                                     Asset       Size       Chunks             Chunk Names\n                                      client-bundle.app.js   <span class=\"token number\">4.16</span> MiB          app  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  app\n                                  client-bundle.app.js.map   <span class=\"token number\">2.98</span> MiB          app  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  app\n                                     client-bundle.chat.js    <span class=\"token number\">815</span> KiB         chat  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  chat\n                                 client-bundle.chat.js.map    <span class=\"token number\">503</span> KiB         chat  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  chat\n                                client-bundle.chat~user.js    <span class=\"token number\">312</span> KiB    chat~user  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  chat~user\n                            client-bundle.chat~user.js.map    <span class=\"token number\">200</span> KiB    chat~user  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  chat~user\n                                 client-bundle.polyfill.js   <span class=\"token number\">6.24</span> KiB     polyfill  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  polyfill\n                             client-bundle.polyfill.js.map   <span class=\"token number\">6.23</span> KiB     polyfill  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  polyfill\n                                   client-bundle.search.js    <span class=\"token number\">254</span> KiB       search  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  search\n                               client-bundle.search.js.map    <span class=\"token number\">224</span> KiB       search  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  search\n                              client-bundle.style-guide.js    <span class=\"token number\">135</span> KiB  style-guide  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  style-guide\n                          client-bundle.style-guide.js.map    <span class=\"token number\">105</span> KiB  style-guide  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  style-guide\n                                     client-bundle.user.js    <span class=\"token number\">134</span> KiB         user  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  user\n                                 client-bundle.user.js.map   <span class=\"token number\">70.2</span> KiB         user  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  user\n                                   client-bundle.vendor.js    <span class=\"token number\">4.6</span> MiB       vendor  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  vendor\n                               client-bundle.vendor.js.map   <span class=\"token number\">5.25</span> MiB       vendor  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  vendor\n  fontawesome-webfont.eot?674f50d287a8c48dc19ba404d20fe713    <span class=\"token number\">162</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n  fontawesome-webfont.ttf?b06871f281fee6b241d60582ae9369b9    <span class=\"token number\">162</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\nfontawesome-webfont.woff2?af7ae505a9eed503f8b8e6982036873e   <span class=\"token number\">75.4</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n fontawesome-webfont.woff?fee66e712a8a08eef5805a46892932ad   <span class=\"token number\">95.7</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n                                                index.html  <span class=\"token number\">804</span> bytes               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n                                                     sw.js   <span class=\"token number\">4.79</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n                                                 sw.js.map    <span class=\"token number\">4.2</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>\n                              vue-ssr-client-manifest.json    <span class=\"token number\">108</span> KiB               <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Since I removed <code class=\"language-text\">chunkhash</code> from the filename pattern and added <code class=\"language-text\">name</code>, bundles will now always be created with the same name like <code class=\"language-text\">client-bundle.app.js</code> no matter how many builds. And as mentioned above, since <code class=\"language-text\">memory-fs</code> uses filenames as map keys, when storing new files to the map, previous build bundles with the same name will automatically get overwritten.</p>\n<p>Below is the size of the dist object within <code class=\"language-text\">Memory File System</code> analyzed using heap snapshots after performing this work.</p>\n<table>\n<thead>\n<tr>\n<th>Build Count</th>\n<th>MFS Memory Usage (bytes)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>21,031,408</td>\n</tr>\n<tr>\n<td>2</td>\n<td>21,023,274</td>\n</tr>\n<tr>\n<td>3</td>\n<td>21,023,224</td>\n</tr>\n<tr>\n<td>4</td>\n<td>21,023,310</td>\n</tr>\n</tbody>\n</table>\n<p>Now even doing multiple builds, memory used by <code class=\"language-text\">memory-fs</code> no longer gradually increases, and frontend chapter developers can finally continue developing in a comfortable environment!</p>\n<h2 id=\"wrapping-up\" style=\"position:relative;\">Wrapping Up<a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Actually this issue was a case that could be quickly solved because the hypothesis set when first encountering the issue fit exactly. But proving that hypothesis took almost all day - the reason being Google Chrome inspector takes too long to take heap snapshots once. Like seriously almost 3-4 minutes per snapshot…</p>\n<p>After identifying the cause and proving the hypothesis, the solution was extremely simple - kind of felt like blowing your nose without using hands…? Well anyway, I was fortunate to solve it easily.</p>\n<p>That’s all for this post on fixing Webpack Watch memory leak.</p>","fields":{"slug":"20190808-fix-webpack-dev-memory-leak-en","path":"/2019/08/08/fix-webpack-dev-memory-leak/en/","lang":"en"},"frontmatter":{"title":"Fixing Webpack Watch Memory Leak","subTitle":"How to track memory leaks – Using Chrome DevTools and Heap Snapshots","date":"Aug 08, 2019","categories":["Programming","Web"],"tags":["Webpack","Webpack","JavaScript","JavaScript","NodeJS","webpack dev server","webpack dev middleware","memory-fs","MFS","Memory leak","Memory Leak","Out of memory"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/089564f2795d80e2fcfd651cd02ef782/d803c/thumbnail.png","srcSet":"/static/089564f2795d80e2fcfd651cd02ef782/d803c/thumbnail.png 320w,\n/static/089564f2795d80e2fcfd651cd02ef782/2a1fd/thumbnail.png 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/089564f2795d80e2fcfd651cd02ef782/fc5c5/thumbnail.webp 320w,\n/static/089564f2795d80e2fcfd651cd02ef782/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/089564f2795d80e2fcfd651cd02ef782/01fb2/thumbnail.png","srcSet":"/static/089564f2795d80e2fcfd651cd02ef782/01fb2/thumbnail.png 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/089564f2795d80e2fcfd651cd02ef782/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"webpack dev server","lang":"en"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}