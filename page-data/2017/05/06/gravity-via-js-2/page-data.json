{"componentChunkName":"component---src-templates-post-page-template-index-tsx","path":"/2017/05/06/gravity-via-js-2/","result":{"data":{"markdownRemark":{"id":"29f9f758-8c2e-589a-8f50-a67ccbd16866","tableOfContents":"<ul>\n<li><a href=\"#%ED%95%84%EC%9A%94%ED%95%9C-%EC%83%81%EC%88%98-%EA%B0%92%EB%93%A4-%EC%84%A0%EC%96%B8\">필요한 상수 값들 선언</a></li>\n<li><a href=\"#mover-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%84%A0%EC%96%B8\">Mover 클래스 선언</a></li>\n<li><a href=\"#mover-%EA%B0%9D%EC%B2%B4%EB%93%A4-%EB%A0%8C%EB%8D%94%ED%95%98%EA%B8%B0\">Mover 객체들 렌더하기</a></li>\n<li><a href=\"#mover-%EA%B0%9D%EC%B2%B4%EB%93%A4-%EC%9A%B4%EB%8F%99-%EC%8B%9C%ED%82%A4%EA%B8%B0\">Mover 객체들 운동 시키기</a></li>\n</ul>","excerpt":"이번 포스팅에서는 저번 포스팅에 이어 중력을 직접 JS로 구현해보려고 한다. 개발환경은 JavaScript ES7, babel, Webpack, Three.js을 사용하였다.","html":"<p>이번 포스팅에서는 <a href=\"/2017/05/06/gravity-via-js-1\">저번 포스팅</a>에 이어 중력을 직접 JS로 구현해보려고 한다. 개발환경은 JavaScript ES7, babel, Webpack, Three.js을 사용하였다.</p>\n<!-- more -->\n<h2 id=\"필요한-상수-값들-선언\" style=\"position:relative;\">필요한 상수 값들 선언<a href=\"#%ED%95%84%EC%9A%94%ED%95%9C-%EC%83%81%EC%88%98-%EA%B0%92%EB%93%A4-%EC%84%A0%EC%96%B8\" aria-label=\"필요한 상수 값들 선언 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>먼저 프로그램에서 사용할 상수 값들 부터 선언하겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">framerate</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">G</span><span class=\"token operator\">:</span> <span class=\"token number\">250</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 내 맘대로 중력상수</span>\n  <span class=\"token constant\">START_SPEED</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 초기화 시 물체들의 속도</span>\n  <span class=\"token constant\">OBJECT_COUNT</span><span class=\"token operator\">:</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 초기화 후 렌더 될 물체 개수</span>\n  <span class=\"token constant\">TRACE_LENGTH</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 물체의 이동 궤적 길이</span>\n  <span class=\"token constant\">MIN_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 물체들의 최소 질량</span>\n  <span class=\"token constant\">MAX_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 물체들의 최대 질량</span>\n  <span class=\"token constant\">DENSITY</span><span class=\"token operator\">:</span> <span class=\"token number\">0.15</span> <span class=\"token comment\">// 물체들이 렌더되는 밀도</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">SPHERE_SIDES</span> <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>여기서 원래는 <code class=\"language-text\">6.6742e-11</code>의 작은 값을 가지는 중력 상수 <code class=\"language-text\">G</code>를 <code class=\"language-text\">250</code>으로 설정했는데, 그 이유는 필자가 만들 시뮬레이션에 등장하는 물체들의 질량이 너무 작기 때문이다.</p>\n<p>실제 중력 상수를 그대로 적용하면서도 중력의 영향이 눈에 보일 정도가 되려면 질량도 행성급으로 커야 하는데, 그러면 계산이 너무 힘들어지기 때문에 물체의 질량을 줄이고 중력 상수는 늘려주는 방식으로 조정했다.</p>\n<p><code class=\"language-text\">MASS_FACTOR</code>는 나중에 렌더할 때 물체의 질량에 비례하도록 구의 크기를 설정하려고 하는데 질량 값들이 <code class=\"language-text\">400-3000</code>이다보니까 구의 부피가 너무 커질 것 같아서 그걸 보정하기 위해 선언한 상수이다.</p>\n<p>일종의 압축률 비슷한 느낌으로 나중에 구의 크기를 정의할 때 물체의 질량에 <code class=\"language-text\">MASS_FACTOR</code>를 곱해줘서 일정한 비율로 크기를 줄일 예정이다.</p>\n<p>이 포스팅은 ThreeJS를 설명하기 위한 포스팅이 아니므로 <code class=\"language-text\">Scene</code>과 <code class=\"language-text\">Renderer</code>의 선언 및 초기화 등에 대해서는 생략하고 지나가겠다.</p>\n<h2 id=\"mover-클래스-선언\" style=\"position:relative;\">Mover 클래스 선언<a href=\"#mover-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%84%A0%EC%96%B8\" aria-label=\"mover 클래스 선언 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>자 그럼 이제 실제 움직일 놈들을 구현하자. 이름을 Object로 하고 싶었지만 알다시피 JS에서 Object라는 이름은 Build-in Object가 이미 가지고 있다. 그래서 다른 이름을 고심하다가 그냥 <code class=\"language-text\">Mover</code>라고 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/constants'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n Vector3<span class=\"token punctuation\">,</span> SphereGeometry<span class=\"token punctuation\">,</span> Line<span class=\"token punctuation\">,</span>\n MeshPhongMaterial<span class=\"token punctuation\">,</span> PointLight<span class=\"token punctuation\">,</span> Mesh<span class=\"token punctuation\">,</span> Geometry\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'three'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>uid <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mover-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> velocity<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> mass<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>alive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SphereGeometry</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>vertices <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Line</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MeshPhongMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">specular</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">shininess</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mesh</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>castShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>receiveShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentScene <span class=\"token operator\">=</span> scene<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">Mover</code>클래스로 생성된 객체는 <code class=\"language-text\">constructor</code> 실행 시 넘겨받은 랜덤한 질량값과 속도, 위치 값을 가지고 있다. 그리고 가속도를 의미하는 <code class=\"language-text\">acceleration</code> 값을 초기화 해준다. 가속도는 어떠한 방향으로 움직이는 속도이므로 3개의 원소를 가진 벡터로 선언해 주었다.</p>\n<p>그리고 <code class=\"language-text\">Mover</code>끼리 충돌 판정이 나면 <code class=\"language-text\">Mover</code> 두개를 하나로 합쳐서 더 큰 질량을 가진 <code class=\"language-text\">Mover</code>로 만들 예정이기 때문에 <code class=\"language-text\">alive</code> 멤버 변수를 선언해서 해당 Mover가 죽었나 살았나를 판별할 수 있도록 했다.</p>\n<h2 id=\"mover-객체들-렌더하기\" style=\"position:relative;\">Mover 객체들 렌더하기<a href=\"#mover-%EA%B0%9D%EC%B2%B4%EB%93%A4-%EB%A0%8C%EB%8D%94%ED%95%98%EA%B8%B0\" aria-label=\"mover 객체들 렌더하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이후 <code class=\"language-text\">Scene</code>에는 초기화 시 <code class=\"language-text\">Mover</code>들을 그려주는 로직을 작성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>movers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// movers리스트 초기화</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>selectionLight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    movers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MOVER_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> mass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MIN_MASS</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_MASS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxDistance <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">DENSITY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxSpeed <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">START_SPEED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> velocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 랜덤한 속도, 위치, 질량을 가진 Mover를 생성</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Mover</span><span class=\"token punctuation\">(</span>mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Mover가 초기화될 때 만들어진 Mesh, Line, Light 객체를 Scene에 넣는다</span>\n    movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span><span class=\"token function\">addMover</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers <span class=\"token operator\">=</span> movers<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span> max</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이제 <code class=\"language-text\">Scene</code>은 여러 개의 <code class=\"language-text\">Mover</code>를 담은 리스트인 <code class=\"language-text\">movers</code>를 가지게 되었다. 이제 렌더되는 동안 계산만 하면 끝! 인데…\n전 포스팅에서 말했듯이 여러 개의 물체에 대한 중력을 구하는 다체문제는 해를 구할 수가 없다.</p>\n<p>그래서 <code class=\"language-text\">movers</code>를 순회하며 한번 순회할 때마다 다른 <code class=\"language-text\">Mover</code>들과의 중력을 이체문제로 모두 계산하는 로직을 만들어야한다.</p>\n<h2 id=\"mover-객체들-운동-시키기\" style=\"position:relative;\">Mover 객체들 운동 시키기<a href=\"#mover-%EA%B0%9D%EC%B2%B4%EB%93%A4-%EC%9A%B4%EB%8F%99-%EC%8B%9C%ED%82%A4%EA%B8%B0\" aria-label=\"mover 객체들 운동 시키기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\nmovers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o1<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>o1<span class=\"token punctuation\">.</span>alive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o2<span class=\"token punctuation\">,</span> j</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> o2<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> i <span class=\"token operator\">!==</span> j<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// o1 -> o2의 거리</span>\n      <span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> o1<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">distanceTo</span><span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// o1, o2의 반지름 r1, r2</span>\n      <span class=\"token keyword\">const</span> r1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> r2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">&lt;=</span> r1 <span class=\"token operator\">+</span> r2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 둘의 거리가 둘의 반지름의 합 이하면 충돌한 것으로 판정, 두 물체를 합친다</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 충돌이 아닐 경우 그냥 운동만 시킨다</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">attract</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>우선 이런 식으로 전체 <code class=\"language-text\">Mover</code>들을 순회하면서 충돌 판정을 내주었다. <code class=\"language-text\">Mover</code> 클래스의 <code class=\"language-text\">eat</code>메소드는 충돌 판정이 난 두 <code class=\"language-text\">Mover</code>들을 하나로 합치는 로직을 가지고 있으며, <code class=\"language-text\">attract</code> 메소드에는 현재 두 물체의 거리에서의 중력을 측정하고 <code class=\"language-text\">Mover</code>의 가속도에 더해주는 역할을 하고 있다.</p>\n<p>이후 모든 계산이 끝나면 <code class=\"language-text\">Mover</code>의 위치와 크기, 속도, 방향 등을 업데이트 해주었다. <code class=\"language-text\">Gravity</code>클래스의 <code class=\"language-text\">calcGravity</code>메소드는 <a href=\"/2017/05/06/gravity-via-js-1\">저번 포스팅</a>에서 적었던 로직 그대로이다.</p>\n<p><code class=\"language-text\">Mover</code>의 운동에 관련된 메소드들은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newMass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> newLocation <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> newVelocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> newLocation<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> newVelocity<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> newMass<span class=\"token punctuation\">;</span>\n\n    otherMover<span class=\"token punctuation\">.</span><span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">attract</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> force <span class=\"token operator\">=</span> Gravity<span class=\"token punctuation\">.</span><span class=\"token function\">calcGravity</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> otherMover<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span><span class=\"token constant\">G</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span>force<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">force</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> f <span class=\"token operator\">=</span> force<span class=\"token punctuation\">.</span><span class=\"token function\">divideScalar</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// mover의 가속도에 힘을 적용</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 속도에 가속도 더함</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 위치에 속도 더해서 이동시킴</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">multiplyScalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 가속도 초기화</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// mover의 mesh객체에 위치 적용</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>정리하자면 매 프레임마다 <code class=\"language-text\">movers</code>리스트를 순회하면서 각 <code class=\"language-text\">Mover</code>들간의 중력을 계산하고 가속도를 적용한 후 실제로 <code class=\"language-text\">Mover</code>를 이동시키는 것이다. 전체 소스는 <a href=\"https://github.com/evan-moon/3d-gravity-test\" target=\"_blank\" rel=\"nofollow\">중력 테스트 프로젝트 깃허브 레파지토리</a>에서 확인해볼 수 있다.</p>\n<p>이상으로 JavaScript로 중력 구현하기 포스팅을 마친다.</p>","fields":{"slug":"20170506-gravity-via-js-2","path":"/2017/05/06/gravity-via-js-2/","lang":"ko"},"frontmatter":{"title":"[JavaScript로 중력 구현하기] 2. 코딩하기","subTitle":"만유인력 법칙을 적용한 중력 시뮬레이션","date":"May 06, 2017","categories":["프로그래밍","그래픽스"],"tags":["중력 구현하기","중력","Gravity","JavaScript","자바스크립트","WebGL","수학","ThreeJS","튜토리얼"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/fc5c5/thumbnail.webp 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}},"allMarkdownRemark":{"edges":[{"node":{"id":"947de425-1f56-5ddf-92ad-085b106c0fef","tableOfContents":"<ul>\n<li><a href=\"#declaring-necessary-constants\">Declaring Necessary Constants</a></li>\n<li><a href=\"#declaring-the-mover-class\">Declaring the Mover Class</a></li>\n<li><a href=\"#rendering-mover-objects\">Rendering Mover Objects</a></li>\n<li><a href=\"#moving-mover-objects\">Moving Mover Objects</a></li>\n</ul>","excerpt":"In this post, following the previous post, I’m going to directly implement gravity with JS. The development environment uses JavaScript ES7, babel, Webpack, and Three.js.","html":"<p>In this post, following <a href=\"/2017/05/06/gravity-via-js-1\">the previous post</a>, I’m going to directly implement gravity with JS. The development environment uses JavaScript ES7, babel, Webpack, and Three.js.</p>\n<!-- more -->\n<h2 id=\"declaring-necessary-constants\" style=\"position:relative;\">Declaring Necessary Constants<a href=\"#declaring-necessary-constants\" aria-label=\"declaring necessary constants permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, I’ll declare the constant values to use in the program.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">framerate</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">G</span><span class=\"token operator\">:</span> <span class=\"token number\">250</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Gravitational constant as I please</span>\n  <span class=\"token constant\">START_SPEED</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Objects' speed during initialization</span>\n  <span class=\"token constant\">OBJECT_COUNT</span><span class=\"token operator\">:</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Number of objects to render after initialization</span>\n  <span class=\"token constant\">TRACE_LENGTH</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Length of objects' movement trajectory</span>\n  <span class=\"token constant\">MIN_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Minimum mass of objects</span>\n  <span class=\"token constant\">MAX_MASS</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Maximum mass of objects</span>\n  <span class=\"token constant\">DENSITY</span><span class=\"token operator\">:</span> <span class=\"token number\">0.15</span> <span class=\"token comment\">// Density at which objects are rendered</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">SPHERE_SIDES</span> <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, I set the gravitational constant <code class=\"language-text\">G</code>, which originally has a small value of <code class=\"language-text\">6.6742e-11</code>, to <code class=\"language-text\">250</code>, because the masses of objects appearing in the simulation I’m making are too small.</p>\n<p>To apply the actual gravitational constant while still having gravitational influence visible to the eye, the mass would also need to be planet-sized, but that would make calculations too difficult, so I adjusted by reducing object mass and increasing the gravitational constant.</p>\n<p><code class=\"language-text\">MASS_FACTOR</code> is a constant I declared to compensate because when rendering later, I’m trying to set sphere size proportional to object mass, but since mass values are <code class=\"language-text\">400-3000</code>, the sphere volume would become too large.</p>\n<p>It’s a feeling similar to a compression ratio. When defining sphere size later, I’ll multiply the object’s mass by <code class=\"language-text\">MASS_FACTOR</code> to reduce size at a constant ratio.</p>\n<p>Since this post is not for explaining ThreeJS, I’ll skip over <code class=\"language-text\">Scene</code> and <code class=\"language-text\">Renderer</code> declaration and initialization.</p>\n<h2 id=\"declaring-the-mover-class\" style=\"position:relative;\">Declaring the Mover Class<a href=\"#declaring-the-mover-class\" aria-label=\"declaring the mover class permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Now let’s implement the things that will actually move. I wanted to name it Object, but as you know, the name Object is already taken by a Built-in Object in JS. So after agonizing over another name, I just called it <code class=\"language-text\">Mover</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/constants'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n Vector3<span class=\"token punctuation\">,</span> SphereGeometry<span class=\"token punctuation\">,</span> Line<span class=\"token punctuation\">,</span>\n MeshPhongMaterial<span class=\"token punctuation\">,</span> PointLight<span class=\"token punctuation\">,</span> Mesh<span class=\"token punctuation\">,</span> Geometry\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'three'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>uid <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mover-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> velocity<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> mass<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>alive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SphereGeometry</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SPHERE_SIDES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>vertices <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Line</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MeshPhongMaterial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">specular</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">shininess</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mesh</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>geometry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>basicMaterial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>castShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>receiveShadow <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentScene <span class=\"token operator\">=</span> scene<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Objects created with the <code class=\"language-text\">Mover</code> class have random mass, speed, and position values received when <code class=\"language-text\">constructor</code> executes. And it initializes the <code class=\"language-text\">acceleration</code> value representing acceleration. Since acceleration is a speed moving in some direction, I declared it as a vector with 3 elements.</p>\n<p>And when collision detection occurs between <code class=\"language-text\">Movers</code>, I plan to merge two <code class=\"language-text\">Movers</code> into one to make a <code class=\"language-text\">Mover</code> with larger mass, so I declared an <code class=\"language-text\">alive</code> member variable to determine whether that Mover is dead or alive.</p>\n<h2 id=\"rendering-mover-objects\" style=\"position:relative;\">Rendering Mover Objects<a href=\"#rendering-mover-objects\" aria-label=\"rendering mover objects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Then I wrote logic in <code class=\"language-text\">Scene</code> to draw <code class=\"language-text\">Movers</code> during initialization.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>movers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Initialize movers list</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>selectionLight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    movers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MOVER_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> mass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MIN_MASS</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_MASS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxDistance <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">DENSITY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> maxSpeed <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token constant\">START_SPEED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> velocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxSpeed<span class=\"token punctuation\">,</span> maxSpeed<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>maxDistance<span class=\"token punctuation\">,</span> maxDistance<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Create Mover with random speed, position, mass</span>\n      movers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Mover</span><span class=\"token punctuation\">(</span>mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Put Mesh, Line, Light objects created when Mover initialized into Scene</span>\n    movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> v<span class=\"token punctuation\">.</span><span class=\"token function\">addMover</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers <span class=\"token operator\">=</span> movers<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getRandomize</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span> max</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now <code class=\"language-text\">Scene</code> has <code class=\"language-text\">movers</code>, which is a list containing multiple <code class=\"language-text\">Movers</code>. Now we just calculate during rendering and we’re done! But…\nAs I said in the previous post, n-body problems for finding gravity for multiple objects have no solution.</p>\n<p>So we need to make logic that traverses <code class=\"language-text\">movers</code> and calculates gravity with other <code class=\"language-text\">Movers</code> as two-body problems each time we traverse.</p>\n<h2 id=\"moving-mover-objects\" style=\"position:relative;\">Moving Mover Objects<a href=\"#moving-mover-objects\" aria-label=\"moving mover objects permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">let</span> movers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movers<span class=\"token punctuation\">;</span>\n\nmovers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o1<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>o1<span class=\"token punctuation\">.</span>alive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  movers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o2<span class=\"token punctuation\">,</span> j</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> o2<span class=\"token punctuation\">.</span>alive <span class=\"token operator\">&amp;&amp;</span> i <span class=\"token operator\">!==</span> j<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Distance from o1 -> o2</span>\n      <span class=\"token keyword\">const</span> distance <span class=\"token operator\">=</span> o1<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">distanceTo</span><span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// o1, o2's radii r1, r2</span>\n      <span class=\"token keyword\">const</span> r1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> r2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>o2<span class=\"token punctuation\">.</span>mass <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token constant\">MASS_FACTOR</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">&lt;=</span> r1 <span class=\"token operator\">+</span> r2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If their distance is less than or equal to the sum of their radii, judge as collision and merge the two objects</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If not collision, just make them move</span>\n        o2<span class=\"token punctuation\">.</span><span class=\"token function\">attract</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>First, I made collision detection while traversing all <code class=\"language-text\">Movers</code> like this. The <code class=\"language-text\">Mover</code> class’s <code class=\"language-text\">eat</code> method has logic to merge two <code class=\"language-text\">Movers</code> that had collision detection into one, and the <code class=\"language-text\">attract</code> method measures gravity at the current distance of the two objects and adds it to the <code class=\"language-text\">Mover</code>’s acceleration.</p>\n<p>After all calculations finish, I updated the <code class=\"language-text\">Mover</code>’s position, size, speed, direction, etc. The <code class=\"language-text\">Gravity</code> class’s <code class=\"language-text\">calcGravity</code> method is exactly the same logic I wrote in <a href=\"/2017/05/06/gravity-via-js-1\">the previous post</a>.</p>\n<p>Methods related to <code class=\"language-text\">Mover</code>’s motion are as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mover</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mass<span class=\"token punctuation\">,</span> velocity<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> scene</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newMass <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> newLocation <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> newVelocity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">+</span> otherMover<span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span>z <span class=\"token operator\">*</span> otherMover<span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> newMass\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> newLocation<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity <span class=\"token operator\">=</span> newVelocity<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> newMass<span class=\"token punctuation\">;</span>\n\n    otherMover<span class=\"token punctuation\">.</span><span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">attract</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">otherMover<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> force <span class=\"token operator\">=</span> Gravity<span class=\"token punctuation\">.</span><span class=\"token function\">calcGravity</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> otherMover<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span><span class=\"token constant\">G</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span>force<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">applyForce</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">force</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> f <span class=\"token operator\">=</span> force<span class=\"token punctuation\">.</span><span class=\"token function\">divideScalar</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Apply force to mover's acceleration</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Add acceleration to velocity</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>velocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Add velocity to position to move</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>acceleration<span class=\"token punctuation\">.</span><span class=\"token function\">multiplyScalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Reset acceleration</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Apply position to mover's mesh object</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>To summarize, every frame we traverse the <code class=\"language-text\">movers</code> list, calculate gravity between each <code class=\"language-text\">Movers</code>, apply acceleration, and actually move the <code class=\"language-text\">Mover</code>. The full source can be checked in the <a href=\"https://github.com/evan-moon/3d-gravity-test\" target=\"_blank\" rel=\"nofollow\">gravity test project GitHub repository</a>.</p>\n<p>That’s all for this post on implementing gravity with JavaScript.</p>","fields":{"slug":"20170506-gravity-via-js-2-en","path":"/2017/05/06/gravity-via-js-2/en/","lang":"en"},"frontmatter":{"title":"[Implementing Gravity with JavaScript] 2. Coding","subTitle":"Gravity Simulation Applying the Law of Universal Gravitation","date":"May 06, 2017","categories":["Programming","Graphics"],"tags":["Implementing Gravity","Gravity","JavaScript","WebGL","Math","ThreeJS","Tutorial"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/3a812/thumbnail.jpg 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/fc5c5/thumbnail.webp 320w,\n/static/6c72a52042fa8bad71e5e927ca2d86d6/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg","srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6c72a52042fa8bad71e5e927ca2d86d6/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"slug":"20170506-gravity-via-js-2","previous":{"fields":{"slug":"20170506-gravity-via-js-1","path":"/2017/05/06/gravity-via-js-1/","lang":"ko","postGroup":"20170506-gravity-via-js-1"},"frontmatter":{"title":"[JavaScript로 중력 구현하기] 1. 중력이란 무엇일까?"}},"next":{"fields":{"slug":"20170514-paypal-express-checkout","path":"/2017/05/14/paypal-express-checkout/","lang":"ko","postGroup":"20170514-paypal-express-checkout"},"frontmatter":{"title":"페이팔의 Express Checkout Restful API 사용하기"}},"lang":"ko","postGroup":"20170506-gravity-via-js-2"}},"staticQueryHashes":["3129619726","3523904809","376081736","650499039"],"slicesMap":{}}