{"componentChunkName":"component---src-templates-post-page-template-index-tsx","path":"/2019/07/10/javascript-audio-waveform/en/","result":{"data":{"markdownRemark":{"id":"f771a19c-3cac-50f8-b8e2-4a2e090c4809","tableOfContents":"<ul>\n<li>\n<p><a href=\"#what-is-sound\">What Is Sound?</a></p>\n<ul>\n<li><a href=\"#sound-is-an-analog-signal\">Sound Is an Analog Signal</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#how-computers-hear-sound\">How Computers Hear Sound</a></p>\n<ul>\n<li><a href=\"#sampling\">Sampling</a></li>\n<li><a href=\"#lets-look-at-sample-rate-in-more-detail\">Let’s Look at Sample Rate in More Detail</a></li>\n<li><a href=\"#bit-rate\">Bit Rate</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#drawing-waveforms-with-web-audio-api\">Drawing Waveforms with Web Audio API</a></p>\n<ul>\n<li><a href=\"#setting-up-the-basic-structure\">Setting Up the Basic Structure</a></li>\n<li><a href=\"#writing-the-audioanalyzer-class\">Writing the AudioAnalyzer Class</a></li>\n<li><a href=\"#setting-up-the-svg-viewbox\">Setting Up the SVG Viewbox</a></li>\n<li><a href=\"#checking-the-uploaded-audiobuffer\">Checking the Uploaded AudioBuffer</a></li>\n<li><a href=\"#analyzing-and-refining-audio-data\">Analyzing and Refining Audio Data</a></li>\n<li><a href=\"#lets-actually-draw-now\">Let’s Actually Draw Now!</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#music-please-dj\">Music Please, DJ</a></p>\n</li>\n</ul>","excerpt":"In this post, I want to tap into my memories from my former career as a sound engineer and explain some audio theory. But since just explaining theory is boring, I’ll also draw a simple audio waveform using JavaScript’s  API based on that audio theory. I want to jump straight into coding, but you n…","html":"<p>In this post, I want to tap into my memories from my former career as a sound engineer and explain some audio theory. But since just explaining theory is boring, I’ll also draw a simple audio waveform using JavaScript’s <code class=\"language-text\">Web Audio</code> API based on that audio theory.</p>\n<p>I want to jump straight into coding, but you need basic knowledge about audio to understand the process of drawing waveforms. So I’ll try to explain the theory in the least boring way possible. Theory is definitely less fun than coding, but these are things you need to know at minimum to draw audio waveforms, so let’s skim through it.</p>\n<h2 id=\"what-is-sound\" style=\"position:relative;\">What Is Sound?<a href=\"#what-is-sound\" aria-label=\"what is sound permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>First, let’s understand what sound is. If I had to describe sound in one word, it would be “vibration.” Basically, hearing sound happens in this order:</p>\n<hr>\n<ol>\n<li>Some object vibrates. Let’s say the vibration frequency is about <code class=\"language-text\">440Hz</code>.</li>\n<li>The medium around that object transmits the <code class=\"language-text\">440Hz</code> vibration (usually air in normal situations).</li>\n<li>When the medium transmits the vibration, our eardrum also vibrates at <code class=\"language-text\">440Hz</code>.</li>\n<li>The cochlea converts that vibration signal into electrical signals and sends them to the auditory nerve.</li>\n<li>The brain receives and interprets the signal. <code class=\"language-text\">440Hz</code> received!</li>\n</ol>\n<hr>\n<p>Here, we use the unit Hertz (Hz) to express how many times the object vibrated in one second in step 1. <code class=\"language-text\">10Hz</code> means it vibrated 10 times in one second, and <code class=\"language-text\">1kHz</code> means it vibrated 1,000 times in one second.</p>\n<p>By the way, <code class=\"language-text\">440Hz</code> in the example is the note “A” in do-re-mi-fa-sol-la-ti-do. So when we listen to music, we’re actually feeling vibrations — the vibration of strings for string instruments, the vibration of lips or reeds for wind instruments, and the vibration of vocal cords for singing. Even the most emotional music can be broken down like this in an engineer’s hands.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/eea4a/s-oche.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABA//EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAEW9SxqiZB//8QAGBABAQEBAQAAAAAAAAAAAAAAAQARIkH/2gAIAQEAAQUCtLxXA6b/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFX/8QAGRAAAwADAAAAAAAAAAAAAAAAARARACJB/9oACAEBAAY/AjahrgHK/wD/xAAZEAADAQEBAAAAAAAAAAAAAAAAAREhQZH/2gAIAQEAAT8h1PBElJpz6WXttU1HpBAxEr6f/9oADAMBAAIAAwAAABCTz//EABgRAQEAAwAAAAAAAAAAAAAAAAEAETFR/9oACAEDAQE/EBdWHt//xAAYEQEBAAMAAAAAAAAAAAAAAAABABEhUf/aAAgBAgEBPxAw7gcv/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFBUWGB/9oACAEBAAE/EGkFsbi9+sCRCWR5fnWtzeFiQ9YTYClkWuZiawJVwZgAaFP/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"s oche\" title=\"\" src=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/c08c5/s-oche.jpg\" srcset=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/0913d/s-oche.jpg 160w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/cb69c/s-oche.jpg 320w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/c08c5/s-oche.jpg 640w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/6a068/s-oche.jpg 960w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/eea4a/s-oche.jpg 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The beautiful melodies we hear are just bundles of vibration frequencies when you break them down.</small>\n</center>\n<p>These vibrations occur in nature, so they appear in analog form. Most macroscopic signals occurring in nature are analog — for example, changes in light brightness, wind intensity, or sound volume.</p>\n<h3 id=\"sound-is-an-analog-signal\" style=\"position:relative;\">Sound Is an Analog Signal<a href=\"#sound-is-an-analog-signal\" aria-label=\"sound is an analog signal permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Analog represents signals or data as continuous physical quantities. This “continuous physical quantities” sounds professional and difficult, but when you break it down, it’s really nothing special. The word we need to focus on here is not “physical quantities” but “continuous.”</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVR42m1S147CQBDb//8seANxQiAhSugCUjahi5rx2Qk6jsutlOxkqseOazabyIIAOJ1QOdcrkCTA41GN7XbAdltxu3G7XTTL4xjGQqPTzMqbzWy/h6Vp+Z3n5X25wLyHZRmMtT81fNyk1So6K4Dj8T3qdnsjYEM8n5/oFL/fKyhdt17Hns38ZoPteIyUUz2fbDaDXy7hWZzO58hkK0ZkosgTfZE3GiFcr7EOQyS8XYsIMyKIlDAYIKZTdtLvI+IQ2fFqhWQ4RKi8xQKeTSI2DklTOp1iSNq+Oh1MGg2uTEexsl5a+3wuReD0MmDvtWUfDgA5/BBOFLxyXK/XY/0DuUiVKBInikrifwsh8uWXUPK9RChiEogrS0BXq9UQkJOzkOlo+n+/kNBJNAnx92gjITfDN0lsZ7dzZK7fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"analog\" title=\"\" src=\"/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png\" srcset=\"/static/48485ab8c211172e1d85631ac91b57ce/69538/analog.png 160w,\n/static/48485ab8c211172e1d85631ac91b57ce/72799/analog.png 320w,\n/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png 605w\" sizes=\"(max-width: 605px) 100vw, 605px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The horizontal axis is time, the vertical axis is voltage. Analog signals have continuity that never ends no matter how much you divide them</small>\n</center>\n<p>So what does continuous mean?</p>\n<p>The representative example of continuity is numbers. Let’s imagine walking from <code class=\"language-text\">1</code> to <code class=\"language-text\">2</code>. How many numbers will we encounter while walking from <code class=\"language-text\">1</code> to <code class=\"language-text\">2</code>?</p>\n<p>First, at the halfway point between <code class=\"language-text\">1</code> and <code class=\"language-text\">2</code>, there’s <code class=\"language-text\">1.5</code>. There’s also half of that, <code class=\"language-text\">1.25</code>, and half of that, <code class=\"language-text\">1.125</code>.</p>\n<p>If we keep dividing numbers like this, we eventually realize this is a pointless exercise. Even if we divide down to <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>10</mn><mrow><mo>−</mo><mn>10000</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">10^{-10000}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">10000</span></span></span></span></span></span></span></span></span></span></span></span></span> units, we can keep dividing that number infinitely. We call this property continuity.</p>\n<h2 id=\"how-computers-hear-sound\" style=\"position:relative;\">How Computers Hear Sound<a href=\"#how-computers-hear-sound\" aria-label=\"how computers hear sound permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>But as you know, computers are dumb — they only understand <code class=\"language-text\">0</code> and <code class=\"language-text\">1</code>. We call this method digital. So computers that only know <code class=\"language-text\">0</code> and <code class=\"language-text\">1</code> cannot understand continuous analog signals.</p>\n<p>Then how can we make a computer hear sound, which is an analog form occurring in nature?</p>\n<p>Simple. We convert analog to digital. Once you understand the process of converting the analog signal of sound into something the computer can understand, you’ll know what the information that the <code class=\"language-text\">Web Audio</code> API gives us means. So let’s learn about the process of converting analog to digital.</p>\n<p>To convert analog to digital, we need to go through several steps. The values used in these steps determine the resolution of the digitally converted sound — in other words, the audio quality. The terms that come up here are Sample Rate and Bit Rate.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVR42lVRSY7CQBDL//+VAxcQEmQlezobWciCYE6ecmUYzRxKlbTdLrvaMqZCHCdI01Sr73uM46jVtB3iJEXg+2jbVnH2aZoUH4ZB+bfbDff7HV3XwTJVhSTNkCS7KAES58cDddPCD0LFeF4UxT/Bh3BYxPlPccsYo0JhGCKKIi1+13WNPM9xPB4FzyRFjCzbOwX8H9fzPOv9QQQ51OKly+UC13XheR6CIFBgXVed2Mil9/sLo7iis23bsCyLCtHV9XrVO6UY4wCLMQ6HA2zbxvl8RiUr0EhSpqpRliVWEVnXTQc4jqMu+37Yncl6CuH00tUho3HK6XTS5aYSa9/NLFMrIRd4vV6Y5OzzADRBDh+BvWka7b87pGXuhTEJMApdksDJ2/OpO6Ibxv3L+XQWX/kbanYF0WWvlT4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"encoder\" title=\"\" src=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png\" srcset=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/69538/encoder.png 160w,\n/static/5c4ef295d012e89f63bcd069e92fb4b5/72799/encoder.png 320w,\n/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png 439w\" sizes=\"(max-width: 439px) 100vw, 439px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Difficult words that make you not know what to adjust when using encoder programs</small>\n</center>\n<p>The terms look difficult, but they’re actually simple. Sound is essentially 2-dimensional vibration frequency data drawn in a space defined by time on the horizontal axis and amplitude on the vertical axis. The sample rate represents the horizontal axis resolution, and the bit rate represents the vertical axis resolution. These values are used in sampling, the first step of converting analog to digital.</p>\n<h3 id=\"sampling\" style=\"position:relative;\">Sampling<a href=\"#sampling\" aria-label=\"sampling permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Sampling is the first step to convert analog signals to digital signals. As explained above, sound as an analog signal is continuous, so computers cannot understand this signal as-is. When we record sound using a microphone, this analog signal is ultimately converted to electrical signals and given to the computer. When sound vibrations reach the device inside the microphone, this device converts them by raising and lowering voltage.</p>\n<p>But our dumb computer still can’t understand this electrical signal even after all this.</p>\n<p>So the computer uses a trick to measure continuous electrical signals by setting specific timings: “I’ll measure voltage at these timings!” Here’s what this trick looks like in a diagram:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAB2ElEQVR42mNgYGAQAGI+BghgZMAJ/sPkGP8zMIgBMSeQzQPVyw/ELHClbc6xwruN0/gZ8IDF0bl8S7yy5P8DDa53jRHzjWgVBwoLATGIFgZiJrDCK6te8qxwz3Bf5ZzmkV+/XwCbS0NX/eecG1prv8csyLEreaoeSMy+fj8L1BBmKA3Rszx1qtVNMTmlm3K6Sv1x3XZgz0El6xnqwbZOi+8x3msdpg8UF17oV+GyMKBCGFkdCrjokmIBlBAF4U0uaTa96dOlIYohYVafu5ivP67fDigvAcTiR0xC1SfGT7RAUsPEoOLBnjbzDCvYQGcpTUNtBgZ9QwYGPQdxVXN/26hwJyDbnJXVGKhL19/MP8BP3thRhYFBy4SV1dAASIcb+4W6K+ramgPVGTMwGPmLK/rqazu6AY1TgDmUJRQSFgxzfEost5kH6wFdI/KQn19palijI0P9fyak8GLIrlgnvMopwfUz0MUgl88MbbTP968XgHu7HqgYFh6LYrq55wZVu4C8t84p2awrbaYyzHv/IUkGHK4TY9sN9xp46x/Vc9UBWmqKHqZMyOHWnDlVdotthPfMwFrT/7jS5v//TEt9si3Xu6Q5A9ms6NKM6OxtHrl824CBzUAiAADz6odDaFdLSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sampling\" title=\"\" src=\"/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png\" srcset=\"/static/f62ba441843fe9172b18fc5498bd765d/69538/sampling.png 160w,\n/static/f62ba441843fe9172b18fc5498bd765d/72799/sampling.png 320w,\n/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png 640w,\n/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png 684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>The red dots in the diagram above are the timings when the computer measured voltage. The computer measures electrical signals at specific timings and stores those values. Looking at the red dot positions, this signal would have been measured as something like <code class=\"language-text\">[10, 20, 30, 27, 19, 8...]</code>.\nThe finer these red dots are — that is, the shorter the intervals at which the computer measures samples — the closer we can get to measuring the original signal.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/7497d/high-low-sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAD2EAAA9hAHVrK90AAABSklEQVR42qWSPU8CQRCG30M+D1HxO8BBPO8OLxfgDg7QihgTY0NpaWvhn6CyNf4GS2PlX7CytLU1xmhn1Ngxzi6biFeIkUmezOztzLsztwtE7ZBm0CIddcoCHE9lFqXQJRv+g43g2UKbHFjD1HcCafJAQKBNUOPExpuH8k2eFwlZ4Fwvy28DismUKuUQfBQ4mmfiqlAbQ50qLCQD7fd1NXcSuBRdxKRAj0o/cidaOjRQPN3lqMJsMDazqbyB8vke1k48jrm7ZJV9i2kydbmPhQoypeK4YhnJgsOBybhMh+mKvqXw7M4WCmd9ntTnta/EWDTRlPkrxwfI970/3pQac58W4b+KjjPcWHYEx+bFKrbJilZpvzMYXYr/YsO8UqLQkTtagnsfyGf2LxO3HX6aqN3V4N56aDx56Aznpnur4hf0KI3Wo84+Ht3+AqxFQxyT+4MwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"high low sampling\" title=\"\" src=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/6af66/high-low-sampling.png\" srcset=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/69538/high-low-sampling.png 160w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/72799/high-low-sampling.png 320w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/6af66/high-low-sampling.png 640w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/d9199/high-low-sampling.png 960w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/21b4d/high-low-sampling.png 1280w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/7497d/high-low-sampling.png 3500w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>The rectangle inside the signal is the shape of the signal as understood by the computer.</small>\n</center>\n<p>The interval at which signals are measured is called the sample rate, and the process of measuring signals itself is called sampling. Naturally, the higher the sample rate, the better the sound resolution — the audio quality. Especially the resolution of high-frequency sounds, meaning high notes, improves noticeably.</p>\n<p>Typically, CD audio quality has a sample rate of <code class=\"language-text\">44.1kHz</code>, and TV or radio broadcasts have <code class=\"language-text\">48kHz</code>. This means about 44,100 or 48,000 samples are measured per second. What criteria determine these sample rates?</p>\n<h3 id=\"lets-look-at-sample-rate-in-more-detail\" style=\"position:relative;\">Let’s Look at Sample Rate in More Detail<a href=\"#lets-look-at-sample-rate-in-more-detail\" aria-label=\"lets look at sample rate in more detail permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>As I just explained, CDs have a sample rate of <code class=\"language-text\">44.1kHz</code>. This means the audio on CDs is the result of a computer measuring analog signals 44,100 times per second.</p>\n<p>But the range of frequencies humans can hear — the audible frequency range — is only <code class=\"language-text\">20Hz ~ 20kHz</code>. So why are sample rates set much higher at <code class=\"language-text\">44.1kHz</code> or <code class=\"language-text\">48kHz</code>?</p>\n<blockquote>\n<p>Humans can only hear sounds that vibrate up to 20,000 times per second (20kHz), so even if we record sounds vibrating 44,100 times per second (44.1kHz), we can’t hear them anyway, right?</p>\n</blockquote>\n<p>The answer to this question becomes clear when you look at what a sound vibration cycle looks like.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54209060f49749e76b0ab4da633070e6/d9199/sine-wave.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVR42o2SWXLEIAxEuf91p0BqbaSFk8nkx46KKkuYp31kZlXtI+ZbNWD5c/Eg460BCbVyd1HFv/BxhfUondjhFb4NhmAKz7CZEVetVMLRPNoLlkf+I23iEOPnA46EyfKntLvaauAE3P4Nbzed+nqtJUuOrLXmnK2IUGG9Q4G5xFTfByIGQAWqUzzYAJzDXl6KGS/NsmumS7qgpUe62WRV3flqh7IilGFzqEzyJMhLaI66HQp/injZ6Qjh9sLWuEjQGuiK73hujkvP74KpuLr53yW5kY6DhkmmGc0rXKddT+uUXIRlrDTYxI/5j8/dvpFgs7gO4AL8Pv4CWb0B4j12ASIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sine wave\" title=\"\" src=\"/static/54209060f49749e76b0ab4da633070e6/6af66/sine-wave.png\" srcset=\"/static/54209060f49749e76b0ab4da633070e6/69538/sine-wave.png 160w,\n/static/54209060f49749e76b0ab4da633070e6/72799/sine-wave.png 320w,\n/static/54209060f49749e76b0ab4da633070e6/6af66/sine-wave.png 640w,\n/static/54209060f49749e76b0ab4da633070e6/d9199/sine-wave.png 960w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Audio frequencies are basically divided into individual cycles like this. The <code class=\"language-text\">+</code> part going up is where air compresses, and the <code class=\"language-text\">-</code> part going down is where air expands again.</p>\n<p>As I’ve been explaining, sound is vibration, and what we feel is the air trembling from that vibration. So we need to feel compression > expansion > compression to sense “it vibrated!” In other words, the 20,000 vibrations we can hear means this cycle repeats 20,000 times per second.</p>\n<p>You can’t feel “this is vibration” if you only continuously feel either compression or expansion alone.</p>\n<p>So to properly measure one cycle of an audio signal, you need to measure both the top peak in the + direction and the bottom peak in the - direction — at minimum 2 measurements are required. So to properly measure <code class=\"language-text\">20kHz</code>, the highest sound humans can hear at 20,000 vibrations per second, the computer must measure at least <code class=\"language-text\">20,000 * 2 = 40,000</code> times per second.</p>\n<p>This is exactly why CDs have a sample rate of <code class=\"language-text\">44.1kHz</code>. This is called the Nyquist Theorem. In short, the Nyquist theorem can be summarized as:</p>\n<blockquote>\n<p>You have an audio frequency you want to measure? If you want to capture the audio signal properly, you need to measure at least twice as fast as that frequency.</p>\n<p>So prepare a sample rate at least double the audio frequency you want to measure.</p>\n</blockquote>\n<p>But here another question arises. According to that theory, since the human audible frequency is <code class=\"language-text\">20,000Hz</code>, we should be able to record all sounds humans can hear with just 40,000 measurements. So why measure 44,100 or 48,000 times?</p>\n<p>Because nature doesn’t only have humans — there are friends like these too:</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f9e7d3854217d95b93299ec30c34597c/eea4a/dolphin.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABspui5kWX/8QAGBAAAgMAAAAAAAAAAAAAAAAAAhAAESL/2gAIAQEAAQUCIqmma//EABYRAAMAAAAAAAAAAAAAAAAAABARIf/aAAgBAwEBPwFQf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABwQAAICAgMAAAAAAAAAAAAAAAABETFBUWFxkf/aAAgBAQABPyHA9JSNdF8F2M1DRg//2gAMAwEAAgADAAAAEGvP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAwEBPxABwW3/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QV2f/xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMUFRYYHR/9oACAEBAAE/EKacN9PUGWE4OS+CJgtqtXqUMck+xVFIwyF6n//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dolphin\" title=\"\" src=\"/static/f9e7d3854217d95b93299ec30c34597c/c08c5/dolphin.jpg\" srcset=\"/static/f9e7d3854217d95b93299ec30c34597c/0913d/dolphin.jpg 160w,\n/static/f9e7d3854217d95b93299ec30c34597c/cb69c/dolphin.jpg 320w,\n/static/f9e7d3854217d95b93299ec30c34597c/c08c5/dolphin.jpg 640w,\n/static/f9e7d3854217d95b93299ec30c34597c/6a068/dolphin.jpg 960w,\n/static/f9e7d3854217d95b93299ec30c34597c/eea4a/dolphin.jpg 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Hello. I can emit sounds up to 150kHz.</small>\n</center>\n<p>There are actually much higher sounds in nature that we can’t hear. It’s just that we can only hear up to <code class=\"language-text\">20kHz</code>. Bats and dolphins make sounds in much higher frequency ranges, don’t they?</p>\n<p>So what happens if these sounds enter a container prepared with a <code class=\"language-text\">40kHz</code> sample rate? The computer was trying to measure voltage 40,000 times per second to properly measure sounds cycling 20,000 times per second. But what if a much higher frequency sound cycling 30,000 times per second comes in?</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABo0lEQVR42mVTW46jMBDk/odb7QHmY5REIcEYx28bMDXdDWwy2pZsisL9qjbd5XKBMQbjOEIphWlU0FoR1hgGXsRpDa3275oxrROrYRBfjnG73dBN0wS2jbdlQQsRNTeUClRa8wI03lIk0PDL+ECM2A7eWvsO2DYKWQImVXG/lj0JccynKWGJ5FyyJGaeg2wcrBS0nN8Buezdu2ENiRI2qUacJFNDi8QnevfhXd2ySnXgc2HnX68XOu5d4s0zks6Q4uNHe8SDqmD/MoVTHOGkZWZIJjbnHLp+6rFghvEWLjgUVORikatDPnAiPNOX71vA0yTBKdOZeT+TkkHdEganqOVHLznDGKjrdddorqTNoVcknuRgPKcCb4rg9sG3nIB1gbFUob5epfo17Hrg0I3S7jh+8isWG8H+MvXTVtajon/QUP7+eSJ5Jo4ApzMLzZmOCf4zCpR9RXHlI96G7y+SbaKhDPcBnHKjO/jL+J2r4+z/3b2AWprk4mPczFZWWJKve9AWvZMJ8fLey33ip6drYA9O+BMT78jHGE9/zO6XqPJn3+MHKHJYsi4mGRwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"nyquist error\" title=\"\" src=\"/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png\" srcset=\"/static/1c9dd2b354904b4b414af5ba807e5204/69538/nyquist-error.png 160w,\n/static/1c9dd2b354904b4b414af5ba807e5204/72799/nyquist-error.png 320w,\n/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png 572w\" sizes=\"(max-width: 572px) 100vw, 572px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<blockquote>\n<p>Answer: It starts plotting points in weird places.</p>\n</blockquote>\n<p>Looking at the diagram, the cycle of the incoming signal is shorter than the interval at which the computer plots points — the interval at which it measures voltage. So looking at the points the computer plotted, you can see they’re plotted at awkward places, not at the signal’s peaks. This is the trap that the Nyquist theorem has. And if you connect those awkwardly plotted points (the blue line), you can see it becomes a low frequency. What happens then?</p>\n<p>It becomes very audible to our ears. A truly spine-chilling moment! Nothing was audible when recording, but when listening to the recording, there’s a strange sound recorded. So this phenomenon is called “Ghost Frequency.”</p>\n<blockquote>\n<p>Then just crank up the sample rate! Wouldn’t properly recording high sounds solve the problem?</p>\n</blockquote>\n<p>But since this digital audio technology first started being used in the 1970s, hardware capacity couldn’t keep up with arbitrarily raising sample rates.</p>\n<p>So the method used to solve this problem was LPF (Low Pass Filter). This filter should be very familiar to those who’ve studied electronics — it literally only passes low frequencies through. If you use an LPF when recording audio to cut off all sounds higher than the human audible frequency and only let sounds in the human audible range pass through, the ghost frequency problem I just mentioned won’t occur.</p>\n<p>But analog signals don’t get cut cleanly like cutting radishes.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bcb489965646eb5446167bbddb504813/c1b63/cut-off.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQklEQVR42o1STY8hYRDuHQYzPnr1rm0d7aNFxmDGmPVtkT0gEb9BIiGcCIk4uDiKiIOjxMWJiASJCAdxc/ILHOeP2CrRSU/PJLNv8qSrq+p53qp6i1itVublcskJsdvtzKPR6CGZTHoIgrAyDPOIQDuVSr1gDHPEPNQi9vu9QojT6SQfDAb3JpPJazab9SAirVQqdD6fp8C+5TiOxli321VirphPiM6365cF0LxzvV5rDofDnSDvF8Ao4nx6+KANoOSdcLNKdLvymsNzEBKAjKjX6/pqtcoI4XA4gtls1oQxaJXudDr2drttxdYxXigUWLfbHSyVSoZms8nAXHEcPwAeotVqyXhAFVKv10tC8uv5fJaWy2U5+KXT6ZTq9/satNEHsRuXy/USjUa1yIG45FrlzYeeaZpWhsPhV+EIRDO8kCKRiMdut6uJr45Op1NBsk9IXiwW6l6v904wHo/7A4GA5r8Eg8GgV1ghtESKKwyFQr9tNpvmyxcmSfK7z+eLwCxv4ZcBuKE1n16v94ONo9Dhbvr9/jAI6j5bHeGzE1qt1ggCf0HYIpfLLeB6hhNiWRYFnxUKhQm+JtiEOMybu2pIBDrvK5TJZA+1Ws0gDIj28JLXaDRYiqIcHyqEKvAWK6zKUyaTSeRyuQi8qhPmxs1mM/N8PjdOJpMn+Lejjb7xeGzZbDaPsKN/0ul0ErmocdFyOp0qRCKRIKEy6ng83sOjWIbDoXq73Srf3t7u4CJDsVj8iTb6MBaLxTjMRQ5yeZ1/c43gleg9ctcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cut off\" title=\"\" src=\"/static/bcb489965646eb5446167bbddb504813/6af66/cut-off.png\" srcset=\"/static/bcb489965646eb5446167bbddb504813/69538/cut-off.png 160w,\n/static/bcb489965646eb5446167bbddb504813/72799/cut-off.png 320w,\n/static/bcb489965646eb5446167bbddb504813/6af66/cut-off.png 640w,\n/static/bcb489965646eb5446167bbddb504813/d9199/cut-off.png 960w,\n/static/bcb489965646eb5446167bbddb504813/c1b63/cut-off.png 1200w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Even with an LPF, the cut portion slopes down diagonally, leaving some less-than-ideal parts. The point where it starts dropping below the allowable range of <code class=\"language-text\">-3dB</code> shown in the diagram is called the Cut Off. We’re saying we’ll consider the signal cut from there.</p>\n<p>You might think, “What if we lower the Cut Off point a bit below <code class=\"language-text\">20kHz</code> to make signals disappear around <code class=\"language-text\">20kHz</code>?” But apparently they decided it was too wasteful not to utilize the full <code class=\"language-text\">20kHz</code> frequency range because of that problem.</p>\n<p>So they agreed to set the Cut Off exactly at <code class=\"language-text\">20kHz</code> and just accept the remaining portion. With the technology at the time, they reduced and reduced that remaining portion until it was exactly <code class=\"language-text\">2,050Hz</code>.</p>\n<p>Now if we add the remaining portion and audible frequency, we get <code class=\"language-text\">22,050Hz</code>. According to the Nyquist theorem, we need to prepare at least double the sample rate to properly measure this signal, so the standard sample rate for CDs became <code class=\"language-text\">44,100Hz = 44.1kHz</code>.\nThere were various other issues that always arise when setting international standards — technical limitations at the time, companies fighting each other, adult matters, etc. — but this was the representative technical reason.</p>\n<p>After that, higher sample rates like <code class=\"language-text\">48kHz</code>, <code class=\"language-text\">96kHz</code>, <code class=\"language-text\">192kHz</code> just increased as devices advanced and technical limitations disappeared. “Higher sample rate is better! Let’s pump it up!”</p>\n<h3 id=\"bit-rate\" style=\"position:relative;\">Bit Rate<a href=\"#bit-rate\" aria-label=\"bit rate permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Bit rate is super simple compared to sampling. Especially since it has “Bit” in the name, which we developers are familiar with, right? If sample rate is the horizontal resolution of sound, bit rate is the vertical resolution.</p>\n<p>Like sample rate, bit rate is also commonly explained based on CDs, so I’ll explain based on CDs again.</p>\n<p>CD bit rate is <code class=\"language-text\">16bit</code>, which literally means it can express values corresponding to <code class=\"language-text\">16 bits</code> vertically. When we did sampling earlier as explained above, we measured voltage. The bit rate determines how finely the computer can express these measured voltage values. <code class=\"language-text\">16bit</code> means we can use 16-digit binary, and since <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>=</mo><mn>65536</mn></mrow><annotation encoding=\"application/x-tex\">2^{16} = 65536</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">16</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">65536</span></span></span></span></span>, we can use a total of 65,537 values from 0 to 65,536.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b1bb1c1aa17f6cf158141942536a758f/f2239/bitrate.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAD2EAAA9hAHVrK90AAABdUlEQVR42o2S20oCURSGf8dDaTNqGo4zlqZJgXfVRVcWSRCkIlSSZUJhWCoeShANKQIpCrrqEXqHeoAezP45BBFFLvhYh2HW3v9aGwAmiVv3sY8wlLscvPtFhO53sPQ+z7qdzBAvDLPgH/PohF8TmD6sQrBdMD9nnxJ8+RbibwvMgySA25GA5VEc4oZ2gPRXQxHhoQL/WZ3xMSkDQpU+T9+A2i/AW4swl4GRBbPPTiDhYG4jArF+Q8v5QX3MwKZeMd4lp0ZT6x59BfZQBcpTDoj8lGz5Xb5NScK50mLU5gEV+gbpG7IFrV6DlGrDk+4wLrB2YiqpmxT13B6oYCKyaUg2FuM0cRny9PpXTYK/XIVjrseYCF16bSwDxk36DqT0EGIqgTHNBU82CvXmgJKa5pxLpoIjTK1eIviwbl5iHPNpzyqE6Msi3NlrYxza0jgOR6wFmYuDom3eP+4NtYZx/Qe5s6Y/L3GrB3G7C3WQgSup6AcC8id2pjciNdJZ2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bitrate\" title=\"\" src=\"/static/b1bb1c1aa17f6cf158141942536a758f/6af66/bitrate.png\" srcset=\"/static/b1bb1c1aa17f6cf158141942536a758f/69538/bitrate.png 160w,\n/static/b1bb1c1aa17f6cf158141942536a758f/72799/bitrate.png 320w,\n/static/b1bb1c1aa17f6cf158141942536a758f/6af66/bitrate.png 640w,\n/static/b1bb1c1aa17f6cf158141942536a758f/d9199/bitrate.png 960w,\n/static/b1bb1c1aa17f6cf158141942536a758f/21b4d/bitrate.png 1280w,\n/static/b1bb1c1aa17f6cf158141942536a758f/f2239/bitrate.png 3116w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    You can see that as bit rate increases, the bars inside the analog signal are filled in more meticulously.<br>\n    Since it's signed counting bits for both + and -, only 50% each is shown in the diagram.\n  </small>\n</center>\n<p>Of course, the voltage values converted from analog sound signals won’t be nice round integers like <code class=\"language-text\">123</code>, so we find an approximate value among our available <code class=\"language-text\">0-65536</code> range and convert to it. This process is called quantization. <small>(Yes, it’s the same “quantum” as in quantum mechanics.)</small></p>\n<p>The process of then converting the voltage values changed to <code class=\"language-text\">0-65536</code> into binary that computers can understand is called coding.</p>\n<p>Since these are familiar problems for us developers, I’ll just explain this much and move on.</p>\n<h2 id=\"drawing-waveforms-with-web-audio-api\" style=\"position:relative;\">Drawing Waveforms with Web Audio API<a href=\"#drawing-waveforms-with-web-audio-api\" aria-label=\"drawing waveforms with web audio api permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Finally, the long audio theory is over. Since my goal is to draw waveforms using digitally converted audio, I only covered the analog to digital conversion process. I won’t cover the reverse process of digital to analog conversion in this post. But that’s also quite interesting, so I highly recommend looking it up separately. I’ll upload an audio file, analyze it with the <code class=\"language-text\">Web Audio</code> API to extract the needed data, and draw the waveform using <code class=\"language-text\">svg</code> elements.</p>\n<p>For reference, the project was set up super simply using <code class=\"language-text\">webpack4</code> and <code class=\"language-text\">babel7</code>. You can check the detailed code in the <a href=\"https://github.com/evan-moon/simple-waveform-visualizer\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>.</p>\n<h3 id=\"setting-up-the-basic-structure\" style=\"position:relative;\">Setting Up the Basic Structure<a href=\"#setting-up-the-basic-structure\" aria-label=\"setting up the basic structure permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Let’s start by writing simple HTML.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>audio-uploader<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>waveform<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">preserveAspectRatio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>none<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>waveform-path-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>That’s it for HTML. We just need one <code class=\"language-text\">input</code> element to upload audio files and one <code class=\"language-text\">svg</code> element to draw the waveform. Since this is for testing purposes and UI isn’t important, I focused on functionality. <small>(That’s how I’ll spin it.)</small></p>\n<p>Now let’s write an event handler that will execute when a file is uploaded.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputDOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio-uploader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  inputDOM<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>currentTarget<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsArrayBuffer</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">FileReader.prototype.readAsArrayBuffer</code> method doesn’t return binary files all at once but returns them in chunk units. It’s commonly used when uploading files to servers and such.</p>\n<p>Normally we’d need to write separate logic to handle this <code class=\"language-text\">ArrayBuffer</code>, but since the <code class=\"language-text\">Web Audio</code> API we’ll use internally handles <code class=\"language-text\">ArrayBuffer</code> for us, we don’t need to worry.</p>\n<h3 id=\"writing-the-audioanalyzer-class\" style=\"position:relative;\">Writing the AudioAnalyzer Class<a href=\"#writing-the-audioanalyzer-class\" aria-label=\"writing the audioanalyzer class permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Now it’s time to actually use the <code class=\"language-text\">Web Audio</code> API. I created a separate singleton class called <code class=\"language-text\">AudioAnalyzer</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// lib/AudioAnalyzer.js</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AudioAnalyzer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>AudioContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> errorMsg <span class=\"token operator\">=</span> <span class=\"token string\">'Web Audio API not supported'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>errorMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>errorMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>AudioContext <span class=\"token operator\">||</span> webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormBox <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waveform'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormPathGroup <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waveform-path-group'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">reset</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>AudioContext <span class=\"token operator\">||</span> webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioAnalyzer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"setting-up-the-svg-viewbox\" style=\"position:relative;\">Setting Up the SVG Viewbox<a href=\"#setting-up-the-svg-viewbox\" aria-label=\"setting up the svg viewbox permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>After setting up this basic structure, I’ll declare a method to set the viewbox of the <code class=\"language-text\">svg</code> element where audio waveforms will be drawn. Since the length of incoming data varies greatly depending on sample rate, we need to dynamically change the viewbox <code class=\"language-text\">width</code> to match the audio data size so we can draw all signals to fit exactly in the viewbox.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">updateViewboxSize</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormBox<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewBox'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">0 -1 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">viewBox</code> attribute of <code class=\"language-text\">svg</code> elements means <code class=\"language-text\">min-x</code>, <code class=\"language-text\">min-y</code>, <code class=\"language-text\">width</code>, <code class=\"language-text\">height</code> from the front. As I mentioned when explaining bit rate, audio signals are signed, so we need to set the viewbox starting at <code class=\"language-text\">0, -1</code> instead of <code class=\"language-text\">0, 0</code>. The <code class=\"language-text\">width</code> is set to the audio’s sample rate so the audio signal fills from start to end of the viewbox, and <code class=\"language-text\">height</code> is set to <code class=\"language-text\">2</code> since we need to cover <code class=\"language-text\">-1 ~ 1</code>.</p>\n<p>I appropriately added this <code class=\"language-text\">updateViewboxSize</code> method to the <code class=\"language-text\">constructor</code> and <code class=\"language-text\">reset</code> methods so the viewbox size is also initialized when the application initializes.</p>\n<h3 id=\"checking-the-uploaded-audiobuffer\" style=\"position:relative;\">Checking the Uploaded AudioBuffer<a href=\"#checking-the-uploaded-audiobuffer\" aria-label=\"checking the uploaded audiobuffer permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Now we just need to declare a cute setter that decodes audio files uploaded through the <code class=\"language-text\">input</code> element.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">setAudio</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">audioFile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">decodeAudioData</span><span class=\"token punctuation\">(</span>audioFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">AudioContext.prototype.decodeAudioData</code> method receives an <code class=\"language-text\">ArrayBuffer</code> and converts it to an <code class=\"language-text\">AudioBuffer</code>. As I explained above, since the <code class=\"language-text\">ArrayBuffer</code> returned by the <code class=\"language-text\">readAsArrayBuffer</code> method doesn’t load all binary data at once but loads in chunk units, <code class=\"language-text\">decodeAudioData</code> also doesn’t do the conversion synchronously. So when using this method, you need to use callback functions or <code class=\"language-text\">Promise</code>.</p>\n<p>Now let’s change it so that when a file is uploaded, it passes the audio file to <code class=\"language-text\">AudioAnalyzer</code> so we can see how audio files are actually converted.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span> AudioAnalyzer <span class=\"token keyword\">from</span> <span class=\"token string\">'./lib/AudioAnalyzer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputDOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio-uploader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  inputDOM<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>currentTarget<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Initialize AudioAnalyzer</span>\n      AudioAnalyzer<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Pass the file data to AudioAnalyzer</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> AudioAnalyzer<span class=\"token punctuation\">.</span><span class=\"token function\">setAudio</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsArrayBuffer</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>At this point, I think we don’t need to write anything more in the main function. Now we just play with <code class=\"language-text\">AudioAnalyzer</code>. To check what data comes out, I uploaded an mp3 file of a song I like.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">AudioBuffer <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">length</span><span class=\"token operator\">:</span> <span class=\"token number\">12225071</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">277.2124943310658</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">sampleRate</span><span class=\"token operator\">:</span> <span class=\"token number\">44100</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">numberOfChannels</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then <code class=\"language-text\">decodeAudioData</code> executed inside <code class=\"language-text\">AudioAnalyzer</code>’s <code class=\"language-text\">setAudio</code> method receives the <code class=\"language-text\">ArrayBuffer</code>, converts it to <code class=\"language-text\">AudioBuffer</code>, and returns it. Breaking this down reveals useful information.</p>\n<hr>\n<ul>\n<li><code class=\"language-text\">sampleRate</code>: Obviously means sample rate — this song’s sample rate is <code class=\"language-text\">44,100Hz</code>.</li>\n<li><code class=\"language-text\">numberOfChannels</code>: Indicates how many channels this audio has — this file is a stereo channel audio file with two channels.</li>\n<li><code class=\"language-text\">length</code>: Means the number of peaks. Peaks are the voltage values the computer measured during sampling.</li>\n<li><code class=\"language-text\">duration</code>: Shows this audio file’s playback length in seconds. This song is about 277 seconds long.</li>\n</ul>\n<hr>\n<p>Hmm, something to decide here. When audio data with <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> channels comes in, we need to either express the waveforms of all <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> channels or merge channels into one and express the waveform. I plan to merge all channels into one even when audio data with <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span> channels comes in.</p>\n<p>But explaining channel merging in this post would make things too complicated, so I’ll just proceed using one channel.</p>\n<h3 id=\"analyzing-and-refining-audio-data\" style=\"position:relative;\">Analyzing and Refining Audio Data<a href=\"#analyzing-and-refining-audio-data\" aria-label=\"analyzing and refining audio data permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Now I’ve obtained the basic audio data, <code class=\"language-text\">AudioBuffer</code>. With just this data, I can draw audio waveforms.\nLet’s extract only the needed data from <code class=\"language-text\">AudioBuffer</code> and assign them to class member variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">setAudio</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">audioFile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">decodeAudioData</span><span class=\"token punctuation\">(</span>audioFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Assign AudioBuffer object to member variable</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Assign uploaded audio's sample rate to member variable</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Adjust svg element size according to sample rate</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateViewboxSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Phew, if we’ve come this far, we’re all ready to draw waveforms. First, let’s extract audio signals one by one from <code class=\"language-text\">AudioBuffer</code>.</p>\n<p>Let’s first look at the array containing audio signals. When I briefly looked at the <code class=\"language-text\">AudioBuffer</code> data earlier, there was a property called <code class=\"language-text\">numberOfChannels</code> with value <code class=\"language-text\">2</code> for <code class=\"language-text\">stereo</code> channels. This channel data can be obtained through the <code class=\"language-text\">AudioBuffer.getChannelData</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span>numberOfChannels<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelData</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Float32Array(12225071) [0, 0, 0, …]</span>\n<span class=\"token comment\">// Float32Array(12225071) [0, 0, 0, …]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Wow, a massive <code class=\"language-text\">Float32Array</code> appeared. All the values I see now are <code class=\"language-text\">0</code>, but that’s because music usually doesn’t start with a BANG! — the elements at later indices have proper values. But we can’t use these values as-is; we need to refine them a bit.</p>\n<p>First, let’s think about what those elements in the array actually are. Using the array length <code class=\"language-text\">12225071</code>, we can figure out what this friend is. When we looked at this song’s playback duration through <code class=\"language-text\">AudioBuffer</code> earlier, it was about 277 seconds. Multiplying this song’s sample rate by playback duration gives <code class=\"language-text\">12225071</code>. In other words, those elements are the peaks — the voltages the computer measured according to the sample rate.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAB2ElEQVR42mNgYGAQAGI+BghgZMAJ/sPkGP8zMIgBMSeQzQPVyw/ELHClbc6xwruN0/gZ8IDF0bl8S7yy5P8DDa53jRHzjWgVBwoLATGIFgZiJrDCK6te8qxwz3Bf5ZzmkV+/XwCbS0NX/eecG1prv8csyLEreaoeSMy+fj8L1BBmKA3Rszx1qtVNMTmlm3K6Sv1x3XZgz0El6xnqwbZOi+8x3msdpg8UF17oV+GyMKBCGFkdCrjokmIBlBAF4U0uaTa96dOlIYohYVafu5ivP67fDigvAcTiR0xC1SfGT7RAUsPEoOLBnjbzDCvYQGcpTUNtBgZ9QwYGPQdxVXN/26hwJyDbnJXVGKhL19/MP8BP3thRhYFBy4SV1dAASIcb+4W6K+ramgPVGTMwGPmLK/rqazu6AY1TgDmUJRQSFgxzfEost5kH6wFdI/KQn19palijI0P9fyak8GLIrlgnvMopwfUz0MUgl88MbbTP968XgHu7HqgYFh6LYrq55wZVu4C8t84p2awrbaYyzHv/IUkGHK4TY9sN9xp46x/Vc9UBWmqKHqZMyOHWnDlVdotthPfMwFrT/7jS5v//TEt9si3Xu6Q5A9ms6NKM6OxtHrl824CBzUAiAADz6odDaFdLSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sampling\" title=\"\" src=\"/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png\" srcset=\"/static/f62ba441843fe9172b18fc5498bd765d/69538/sampling.png 160w,\n/static/f62ba441843fe9172b18fc5498bd765d/72799/sampling.png 320w,\n/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png 640w,\n/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png 684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Each of those peaks is stored as an element in the Float32Array.</small>\n</center>\n<p>Now that we know those elements are peaks, let’s refine these friends a bit. Why refine?</p>\n<blockquote>\n<p>Is rendering all 12,225,071 peaks really efficient visualization…?</p>\n</blockquote>\n<p>A reasonable suspicion. Whether ten million or five million peaks are plotted, we’re going to view it on a small monitor anyway, so expressing every single one doesn’t really have much meaning.</p>\n<p>So I’ll compress the peaks appropriately. Instead of collecting all peaks, I’ll create samples of appropriate length and collect only the maximum and minimum values within each sample.</p>\n<p>As explained above, according to the Nyquist theorem, we only need one maximum and one minimum to express one cycle, so there’s no problem.</p>\n<p>If my application had a waveform zoom feature, I’d need to dynamically select peaks according to how many are needed for rendering when zoom in/out events occur. But this application isn’t that sophisticated, so logic that refines only a fixed number of peaks is sufficient.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> sampleSize <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> sampleStep <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>sampleSize <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Getting only channel 0 as an example</span>\n<span class=\"token keyword\">const</span> peaks <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> resultsPeaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// We'll collect exactly 44,100 peaks, the sample rate length</span>\n<span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> newPeakIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>newPeakIndex <span class=\"token operator\">*</span> sampleSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> end <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>newPeakIndex <span class=\"token operator\">+</span> sampleSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> min <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> sampleIndex <span class=\"token operator\">=</span> start<span class=\"token punctuation\">;</span> sampleIndex <span class=\"token operator\">&lt;</span> end<span class=\"token punctuation\">;</span> sampleIndex <span class=\"token operator\">+=</span> sampleStep<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> v <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span>sampleIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">></span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      max <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">&lt;</span> min<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      min <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  resultPeaks<span class=\"token punctuation\">[</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> newPeakIndex<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> max<span class=\"token punctuation\">;</span>\n  resultPeaks<span class=\"token punctuation\">[</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> newPeakIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> min<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>It looks complicated, but in one sentence:</p>\n<blockquote>\n<ol>\n<li>Iterate for the sample rate count.</li>\n<li>Define a secondary sample section of appropriate length and find max and min within that section.</li>\n<li>Insert max at even indices and min at odd indices in the resultPeaks array.</li>\n</ol>\n</blockquote>\n<p>The reason we double the array size with <code class=\"language-text\">2 * newPeakIndex</code> when storing values in <code class=\"language-text\">resultsPeaks</code> is because we need to store up to 2 values, <code class=\"language-text\">max</code> and <code class=\"language-text\">min</code>, in each iteration.</p>\n<p>This way, I got one appropriately compressed peak array of length <code class=\"language-text\">88,200</code>.</p>\n<h3 id=\"lets-actually-draw-now\" style=\"position:relative;\">Let’s Actually Draw Now!<a href=\"#lets-actually-draw-now\" aria-label=\"lets actually draw now permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The drawing method is simpler than you’d think. We just iterate through the peak array we extracted and draw.</p>\n<p>SVG’s <code class=\"language-text\">path</code> element analyzes the string in the <code class=\"language-text\">d</code> attribute to draw lines. Here, <code class=\"language-text\">M</code> is Move, a command to move the pointer that draws; and <code class=\"language-text\">L</code> is Line, a command to draw a line to the specified location.</p>\n<p>So we just need to repeat moving the pointer and drawing lines. This is exactly why I stored max values at even indices and min values at odd indices earlier. I intended to use the <code class=\"language-text\">M</code> command to move the pointer at even indices and the <code class=\"language-text\">L</code> command to draw lines at odd indices while iterating.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">draw</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> peaks <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> totalPeaks <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> peakIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> peakIndex <span class=\"token operator\">&lt;</span> totalPeaks<span class=\"token punctuation\">;</span> peakIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        d <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> M</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>peaks<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        d <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> L</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>peaks<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElementNS</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://www.w3.org/2000/svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributeNS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormPathGroup<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">Math.floor(peakNumber / 2)</code> is the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span> axis, <code class=\"language-text\">peaks.shift()</code> is the <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span> axis. This code will work roughly like this. Think of the numbers in front as peak indices.</p>\n<blockquote>\n<ol>\n<li>Move pointer to (0, 100)</li>\n<li>Draw line to (0, -25)</li>\n<li>Move pointer to (1, 300)</li>\n<li>Draw line to (1, -450)</li>\n<li>Keep repeating</li>\n</ol>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/2bef9/svg-graph.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVR42q1Ui3KDMAzj/792KwTIy56kBFq6lrG7cpdzcCxZdgyDf/gZrgTZ4cWuEdZatQwA7WHNus3Za0oifo7b7HtC7kFgJGAwFcXotq7tDPZ/hFS0zG4RBPRhL8LYCadRpH8TkgiqPAEMkNGCrIap+aQQ4GnywnNimASY+tDXndBKFUhqALoTBvecepKkBGUOra84Uxz2O2FCUAgAIqgweFk83769rLB4z+OI/Qrfl2eejTdP8GUkS4yjryt+UljaRVBN2BQuLxQycVNWw72Slz1UH0ncwSpZ5SVdxqHk2AlZOjDnt4xylZm+uStEqSLEYmva2fz+Ug5zSLuNBMmhgOMjNfDtt6wW5XNCf5ivbf36iuKFOTz/mO2yf/j03+YHjbqjJKikfkgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"svg graph\" title=\"\" src=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/6af66/svg-graph.png\" srcset=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/69538/svg-graph.png 160w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/72799/svg-graph.png 320w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/6af66/svg-graph.png 640w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/d9199/svg-graph.png 960w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/2bef9/svg-graph.png 1024w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Repeating that process draws bars roughly like this</small>\n</center>\n<p>The audio waveform we’re trying to draw represents digital signals, so it cannot be expressed as continuous analog like the audio signal examples we saw above. So we have to express it by drawing bars like this. It might look like a pretty shabby drawing, but when 88,200 of those lines overlap, it looks pretty convincing.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/3c1e5/two-dimension.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3klEQVR42k2Pu0pDYRCEzxv6CPoAFmITFEQtUhhELSyCoHiBFFGCl0RiMELUKMGgNtqoiI9g4eWQnf38f3LkZGDYYXdY+BKC3MnluePelWeFLBt6kEL6BZaO9IKS955zvy9eL53nM+ehJvoV0d0UrSXRXhG9PdFZF6eLxsmccTRjVCeNnXGjVRJ3od9eFR99J3npiNtt8dR0HmvD482WuFgTx7NGY8G4KovzZXFYMA6mg6eM3QmjPGbU543rDdEsirdueOgZzigmGUJ0xPxH8og7yJB/4PszzN+8G5H/AOW3I13BHvjUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"two dimension\" title=\"\" src=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/6af66/two-dimension.png\" srcset=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/69538/two-dimension.png 160w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/72799/two-dimension.png 320w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/6af66/two-dimension.png 640w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/d9199/two-dimension.png 960w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/21b4d/two-dimension.png 1280w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/3c1e5/two-dimension.png 2854w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Even bars become art when drawn well</small>\n</center>\n<p>So, we’ve simply drawn an audio waveform. Now that we’ve done all this… actually there’s a library called <a href=\"https://github.com/katspaugh/wavesurfer.js\" target=\"_blank\" rel=\"nofollow\">WaveSurfer</a> that does this. It has more features too.</p>\n<p>I just wanted to try drawing it myself with my own hands.</p>\n<h2 id=\"music-please-dj\" style=\"position:relative;\">Music Please, DJ<a href=\"#music-please-dj\" aria-label=\"music please dj permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Just drawing waveforms feels a bit lacking, so let’s make one more method as an interlude. It’s the feature to play this music.\nOriginally my intention when making this method was “let’s at least listen to some music while making this,” but I listened to the same song so many times while making it that I got a bit tired of it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">play</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sourceBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">createBufferSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span>buffer <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">AudioContext.prototype.createBufferSource</code> method creates one of the <code class=\"language-text\">AudioNode</code>s called <code class=\"language-text\">AudioBufferSourceNode</code>. When we pass the <code class=\"language-text\">AudioBuffer</code> we’ve been playing with to this <code class=\"language-text\">AudioNode</code>, it helps us do real audio control… it’s kind of like a shell.</p>\n<p>The <code class=\"language-text\">Web Audio</code> API provides functionality to modulate sounds by connecting these <code class=\"language-text\">AudioNode</code>s together, so you can use this to make audio effectors like compressors or reverbs. Next time, I should aim to make an audio effector.</p>\n<p>You can check the completed sample source in my <a href=\"https://github.com/evan-moon/simple-waveform-visualizer\" target=\"_blank\" rel=\"nofollow\">GitHub repository</a>, and the live demo <a href=\"https://simple-audio-waveform.herokuapp.com/\" target=\"_blank\" rel=\"nofollow\">here</a>.</p>\n<p>That wraps up this post on how computers hear sound.</p>","fields":{"slug":"20190710-javascript-audio-waveform-en","path":"/2019/07/10/javascript-audio-waveform/en/","lang":"en"},"frontmatter":{"title":"How Do Computers Hear Sound?","subTitle":"Understanding digital audio conversion through sampling, bit rate, and Web Audio API","date":"Jul 10, 2019","categories":["Programming","Audio"],"tags":["Sound Engineering","Nyquist","Logic Pro X","Cubase","Analog to Digital","AD Convert","Digital to Analog","DA Convert","Sampling","Sample Rate","AudioContext","Bit Rate","JavaScript Audio API"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6cd3149c200b28430bab8288d044aa4c/3a812/thumbnail.jpg","srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/3a812/thumbnail.jpg 320w,\n/static/6cd3149c200b28430bab8288d044aa4c/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/fc5c5/thumbnail.webp 320w,\n/static/6cd3149c200b28430bab8288d044aa4c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6cd3149c200b28430bab8288d044aa4c/2d839/thumbnail.jpg","srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}},"allMarkdownRemark":{"edges":[{"node":{"id":"c8fea967-1739-5b9a-b413-e3ad5ce694d0","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%86%8C%EB%A6%AC%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C\">소리란 무엇일까?</a></p>\n<ul>\n<li><a href=\"#%EC%86%8C%EB%A6%AC%EB%8A%94-%EC%95%84%EB%82%A0%EB%A1%9C%EA%B7%B8-%EC%8B%A0%ED%98%B8%EB%8B%A4\">소리는 아날로그 신호다</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B0%80-%EC%86%8C%EB%A6%AC%EB%A5%BC-%EB%93%A3%EB%8A%94-%EB%B0%A9%EB%B2%95\">컴퓨터가 소리를 듣는 방법</a></p>\n<ul>\n<li><a href=\"#%EC%83%98%ED%94%8C%EB%A7%81sampling\">샘플링(Sampling)</a></li>\n<li><a href=\"#%EC%83%98%ED%94%8C-%EB%A0%88%EC%9D%B4%ED%8A%B8sample-rate%EB%A5%BC-%EC%A2%80-%EB%8D%94-%EC%9E%90%EC%84%B8%ED%9E%88-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90\">샘플 레이트(Sample Rate)를 좀 더 자세히 알아보자</a></li>\n<li><a href=\"#%EB%B9%84%ED%8A%B8-%EB%A0%88%EC%9D%B4%ED%8A%B8bit-rate\">비트 레이트(Bit Rate)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#web-audio-api%EB%A1%9C-%ED%8C%8C%ED%98%95-%EA%B7%B8%EB%A0%A4%EB%B3%B4%EA%B8%B0\">Web Audio API로 파형 그려보기</a></p>\n<ul>\n<li><a href=\"#%EA%B8%B0%EB%B3%B8-%ED%8B%80-%EC%9E%A1%EA%B8%B0\">기본 틀 잡기</a></li>\n<li><a href=\"#audioanalyzer-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%9E%91%EC%84%B1\">AudioAnalyzer 클래스 작성</a></li>\n<li><a href=\"#svg-%EB%B7%B0%EB%B0%95%EC%8A%A4%EB%A5%BC-%EC%84%A4%EC%A0%95%ED%95%98%EC%9E%90\">SVG 뷰박스를 설정하자</a></li>\n<li><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C%EB%90%9C-audiobuffer-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">업로드된 AudioBuffer 확인하기</a></li>\n<li><a href=\"#%EC%98%A4%EB%94%94%EC%98%A4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D%ED%95%98%EA%B3%A0-%EC%A0%95%EC%A0%9C%ED%95%98%EA%B8%B0\">오디오 데이터 분석하고 정제하기</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%9C-%EC%A7%84%EC%A7%9C-%EA%B7%B8%EB%A0%A4%EB%B3%B4%EC%9E%90\">이제 진짜 그려보자!</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%9D%8C%EC%95%85-%EC%A3%BC%EC%84%B8%EC%9A%94-dj\">음악 주세요 DJ</a></p>\n</li>\n</ul>","excerpt":"이번 포스팅에서는 필자의 예전 직업이었던 사운드 엔지니어의 추억을 살려서 한번 오디오에 대한 이론을 설명해볼까 한다. 하지만 이론 설명만 하면 노잼이니까 오디오 이론을 기초로 자바스크립트의  API를 사용하여 간단한 오디오 파형까지 그려보려고 한다. 바로 코딩에 들어가고 싶지만 오디오에 관한 기본적인 지식이 있어야 오디오 파형을 그릴 때의 과정을 이해할 수 있으므로 이론을 최대한 지루하지 않게 설명하려고 한다. 이론이 코딩보다 재미없는 건 맞지만 오디오 파형을 그리려면 최소한 기본적으로 알고 있어야 하는 것들이니까 한번 쓱 흝어보…","html":"<p>이번 포스팅에서는 필자의 예전 직업이었던 사운드 엔지니어의 추억을 살려서 한번 오디오에 대한 이론을 설명해볼까 한다. 하지만 이론 설명만 하면 노잼이니까 오디오 이론을 기초로 자바스크립트의 <code class=\"language-text\">Web Audio</code> API를 사용하여 간단한 오디오 파형까지 그려보려고 한다.</p>\n<p>바로 코딩에 들어가고 싶지만 오디오에 관한 기본적인 지식이 있어야 오디오 파형을 그릴 때의 과정을 이해할 수 있으므로 이론을 최대한 지루하지 않게 설명하려고 한다. 이론이 코딩보다 재미없는 건 맞지만 오디오 파형을 그리려면 최소한 기본적으로 알고 있어야 하는 것들이니까 한번 쓱 흝어보자.</p>\n<h2 id=\"소리란-무엇일까\" style=\"position:relative;\">소리란 무엇일까?<a href=\"#%EC%86%8C%EB%A6%AC%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C\" aria-label=\"소리란 무엇일까 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>제일 먼저 소리가 무엇인지부터 알아보자. 소리를 딱 한마디로 표현하자면 바로 “진동”이다. 기본적으로 우리가 소리를 듣는다는 것은 이런 순서로 일어난다.</p>\n<hr>\n<ol>\n<li>어떤 물체가 부르르 진동을 한다. 이때 진동 주파수는 뭐 대충 <code class=\"language-text\">440hz</code>라고 치자.</li>\n<li>그 물체 주변에 있는 매질이 <code class=\"language-text\">440hz</code>의 진동을 전달한다.(일반적인 상황에서는 주로 공기)</li>\n<li>매질이 진동을 전달하면 우리의 고막도 <code class=\"language-text\">440hz</code>로 진동한다.</li>\n<li>그 진동 신호를 달팽이관이 전기 신호로 바꿔서 청신경에 전달한다.</li>\n<li>뇌가 신호를 받아서 해석한다. <code class=\"language-text\">440hz</code> 접수완료!</li>\n</ol>\n<hr>\n<p>이때 1번에서 물체가 1초에 몇 번이나 떨렸는지 표현하기 위해 우리는 헤르츠(herz, hz) 단위를 사용한다. <code class=\"language-text\">10hz</code>는 1초에 10번 진동을 했다는 의미이고 <code class=\"language-text\">1khz</code>는 1초에 1000번 진동을 했다는 것이다.</p>\n<p>참고로 예시의 <code class=\"language-text\">440hz</code>는 도레미파솔라시도할 때 “라”음이다. 결국 우리가 음악을 듣는다는 것은 결국 진동을 느끼는 것이며, 현악기면 현의 진동, 관악기면 입술이나 리드의 진동, 노래라면 성대의 진동을 듣게 되는 것이다. 아무리 감성터지는 음악도 공돌이 손에 걸리면 이렇게 분해될 수 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/eea4a/s-oche.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABA//EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAEW9SxqiZB//8QAGBABAQEBAQAAAAAAAAAAAAAAAQARIkH/2gAIAQEAAQUCtLxXA6b/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFX/8QAGRAAAwADAAAAAAAAAAAAAAAAARARACJB/9oACAEBAAY/AjahrgHK/wD/xAAZEAADAQEBAAAAAAAAAAAAAAAAAREhQZH/2gAIAQEAAT8h1PBElJpz6WXttU1HpBAxEr6f/9oADAMBAAIAAwAAABCTz//EABgRAQEAAwAAAAAAAAAAAAAAAAEAETFR/9oACAEDAQE/EBdWHt//xAAYEQEBAAMAAAAAAAAAAAAAAAABABEhUf/aAAgBAgEBPxAw7gcv/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFBUWGB/9oACAEBAAE/EGkFsbi9+sCRCWR5fnWtzeFiQ9YTYClkWuZiawJVwZgAaFP/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"s oche\" title=\"\" src=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/c08c5/s-oche.jpg\" srcset=\"/static/6e3222c117b2f5be65d4a041d5f0bf99/0913d/s-oche.jpg 160w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/cb69c/s-oche.jpg 320w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/c08c5/s-oche.jpg 640w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/6a068/s-oche.jpg 960w,\n/static/6e3222c117b2f5be65d4a041d5f0bf99/eea4a/s-oche.jpg 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>우리가 듣는 아름다운 선율의 음악도 뜯어보면 그냥 진동 주파수 덩어리다.</small>\n</center>\n<p>이때 이 진동은 자연계에서 발생한 것이기 때문에 아날로그(Analog)의 형태로 나타난다. 사실 자연계에서 발생하는 대부분의 거시적인 신호는 아날로그 형태를 가지는데, 예를 들면 빛의 밝기가 변한다거나 바람의 세기가 변한다거나 소리의 크기가 변하는 등의 신호를 말한다.</p>\n<h3 id=\"소리는-아날로그-신호다\" style=\"position:relative;\">소리는 아날로그 신호다<a href=\"#%EC%86%8C%EB%A6%AC%EB%8A%94-%EC%95%84%EB%82%A0%EB%A1%9C%EA%B7%B8-%EC%8B%A0%ED%98%B8%EB%8B%A4\" aria-label=\"소리는 아날로그 신호다 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>아날로그(Analog)는 신호나 자료를 연속적인 물리량으로 나타낸 것이다. 이게 연속적인 물리량이라고 하면 뭔가 전문적이고 어려워보이는데 풀어보면 사실 별 거 없다. 여기서 우리가 집중해야할 단어는 물리량이 아닌 “연속적”이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVR42m1S147CQBDb//8seANxQiAhSugCUjahi5rx2Qk6jsutlOxkqseOazabyIIAOJ1QOdcrkCTA41GN7XbAdltxu3G7XTTL4xjGQqPTzMqbzWy/h6Vp+Z3n5X25wLyHZRmMtT81fNyk1So6K4Dj8T3qdnsjYEM8n5/oFL/fKyhdt17Hns38ZoPteIyUUz2fbDaDXy7hWZzO58hkK0ZkosgTfZE3GiFcr7EOQyS8XYsIMyKIlDAYIKZTdtLvI+IQ2fFqhWQ4RKi8xQKeTSI2DklTOp1iSNq+Oh1MGg2uTEexsl5a+3wuReD0MmDvtWUfDgA5/BBOFLxyXK/XY/0DuUiVKBInikrifwsh8uWXUPK9RChiEogrS0BXq9UQkJOzkOlo+n+/kNBJNAnx92gjITfDN0lsZ7dzZK7fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"analog\" title=\"\" src=\"/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png\" srcset=\"/static/48485ab8c211172e1d85631ac91b57ce/69538/analog.png 160w,\n/static/48485ab8c211172e1d85631ac91b57ce/72799/analog.png 320w,\n/static/48485ab8c211172e1d85631ac91b57ce/90cbd/analog.png 605w\" sizes=\"(max-width: 605px) 100vw, 605px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>가로 축은 시간, 세로 축은 전압이다. 아날로그 신호는 아무리 쪼개도 끝이 없는 연속성을 가진다</small>\n</center>\n<p>그렇다면 연속적이라는 건 무슨 말일까?</p>\n<p>연속성의 대표적인 예는 바로 수이다. 자 우리가 이제 <code class=\"language-text\">1</code>부터 <code class=\"language-text\">2</code>까지 걸어간다고 생각해보자. 우리는 <code class=\"language-text\">1</code>에서 <code class=\"language-text\">2</code>까지 걸어가는 동안 몇 개의 수를 만날 수 있을까?</p>\n<p>우선 <code class=\"language-text\">1</code>과 <code class=\"language-text\">2</code>까지 거리의 절반이 되는 위치에는 <code class=\"language-text\">1.5</code>가 있을 것이다. 그 절반인 <code class=\"language-text\">1.25</code>도 있을 것이며 또 그것의 절반인 <code class=\"language-text\">1.125</code>도 있을 것이다.</p>\n<p>이런 식으로 계속 수를 쪼개다 보면 우리는 결국 이게 의미없는 삽질이라는 것을 깨닫게 된다. 만약 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>10</mn><mrow><mo>−</mo><mn>10000</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">10^{-10000}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">10000</span></span></span></span></span></span></span></span></span></span></span></span></span> 단위까지 쪼갠다 해도 우리는 그 수를 계속 해서 무한히 쪼갤 수 있다. 우리는 이런 성질을 연속이라고 부른다.</p>\n<h2 id=\"컴퓨터가-소리를-듣는-방법\" style=\"position:relative;\">컴퓨터가 소리를 듣는 방법<a href=\"#%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B0%80-%EC%86%8C%EB%A6%AC%EB%A5%BC-%EB%93%A3%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"컴퓨터가 소리를 듣는 방법 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>근데 여러분도 알다시피 컴퓨터는 <code class=\"language-text\">0</code>과 <code class=\"language-text\">1</code>밖에 이해하지 못하는 바보다. 이 방식을 우리는 디지털(Digital)이라고 부른다. 그래서 <code class=\"language-text\">0</code>과 <code class=\"language-text\">1</code>밖에 모르는 컴퓨터는 연속성을 가진 아날로그 신호를 이해할 수가 없다.</p>\n<p>그렇다면 우리가 자연에서 발생한 아날로그 형태인 소리를 컴퓨터가 듣게 해주려면 어떻게 해야할까?</p>\n<p>간단하다. 아날로그를 디지털로 바꿔주면 된다. 아날로그 신호인 소리를 컴퓨터가 알아 들을 수 있게 변경하는 과정을 알고나면 <code class=\"language-text\">Web Audio</code> API가 우리에게 주는 정보들이 뭘 의미하는 지 알 수 있다. 그럼 지금부터 아날로그를 디지털로 변경하는 과정을 알아보자.</p>\n<p>아날로그를 디지털로 변경하기 위해서는 몇가지 순서를 거쳐야 한다. 이 순서에서 어떤 값들을 사용하냐에 따라서 디지털로 변경된 소리의 해상도, 즉 음질이 결정된다.\n이때 나오는 단어가 바로 샘플 레이트(Sample Rate)와 비트 레이트(Bit Rate)이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVR42lVRSY7CQBDL//+VAxcQEmQlezobWciCYE6ecmUYzRxKlbTdLrvaMqZCHCdI01Sr73uM46jVtB3iJEXg+2jbVnH2aZoUH4ZB+bfbDff7HV3XwTJVhSTNkCS7KAES58cDddPCD0LFeF4UxT/Bh3BYxPlPccsYo0JhGCKKIi1+13WNPM9xPB4FzyRFjCzbOwX8H9fzPOv9QQQ51OKly+UC13XheR6CIFBgXVed2Mil9/sLo7iis23bsCyLCtHV9XrVO6UY4wCLMQ6HA2zbxvl8RiUr0EhSpqpRliVWEVnXTQc4jqMu+37Yncl6CuH00tUho3HK6XTS5aYSa9/NLFMrIRd4vV6Y5OzzADRBDh+BvWka7b87pGXuhTEJMApdksDJ2/OpO6Ibxv3L+XQWX/kbanYF0WWvlT4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"encoder\" title=\"\" src=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png\" srcset=\"/static/5c4ef295d012e89f63bcd069e92fb4b5/69538/encoder.png 160w,\n/static/5c4ef295d012e89f63bcd069e92fb4b5/72799/encoder.png 320w,\n/static/5c4ef295d012e89f63bcd069e92fb4b5/e3b18/encoder.png 439w\" sizes=\"(max-width: 439px) 100vw, 439px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>인코더 프로그램 쓸 때 뭘 만져야 할지 모르게 만드는 어려운 단어들</small>\n</center>\n<p>단어는 어려워 보이지만 사실 간단하다. 결국 소리는 가로 축은 시간(Time), 세로 축은 진폭(Amplitude)으로 정의된 공간에 그려진 2차원의 진동 주파수 데이터이다. 이때 샘플 레이트는 가로 축의 해상도, 비트 레이트는 세로 축의 해상도를 의미하는 것이다. 이 값들은 아날로그를 디지털로 변경하는 첫번째 단계인 샘플링(Sampling)에서 활용된다.</p>\n<h3 id=\"샘플링sampling\" style=\"position:relative;\">샘플링(Sampling)<a href=\"#%EC%83%98%ED%94%8C%EB%A7%81sampling\" aria-label=\"샘플링sampling permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>샘플링은 아날로그 신호를 디지털 신호로 바꾸기 위한 첫번째 단계이다. 위에서 설명한 것처럼 아날로그 신호인 소리는 연속적인 신호이기 때문에 컴퓨터가 이 신호를 그대로 이해할 수가 없다. 우리가 마이크를 사용하여 소리를 녹음할 때, 이 아날로그 신호는 결국 전기 신호로 변환되어 컴퓨터에게 주어진다. 소리의 진동이 마이크 안에 있는 장치에 전달되면 이 장치가 전압을 올렸다 내렸다 하면서 변환하는 원리이다.</p>\n<p>하지만 우리의 바보 컴퓨터는 이렇게 까지 해줘도 이 전기 신호를 이해할 수 없다.</p>\n<p>그래서 컴퓨터는 연속적인 전기 신호를 측정하기 위해 특정 타이밍을 정해서 “이 타이밍마다 내가 전압을 측정할게!”라는 꼼수를 사용한다. 컴퓨터가 꼼수를 쓰는 이 과정을 그림으로 나타내보면 이런 느낌이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAB2ElEQVR42mNgYGAQAGI+BghgZMAJ/sPkGP8zMIgBMSeQzQPVyw/ELHClbc6xwruN0/gZ8IDF0bl8S7yy5P8DDa53jRHzjWgVBwoLATGIFgZiJrDCK6te8qxwz3Bf5ZzmkV+/XwCbS0NX/eecG1prv8csyLEreaoeSMy+fj8L1BBmKA3Rszx1qtVNMTmlm3K6Sv1x3XZgz0El6xnqwbZOi+8x3msdpg8UF17oV+GyMKBCGFkdCrjokmIBlBAF4U0uaTa96dOlIYohYVafu5ivP67fDigvAcTiR0xC1SfGT7RAUsPEoOLBnjbzDCvYQGcpTUNtBgZ9QwYGPQdxVXN/26hwJyDbnJXVGKhL19/MP8BP3thRhYFBy4SV1dAASIcb+4W6K+ramgPVGTMwGPmLK/rqazu6AY1TgDmUJRQSFgxzfEost5kH6wFdI/KQn19palijI0P9fyak8GLIrlgnvMopwfUz0MUgl88MbbTP968XgHu7HqgYFh6LYrq55wZVu4C8t84p2awrbaYyzHv/IUkGHK4TY9sN9xp46x/Vc9UBWmqKHqZMyOHWnDlVdotthPfMwFrT/7jS5v//TEt9si3Xu6Q5A9ms6NKM6OxtHrl824CBzUAiAADz6odDaFdLSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sampling\" title=\"\" src=\"/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png\" srcset=\"/static/f62ba441843fe9172b18fc5498bd765d/69538/sampling.png 160w,\n/static/f62ba441843fe9172b18fc5498bd765d/72799/sampling.png 320w,\n/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png 640w,\n/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png 684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>위 그림에 나타난 빨간 점이 컴퓨터가 전압을 측정한 타이밍이다. 컴퓨터는 특정 타이밍에 전기 신호를 측정하고 그 값을 저장한다. 빨간 점의 위치를 보면 저 신호는 <code class=\"language-text\">[10, 20, 30, 27, 19, 8...]</code> 뭐 이런 식으로 측정이 되었을 것이다.\n이때 저 빨간 점을 더 세밀하게, 즉 컴퓨터가 샘플 측정을 하는 간격이 짧을 수록 우리는 원래 신호에 가까운 값을 측정할 수 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/7497d/high-low-sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAD2EAAA9hAHVrK90AAABSklEQVR42qWSPU8CQRCG30M+D1HxO8BBPO8OLxfgDg7QihgTY0NpaWvhn6CyNf4GS2PlX7CytLU1xmhn1Ngxzi6biFeIkUmezOztzLsztwtE7ZBm0CIddcoCHE9lFqXQJRv+g43g2UKbHFjD1HcCafJAQKBNUOPExpuH8k2eFwlZ4Fwvy28DismUKuUQfBQ4mmfiqlAbQ50qLCQD7fd1NXcSuBRdxKRAj0o/cidaOjRQPN3lqMJsMDazqbyB8vke1k48jrm7ZJV9i2kydbmPhQoypeK4YhnJgsOBybhMh+mKvqXw7M4WCmd9ntTnta/EWDTRlPkrxwfI970/3pQac58W4b+KjjPcWHYEx+bFKrbJilZpvzMYXYr/YsO8UqLQkTtagnsfyGf2LxO3HX6aqN3V4N56aDx56Aznpnur4hf0KI3Wo84+Ht3+AqxFQxyT+4MwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"high low sampling\" title=\"\" src=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/6af66/high-low-sampling.png\" srcset=\"/static/735b3ff4a2c2bc5e9bb423aef0d67b88/69538/high-low-sampling.png 160w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/72799/high-low-sampling.png 320w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/6af66/high-low-sampling.png 640w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/d9199/high-low-sampling.png 960w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/21b4d/high-low-sampling.png 1280w,\n/static/735b3ff4a2c2bc5e9bb423aef0d67b88/7497d/high-low-sampling.png 3500w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>신호 내부의 사각형이 컴퓨터가 이해한 신호의 모양이다.</small>\n</center>\n<p>이때 이 신호를 측정하는 간격을 샘플 레이트(Sample Rate)라고 하고 신호를 측정하는 과정 자체를 샘플링(Sampling)이라고 한다. 당연히 샘플 레이트가 높을 수록 소리의 해상도, 즉 음질이 더 좋을 수 밖에 없다. 특히 높은 주파수를 가진 소리, 즉 고음의 해상도가 확연하게 좋아진다.</p>\n<p>보통 CD의 음질이 <code class=\"language-text\">44.1kHz</code>, TV나 라디오 방송이 <code class=\"language-text\">48kHz</code>의 샘플 레이트를 가지는데, 이는 약 1초에 44,100번, 48,000번 샘플을 측정한다는 것이다. 저 샘플 레이트는 어떤 기준으로 정하는 걸까?</p>\n<h3 id=\"샘플-레이트sample-rate를-좀-더-자세히-알아보자\" style=\"position:relative;\">샘플 레이트(Sample Rate)를 좀 더 자세히 알아보자<a href=\"#%EC%83%98%ED%94%8C-%EB%A0%88%EC%9D%B4%ED%8A%B8sample-rate%EB%A5%BC-%EC%A2%80-%EB%8D%94-%EC%9E%90%EC%84%B8%ED%9E%88-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90\" aria-label=\"샘플 레이트sample rate를 좀 더 자세히 알아보자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>방금 설명했듯이 CD의 경우 샘플 레이트가 <code class=\"language-text\">44.1kHz</code>이다. 그 말인 즉슨 CD에 들어가는 오디오는 컴퓨터가 아날로그 신호를 1초에 44,100번 측정한 결과물인 것이라는 것이다.</p>\n<p>하지만 인간이 들을 수 있는 영역인 가청주파수는 <code class=\"language-text\">20hz ~ 20kHz</code> 밖에 되지 않는다. 근데 왜 샘플 레이트는 <code class=\"language-text\">44.1kHz</code>, <code class=\"language-text\">48kHz</code>처럼 훨씬 크게 잡는 것일까?</p>\n<blockquote>\n<p>어차피 인간은 1초에 20,000번 진동하는 소리(20kHz)까지밖에 들을 수 없어서 44,100번 진동하는 소리(44.1kHz)를 녹음해도 어차피 들을 수 없는데?</p>\n</blockquote>\n<p>이 질문에 대한 답은 소리의 진동 사이클이 어떻게 생겼는지를 보면 이해가 된다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/54209060f49749e76b0ab4da633070e6/d9199/sine-wave.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVR42o2SWXLEIAxEuf91p0BqbaSFk8nkx46KKkuYp31kZlXtI+ZbNWD5c/Eg460BCbVyd1HFv/BxhfUondjhFb4NhmAKz7CZEVetVMLRPNoLlkf+I23iEOPnA46EyfKntLvaauAE3P4Nbzed+nqtJUuOrLXmnK2IUGG9Q4G5xFTfByIGQAWqUzzYAJzDXl6KGS/NsmumS7qgpUe62WRV3flqh7IilGFzqEzyJMhLaI66HQp/injZ6Qjh9sLWuEjQGuiK73hujkvP74KpuLr53yW5kY6DhkmmGc0rXKddT+uUXIRlrDTYxI/5j8/dvpFgs7gO4AL8Pv4CWb0B4j12ASIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sine wave\" title=\"\" src=\"/static/54209060f49749e76b0ab4da633070e6/6af66/sine-wave.png\" srcset=\"/static/54209060f49749e76b0ab4da633070e6/69538/sine-wave.png 160w,\n/static/54209060f49749e76b0ab4da633070e6/72799/sine-wave.png 320w,\n/static/54209060f49749e76b0ab4da633070e6/6af66/sine-wave.png 640w,\n/static/54209060f49749e76b0ab4da633070e6/d9199/sine-wave.png 960w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>기본적으로 오디오 주파수는 이렇게 하나의 사이클 단위로 나누어 지는데, 이때 위로 올라가는 <code class=\"language-text\">+</code> 부분이 공기가 압축되는 부분이고 아래로 내려가는 <code class=\"language-text\">-</code> 부분이 다시 공기가 팽창하는 부분이다.</p>\n<p>위에서 계속 설명했던 대로 소리란 곧 진동이고, 우리가 느끼는 것은 그 진동으로 인한 공기의 떨림이므로 압축 > 팽창 > 압축까지 모두 들어야 “떨렸다!”라고 느낄 수 있다. 즉, 우리가 들을 수 있는 20,000번의 진동은 이 사이클이 1초에 20,000번 반복되는 소리라는 것이다.</p>\n<p>압축이나 팽창 중에 하나만 주구장창 느낀다고 해서 “이게 진동이구나”라고 느낄 수는 없을 것이다.</p>\n<p>그래서 오디오 신호의 한 사이클을 제대로 측정하려면 + 방향의 맨 위의 꼭지점 하나와 - 방향의 맨 밑의 꼭지점 하나를 모두 측정해야하기 때문에 최소 2번은 측정을 해야한다. 그래서 인간이 들을 수 있는 가장 높은 소리인 초당 20,000번의 떨림인 <code class=\"language-text\">20kHz</code>을 제대로 측정하려면 컴퓨터는 최소한 1초에 <code class=\"language-text\">20,000 * 2 = 40,000번</code> 측정을 해야 하는 것이다.</p>\n<p>이게 바로 CD가 왜 <code class=\"language-text\">44.1kHz</code>의 샘플 레이트를 가지고 있는지에 대한 이유다. 이걸 나이퀴스트 이론(Nyquist Theorem)이라고 한다. 즉, 나이퀴스트 이론을 한마디로 정리하자면</p>\n<blockquote>\n<p>측정하고 싶은 오디오 주파수있지? 오디오 신호 제대로 다 살리고 싶으면 최소한 그 주파수보다 두배는 더 빠르게 측정해야된다.</p>\n<p>그러니까 최소한 측정하고 싶은 오디오 주파수의 두 배 사이즈의 샘플 레이트를 준비하렴.</p>\n</blockquote>\n<p>인 것이다. 근데 여기서 또 의문이 생긴다. 저 이론에 따르면 인간의 가청주파수는 <code class=\"language-text\">20,000hz</code>니까 딱 40,000번만 측정하면 인간이 들을 수 있는 소리는 다 녹음할 수 있는데 왜 44,100번이나 48,000번까지 측정하는 걸까?</p>\n<p>자연에는 인간만 있는 것이 아니라 이런 친구들도 있기 때문이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f9e7d3854217d95b93299ec30c34597c/eea4a/dolphin.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABspui5kWX/8QAGBAAAgMAAAAAAAAAAAAAAAAAAhAAESL/2gAIAQEAAQUCIqmma//EABYRAAMAAAAAAAAAAAAAAAAAABARIf/aAAgBAwEBPwFQf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABwQAAICAgMAAAAAAAAAAAAAAAABETFBUWFxkf/aAAgBAQABPyHA9JSNdF8F2M1DRg//2gAMAwEAAgADAAAAEGvP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAwEBPxABwW3/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QV2f/xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMUFRYYHR/9oACAEBAAE/EKacN9PUGWE4OS+CJgtqtXqUMck+xVFIwyF6n//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dolphin\" title=\"\" src=\"/static/f9e7d3854217d95b93299ec30c34597c/c08c5/dolphin.jpg\" srcset=\"/static/f9e7d3854217d95b93299ec30c34597c/0913d/dolphin.jpg 160w,\n/static/f9e7d3854217d95b93299ec30c34597c/cb69c/dolphin.jpg 320w,\n/static/f9e7d3854217d95b93299ec30c34597c/c08c5/dolphin.jpg 640w,\n/static/f9e7d3854217d95b93299ec30c34597c/6a068/dolphin.jpg 960w,\n/static/f9e7d3854217d95b93299ec30c34597c/eea4a/dolphin.jpg 1280w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>안녕하세요. 저는 최대 150kHz까지도 소리를 발사할 수 있슴다.</small>\n</center>\n<p>사실 자연에는 우리가 듣지 못하는 훨씬 높은 소리들도 존재한다. 단지 우리가 <code class=\"language-text\">20kHz</code>까지밖에 못 들을 뿐이다. 뭐 박쥐나 돌고래 같은 친구들은 훨씬 고음역대의 소리를 내지 않는가?</p>\n<p>근데 이 소리가 <code class=\"language-text\">40kHz</code>의 샘플 레이트를 준비한 그릇에 들어오면 어떻게 될까? 컴퓨터는 1초에 20,000번의 사이클을 도는 소리를 제대로 측정하기 위해 1초에 40,000번 전압을 측정하려고 했는데 만약 1초에 30,000번의 사이클을 도는 훨씬 더 높은 주파수의 소리가 들어와버린다면?</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABo0lEQVR42mVTW46jMBDk/odb7QHmY5REIcEYx28bMDXdDWwy2pZsisL9qjbd5XKBMQbjOEIphWlU0FoR1hgGXsRpDa3275oxrROrYRBfjnG73dBN0wS2jbdlQQsRNTeUClRa8wI03lIk0PDL+ECM2A7eWvsO2DYKWQImVXG/lj0JccynKWGJ5FyyJGaeg2wcrBS0nN8Buezdu2ENiRI2qUacJFNDi8QnevfhXd2ySnXgc2HnX68XOu5d4s0zks6Q4uNHe8SDqmD/MoVTHOGkZWZIJjbnHLp+6rFghvEWLjgUVORikatDPnAiPNOX71vA0yTBKdOZeT+TkkHdEganqOVHLznDGKjrdddorqTNoVcknuRgPKcCb4rg9sG3nIB1gbFUob5epfo17Hrg0I3S7jh+8isWG8H+MvXTVtajon/QUP7+eSJ5Jo4ApzMLzZmOCf4zCpR9RXHlI96G7y+SbaKhDPcBnHKjO/jL+J2r4+z/3b2AWprk4mPczFZWWJKve9AWvZMJ8fLey33ip6drYA9O+BMT78jHGE9/zO6XqPJn3+MHKHJYsi4mGRwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"nyquist error\" title=\"\" src=\"/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png\" srcset=\"/static/1c9dd2b354904b4b414af5ba807e5204/69538/nyquist-error.png 160w,\n/static/1c9dd2b354904b4b414af5ba807e5204/72799/nyquist-error.png 320w,\n/static/1c9dd2b354904b4b414af5ba807e5204/a805e/nyquist-error.png 572w\" sizes=\"(max-width: 572px) 100vw, 572px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<blockquote>\n<p>정답. 점을 이상한데다가 찍기 시작한다.</p>\n</blockquote>\n<p>그림을 보면 컴퓨터가 점을 찍는 간격, 즉 전압을 측정하는 간격보다 들어온 신호의 사이클이 더 짧다. 그래서 컴퓨터가 찍은 점을 보면 신호의 꼭지점이 아닌 어중간한 어딘가에 찍힌 것을 볼 수 있다. 이것이 바로 나이퀴스트 이론이 가지고 있는 함정이다. 그리고 저 어중간한데 찍힌 점들을 이어본 파란색 선을 보면 결국 낮은 주파수가 된 것을 알 수 있다. 그러면 어떻게 될까?</p>\n<p>우리 귀에 아주 잘 들린다. 참 소름돋는 순간이다! 녹음할 때는 분명히 아무것도 안들렸는데 녹음한 걸 들어보니 이상한 소리가 녹음되어있으니 말이다. 그래서 이 현상을 “유령 주파수(Ghost Frequency)“라고 부른다.</p>\n<blockquote>\n<p>아니 그러면 샘플 레이트를 팍팍 올리면 되잖아! 높은 소리도 제대로 녹음되면 문제 해결 아닌가?</p>\n</blockquote>\n<p>하지만 이 디지털 오디오 기술이 처음 사용되기 시작한게 1970년대이기 때문에 무작정 샘플 레이트를 올리기에는 하드웨어 용량이 못 따라갔었다.</p>\n<p>그래서 이 문제를 해결하기 위해 사용한 방법이 바로 LPF(Low Pass Filter)이다. 이 필터는 전기 쪽 공부하신 분들은 매우 익숙할텐데, 말 그대로 낮은(Low) 주파수만 통과(Pass)시키는 필터이다. 오디오 녹음을 할때 LPF를 사용해서 인간의 가청 주파수보다 높은 소리는 다 잘라버리고 인간의 가청 주파수 영역의 소리만 통과시키면 방금 얘기한 고스트 주파수가 생길 일도 없기 때문이다.</p>\n<p>근데 또 아날로그 신호라는 게 그렇게 무 자르듯이 싹뚝! 잘리는 게 아니다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bcb489965646eb5446167bbddb504813/c1b63/cut-off.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQklEQVR42o1STY8hYRDuHQYzPnr1rm0d7aNFxmDGmPVtkT0gEb9BIiGcCIk4uDiKiIOjxMWJiASJCAdxc/ILHOeP2CrRSU/PJLNv8qSrq+p53qp6i1itVublcskJsdvtzKPR6CGZTHoIgrAyDPOIQDuVSr1gDHPEPNQi9vu9QojT6SQfDAb3JpPJazab9SAirVQqdD6fp8C+5TiOxli321VirphPiM6365cF0LxzvV5rDofDnSDvF8Ao4nx6+KANoOSdcLNKdLvymsNzEBKAjKjX6/pqtcoI4XA4gtls1oQxaJXudDr2drttxdYxXigUWLfbHSyVSoZms8nAXHEcPwAeotVqyXhAFVKv10tC8uv5fJaWy2U5+KXT6ZTq9/satNEHsRuXy/USjUa1yIG45FrlzYeeaZpWhsPhV+EIRDO8kCKRiMdut6uJr45Op1NBsk9IXiwW6l6v904wHo/7A4GA5r8Eg8GgV1ghtESKKwyFQr9tNpvmyxcmSfK7z+eLwCxv4ZcBuKE1n16v94ONo9Dhbvr9/jAI6j5bHeGzE1qt1ggCf0HYIpfLLeB6hhNiWRYFnxUKhQm+JtiEOMybu2pIBDrvK5TJZA+1Ws0gDIj28JLXaDRYiqIcHyqEKvAWK6zKUyaTSeRyuQi8qhPmxs1mM/N8PjdOJpMn+Lejjb7xeGzZbDaPsKN/0ul0ErmocdFyOp0qRCKRIKEy6ng83sOjWIbDoXq73Srf3t7u4CJDsVj8iTb6MBaLxTjMRQ5yeZ1/c43gleg9ctcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cut off\" title=\"\" src=\"/static/bcb489965646eb5446167bbddb504813/6af66/cut-off.png\" srcset=\"/static/bcb489965646eb5446167bbddb504813/69538/cut-off.png 160w,\n/static/bcb489965646eb5446167bbddb504813/72799/cut-off.png 320w,\n/static/bcb489965646eb5446167bbddb504813/6af66/cut-off.png 640w,\n/static/bcb489965646eb5446167bbddb504813/d9199/cut-off.png 960w,\n/static/bcb489965646eb5446167bbddb504813/c1b63/cut-off.png 1200w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>LPF를 써도 결국 잘린 부분이 저렇게 비스듬하게 꺾이면서 약간 아쉬운 부분이 남게된다. 이때 그림에 표시된 허용 범위인 <code class=\"language-text\">-3db</code> 밑으로 떨어지기 시작하는 곳을 Cut Off라고 부른다. 저기에서부터 신호가 잘렸다고 치겠다는 것이다.</p>\n<p>그럼 Cut Off되는 부분을 <code class=\"language-text\">20kHz</code>보다 조금 더 밑으로 내리면 <code class=\"language-text\">20kHz</code> 언저리에서 신호가 사라지게 만들 수 있지 않을까? 라는 생각도 들지만 그 문제 때문에  <code class=\"language-text\">20kHz</code>의 주파수 영역을 전부 활용하지 못하는 건 너무 아깝다고 판단이 들었나보다.</p>\n<p>그래서 Cut Off를 딱 <code class=\"language-text\">20kHz</code>에 맞추고 남는 부분은 그냥 감수하자고 합의가 된 것이다. 당시 기술로 저 남는 부분을 줄이고 줄여서 맞춘게 딱 <code class=\"language-text\">2,050hz</code>였다.</p>\n<p>그럼 이제 남는 부분과 가청주파수를 합쳐보면 <code class=\"language-text\">22,050hz</code>가 된다. 나이퀴스트 이론에 따르면 우리는 최소한 2배의 샘플 레이트를 준비해야 이 신호를 제대로 측정할 수 있으므로 결국 CD의 표준 샘플 레이트가 <code class=\"language-text\">44,100hz = 44.1kHz</code>가 된 것이다.\n뭐 그 외에도 당시 기술의 한계 외에도 기업들끼리 싸우기도 하고 어른의 사정도 있는 등 국제 표준을 정할 때 늘 발생하는 여러가지 이슈가 있었지만 대표적인 기술적인 이슈는 이 이유였다.</p>\n<p>그 후 <code class=\"language-text\">48kHz</code>, <code class=\"language-text\">96kHz</code>, <code class=\"language-text\">192kHz</code> 등의 높은 샘플 레이트는 그냥 디바이스가 발전하면서 기술적인 제한이 없어졌으니까 “샘플 레이트는 클수록 좋지! 뿜뿜”하면서 늘린 것이다.</p>\n<h3 id=\"비트-레이트bit-rate\" style=\"position:relative;\">비트 레이트(Bit Rate)<a href=\"#%EB%B9%84%ED%8A%B8-%EB%A0%88%EC%9D%B4%ED%8A%B8bit-rate\" aria-label=\"비트 레이트bit rate permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>비트 레이트는 샘플링에 비하면 초 간단하다. 특히 우리 같은 개발랭이들에게 익숙한 이름인 “Bit”가 붙어있지 않은가? 샘플 레이트가 소리의 가로 해상도 역할을 한다면 비트 레이트는 세로 해상도 역할을 한다.</p>\n<p>샘플 레이트와 마찬가지로 비트 레이트도 CD를 기준으로 설명하는 게 보편적이기 때문에 다시 CD를 기준으로 설명하겠다.</p>\n<p>CD의 비트 레이트는 <code class=\"language-text\">16bit</code>인데 이건 말 그대로 세로로 <code class=\"language-text\">16bit</code> 만큼의 해당하는 값을 표현할 수 있다는 얘기이다. 아까 위에서 설명한 샘플링을 진행할 때 전압을 측정했었다. 이때 컴퓨터가 측정한 이 전압의 값을 얼마나 섬세하게 표현할 수 있느냐를 비트 레이트가 결정하는 것이다. <code class=\"language-text\">16bit</code>면 16자리의 이진법을 사용할 수 있다는 것이고 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>=</mo><mn>65536</mn></mrow><annotation encoding=\"application/x-tex\">2^{16} = 65536</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">16</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">65536</span></span></span></span></span>이니까 0부터 65,536까지 총 65,537개의 값을 사용할 수 있는 것이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b1bb1c1aa17f6cf158141942536a758f/f2239/bitrate.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAD2EAAA9hAHVrK90AAABdUlEQVR42o2S20oCURSGf8dDaTNqGo4zlqZJgXfVRVcWSRCkIlSSZUJhWCoeShANKQIpCrrqEXqHeoAezP45BBFFLvhYh2HW3v9aGwAmiVv3sY8wlLscvPtFhO53sPQ+z7qdzBAvDLPgH/PohF8TmD6sQrBdMD9nnxJ8+RbibwvMgySA25GA5VEc4oZ2gPRXQxHhoQL/WZ3xMSkDQpU+T9+A2i/AW4swl4GRBbPPTiDhYG4jArF+Q8v5QX3MwKZeMd4lp0ZT6x59BfZQBcpTDoj8lGz5Xb5NScK50mLU5gEV+gbpG7IFrV6DlGrDk+4wLrB2YiqpmxT13B6oYCKyaUg2FuM0cRny9PpXTYK/XIVjrseYCF16bSwDxk36DqT0EGIqgTHNBU82CvXmgJKa5pxLpoIjTK1eIviwbl5iHPNpzyqE6Msi3NlrYxza0jgOR6wFmYuDom3eP+4NtYZx/Qe5s6Y/L3GrB3G7C3WQgSup6AcC8id2pjciNdJZ2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bitrate\" title=\"\" src=\"/static/b1bb1c1aa17f6cf158141942536a758f/6af66/bitrate.png\" srcset=\"/static/b1bb1c1aa17f6cf158141942536a758f/69538/bitrate.png 160w,\n/static/b1bb1c1aa17f6cf158141942536a758f/72799/bitrate.png 320w,\n/static/b1bb1c1aa17f6cf158141942536a758f/6af66/bitrate.png 640w,\n/static/b1bb1c1aa17f6cf158141942536a758f/d9199/bitrate.png 960w,\n/static/b1bb1c1aa17f6cf158141942536a758f/21b4d/bitrate.png 1280w,\n/static/b1bb1c1aa17f6cf158141942536a758f/f2239/bitrate.png 3116w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>\n    비트 레이트가 높을 수록 아날로그 신호 내부의 막대가 더 꼼꼼하게 채워지는 것을 볼 수 있다.<br>\n    +와 -를 합쳐서 비트를 세는 signed이기 때문에 그림에는 50% 씩만 표현되어있는 것이다.\n  </small>\n</center>\n<p>물론 아날로그인 소리 신호가 변환된 전압 값이 <code class=\"language-text\">123</code> 같이 딱 떨어지는 정수일리가 없으므로 우리가 사용할 수 있는 <code class=\"language-text\">0-65536</code> 중 근사치를 찾아서 바꿔주는데 이 과정을 양자화(Quantizing)라고 부른다. <small>(양자역학에서 나오는 그 양자랑 같은 의미 맞다.)</small></p>\n<p>이후 <code class=\"language-text\">0-65536</code>의 값으로 변경된 전압을 컴퓨터가 이해할 수 있는 이진수(Binary)로 변경하는 과정을 부호화(Coding)라고 한다.</p>\n<p>이런 것들은 우리같은 개발랭이들은 워낙 익숙한 문제이기 때문에 이 정도만 설명하고 넘어가겠다.</p>\n<h2 id=\"web-audio-api로-파형-그려보기\" style=\"position:relative;\">Web Audio API로 파형 그려보기<a href=\"#web-audio-api%EB%A1%9C-%ED%8C%8C%ED%98%95-%EA%B7%B8%EB%A0%A4%EB%B3%B4%EA%B8%B0\" aria-label=\"web audio api로 파형 그려보기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>자, 드디어 길고 길었던 소리 이론이 끝났다. 필자는 디지털로 변환된 오디오를 가지고 파형을 그려보는 것이 목적이기 때문에 아날로그에서 디지털로 변환하는 과정만 다뤘고, 반대로 디지털에서 아날로그로 변환하는 과정은 이 포스팅에서 다루지 않을 예정이다. 근데 이것도 나름 재밌으므로 따로 찾아보길 강추한다. 필자는 오디오 파일을 업로드해서 해당 오디오 파일을 <code class=\"language-text\">Web Audio</code> API로 분석하여 필요한 데이터를 뽑아내고 <code class=\"language-text\">svg</code> 엘리먼트를 사용하여 파형을 그릴 것이다.</p>\n<p>참고로 프로젝트는 <code class=\"language-text\">webpack4</code>와 <code class=\"language-text\">babel7</code>을 사용하여 초간단하게 구성했다. 자세한 코드는 <a href=\"https://github.com/evan-moon/simple-waveform-visualizer\" target=\"_blank\" rel=\"nofollow\">깃허브 레파지토리</a>에서 확인 해볼 수 있다.</p>\n<h3 id=\"기본-틀-잡기\" style=\"position:relative;\">기본 틀 잡기<a href=\"#%EA%B8%B0%EB%B3%B8-%ED%8B%80-%EC%9E%A1%EA%B8%B0\" aria-label=\"기본 틀 잡기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>그럼 먼저 HTML을 간단하게 작성하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>audio-uploader<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>waveform<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">preserveAspectRatio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>none<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>waveform-path-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>HTML은 이게 끝이다. 오디오 파일을 업로드할 <code class=\"language-text\">input</code> 엘리먼트 하나와 파형을 그릴 <code class=\"language-text\">svg</code> 엘리먼트 하나만 있으면 된다. 어차피 테스트 용도라서 UI가 중요한게 아니기 때문에 기능 구현에 충실했다.<small>(라고 포장을 해봅니다)</small></p>\n<p>이제 파일이 업로드되면 실행될 이벤트 핸들러를 작성하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputDOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio-uploader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  inputDOM<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>currentTarget<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsArrayBuffer</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">FileReader.prototype.readAsArrayBuffer</code> 메소드는 바이너리 형태인 파일을 한번에 반환하는 것이 아니라 일정 단위의 청크(Chunk)로 반환하는 메소드이다. 보통 뭐 서버로 파일 업로드 한다거나 할 때 많이 사용한다.</p>\n<p>원래는 이 <code class=\"language-text\">ArrayBuffer</code>를 처리해주기 위한 별도의 로직을 작성해야하지만 이번에 사용할 <code class=\"language-text\">Web Audio</code> API가 내부적으로 <code class=\"language-text\">ArrayBuffer</code>를 알아서 처리해주기 때문에 걱정하지 않아도 된다.</p>\n<h3 id=\"audioanalyzer-클래스-작성\" style=\"position:relative;\">AudioAnalyzer 클래스 작성<a href=\"#audioanalyzer-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%9E%91%EC%84%B1\" aria-label=\"audioanalyzer 클래스 작성 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이제 본격적으로 <code class=\"language-text\">Web Audio</code> API를 사용해볼 차례이다. 필자는 별도로 <code class=\"language-text\">AudioAnalyzer</code>라는 싱글톤 클래스를 만들었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// lib/AudioAnalyzer.js</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AudioAnalyzer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>AudioContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> errorMsg <span class=\"token operator\">=</span> <span class=\"token string\">'Web Audio API 지원 안돼유 ㅜㅜ'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>errorMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>errorMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>AudioContext <span class=\"token operator\">||</span> webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormBox <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waveform'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormPathGroup <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waveform-path-group'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">reset</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>AudioContext <span class=\"token operator\">||</span> webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioAnalyzer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"svg-뷰박스를-설정하자\" style=\"position:relative;\">SVG 뷰박스를 설정하자<a href=\"#svg-%EB%B7%B0%EB%B0%95%EC%8A%A4%EB%A5%BC-%EC%84%A4%EC%A0%95%ED%95%98%EC%9E%90\" aria-label=\"svg 뷰박스를 설정하자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이렇게 대충 기본 틀을 잡아주고 나서 오디오 파형을 그릴 <code class=\"language-text\">svg</code> 엘리먼트의 뷰박스를 설정할 수 있는 메소드를 하나 선언할 것이다. 소리 신호는 샘플 레이트에 따라서 들어온 데이터의 길이가 천차만별이기 때문에 뷰박스의 <code class=\"language-text\">width</code>를 오디오 데이터의 크기에 맞게 동적으로 변경해줘야지 모든 신호를 뷰박스에 딱 맞게 그릴 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">updateViewboxSize</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormBox<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewBox'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">0 -1 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">svg</code> 엘리먼트의 <code class=\"language-text\">viewBox</code> 속성은 앞에서부터 <code class=\"language-text\">min-x</code>, <code class=\"language-text\">min-y</code>, <code class=\"language-text\">width</code>, <code class=\"language-text\">height</code>를 의미한다. 비트 레이트를 설명할 때 얘기 했듯이 오디오 신호는 부호를 가지는 signed이기 때문에 <code class=\"language-text\">0, 0</code>이 아닌 <code class=\"language-text\">0, -1</code>에서 뷰박스를 설정해야한다. 그리고 <code class=\"language-text\">width</code>는 오디오의 샘플 레이트로 잡아줘서 오디오 신호가 뷰박스의 처음부터 끝까지 꽉 차도록 설정하고 <code class=\"language-text\">height</code>는 <code class=\"language-text\">-1 ~ 1</code>까지 잡아줘야하니까 <code class=\"language-text\">2</code>로 설정했다.</p>\n<p>이렇게 선언한 <code class=\"language-text\">updateViewboxSize</code>메소드는 어플리케이션이 초기화될때 뷰박스 사이즈도 함께 초기화되도록 <code class=\"language-text\">constructor</code>와 <code class=\"language-text\">reset</code> 메소드에 적당히 추가해주었다.</p>\n<h3 id=\"업로드된-audiobuffer-확인하기\" style=\"position:relative;\">업로드된 AudioBuffer 확인하기<a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C%EB%90%9C-audiobuffer-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"업로드된 audiobuffer 확인하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이제 <code class=\"language-text\">input</code> 엘리먼트를 통해 업로드된 오디오 파일을 디코딩하는 귀여운 setter를 하나 선언하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">setAudio</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">audioFile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">decodeAudioData</span><span class=\"token punctuation\">(</span>audioFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">AudioContext.prototype.decodeAudioData</code> 메소드는 <code class=\"language-text\">ArrayBuffer</code>를 받아서 <code class=\"language-text\">AudioBuffer</code>로 변환하는 메소드이다. 아까 위에서 설명했던 대로 <code class=\"language-text\">readAsArrayBuffer</code> 메소드가 반환한 <code class=\"language-text\">ArrayBuffer</code>는 한번에 모든 바이너리 데이터를 불러오는 것이 아니라 청크 단위로 불러오기 때문에 <code class=\"language-text\">decodeAudioData</code>도 변환을 동기적으로 해주지는 않는다. 그래서 이 메소드를 사용할 때는 콜백함수를 사용하거나 <code class=\"language-text\">Promise</code>를 사용해야 한다.</p>\n<p>이제 실제로 오디오 파일이 어떻게 변환되는지 보기 위해 파일을 업로드하면 <code class=\"language-text\">AudioAnalyzer</code>에게 오디오 파일을 넘기도록 변경해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span> AudioAnalyzer <span class=\"token keyword\">from</span> <span class=\"token string\">'./lib/AudioAnalyzer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputDOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio-uploader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  inputDOM<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>currentTarget<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// AudioAnalyzer 초기화</span>\n      AudioAnalyzer<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// AudioAnalyzer에게 파일 토스</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> AudioAnalyzer<span class=\"token punctuation\">.</span><span class=\"token function\">setAudio</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsArrayBuffer</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 쯤 했으면 이제 메인 함수에는 더 이상 뭘 작성할 필요가 없을 것 같다. 이제 <code class=\"language-text\">AudioAnalyzer</code>만 가지고 놀면 된다. 데이터가 어떻게 나오는지 확인하기 위해 필자가 좋아하는 가수인 거미의 “그대 돌아오면”이라는 곡의 mp3 파일을 업로드 해보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">AudioBuffer <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">length</span><span class=\"token operator\">:</span> <span class=\"token number\">12225071</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">277.2124943310658</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">sampleRate</span><span class=\"token operator\">:</span> <span class=\"token number\">44100</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">numberOfChannels</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그러면 <code class=\"language-text\">AudioAnalyzer</code>의 <code class=\"language-text\">setAudio</code> 메소드 내부에서 실행된 <code class=\"language-text\">decodeAudioData</code>가 <code class=\"language-text\">ArrayBuffer</code>를 받아서 <code class=\"language-text\">AudioBuffer</code>로 변환한 뒤 반환해준다. 이걸 뜯어보면 유용한 정보들이 들어있다.</p>\n<hr>\n<ul>\n<li><code class=\"language-text\">sampleRate</code>: 당연히 샘플 레이트를 의미하고 이 곡의 샘플 레이트는 <code class=\"language-text\">44,100hz</code>이다.</li>\n<li><code class=\"language-text\">numberOfChannels</code>: 이 오디오가 몇개의 채널을 가지고 있는지를 나타내는데 이 파일은 두 개의 채널이 있는 스테레오 채널 오디오 파일이다.</li>\n<li><code class=\"language-text\">length</code>: 피크(Peak)들의 개수를 의미한다. 피크는 컴퓨터가 샘플링을 진행할 때 전압을 측정한 값을 의미한다.</li>\n<li><code class=\"language-text\">duration</code>: 이 오디오 파일의 재생 길이를 초 단위로 표시해준다. “그대 돌아오면”이라는 곡은 약 277초의 길이를 가지고 있다.</li>\n</ul>\n<hr>\n<p>음 여기서 한 가지 결정해야할 것이 생겼다. 채널이 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>개인 오디오 데이터가 들어왔을 때 그 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>개의 채널의 오디오 파형을 모두 표현해주거나 채널을 하나로 합쳐서 파형을 표현해주어야한다. 필자는 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>개의 채널을 가진 오디오 데이터가 들어오더라도 그 채널을 모두 한개의 채널로 머지해서 파형을 그릴 예정이다.</p>\n<p>하지만 이 포스팅에서 채널을 머지하는 것까지 모두 이야기하면 너무 복잡해지기 때문에 그냥 하나의 채널만 사용하여 진행하도록 하겠다.</p>\n<h3 id=\"오디오-데이터-분석하고-정제하기\" style=\"position:relative;\">오디오 데이터 분석하고 정제하기<a href=\"#%EC%98%A4%EB%94%94%EC%98%A4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D%ED%95%98%EA%B3%A0-%EC%A0%95%EC%A0%9C%ED%95%98%EA%B8%B0\" aria-label=\"오디오 데이터 분석하고 정제하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이제 필자는 기본적인 오디오 데이터인 <code class=\"language-text\">AudioBuffer</code>를 얻었다. 이제 이 데이터만 있어도 오디오 파형을 그릴 수 있다.\n이제 <code class=\"language-text\">AudioBuffer</code>에서 필요한 데이터만 뽑아서 클래스의 멤버변수들에 할당해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">setAudio</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">audioFile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">decodeAudioData</span><span class=\"token punctuation\">(</span>audioFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// AudioBuffer 객체를 멤버변수에 할당</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 업로드된 오디오의 샘플 레이트를 멤버변수에 할당</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 샘플 레이트에 맞춰서 svg 엘리먼트 크기 조정</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateViewboxSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>후, 여기까지 왔으면 파형을 그릴 준비가 모두 끝났다. 우선 <code class=\"language-text\">AudioBuffer</code>에서 오디오 신호를 하나하나 뽑아보자.</p>\n<p>먼저 오디오 신호가 들어있는 배열부터 한번 살펴보자. 아까 필자가 <code class=\"language-text\">AudioBuffer</code>의 데이터를 간략하게 봤을 때 <code class=\"language-text\">numberOfChannels</code>라는 프로퍼티가 있었고 이 값이 <code class=\"language-text\">2</code>인 <code class=\"language-text\">스테레오</code> 채널이었다. 이 채널 데이터는 <code class=\"language-text\">AudioBuffer.getChannelData</code> 메소드를 통해서 가져올 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span>numberOfChannels<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelData</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Float32Array(12225071) [0, 0, 0, …]</span>\n<span class=\"token comment\">// Float32Array(12225071) [0, 0, 0, …]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>아닛 어마무시한 길이의 <code class=\"language-text\">Float32Array</code>가 나왔다. 지금 필자에게 보이는 값은 전부 <code class=\"language-text\">0</code>이지만 보통 음악이 시작하자마자 쿠과과광! 하진 않기 때문에 그런거지 뒤쪽 인덱스의 엘리먼트에는 값이 제대로 들어가 있다. 그렇다고 이 값들을 그대로 사용하긴 조금 힘들고 조금 손질을 해줘야 한다.</p>\n<p>우선 저 배열에 들어있는 원소의 정체가 뭔지부터 생각해보자. 배열의 길이인 <code class=\"language-text\">12225071</code>를 사용하면 이 친구의 정체를 파악할 수 있다. 아까 우리가 <code class=\"language-text\">AudioBuffer</code>를 통해 이 곡의 재생 길이(Duration)를 봤을 때 약 277초였다. 이 곡의 샘플 레이트와 재생 길이를 곱해보면 <code class=\"language-text\">12225071</code>이 나온다. 즉, 저 원소들은 컴퓨터가 샘플 레이트에 따라 측정한 전압인 피크이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.12500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAB2ElEQVR42mNgYGAQAGI+BghgZMAJ/sPkGP8zMIgBMSeQzQPVyw/ELHClbc6xwruN0/gZ8IDF0bl8S7yy5P8DDa53jRHzjWgVBwoLATGIFgZiJrDCK6te8qxwz3Bf5ZzmkV+/XwCbS0NX/eecG1prv8csyLEreaoeSMy+fj8L1BBmKA3Rszx1qtVNMTmlm3K6Sv1x3XZgz0El6xnqwbZOi+8x3msdpg8UF17oV+GyMKBCGFkdCrjokmIBlBAF4U0uaTa96dOlIYohYVafu5ivP67fDigvAcTiR0xC1SfGT7RAUsPEoOLBnjbzDCvYQGcpTUNtBgZ9QwYGPQdxVXN/26hwJyDbnJXVGKhL19/MP8BP3thRhYFBy4SV1dAASIcb+4W6K+ramgPVGTMwGPmLK/rqazu6AY1TgDmUJRQSFgxzfEost5kH6wFdI/KQn19palijI0P9fyak8GLIrlgnvMopwfUz0MUgl88MbbTP968XgHu7HqgYFh6LYrq55wZVu4C8t84p2awrbaYyzHv/IUkGHK4TY9sN9xp46x/Vc9UBWmqKHqZMyOHWnDlVdotthPfMwFrT/7jS5v//TEt9si3Xu6Q5A9ms6NKM6OxtHrl824CBzUAiAADz6odDaFdLSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sampling\" title=\"\" src=\"/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png\" srcset=\"/static/f62ba441843fe9172b18fc5498bd765d/69538/sampling.png 160w,\n/static/f62ba441843fe9172b18fc5498bd765d/72799/sampling.png 320w,\n/static/f62ba441843fe9172b18fc5498bd765d/6af66/sampling.png 640w,\n/static/f62ba441843fe9172b18fc5498bd765d/2c288/sampling.png 684w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>저 하나하나의 피크들이 전부 Float32Array의 원소로 들어가있다.</small>\n</center>\n<p>일단 저 원소의 정체가 피크라는 것을 알았으니 이 친구들을 조금 정제해보자. 왜 이걸 정제하느냐?</p>\n<blockquote>\n<p>12,225,071개의 피크를 전부 렌더한다는 게 과연 효율적인 시각화인가…?</p>\n</blockquote>\n<p>라는 합리적 의심 때문이다. 솔직히 피크가 천만개가 찍히던 오백만개가 찍히던 어차피 우리는 조그만 모니터로 볼 것이기 때문에 굳이 이걸 하나하나 다 표현해준다는 것 자체가 큰 의미는 없다.</p>\n<p>그래서 필자는 피크들을 적당히 압축할 것이다. 모든 피크를 수집하는 것이 아니라 적당한 길이의 샘플을 만들고 해당 샘플 안의 최대값과 최소값만 수집할 것이다.</p>\n<p>위에서 설명했듯이 나이퀴스트 이론에 따르면 어차피 하나의 사이클을 표현할때 최대값 한개와 최소값 한개만 알면 아무 문제가 없다.</p>\n<p>만약 필자의 어플리케이션에 파형을 확대하는 기능이 존재한다면 확대/축소 이벤트가 발생했을 때 렌더링에 필요한 피크 개수만큼 동적으로 피크를 선정하는 과정이 필요하겠지만, 이 어플리케이션은 그 정도로 고도화되지는 않았으므로 정해진 개수의 피크만 정제하는 로직만으로 충분하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> sampleSize <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> sampleStep <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>sampleSize <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 예시로 0번 채널만 가져옴</span>\n<span class=\"token keyword\">const</span> peaks <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> resultsPeaks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 딱 샘플 레이트 길이인 44100개의 피크만 수집할 것이다.</span>\n<span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sampleRate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> newPeakIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>newPeakIndex <span class=\"token operator\">*</span> sampleSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> end <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>newPeakIndex <span class=\"token operator\">+</span> sampleSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> min <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> sampleIndex <span class=\"token operator\">=</span> start<span class=\"token punctuation\">;</span> sampleIndex <span class=\"token operator\">&lt;</span> end<span class=\"token punctuation\">;</span> sampleIndex <span class=\"token operator\">+=</span> sampleStep<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> v <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">[</span>sampleIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">></span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      max <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">&lt;</span> min<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      min <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  resultPeaks<span class=\"token punctuation\">[</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> newPeakIndex<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> max<span class=\"token punctuation\">;</span>\n  resultPeaks<span class=\"token punctuation\">[</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> newPeakIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> min<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>좀 복잡해보이지만 이 코드를 한마디로 표현하면 다음과 같다.</p>\n<blockquote>\n<ol>\n<li>샘플 레이트만큼 이터레이션을 돈다.</li>\n<li>특정 길이의 2차 샘플 구간을 정하고 그 구간 내에서 최대값과 최소값을 찾는다.</li>\n<li>resultPeaks 배열의 짝수 인덱스에 최대값을, 홀수 인덱스에는 최소값을 삽입한다.</li>\n</ol>\n</blockquote>\n<p><code class=\"language-text\">resultsPeaks</code>배열에 값을 저장할 때 <code class=\"language-text\">2 * newPeakIndex</code>와 같이 배열의 크기를 2배로 해주는 이유는 피크를 한번 이터레이션 돌 때 <code class=\"language-text\">max</code>와 <code class=\"language-text\">min</code> 최대 2개의 값을 저장해야하기 때문이다.</p>\n<p>이렇게 해서 필자는 적당히 압축된 <code class=\"language-text\">88200</code> 길이의 피크 배열 하나를 얻게 되었다.</p>\n<h3 id=\"이제-진짜-그려보자\" style=\"position:relative;\">이제 진짜 그려보자!<a href=\"#%EC%9D%B4%EC%A0%9C-%EC%A7%84%EC%A7%9C-%EA%B7%B8%EB%A0%A4%EB%B3%B4%EC%9E%90\" aria-label=\"이제 진짜 그려보자 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>그리는 방법은 생각보다 단순하다. 위에서 뽑아온 피크 배열을 순회돌면서 그려주기만 하면 된다.</p>\n<p>SVG의 <code class=\"language-text\">path</code> 엘리먼트는 <code class=\"language-text\">d</code> 속성에 담긴 문자열을 분석하여 선을 그려준다. 이때 <code class=\"language-text\">M</code>은 Move, 그림을 그릴 포인터를 옮기는 명령어이고 <code class=\"language-text\">L</code>은 Line, 지정한 곳까지 선을 긋는 명령어이다.</p>\n<p>즉, 우리는 포인터를 옮기고 선을 긋는 행위를 반복하면 되는 것이다. 아까 필자가 짝수 인덱스에는 최대 값을 담고 홀수 인덱스에는 최소값을 담아준 이유가 바로 여기에 있다. 이터레이션을 돌면서 짝수 인덱스 일때는 <code class=\"language-text\">M</code> 명령어를 사용하여 포인터를 옮기고 홀수 인덱스 일때는 <code class=\"language-text\">L</code> 명령어를 사용하여 선을 그리려고 한 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">draw</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioBuffer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> peaks <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>peaks<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> totalPeaks <span class=\"token operator\">=</span> peaks<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> peakIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> peakIndex <span class=\"token operator\">&lt;</span> totalPeaks<span class=\"token punctuation\">;</span> peakIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        d <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> M</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>peaks<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        d <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> L</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>peakNumber <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>peaks<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElementNS</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://www.w3.org/2000/svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributeNS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waveFormPathGroup<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">Math.floor(peakNumber / 2)</code>는 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span>축, <code class=\"language-text\">peaks.shift()</code>는 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span>축을 의미한다. 이 코드는 대략 이런 식으로 작동할 것이다. 앞에 붙은 숫자는 피크의 인덱스라고 생각하자.</p>\n<blockquote>\n<ol>\n<li>(0, 100)으로 포인터 이동</li>\n<li>(0, -25)으로 선을 긋는다.</li>\n<li>(1, 300)으로 포인터 이동</li>\n<li>(1, -450)으로 선을 긋는다.</li>\n<li>쭉쭉 반복</li>\n</ol>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/2bef9/svg-graph.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVR42q1Ui3KDMAzj/792KwTIy56kBFq6lrG7cpdzcCxZdgyDf/gZrgTZ4cWuEdZatQwA7WHNus3Za0oifo7b7HtC7kFgJGAwFcXotq7tDPZ/hFS0zG4RBPRhL8LYCadRpH8TkgiqPAEMkNGCrIap+aQQ4GnywnNimASY+tDXndBKFUhqALoTBvecepKkBGUOra84Uxz2O2FCUAgAIqgweFk83769rLB4z+OI/Qrfl2eejTdP8GUkS4yjryt+UljaRVBN2BQuLxQycVNWw72Slz1UH0ncwSpZ5SVdxqHk2AlZOjDnt4xylZm+uStEqSLEYmva2fz+Ug5zSLuNBMmhgOMjNfDtt6wW5XNCf5ivbf36iuKFOTz/mO2yf/j03+YHjbqjJKikfkgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"svg graph\" title=\"\" src=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/6af66/svg-graph.png\" srcset=\"/static/1118d0dac6e09f7762f18b1e9a75eae3/69538/svg-graph.png 160w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/72799/svg-graph.png 320w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/6af66/svg-graph.png 640w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/d9199/svg-graph.png 960w,\n/static/1118d0dac6e09f7762f18b1e9a75eae3/2bef9/svg-graph.png 1024w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>저 과정을 반복하면 대략 이런 모양의 작대기들이 그려진다</small>\n</center>\n<p>우리가 그리려는 오디오 파형은 디지털 신호를 표현한 것이기 때문에 위에서 우리가 봤던 오디오 신호의 예시처럼 연속적인 아날로그로는 표현이 불가능 하다. 그래서 이렇게 작대기를 쭉쭉 그어가면서 표현해야하는 것이다. 이렇게 보면 상당히 허접한 그림이 나올 것 같지만, 저 선이 88,200개가 겹쳐있으면 꽤 그럴싸해보인다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/3c1e5/two-dimension.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3klEQVR42k2Pu0pDYRCEzxv6CPoAFmITFEQtUhhELSyCoHiBFFGCl0RiMELUKMGgNtqoiI9g4eWQnf38f3LkZGDYYXdY+BKC3MnluePelWeFLBt6kEL6BZaO9IKS955zvy9eL53nM+ehJvoV0d0UrSXRXhG9PdFZF6eLxsmccTRjVCeNnXGjVRJ3od9eFR99J3npiNtt8dR0HmvD482WuFgTx7NGY8G4KovzZXFYMA6mg6eM3QmjPGbU543rDdEsirdueOgZzigmGUJ0xPxH8og7yJB/4PszzN+8G5H/AOW3I13BHvjUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"two dimension\" title=\"\" src=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/6af66/two-dimension.png\" srcset=\"/static/4fc99e0799e666c130dfd81d1d0d3bae/69538/two-dimension.png 160w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/72799/two-dimension.png 320w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/6af66/two-dimension.png 640w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/d9199/two-dimension.png 960w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/21b4d/two-dimension.png 1280w,\n/static/4fc99e0799e666c130dfd81d1d0d3bae/3c1e5/two-dimension.png 2854w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>작대기도 잘 그으면 예술이 된다</small>\n</center>\n<p>자, 이렇게 오디오 파형을 심플하게 그려보았다. 여기까지 해놓고 하는 말인데… 사실 <a href=\"https://github.com/katspaugh/wavesurfer.js\" target=\"_blank\" rel=\"nofollow\">WaveSurfer</a>라고 이거 해주는 라이브러리가 있다. 기능도 더 많다.</p>\n<p>그냥 내 손으로 한번 직접 그려보고 싶었다.</p>\n<h2 id=\"음악-주세요-dj\" style=\"position:relative;\">음악 주세요 DJ<a href=\"#%EC%9D%8C%EC%95%85-%EC%A3%BC%EC%84%B8%EC%9A%94-dj\" aria-label=\"음악 주세요 dj permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>파형만 그리기는 좀 아쉬우니 막간을 이용해서 메소드 하나만 더 만들어보자. 바로 이 음악을 재생하는 기능이다.\n원래 이 메소드를 만들 때 필자의 의도는 “음악이라도 좀 들으면서 만들자”였는데 이거 만들면서 같은 곡을 너무 많이 들어서 조금 질려버렸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">play</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">buffer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sourceBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">createBufferSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span>buffer <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioContext<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sourceBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">AudioContext.prototype.createBufferSource</code> 메소드는 <code class=\"language-text\">AudioNode</code> 중 하나인 <code class=\"language-text\">AudioBufferSourceNode</code>라는 친구를 생성하는 메소드인데, 이 <code class=\"language-text\">AudioNode</code>에게 우리가 지금까지 가지고 놀았던 <code class=\"language-text\">AudioBuffer</code>를 넘겨주면 진짜 오디오적인 컨트롤을 할 수가 있게 도와주는 음…껍데기 같은 느낌이다.</p>\n<p><code class=\"language-text\">Web Audio</code> API는 이런 <code class=\"language-text\">AudioNode</code>들을 서로 연결해서 소리를 변조할 수 있는 기능을 제공하기 때문에 이걸 사용해서 컴프레서나 리버브 같은 오디오 이펙터도 만들 수 있다. 다음에는 한번 오디오 이펙터를 만들어보는 것을 목표로 해야겠다.</p>\n<p>완성된 샘플의 소스는 필자의 <a href=\"https://github.com/evan-moon/simple-waveform-visualizer\" target=\"_blank\" rel=\"nofollow\">깃허브 레파지토리</a>에서, 라이브 데모는 <a href=\"https://simple-audio-waveform.herokuapp.com/\" target=\"_blank\" rel=\"nofollow\">여기서</a> 확인할 수 있다.</p>\n<p>이상으로 컴퓨터는 어떻게 소리를 들을까? 포스팅을 마친다.</p>","fields":{"slug":"20190710-javascript-audio-waveform","path":"/2019/07/10/javascript-audio-waveform/","lang":"ko"},"frontmatter":{"title":"컴퓨터는 어떻게 소리를 들을까?","subTitle":"샘플링, 비트 레이트, Web Audio API로 보는 소리의 디지털 변환","date":"Jul 10, 2019","categories":["프로그래밍","오디오"],"tags":["Sound Engineering","사운드 엔지니어","나이퀴스트","Logic Pro X","로직프로","Cubase","큐베이스","Analog to Digital","AD Covert","Digital to Analog","DA Covert","샘플링","Sampling","Sample Rate","AudioContext","Bit Rate","자바스크립트","JavaScript Audio API"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/6cd3149c200b28430bab8288d044aa4c/3a812/thumbnail.jpg","srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/3a812/thumbnail.jpg 320w,\n/static/6cd3149c200b28430bab8288d044aa4c/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/fc5c5/thumbnail.webp 320w,\n/static/6cd3149c200b28430bab8288d044aa4c/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/6cd3149c200b28430bab8288d044aa4c/2d839/thumbnail.jpg","srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/6cd3149c200b28430bab8288d044aa4c/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"slug":"20190710-javascript-audio-waveform-en","previous":{"fields":{"slug":"20190704-danger-of-data-driven-en","path":"/2019/07/04/danger-of-data-driven/en/","lang":"en","postGroup":"20190704-danger-of-data-driven"},"frontmatter":{"title":"Is Data-Driven Decision Making Really Flawless?"}},"next":{"fields":{"slug":"20190714-what-is-random-en","path":"/2019/07/14/what-is-random/en/","lang":"en","postGroup":"20190714-what-is-random"},"frontmatter":{"title":"Is the Randomness Your Computer Creates Actually Random?"}},"lang":"en","postGroup":"20190710-javascript-audio-waveform"}},"staticQueryHashes":["3129619726","3523904809","376081736","650499039"],"slicesMap":{}}