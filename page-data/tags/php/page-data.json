{"componentChunkName":"component---src-templates-tag-page-template-index-tsx","path":"/tags/php/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"386bf9f9-3691-5002-818f-bc32442320c6","tableOfContents":"<ul>\n<li>\n<p><a href=\"#express-checkout%EC%9D%B4%EB%9E%80\">Express Checkout이란?</a></p>\n<ul>\n<li><a href=\"#paypal-standard\">Paypal Standard</a></li>\n<li><a href=\"#express-checkout\">Express Checkout</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#express-checkout%EC%9D%98-%ED%9D%90%EB%A6%84\">Express Checkout의 흐름</a></p>\n</li>\n<li>\n<p><a href=\"#client%EB%A7%8C%EC%9C%BC%EB%A1%9C-%EC%A7%84%ED%96%89%ED%95%98%EA%B8%B0\">Client만으로 진행하기</a></p>\n</li>\n<li>\n<p><a href=\"#client%EC%99%80-server%EC%9D%98-%ED%86%B5%EC%8B%A0%EC%9C%BC%EB%A1%9C-%EC%A7%84%ED%96%89%ED%95%98%EA%B8%B0\">Client와 Server의 통신으로 진행하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%8B%A4%ED%96%89%EA%B2%B0%EA%B3%BC\">실행결과</a></p>\n</li>\n</ul>","excerpt":"이번 포스팅에서는 Paypal의 RESTful API인 Express Checkout을 사용하는 방법에 대해서 포스팅 하려고 한다. 진행하기에 앞서 먼저, 페이팔 샌드박스 홈페이지에 접속해서 sandbox용 계정을 만들어야 한다.","html":"<p>이번 포스팅에서는 Paypal의 RESTful API인 Express Checkout을 사용하는 방법에 대해서 포스팅 하려고 한다. 진행하기에 앞서 먼저, <a href=\"https://www.sandbox.paypal.com/\" target=\"_blank\" rel=\"nofollow\">페이팔 샌드박스 홈페이지</a>에 접속해서 sandbox용 계정을 만들어야 한다.</p>\n<!-- more -->\n<p>이 계정으로 테스트를 진행하고 실제 운영 계정은 <a href=\"https://www.paypal.com/kr/home\" target=\"_blank\" rel=\"nofollow\">페이팔 홈페이지</a>에서 회원가입하면 된다.</p>\n<h2 id=\"express-checkout이란\" style=\"position:relative;\">Express Checkout이란?<a href=\"#express-checkout%EC%9D%B4%EB%9E%80\" aria-label=\"express checkout이란 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Paypal에서 제공해주는 결제 플로우 방식 중 하나이며, 유저가 “페이팔로 구매하기” 버튼을 클릭했을 때 페이팔 로그인 Modal window가 렌더되고, 이를 통해 결제를 진행하는 플로우이다.\n모든 국가를 지원하며, 브라우저 지원은 다음과 같다.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Internet Explorer</th>\n<th align=\"center\">Chrome</th>\n<th align=\"center\">Mozila Firefox</th>\n<th align=\"center\">Safari</th>\n<th align=\"center\">Opera</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">v9~</td>\n<td align=\"center\">v27~</td>\n<td align=\"center\">v30~</td>\n<td align=\"center\">v5.1~</td>\n<td align=\"center\">v23~</td>\n</tr>\n</tbody>\n</table>\n<p>Paypal에서는 총 3가지의 결제플로우를 제공하고 있으며, 한국에서는 이 중 All countries로 제공되는 다음 2가지 방식 중 선택이 가능하다.</p>\n<h3 id=\"paypal-standard\" style=\"position:relative;\">Paypal Standard<a href=\"#paypal-standard\" aria-label=\"paypal standard permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Paypal에서 제공해주는 HTML코드를 기반으로 생성된 버튼을 웹 클라이언트 소스에 직접 삽입하는 방식이다.\nPaypal사이트에서 직접 상품 이름, 상품 ID, 가격 등을 입력하면 그에 맞는 버튼의 코드를 자동으로 생성해준다. 이후 그 코드를 클라이언트 소스에 삽입하면 된다.</p>\n<h3 id=\"express-checkout\" style=\"position:relative;\">Express Checkout<a href=\"#express-checkout\" aria-label=\"express checkout permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Paypal의 JavaScript SDK인 checkout.js를 사용하여 버튼을 동적으로 렌더하는 방식이다.\n상품 데이터를 본인 서비스의 서버로 전달한 후 Server to Server방식으로 Paypal서버에서 인증을 받는 방식으로 진행된다. 필자는 이 방법을 선택하였다.</p>\n<h2 id=\"express-checkout의-흐름\" style=\"position:relative;\">Express Checkout의 흐름<a href=\"#express-checkout%EC%9D%98-%ED%9D%90%EB%A6%84\" aria-label=\"express checkout의 흐름 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>이 섹션은 Paypal Developer 페이지의 <a href=\"https://developer.paypal.com/docs/orders-integration-guide/?mark=express%20checkout#\" target=\"_blank\" rel=\"nofollow\">Express Checkout</a>항목을 참고하여 작성하였다.</p>\n</blockquote>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/01dae/flow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 19.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVR42lWNTU+DQBiE+f8/xysn9aAXJWlso5QIhV0KpYHly93l6xEajfFJ5jAzed9xwuDIKfCRUqCqipcg4f49wU/OtKpkH0kejim7T0FTK4QQhGFIkiSUZcklz0mzC7FI177GefZj7nYR8pzdgii/8nZKycuaRlXIa8XrR0iUFXRdx+FwwHVdPM+jUuo2sk9bRKEwusdp9UDRGewwskwjstY8yYZGW1j91j3GFWmjWeYJbQxFUdC2LdM0Ya2l73uM0YzjhDPPM+OwHv+wLAtfWv/5VduTLf9lGIZ/3lrDvI5tfAP9sC7SOWTQKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"express-checkout-flow\" title=\"\" src=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/6af66/flow.png\" srcset=\"/static/89c08c41f83f1354f7b221c51a4d2dcc/69538/flow.png 160w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/72799/flow.png 320w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/6af66/flow.png 640w,\n/static/89c08c41f83f1354f7b221c51a4d2dcc/01dae/flow.png 721w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>Express Checkout의 전체 플로우</small>\n</center>\n<p>쉽게 생각하면 Facebook이나 Instagram계정으로 로그인하는 플로우와 UX가 비슷하다고 보면 된다.</p>\n<p>유저가 구매버튼을 클릭하면 데스크탑에서는 팝업, 모바일에서는 새 탭의 형태로 페이팔 로그인 창이 열리고, 유저는 그 창에서 인증과 결제를 순차적으로 진행하게 된다.</p>\n<p>이후 모든 플로우가 끝나면 유저는 결제 진행 결과에 따라 페이팔에 <code class=\"language-text\">redirect_url</code>파라미터로 보내졌던 URL로 이동을 하게되며 최종적으로 성공, 실패, 취소에 따른 페이지와 결제 정보 결과를 보게 된다.\nPaypal서버와 통신하는 방법으로는 <code class=\"language-text\">RESTful API</code>와 <code class=\"language-text\">NVP/SOAP API</code>로 2가지 방법이 있으나 본 문서에서는 <code class=\"language-text\">RESTful API</code>만 기술하겠다.</p>\n<p>Paypal Express Checkout의 플로우는 다음과 같다.</p>\n<hr>\n<ol>\n<li>유저가 구매버튼을 클릭</li>\n</ol>\n<ul>\n<li>Express Checkout의 client SDK인 <code class=\"language-text\">checkout.js</code>를 통해 로그인 모달창이 열리거나 API서버가 Paypal API를 호출하여 <code class=\"language-text\">payment</code>이벤트를 초기화한다.</li>\n<li><code class=\"language-text\">payment</code> 이벤트 초기화 후, Express Checkout 플로우가 모달창 내부에서 시작된다.</li>\n</ul>\n<ol start=\"2\">\n<li>유저가 페이팔 로그인을 진행</li>\n<li>유저가 결제 정보를 확인 후 <code class=\"language-text\">Contunue</code> 버튼을 클릭</li>\n<li>유저가 <code class=\"language-text\">Continue</code> 버튼을 클릭하면 다시 서비스의 리다이렉트페이지로 이동하며 최종 결제 정보가 표시된다.</li>\n</ol>\n<p>결제 정보를 생성할 때 보냈던 상품 정보 파라미터는 이 단계에서 노출시키는 것이 좋다.\n5. 최종적으로 <code class=\"language-text\">execute</code> API가 호출되고 결제가 마무리된다. 그리고 사용자는 서비스 상의 결제완료 페이지로 리다이렉트된다.</p>\n<hr>\n<h2 id=\"client만으로-진행하기\" style=\"position:relative;\">Client만으로 진행하기<a href=\"#client%EB%A7%8C%EC%9C%BC%EB%A1%9C-%EC%A7%84%ED%96%89%ED%95%98%EA%B8%B0\" aria-label=\"client만으로 진행하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>Paypal 공식문서에서는 Express Checkout과의 버전 호환성을 최대한 보장하기 위해 CDN을 이용한 동적로딩을 추천하고 있다. 직접 <code class=\"language-text\">checkout.js</code>파일을 다운받아 클라이언트 소스에 넣는 것은 추천하지 않는다.</p>\n</blockquote>\n<blockquote>\n<p>이 문서에서의 <code class=\"language-text\">checkout.js</code>의 버전은 <code class=\"language-text\">4.0</code>으로 진행한다.</p>\n</blockquote>\n<p>지금 작성하는 플로우는 필자 서비스의 API서버를 통하지 않고 <code class=\"language-text\">checkout.js</code>를 이용하여 바로 페이팔 서버로부터 인증과 결제까지 한번에 마치는 방법이다.</p>\n<p>클라이언트에서는 데이터를 정의하고 <code class=\"language-text\">checkout.js</code>를 사용하여 Paypal결제 버튼을 렌더한다. 이 버튼을 클릭하면 <code class=\"language-text\">checkout.js</code>의 내장 메소드를 호출하여 자동으로 인증과 결제토큰생성, 결제 완료까지 한큐에 진행하게 된다.</p>\n<p>먼저, <code class=\"language-text\">checkout.js</code> SDK의 동적로딩을 위해 <code class=\"language-text\">index.html</code>파일에 <code class=\"language-text\">script</code>태그를 열고 다음 스크립트를 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> _DOM <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  _DOM<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'https://www.paypalobjects.com/api/checkout.js'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>_DOM<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이후 Paypal버튼을 DOM을 작성해주고 <code class=\"language-text\">checkout.js</code>를 사용해 버튼을 렌더한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pay-test-btn<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test to payment<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">paypal<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">env</span><span class=\"token operator\">:</span> <span class=\"token string\">'sandbox'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 테스트용은 'sandbox'를, 운영은 'production'을 입력</span>\n  <span class=\"token literal-property property\">client</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">sandbox</span><span class=\"token operator\">:</span> <span class=\"token string\">'paypal-sandbox-key'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// paypal에서 발급 받은 client_key를 입력</span>\n    <span class=\"token literal-property property\">production</span><span class=\"token operator\">:</span> <span class=\"token string\">'paypal-production-key'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">payment</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> env <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> paypal<span class=\"token punctuation\">.</span>rest<span class=\"token punctuation\">.</span>payment<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> client<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">transactions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token string\">'10.00'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">commit</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// false일 시 모달의 마지막 버튼의 문구가 Continue로 변하고 바로 결제가 진행되는 것이 아니라 리다이렉트 페이지로 이동한다.</span>\n  <span class=\"token comment\">// true일 시 Pay Now로 변하고 바로 결제가 진행된다</span>\n  <span class=\"token function-variable function\">onAuthorize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> actions</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> actions<span class=\"token punctuation\">.</span>payment<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 결제 성공 시 콜백파라미터인 res에 데이터가 담겨온다</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#pay-test-btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그러면 아래와 같이  아까 작성한 <code class=\"language-text\">#pay-test-btn</code> DOM엘리먼트에 자동으로 Paypal버튼이 렌더된다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 234px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 71.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHaVppYBf/EABoQAQEAAgMAAAAAAAAAAAAAAAECAAMQERL/2gAIAQEAAQUCXoKHhPROuZc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQEABj8COzGalP/EABkQAQACAwAAAAAAAAAAAAAAAAEAEBEhMf/aAAgBAQABPyEMjyL4NqNeDNMTX//aAAwDAQACAAMAAAAQ1A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEBAAMBAAAAAAAAAAAAAAABEQAQMSH/2gAIAQEAAT8QZPB1w6ZXAdFHfJLMBsES3X//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"paypal-button\" title=\"\" src=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg\" srcset=\"/static/5f4924c16a7d079417dcd1d09fe3ad50/0913d/paypal-button.jpg 160w,\n/static/5f4924c16a7d079417dcd1d09fe3ad50/a63a1/paypal-button.jpg 234w\" sizes=\"(max-width: 234px) 100vw, 234px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>버튼 모양이 조금 이상해졌지만 신경쓰지 말자...</small>\n</center>\n<p>정상적으로 버튼이 렌더되었다면 이제 테스트 결제를 진행해보자. 저 버튼을 클릭하면 아래와 같은 창이 하나 뜰 것이다. 이 창은 사용자의 이용환경이 데스크탑이냐, 모바일이냐에 따라 팝업창, iframe또는 새 탭으로 열릴 수 있다.</p>\n<p>이 창을 Paypal에서는 Light window라고 부르지만 이 포스팅에서는 편의상 그냥 “로그인 모달”이라고 하겠다. 이 후 사용자는 로그인 모달의 안내에 따라 결제를 진행하게 되고, 최종 결제가 완료되면 <code class=\"language-text\">onAuthorize</code>메소드에 있는 Promise Callback함수의 <code class=\"language-text\">res</code> 파라미터로 결과값을 전달받게 된다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 252px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFNcDkmMF//xAAaEAACAgMAAAAAAAAAAAAAAAACAxAUAAES/9oACAEBAAEFAlL73WGAMgyw2P/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAAGAwAAAAAAAAAAAAAAAAABAhARMiIxkv/aAAgBAQAGPwLcC6uWxOBc2//EABkQAQEBAAMAAAAAAAAAAAAAAAERABAh8f/aAAgBAQABPyEmFQXou9jkjlKieAXf/9oADAMBAAIAAwAAABDPz//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/EKf/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QEX//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhUTFB0fH/2gAIAQEAAT8QH9ZDvnRLUDIwNTTUVnSlKyT5R5FVXuf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"light-window\" title=\"\" src=\"/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg\" srcset=\"/static/6ec0fda48bf17da3be915e442d513bee/0913d/light-window.jpg 160w,\n/static/6ec0fda48bf17da3be915e442d513bee/112e4/light-window.jpg 252w\" sizes=\"(max-width: 252px) 100vw, 252px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<h2 id=\"client와-server의-통신으로-진행하기\" style=\"position:relative;\">Client와 Server의 통신으로 진행하기<a href=\"#client%EC%99%80-server%EC%9D%98-%ED%86%B5%EC%8B%A0%EC%9C%BC%EB%A1%9C-%EC%A7%84%ED%96%89%ED%95%98%EA%B8%B0\" aria-label=\"client와 server의 통신으로 진행하기 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이 플로우는 Paypal에서 발급해주는 <code class=\"language-text\">client_key</code>와 <code class=\"language-text\">secret</code>을 이용하여 페이팔 인증부터 차례대로 진행하는 방법이다.</p>\n<p>이 방법의 장점으로는 본인의 서비스의 UX플로우를 최대한 지키며 결제를 진행시킬 수 있고, 첫번째 방법보다 플로우가 유연하며 버튼 디자인또한 css로 커스터마이징이 자유롭다.</p>\n<p>그런 이유로 Paypal에서도 이 방법을 권장하고 있다. 결제플로우는 크게 3가지 단계로 나눠진다.</p>\n<hr>\n<ol>\n<li><code class=\"language-text\">client_key</code>와 <code class=\"language-text\">secret</code>을 사용하여 페이팔 서버로부터 액세스토큰을 받는 인증 과정</li>\n<li>결제를 <code class=\"language-text\">create</code>하는 과정</li>\n<li>결제를 <code class=\"language-text\">execute</code>하는 과정</li>\n</ol>\n<hr>\n<p>먼저 클라이언트는 버튼을 렌더하고 본 서비스의 API를 통해 <code class=\"language-text\">create</code>요청을 보내야한다. 이때 전 플로우와의 차이점은 딱히 <code class=\"language-text\">checkout.js</code>를 사용하지않아도 딱히 상관이 없다는 점이다. 먼저 버튼을 렌더한다. 참고로 필자는 <code class=\"language-text\">AngularJS</code>와 <code class=\"language-text\">md-material</code>을 사용하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">layout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">layout-align</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">layout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>column<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>md-button</span> <span class=\"token attr-name\">md-color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{background: 'blue-grey'}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ng-click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vm.postData()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      TEST\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>md-button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이후 Paypal 결제를 다른 페이지에서 사용하게 될때 중복로직을 작성해야하므로 따로 팩토리를 정의했다. 따로 팩토리를 정의하지 않고 컨트롤러 내부에 구현해도 상관은 없다. 이 팩토리에서는 필자의 API서버와 통신을 한 후 <code class=\"language-text\">Promise</code>를 사용하여 다시 컨트롤러로 값을 전달한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n    <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'services'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Restangular'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SNS_KEYS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$q'</span><span class=\"token punctuation\">,</span>\n      PaypalService\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalService</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$rootScope<span class=\"token punctuation\">,</span> Restangular<span class=\"token punctuation\">,</span> <span class=\"token constant\">SNS_KEYS</span><span class=\"token punctuation\">,</span> $q</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//페이팔에서 발급해준 키를 전역으로 사용하기 위해 app.constants에 미리 담아놓았다.</span>\n      <span class=\"token keyword\">var</span> clientKey <span class=\"token operator\">=</span> <span class=\"token constant\">SNS_KEYS</span><span class=\"token punctuation\">.</span>paypal<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">/**\n        * @public\n        * @name create\n        * @description create paypal payment request\n        * @param { Object } data\n        * @return { Promise }\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        data<span class=\"token punctuation\">.</span>clientKey <span class=\"token operator\">=</span> clientKey<span class=\"token punctuation\">;</span>\n        data<span class=\"token punctuation\">.</span>redirect_urls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">return_url</span><span class=\"token operator\">:</span> location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> <span class=\"token string\">'/paypal/result'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 결제가 완료되었을 때 리다이렉트될 페이지</span>\n          <span class=\"token literal-property property\">cancel_url</span><span class=\"token operator\">:</span> location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> <span class=\"token string\">'/paypal/result'</span> <span class=\"token comment\">// 결제가 취소되었을 때 리다이렉트 될 페이지, return_url과 같아도 상관없다</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API서버의 API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'paypal/payments/create'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">customPOST</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> defer<span class=\"token punctuation\">.</span>promise<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">/**\n        * @name execute\n        * @description execute paypal payment\n        * @param { Object } data\n        * @return { Promise}\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API서버의 API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/paypal/payments/execute'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">customPOST</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> defer<span class=\"token punctuation\">.</span>promise<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">/**\n        * @name getPaymentInfo\n        * @description getting created paypal payment information\n        * @param { Object } data\n        * @return { Promise }\n        */</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> defer <span class=\"token operator\">=</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">defer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// API서버의 API endpoint</span>\n        Restangular<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/paypal/payments/detail'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">customGET</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          defer<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">create</span><span class=\"token operator\">:</span> create<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">execute</span><span class=\"token operator\">:</span> execute<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">getPaymentInfo</span><span class=\"token operator\">:</span> getPaymentInfo\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이후 버튼을 렌더한 html파일에 물려있는 Controller에서 위에서 정의한 Paypal 서비스를 호출한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n    <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalCreateController'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$scope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span>\n      PaypalCreateController\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalCreateController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> vm <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">//테스트를 위한 더미데이터를 정의한다. 실서비스에는 이 데이터들이 폼에 바인딩 될 것이다.</span>\n      vm<span class=\"token punctuation\">.</span>paymentData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">transactions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'This is the description'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">item_list</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n              <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'This is test product'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">quantity</span><span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">sku</span><span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n      vm<span class=\"token punctuation\">.</span>postData <span class=\"token operator\">=</span> postData<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">postData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>paymentData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Deep Copy를 하는 이유는 데이터를 전송하기전에 변조해야할 경우가 생길 수 있기 때문이며</span>\n        <span class=\"token comment\">// Object타입은 기본적으로 Call by reference이기때문에 여기서 변조를 해버리면 원본 데이터도 함께 변조되기 때문이다.</span>\n        PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// Paypal에서는 총 3개의 url을 리턴해주는데</span>\n          <span class=\"token comment\">// links[0] = 방금 생성된 결제정보의 자세한 값을 받을 수 있는 GET메소드 요청 URL</span>\n          <span class=\"token comment\">// links[1] = 생성된 결제페이지의 리다이렉트 URL</span>\n          <span class=\"token comment\">// links[2] = 결제 실행 URL</span>\n          <span class=\"token comment\">// 순으로 나열된다.</span>\n          window<span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">.</span>links<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이때 API서버는 클라이언트에서 보내준 값들을 가지고 Paypal서버와 통신하여 인증을 진행하는 로직을 가지고 있어야한다. 필자의 API서버는 <code class=\"language-text\">Laravel 5.x</code>로 되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Log</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Requests</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">GuzzleHttp<span class=\"token punctuation\">\\</span>Client</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">PaypalPaymentController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$client</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$paymentUrl</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$accessToken</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 페이팔에서 발급받은 access token값을 env에서 가져온다</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span> <span class=\"token operator\">=</span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'PAYPAL_ACCESS_TOKEN_SANDBOX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 지금은 테스트 중이라 sandbox url로 요청을 날리고있다. 본 서비스는 sandbox를 제거하고 api.paypal.com으로 날리면 된다.</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"https://api.sandbox.paypal.com/v1/payments/payment\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">detail</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$query</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'paymentId'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">payment</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'POST'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application.json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'json'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// Paypal서버에 날릴 요청의 Body, 페이팔 공식사이트에 적혀있는 파라미터와 동일해야한다.</span>\n                <span class=\"token string double-quoted-string\">\"intent\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"sale\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"redirect_urls\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">redirect_urls</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"payer\"</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string double-quoted-string\">\"payment_method\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"paypal\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 한국은 paypal메소드밖에 지원이 안된다</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"transactions\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">transactions</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// client에서 보내준 결제 정보</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$response</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">client</span><span class=\"token operator\">-></span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'POST'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">paymentUrl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">paymentId</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/execute'</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"Content-Type\"</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string double-quoted-string\">\"Authorization\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">accessToken</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'json'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string double-quoted-string\">\"payer_id\"</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">PayerID</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">getContents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$decodeResult</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$decodeResult</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이제 클라이언트에서 테스트 버튼을 클릭하면 미리 필자가 정의한 API인 <code class=\"language-text\">/paypal/payment/create</code>를 통해 필자의 API 서버로 결제 데이터가 전송되고, API서버는 다시 그 데이터를 가지고 Paypal 서버와 통신 후 클라이언트로 결과를 반환해 줄 것이다. 그 후 클라이언트는 리턴된 데이터의 <code class=\"language-text\">link[1]</code>에 담긴 리다이렉트페이지를 그냥 열기만 하면 결제가 시작된다!</p>\n<p>왜 <code class=\"language-text\">link[1]</code>인지는 아래에서 다시 설명하겠다.</p>\n<p>이후 사용자는 Paypal 로그인 상태에 따라 로그인페이지 또는 결제 확인 페이지로 이동하게되며, Paypal의 결제 확인 창에서 Continue 버튼을 누르면 아까 우리가 <code class=\"language-text\">create</code> API를 통해 보내놓았던 <code class=\"language-text\">redirect_url</code>페이지로 랜딩된다.</p>\n<p>이때 Paypal은 사용자가 최종 결제 확인을 했고, 이제 결제를 시작해도 된다는 데이터를 <code class=\"language-text\">redirect_url</code>뒤에 쿼리스트링의 형태로 붙혀서 보내준다.</p>\n<p>이제 클라이언트와 서버의 기본적인 로직이 모두 준비되었다! 전체적인 플로우를 다시 설명하면 다음과 같다.</p>\n<hr>\n<ol>\n<li>클라이언트에서 API서버로 결제 생성 요청을 보낸다.</li>\n<li>API서버는 받은 데이터를 가지고 다시 Paypal서버로 결제 생성 요청을 보내고 이후 클라이언트로 값을 반환해준다.</li>\n<li>클라이언트는 반환받은 데이터에 있는 <code class=\"language-text\">redirect_url</code>로 사용자를 리다이렉트 시킨다.</li>\n<li>이후 사용자는 이동한 Paypal페이지에서 로그인 및 간략한 결제정보 확인을 마치고 <code class=\"language-text\">Continue</code> 버튼을 클릭한다.</li>\n<li><code class=\"language-text\">Continue</code> 버튼이 클릭되면 Paypal은 결제 생성 요청에 담겨있던 <code class=\"language-text\">redirect_url</code>로 사용자를 리다이렉트 시킨다.</li>\n<li>이후 사용자는 리다이렉트된 페이지에서 최종 결제전 상세 결제 정보를 확인한다.</li>\n<li>사용자가 “최종결제”버튼을 클릭하면 클라이언트는 결제 실행 요청을 API서버로 보낸다.</li>\n<li>API서버는 다시 Paypal서버로 이 요청을 전달하고, 클라이언트로 값을 반환해준다.</li>\n<li>결제의 실행결과에 따라 사용자는 해당 페이지로 다시 리다이렉트된다.</li>\n</ol>\n<hr>\n<p>뭔가 굉장히 복잡해 보이지만 잘 보면 API 서버는 거의 그냥 통신 셔틀이라고 보면 된다.</p>\n<p>그러면 그냥 “Paypal서버와 다이렉트로 통신하면 안될까?” 라고 생각할 수 있지만 이는 보안과 직결되는 문제이다. Paypal 서버와 통신을 하기 위해서는 <code class=\"language-text\">client_key</code>와 <code class=\"language-text\">secret</code>이 필요한데, API 서버를 중개하지 않고 Paypal 서버와 바로 통신을 하려면 클라이언트가 이 2개의 값을 다 가지고 있어야 한다는 뜻이 된다.</p>\n<p>하지만 알다시피 웹 상에서 클라이언트 소스는 공개되기가 쉽고 난독화를 한다고 해도 Object의 <code class=\"language-text\">key</code>같은 <code class=\"language-text\">String</code>변수는 난독화되지 않기 때문에 악의를 가진 사용자가 손쉽게 <code class=\"language-text\">client_key</code>와 <code class=\"language-text\">secret</code>을 탈취할 수 있다. 그래서 상대적으로 안전한 서버에 <code class=\"language-text\">secret</code>을 저장하고 클라이언트에는 <code class=\"language-text\">client_key</code>만 저장하는 식으로 2개의 값을 한번에 볼 수 없도록 나눠 놓는다.</p>\n<h2 id=\"실행결과\" style=\"position:relative;\">실행결과<a href=\"#%EC%8B%A4%ED%96%89%EA%B2%B0%EA%B3%BC\" aria-label=\"실행결과 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>먼저, API서버를 통해 create 요청을 진행한 결과, 필자는 다음과 같은 response를 받을 수 있었다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ee391623f4d89ab9517f34c1a64c178c/5bb8b/result1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGUlEQVR42lWQ6U7DMBCE8zKotEmatInvM0ebFIQqJBAS7/8ew9oRVPz4tJ61tZ7ZgtsF7Unj3Dt0zIEJn+mYRc8fOpG0NBGKECpAyIDmZFDWCnWjUVYShVg+8HJfEccAJi2U9YQDV3Q2Dpq0tluVpOMU4YcI6wNsCCiPEk87ht2eY3/gKHh4zQ/OTNMvEsd2o/6tzaNWjUB1FKSJ09Zn0tBHlhIY7EuBQq2f2eHX94rxMoCTS6lddsuVyzq5TQjqC+op43OSnm994zy9SwPJobq8Y327YrlNdBFgfMxI7bN2YaB4cashYl5mzNeZoo+0ppF6yYTH80EQKfJ0zwPjtO2jPSu0nf6LnknxKHKZ4/5fSSKtIQ1LA38AHnLHaTWOUI4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result1\" title=\"\" src=\"/static/ee391623f4d89ab9517f34c1a64c178c/6af66/result1.png\" srcset=\"/static/ee391623f4d89ab9517f34c1a64c178c/69538/result1.png 160w,\n/static/ee391623f4d89ab9517f34c1a64c178c/72799/result1.png 320w,\n/static/ee391623f4d89ab9517f34c1a64c178c/6af66/result1.png 640w,\n/static/ee391623f4d89ab9517f34c1a64c178c/5bb8b/result1.png 749w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>links라는 배열을 하나 받았는데, 각 인덱스의 의미는 이렇다.</p>\n<hr>\n<p><code class=\"language-text\">0</code> - 결제의 상세 정보를 GET메소드로 확인해볼 수 있는 API의 URI</p>\n<p><code class=\"language-text\">1</code> - Paypal의 결제페이지로 리다이렉트 시키는 URL</p>\n<p><code class=\"language-text\">2</code> - 결제를 실행시킬 수 있는 URL</p>\n<hr>\n<p>아까 위에서 설명한 <code class=\"language-text\">links[1]</code>의 의미를 이제 알 수 있을 것이다. 그리고 보내진 url의 host를 보면 전부 <code class=\"language-text\">sandbox.*</code>로 시작하는데 이는 현재 sandbox 계정을 사용하여 테스트를 진행하고 있다는 뜻이다. 실제 운영 API에는 저 sandbox 부분이 빠져있다.</p>\n<p>그리고 이제 <code class=\"language-text\">links[1]</code>의 url로 리다이렉트를 시키면 당연히(…) 저 값들은 먼지가 되어 사라지게 된다. 쿠키에 담든 어떻게 사용은 할 수 있겠지만 어차피 또 보내주니까 미련없이 버리자.</p>\n<p>필자도 리다이렉트를 안시키고 팝업으로 저 페이지를 열어보았는데 <code class=\"language-text\">401 Unauthrized</code>를 뱉으며 결제정보가 장렬히 산화하는 모습을 볼 수 있었다…</p>\n<p>하지만 어차피 Paypal에 <code class=\"language-text\">create</code> 요청을 날린 시점에서 Paypal 서버에는 필자가 처음 보낸 <code class=\"language-text\">redirect_url</code>값이 저장되어있기 때문에 사용자가 Paypal 페이지에서 결제확인을 완료하게 되면 다시 주도권은 필자 서비스로 돌아오게 된다.</p>\n<p>자 이제 리다이렉트를 시켜보자.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 455px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHvTNpoX//EABoQAAICAwAAAAAAAAAAAAAAAAARAQIQEiH/2gAIAQEAAQUCLNGvYhY//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAABABESExMv/aAAgBAQAGPwIwupN2v//EABsQAAIDAAMAAAAAAAAAAAAAAAABESFBMWFx/9oACAEBAAE/IVpopPsXFjZtXOUQIbeiT//aAAwDAQACAAMAAAAQL8//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAwEBPxCn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAQEAAgMBAAAAAAAAAAAAAREAIVExQaFh/9oACAEBAAE/ECDHfOgzuAWZqGL+ZcDKwwfM3nHbN+G4et//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"redirect1\" title=\"\" src=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg\" srcset=\"/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/0913d/redirect1.jpg 160w,\n/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/cb69c/redirect1.jpg 320w,\n/static/f5ec8d06a213e8a6b2fe1fb84ff6d13d/7cd9c/redirect1.jpg 455w\" sizes=\"(max-width: 455px) 100vw, 455px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>그러면 이런 화면이 하나 뜬다. 만약 Paypal에 로그인이 안되어있다면 먼저 로그인페이지로 이동 후 로그인이 완료되면 이 페이지로 이동하게 될 것이다.</p>\n<p>이 페이지에서 유저는 자신이 결제할 금액을 확인할 수 있으며 오른쪽 상단에 있는 카트모양 아이콘을 누르면 조금 더 상세한 정보가 나오긴 한다. 근데 알아보기 힘들 정도로 간략하게 적혀있어서 딱히 의미는 없을 것 같았다.</p>\n<p>그리고 필자가 요청을 날린 통화 단위는  유로화로 등록이 되어있던 상품이었지만 Paypal에서는 자동으로 사용자의 국가의 환율로 자동 환산을 해준다. 이제 사용자가 모든 항목을 확인하고 <code class=\"language-text\">Continue</code> 버튼을 누르면 필자가 처음 <code class=\"language-text\">create</code>시 보냈던 <code class=\"language-text\">redirect_url</code>로 이동이 시작된다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVR42q2SywrCMBBF+///pOKuUv0AKdq6KNjaPBsSbRbXJOBCUBOjiwMhMxxyJ1PM84wYk1JQjnd1a22oc85RUMaQAkvsSxbSfwkJpRgJCfjzT0IvkFLCaB2QUoDkCr1MCIH9ocF6U2FVVqiPbbj79NK40EmW5Q6Lcou6OeULH9LJRb4ajZsxIX5sjkWs4etP4S4Ccwv5iqy16boO575HPwxPXMYxS3gHfvlCUe7xvscAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"redirect2\" title=\"\" src=\"/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png\" srcset=\"/static/b34365fda4b25226be0676994e510290/69538/redirect2.png 160w,\n/static/b34365fda4b25226be0676994e510290/72799/redirect2.png 320w,\n/static/b34365fda4b25226be0676994e510290/33b38/redirect2.png 448w\" sizes=\"(max-width: 448px) 100vw, 448px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>이 페이지는 필자가 테스트를 위해 임시로 만들어 놓은 페이지이고 실제 운영서버였다면 이 페이지는 최종결제 전 마지막으로 정보를 확인할 수 있는 페이지가 될 것이다.\n이때 주목해야할 것은 이 페이지의 URL이다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b7ad2e818105d647d8e8498a1af1e86b/9f82e/url.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 2.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42mN4/vz5fxB++fIlGIPY796+/X/95q3/Nd1T/tf1Tf1f1wvCUyB0HwQ39E37X9bW93/fkeP/v3/98n/d9t3/O6bN/Q8AULA+Y3mH7csAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"url\" title=\"\" src=\"/static/b7ad2e818105d647d8e8498a1af1e86b/6af66/url.png\" srcset=\"/static/b7ad2e818105d647d8e8498a1af1e86b/69538/url.png 160w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/72799/url.png 320w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/6af66/url.png 640w,\n/static/b7ad2e818105d647d8e8498a1af1e86b/9f82e/url.png 820w\" sizes=\"(max-width: 640px) 100vw, 640px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>쿼리스트링으로 페이팔이 보내준 <code class=\"language-text\">paymentId</code>와 <code class=\"language-text\">token</code>, <code class=\"language-text\">PayerID</code>가 들어있다. 그럼 이제 저 값들을 사용해서 다음 플로우를 진행하면 된다.</p>\n<p>이 페이지의 Controller는 저 값들을 사용하여 디테일한 결제정보를 받아오는 로직과 결제를 실행하는 로직을 가진 메소드로 이루어져있다. 혹시 아까 위에서 정의한 Paypal서비스의 로직이 기억나지 않는다면 위에서 다시 보고 오자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n  angular\n  <span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app.pages.product'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaypalRedirectController'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'$rootScope'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Restangular'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PaypalService'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$location'</span><span class=\"token punctuation\">,</span>\n    PaypalRedirectController\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/** @ngInject */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">PaypalRedirectController</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">$rootScope<span class=\"token punctuation\">,</span> Restangular<span class=\"token punctuation\">,</span> PaypalService<span class=\"token punctuation\">,</span> $location</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> vm <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> queryString <span class=\"token operator\">=</span> $location<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 페이팔에서 보내준 쿼리스트링을 가져온다</span>\n\n    vm<span class=\"token punctuation\">.</span>init <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>init<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @public\n     * @method executePaypal\n     */</span>\n    vm<span class=\"token punctuation\">.</span>executePaypal <span class=\"token operator\">=</span> executePaypal<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">executePaypal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 실제 결제 실행 메소드</span>\n      PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'EXECUTE RESULT -> '</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @private\n     * @method getPaymentInfo\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 결제 정보 받아오는 메소드</span>\n      PaypalService<span class=\"token punctuation\">.</span><span class=\"token function\">getPaymentInfo</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET PAYMENT INFO -> '</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>필자는 해당 페이지에 있는 버튼에 <code class=\"language-text\">excutePaypal</code>메소드를 클릭 이벤트로 걸어놓았다.\n이제 유저가 저 버튼을 클릭하면 최종 결제가 실행되고 결과를 <code class=\"language-text\">response</code>로 받아볼 수 있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 381px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 198.12500000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAoABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB8+dyyAdIoQ0Vocwf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAECEDH/2gAIAQEAAQUCXHkldFzJHklLP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BX//EABcQAAMBAAAAAAAAAAAAAAAAAAAwMVH/2gAIAQEABj8C0jv/xAAfEAACAgEEAwAAAAAAAAAAAAAAAREhQRAxcZFRYYH/2gAIAQEAAT8halBpwT5PptGay70eKIfJXkk6Eh4J9C7syOOyD//aAAwDAQACAAMAAAAQczmzgD//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPxAr/8QAFxEAAwEAAAAAAAAAAAAAAAAAARAxIP/aAAgBAgEBPxA3Bq//xAAfEAEAAgICAgMAAAAAAAAAAAABABEhMUGRUWFxgaH/2gAIAQEAAT8QqYKrqVk9waSnkdx5FaYg1PIqYtt5+4W0eY7cj4NSoVEYN3FWih5S5bw6iUBfERKg6xb8lvfU/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"\" src=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg\" srcset=\"/static/0a41c8ee9d6bbef09c3fee2378861cec/0913d/result.jpg 160w,\n/static/0a41c8ee9d6bbef09c3fee2378861cec/cb69c/result.jpg 320w,\n/static/0a41c8ee9d6bbef09c3fee2378861cec/ac471/result.jpg 381w\" sizes=\"(max-width: 381px) 100vw, 381px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <br>\n</center>\n<p>정상적으로 결제가 진행되고 Paypal 서버가 보내준 결과이다. <code class=\"language-text\">payer.status</code>가 <code class=\"language-text\">approved</code>라면 정상적으로 결제가 승인된 것이다. 이제 실제로 결제가 승인되었고 돈이 제대로 들어왔는지 확인해볼 차례이다.</p>\n<p>페이팔의 <a href=\"https://www.sandbox.paypal.com/\" target=\"_blank\" rel=\"nofollow\">샌드박스 페이지</a>에 접속해서 구매자 계정으로 확인해보면 구매내역에 정상적으로 12유로가 출금 되었다고 나와있는 것을 볼 수 있다. 판매자 계정에도 정상적으로 12유로가 들어왔다고 적혀있다.</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 607px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42o3OTW8SURSH8flCzlBe09agqWnVFu2LKahtYtRSbSkWxW7cunHp3sSVG6VAtUCBDgMYFyaamLhuU4jWBBppOiAzBeHxQt0YXXiSX87Jvbn/e6TBRzk8L95x9omGM6jiCqmiZ3EEstiX0lj9KawLKQZuCTeTKPOvkWcjKHNvsFyLo/jiyN44A7MxTs1EkS480/B/rOJNfGI4lOT8mspIKMPIahrHYlIECgtJEbYpJLD4IlgnniOLMNf1KDbfOoo3insuijITQXI/fo/n5WfOPf2Aa6XIcLDAUEBj8K6KdTGHfbmA7U4em18TW+Zwiu5eymO9sc1pf54hcWafz3LmtobtahrJ4llFvhhAHl/BcknME0HsUw9wXVnDOR3uc00/xDkVxnH5Ps5JcTcZxjp+D3lsGXn0hDIawDIWQEpsbZHKZvp682YqRWY7Sy6voQr5YpH1jQ1exWIU3hbFWQ61oJHJqSTSaZKZ37InpHa7zdGRTrNp0KtuF1qd/ohpmvTu/6e64mGPpOt1yuUy1YMDmobRD+h0OtSNFjtfvlEq7bFXKvF1f7/ve632h9rhIZVqlZ3dXfR6A8k0W1Qq1b82MVs/0X8Y6LpOvdHAENv2Pmwa5j/1wgzzmF+1GNs2Kr/V5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"customer\" title=\"\" src=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png\" srcset=\"/static/96ceab0902c02bc5b934f2ff0b0154d5/69538/customer.png 160w,\n/static/96ceab0902c02bc5b934f2ff0b0154d5/72799/customer.png 320w,\n/static/96ceab0902c02bc5b934f2ff0b0154d5/ef9e5/customer.png 607w\" sizes=\"(max-width: 607px) 100vw, 607px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>샌드박스의 구매 테스트 계정. 12유로가 출금 되었다.</small>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACTElEQVR42l1Ta2/TQBD0//9FCEEpjSiUqmkFaQlOHZ/fbyf22Y6fGeZO6YdiabR7q9vx7OOMRtZwLROR5+BhY+Fm/Rc3D1tc37/g25OJz3fPWPG8Wm9xdf+M9cseTdejbk4asn0PI4wTmLsdItov3x9xdfuIj6s1ru9+4+rHL9oNPqwe8On2CV9/bnBzv4EpAuwIZbd7/x2MXpY4RhZk5qHNHPSFg2U8QX3LMuNMKDvPM8bpzZ/Q9yOGYcL/n3E69QiCEGEUIY5TeJ4Px3V5jiGbFrVstD3WDbJSskwVa5EfJMqqxTQv72CM04S8PKI4VDopzUvEac7kA8YFGtOZoJ3Pl/PFn5YzTuN8wYKeFRh1XcN2PbhU5gYJexPDtCM4QYo/OxfbV58/O6K5NL3p3tBTYYO9m0D4GfMiROmBhCxpszWZLGDuPXhRCjeMaRP49IMk18iZXNQtClrtEyXPyk8PNZKyRiU7GF0/4FV4iApJtDg0vYYcFo286pggkR1bJikrNUletZrECnKIpMJrUCLMjjAG9rDgpYB9S1Ufm06r86JMK1DqLMfXaoXP4WUlLC+FaQm2KsCRqiq2QuUkWQFjImHXtnCEQMxJj8OAKAzhOAJFkSOKQqRpQhTYCx8lyxMkrCr2VUrMzJd8HMK2kaUpDBWoakkCB3GScLcGhGqNSNp2HRLGfN9HEFKhG6IoWR4Hp/ZyUrs5jlCDFRSUZRkJGaw4GBWI+VrUBUUmhK0vqksu99IPE+5noBVaTsLdDbSqvme/qdS2FWGKf8URhCdIghH3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"provider\" title=\"\" src=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png\" srcset=\"/static/24e9af9f9c7012c52f8780e1280f8c5c/69538/provider.png 160w,\n/static/24e9af9f9c7012c52f8780e1280f8c5c/72799/provider.png 320w,\n/static/24e9af9f9c7012c52f8780e1280f8c5c/0a47e/provider.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <small>샌드박스의 판매 테스트 계정. 최상단에 필자 이름과 함께 12유로가 들어와있다.</small>\n</center>\n<p>하지만 아직 완전한 처리가 이루어지지 않은 상태라 Payment status는 <code class=\"language-text\">Unclaimed</code>로 되어있다. 아직은 저게 현금화 된게 아니라 그냥 Paypal서버에 들어가있는 데이터 쪼가리일 뿐이다.\n이제 Accept버튼을 눌러 판매자의 계좌로 입금을 진행하면 상태가 <code class=\"language-text\">Completed</code>로 전환되며 계좌에 <code class=\"language-text\">12EUR</code>가 <code class=\"language-text\">USD</code>로 환전되며 입금된다.</p>\n<p>이상으로 Express Checkout에 대한 포스팅을 마친다.</p>","fields":{"slug":"20170514-paypal-express-checkout","path":"/2017/05/14/paypal-express-checkout/","lang":"ko"},"frontmatter":{"title":"페이팔의 Express Checkout Restful API 사용하기","subTitle":"페이팔 결제 연동, 어떻게 구현할 수 있을까?","date":"May 14, 2017","categories":["프로그래밍","튜토리얼"],"tags":["JavaScript","자바스크립트","Paypal","페이팔","앵귤러","Angular","AngularJS","Laravel","라라벨","PHP","튜토리얼","결제연동"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","images":{"fallback":{"src":"/static/617e08b28c22d787f8450e2ec114cc93/3a812/thumbnail.jpg","srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/3a812/thumbnail.jpg 320w,\n/static/617e08b28c22d787f8450e2ec114cc93/4b287/thumbnail.jpg 750w","sizes":"(min-width: 320px) 320px, 100vw"},"sources":[{"srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/fc5c5/thumbnail.webp 320w,\n/static/617e08b28c22d787f8450e2ec114cc93/e9225/thumbnail.webp 750w","type":"image/webp","sizes":"(min-width: 320px) 320px, 100vw"}]},"width":320,"height":320}}},"jumbotron":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","images":{"fallback":{"src":"/static/617e08b28c22d787f8450e2ec114cc93/2d839/thumbnail.jpg","srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/2d839/thumbnail.jpg 750w","sizes":"100vw"},"sources":[{"srcSet":"/static/617e08b28c22d787f8450e2ec114cc93/b384d/thumbnail.webp 750w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}]}},"pageContext":{"tag":"PHP","lang":"ko"}},"staticQueryHashes":["3523904809","650499039"],"slicesMap":{}}